((self||window).webpackJsonp=(self||window).webpackJsonp||[]).push([[4],{1603:function(e,t,a){e.exports=a.p+"4fff67aa927fc4ecb16298f61b0cf84a.jpg"},1604:function(e,t,a){e.exports=a.p+"b592e228bf0641d6b4f0b79e664177ab.jpg"},1605:function(e,t,a){e.exports=a.p+"c6ab0a71c7048eb83585b34bd32f4ee0.jpg"},1606:function(e,t,a){e.exports=a.p+"27faaa4b21b2a66ac3496b20640e571f.jpg"},1608:function(e,t,a){e.exports=a.p+"aa1788b9411f5c1262a1e34dc560fc3f.jpg"},1609:function(e,t,a){e.exports=a.p+"1e6c4242b78b7717e8ffce219d09a402.jpg"},1610:function(e,t,a){e.exports=a.p+"2f4b61fff1fc654b6a75d19448eeef25.jpg"},1611:function(e,t,a){e.exports=a.p+"c4725d18f3c291232a047310254e85f2.jpg"},1612:function(e,t,a){e.exports=a.p+"c7fdec957e0d7d159977a6f405a40738.jpg"},1613:function(e,t,a){e.exports=a.p+"e4caa789e1de589c08641109a9a59131.jpg"},1614:function(e,t,a){"use strict";var i,r=(i=a(22))&&i.__esModule?i:{default:i};var n=a(25).default,o=a(8).default,s=a(10).default,l=a(11).default,u=a(201).default,d=a(24).default,f=a(184).default,c=a(601),h=new n,m=function(e){if(!o(e))throw new l(r.default.t("map.cesium.devError"));this._cesium=e,this._screenPositionX="-1000px",this._screenPositionY="-1000px",this._tweens=e.scene.tweens,this._container=e.viewer.container,this.position=void 0,this.showSelection=!0,this.transform="",this.opacity=1,d.track(this,["position","_screenPositionX","_screenPositionY","_scale","rotate","showSelection","transform","opacity"]),this.isVisible=void 0,d.defineProperty(this,"isVisible",{get:function(){return this.showSelection&&o(this.position)}}),this.computeScreenSpacePosition=function(t,a){return f.wgs84ToWindowCoordinates(e.scene,t,a)};var t=document.createElement("div");t.className="selection-indicator",this._container.appendChild(t),this._selectionIndicatorElement=t;var a=document.createElement("img");a.setAttribute("src",c),a.setAttribute("alt",""),a.setAttribute("width",50),a.setAttribute("height",50),t.appendChild(a);var i=this;function n(){t.style.top=i._screenPositionY,t.style.left=i._screenPositionX,t.style.transform=i.transform,t.style.opacity=i.opacity}n(),this._subscriptions=[],this._subscriptions.push(d.getObservable(this,"_screenPositionX").subscribe(n)),this._subscriptions.push(d.getObservable(this,"_screenPositionY").subscribe(n)),this._subscriptions.push(d.getObservable(this,"transform").subscribe(n)),this._subscriptions.push(d.getObservable(this,"opacity").subscribe(n))};m.prototype.destroy=function(){this._selectionIndicatorElement.parentNode.removeChild(this._selectionIndicatorElement),this._subscriptions.forEach((function(e){e.dispose()}))},m.prototype.update=function(){if(this.showSelection&&o(this.position)){var e=this.computeScreenSpacePosition(this.position,h);if(o(e)){var t=this._container,a=t.clientWidth,i=t.clientHeight,r=this._selectionIndicatorElement.clientWidth,n=.5*r;e.x=Math.min(Math.max(e.x,-r),a+r)-n,e.y=Math.min(Math.max(e.y,-r),i+r)-n,this._screenPositionX=Math.floor(e.x+.25)+"px",this._screenPositionY=Math.floor(e.y+.25)+"px"}else this._screenPositionX="-1000px",this._screenPositionY="-1000px"}},m.prototype.animateAppear=function(){if(o(this._selectionIndicatorTween)){if(this._selectionIndicatorIsAppearing)return;this._selectionIndicatorTween.cancelTween(),this._selectionIndicatorTween=void 0}this._selectionIndicatorIsAppearing=!0;var e=this;this._selectionIndicatorTween=this._tweens.add({startObject:{scale:2,opacity:0,rotate:-180},stopObject:{scale:1,opacity:1,rotate:0},duration:.8,easingFunction:u.EXPONENTIAL_OUT,update:function(t){e.opacity=t.opacity,e.transform="scale("+t.scale+") rotate("+t.rotate+"deg)"},complete:function(){e._selectionIndicatorTween=void 0},cancel:function(){e._selectionIndicatorTween=void 0}})},m.prototype.animateDepart=function(){if(o(this._selectionIndicatorTween)){if(!this._selectionIndicatorIsAppearing)return;this._selectionIndicatorTween.cancelTween(),this._selectionIndicatorTween=void 0}this._selectionIndicatorIsAppearing=!1;var e=this;this._selectionIndicatorTween=this._tweens.add({startObject:{scale:1,opacity:1},stopObject:{scale:1.5,opacity:0},duration:.8,easingFunction:u.EXPONENTIAL_OUT,update:function(t){e.opacity=t.opacity,e.transform="scale("+t.scale+") rotate(0deg)"},complete:function(){e._selectionIndicatorTween=void 0},cancel:function(){e._selectionIndicatorTween=void 0}})},s(m.prototype,{container:{get:function(){return this._container}},selectionIndicatorElement:{get:function(){return this._selectionIndicatorElement}},scene:{get:function(){return this._scene}}}),e.exports=m},196:function(e,t,a){"use strict";var i=a(17);t.a=Object(i.default)({ROUNDED:0,MITERED:1,BEVELED:2})},282:function(e,t,a){"use strict";var i=a(8),r=a(10),n=(a(11),a(26)),o=a(145),s=a(135),l=a(40);function u(){this._eventHelper=new o.default,this._definitionChanged=new n.default,this._intervals=new s.default,this._intervals.changedEvent.addEventListener(u.prototype._intervalsChanged,this)}Object(r.default)(u.prototype,{isConstant:{get:function(){return this._intervals.isEmpty}},definitionChanged:{get:function(){return this._definitionChanged}},intervals:{get:function(){return this._intervals}}}),u.prototype.getValue=function(e,t){var a=this._intervals.findDataForIntervalContainingDate(e);if(Object(i.default)(a))return a.getValue(e,t)},u.prototype.equals=function(e){return this===e||e instanceof u&&this._intervals.equals(e._intervals,l.default.equals)},u.prototype._intervalsChanged=function(){!function(e,t,a,r){function n(){a.raiseEvent(e)}var o=[];t.removeAll();for(var s=r.length,l=0;l<s;l++){var u=r.get(l);Object(i.default)(u.data)&&-1===o.indexOf(u.data)&&t.add(u.data.definitionChanged,n)}}(this,this._eventHelper,this._definitionChanged,this._intervals),this._definitionChanged.raiseEvent(this)},t.a=u},361:function(e,t,a){"use strict";var i=a(9),r=a(8),n=a(10),o=(a(11),a(26)),s=a(142),l=a(282),u=a(40);function d(e){this._referenceFrame=Object(i.default)(e,s.a.FIXED),this._definitionChanged=new o.default,this._composite=new l.a,this._composite.definitionChanged.addEventListener(d.prototype._raiseDefinitionChanged,this)}Object(n.default)(d.prototype,{isConstant:{get:function(){return this._composite.isConstant}},definitionChanged:{get:function(){return this._definitionChanged}},intervals:{get:function(){return this._composite.intervals}},referenceFrame:{get:function(){return this._referenceFrame},set:function(e){this._referenceFrame=e}}}),d.prototype.getValue=function(e,t){return this.getValueInReferenceFrame(e,s.a.FIXED,t)},d.prototype.getValueInReferenceFrame=function(e,t,a){var i=this._composite._intervals.findDataForIntervalContainingDate(e);if(Object(r.default)(i))return i.getValueInReferenceFrame(e,t,a)},d.prototype.equals=function(e){return this===e||e instanceof d&&this._referenceFrame===e._referenceFrame&&this._composite.equals(e._composite,u.default.equals)},d.prototype._raiseDefinitionChanged=function(){this._definitionChanged.raiseEvent(this)},t.a=d},362:function(e,t,a){"use strict";var i=a(8),r=a(10),n=(a(11),a(26)),o=a(40);function s(e){var t=e._targetProperty;if(!Object(i.default)(t)){var a=e._targetEntity;if(!Object(i.default)(a)){if(a=e._targetCollection.getById(e._targetId),!Object(i.default)(a))return void(e._targetEntity=e._targetProperty=void 0);a.definitionChanged.addEventListener(l.prototype._onTargetEntityDefinitionChanged,e),e._targetEntity=a}var r=e._targetPropertyNames;t=e._targetEntity;for(var n=0,o=r.length;n<o&&Object(i.default)(t);++n)t=t[r[n]];e._targetProperty=t}return t}function l(e,t,a){this._targetCollection=e,this._targetId=t,this._targetPropertyNames=a,this._targetProperty=void 0,this._targetEntity=void 0,this._definitionChanged=new n.default,e.collectionChanged.addEventListener(l.prototype._onCollectionChanged,this)}Object(r.default)(l.prototype,{isConstant:{get:function(){return o.default.isConstant(s(this))}},definitionChanged:{get:function(){return this._definitionChanged}},referenceFrame:{get:function(){var e=s(this);return Object(i.default)(e)?e.referenceFrame:void 0}},targetId:{get:function(){return this._targetId}},targetCollection:{get:function(){return this._targetCollection}},targetPropertyNames:{get:function(){return this._targetPropertyNames}},resolvedProperty:{get:function(){return s(this)}}}),l.fromString=function(e,t){for(var a,i=[],r=!0,n=!1,o="",s=0;s<t.length;++s){var u=t.charAt(s);n?(o+=u,n=!1):"\\"===u?n=!0:r&&"#"===u?(a=o,r=!1,o=""):r||"."!==u?o+=u:(i.push(o),o="")}return i.push(o),new l(e,a,i)},l.prototype.getValue=function(e,t){var a=s(this);return Object(i.default)(a)?a.getValue(e,t):void 0},l.prototype.getValueInReferenceFrame=function(e,t,a){var r=s(this);return Object(i.default)(r)?r.getValueInReferenceFrame(e,t,a):void 0},l.prototype.getType=function(e){var t=s(this);return Object(i.default)(t)?t.getType(e):void 0},l.prototype.equals=function(e){if(this===e)return!0;var t=this._targetPropertyNames,a=e._targetPropertyNames;if(this._targetCollection!==e._targetCollection||this._targetId!==e._targetId||t.length!==a.length)return!1;for(var i=this._targetPropertyNames.length,r=0;r<i;r++)if(t[r]!==a[r])return!1;return!0},l.prototype._onTargetEntityDefinitionChanged=function(e,t,a,r){Object(i.default)(this._targetProperty)&&this._targetPropertyNames[0]===t&&(this._targetProperty=void 0,this._definitionChanged.raiseEvent(this))},l.prototype._onCollectionChanged=function(e,t,a){var r=this._targetEntity;Object(i.default)(r)&&-1!==a.indexOf(r)?(r.definitionChanged.removeEventListener(l.prototype._onTargetEntityDefinitionChanged,this),this._targetEntity=this._targetProperty=void 0):Object(i.default)(r)||(r=s(this),Object(i.default)(r)&&this._definitionChanged.raiseEvent(this))},t.a=l},363:function(e,t,a){"use strict";var i=a(97),r=a(35),n=a(13),o=(a(16),a(36)),s=a(9),l=a(8),u=(a(11),a(53)),d=a(54),f=a(66),c=a(87),h=a(47),m=a(80),p=new n.default;function _(e){var t=(e=Object(s.default)(e,s.default.EMPTY_OBJECT)).minimum,a=e.maximum,i=Object(s.default)(e.vertexFormat,m.default.DEFAULT);this._minimum=n.default.clone(t),this._maximum=n.default.clone(a),this._vertexFormat=i,this._offsetAttribute=e.offsetAttribute,this._workerName="createBoxGeometry"}_.fromDimensions=function(e){var t=(e=Object(s.default)(e,s.default.EMPTY_OBJECT)).dimensions,a=n.default.multiplyByScalar(t,.5,new n.default);return new _({minimum:n.default.negate(a,new n.default),maximum:a,vertexFormat:e.vertexFormat,offsetAttribute:e.offsetAttribute})},_.fromAxisAlignedBoundingBox=function(e){return new _({minimum:e.minimum,maximum:e.maximum})},_.packedLength=2*n.default.packedLength+m.default.packedLength+1,_.pack=function(e,t,a){return a=Object(s.default)(a,0),n.default.pack(e._minimum,t,a),n.default.pack(e._maximum,t,a+n.default.packedLength),m.default.pack(e._vertexFormat,t,a+2*n.default.packedLength),t[a+2*n.default.packedLength+m.default.packedLength]=Object(s.default)(e._offsetAttribute,-1),t};var g,v=new n.default,y=new n.default,b=new m.default,w={minimum:v,maximum:y,vertexFormat:b,offsetAttribute:void 0};_.unpack=function(e,t,a){t=Object(s.default)(t,0);var i=n.default.unpack(e,t,v),r=n.default.unpack(e,t+n.default.packedLength,y),o=m.default.unpack(e,t+2*n.default.packedLength,b),u=e[t+2*n.default.packedLength+m.default.packedLength];return Object(l.default)(a)?(a._minimum=n.default.clone(i,a._minimum),a._maximum=n.default.clone(r,a._maximum),a._vertexFormat=m.default.clone(o,a._vertexFormat),a._offsetAttribute=-1===u?void 0:u,a):(w.offsetAttribute=-1===u?void 0:u,new _(w))},_.createGeometry=function(e){var t=e._minimum,a=e._maximum,s=e._vertexFormat;if(!n.default.equals(t,a)){var m,_,g=new f.a;if(s.position&&(s.st||s.normal||s.tangent||s.bitangent)){if(s.position&&((_=new Float64Array(72))[0]=t.x,_[1]=t.y,_[2]=a.z,_[3]=a.x,_[4]=t.y,_[5]=a.z,_[6]=a.x,_[7]=a.y,_[8]=a.z,_[9]=t.x,_[10]=a.y,_[11]=a.z,_[12]=t.x,_[13]=t.y,_[14]=t.z,_[15]=a.x,_[16]=t.y,_[17]=t.z,_[18]=a.x,_[19]=a.y,_[20]=t.z,_[21]=t.x,_[22]=a.y,_[23]=t.z,_[24]=a.x,_[25]=t.y,_[26]=t.z,_[27]=a.x,_[28]=a.y,_[29]=t.z,_[30]=a.x,_[31]=a.y,_[32]=a.z,_[33]=a.x,_[34]=t.y,_[35]=a.z,_[36]=t.x,_[37]=t.y,_[38]=t.z,_[39]=t.x,_[40]=a.y,_[41]=t.z,_[42]=t.x,_[43]=a.y,_[44]=a.z,_[45]=t.x,_[46]=t.y,_[47]=a.z,_[48]=t.x,_[49]=a.y,_[50]=t.z,_[51]=a.x,_[52]=a.y,_[53]=t.z,_[54]=a.x,_[55]=a.y,_[56]=a.z,_[57]=t.x,_[58]=a.y,_[59]=a.z,_[60]=t.x,_[61]=t.y,_[62]=t.z,_[63]=a.x,_[64]=t.y,_[65]=t.z,_[66]=a.x,_[67]=t.y,_[68]=a.z,_[69]=t.x,_[70]=t.y,_[71]=a.z,g.position=new d.a({componentDatatype:o.a.DOUBLE,componentsPerAttribute:3,values:_})),s.normal){var v=new Float32Array(72);v[0]=0,v[1]=0,v[2]=1,v[3]=0,v[4]=0,v[5]=1,v[6]=0,v[7]=0,v[8]=1,v[9]=0,v[10]=0,v[11]=1,v[12]=0,v[13]=0,v[14]=-1,v[15]=0,v[16]=0,v[17]=-1,v[18]=0,v[19]=0,v[20]=-1,v[21]=0,v[22]=0,v[23]=-1,v[24]=1,v[25]=0,v[26]=0,v[27]=1,v[28]=0,v[29]=0,v[30]=1,v[31]=0,v[32]=0,v[33]=1,v[34]=0,v[35]=0,v[36]=-1,v[37]=0,v[38]=0,v[39]=-1,v[40]=0,v[41]=0,v[42]=-1,v[43]=0,v[44]=0,v[45]=-1,v[46]=0,v[47]=0,v[48]=0,v[49]=1,v[50]=0,v[51]=0,v[52]=1,v[53]=0,v[54]=0,v[55]=1,v[56]=0,v[57]=0,v[58]=1,v[59]=0,v[60]=0,v[61]=-1,v[62]=0,v[63]=0,v[64]=-1,v[65]=0,v[66]=0,v[67]=-1,v[68]=0,v[69]=0,v[70]=-1,v[71]=0,g.normal=new d.a({componentDatatype:o.a.FLOAT,componentsPerAttribute:3,values:v})}if(s.st){var y=new Float32Array(48);y[0]=0,y[1]=0,y[2]=1,y[3]=0,y[4]=1,y[5]=1,y[6]=0,y[7]=1,y[8]=1,y[9]=0,y[10]=0,y[11]=0,y[12]=0,y[13]=1,y[14]=1,y[15]=1,y[16]=0,y[17]=0,y[18]=1,y[19]=0,y[20]=1,y[21]=1,y[22]=0,y[23]=1,y[24]=1,y[25]=0,y[26]=0,y[27]=0,y[28]=0,y[29]=1,y[30]=1,y[31]=1,y[32]=1,y[33]=0,y[34]=0,y[35]=0,y[36]=0,y[37]=1,y[38]=1,y[39]=1,y[40]=0,y[41]=0,y[42]=1,y[43]=0,y[44]=1,y[45]=1,y[46]=0,y[47]=1,g.st=new d.a({componentDatatype:o.a.FLOAT,componentsPerAttribute:2,values:y})}if(s.tangent){var b=new Float32Array(72);b[0]=1,b[1]=0,b[2]=0,b[3]=1,b[4]=0,b[5]=0,b[6]=1,b[7]=0,b[8]=0,b[9]=1,b[10]=0,b[11]=0,b[12]=-1,b[13]=0,b[14]=0,b[15]=-1,b[16]=0,b[17]=0,b[18]=-1,b[19]=0,b[20]=0,b[21]=-1,b[22]=0,b[23]=0,b[24]=0,b[25]=1,b[26]=0,b[27]=0,b[28]=1,b[29]=0,b[30]=0,b[31]=1,b[32]=0,b[33]=0,b[34]=1,b[35]=0,b[36]=0,b[37]=-1,b[38]=0,b[39]=0,b[40]=-1,b[41]=0,b[42]=0,b[43]=-1,b[44]=0,b[45]=0,b[46]=-1,b[47]=0,b[48]=-1,b[49]=0,b[50]=0,b[51]=-1,b[52]=0,b[53]=0,b[54]=-1,b[55]=0,b[56]=0,b[57]=-1,b[58]=0,b[59]=0,b[60]=1,b[61]=0,b[62]=0,b[63]=1,b[64]=0,b[65]=0,b[66]=1,b[67]=0,b[68]=0,b[69]=1,b[70]=0,b[71]=0,g.tangent=new d.a({componentDatatype:o.a.FLOAT,componentsPerAttribute:3,values:b})}if(s.bitangent){var w=new Float32Array(72);w[0]=0,w[1]=1,w[2]=0,w[3]=0,w[4]=1,w[5]=0,w[6]=0,w[7]=1,w[8]=0,w[9]=0,w[10]=1,w[11]=0,w[12]=0,w[13]=1,w[14]=0,w[15]=0,w[16]=1,w[17]=0,w[18]=0,w[19]=1,w[20]=0,w[21]=0,w[22]=1,w[23]=0,w[24]=0,w[25]=0,w[26]=1,w[27]=0,w[28]=0,w[29]=1,w[30]=0,w[31]=0,w[32]=1,w[33]=0,w[34]=0,w[35]=1,w[36]=0,w[37]=0,w[38]=1,w[39]=0,w[40]=0,w[41]=1,w[42]=0,w[43]=0,w[44]=1,w[45]=0,w[46]=0,w[47]=1,w[48]=0,w[49]=0,w[50]=1,w[51]=0,w[52]=0,w[53]=1,w[54]=0,w[55]=0,w[56]=1,w[57]=0,w[58]=0,w[59]=1,w[60]=0,w[61]=0,w[62]=1,w[63]=0,w[64]=0,w[65]=1,w[66]=0,w[67]=0,w[68]=1,w[69]=0,w[70]=0,w[71]=1,g.bitangent=new d.a({componentDatatype:o.a.FLOAT,componentsPerAttribute:3,values:w})}(m=new Uint16Array(36))[0]=0,m[1]=1,m[2]=2,m[3]=0,m[4]=2,m[5]=3,m[6]=6,m[7]=5,m[8]=4,m[9]=7,m[10]=6,m[11]=4,m[12]=8,m[13]=9,m[14]=10,m[15]=8,m[16]=10,m[17]=11,m[18]=14,m[19]=13,m[20]=12,m[21]=15,m[22]=14,m[23]=12,m[24]=18,m[25]=17,m[26]=16,m[27]=19,m[28]=18,m[29]=16,m[30]=20,m[31]=21,m[32]=22,m[33]=20,m[34]=22,m[35]=23}else(_=new Float64Array(24))[0]=t.x,_[1]=t.y,_[2]=t.z,_[3]=a.x,_[4]=t.y,_[5]=t.z,_[6]=a.x,_[7]=a.y,_[8]=t.z,_[9]=t.x,_[10]=a.y,_[11]=t.z,_[12]=t.x,_[13]=t.y,_[14]=a.z,_[15]=a.x,_[16]=t.y,_[17]=a.z,_[18]=a.x,_[19]=a.y,_[20]=a.z,_[21]=t.x,_[22]=a.y,_[23]=a.z,g.position=new d.a({componentDatatype:o.a.DOUBLE,componentsPerAttribute:3,values:_}),(m=new Uint16Array(36))[0]=4,m[1]=5,m[2]=6,m[3]=4,m[4]=6,m[5]=7,m[6]=1,m[7]=0,m[8]=3,m[9]=1,m[10]=3,m[11]=2,m[12]=1,m[13]=6,m[14]=5,m[15]=1,m[16]=2,m[17]=6,m[18]=2,m[19]=3,m[20]=7,m[21]=2,m[22]=7,m[23]=6,m[24]=3,m[25]=0,m[26]=4,m[27]=3,m[28]=4,m[29]=7,m[30]=0,m[31]=1,m[32]=5,m[33]=0,m[34]=5,m[35]=4;var O=n.default.subtract(a,t,p),x=.5*n.default.magnitude(O);if(Object(l.default)(e._offsetAttribute)){var C=_.length,T=new Uint8Array(C/3),E=e._offsetAttribute===c.a.NONE?0:1;Object(i.a)(T,E),g.applyOffset=new d.a({componentDatatype:o.a.UNSIGNED_BYTE,componentsPerAttribute:1,values:T})}return new u.a({attributes:g,indices:m,primitiveType:h.a.TRIANGLES,boundingSphere:new r.default(n.default.ZERO,x),offsetAttribute:e._offsetAttribute})}},_.getUnitBox=function(){return Object(l.default)(g)||(g=_.createGeometry(_.fromDimensions({dimensions:new n.default(1,1,1),vertexFormat:m.default.POSITION_ONLY}))),g},t.a=_},364:function(e,t,a){"use strict";var i=a(76),r=a(9),n=a(8),o=a(10),s=a(20);a(11);function l(e){e=Object(r.default)(e,r.default.EMPTY_OBJECT),this._primitives=[],this._guid=Object(i.default)(),this._zIndex=void 0,this.show=Object(r.default)(e.show,!0),this.destroyPrimitives=Object(r.default)(e.destroyPrimitives,!0)}function u(e,t){return e._primitives.indexOf(t)}Object(o.default)(l.prototype,{length:{get:function(){return this._primitives.length}}}),l.prototype.add=function(e,t){var a=Object(n.default)(t),i=e._external=e._external||{};return(i._composites=i._composites||{})[this._guid]={collection:this},a?this._primitives.splice(t,0,e):this._primitives.push(e),e},l.prototype.remove=function(e){if(this.contains(e)){var t=this._primitives.indexOf(e);if(-1!==t)return this._primitives.splice(t,1),delete e._external._composites[this._guid],this.destroyPrimitives&&e.destroy(),!0}return!1},l.prototype.removeAndDestroy=function(e){var t=this.remove(e);return t&&!this.destroyPrimitives&&e.destroy(),t},l.prototype.removeAll=function(){for(var e=this._primitives,t=e.length,a=0;a<t;++a)delete e[a]._external._composites[this._guid],this.destroyPrimitives&&e[a].destroy();this._primitives=[]},l.prototype.contains=function(e){return!!(Object(n.default)(e)&&e._external&&e._external._composites&&e._external._composites[this._guid])},l.prototype.raise=function(e){if(Object(n.default)(e)){var t=u(this,e),a=this._primitives;if(t!==a.length-1){var i=a[t];a[t]=a[t+1],a[t+1]=i}}},l.prototype.raiseToTop=function(e){if(Object(n.default)(e)){var t=u(this,e),a=this._primitives;t!==a.length-1&&(a.splice(t,1),a.push(e))}},l.prototype.lower=function(e){if(Object(n.default)(e)){var t=u(this,e),a=this._primitives;if(0!==t){var i=a[t];a[t]=a[t-1],a[t-1]=i}}},l.prototype.lowerToBottom=function(e){if(Object(n.default)(e)){var t=u(this,e),a=this._primitives;0!==t&&(a.splice(t,1),a.unshift(e))}},l.prototype.get=function(e){return this._primitives[e]},l.prototype.update=function(e){if(this.show)for(var t=this._primitives,a=0;a<t.length;++a)t[a].update(e)},l.prototype.prePassesUpdate=function(e){for(var t=this._primitives,a=0;a<t.length;++a){var i=t[a];Object(n.default)(i.prePassesUpdate)&&i.prePassesUpdate(e)}},l.prototype.updateForPass=function(e,t){for(var a=this._primitives,i=0;i<a.length;++i){var r=a[i];Object(n.default)(r.updateForPass)&&r.updateForPass(e,t)}},l.prototype.postPassesUpdate=function(e){for(var t=this._primitives,a=0;a<t.length;++a){var i=t[a];Object(n.default)(i.postPassesUpdate)&&i.postPassesUpdate(e)}},l.prototype.isDestroyed=function(){return!1},l.prototype.destroy=function(){return this.removeAll(),Object(s.default)(this)},t.a=l},504:function(e,t,a){"use strict";var i=a(8),r=a(10),n=(a(11),a(29)),o=a(26),s=a(142),l=a(40);function u(e){this._definitionChanged=new o.default,this._value=void 0,this._removeSubscription=void 0,this.setValue(e)}Object(r.default)(u.prototype,{isConstant:{get:function(){return l.default.isConstant(this._value)}},definitionChanged:{get:function(){return this._definitionChanged}},referenceFrame:{get:function(){return Object(i.default)(this._value)?this._value.referenceFrame:s.a.FIXED}}}),u.prototype.getValue=function(e,t){return this.getValueInReferenceFrame(e,s.a.FIXED,t)},u.prototype.setValue=function(e){this._value!==e&&(this._value=e,Object(i.default)(this._removeSubscription)&&(this._removeSubscription(),this._removeSubscription=void 0),Object(i.default)(e)&&(this._removeSubscription=e.definitionChanged.addEventListener(this._raiseDefinitionChanged,this)),this._definitionChanged.raiseEvent(this))},u.prototype.getValueInReferenceFrame=function(e,t,a){if(Object(i.default)(this._value))return a=this._value.getValueInReferenceFrame(e,t,a),Object(i.default)(a)?n.default.WGS84.scaleToGeodeticSurface(a,a):void 0},u.prototype.equals=function(e){return this===e||e instanceof u&&this._value===e._value},u.prototype._raiseDefinitionChanged=function(){this._definitionChanged.raiseEvent(this)},t.a=u},505:function(e,t,a){"use strict";var i=a(97),r=a(35),n=a(25),o=a(13),s=a(36),l=a(9),u=a(8),d=(a(11),a(29)),f=a(53),c=a(54),h=a(66),m=a(87),p=a(51),_=a(15),g=a(47),v=a(80),y=new o.default,b=new o.default,w=new o.default,O=new o.default,x=new o.default,C=new o.default(1,1,1),T=Math.cos,E=Math.sin;function A(e){e=Object(l.default)(e,l.default.EMPTY_OBJECT);var t=Object(l.default)(e.radii,C),a=Object(l.default)(e.innerRadii,t),i=Object(l.default)(e.minimumClock,0),r=Object(l.default)(e.maximumClock,_.default.TWO_PI),n=Object(l.default)(e.minimumCone,0),s=Object(l.default)(e.maximumCone,_.default.PI),u=Math.round(Object(l.default)(e.stackPartitions,64)),d=Math.round(Object(l.default)(e.slicePartitions,64)),f=Object(l.default)(e.vertexFormat,v.default.DEFAULT);this._radii=o.default.clone(t),this._innerRadii=o.default.clone(a),this._minimumClock=i,this._maximumClock=r,this._minimumCone=n,this._maximumCone=s,this._stackPartitions=u,this._slicePartitions=d,this._vertexFormat=v.default.clone(f),this._offsetAttribute=e.offsetAttribute,this._workerName="createEllipsoidGeometry"}A.packedLength=2*o.default.packedLength+v.default.packedLength+7,A.pack=function(e,t,a){return a=Object(l.default)(a,0),o.default.pack(e._radii,t,a),a+=o.default.packedLength,o.default.pack(e._innerRadii,t,a),a+=o.default.packedLength,v.default.pack(e._vertexFormat,t,a),a+=v.default.packedLength,t[a++]=e._minimumClock,t[a++]=e._maximumClock,t[a++]=e._minimumCone,t[a++]=e._maximumCone,t[a++]=e._stackPartitions,t[a++]=e._slicePartitions,t[a]=Object(l.default)(e._offsetAttribute,-1),t};var S,P=new o.default,D=new o.default,I=new v.default,M={radii:P,innerRadii:D,vertexFormat:I,minimumClock:void 0,maximumClock:void 0,minimumCone:void 0,maximumCone:void 0,stackPartitions:void 0,slicePartitions:void 0,offsetAttribute:void 0};A.unpack=function(e,t,a){t=Object(l.default)(t,0);var i=o.default.unpack(e,t,P);t+=o.default.packedLength;var r=o.default.unpack(e,t,D);t+=o.default.packedLength;var n=v.default.unpack(e,t,I);t+=v.default.packedLength;var s=e[t++],d=e[t++],f=e[t++],c=e[t++],h=e[t++],m=e[t++],p=e[t];return Object(u.default)(a)?(a._radii=o.default.clone(i,a._radii),a._innerRadii=o.default.clone(r,a._innerRadii),a._vertexFormat=v.default.clone(n,a._vertexFormat),a._minimumClock=s,a._maximumClock=d,a._minimumCone=f,a._maximumCone=c,a._stackPartitions=h,a._slicePartitions=m,a._offsetAttribute=-1===p?void 0:p,a):(M.minimumClock=s,M.maximumClock=d,M.minimumCone=f,M.maximumCone=c,M.stackPartitions=h,M.slicePartitions=m,M.offsetAttribute=-1===p?void 0:p,new A(M))},A.createGeometry=function(e){var t=e._radii;if(!(t.x<=0||t.y<=0||t.z<=0)){var a=e._innerRadii;if(!(a.x<=0||a.y<=0||a.z<=0)){var l,v,C=e._minimumClock,A=e._maximumClock,S=e._minimumCone,P=e._maximumCone,D=e._vertexFormat,I=e._slicePartitions+1,M=e._stackPartitions+1;(I=Math.round(I*Math.abs(A-C)/_.default.TWO_PI))<2&&(I=2),(M=Math.round(M*Math.abs(P-S)/_.default.PI))<2&&(M=2);var F=0,R=[S],N=[C];for(l=0;l<M;l++)R.push(S+l*(P-S)/(M-1));for(R.push(P),v=0;v<I;v++)N.push(C+v*(A-C)/(I-1));N.push(A);var L=R.length,j=N.length,V=0,U=1,z=a.x!==t.x||a.y!==t.y||a.z!==t.z,B=!1,H=!1,k=!1;z&&(U=2,S>0&&(B=!0,V+=I-1),P<Math.PI&&(H=!0,V+=I-1),(A-C)%_.default.TWO_PI?(k=!0,V+=2*(M-1)+1):V+=1);var G=j*L*U,W=new Float64Array(3*G),Y=Object(i.a)(new Array(G),!1),X=Object(i.a)(new Array(G),!1),Q=I*M*U,q=6*(Q+V+1-(I+M)*U),Z=p.a.createTypedArray(Q,q),K=D.normal?new Float32Array(3*G):void 0,J=D.tangent?new Float32Array(3*G):void 0,$=D.bitangent?new Float32Array(3*G):void 0,ee=D.st?new Float32Array(2*G):void 0,te=new Array(L),ae=new Array(L);for(l=0;l<L;l++)te[l]=E(R[l]),ae[l]=T(R[l]);var ie=new Array(j),re=new Array(j);for(v=0;v<j;v++)re[v]=T(N[v]),ie[v]=E(N[v]);for(l=0;l<L;l++)for(v=0;v<j;v++)W[F++]=t.x*te[l]*re[v],W[F++]=t.y*te[l]*ie[v],W[F++]=t.z*ae[l];var ne,oe,se,le,ue=G/2;if(z)for(l=0;l<L;l++)for(v=0;v<j;v++)W[F++]=a.x*te[l]*re[v],W[F++]=a.y*te[l]*ie[v],W[F++]=a.z*ae[l],Y[ue]=!0,l>0&&l!==L-1&&0!==v&&v!==j-1&&(X[ue]=!0),ue++;for(F=0,l=1;l<L-2;l++)for(ne=l*j,oe=(l+1)*j,v=1;v<j-2;v++)Z[F++]=oe+v,Z[F++]=oe+v+1,Z[F++]=ne+v+1,Z[F++]=oe+v,Z[F++]=ne+v+1,Z[F++]=ne+v;if(z){var de=L*j;for(l=1;l<L-2;l++)for(ne=de+l*j,oe=de+(l+1)*j,v=1;v<j-2;v++)Z[F++]=oe+v,Z[F++]=ne+v,Z[F++]=ne+v+1,Z[F++]=oe+v,Z[F++]=ne+v+1,Z[F++]=oe+v+1}if(z){if(B)for(le=L*j,l=1;l<j-2;l++)Z[F++]=l,Z[F++]=l+1,Z[F++]=le+l+1,Z[F++]=l,Z[F++]=le+l+1,Z[F++]=le+l;if(H)for(se=L*j-j,le=L*j*U-j,l=1;l<j-2;l++)Z[F++]=se+l+1,Z[F++]=se+l,Z[F++]=le+l,Z[F++]=se+l+1,Z[F++]=le+l,Z[F++]=le+l+1}if(k){for(l=1;l<L-2;l++)le=j*L+j*l,se=j*l,Z[F++]=le,Z[F++]=se+j,Z[F++]=se,Z[F++]=le,Z[F++]=le+j,Z[F++]=se+j;for(l=1;l<L-2;l++)le=j*L+j*(l+1)-1,se=j*(l+1)-1,Z[F++]=se+j,Z[F++]=le,Z[F++]=se,Z[F++]=se+j,Z[F++]=le+j,Z[F++]=le}var fe=new h.a;D.position&&(fe.position=new c.a({componentDatatype:s.a.DOUBLE,componentsPerAttribute:3,values:W}));var ce,he=0,me=0,pe=0,_e=0,ge=G/2,ve=d.default.fromCartesian3(t),ye=d.default.fromCartesian3(a);if(D.st||D.normal||D.tangent||D.bitangent){for(l=0;l<G;l++){ce=Y[l]?ye:ve;var be=o.default.fromArray(W,3*l,y),we=ce.geodeticSurfaceNormal(be,b);if(X[l]&&o.default.negate(we,we),D.st){var Oe=n.default.negate(we,x);ee[he++]=Math.atan2(Oe.y,Oe.x)/_.default.TWO_PI+.5,ee[he++]=Math.asin(we.z)/Math.PI+.5}if(D.normal&&(K[me++]=we.x,K[me++]=we.y,K[me++]=we.z),D.tangent||D.bitangent){var xe,Ce=w,Te=0;if(Y[l]&&(Te=ge),xe=!B&&l>=Te&&l<Te+2*j?o.default.UNIT_X:o.default.UNIT_Z,o.default.cross(xe,we,Ce),o.default.normalize(Ce,Ce),D.tangent&&(J[pe++]=Ce.x,J[pe++]=Ce.y,J[pe++]=Ce.z),D.bitangent){var Ee=o.default.cross(we,Ce,O);o.default.normalize(Ee,Ee),$[_e++]=Ee.x,$[_e++]=Ee.y,$[_e++]=Ee.z}}}D.st&&(fe.st=new c.a({componentDatatype:s.a.FLOAT,componentsPerAttribute:2,values:ee})),D.normal&&(fe.normal=new c.a({componentDatatype:s.a.FLOAT,componentsPerAttribute:3,values:K})),D.tangent&&(fe.tangent=new c.a({componentDatatype:s.a.FLOAT,componentsPerAttribute:3,values:J})),D.bitangent&&(fe.bitangent=new c.a({componentDatatype:s.a.FLOAT,componentsPerAttribute:3,values:$}))}if(Object(u.default)(e._offsetAttribute)){var Ae=W.length,Se=new Uint8Array(Ae/3),Pe=e._offsetAttribute===m.a.NONE?0:1;Object(i.a)(Se,Pe),fe.applyOffset=new c.a({componentDatatype:s.a.UNSIGNED_BYTE,componentsPerAttribute:1,values:Se})}return new f.a({attributes:fe,indices:Z,primitiveType:g.a.TRIANGLES,boundingSphere:r.default.fromEllipsoid(ve),offsetAttribute:e._offsetAttribute})}}},A.getUnitEllipsoid=function(){return Object(u.default)(S)||(S=A.createGeometry(new A({radii:new o.default(1,1,1),vertexFormat:v.default.POSITION_ONLY}))),S},t.a=A},748:function(e,t,a){"use strict";function i(e){return function(e){if(Array.isArray(e)){for(var t=0,a=new Array(e.length);t<e.length;t++)a[t]=e[t];return a}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var r=a(35).default,n=a(93).default,o=a(25).default,s=a(13).default,l=a(32).default,u=a(15).default,d=a(9).default,f=a(8).default,c=a(20).default,h=a(11).default,m=a(29).default,p=a(147).default,_=a(198).default,g=a(100).default,v=a(345).default,y=a(366).default,b=a(44).default,w=a(24).default,O=a(149),x=a(30).default,C=a(31).default,T=a(338).default,E=a(184).default,A=a(212).default,S=a(137).default,P=a(64).default,D=a(18).default,I=a(145).default,M=a(134).default,F=a(1614),R=a(227),N=a(410),L=a(28),j=a(398),V=a(39),U=a(418),z=a(172),B=a(22).default,H=function(e,t){N.call(this,e),this.viewer=t,this.scene=t.scene,this.stoppedRendering=!1,this.verboseRendering=!1,this.canShowSplitter=!0,this.dataSourceDisplay=void 0,this._lastClockTime=new b(0,0),this._lastCameraViewMatrix=new x,this._lastCameraMoveTime=0,this._selectionIndicator=new F(this),this._removePostRenderListener=this.scene.postRender.addEventListener(ie.bind(void 0,this)),this._removeInfoBoxCloseListener=void 0,this._boundNotifyRepaintRequired=this.notifyRepaintRequired.bind(this),this._pauseMapInteractionCount=0,this.scene.imagerySplitPosition=this.terria.splitPosition,this.supportsPolylinesOnTerrain=this.scene.context.depthTexture,t.screenSpaceEventHandler.setInputAction(function(e){this.pickFromScreenPosition(e.position)}.bind(this),A.LEFT_CLICK);var a=this.viewer.canvas;if(a.addEventListener("mousemove",this._boundNotifyRepaintRequired,!1),a.addEventListener("mousedown",this._boundNotifyRepaintRequired,!1),a.addEventListener("mouseup",this._boundNotifyRepaintRequired,!1),a.addEventListener("touchstart",this._boundNotifyRepaintRequired,!1),a.addEventListener("touchend",this._boundNotifyRepaintRequired,!1),a.addEventListener("touchmove",this._boundNotifyRepaintRequired,!1),f(window.PointerEvent)&&(a.addEventListener("pointerdown",this._boundNotifyRepaintRequired,!1),a.addEventListener("pointerup",this._boundNotifyRepaintRequired,!1),a.addEventListener("pointermove",this._boundNotifyRepaintRequired,!1)),this._wheelEvent=void 0,"onwheel"in a?this._wheelEvent="wheel":f(document.onmousewheel)?this._wheelEvent="mousewheel":this._wheelEvent="DOMMouseScroll",a.addEventListener(this._wheelEvent,this._boundNotifyRepaintRequired,!1),window.addEventListener("resize",this._boundNotifyRepaintRequired,!1),f(this.viewer.infoBox)&&(this._removeInfoBoxCloseListener=this.viewer.infoBox.viewModel.closeClicked.addEventListener(this._boundNotifyRepaintRequired)),f(this.viewer._clockViewModel)){var i=this.viewer._clockViewModel;this._shouldAnimateSubscription=w.getObservable(i,"shouldAnimate").subscribe(this._boundNotifyRepaintRequired),this._currentTimeSubscription=w.getObservable(i,"currentTime").subscribe(this._boundNotifyRepaintRequired)}f(this.viewer.timeline)&&this.viewer.timeline.addEventListener("settime",this._boundNotifyRepaintRequired,!1),this._selectedFeatureSubscription=w.getObservable(this.terria,"selectedFeature").subscribe((function(){re(this)}),this),this._splitterPositionSubscription=w.getObservable(this.terria,"splitPosition").subscribe((function(){this.scene&&(this.scene.imagerySplitPosition=this.terria.splitPosition,this.notifyRepaintRequired())}),this),this._showSplitterSubscription=w.getObservable(e,"showSplitter").subscribe((function(){this.updateAllItemsForSplitter()}),this);var r=this;this._originalLoadWithXhr=O.load,O.load=function(e,t,a,i,n,o,s,l,u){o.promise.always(r._boundNotifyRepaintRequired),r._originalLoadWithXhr(e,t,a,i,n,o,s,l,u)},this._originalScheduleTask=S.prototype.scheduleTask,S.prototype.scheduleTask=function(e,t){var a=r._originalScheduleTask.call(this,e,t);if(!f(this._originalWorkerMessageSinkRepaint)){this._originalWorkerMessageSinkRepaint=this._worker.onmessage;var i=this;this._worker.onmessage=function(e){i._originalWorkerMessageSinkRepaint(e),r.isDestroyed()?(i._worker.onmessage=i._originalWorkerMessageSinkRepaint,i._originalWorkerMessageSinkRepaint=void 0):r.notifyRepaintRequired()}}return a},this.eventHelper=new I,this.eventHelper.add(this.scene.renderError,(function(t,a){this.terria.error.raiseEvent(new V({sender:this,title:B.t("models.cesiumTerrain.errorRenderingTitle"),message:B.t("models.cesiumTerrain.errorRenderingTitle",{appName:e.appName,email:'<a href="mailto:'+e.supportEmail+'">'+e.supportEmail+"</a>."})+"<pre>"+_(a)+"</pre>"})),this.terria.viewerMode=z.Leaflet}),this),this.eventHelper.add(this.scene.globe.tileLoadProgressEvent,this.updateTilesLoadingCount.bind(this)),re(this)};L(N,H),H.prototype.destroy=function(){return f(this._selectionIndicator)&&(this._selectionIndicator.destroy(),this._selectionIndicator=void 0),f(this._removePostRenderListener)&&(this._removePostRenderListener(),this._removePostRenderListener=void 0),f(this._removeInfoBoxCloseListener)&&this._removeInfoBoxCloseListener(),f(this._shouldAnimateSubscription)&&(this._shouldAnimateSubscription.dispose(),this._shouldAnimateSubscription=void 0),f(this._currentTimeSubscription)&&(this._currentTimeSubscription.dispose(),this._currentTimeSubscription=void 0),f(this.viewer.timeline)&&this.viewer.timeline.removeEventListener("settime",this._boundNotifyRepaintRequired,!1),f(this._selectedFeatureSubscription)&&(this._selectedFeatureSubscription.dispose(),this._selectedFeatureSubscription=void 0),f(this._splitterPositionSubscription)&&(this._splitterPositionSubscription.dispose(),this._splitterPositionSubscription=void 0),f(this._showSplitterSubscription)&&(this._showSplitterSubscription.dispose(),this._showSplitterSubscription=void 0),this.viewer.canvas.removeEventListener("mousemove",this._boundNotifyRepaintRequired,!1),this.viewer.canvas.removeEventListener("mousedown",this._boundNotifyRepaintRequired,!1),this.viewer.canvas.removeEventListener("mouseup",this._boundNotifyRepaintRequired,!1),this.viewer.canvas.removeEventListener("touchstart",this._boundNotifyRepaintRequired,!1),this.viewer.canvas.removeEventListener("touchend",this._boundNotifyRepaintRequired,!1),this.viewer.canvas.removeEventListener("touchmove",this._boundNotifyRepaintRequired,!1),f(window.PointerEvent)&&(this.viewer.canvas.removeEventListener("pointerdown",this._boundNotifyRepaintRequired,!1),this.viewer.canvas.removeEventListener("pointerup",this._boundNotifyRepaintRequired,!1),this.viewer.canvas.removeEventListener("pointermove",this._boundNotifyRepaintRequired,!1)),this.viewer.canvas.removeEventListener(this._wheelEvent,this._boundNotifyRepaintRequired,!1),window.removeEventListener("resize",this._boundNotifyRepaintRequired,!1),window.removeEventListener("resize",this._setViewerResolution,!1),O.load=this._originalLoadWithXhr,S.prototype.scheduleTask=this._originalScheduleTask,this.eventHelper.removeAll(),N.disposeCommonListeners(this),c(this)},H.prototype.isDestroyed=function(){return!1};var k=new s,G=new x,W=new s,Y=new s,X=new s,Q=new s,q=new l,Z=new l,K=new l,J=new l;H.prototype.getCurrentExtent=function(){var e=this.scene,t=e.camera,a=e.canvas.clientWidth,i=e.canvas.clientHeight,r=new o(a/2,i/2),n=e.camera.getPickRay(r),l=e.globe.pick(n,e);if(!f(l))return this.terria.homeView.rectangle;var d=this.scene.globe.ellipsoid,c=.5*e.camera.frustum.fovy,h=Math.atan(Math.tan(c)*e.camera.frustum.aspectRatio),m=s.subtract(t.positionWC,l,k),p=s.magnitude(m),_=p*Math.tan(h),g=p*Math.tan(c),v=new s(-_,-g,0),y=new s(_,-g,0),b=new s(_,g,0),w=new s(-_,g,0),O=P.eastNorthUpToFixedFrame(l,d,G),T=x.multiplyByPoint(O,v,W),E=x.multiplyByPoint(O,y,Y),A=x.multiplyByPoint(O,b,X),S=x.multiplyByPoint(O,w,Q),D=d.cartesianToCartographic(T,q),I=d.cartesianToCartographic(E,Z),M=d.cartesianToCartographic(A,K),F=d.cartesianToCartographic(S,J);I.longitude<D.longitude&&(I.longitude+=u.TWO_PI),M.longitude<F.longitude&&(M.longitude+=u.TWO_PI);var R=new C(u.convertLongitudeRange(Math.min(D.longitude,F.longitude)),Math.min(D.latitude,I.latitude),u.convertLongitudeRange(Math.max(M.longitude,I.longitude)),Math.max(M.latitude,F.latitude));return R.center=l,R},H.prototype.getContainer=function(){return this.viewer.container},H.prototype.zoomTo=function(e,t){if(!f(e))throw new h("target is required.");t=d(t,3);var a=this;return a.lastTarget=e,D().then((function(){if(e instanceof C){var i=a.scene.camera,r=i.getRectangleCameraCoordinates(e),n=m.WGS84.cartesianToCartographic(r),o=a.scene.globe.terrainProvider,s=[C.center(e)];return T(o,6,s).then((function(r){if(a.lastTarget===e){var o={longitude:n.longitude,latitude:n.latitude,height:n.height+r[0].height},s=m.WGS84.cartographicToCartesian(o);i.flyTo({duration:t,destination:s})}}))}if(f(e.entities)){if(e.isLoading&&f(e.loadingEvent)){var l=D.defer(),u=e.loadingEvent.addEventListener((function(){u(),l.resolve()}));return l.promise.then((function(){if(a.lastTarget===e)return ee(a,e,t)}))}return ee(a,e)}return f(e.readyPromise)?e.readyPromise.then((function(){f(e.boundingSphere)&&a.lastTarget===e&&te(a,e,t)})):f(e.boundingSphere)?te(a,e):void(f(e.position)?a.scene.camera.flyTo({duration:t,destination:e.position,orientation:{direction:e.direction,up:e.up}}):a.scene.camera.flyTo({duration:t,destination:e.rectangle}))})).then((function(){a.notifyRepaintRequired()}))};var $=new r;function ee(e,t,a){return j((function(){for(var i=e.dataSourceDisplay,o=t.entities.values,s=[],l=0,u=o.length;l<u;l++){var d=n.PENDING;try{d=i.getBoundingSphere(o[l],!1,$)}catch(e){}if(d===n.PENDING)return!1;d!==n.FAILED&&s.push(r.clone($))}var f=r.fromBoundingSpheres(s);return e.scene.camera.flyToBoundingSphere(f,{duration:a}),!0}),{pollInterval:100,timeout:5e3})}function te(e,t,a){var i=t.boundingSphere,n=t.modelMatrix;n&&(i=r.transform(i,n)),e.scene.camera.flyToBoundingSphere(i,{offset:new v(0,-.5,i.radius),duration:a})}function ae(e){return f(e.items)?e.items.length:1}function ie(e,t){var a=g(),i=e.scene;x.equalsEpsilon(e._lastCameraViewMatrix,i.camera.viewMatrix,1e-5)||(e._lastCameraMoveTime=a);var r=a-e._lastCameraMoveTime<1e3,o=i.globe._surface,l=!o._tileProvider.ready||o._tileLoadQueueHigh.length>0||o._tileLoadQueueMedium.length>0||o._tileLoadQueueLow.length>0||o._debug.tilesWaitingForChildren>0;r||l||e.viewer.clock.shouldAnimate||0!==e.scene.tweens.length||(e.verboseRendering&&console.log("stopping rendering @ "+g()),e.viewer.useDefaultRenderLoop=!1,e.stoppedRendering=!0),x.clone(i.camera.viewMatrix,e._lastCameraViewMatrix);var u=e.terria.selectedFeature;if(f(u)){var d;if(f(e.dataSourceDisplay)){var c=f(u.cesiumEntity)?u.cesiumEntity:u;e.dataSourceDisplay.getBoundingSphere(c,!0,$)===n.DONE&&(d=s.clone($.center))}!f(d)&&f(u.position)&&(d=u.position.getValue(e.terria.clock.currentTime)),f(d)&&(e._selectionIndicator.position=d)}e._selectionIndicator.update()}function re(e){var t=e.terria.selectedFeature;e._highlightFeature(t),f(t)&&f(t.position)?(e._selectionIndicator.position=t.position.getValue(e.terria.clock.currentTime),e._selectionIndicator.animateAppear()):e._selectionIndicator.animateDepart(),e._selectionIndicator.update()}H.prototype.captureScreenshot=function(){var e=D.defer(),t=this.scene.postRender.addEventListener((function(){t();try{var a=this.scene.canvas,i=a;if(this.terria.showSplitter){(i=document.createElement("canvas")).width=a.width,i.height=a.height;var r=i.getContext("2d");r.drawImage(a,0,0);var n=this.terria.splitPosition*a.width;r.strokeStyle=this.terria.baseMapContrastColor,r.beginPath(),r.moveTo(n,0),r.lineTo(n,a.height),r.stroke()}e.resolve(i.toDataURL("image/png"))}catch(t){e.reject(t)}}),this);return this.scene.render(this.terria.clock.currentTime),e.promise},H.prototype.notifyRepaintRequired=function(){this.verboseRendering&&!this.viewer.useDefaultRenderLoop&&console.log("starting rendering @ "+g()),this._lastCameraMoveTime=g(),this.viewer.useDefaultRenderLoop=!0},H.prototype.computePositionOnScreen=function(e,t){return E.wgs84ToWindowCoordinates(this.scene,e,t)},H.prototype.addAttribution=function(e){e&&this.scene.frameState.creditDisplay.addDefaultCredit(e)},H.prototype.removeAttribution=function(e){e&&this.scene.frameState.creditDisplay.removeDefaultCredit(e)},H.prototype.getAllAttribution=function(){return this.scene.frameState.creditDisplay._currentFrameCredits.screenCredits.values.concat(this.scene.frameState.creditDisplay._currentFrameCredits.lightboxCredits.values).map((function(e){return e.html}))},H.prototype.updateLayerOrderToKeepOnTop=function(){for(var e=this.terria.nowViewing.items,t=this.scene,a=e.length-1;a>=0;a--)e[a].imageryLayer&&e[a].keepOnTop&&t.imageryLayers.raiseToTop(e[a].imageryLayer)},H.prototype.updateLayerOrderAfterReorder=function(){},H.prototype.raise=function(e){var t=this.terria.nowViewing.items,a=t[e],i=t[e-1];if(f(i.items)||f(i.imageryLayer)){var r,n,o,s=ae(i);if(f(a.items))for(r=a.items.length-1;r>=0;--r)if(o=a.items[r],f(o.imageryLayer))for(n=0;n<s;++n)this.scene.imageryLayers.raise(o.imageryLayer);if(f(a.imageryLayer))for(n=0;n<s;++n)this.scene.imageryLayers.raise(a.imageryLayer)}},H.prototype.lower=function(e){var t=this.terria.nowViewing.items,a=t[e],i=t[e+1];if(f(i.items)||f(i.imageryLayer)){var r,n,o,s=ae(i);if(f(a.items))for(r=0;r<a.items.length;++r)if(o=a.items[r],f(o.imageryLayer))for(n=0;n<s;++n)this.scene.imageryLayers.lower(o.imageryLayer);if(f(a.imageryLayer))for(n=0;n<s;++n)this.scene.imageryLayers.lower(a.imageryLayer)}},H.prototype.lowerToBottom=function(e){if(f(e.items))for(var t=e.items.length-1;t>=0;--t){var a=e.items[t];this.lowerToBottom(a)}f(e._imageryLayer)&&this.terria.cesium.scene.imageryLayers.lowerToBottom(e._imageryLayer)},H.prototype.adjustDisclaimer=function(){},H.prototype.pickFromLocation=function(e,t,a,i){var r=this.scene.globe.ellipsoid.cartographicToCartesian(l.fromDegrees(e.lng,e.lat,e.height)),n=m.WGS84.cartesianToCartographic(r),o=[],s=[];if(this.terria.allowFeatureInfoRequests)for(var u=this.scene.imageryLayers.length-1;u>=0;u--){var d=this.scene.imageryLayers.get(u),c=d._imageryProvider;if(c.url&&t[c.url]){var h=t[c.url];o.push(c.pickFeatures(h.x,h.y,h.level,n.longitude,n.latitude)),s.push(d)}}var p=this._buildPickedFeatures(t,r,a,o,s,n.height,i),_=this.terria.mapInteractionModeStack;f(_)&&_.length>0?_[_.length-1].pickedFeatures=p:this.terria.pickedFeatures=p},H.prototype.pickFromScreenPosition=function(e,t){var a=this.scene.camera.getPickRay(e),i=this.scene.globe.pick(a,this.scene),r=m.WGS84.cartesianToCartographic(i),n=this.pickVectorFeatures(e),o=this._attachProviderCoordHooks(),s=this.terria.allowFeatureInfoRequests?this.scene.imageryLayers.pickImageryLayerFeatures(a,this.scene):Promise.resolve(),l=this._buildPickedFeatures(o,i,n,[s],void 0,r.height,t),u=this.terria.mapInteractionModeStack;f(u)&&u.length>0?u[u.length-1].pickedFeatures=l:this.terria.pickedFeatures=l},H.prototype.pickVectorFeatures=function(e){for(var t=[],a=this.scene.drillPick(e),r=0;r<a.length;++r){var n=a[r],o=n.id;if(!(o&&o.entityCollection&&o.entityCollection.owner&&o.entityCollection.owner.name===N._featureHighlightName))if(!f(o)&&f(n.primitive)&&(o=n.primitive.id),o instanceof p&&-1===t.indexOf(o)){var s=R.fromEntityCollectionOrEntity(o);t.push(s)}else if(n.primitive&&n.primitive._catalogItem&&n.primitive._catalogItem.getFeaturesFromPickResult){var l=n.primitive._catalogItem.getFeaturesFromPickResult(e,n);l&&(Array.isArray(l)?t.push.apply(t,i(l)):t.push(l))}}return t},H.prototype._attachProviderCoordHooks=function(){for(var e={},t=function(t,a,i,r,n,o,s){var l=a.call(t,i,r,n,o,s);return t.url&&(e[t.url]={x:i,y:r,level:n}),t.pickFeatures=a,l},a=0;a<this.scene.imageryLayers.length;a++){var i=this.scene.imageryLayers.get(a).imageryProvider;i.pickFeatures=t.bind(void 0,i,i.pickFeatures)}return e},H.prototype._buildPickedFeatures=function(e,t,a,i,r,n,o){o=d(o,!1);var s=new U;return s.providerCoords=e,s.pickPosition=t,s.allFeaturesAvailablePromise=D.all(i).then(function(e){s.isLoading=!1,s.features=e.reduce(function(e,a,i){if(!f(a))return e;var l=a.map(function(e){return f(r)&&(e.imageryLayer=r[i]),f(e.position)||(e.position=m.WGS84.cartesianToCartographic(t)),f(e.position.height)&&0!==e.position.height||(e.position.height=n),this._createFeatureFromImageryLayerFeature(e)}.bind(this));if(this.terria.showSplitter&&!o){var u=this.computePositionOnScreen(s.pickPosition),d=this.terria.getSplitterSideForScreenPosition(u);l=l.filter((function(e){var t=e.imageryLayer.splitDirection;return t===d||t===M.NONE}))}return e.concat(l)}.bind(this),d(a,[]))}.bind(this)).otherwise((function(){s.isLoading=!1,s.error="An unknown error occurred while picking features."})),s},H.prototype.addImageryProvider=function(e){var t=this.scene,a=e.imageryProvider.errorEvent;f(a)&&a.addEventListener(e.onLoadError);var i=new y(e.imageryProvider,{show:!1,alpha:e.opacity,rectangle:e.clipToRectangle?e.rectangle:void 0,isRequired:e.isRequiredForRendering});return t.imageryLayers.add(i,e.layerIndex),this.updateLayerOrderToKeepOnTop(),i},H.prototype.removeImageryLayer=function(e){this.scene.imageryLayers.remove(e.layer)},H.prototype.showImageryLayer=function(e){e.layer.show=!0},H.prototype.hideImageryLayer=function(e){e.layer.show=!1},H.prototype.isImageryLayerShown=function(e){return e.layer.show},H.prototype.updateItemForSplitter=function(e){f(e.splitDirection)&&f(e.imageryLayer)&&(e.terria.showSplitter?e.imageryLayer.splitDirection=e.splitDirection:e.imageryLayer.splitDirection=M.NONE,e._nextLayer&&(e._nextLayer.splitDirection=e.imageryLayer.splitDirection),this.notifyRepaintRequired())},H.prototype.pauseMapInteraction=function(){++this._pauseMapInteractionCount,1===this._pauseMapInteractionCount&&(this.scene.screenSpaceCameraController.enableInputs=!1)},H.prototype.resumeMapInteraction=function(){var e=this;--this._pauseMapInteractionCount,0===this._pauseMapInteractionCount&&setTimeout((function(){0===e._pauseMapInteractionCount&&(e.scene.screenSpaceCameraController.enableInputs=!0)}),0)},e.exports=H},750:function(e,t,a){"use strict";a.r(t);a(119);var i=a(13),r=a(390),n=a(9),o=a(8),s=a(10),l=a(20),u=a(11),d=a(29),f=a(72),c=a(198),h=a(400),m=a(272),p=a(761),_=a(744);var g=function(e){e=Object(n.default)(e,n.default.EMPTY_OBJECT);var t=Object(n.default)(e.style,_.default.AERIAL);return new p.default({assetId:t})},v=a(35),y=a(32),b=a(348),w=a(26),O=a(134),x=a(160),C=a(130),T=a(31),E=a(41),A=a(61),S=a(63),P="uniform vec4 u_initialColor;\n\n#if TEXTURE_UNITS > 0\nuniform sampler2D u_dayTextures[TEXTURE_UNITS];\nuniform vec4 u_dayTextureTranslationAndScale[TEXTURE_UNITS];\nuniform bool u_dayTextureUseWebMercatorT[TEXTURE_UNITS];\n\n#ifdef APPLY_ALPHA\nuniform float u_dayTextureAlpha[TEXTURE_UNITS];\n#endif\n\n#ifdef APPLY_SPLIT\nuniform float u_dayTextureSplit[TEXTURE_UNITS];\n#endif\n\n#ifdef APPLY_BRIGHTNESS\nuniform float u_dayTextureBrightness[TEXTURE_UNITS];\n#endif\n\n#ifdef APPLY_CONTRAST\nuniform float u_dayTextureContrast[TEXTURE_UNITS];\n#endif\n\n#ifdef APPLY_HUE\nuniform float u_dayTextureHue[TEXTURE_UNITS];\n#endif\n\n#ifdef APPLY_SATURATION\nuniform float u_dayTextureSaturation[TEXTURE_UNITS];\n#endif\n\n#ifdef APPLY_GAMMA\nuniform float u_dayTextureOneOverGamma[TEXTURE_UNITS];\n#endif\n\n#ifdef APPLY_IMAGERY_CUTOUT\nuniform vec4 u_dayTextureCutoutRectangles[TEXTURE_UNITS];\n#endif\n\n#ifdef APPLY_COLOR_TO_ALPHA\nuniform vec4 u_colorsToAlpha[TEXTURE_UNITS];\n#endif\n\nuniform vec4 u_dayTextureTexCoordsRectangle[TEXTURE_UNITS];\n#endif\n\n#ifdef SHOW_REFLECTIVE_OCEAN\nuniform sampler2D u_waterMask;\nuniform vec4 u_waterMaskTranslationAndScale;\nuniform float u_zoomedOutOceanSpecularIntensity;\n#endif\n\n#ifdef SHOW_OCEAN_WAVES\nuniform sampler2D u_oceanNormalMap;\n#endif\n\n#if defined(ENABLE_DAYNIGHT_SHADING) || defined(GROUND_ATMOSPHERE)\nuniform vec2 u_lightingFadeDistance;\n#endif\n\n#ifdef TILE_LIMIT_RECTANGLE\nuniform vec4 u_cartographicLimitRectangle;\n#endif\n\n#ifdef GROUND_ATMOSPHERE\nuniform vec2 u_nightFadeDistance;\n#endif\n\n#ifdef ENABLE_CLIPPING_PLANES\nuniform sampler2D u_clippingPlanes;\nuniform mat4 u_clippingPlanesMatrix;\nuniform vec4 u_clippingPlanesEdgeStyle;\n#endif\n\n#ifdef SPLIT_TERRAIN\nuniform float u_terrainSplitDirection;\n#endif\n\n#if defined(FOG) && defined(DYNAMIC_ATMOSPHERE_LIGHTING) && (defined(ENABLE_VERTEX_LIGHTING) || defined(ENABLE_DAYNIGHT_SHADING))\nuniform float u_minimumBrightness;\n#endif\n\n#ifdef COLOR_CORRECT\nuniform vec3 u_hsbShift; // Hue, saturation, brightness\n#endif\n\n#ifdef HIGHLIGHT_FILL_TILE\nuniform vec4 u_fillHighlightColor;\n#endif\n\nvarying vec3 v_positionMC;\nvarying vec3 v_positionEC;\nvarying vec3 v_textureCoordinates;\nvarying vec3 v_normalMC;\nvarying vec3 v_normalEC;\n\n#ifdef APPLY_MATERIAL\nvarying float v_height;\nvarying float v_slope;\nvarying float v_aspect;\n#endif\n\n#if defined(FOG) || defined(GROUND_ATMOSPHERE)\nvarying float v_distance;\nvarying vec3 v_fogRayleighColor;\nvarying vec3 v_fogMieColor;\n#endif\n\n#ifdef GROUND_ATMOSPHERE\nvarying vec3 v_rayleighColor;\nvarying vec3 v_mieColor;\n#endif\n\nvec4 sampleAndBlend(\n    vec4 previousColor,\n    sampler2D textureToSample,\n    vec2 tileTextureCoordinates,\n    vec4 textureCoordinateRectangle,\n    vec4 textureCoordinateTranslationAndScale,\n    float textureAlpha,\n    float textureBrightness,\n    float textureContrast,\n    float textureHue,\n    float textureSaturation,\n    float textureOneOverGamma,\n    float split,\n    vec4 colorToAlpha)\n{\n    // This crazy step stuff sets the alpha to 0.0 if this following condition is true:\n    //    tileTextureCoordinates.s < textureCoordinateRectangle.s ||\n    //    tileTextureCoordinates.s > textureCoordinateRectangle.p ||\n    //    tileTextureCoordinates.t < textureCoordinateRectangle.t ||\n    //    tileTextureCoordinates.t > textureCoordinateRectangle.q\n    // In other words, the alpha is zero if the fragment is outside the rectangle\n    // covered by this texture.  Would an actual 'if' yield better performance?\n    vec2 alphaMultiplier = step(textureCoordinateRectangle.st, tileTextureCoordinates);\n    textureAlpha = textureAlpha * alphaMultiplier.x * alphaMultiplier.y;\n\n    alphaMultiplier = step(vec2(0.0), textureCoordinateRectangle.pq - tileTextureCoordinates);\n    textureAlpha = textureAlpha * alphaMultiplier.x * alphaMultiplier.y;\n\n    vec2 translation = textureCoordinateTranslationAndScale.xy;\n    vec2 scale = textureCoordinateTranslationAndScale.zw;\n    vec2 textureCoordinates = tileTextureCoordinates * scale + translation;\n    vec4 value = texture2D(textureToSample, textureCoordinates);\n    vec3 color = value.rgb;\n    float alpha = value.a;\n\n#ifdef APPLY_COLOR_TO_ALPHA\n    vec3 colorDiff = abs(color.rgb - colorToAlpha.rgb);\n    colorDiff.r = max(max(colorDiff.r, colorDiff.g), colorDiff.b);\n    alpha = czm_branchFreeTernary(colorDiff.r < colorToAlpha.a, 0.0, alpha);\n#endif\n\n#if !defined(APPLY_GAMMA)\n    vec4 tempColor = czm_gammaCorrect(vec4(color, alpha));\n    color = tempColor.rgb;\n    alpha = tempColor.a;\n#else\n    color = pow(color, vec3(textureOneOverGamma));\n#endif\n\n#ifdef APPLY_SPLIT\n    float splitPosition = czm_imagerySplitPosition;\n    // Split to the left\n    if (split < 0.0 && gl_FragCoord.x > splitPosition) {\n       alpha = 0.0;\n    }\n    // Split to the right\n    else if (split > 0.0 && gl_FragCoord.x < splitPosition) {\n       alpha = 0.0;\n    }\n#endif\n\n#ifdef APPLY_BRIGHTNESS\n    color = mix(vec3(0.0), color, textureBrightness);\n#endif\n\n#ifdef APPLY_CONTRAST\n    color = mix(vec3(0.5), color, textureContrast);\n#endif\n\n#ifdef APPLY_HUE\n    color = czm_hue(color, textureHue);\n#endif\n\n#ifdef APPLY_SATURATION\n    color = czm_saturation(color, textureSaturation);\n#endif\n\n    float sourceAlpha = alpha * textureAlpha;\n    float outAlpha = mix(previousColor.a, 1.0, sourceAlpha);\n    outAlpha += sign(outAlpha) - 1.0;\n\n    vec3 outColor = mix(previousColor.rgb * previousColor.a, color, sourceAlpha) / outAlpha;\n\n    // When rendering imagery for a tile in multiple passes,\n    // some GPU/WebGL implementation combinations will not blend fragments in\n    // additional passes correctly if their computation includes an unmasked\n    // divide-by-zero operation,\n    // even if it's not in the output or if the output has alpha zero.\n    //\n    // For example, without sanitization for outAlpha,\n    // this renders without artifacts:\n    //   if (outAlpha == 0.0) { outColor = vec3(0.0); }\n    //\n    // but using czm_branchFreeTernary will cause portions of the tile that are\n    // alpha-zero in the additional pass to render as black instead of blending\n    // with the previous pass:\n    //   outColor = czm_branchFreeTernary(outAlpha == 0.0, vec3(0.0), outColor);\n    //\n    // So instead, sanitize against divide-by-zero,\n    // store this state on the sign of outAlpha, and correct on return.\n\n    return vec4(outColor, max(outAlpha, 0.0));\n}\n\nvec3 colorCorrect(vec3 rgb) {\n#ifdef COLOR_CORRECT\n    // Convert rgb color to hsb\n    vec3 hsb = czm_RGBToHSB(rgb);\n    // Perform hsb shift\n    hsb.x += u_hsbShift.x; // hue\n    hsb.y = clamp(hsb.y + u_hsbShift.y, 0.0, 1.0); // saturation\n    hsb.z = hsb.z > czm_epsilon7 ? hsb.z + u_hsbShift.z : 0.0; // brightness\n    // Convert shifted hsb back to rgb\n    rgb = czm_HSBToRGB(hsb);\n#endif\n    return rgb;\n}\n\nvec4 computeDayColor(vec4 initialColor, vec3 textureCoordinates);\nvec4 computeWaterColor(vec3 positionEyeCoordinates, vec2 textureCoordinates, mat3 enuToEye, vec4 imageryColor, float specularMapValue, float fade);\n\nvoid main()\n{\n#ifdef TILE_LIMIT_RECTANGLE\n    if (v_textureCoordinates.x < u_cartographicLimitRectangle.x || u_cartographicLimitRectangle.z < v_textureCoordinates.x ||\n        v_textureCoordinates.y < u_cartographicLimitRectangle.y || u_cartographicLimitRectangle.w < v_textureCoordinates.y)\n        {\n            discard;\n        }\n#endif\n\n#ifdef SPLIT_TERRAIN\n    float splitPosition = czm_imagerySplitPosition;\n    if (u_terrainSplitDirection < 0.0 && gl_FragCoord.x > splitPosition) {\n        discard;\n    } else if (u_terrainSplitDirection > 0.0 && gl_FragCoord.x < splitPosition) {\n        discard;\n    }\n#endif\n\n#ifdef ENABLE_CLIPPING_PLANES\n    float clipDistance = clip(gl_FragCoord, u_clippingPlanes, u_clippingPlanesMatrix);\n#endif\n\n    // The clamp below works around an apparent bug in Chrome Canary v23.0.1241.0\n    // where the fragment shader sees textures coordinates < 0.0 and > 1.0 for the\n    // fragments on the edges of tiles even though the vertex shader is outputting\n    // coordinates strictly in the 0-1 range.\n    vec4 color = computeDayColor(u_initialColor, clamp(v_textureCoordinates, 0.0, 1.0));\n\n#ifdef SHOW_TILE_BOUNDARIES\n    if (v_textureCoordinates.x < (1.0/256.0) || v_textureCoordinates.x > (255.0/256.0) ||\n        v_textureCoordinates.y < (1.0/256.0) || v_textureCoordinates.y > (255.0/256.0))\n    {\n        color = vec4(1.0, 0.0, 0.0, 1.0);\n    }\n#endif\n\n#if defined(SHOW_REFLECTIVE_OCEAN) || defined(ENABLE_DAYNIGHT_SHADING) || defined(HDR)\n    vec3 normalMC = czm_geodeticSurfaceNormal(v_positionMC, vec3(0.0), vec3(1.0));   // normalized surface normal in model coordinates\n    vec3 normalEC = czm_normal3D * normalMC;                                         // normalized surface normal in eye coordiantes\n#endif\n\n#if defined(ENABLE_DAYNIGHT_SHADING) || defined(GROUND_ATMOSPHERE)\n    float cameraDist;\n    if (czm_sceneMode == czm_sceneMode2D)\n    {\n        cameraDist = max(czm_frustumPlanes.x - czm_frustumPlanes.y, czm_frustumPlanes.w - czm_frustumPlanes.z) * 0.5;\n    }\n    else if (czm_sceneMode == czm_sceneModeColumbusView)\n    {\n        cameraDist = -czm_view[3].z;\n    }\n    else\n    {\n        cameraDist = length(czm_view[3]);\n    }\n    float fadeOutDist = u_lightingFadeDistance.x;\n    float fadeInDist = u_lightingFadeDistance.y;\n    if (czm_sceneMode != czm_sceneMode3D) {\n        vec3 radii = czm_ellipsoidRadii;\n        float maxRadii = max(radii.x, max(radii.y, radii.z));\n        fadeOutDist -= maxRadii;\n        fadeInDist -= maxRadii;\n    }\n    float fade = clamp((cameraDist - fadeOutDist) / (fadeInDist - fadeOutDist), 0.0, 1.0);\n#else\n    float fade = 0.0;\n#endif\n\n#ifdef SHOW_REFLECTIVE_OCEAN\n    vec2 waterMaskTranslation = u_waterMaskTranslationAndScale.xy;\n    vec2 waterMaskScale = u_waterMaskTranslationAndScale.zw;\n    vec2 waterMaskTextureCoordinates = v_textureCoordinates.xy * waterMaskScale + waterMaskTranslation;\n    waterMaskTextureCoordinates.y = 1.0 - waterMaskTextureCoordinates.y;\n\n    float mask = texture2D(u_waterMask, waterMaskTextureCoordinates).r;\n\n    if (mask > 0.0)\n    {\n        mat3 enuToEye = czm_eastNorthUpToEyeCoordinates(v_positionMC, normalEC);\n\n        vec2 ellipsoidTextureCoordinates = czm_ellipsoidWgs84TextureCoordinates(normalMC);\n        vec2 ellipsoidFlippedTextureCoordinates = czm_ellipsoidWgs84TextureCoordinates(normalMC.zyx);\n\n        vec2 textureCoordinates = mix(ellipsoidTextureCoordinates, ellipsoidFlippedTextureCoordinates, czm_morphTime * smoothstep(0.9, 0.95, normalMC.z));\n\n        color = computeWaterColor(v_positionEC, textureCoordinates, enuToEye, color, mask, fade);\n    }\n#endif\n\n#ifdef APPLY_MATERIAL\n    czm_materialInput materialInput;\n    materialInput.st = v_textureCoordinates.st;\n    materialInput.normalEC = normalize(v_normalEC);\n    materialInput.slope = v_slope;\n    materialInput.height = v_height;\n    materialInput.aspect = v_aspect;\n    czm_material material = czm_getMaterial(materialInput);\n    color.xyz = mix(color.xyz, material.diffuse, material.alpha);\n#endif\n\n#ifdef ENABLE_VERTEX_LIGHTING\n    float diffuseIntensity = clamp(czm_getLambertDiffuse(czm_lightDirectionEC, normalize(v_normalEC)) * 0.9 + 0.3, 0.0, 1.0);\n    vec4 finalColor = vec4(color.rgb * czm_lightColor * diffuseIntensity, color.a);\n#elif defined(ENABLE_DAYNIGHT_SHADING)\n    float diffuseIntensity = clamp(czm_getLambertDiffuse(czm_lightDirectionEC, normalEC) * 5.0 + 0.3, 0.0, 1.0);\n    diffuseIntensity = mix(1.0, diffuseIntensity, fade);\n    vec4 finalColor = vec4(color.rgb * czm_lightColor * diffuseIntensity, color.a);\n#else\n    vec4 finalColor = color;\n#endif\n\n#ifdef ENABLE_CLIPPING_PLANES\n    vec4 clippingPlanesEdgeColor = vec4(1.0);\n    clippingPlanesEdgeColor.rgb = u_clippingPlanesEdgeStyle.rgb;\n    float clippingPlanesEdgeWidth = u_clippingPlanesEdgeStyle.a;\n\n    if (clipDistance < clippingPlanesEdgeWidth)\n    {\n        finalColor = clippingPlanesEdgeColor;\n    }\n#endif\n\n#ifdef HIGHLIGHT_FILL_TILE\n    finalColor = vec4(mix(finalColor.rgb, u_fillHighlightColor.rgb, u_fillHighlightColor.a), finalColor.a);\n#endif\n\n#if defined(FOG) || defined(GROUND_ATMOSPHERE)\n    vec3 fogColor = colorCorrect(v_fogMieColor) + finalColor.rgb * colorCorrect(v_fogRayleighColor);\n#ifndef HDR\n    const float fExposure = 2.0;\n    fogColor = vec3(1.0) - exp(-fExposure * fogColor);\n#endif\n#endif\n\n#if defined(DYNAMIC_ATMOSPHERE_LIGHTING_FROM_SUN)\n    vec3 atmosphereLightDirection = czm_sunDirectionWC;\n#else\n    vec3 atmosphereLightDirection = czm_lightDirectionWC;\n#endif\n\n#ifdef FOG\n#if defined(DYNAMIC_ATMOSPHERE_LIGHTING) && (defined(ENABLE_VERTEX_LIGHTING) || defined(ENABLE_DAYNIGHT_SHADING))\n    float darken = clamp(dot(normalize(czm_viewerPositionWC), atmosphereLightDirection), u_minimumBrightness, 1.0);\n    fogColor *= darken;\n#endif\n\n#ifdef HDR\n    const float modifier = 0.15;\n    finalColor = vec4(czm_fog(v_distance, finalColor.rgb, fogColor, modifier), finalColor.a);\n#else\n    finalColor = vec4(czm_fog(v_distance, finalColor.rgb, fogColor), finalColor.a);\n#endif\n#endif\n\n#ifdef GROUND_ATMOSPHERE\n    if (czm_sceneMode != czm_sceneMode3D)\n    {\n        gl_FragColor = finalColor;\n        return;\n    }\n\n#if defined(PER_FRAGMENT_GROUND_ATMOSPHERE) && defined(DYNAMIC_ATMOSPHERE_LIGHTING) && (defined(ENABLE_DAYNIGHT_SHADING) || defined(ENABLE_VERTEX_LIGHTING))\n    float mpp = czm_metersPerPixel(vec4(0.0, 0.0, -czm_currentFrustum.x, 1.0), 1.0);\n    vec2 xy = gl_FragCoord.xy / czm_viewport.zw * 2.0 - vec2(1.0);\n    xy *= czm_viewport.zw * mpp * 0.5;\n\n    vec3 direction = normalize(vec3(xy, -czm_currentFrustum.x));\n    czm_ray ray = czm_ray(vec3(0.0), direction);\n\n    vec3 ellipsoid_center = czm_view[3].xyz;\n\n    czm_raySegment intersection = czm_rayEllipsoidIntersectionInterval(ray, ellipsoid_center, czm_ellipsoidInverseRadii);\n\n    vec3 ellipsoidPosition = czm_pointAlongRay(ray, intersection.start);\n    ellipsoidPosition = (czm_inverseView * vec4(ellipsoidPosition, 1.0)).xyz;\n    AtmosphereColor atmosColor = computeGroundAtmosphereFromSpace(ellipsoidPosition, true, atmosphereLightDirection);\n\n    vec3 groundAtmosphereColor = colorCorrect(atmosColor.mie) + finalColor.rgb * colorCorrect(atmosColor.rayleigh);\n#ifndef HDR\n    groundAtmosphereColor = vec3(1.0) - exp(-fExposure * groundAtmosphereColor);\n#endif\n\n    fadeInDist = u_nightFadeDistance.x;\n    fadeOutDist = u_nightFadeDistance.y;\n\n    float sunlitAtmosphereIntensity = clamp((cameraDist - fadeOutDist) / (fadeInDist - fadeOutDist), 0.0, 1.0);\n\n#ifdef HDR\n    // Some tweaking to make HDR look better\n    sunlitAtmosphereIntensity = max(sunlitAtmosphereIntensity * sunlitAtmosphereIntensity, 0.03);\n#endif\n\n    groundAtmosphereColor = mix(groundAtmosphereColor, fogColor, sunlitAtmosphereIntensity);\n#else\n    vec3 groundAtmosphereColor = fogColor;\n#endif\n\n#ifdef HDR\n    // Some tweaking to make HDR look better\n    groundAtmosphereColor = czm_saturation(groundAtmosphereColor, 1.6);\n#endif\n\n    finalColor = vec4(mix(finalColor.rgb, groundAtmosphereColor, fade), finalColor.a);\n#endif\n\n    gl_FragColor = finalColor;\n}\n\n#ifdef SHOW_REFLECTIVE_OCEAN\n\nfloat waveFade(float edge0, float edge1, float x)\n{\n    float y = clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);\n    return pow(1.0 - y, 5.0);\n}\n\nfloat linearFade(float edge0, float edge1, float x)\n{\n    return clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);\n}\n\n// Based on water rendering by Jonas Wagner:\n// http://29a.ch/2012/7/19/webgl-terrain-rendering-water-fog\n\n// low altitude wave settings\nconst float oceanFrequencyLowAltitude = 825000.0;\nconst float oceanAnimationSpeedLowAltitude = 0.004;\nconst float oceanOneOverAmplitudeLowAltitude = 1.0 / 2.0;\nconst float oceanSpecularIntensity = 0.5;\n\n// high altitude wave settings\nconst float oceanFrequencyHighAltitude = 125000.0;\nconst float oceanAnimationSpeedHighAltitude = 0.008;\nconst float oceanOneOverAmplitudeHighAltitude = 1.0 / 2.0;\n\nvec4 computeWaterColor(vec3 positionEyeCoordinates, vec2 textureCoordinates, mat3 enuToEye, vec4 imageryColor, float maskValue, float fade)\n{\n    vec3 positionToEyeEC = -positionEyeCoordinates;\n    float positionToEyeECLength = length(positionToEyeEC);\n\n    // The double normalize below works around a bug in Firefox on Android devices.\n    vec3 normalizedPositionToEyeEC = normalize(normalize(positionToEyeEC));\n\n    // Fade out the waves as the camera moves far from the surface.\n    float waveIntensity = waveFade(70000.0, 1000000.0, positionToEyeECLength);\n\n#ifdef SHOW_OCEAN_WAVES\n    // high altitude waves\n    float time = czm_frameNumber * oceanAnimationSpeedHighAltitude;\n    vec4 noise = czm_getWaterNoise(u_oceanNormalMap, textureCoordinates * oceanFrequencyHighAltitude, time, 0.0);\n    vec3 normalTangentSpaceHighAltitude = vec3(noise.xy, noise.z * oceanOneOverAmplitudeHighAltitude);\n\n    // low altitude waves\n    time = czm_frameNumber * oceanAnimationSpeedLowAltitude;\n    noise = czm_getWaterNoise(u_oceanNormalMap, textureCoordinates * oceanFrequencyLowAltitude, time, 0.0);\n    vec3 normalTangentSpaceLowAltitude = vec3(noise.xy, noise.z * oceanOneOverAmplitudeLowAltitude);\n\n    // blend the 2 wave layers based on distance to surface\n    float highAltitudeFade = linearFade(0.0, 60000.0, positionToEyeECLength);\n    float lowAltitudeFade = 1.0 - linearFade(20000.0, 60000.0, positionToEyeECLength);\n    vec3 normalTangentSpace =\n        (highAltitudeFade * normalTangentSpaceHighAltitude) +\n        (lowAltitudeFade * normalTangentSpaceLowAltitude);\n    normalTangentSpace = normalize(normalTangentSpace);\n\n    // fade out the normal perturbation as we move farther from the water surface\n    normalTangentSpace.xy *= waveIntensity;\n    normalTangentSpace = normalize(normalTangentSpace);\n#else\n    vec3 normalTangentSpace = vec3(0.0, 0.0, 1.0);\n#endif\n\n    vec3 normalEC = enuToEye * normalTangentSpace;\n\n    const vec3 waveHighlightColor = vec3(0.3, 0.45, 0.6);\n\n    // Use diffuse light to highlight the waves\n    float diffuseIntensity = czm_getLambertDiffuse(czm_lightDirectionEC, normalEC) * maskValue;\n    vec3 diffuseHighlight = waveHighlightColor * diffuseIntensity * (1.0 - fade);\n\n#ifdef SHOW_OCEAN_WAVES\n    // Where diffuse light is low or non-existent, use wave highlights based solely on\n    // the wave bumpiness and no particular light direction.\n    float tsPerturbationRatio = normalTangentSpace.z;\n    vec3 nonDiffuseHighlight = mix(waveHighlightColor * 5.0 * (1.0 - tsPerturbationRatio), vec3(0.0), diffuseIntensity);\n#else\n    vec3 nonDiffuseHighlight = vec3(0.0);\n#endif\n\n    // Add specular highlights in 3D, and in all modes when zoomed in.\n    float specularIntensity = czm_getSpecular(czm_lightDirectionEC, normalizedPositionToEyeEC, normalEC, 10.0);\n    float surfaceReflectance = mix(0.0, mix(u_zoomedOutOceanSpecularIntensity, oceanSpecularIntensity, waveIntensity), maskValue);\n    float specular = specularIntensity * surfaceReflectance;\n\n#ifdef HDR\n    specular *= 1.4;\n\n    float e = 0.2;\n    float d = 3.3;\n    float c = 1.7;\n\n    vec3 color = imageryColor.rgb + (c * (vec3(e) + imageryColor.rgb * d) * (diffuseHighlight + nonDiffuseHighlight + specular));\n#else\n    vec3 color = imageryColor.rgb + diffuseHighlight + nonDiffuseHighlight + specular;\n#endif\n\n    return vec4(color, imageryColor.a);\n}\n\n#endif // #ifdef SHOW_REFLECTIVE_OCEAN\n",D="#ifdef QUANTIZATION_BITS12\nattribute vec4 compressed0;\nattribute float compressed1;\n#else\nattribute vec4 position3DAndHeight;\nattribute vec4 textureCoordAndEncodedNormals;\n#endif\n\nuniform vec3 u_center3D;\nuniform mat4 u_modifiedModelView;\nuniform mat4 u_modifiedModelViewProjection;\nuniform vec4 u_tileRectangle;\n\n// Uniforms for 2D Mercator projection\nuniform vec2 u_southAndNorthLatitude;\nuniform vec2 u_southMercatorYAndOneOverHeight;\n\nvarying vec3 v_positionMC;\nvarying vec3 v_positionEC;\n\nvarying vec3 v_textureCoordinates;\nvarying vec3 v_normalMC;\nvarying vec3 v_normalEC;\n\n#ifdef APPLY_MATERIAL\nvarying float v_slope;\nvarying float v_aspect;\nvarying float v_height;\n#endif\n\n#if defined(FOG) || defined(GROUND_ATMOSPHERE)\nvarying float v_distance;\nvarying vec3 v_fogMieColor;\nvarying vec3 v_fogRayleighColor;\n#endif\n\n// These functions are generated at runtime.\nvec4 getPosition(vec3 position, float height, vec2 textureCoordinates);\nfloat get2DYPositionFraction(vec2 textureCoordinates);\n\nvec4 getPosition3DMode(vec3 position, float height, vec2 textureCoordinates)\n{\n    return u_modifiedModelViewProjection * vec4(position, 1.0);\n}\n\nfloat get2DMercatorYPositionFraction(vec2 textureCoordinates)\n{\n    // The width of a tile at level 11, in radians and assuming a single root tile, is\n    //   2.0 * czm_pi / pow(2.0, 11.0)\n    // We want to just linearly interpolate the 2D position from the texture coordinates\n    // when we're at this level or higher.  The constant below is the expression\n    // above evaluated and then rounded up at the 4th significant digit.\n    const float maxTileWidth = 0.003068;\n    float positionFraction = textureCoordinates.y;\n    float southLatitude = u_southAndNorthLatitude.x;\n    float northLatitude = u_southAndNorthLatitude.y;\n    if (northLatitude - southLatitude > maxTileWidth)\n    {\n        float southMercatorY = u_southMercatorYAndOneOverHeight.x;\n        float oneOverMercatorHeight = u_southMercatorYAndOneOverHeight.y;\n\n        float currentLatitude = mix(southLatitude, northLatitude, textureCoordinates.y);\n        currentLatitude = clamp(currentLatitude, -czm_webMercatorMaxLatitude, czm_webMercatorMaxLatitude);\n        positionFraction = czm_latitudeToWebMercatorFraction(currentLatitude, southMercatorY, oneOverMercatorHeight);\n    }\n    return positionFraction;\n}\n\nfloat get2DGeographicYPositionFraction(vec2 textureCoordinates)\n{\n    return textureCoordinates.y;\n}\n\nvec4 getPositionPlanarEarth(vec3 position, float height, vec2 textureCoordinates)\n{\n    float yPositionFraction = get2DYPositionFraction(textureCoordinates);\n    vec4 rtcPosition2D = vec4(height, mix(u_tileRectangle.st, u_tileRectangle.pq, vec2(textureCoordinates.x, yPositionFraction)), 1.0);\n    return u_modifiedModelViewProjection * rtcPosition2D;\n}\n\nvec4 getPosition2DMode(vec3 position, float height, vec2 textureCoordinates)\n{\n    return getPositionPlanarEarth(position, 0.0, textureCoordinates);\n}\n\nvec4 getPositionColumbusViewMode(vec3 position, float height, vec2 textureCoordinates)\n{\n    return getPositionPlanarEarth(position, height, textureCoordinates);\n}\n\nvec4 getPositionMorphingMode(vec3 position, float height, vec2 textureCoordinates)\n{\n    // We do not do RTC while morphing, so there is potential for jitter.\n    // This is unlikely to be noticeable, though.\n    vec3 position3DWC = position + u_center3D;\n    float yPositionFraction = get2DYPositionFraction(textureCoordinates);\n    vec4 position2DWC = vec4(height, mix(u_tileRectangle.st, u_tileRectangle.pq, vec2(textureCoordinates.x, yPositionFraction)), 1.0);\n    vec4 morphPosition = czm_columbusViewMorph(position2DWC, vec4(position3DWC, 1.0), czm_morphTime);\n    return czm_modelViewProjection * morphPosition;\n}\n\n#ifdef QUANTIZATION_BITS12\nuniform vec2 u_minMaxHeight;\nuniform mat4 u_scaleAndBias;\n#endif\n\nvoid main()\n{\n#ifdef QUANTIZATION_BITS12\n    vec2 xy = czm_decompressTextureCoordinates(compressed0.x);\n    vec2 zh = czm_decompressTextureCoordinates(compressed0.y);\n    vec3 position = vec3(xy, zh.x);\n    float height = zh.y;\n    vec2 textureCoordinates = czm_decompressTextureCoordinates(compressed0.z);\n\n    height = height * (u_minMaxHeight.y - u_minMaxHeight.x) + u_minMaxHeight.x;\n    position = (u_scaleAndBias * vec4(position, 1.0)).xyz;\n\n#if (defined(ENABLE_VERTEX_LIGHTING) || defined(GENERATE_POSITION_AND_NORMAL)) && defined(INCLUDE_WEB_MERCATOR_Y)\n    float webMercatorT = czm_decompressTextureCoordinates(compressed0.w).x;\n    float encodedNormal = compressed1;\n#elif defined(INCLUDE_WEB_MERCATOR_Y)\n    float webMercatorT = czm_decompressTextureCoordinates(compressed0.w).x;\n    float encodedNormal = 0.0;\n#elif defined(ENABLE_VERTEX_LIGHTING) || defined(GENERATE_POSITION_AND_NORMAL)\n    float webMercatorT = textureCoordinates.y;\n    float encodedNormal = compressed0.w;\n#else\n    float webMercatorT = textureCoordinates.y;\n    float encodedNormal = 0.0;\n#endif\n\n#else\n    // A single float per element\n    vec3 position = position3DAndHeight.xyz;\n    float height = position3DAndHeight.w;\n    vec2 textureCoordinates = textureCoordAndEncodedNormals.xy;\n\n#if (defined(ENABLE_VERTEX_LIGHTING) || defined(GENERATE_POSITION_AND_NORMAL) || defined(APPLY_MATERIAL)) && defined(INCLUDE_WEB_MERCATOR_Y)\n    float webMercatorT = textureCoordAndEncodedNormals.z;\n    float encodedNormal = textureCoordAndEncodedNormals.w;\n#elif defined(ENABLE_VERTEX_LIGHTING) || defined(GENERATE_POSITION_AND_NORMAL) || defined(APPLY_MATERIAL)\n    float webMercatorT = textureCoordinates.y;\n    float encodedNormal = textureCoordAndEncodedNormals.z;\n#elif defined(INCLUDE_WEB_MERCATOR_Y)\n    float webMercatorT = textureCoordAndEncodedNormals.z;\n    float encodedNormal = 0.0;\n#else\n    float webMercatorT = textureCoordinates.y;\n    float encodedNormal = 0.0;\n#endif\n\n#endif\n\n    vec3 position3DWC = position + u_center3D;\n    gl_Position = getPosition(position, height, textureCoordinates);\n\n    v_textureCoordinates = vec3(textureCoordinates, webMercatorT);\n\n#if defined(ENABLE_VERTEX_LIGHTING) || defined(GENERATE_POSITION_AND_NORMAL) || defined(APPLY_MATERIAL)\n    v_positionEC = (u_modifiedModelView * vec4(position, 1.0)).xyz;\n    v_positionMC = position3DWC;  // position in model coordinates\n    vec3 normalMC = czm_octDecode(encodedNormal);\n    v_normalMC = normalMC;\n    v_normalEC = czm_normal3D * v_normalMC;\n#elif defined(SHOW_REFLECTIVE_OCEAN) || defined(ENABLE_DAYNIGHT_SHADING) || defined(GENERATE_POSITION) || defined(HDR)\n    v_positionEC = (u_modifiedModelView * vec4(position, 1.0)).xyz;\n    v_positionMC = position3DWC;  // position in model coordinates\n#endif\n\n#if defined(FOG) || defined(GROUND_ATMOSPHERE)\n    AtmosphereColor atmosFogColor = computeGroundAtmosphereFromSpace(position3DWC, false, vec3(0.0));\n    v_fogMieColor = atmosFogColor.mie;\n    v_fogRayleighColor = atmosFogColor.rayleigh;\n    v_distance = length((czm_modelView3D * vec4(position3DWC, 1.0)).xyz);\n#endif\n\n#ifdef APPLY_MATERIAL\n    float northPoleZ = czm_ellipsoidRadii.z;\n    vec3 northPolePositionMC = vec3(0.0, 0.0, northPoleZ);\n    vec3 ellipsoidNormal = normalize(v_positionMC); // For a sphere this is correct, but not generally for an ellipsoid.\n    vec3 vectorEastMC = normalize(cross(northPolePositionMC - v_positionMC, ellipsoidNormal));\n    float dotProd = abs(dot(ellipsoidNormal, v_normalMC));\n    v_slope = acos(dotProd);\n    vec3 normalRejected = ellipsoidNormal * dotProd;\n    vec3 normalProjected = v_normalMC - normalRejected;\n    vec3 aspectVector = normalize(normalProjected);\n    v_aspect = acos(dot(aspectVector, vectorEastMC));\n    float determ = dot(cross(vectorEastMC, aspectVector), ellipsoidNormal);\n    v_aspect = czm_branchFreeTernary(determ < 0.0, 2.0 * czm_pi - v_aspect, v_aspect);\n    v_height = height;\n#endif\n}\n",I="/*!\n * Atmosphere code:\n *\n * Copyright (c) 2000-2005, Sean O'Neil (s_p_oneil@hotmail.com)\n * All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions\n * are met:\n *\n * * Redistributions of source code must retain the above copyright notice,\n *   this list of conditions and the following disclaimer.\n * * Redistributions in binary form must reproduce the above copyright notice,\n *   this list of conditions and the following disclaimer in the documentation\n *   and/or other materials provided with the distribution.\n * * Neither the name of the project nor the names of its contributors may be\n *   used to endorse or promote products derived from this software without\n *   specific prior written permission.\n *\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\"\n * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE\n * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR\n * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER\n * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,\n * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n *\n * Modifications made by Analytical Graphics, Inc.\n */\n\n // Atmosphere:\n //   Code:  http://sponeil.net/\n //   GPU Gems 2 Article:  https://developer.nvidia.com/gpugems/GPUGems2/gpugems2_chapter16.html\n\nconst float fInnerRadius = 6378137.0;\nconst float fOuterRadius = 6378137.0 * 1.025;\nconst float fOuterRadius2 = fOuterRadius * fOuterRadius;\n\nconst float Kr = 0.0025;\nconst float Km = 0.0015;\nconst float ESun = 15.0;\n\nconst float fKrESun = Kr * ESun;\nconst float fKmESun = Km * ESun;\nconst float fKr4PI = Kr * 4.0 * czm_pi;\nconst float fKm4PI = Km * 4.0 * czm_pi;\n\nconst float fScale = 1.0 / (fOuterRadius - fInnerRadius);\nconst float fScaleDepth = 0.25;\nconst float fScaleOverScaleDepth = fScale / fScaleDepth;\n\nstruct AtmosphereColor\n{\n    vec3 mie;\n    vec3 rayleigh;\n};\n\nconst int nSamples = 2;\nconst float fSamples = 2.0;\n\nfloat scale(float fCos)\n{\n    float x = 1.0 - fCos;\n    return fScaleDepth * exp(-0.00287 + x*(0.459 + x*(3.83 + x*(-6.80 + x*5.25))));\n}\n\nAtmosphereColor computeGroundAtmosphereFromSpace(vec3 v3Pos, bool dynamicLighting, vec3 lightDirectionWC)\n{\n\tvec3 v3InvWavelength = vec3(1.0 / pow(0.650, 4.0), 1.0 / pow(0.570, 4.0), 1.0 / pow(0.475, 4.0));\n\n    // Get the ray from the camera to the vertex and its length (which is the far point of the ray passing through the atmosphere)\n    vec3 v3Ray = v3Pos - czm_viewerPositionWC;\n    float fFar = length(v3Ray);\n    v3Ray /= fFar;\n\n    float fCameraHeight = length(czm_viewerPositionWC);\n    float fCameraHeight2 = fCameraHeight * fCameraHeight;\n\n    // This next line is an ANGLE workaround. It is equivalent to B = 2.0 * dot(czm_viewerPositionWC, v3Ray),\n    // which is what it should be, but there are problems at the poles.\n    float B = 2.0 * length(czm_viewerPositionWC) * dot(normalize(czm_viewerPositionWC), v3Ray);\n    float C = fCameraHeight2 - fOuterRadius2;\n    float fDet = max(0.0, B*B - 4.0 * C);\n    float fNear = 0.5 * (-B - sqrt(fDet));\n\n    // Calculate the ray's starting position, then calculate its scattering offset\n    vec3 v3Start = czm_viewerPositionWC + v3Ray * fNear;\n    fFar -= fNear;\n    float fDepth = exp((fInnerRadius - fOuterRadius) / fScaleDepth);\n\n    // The light angle based on the scene's light source would be:\n    //    dot(lightDirectionWC, v3Pos) / length(v3Pos);\n    // When we want the atmosphere to be uniform over the globe so it is set to 1.0.\n\n    float fLightAngle = czm_branchFreeTernary(dynamicLighting, dot(lightDirectionWC, v3Pos) / length(v3Pos), 1.0);\n    float fCameraAngle = dot(-v3Ray, v3Pos) / length(v3Pos);\n    float fCameraScale = scale(fCameraAngle);\n    float fLightScale = scale(fLightAngle);\n    float fCameraOffset = fDepth*fCameraScale;\n    float fTemp = (fLightScale + fCameraScale);\n\n    // Initialize the scattering loop variables\n    float fSampleLength = fFar / fSamples;\n    float fScaledLength = fSampleLength * fScale;\n    vec3 v3SampleRay = v3Ray * fSampleLength;\n    vec3 v3SamplePoint = v3Start + v3SampleRay * 0.5;\n\n    // Now loop through the sample rays\n    vec3 v3FrontColor = vec3(0.0);\n    vec3 v3Attenuate = vec3(0.0);\n    for(int i=0; i<nSamples; i++)\n    {\n        float fHeight = length(v3SamplePoint);\n        float fDepth = exp(fScaleOverScaleDepth * (fInnerRadius - fHeight));\n        float fScatter = fDepth*fTemp - fCameraOffset;\n        v3Attenuate = exp(-fScatter * (v3InvWavelength * fKr4PI + fKm4PI));\n        v3FrontColor += v3Attenuate * (fDepth * fScaledLength);\n        v3SamplePoint += v3SampleRay;\n    }\n\n    AtmosphereColor color;\n    color.mie = v3FrontColor * (v3InvWavelength * fKrESun + fKmESun);\n    color.rayleigh = v3Attenuate; // Calculate the attenuation factor for the ground\n\n    return color;\n}\n\n",M=a(18),F=a(444),R=a(78),N=a(440),L=a(46);function j(e,t,a,i,r){this.numberOfDayTextures=e,this.flags=t,this.material=a,this.shaderProgram=i,this.clippingShaderState=r}function V(){this.baseVertexShaderSource=void 0,this.baseFragmentShaderSource=void 0,this._shadersByTexturesFlags=[],this.material=void 0}V.prototype.getShaderProgram=function(e){var t=e.frameState,a=e.surfaceTile,i=e.numberOfDayTextures,r=e.applyBrightness,n=e.applyContrast,s=e.applyHue,l=e.applySaturation,u=e.applyGamma,d=e.applyAlpha,f=e.applySplit,c=e.showReflectiveOcean,h=e.showOceanWaves,m=e.enableLighting,p=e.dynamicAtmosphereLighting,_=e.dynamicAtmosphereLightingFromSun,g=e.showGroundAtmosphere,v=e.perFragmentGroundAtmosphere,y=e.hasVertexNormals,b=e.useWebMercatorProjection,w=e.enableFog,O=e.enableClippingPlanes,x=e.clippingPlanes,C=e.clippedByBoundaries,T=e.splitTerrain,E=e.hasImageryLayerCutout,A=e.colorCorrect,S=e.highlightFillTile,P=e.colorToAlpha,D=0,I="",M=a.renderedMesh.encoding;M.quantization===F.a.BITS12&&(D=1,I="QUANTIZATION_BITS12");var V=0,U="";Object(o.default)(a.vertexArray)&&Object(o.default)(a.terrainData)&&!a.terrainData._createdByUpsampling||(V=1,U="DISABLE_GL_POSITION_LOG_DEPTH");var z=0,B="";C&&(z=1,B="TILE_LIMIT_RECTANGLE");var H=0,k="";E&&(H=1,k="APPLY_IMAGERY_CUTOUT");var G=t.mode,W=G|r<<2|n<<3|s<<4|l<<5|u<<6|d<<7|c<<8|h<<9|m<<10|p<<11|_<<12|g<<13|v<<14|y<<15|b<<16|w<<17|D<<18|f<<19|O<<20|V<<21|z<<22|H<<23|A<<24|S<<25|P<<26|T<<27,Y=0;Object(o.default)(x)&&x.length>0&&(Y=O?x.clippingPlanesState:0);var X=a.surfaceShader;if(Object(o.default)(X)&&X.numberOfDayTextures===i&&X.flags===W&&X.material===this.material&&X.clippingShaderState===Y)return X.shaderProgram;var Q=this._shadersByTexturesFlags[i];if(Object(o.default)(Q)||(Q=this._shadersByTexturesFlags[i]=[]),X=Q[W],!Object(o.default)(X)||X.material!==this.material||X.clippingShaderState!==Y){var q=this.baseVertexShaderSource.clone(),Z=this.baseFragmentShaderSource.clone();0!==Y&&Z.sources.unshift(Object(N.a)(x,t.context)),q.defines.push(I,U),Z.defines.push("TEXTURE_UNITS "+i,B,k),r&&Z.defines.push("APPLY_BRIGHTNESS"),n&&Z.defines.push("APPLY_CONTRAST"),s&&Z.defines.push("APPLY_HUE"),l&&Z.defines.push("APPLY_SATURATION"),u&&Z.defines.push("APPLY_GAMMA"),d&&Z.defines.push("APPLY_ALPHA"),c&&(Z.defines.push("SHOW_REFLECTIVE_OCEAN"),q.defines.push("SHOW_REFLECTIVE_OCEAN")),h&&Z.defines.push("SHOW_OCEAN_WAVES"),P&&Z.defines.push("APPLY_COLOR_TO_ALPHA"),m&&(y?(q.defines.push("ENABLE_VERTEX_LIGHTING"),Z.defines.push("ENABLE_VERTEX_LIGHTING")):(q.defines.push("ENABLE_DAYNIGHT_SHADING"),Z.defines.push("ENABLE_DAYNIGHT_SHADING"))),p&&(Z.defines.push("DYNAMIC_ATMOSPHERE_LIGHTING"),_&&Z.defines.push("DYNAMIC_ATMOSPHERE_LIGHTING_FROM_SUN")),g&&(q.defines.push("GROUND_ATMOSPHERE"),Z.defines.push("GROUND_ATMOSPHERE"),v&&Z.defines.push("PER_FRAGMENT_GROUND_ATMOSPHERE")),q.defines.push("INCLUDE_WEB_MERCATOR_Y"),Z.defines.push("INCLUDE_WEB_MERCATOR_Y"),w&&(q.defines.push("FOG"),Z.defines.push("FOG")),f&&Z.defines.push("APPLY_SPLIT"),O&&Z.defines.push("ENABLE_CLIPPING_PLANES"),T&&Z.defines.push("SPLIT_TERRAIN"),A&&Z.defines.push("COLOR_CORRECT"),S&&Z.defines.push("HIGHLIGHT_FILL_TILE");var K="    vec4 computeDayColor(vec4 initialColor, vec3 textureCoordinates)\n    {\n        vec4 color = initialColor;\n";E&&(K+="        vec4 cutoutAndColorResult;\n        bool texelUnclipped;\n");for(var J=0;J<i;++J)K+=E?"        cutoutAndColorResult = u_dayTextureCutoutRectangles["+J+"];\n        texelUnclipped = v_textureCoordinates.x < cutoutAndColorResult.x || cutoutAndColorResult.z < v_textureCoordinates.x || v_textureCoordinates.y < cutoutAndColorResult.y || cutoutAndColorResult.w < v_textureCoordinates.y;\n        cutoutAndColorResult = sampleAndBlend(\n":"        color = sampleAndBlend(\n",K+="            color,\n            u_dayTextures["+J+"],\n            u_dayTextureUseWebMercatorT["+J+"] ? textureCoordinates.xz : textureCoordinates.xy,\n            u_dayTextureTexCoordsRectangle["+J+"],\n            u_dayTextureTranslationAndScale["+J+"],\n            "+(d?"u_dayTextureAlpha["+J+"]":"1.0")+",\n            "+(r?"u_dayTextureBrightness["+J+"]":"0.0")+",\n            "+(n?"u_dayTextureContrast["+J+"]":"0.0")+",\n            "+(s?"u_dayTextureHue["+J+"]":"0.0")+",\n            "+(l?"u_dayTextureSaturation["+J+"]":"0.0")+",\n            "+(u?"u_dayTextureOneOverGamma["+J+"]":"0.0")+",\n            "+(f?"u_dayTextureSplit["+J+"]":"0.0")+",\n            "+(P?"u_colorsToAlpha["+J+"]":"vec4(0.0)")+"\n        );\n",E&&(K+="        color = czm_branchFreeTernary(texelUnclipped, cutoutAndColorResult, color);\n");K+="        return color;\n    }",Z.sources.push(K),q.sources.push(function(e){var t;switch(e){case L.a.SCENE3D:t="vec4 getPosition(vec3 position, float height, vec2 textureCoordinates) { return getPosition3DMode(position, height, textureCoordinates); }";break;case L.a.SCENE2D:case L.a.COLUMBUS_VIEW:t="vec4 getPosition(vec3 position, float height, vec2 textureCoordinates) { return getPositionColumbusViewMode(position, height, textureCoordinates); }";break;case L.a.MORPHING:t="vec4 getPosition(vec3 position, float height, vec2 textureCoordinates) { return getPositionMorphingMode(position, height, textureCoordinates); }"}return t}(G)),q.sources.push(function(e){return e?"float get2DYPositionFraction(vec2 textureCoordinates) { return get2DMercatorYPositionFraction(textureCoordinates); }":"float get2DYPositionFraction(vec2 textureCoordinates) { return get2DGeographicYPositionFraction(textureCoordinates); }"}(b));var $=R.a.fromCache({context:t.context,vertexShaderSource:q,fragmentShaderSource:Z,attributeLocations:M.getAttributeLocations()});X=Q[W]=new j(i,W,this.material,$,Y)}return a.surfaceShader=X,X.shaderProgram},V.prototype.destroy=function(){var e,t,a=this._shadersByTexturesFlags;for(var i in a)if(a.hasOwnProperty(i)){var r=a[i];if(!Object(o.default)(r))continue;for(e in r)r.hasOwnProperty(e)&&(t=r[e],Object(o.default)(t)&&t.shaderProgram.destroy())}return Object(l.default)(this)};var U=V,z=a(334),B=a(25),H=a(50),k=a(42),G=a(23),W=a(70),Y=a(57),X=a(65),Q=a(124),q=a(51),Z=a(95),K=a(15),J=a(30),$=a(120),ee=a(109),te=a(47),ae=a(443),ie=a(17),re=Object(ie.default)({NONE:-1,PARTIAL:0,FULL:1}),ne=a(161),oe=a(108),se=a(77),le=a(84),ue=a(68),de=a(69),fe=a(59),ce=a(96),he=a(85),me=a(371),pe=a(319),_e=a(62),ge=a(220),ve=a(221),ye=a(174),be=a(164),we=a(67),Oe=a(91),xe=a(92),Ce=a(86),Te=a(107),Ee=a(264),Ae=Object(ie.default)({START:0,LOADING:1,DONE:2,FAILED:3}),Se=Object(ie.default)({FAILED:0,UNLOADED:1,RECEIVING:2,RECEIVED:3,TRANSFORMING:4,TRANSFORMED:5,READY:6});function Pe(){this.imagery=[],this.waterMaskTexture=void 0,this.waterMaskTranslationAndScale=new H.a(0,0,1,1),this.terrainData=void 0,this.vertexArray=void 0,this.orientedBoundingBox=void 0,this.boundingVolumeSourceTile=void 0,this.tileBoundingRegion=void 0,this.occludeePointInScaledSpace=new i.default,this.terrainState=Se.UNLOADED,this.mesh=void 0,this.fill=void 0,this.pickBoundingSphere=new v.default,this.surfaceShader=void 0,this.isClipped=!0,this.clippedByBoundaries=!1}function De(e,t,a,r,n,s){if(e.decodePosition(r,n,s),Object(o.default)(t)&&t!==L.a.SCENE3D){var l=a.ellipsoid.cartesianToCartographic(s);a.project(l,s),i.default.fromElements(s.z,s.x,s.y,s)}return s}Object(s.default)(Pe.prototype,{eligibleForUnloading:{get:function(){for(var e=this.terrainState,t=!(e===Se.RECEIVING||e===Se.TRANSFORMING),a=this.imagery,i=0,r=a.length;t&&i<r;++i){var n=a[i];t=!Object(o.default)(n.loadingImagery)||n.loadingImagery.state!==Ee.a.TRANSITIONING}return t}},renderedMesh:{get:function(){return Object(o.default)(this.vertexArray)?this.mesh:Object(o.default)(this.fill)?this.fill.mesh:void 0}}});var Ie=new i.default,Me=new i.default,Fe=new i.default,Re=new i.default;Pe.prototype.pick=function(e,t,a,i,r){var n=this.renderedMesh;if(Object(o.default)(n)){for(var s=n.vertices,l=n.indices,u=n.encoding,d=l.length,f=Number.MAX_VALUE,c=0;c<d;c+=3){var h=l[c],m=l[c+1],p=l[c+2],_=De(u,t,a,s,h,Ie),g=De(u,t,a,s,m,Me),v=De(u,t,a,s,p,Fe),y=x.default.rayTriangleParametric(e,_,g,v,i);Object(o.default)(y)&&y<f&&y>=0&&(f=y)}return f!==Number.MAX_VALUE?C.default.getPoint(e,f,r):void 0}},Pe.prototype.pickTriangle=function(e,t,a,i){var r=this.renderedMesh;if(Object(o.default)(r))for(var n=r.vertices,s=r.indices,l=r.encoding,u=s.length,d=0;d<u;d+=3){var f=s[d],c=s[d+1],h=s[d+2],m=De(l,t,a,n,f,Ie),p=De(l,t,a,n,c,Me),_=De(l,t,a,n,h,Fe),g=x.default.rayTriangle(e,m,p,_,i,Re);if(Object(o.default)(g))return{intersection:g,v0:m,v1:p,v2:_}}},Pe.prototype.freeResources=function(){Object(o.default)(this.waterMaskTexture)&&(--this.waterMaskTexture.referenceCount,0===this.waterMaskTexture.referenceCount&&this.waterMaskTexture.destroy(),this.waterMaskTexture=void 0),this.terrainData=void 0,this.terrainState=Se.UNLOADED,this.mesh=void 0,this.fill=this.fill&&this.fill.destroy();for(var e=this.imagery,t=0,a=e.length;t<a;++t)e[t].freeResources();this.imagery.length=0,this.freeVertexArray()},Pe.prototype.freeVertexArray=function(){Pe._freeVertexArray(this.vertexArray),this.vertexArray=void 0,Pe._freeVertexArray(this.wireframeVertexArray),this.wireframeVertexArray=void 0},Pe.initialize=function(e,t,a){var i=e.data;Object(o.default)(i)||(i=e.data=new Pe),e.state===Ae.START&&(!function(e,t,a){var i=t.getTileDataAvailable(e.x,e.y,e.level);if(!Object(o.default)(i)&&Object(o.default)(e.parent)){var r=e.parent,n=r.data;Object(o.default)(n)&&Object(o.default)(n.terrainData)&&(i=n.terrainData.isChildAvailable(r.x,r.y,e.x,e.y))}!1===i&&(e.data.terrainState=Se.FAILED);for(var s=0,l=a.length;s<l;++s){var u=a.get(s);u.show&&u._createTileImagerySkeletons(e,t)}}(e,t,a),e.state=Ae.LOADING)},Pe.processStateMachine=function(e,t,a,r,n,s){Pe.initialize(e,a,r);var l=e.data;if(e.state===Ae.LOADING&&function(e,t,a,r,n){var s=e.data,l=e.parent;if(s.terrainState===Se.FAILED&&void 0!==l){void 0!==l.data&&void 0!==l.data.terrainData&&!1!==l.data.terrainData.canUpsample||Pe.processStateMachine(l,t,a,r,!0)}s.terrainState===Se.FAILED&&function(e,t,a,i,r,n,s){var l=t.parent;if(!l)return void(t.state=Ae.FAILED);var u=l.data.terrainData,d=l.x,f=l.y,c=l.level;if(!Object(o.default)(u))return;var h=u.upsample(i.tilingScheme,d,f,c,r,n,s);if(!Object(o.default)(h))return;e.terrainState=Se.RECEIVING,Object(M.default)(h,(function(t){e.terrainData=t,e.terrainState=Se.RECEIVED}),(function(){e.terrainState=Se.FAILED}))}(s,e,0,a,e.x,e.y,e.level);s.terrainState===Se.UNLOADED&&function(e,t,a,i,r){function n(t){e.terrainData=t,e.terrainState=Se.RECEIVED,e.request=void 0}function s(){if(e.request.state===ve.a.CANCELLED)return e.terrainData=void 0,e.terrainState=Se.UNLOADED,void(e.request=void 0);e.terrainState=Se.FAILED,e.request=void 0;var n="Failed to obtain terrain tile X: "+a+" Y: "+i+" Level: "+r+".";t._requestError=be.default.handleError(t._requestError,t,t.errorEvent,n,a,i,r,l)}function l(){var l=new ge.a({throttle:!1,throttleByServer:!0,type:ye.a.TERRAIN});e.request=l;var u=t.requestTileGeometry(a,i,r,l);Object(o.default)(u)?(e.terrainState=Se.RECEIVING,Object(M.default)(u,n,s)):(e.terrainState=Se.UNLOADED,e.request=void 0)}l()}(s,a,e.x,e.y,e.level);s.terrainState===Se.RECEIVED&&function(e,t,a,r,n,s){var l=a.tilingScheme,u=e.terrainData.createMesh(l,r,n,s,t.terrainExaggeration);if(!Object(o.default)(u))return;e.terrainState=Se.TRANSFORMING,Object(M.default)(u,(function(t){e.mesh=t,e.orientedBoundingBox=$.a.clone(t.orientedBoundingBox,e.orientedBoundingBox),e.occludeePointInScaledSpace=i.default.clone(t.occludeePointInScaledSpace,e.occludeePointInScaledSpace),e.terrainState=Se.TRANSFORMED}),(function(){e.terrainState=Se.FAILED}))}(s,t,a,e.x,e.y,e.level);s.terrainState===Se.TRANSFORMED&&function(e,t,a,i,r,n,o){e.vertexArray=Pe._createVertexArrayForMesh(t,e.mesh),e.terrainState=Se.READY,e.fill=e.fill&&e.fill.destroy(o)}(s,t.context,0,e.x,e.y,e.level,n);if(s.terrainState>=Se.RECEIVED&&void 0===s.waterMaskTexture&&a.hasWaterMask){if(void 0!==s.terrainData.waterMask)!function(e,t){var a,i=t.terrainData.waterMask,r=function(e){var t=e.cache.tile_waterMaskData;if(!Object(o.default)(t)){var a=S.a.create({context:e,pixelFormat:_e.a.LUMINANCE,pixelDatatype:we.a.UNSIGNED_BYTE,source:{arrayBufferView:new Uint8Array([255]),width:1,height:1}});a.referenceCount=1;var i=new Oe.a({wrapS:Te.a.CLAMP_TO_EDGE,wrapT:Te.a.CLAMP_TO_EDGE,minificationFilter:Ce.a.LINEAR,magnificationFilter:xe.a.LINEAR});t={allWaterTexture:a,sampler:i,destroy:function(){this.allWaterTexture.destroy()}},e.cache.tile_waterMaskData=t}return t}(e),n=i.length;if(1===n){if(0===i[0])return;a=r.allWaterTexture}else{var s=Math.sqrt(n);(a=S.a.create({context:e,pixelFormat:_e.a.LUMINANCE,pixelDatatype:we.a.UNSIGNED_BYTE,source:{width:s,height:s,arrayBufferView:i},sampler:r.sampler,flipY:!1})).referenceCount=0}++a.referenceCount,t.waterMaskTexture=a,H.a.fromElements(0,0,1,1,t.waterMaskTranslationAndScale)}(t.context,s);else{var u=s._findAncestorTileWithTerrainData(e);Object(o.default)(u)&&Object(o.default)(u.data.waterMaskTexture)&&(s.waterMaskTexture=u.data.waterMaskTexture,++s.waterMaskTexture.referenceCount,s._computeWaterMaskTranslationAndScale(e,u,s.waterMaskTranslationAndScale))}}}(e,t,a,r,n),!s){var u=e.renderable;e.renderable=Object(o.default)(l.vertexArray);var d=l.terrainState===Se.READY;e.upsampledFromParent=Object(o.default)(l.terrainData)&&l.terrainData.wasCreatedByUpsampling();var f=l.processImagery(e,a,t);if(d&&f){var c=e._loadedCallbacks,h={};for(var m in c)c.hasOwnProperty(m)&&(c[m](e)||(h[m]=c[m]));e._loadedCallbacks=h,e.state=Ae.DONE}u&&(e.renderable=!0)}},Pe.prototype.processImagery=function(e,t,a,i){var r,n,s=e.data,l=e.upsampledFromParent,u=!1,d=!0,f=s.imagery;for(r=0,n=f.length;r<n;++r){var c=f[r];if(Object(o.default)(c.loadingImagery)){if(c.loadingImagery.state===Ee.a.PLACEHOLDER){var h=c.loadingImagery.imageryLayer;if(h.imageryProvider.ready){c.freeResources(),f.splice(r,1),h._createTileImagerySkeletons(e,t,r),--r,n=f.length;continue}l=!1}var m=c.processStateMachine(e,a,i);d=d&&m,u=u||m||Object(o.default)(c.readyImagery),l=l&&Object(o.default)(c.loadingImagery)&&(c.loadingImagery.state===Ee.a.FAILED||c.loadingImagery.state===Ee.a.INVALID)}else l=!1}return e.upsampledFromParent=l,e.renderable=e.renderable&&(u||d),d},Pe._createVertexArrayForMesh=function(e,t){var a=t.vertices,i=oe.a.createVertexBuffer({context:e,typedArray:a,usage:se.a.STATIC_DRAW}),r=t.encoding.getAttributes(i),n=t.indices.indexBuffers||{},s=n[e.id];if(!Object(o.default)(s)||s.isDestroyed()){var l=t.indices;(s=oe.a.createIndexBuffer({context:e,typedArray:l,usage:se.a.STATIC_DRAW,indexDatatype:q.a.fromSizeInBytes(l.BYTES_PER_ELEMENT)})).vertexArrayDestroyable=!1,s.referenceCount=1,n[e.id]=s,t.indices.indexBuffers=n}else++s.referenceCount;return new ce.a({context:e,attributes:r,indexBuffer:s})},Pe._freeVertexArray=function(e){if(Object(o.default)(e)){var t=e.indexBuffer;e.destroy(),Object(o.default)(t)&&!t.isDestroyed()&&Object(o.default)(t.referenceCount)&&(--t.referenceCount,0===t.referenceCount&&t.destroy())}},Pe.prototype._findAncestorTileWithTerrainData=function(e){for(var t=e.parent;Object(o.default)(t)&&(!Object(o.default)(t.data)||!Object(o.default)(t.data.terrainData)||t.data.terrainData.wasCreatedByUpsampling());)t=t.parent;return t},Pe.prototype._computeWaterMaskTranslationAndScale=function(e,t,a){var i=t.rectangle,r=e.rectangle,n=r.width,o=r.height,s=n/i.width,l=o/i.height;return a.x=s*(r.west-i.west)/n,a.y=l*(r.south-i.south)/o,a.z=s,a.w=l,a};var Ne=Pe,Le=a(366),je=a(75),Ve=a(116),Ue=a(101),ze=a(203),Be=a(222),He=a(510),ke=a(438),Ge=a(336),We=a(445),Ye={WEST:0,NORTH:1,EAST:2,SOUTH:3,NORTHWEST:4,NORTHEAST:5,SOUTHWEST:6,SOUTHEAST:7},Xe={NONE:0,CULLED:1,RENDERED:2,REFINED:3,RENDERED_AND_KICKED:6,REFINED_AND_KICKED:7,CULLED_BUT_NEEDED:9,wasKicked:function(e){return e>=Xe.RENDERED_AND_KICKED},originalResult:function(e){return 3&e},kick:function(e){return 4|e}},Qe=Xe;function qe(e){this.tile=e,this.frameLastUpdated=void 0,this.westMeshes=[],this.westTiles=[],this.southMeshes=[],this.southTiles=[],this.eastMeshes=[],this.eastTiles=[],this.northMeshes=[],this.northTiles=[],this.southwestMesh=void 0,this.southwestTile=void 0,this.southeastMesh=void 0,this.southeastTile=void 0,this.northwestMesh=void 0,this.northwestTile=void 0,this.northeastMesh=void 0,this.northeastTile=void 0,this.changedThisFrame=!0,this.visitedFrame=void 0,this.enqueuedFrame=void 0,this.mesh=void 0,this.vertexArray=void 0,this.waterMaskTexture=void 0,this.waterMaskTranslationAndScale=new H.a}qe.prototype.update=function(e,t,a){this.changedThisFrame&&(ht(e,t,this.tile,a),this.changedThisFrame=!1)},qe.prototype.destroy=function(e){Object(o.default)(this.vertexArray)&&(Object(o.default)(e)?e.push(this.vertexArray):Ne._freeVertexArray(this.vertexArray,e),this.vertexArray=void 0),Object(o.default)(this.waterMaskTexture)&&(--this.waterMaskTexture.referenceCount,0===this.waterMaskTexture.referenceCount&&this.waterMaskTexture.destroy(),this.waterMaskTexture=void 0)};var Ze=new ke.a;function Ke(e,t,a,i,r,n,s,l,d){if(void 0!==i){for(var f=i;f&&(f._lastSelectionResultFrame!==r||Qe.wasKicked(f._lastSelectionResult)||Qe.originalResult(f._lastSelectionResult)===Qe.CULLED);){if(s)return;var c=f.parent;if(n>=Ye.NORTHWEST&&void 0!==c)switch(n){case Ye.NORTHWEST:f=f===c.northwestChild?c:void 0;break;case Ye.NORTHEAST:f=f===c.northeastChild?c:void 0;break;case Ye.SOUTHWEST:f=f===c.southwestChild?c:void 0;break;case Ye.SOUTHEAST:f=f===c.southeastChild?c:void 0}else f=c}if(void 0!==f)if(f._lastSelectionResult!==Qe.RENDERED){if(Qe.originalResult(i._lastSelectionResult)!==Qe.CULLED)switch(n){case Ye.WEST:Ke(e,t,a,i.northwestChild,r,n,!0,l,d),Ke(e,t,a,i.southwestChild,r,n,!0,l,d);break;case Ye.EAST:Ke(e,t,a,i.southeastChild,r,n,!0,l,d),Ke(e,t,a,i.northeastChild,r,n,!0,l,d);break;case Ye.SOUTH:Ke(e,t,a,i.southwestChild,r,n,!0,l,d),Ke(e,t,a,i.southeastChild,r,n,!0,l,d);break;case Ye.NORTH:Ke(e,t,a,i.northeastChild,r,n,!0,l,d),Ke(e,t,a,i.northwestChild,r,n,!0,l,d);break;case Ye.NORTHWEST:Ke(e,t,a,i.northwestChild,r,n,!0,l,d);break;case Ye.NORTHEAST:Ke(e,t,a,i.northeastChild,r,n,!0,l,d);break;case Ye.SOUTHWEST:Ke(e,t,a,i.southwestChild,r,n,!0,l,d);break;case Ye.SOUTHEAST:Ke(e,t,a,i.southeastChild,r,n,!0,l,d);break;default:throw new u.default("Invalid edge")}}else{if(Object(o.default)(f.data.vertexArray))return;!function(e,t,a,i,r,n,s,l){var u=i.data;if(void 0===u.fill)u.fill=new qe(i);else if(u.fill.visitedFrame===n)return;u.fill.enqueuedFrame!==n&&(u.fill.enqueuedFrame=n,u.fill.changedThisFrame=!1,s.enqueue(i));!function(e,t,a,i,r,n){var s,l,u,d,f,c,h,m=i.data.fill,p=a.data.fill;Object(o.default)(p)?(p.visitedFrame=t.frameNumber,p.changedThisFrame&&(ht(e,t,a,n),p.changedThisFrame=!1),s=a.data.fill.mesh):s=a.data.mesh;switch(r){case Ye.WEST:l=m.westMeshes,u=m.westTiles;break;case Ye.SOUTH:l=m.southMeshes,u=m.southTiles;break;case Ye.EAST:l=m.eastMeshes,u=m.eastTiles;break;case Ye.NORTH:l=m.northMeshes,u=m.northTiles;break;case Ye.NORTHWEST:return m.changedThisFrame=m.changedThisFrame||m.northwestMesh!==s,m.northwestMesh=s,void(m.northwestTile=a);case Ye.NORTHEAST:return m.changedThisFrame=m.changedThisFrame||m.northeastMesh!==s,m.northeastMesh=s,void(m.northeastTile=a);case Ye.SOUTHWEST:return m.changedThisFrame=m.changedThisFrame||m.southwestMesh!==s,m.southwestMesh=s,void(m.southwestTile=a);case Ye.SOUTHEAST:return m.changedThisFrame=m.changedThisFrame||m.southeastMesh!==s,m.southeastMesh=s,void(m.southeastTile=a)}if(a.level<=i.level)return m.changedThisFrame=m.changedThisFrame||l[0]!==s||1!==l.length,l[0]=s,u[0]=a,l.length=1,void(u.length=1);var _,g=a.rectangle,v=i.rectangle;switch(r){case Ye.WEST:for(_=(v.north-v.south)*K.default.EPSILON5,d=0;d<u.length&&(c=u[d],h=c.rectangle,!K.default.greaterThan(g.north,h.south,_));++d);for(f=d;f<u.length&&(c=u[f],h=c.rectangle,!K.default.greaterThanOrEquals(g.south,h.north,_));++f);break;case Ye.SOUTH:for(_=(v.east-v.west)*K.default.EPSILON5,d=0;d<u.length&&(c=u[d],h=c.rectangle,!K.default.lessThan(g.west,h.east,_));++d);for(f=d;f<u.length&&(c=u[f],h=c.rectangle,!K.default.lessThanOrEquals(g.east,h.west,_));++f);break;case Ye.EAST:for(_=(v.north-v.south)*K.default.EPSILON5,d=0;d<u.length&&(c=u[d],h=c.rectangle,!K.default.lessThan(g.south,h.north,_));++d);for(f=d;f<u.length&&(c=u[f],h=c.rectangle,!K.default.lessThanOrEquals(g.north,h.south,_));++f);break;case Ye.NORTH:for(_=(v.east-v.west)*K.default.EPSILON5,d=0;d<u.length&&(c=u[d],h=c.rectangle,!K.default.greaterThan(g.east,h.west,_));++d);for(f=d;f<u.length&&(c=u[f],h=c.rectangle,!K.default.greaterThanOrEquals(g.west,h.east,_));++f);}f-d==1?(m.changedThisFrame=m.changedThisFrame||l[d]!==s,l[d]=s,u[d]=a):(m.changedThisFrame=!0,l.splice(d,f-d,s),u.splice(d,f-d,a))}(e,t,a,i,r,l)}(e,t,a,f,n,r,l,d)}}}qe.updateFillTiles=function(e,t,a,i){var r=e._quadtree,n=r._levelZeroTiles,s=r._lastSelectionFrameNumber,l=Ze;l.clear();for(var u=0;u<t.length;++u){var d=t[u];Object(o.default)(d.data.vertexArray)&&l.enqueue(t[u])}for(var f=l.dequeue();void 0!==f;){var c=f.findTileToWest(n),h=f.findTileToSouth(n),m=f.findTileToEast(n),p=f.findTileToNorth(n);Ke(e,a,f,c,s,Ye.EAST,!1,l,i),Ke(e,a,f,h,s,Ye.NORTH,!1,l,i),Ke(e,a,f,m,s,Ye.WEST,!1,l,i),Ke(e,a,f,p,s,Ye.SOUTH,!1,l,i);var _=c.findTileToNorth(n),g=c.findTileToSouth(n),v=m.findTileToNorth(n),y=m.findTileToSouth(n);Ke(e,a,f,_,s,Ye.SOUTHEAST,!1,l,i),Ke(e,a,f,v,s,Ye.SOUTHWEST,!1,l,i),Ke(e,a,f,g,s,Ye.NORTHEAST,!1,l,i),Ke(e,a,f,y,s,Ye.NORTHWEST,!1,l,i),f=l.dequeue()}};var Je=new y.default,$e=new y.default,et=new i.default,tt=new i.default,at=new B.default,it=new B.default,rt=new B.default;function nt(){this.height=0,this.encodedNormal=new B.default}function ot(e,t,a,i,r,n,s,l,u){if(Object(o.default)(r))return r;var d;if(Object(o.default)(n)&&Object(o.default)(s))d=.5*(n.height+s.height);else if(Object(o.default)(n))d=n.height;else if(Object(o.default)(s))d=s.height;else if(Object(o.default)(l))d=l.height;else{var f=e.tile.data.tileBoundingRegion,c=0,h=0;Object(o.default)(f)&&(c=f.minimumHeight,h=f.maximumHeight),d=.5*(c+h)}return wt(e,t,a,i,d,u),u}var st={minimumHeight:0,maximumHeight:0},lt=new nt,ut=new nt,dt=new nt,ft=new nt,ct="undefined"!=typeof Uint8Array?new Uint8Array(81):void 0;function ht(e,t,a,r){Ne.initialize(a,e.terrainProvider,e._imageryLayers);var n=a.data,s=n.fill,l=a.rectangle,u=a.tilingScheme.ellipsoid,d=Ot(s,u,0,1,s.northwestTile,s.northwestMesh,s.northTiles,s.northMeshes,s.westTiles,s.westMeshes,dt),f=Ot(s,u,0,0,s.southwestTile,s.southwestMesh,s.westTiles,s.westMeshes,s.southTiles,s.southMeshes,lt),c=Ot(s,u,1,0,s.southeastTile,s.southeastMesh,s.southTiles,s.southMeshes,s.eastTiles,s.eastMeshes,ut),h=Ot(s,u,1,1,s.northeastTile,s.northeastMesh,s.eastTiles,s.eastMeshes,s.northTiles,s.northMeshes,ft);d=ot(s,u,0,1,d,f,h,c,dt),f=ot(s,u,0,0,f,d,c,h,lt),c=ot(s,u,1,1,c,f,h,d,ut),h=ot(s,u,1,1,h,c,d,f,ft);var m,p,_=f.height,g=c.height,y=d.height,b=h.height,w=Math.min(_,g,y,b),O=Math.max(_,g,y,b),x=.5*(w+O),C=e.getLevelMaximumGeometricError(a.level),T=u.maximumRadius-C,E=4*Math.acos(T/u.maximumRadius);if(E*=1.5,l.width>E&&O-w<=C){var A=new He.a({width:9,height:9,buffer:ct,structure:{heightOffset:O}});s.mesh=A._createMeshSync(a.tilingScheme,a.x,a.y,a.level,1)}else{var S=new Ge.a(void 0,void 0,void 0,void 0,!0,!0),P=$e;P.longitude=.5*(l.east+l.west),P.latitude=.5*(l.north+l.south),P.height=x,S.center=u.cartographicToCartesian(P,S.center);var D,I=5;for(m=0,p=(D=s.westMeshes).length;m<p;++m)I+=D[m].eastIndicesNorthToSouth.length;for(m=0,p=(D=s.southMeshes).length;m<p;++m)I+=D[m].northIndicesWestToEast.length;for(m=0,p=(D=s.eastMeshes).length;m<p;++m)I+=D[m].westIndicesSouthToNorth.length;for(m=0,p=(D=s.northMeshes).length;m<p;++m)I+=D[m].southIndicesEastToWest.length;var M=st;M.minimumHeight=w,M.maximumHeight=O;var F=S.getStride(),R=new Float32Array(I*F),N=0,L=N,j=N=Ct(s,u,S,R,N=mt(u,l,S,R,N,0,1,d.height,d.encodedNormal,1,M),s.westTiles,s.westMeshes,Ye.EAST,M),V=N=Ct(s,u,S,R,N=mt(u,l,S,R,N,0,0,f.height,f.encodedNormal,0,M),s.southTiles,s.southMeshes,Ye.NORTH,M),U=N=Ct(s,u,S,R,N=mt(u,l,S,R,N,1,0,c.height,c.encodedNormal,0,M),s.eastTiles,s.eastMeshes,Ye.WEST,M);N=Ct(s,u,S,R,N=mt(u,l,S,R,N,1,1,h.height,h.encodedNormal,1,M),s.northTiles,s.northMeshes,Ye.SOUTH,M),w=M.minimumHeight,O=M.maximumHeight;var z=$.a.fromRectangle(l,w,O,a.tilingScheme.ellipsoid),H=ne.a.geodeticLatitudeToMercatorAngle(l.south),k=1/(ne.a.geodeticLatitudeToMercatorAngle(l.north)-H),G=(ne.a.geodeticLatitudeToMercatorAngle(P.latitude)-H)*k;u.geodeticSurfaceNormalCartographic(Je,tt);var W=ze.a.octEncode(tt,at),Y=N;S.encode(R,N*F,z.center,B.default.fromElements(.5,.5,rt),x,W,G);var X,Q=++N,q=3*(Q-1),Z=q*(Q<256?1:2);if((R.length-Q*F)*Float32Array.BYTES_PER_ELEMENT>=Z){var K=Q*F*Float32Array.BYTES_PER_ELEMENT;X=Q<256?new Uint8Array(R.buffer,K,q):new Uint16Array(R.buffer,K,q)}else X=Q<256?new Uint8Array(q):new Uint16Array(q);R=new Float32Array(R.buffer,0,Q*F);var J=0;for(m=0;m<Q-2;++m)X[J++]=Y,X[J++]=m,X[J++]=m+1;X[J++]=Y,X[J++]=m,X[J++]=0;var ee=[];for(m=j;m>=L;--m)ee.push(m);var te=[];for(m=V;m>=j;--m)te.push(m);var ae=[];for(m=U;m>=V;--m)ae.push(m);var ie=[];for(ie.push(0),m=Y-1;m>=U;--m)ie.push(m);s.mesh=new We.a(S.center,R,X,q,Q,w,O,v.default.fromOrientedBoundingBox(z),function(e,t,a,r,n,o){var s=e.quadtree._occluders.ellipsoid,l=s.ellipsoid,u=Pt;return i.default.fromRadians(a.west,a.south,n,l,u[0]),i.default.fromRadians(a.east,a.south,n,l,u[1]),i.default.fromRadians(a.west,a.north,n,l,u[2]),i.default.fromRadians(a.east,a.north,n,l,u[3]),s.computeHorizonCullingPointPossiblyUnderEllipsoid(t,u,r,o)}(e,z.center,l,w,O),S.getStride(),z,S,t.terrainExaggeration,ee,te,ae,ie)}var re=t.context;Object(o.default)(s.vertexArray)&&(Object(o.default)(r)?r.push(s.vertexArray):Ne._freeVertexArray(s.vertexArray)),s.vertexArray=Ne._createVertexArrayForMesh(re,s.mesh),n.processImagery(a,e.terrainProvider,t,!0);var oe=s.waterMaskTexture;if(s.waterMaskTexture=void 0,e.terrainProvider.hasWaterMask){var se=n._findAncestorTileWithTerrainData(a);Object(o.default)(se)&&Object(o.default)(se.data.waterMaskTexture)&&(s.waterMaskTexture=se.data.waterMaskTexture,++s.waterMaskTexture.referenceCount,n._computeWaterMaskTranslationAndScale(a,se,s.waterMaskTranslationAndScale))}Object(o.default)(oe)&&(--oe.referenceCount,0===oe.referenceCount&&oe.destroy())}function mt(e,t,a,i,r,n,o,s,l,u,d){var f=Je;f.longitude=K.default.lerp(t.west,t.east,n),f.latitude=K.default.lerp(t.south,t.north,o),f.height=s;var c=e.cartographicToCartesian(f,et),h=it;return h.x=n,h.y=o,a.encode(i,r*a.getStride(),c,h,s,l,u),d.minimumHeight=Math.min(d.minimumHeight,s),d.maximumHeight=Math.max(d.maximumHeight,s),r+1}var pt=new T.default;function _t(e,t,a,i){var r=e.rectangle,n=t.rectangle;0===t.x&&1===a.x&&e.x===e.tilingScheme.getNumberOfXTilesAtLevel(e.level)-1?((r=T.default.clone(e.rectangle,pt)).west-=K.default.TWO_PI,r.east-=K.default.TWO_PI):0===e.x&&0===a.x&&t.x===t.tilingScheme.getNumberOfXTilesAtLevel(t.level)-1&&((r=T.default.clone(e.rectangle,pt)).west+=K.default.TWO_PI,r.east+=K.default.TWO_PI);var o=r.east-r.west,s=(n.west-r.west)/o,l=(n.east-r.west)/o,u=r.north-r.south,d=(n.south-r.south)/u,f=(n.north-r.south)/u,c=(a.x-s)/(l-s),h=(a.y-d)/(f-d);return Math.abs(c)<Math.EPSILON5?c=0:Math.abs(c-1)<Math.EPSILON5&&(c=1),Math.abs(h)<Math.EPSILON5?h=0:Math.abs(h-1)<Math.EPSILON5&&(h=1),i.x=c,i.y=h,i}var gt=new B.default;function vt(e,t,a,i,r){var n=e.encoding,o=e.vertices;if(r.height=n.decodeHeight(o,t),n.hasVertexNormals)n.getOctEncodedNormal(o,t,r.encodedNormal);else{var s=r.encodedNormal;s.x=0,s.y=0}}var yt=new B.default,bt=new i.default;function wt(e,t,a,i,r,n){n.height=r;var o=t.geodeticSurfaceNormalCartographic(Je,et);ze.a.octEncode(o,n.encodedNormal)}function Ot(e,t,a,i,r,n,s,l,u,d,f){var c;return St(e,t,l,s,!1,a,i,f)||St(e,t,d,u,!0,a,i,f)?f:At(r,n)?(vt(n,0===a?0===i?n.eastIndicesNorthToSouth[0]:n.southIndicesEastToWest[0]:0===i?n.northIndicesWestToEast[0]:n.westIndicesSouthToNorth[0],0,0,f),f):(c=0===a?0===i?xt(e.westMeshes,e.westTiles,Ye.EAST,e.southMeshes,e.southTiles,Ye.NORTH,a,i):xt(e.northMeshes,e.northTiles,Ye.SOUTH,e.westMeshes,e.westTiles,Ye.EAST,a,i):0===i?xt(e.southMeshes,e.southTiles,Ye.NORTH,e.eastMeshes,e.eastTiles,Ye.WEST,a,i):xt(e.eastMeshes,e.eastTiles,Ye.WEST,e.northMeshes,e.northTiles,Ye.SOUTH,a,i),Object(o.default)(c)?(wt(0,t,0,0,c,f),f):void 0)}function xt(e,t,a,i,r,n,s,l){var u=Et(e,t,!1,a,s,l),d=Et(i,r,!0,n,s,l);return Object(o.default)(u)&&Object(o.default)(d)?.5*(u+d):Object(o.default)(u)?u:d}function Ct(e,t,a,i,r,n,o,s,l){for(var u=0;u<n.length;++u)r=Tt(e,t,a,i,r,n[u],o[u],s,l);return r}function Tt(e,t,a,i,r,n,o,s,l){var u=n.rectangle;s===Ye.EAST&&0===e.tile.x?((u=T.default.clone(n.rectangle,pt)).west-=K.default.TWO_PI,u.east-=K.default.TWO_PI):s===Ye.WEST&&0===n.x&&((u=T.default.clone(n.rectangle,pt)).west+=K.default.TWO_PI,u.east+=K.default.TWO_PI);var d,f,c,h,m=e.tile.rectangle;switch(r>0&&(a.decodeTextureCoordinates(i,r-1,rt),d=rt.x,f=rt.y),s){case Ye.WEST:c=o.westIndicesSouthToNorth,h=!1;break;case Ye.NORTH:c=o.northIndicesWestToEast,h=!0;break;case Ye.EAST:c=o.eastIndicesNorthToSouth,h=!1;break;case Ye.SOUTH:c=o.southIndicesEastToWest,h=!0}var p,_,g=n,v=e.tile,y=o.encoding,b=o.vertices,w=a.getStride();y.hasWebMercatorT&&(p=ne.a.geodeticLatitudeToMercatorAngle(m.south),_=1/(ne.a.geodeticLatitudeToMercatorAngle(m.north)-p));for(var O=0;O<c.length;++O){var x=c[O],C=y.decodeTextureCoordinates(b,x,rt);_t(g,v,C,C);var E=C.x,A=C.y,S=h?E:A;if(!(S<0||S>1)&&!(Math.abs(E-d)<K.default.EPSILON5&&Math.abs(A-f)<K.default.EPSILON5)){var P=Math.abs(E)<K.default.EPSILON5||Math.abs(E-1)<K.default.EPSILON5,D=Math.abs(A)<K.default.EPSILON5||Math.abs(A-1)<K.default.EPSILON5;if(!P||!D){var I,M=y.decodePosition(b,x,et),F=y.decodeHeight(b,x);y.hasVertexNormals?I=y.getOctEncodedNormal(b,x,at):((I=at).x=0,I.y=0);var R=A;if(y.hasWebMercatorT){var N=K.default.lerp(m.south,m.north,A);R=(ne.a.geodeticLatitudeToMercatorAngle(N)-p)*_}a.encode(i,r*w,M,C,F,I,R),l.minimumHeight=Math.min(l.minimumHeight,F),l.maximumHeight=Math.max(l.maximumHeight,F),++r}}}return r}function Et(e,t,a,i,r,n){var s,l,u;a?(s=0,l=e.length,u=1):(s=e.length-1,l=-1,u=-1);for(var d=s;d!==l;d+=u){var f=e[d];if(At(t[d],f)){var c;switch(i){case Ye.WEST:c=f.westIndicesSouthToNorth;break;case Ye.SOUTH:c=f.southIndicesEastToWest;break;case Ye.EAST:c=f.eastIndicesNorthToSouth;break;case Ye.NORTH:c=f.northIndicesWestToEast}var h=c[a?0:c.length-1];if(Object(o.default)(h))return f.encoding.decodeHeight(f.vertices,h)}}}function At(e,t){return Object(o.default)(t)&&(!Object(o.default)(e.data.fill)||!e.data.fill.changedThisFrame)}function St(e,t,a,r,n,o,s,l){var u,d,f,c,h,m=r[n?0:a.length-1],p=a[n?0:a.length-1];if(At(m,p)&&(0===o?0===s?(u=n?p.northIndicesWestToEast:p.eastIndicesNorthToSouth,d=n,f=n):(u=n?p.eastIndicesNorthToSouth:p.southIndicesEastToWest,d=!n,f=!1):0===s?(u=n?p.westIndicesSouthToNorth:p.northIndicesWestToEast,d=!n,f=!0):(u=n?p.southIndicesEastToWest:p.westIndicesSouthToNorth,d=n,f=!n),u.length>0)){h=u[c=n?0:u.length-1],p.encoding.decodeTextureCoordinates(p.vertices,h,rt);var _=_t(m,e.tile,rt,rt);if(_.x===o&&_.y===s)return vt(p,h,0,0,l),!0;if(!((c=Object(Be.a)(u,d?o:s,(function(t,a){p.encoding.decodeTextureCoordinates(p.vertices,t,rt);var i=_t(m,e.tile,rt,rt);return f?d?i.x-o:i.y-s:d?o-i.x:s-i.y})))<0))return vt(p,u[c],0,0,l),!0;if((c=~c)>0&&c<u.length)return function(e,t,a,r,n,o,s,l,u,d){var f,c=r.encoding,h=r.vertices,m=_t(t,a,c.decodeTextureCoordinates(h,n,rt),rt),p=_t(t,a,c.decodeTextureCoordinates(h,o,it),it);f=u?(s-m.x)/(p.x-m.x):(l-m.y)/(p.y-m.y);var _,g=c.decodeHeight(h,n),v=c.decodeHeight(h,o),y=a.rectangle;if(Je.longitude=K.default.lerp(y.west,y.east,s),Je.latitude=K.default.lerp(y.south,y.north,l),d.height=Je.height=K.default.lerp(g,v,f),c.hasVertexNormals){var b=c.getOctEncodedNormal(h,n,gt),w=c.getOctEncodedNormal(h,o,yt),O=ze.a.octDecode(b.x,b.y,et),x=ze.a.octDecode(w.x,w.y,bt);_=i.default.lerp(O,x,f,et),i.default.normalize(_,_),ze.a.octEncode(_,d.encodedNormal)}else _=e.geodeticSurfaceNormalCartographic(Je,et),ze.a.octEncode(_,d.encodedNormal)}(t,m,e.tile,p,u[c-1],u[c],o,s,d,l),!0}return!1}var Pt=[new i.default,new i.default,new i.default,new i.default];var Dt=qe,It=a(333);function Mt(e){this.lightingFadeOutDistance=65e5,this.lightingFadeInDistance=9e6,this.hasWaterMask=!1,this.oceanNormalMap=void 0,this.zoomedOutOceanSpecularIntensity=.5,this.enableLighting=!1,this.dynamicAtmosphereLighting=!1,this.dynamicAtmosphereLightingFromSun=!1,this.showGroundAtmosphere=!1,this.shadows=Ue.default.RECEIVE_ONLY,this.splitDirection=O.default.NONE,this.fillHighlightColor=void 0,this.hueShift=0,this.saturationShift=0,this.brightnessShift=0,this.showSkirts=!0,this.backFaceCulling=!0,this._quadtree=void 0,this._terrainProvider=e.terrainProvider,this._imageryLayers=e.imageryLayers,this._surfaceShaderSet=e.surfaceShaderSet,this._renderState=void 0,this._blendRenderState=void 0,this._disableCullingRenderState=void 0,this._disableCullingBlendRenderState=void 0,this._errorEvent=new w.default,this._imageryLayers.layerAdded.addEventListener(Mt.prototype._onLayerAdded,this),this._imageryLayers.layerRemoved.addEventListener(Mt.prototype._onLayerRemoved,this),this._imageryLayers.layerMoved.addEventListener(Mt.prototype._onLayerMoved,this),this._imageryLayers.layerShownOrHidden.addEventListener(Mt.prototype._onLayerShownOrHidden,this),this._imageryLayersUpdatedEvent=new w.default,this._layerOrderChanged=!1,this._tilesToRenderByTextureCount=[],this._drawCommands=[],this._uniformMaps=[],this._usedDrawCommands=0,this._vertexArraysToDestroy=[],this._debug={wireframe:!1,boundingSphereTile:void 0},this._baseColor=void 0,this._firstPassInitialColor=void 0,this.baseColor=new G.default(0,0,.5,1),this._clippingPlanes=void 0,this.cartographicLimitRectangle=T.default.clone(T.default.MAX_VALUE),this._hasLoadedTilesThisFrame=!1,this._hasFillTilesThisFrame=!1}function Ft(e,t){var a=e.loadingImagery;Object(o.default)(a)||(a=e.readyImagery);var i=t.loadingImagery;return Object(o.default)(i)||(i=t.readyImagery),a.imageryLayer._layerIndex-i.imageryLayer._layerIndex}Object(s.default)(Mt.prototype,{baseColor:{get:function(){return this._baseColor},set:function(e){this._baseColor=e,this._firstPassInitialColor=H.a.fromColor(e,this._firstPassInitialColor)}},quadtree:{get:function(){return this._quadtree},set:function(e){this._quadtree=e}},ready:{get:function(){return this._terrainProvider.ready&&(0===this._imageryLayers.length||this._imageryLayers.get(0).imageryProvider.ready)}},tilingScheme:{get:function(){return this._terrainProvider.tilingScheme}},errorEvent:{get:function(){return this._errorEvent}},imageryLayersUpdatedEvent:{get:function(){return this._imageryLayersUpdatedEvent}},terrainProvider:{get:function(){return this._terrainProvider},set:function(e){this._terrainProvider!==e&&(this._terrainProvider=e,Object(o.default)(this._quadtree)&&this._quadtree.invalidateAllTiles())}},clippingPlanes:{get:function(){return this._clippingPlanes},set:function(e){me.a.setOwner(e,this,"_clippingPlanes")}}}),Mt.prototype.update=function(e){this._imageryLayers._update()},Mt.prototype.initialize=function(e){this._imageryLayers.queueReprojectionCommands(e),this._layerOrderChanged&&(this._layerOrderChanged=!1,this._quadtree.forEachLoadedTile((function(e){e.data.imagery.sort(Ft)}))),function(e,t){var a=t.creditDisplay;e._terrainProvider.ready&&Object(o.default)(e._terrainProvider.credit)&&a.addCredit(e._terrainProvider.credit);for(var i=e._imageryLayers,r=0,n=i.length;r<n;++r){var s=i.get(r).imageryProvider;s.ready&&Object(o.default)(s.credit)&&a.addCredit(s.credit)}}(this,e);for(var t=this._vertexArraysToDestroy,a=t.length,i=0;i<a;++i)Ne._freeVertexArray(t[i]);t.length=0},Mt.prototype.beginUpdate=function(e){for(var t=this._tilesToRenderByTextureCount,a=0,i=t.length;a<i;++a){var r=t[a];Object(o.default)(r)&&(r.length=0)}var n=this._clippingPlanes;Object(o.default)(n)&&n.enabled&&n.update(e),this._usedDrawCommands=0,this._hasLoadedTilesThisFrame=!1,this._hasFillTilesThisFrame=!1},Mt.prototype.endUpdate=function(e){if(Object(o.default)(this._renderState)||(this._renderState=fe.a.fromCache({cull:{enabled:!0},depthTest:{enabled:!0,func:pe.a.LESS}}),this._blendRenderState=fe.a.fromCache({cull:{enabled:!0},depthTest:{enabled:!0,func:pe.a.LESS_OR_EQUAL},blending:he.a.ALPHA_BLEND})),!this.backFaceCulling&&!Object(o.default)(this._disableCullingRenderState)){var t=Object(k.default)(this._renderState,!0);t.cull.enabled=!1,this._disableCullingRenderState=fe.a.fromCache(t),(t=Object(k.default)(this._blendRenderState,!0)).cull.enabled=!1,this._disableCullingBlendRenderState=fe.a.fromCache(t)}this._hasFillTilesThisFrame&&this._hasLoadedTilesThisFrame&&Dt.updateFillTiles(this,this._quadtree._tilesToRender,e,this._vertexArraysToDestroy);for(var a=this._tilesToRenderByTextureCount,i=0,r=a.length;i<r;++i){var n=a[i];if(Object(o.default)(n))for(var s=0,l=n.length;s<l;++s){var u=n[s],d=u.data.tileBoundingRegion;na(this,u,e),e.minimumTerrainHeight=Math.min(e.minimumTerrainHeight,d.minimumHeight)}}},Mt.prototype.updateForPick=function(e){for(var t=this._drawCommands,a=0,i=this._usedDrawCommands;a<i;++a)e.commandList.push(t[a])},Mt.prototype.cancelReprojections=function(){this._imageryLayers.cancelReprojections()},Mt.prototype.getLevelMaximumGeometricError=function(e){return this._terrainProvider.getLevelMaximumGeometricError(e)},Mt.prototype.loadTile=function(e,t){var a,i=t.data,r=!0;Object(o.default)(i)&&(r=i.boundingVolumeSourceTile!==t||t._lastSelectionResult===Qe.CULLED_BUT_NEEDED,a=i.terrainState),Ne.processStateMachine(t,e,this.terrainProvider,this._imageryLayers,this._vertexArraysToDestroy,r),i=t.data,r&&a!==t.data.terrainState&&this.computeTileVisibility(t,e,this.quadtree.occluders)&&i.boundingVolumeSourceTile===t&&(r=!1,Ne.processStateMachine(t,e,this.terrainProvider,this._imageryLayers,this._vertexArraysToDestroy,r))};var Rt=new v.default,Nt=new T.default,Lt=new T.default,jt=new y.default;function Vt(e,t){if(t.west<t.east)return t;var a=T.default.clone(t,Lt);return T.default.center(e,jt).longitude>0?a.east=K.default.PI:a.west=-K.default.PI,a}Mt.prototype.computeTileVisibility=function(e,t,a){var r=this.computeDistanceToTile(e,t);if(e._distance=r,t.fog.enabled&&K.default.fog(r,t.fog.density)>=1)return re.NONE;var n=e.data,s=n.tileBoundingRegion;if(void 0===n.boundingVolumeSourceTile)return re.PARTIAL;var l=t.cullingVolume,u=n.orientedBoundingBox;!Object(o.default)(u)&&Object(o.default)(n.renderedMesh)&&(u=n.renderedMesh.boundingSphere3D),n.clippedByBoundaries=!1;var d=Vt(e.rectangle,this.cartographicLimitRectangle),f=T.default.simpleIntersection(d,e.rectangle,Nt);if(!Object(o.default)(f))return re.NONE;if(T.default.equals(f,e.rectangle)||(n.clippedByBoundaries=!0),t.mode!==L.a.SCENE3D&&(u=Rt,v.default.fromRectangleWithHeights2D(e.rectangle,t.mapProjection,s.minimumHeight,s.maximumHeight,u),i.default.fromElements(u.center.z,u.center.x,u.center.y,u.center),t.mode===L.a.MORPHING&&Object(o.default)(n.renderedMesh)&&(u=v.default.union(n.renderedMesh.boundingSphere3D,u,u))),!Object(o.default)(u))return Z.default.INTERSECTING;var c=this._clippingPlanes;if(Object(o.default)(c)&&c.enabled){var h=c.computeIntersectionWithBoundingVolume(u);if(e.isClipped=h!==Z.default.INSIDE,h===Z.default.OUTSIDE)return re.NONE}var m=l.computeVisibility(u);if(m===Z.default.OUTSIDE)return re.NONE;var p=t.mode===L.a.SCENE3D&&t.camera.frustum instanceof ee.a;if(t.mode===L.a.SCENE3D&&!p&&Object(o.default)(a)){var _=n.occludeePointInScaledSpace;return Object(o.default)(_)?a.ellipsoid.isScaledSpacePointVisiblePossiblyUnderEllipsoid(_,s.minimumHeight)?m:re.NONE:m}return m},Mt.prototype.canRefine=function(e){return!!Object(o.default)(e.data.terrainData)||void 0!==this.terrainProvider.getTileDataAvailable(2*e.x,2*e.y,e.level+1)};var Ut=[],zt=[];Mt.prototype.canRenderWithoutLosingDetail=function(e,t){var a=e.data,i=Ut;i.length=this._imageryLayers.length;var r,n,s,l=!1,u=!1;for(Object(o.default)(a)&&(l=a.terrainState===Se.READY,u=!0,r=a.imagery),n=0,s=i.length;n<s;++n)i[n]=u;if(Object(o.default)(r))for(n=0,s=r.length;n<s;++n){var d=r[n],f=d.loadingImagery,c=!Object(o.default)(f)||f.state===Ee.a.FAILED||f.state===Ee.a.INVALID,h=(d.loadingImagery||d.readyImagery).imageryLayer._layerIndex;i[h]=c&&i[h]}var m=this.quadtree._lastSelectionFrameNumber,p=zt;for(p.length=0,p.push(e.southwestChild,e.southeastChild,e.northwestChild,e.northeastChild);p.length>0;){var _=p.pop(),g=_._lastSelectionResultFrame===m?_._lastSelectionResult:Qe.NONE;if(g===Qe.RENDERED){var v=_.data;if(!Object(o.default)(v))continue;if(!l&&_.data.terrainState===Se.READY)return!1;var y=_.data.imagery;for(n=0,s=y.length;n<s;++n){var b=y[n],w=b.loadingImagery,O=!Object(o.default)(w)||w.state===Ee.a.FAILED||w.state===Ee.a.INVALID,x=(b.loadingImagery||b.readyImagery).imageryLayer._layerIndex;if(O&&!i[x])return!1}}else g===Qe.REFINED&&p.push(_.southwestChild,_.southeastChild,_.northwestChild,_.northeastChild)}return!0};var Bt=new i.default;Mt.prototype.computeTileLoadPriority=function(e,t){var a=e.data;if(void 0===a)return 0;var r=a.orientedBoundingBox;if(void 0===r)return 0;var n=t.camera.positionWC,o=t.camera.directionWC,s=i.default.subtract(r.center,n,Bt),l=i.default.magnitude(s);return l<K.default.EPSILON5?0:(i.default.divideByScalar(s,l,s),(1-i.default.dot(s,o))*e._distance)};var Ht=new J.default,kt=new J.default,Gt=new H.a,Wt=new H.a,Yt=new i.default,Xt=new i.default,Qt=new i.default,qt=new i.default;Mt.prototype.showTileThisFrame=function(e,t){for(var a=0,i=e.data.imagery,r=0,n=i.length;r<n;++r){var s=i[r];Object(o.default)(s.readyImagery)&&0!==s.readyImagery.imageryLayer.alpha&&++a}var l=this._tilesToRenderByTextureCount[a];Object(o.default)(l)||(l=[],this._tilesToRenderByTextureCount[a]=l),l.push(e);var u=e.data;Object(o.default)(u.vertexArray)?this._hasLoadedTilesThisFrame=!0:this._hasFillTilesThisFrame=!0;var d=this._debug;++d.tilesRendered,d.texturesRendered+=a};var Zt=[new i.default,new i.default,new i.default,new i.default];Mt.prototype.computeDistanceToTile=function(e,t){var a=function(e,t,a){var i=e.data;void 0===i&&(i=e.data=new Ne);void 0===i.tileBoundingRegion&&(i.tileBoundingRegion=new It.a({computeBoundingVolumes:!1,rectangle:e.rectangle,ellipsoid:e.tilingScheme.ellipsoid,minimumHeight:0,maximumHeight:0}));var r=i.terrainData,n=i.mesh,o=i.tileBoundingRegion;if(void 0!==n&&void 0!==n.minimumHeight&&void 0!==n.maximumHeight)return o.minimumHeight=n.minimumHeight,o.maximumHeight=n.maximumHeight,e;if(void 0!==r&&void 0!==r._minimumHeight&&void 0!==r._maximumHeight)return o.minimumHeight=r._minimumHeight*a.terrainExaggeration,o.maximumHeight=r._maximumHeight*a.terrainExaggeration,e;o.minimumHeight=Number.NaN,o.maximumHeight=Number.NaN;var s=e.parent;for(;void 0!==s;){var l=s.data;if(void 0!==l){var u=l.mesh;if(void 0!==u&&void 0!==u.minimumHeight&&void 0!==u.maximumHeight)return o.minimumHeight=u.minimumHeight,o.maximumHeight=u.maximumHeight,s;var d=l.terrainData;if(void 0!==d&&void 0!==d._minimumHeight&&void 0!==d._maximumHeight)return o.minimumHeight=d._minimumHeight*a.terrainExaggeration,o.maximumHeight=d._maximumHeight*a.terrainExaggeration,s}s=s.parent}return}(e,this.terrainProvider,t),r=e.data,n=r.tileBoundingRegion;if(void 0===a)return 9999999999;if(r.boundingVolumeSourceTile!==a){r.boundingVolumeSourceTile=a;var s=e.rectangle;Object(o.default)(s)&&(r.orientedBoundingBox=$.a.fromRectangle(e.rectangle,n.minimumHeight,n.maximumHeight,e.tilingScheme.ellipsoid,r.orientedBoundingBox),r.occludeePointInScaledSpace=function(e,t,a,r,n,o){var s=e.quadtree._occluders.ellipsoid,l=s.ellipsoid,u=Zt;return i.default.fromRadians(a.west,a.south,n,l,u[0]),i.default.fromRadians(a.east,a.south,n,l,u[1]),i.default.fromRadians(a.west,a.north,n,l,u[2]),i.default.fromRadians(a.east,a.north,n,l,u[3]),s.computeHorizonCullingPointPossiblyUnderEllipsoid(t,u,r,o)}(this,r.orientedBoundingBox.center,e.rectangle,n.minimumHeight,n.maximumHeight,r.occludeePointInScaledSpace))}var l=n.minimumHeight,u=n.maximumHeight;if(r.boundingVolumeSourceTile!==e){var d=t.camera.positionCartographic.height;Math.abs(d-l)>Math.abs(d-u)?(n.minimumHeight=l,n.maximumHeight=l):(n.minimumHeight=u,n.maximumHeight=u)}var f=n.distanceToCamera(t);return n.minimumHeight=l,n.maximumHeight=u,f},Mt.prototype.isDestroyed=function(){return!1},Mt.prototype.destroy=function(){return this._tileProvider=this._tileProvider&&this._tileProvider.destroy(),this._clippingPlanes=this._clippingPlanes&&this._clippingPlanes.destroy(),Object(l.default)(this)},Mt.prototype._onLayerAdded=function(e,t){if(e.show){var a=this._terrainProvider,i=this,r=e.imageryProvider,s=this._imageryLayersUpdatedEvent;r._reload=function(){e._imageryCache={},i._quadtree.forEachLoadedTile((function(t){if(!Object(o.default)(t._loadedCallbacks[e._layerIndex])){var i,r=t.data.imagery,s=r.length,l=-1,u=0;for(i=0;i<s;++i){var d=r[i];if(Object(n.default)(d.readyImagery,d.loadingImagery).imageryLayer===e)-1===l&&(l=i),++u;else if(-1!==l)break}if(-1!==l){var f=l+u;e._createTileImagerySkeletons(t,a,f)&&(t._loadedCallbacks[e._layerIndex]=function(e,t,a){return function(i){var r,s,l,u=-1,d=i.data.imagery,f=d.length;for(l=0;l<f;++l)if(r=d[l],(s=Object(n.default)(r.readyImagery,r.loadingImagery)).imageryLayer===t){u=l;break}if(-1!==u){var c=u+e;if(r=d[c],s=Object(o.default)(r)?Object(n.default)(r.readyImagery,r.loadingImagery):void 0,!Object(o.default)(s)||s.imageryLayer!==t)return!t._createTileImagerySkeletons(i,a,c);for(l=u;l<c;++l)d[l].freeResources();d.splice(u,e)}return!0}}(u,e,a),t.state=Ae.LOADING)}}}))},this._quadtree.forEachLoadedTile((function(t){e._createTileImagerySkeletons(t,a)&&(t.state=Ae.LOADING,0===t.level||t._lastSelectionResultFrame===i.quadtree._lastSelectionFrameNumber&&t._lastSelectionResult===Qe.RENDERED||(t.renderable=!1))})),this._layerOrderChanged=!0,s.raiseEvent()}},Mt.prototype._onLayerRemoved=function(e,t){this._quadtree.forEachLoadedTile((function(t){for(var a=t.data.imagery,i=-1,r=0,n=0,s=a.length;n<s;++n){var l=a[n],u=l.loadingImagery;if(Object(o.default)(u)||(u=l.readyImagery),u.imageryLayer===e)-1===i&&(i=n),l.freeResources(),++r;else if(-1!==i)break}-1!==i&&a.splice(i,r)})),Object(o.default)(e.imageryProvider)&&(e.imageryProvider._reload=void 0),this._imageryLayersUpdatedEvent.raiseEvent()},Mt.prototype._onLayerMoved=function(e,t,a){this._layerOrderChanged=!0,this._imageryLayersUpdatedEvent.raiseEvent()},Mt.prototype._onLayerShownOrHidden=function(e,t,a){a?this._onLayerAdded(e,t):this._onLayerRemoved(e,t)};var Kt,Jt,$t,ea=new J.default;function ta(e,t){return{u_initialColor:function(){return this.properties.initialColor},u_fillHighlightColor:function(){return this.properties.fillHighlightColor},u_zoomedOutOceanSpecularIntensity:function(){return this.properties.zoomedOutOceanSpecularIntensity},u_oceanNormalMap:function(){return this.properties.oceanNormalMap},u_lightingFadeDistance:function(){return this.properties.lightingFadeDistance},u_nightFadeDistance:function(){return this.properties.nightFadeDistance},u_center3D:function(){return this.properties.center3D},u_tileRectangle:function(){return this.properties.tileRectangle},u_modifiedModelView:function(){var t=e.context.uniformState.view,a=J.default.multiplyByPoint(t,this.properties.rtc,Xt);return J.default.setTranslation(t,a,Ht),Ht},u_modifiedModelViewProjection:function(){var t=e.context.uniformState.view,a=e.context.uniformState.projection,i=J.default.multiplyByPoint(t,this.properties.rtc,Xt);return J.default.setTranslation(t,i,kt),J.default.multiply(a,kt,kt),kt},u_dayTextures:function(){return this.properties.dayTextures},u_dayTextureTranslationAndScale:function(){return this.properties.dayTextureTranslationAndScale},u_dayTextureTexCoordsRectangle:function(){return this.properties.dayTextureTexCoordsRectangle},u_dayTextureUseWebMercatorT:function(){return this.properties.dayTextureUseWebMercatorT},u_dayTextureAlpha:function(){return this.properties.dayTextureAlpha},u_dayTextureBrightness:function(){return this.properties.dayTextureBrightness},u_dayTextureContrast:function(){return this.properties.dayTextureContrast},u_dayTextureHue:function(){return this.properties.dayTextureHue},u_dayTextureSaturation:function(){return this.properties.dayTextureSaturation},u_dayTextureOneOverGamma:function(){return this.properties.dayTextureOneOverGamma},u_dayIntensity:function(){return this.properties.dayIntensity},u_southAndNorthLatitude:function(){return this.properties.southAndNorthLatitude},u_southMercatorYAndOneOverHeight:function(){return this.properties.southMercatorYAndOneOverHeight},u_waterMask:function(){return this.properties.waterMask},u_waterMaskTranslationAndScale:function(){return this.properties.waterMaskTranslationAndScale},u_minMaxHeight:function(){return this.properties.minMaxHeight},u_scaleAndBias:function(){return this.properties.scaleAndBias},u_dayTextureSplit:function(){return this.properties.dayTextureSplit},u_dayTextureCutoutRectangles:function(){return this.properties.dayTextureCutoutRectangles},u_clippingPlanes:function(){var a=t._clippingPlanes;return Object(o.default)(a)&&Object(o.default)(a.texture)?a.texture:e.context.defaultTexture},u_cartographicLimitRectangle:function(){return this.properties.localizedCartographicLimitRectangle},u_clippingPlanesMatrix:function(){var a=t._clippingPlanes;return Object(o.default)(a)?J.default.multiply(e.context.uniformState.view,a.modelMatrix,ea):J.default.IDENTITY},u_clippingPlanesEdgeStyle:function(){var e=this.properties.clippingPlanesEdgeColor;return e.alpha=this.properties.clippingPlanesEdgeWidth,e},u_minimumBrightness:function(){return e.fog.minimumBrightness},u_terrainSplitDirection:function(){return t.splitDirection},u_hsbShift:function(){return this.properties.hsbShift},u_colorsToAlpha:function(){return this.properties.colorsToAlpha},properties:{initialColor:new H.a(0,0,.5,1),fillHighlightColor:new G.default(0,0,0,0),zoomedOutOceanSpecularIntensity:.5,oceanNormalMap:void 0,lightingFadeDistance:new B.default(65e5,9e6),nightFadeDistance:new B.default(1e7,4e7),hsbShift:new i.default,center3D:void 0,rtc:new i.default,modifiedModelView:new J.default,tileRectangle:new H.a,dayTextures:[],dayTextureTranslationAndScale:[],dayTextureTexCoordsRectangle:[],dayTextureUseWebMercatorT:[],dayTextureAlpha:[],dayTextureBrightness:[],dayTextureContrast:[],dayTextureHue:[],dayTextureSaturation:[],dayTextureOneOverGamma:[],dayTextureSplit:[],dayTextureCutoutRectangles:[],dayIntensity:0,colorsToAlpha:[],southAndNorthLatitude:new B.default,southMercatorYAndOneOverHeight:new B.default,waterMask:void 0,waterMaskTranslationAndScale:new H.a,minMaxHeight:new B.default,scaleAndBias:new J.default,clippingPlanesEdgeColor:G.default.clone(G.default.WHITE),clippingPlanesEdgeWidth:0,localizedCartographicLimitRectangle:new H.a}}}function aa(e,t,a){var i,r,n=a.data;if(Object(o.default)(n.vertexArray)?(i=n.mesh,r=n.vertexArray):Object(o.default)(n.fill)&&Object(o.default)(n.fill.vertexArray)&&(i=n.fill.mesh,r=n.fill.vertexArray),Object(o.default)(i)&&Object(o.default)(r)){if(Object(o.default)(n.wireframeVertexArray)){if(n.wireframeVertexArray.mesh===i)return;n.wireframeVertexArray.destroy(),n.wireframeVertexArray=void 0}n.wireframeVertexArray=function(e,t,a){var i={indices:a.indices,primitiveType:te.a.TRIANGLES};Q.a.toWireframe(i);var r=i.indices,n=oe.a.createIndexBuffer({context:e,typedArray:r,usage:se.a.STATIC_DRAW,indexDatatype:q.a.fromSizeInBytes(r.BYTES_PER_ELEMENT)});return new ce.a({context:e,attributes:t._attributes,indexBuffer:n})}(e,r,i),n.wireframeVertexArray.mesh=i}}!function(){var e,t,a=new X.a({geometry:z.a.fromDimensions({dimensions:new i.default(2,2,2)})}),r=new X.a({geometry:new ae.a({radius:1})}),n=new J.default;function s(e){return new Ve.a({geometryInstances:e,appearance:new je.a({translucent:!1,flat:!0}),asynchronous:!1})}Kt=function(i,r){return i===e?t:($t(),e=i,n=J.default.fromRotationTranslation(i.halfAxes,i.center,n),a.modelMatrix=n,a.attributes.color=W.a.fromColor(r),t=s(a))},Jt=function(a,i){return a===e?t:($t(),e=a,n=J.default.fromTranslation(a.center,n),n=J.default.multiplyByUniformScale(n,a.radius,n),r.modelMatrix=n,r.attributes.color=W.a.fromColor(i),t=s(r))},$t=function(){Object(o.default)(t)&&(t.destroy(),t=void 0,e=void 0)}}();var ia=new H.a(0,0,0,0),ra={frameState:void 0,surfaceTile:void 0,numberOfDayTextures:void 0,applyBrightness:void 0,applyContrast:void 0,applyHue:void 0,applySaturation:void 0,applyGamma:void 0,applyAlpha:void 0,applySplit:void 0,showReflectiveOcean:void 0,showOceanWaves:void 0,enableLighting:void 0,dynamicAtmosphereLighting:void 0,dynamicAtmosphereLightingFromSun:void 0,showGroundAtmosphere:void 0,perFragmentGroundAtmosphere:void 0,hasVertexNormals:void 0,useWebMercatorProjection:void 0,enableFog:void 0,enableClippingPlanes:void 0,clippingPlanes:void 0,clippedByBoundaries:void 0,hasImageryLayerCutout:void 0,colorCorrect:void 0,colorToAlpha:void 0};function na(e,t,a){var r=t.data;Object(o.default)(r.vertexArray)||(void 0===r.fill&&(r.fill=new Dt(t)),r.fill.update(e,a));var n=a.creditDisplay,s=r.terrainData;if(Object(o.default)(s)&&Object(o.default)(s.credits))for(var l=s.credits,u=0,d=l.length;u<d;++u)n.addCredit(l[u]);var f=le.a.maximumTextureImageUnits,c=r.waterMaskTexture,h=r.waterMaskTranslationAndScale;!Object(o.default)(c)&&Object(o.default)(r.fill)&&(c=r.fill.waterMaskTexture,h=r.fill.waterMaskTranslationAndScale);var m=e.hasWaterMask&&Object(o.default)(c),p=e.oceanNormalMap,_=m&&Object(o.default)(p),g=e.terrainProvider.ready&&e.terrainProvider.hasVertexNormals,y=a.fog.enabled,b=e.showGroundAtmosphere,w=Ue.default.castShadows(e.shadows),x=Ue.default.receiveShadows(e.shadows),C=e.hueShift,E=e.saturationShift,A=e.brightnessShift,S=!(K.default.equalsEpsilon(C,0,K.default.EPSILON7)&&K.default.equalsEpsilon(E,0,K.default.EPSILON7)&&K.default.equalsEpsilon(A,0,K.default.EPSILON7)),P=!1;if(b){var D,I=a.mode,M=a.camera;D=I===L.a.SCENE2D||I===L.a.COLUMBUS_VIEW?M.positionCartographic.height:i.default.magnitude(M.positionWC);var R=e.nightFadeOutDistance;I!==L.a.SCENE3D&&(R-=a.mapProjection.ellipsoid.maximumRadius),P=D>R}m&&--f,_&&--f,Object(o.default)(a.shadowState)&&a.shadowState.shadowsEnabled&&--f,Object(o.default)(e.clippingPlanes)&&e.clippingPlanes.enabled&&--f;var N=r.renderedMesh,j=N.center,V=N.encoding,U=Gt,z=0,B=0,k=0,W=0,X=!1;if(a.mode!==L.a.SCENE3D){var Q=a.mapProjection,q=Q.project(T.default.southwest(t.rectangle),Qt),Z=Q.project(T.default.northeast(t.rectangle),qt);if(U.x=q.x,U.y=q.y,U.z=Z.x,U.w=Z.y,a.mode!==L.a.MORPHING&&((j=Yt).x=0,j.y=.5*(U.z+U.x),j.z=.5*(U.w+U.y),U.x-=j.y,U.y-=j.z,U.z-=j.y,U.w-=j.z),a.mode===L.a.SCENE2D&&V.quantization===F.a.BITS12){var ee=1/(Math.pow(2,12)-1)*.5,ae=(U.z-U.x)*ee,ie=(U.w-U.y)*ee;U.x-=ae,U.y-=ie,U.z+=ae,U.w+=ie}Q instanceof ne.a&&(z=t.rectangle.south,B=t.rectangle.north,k=ne.a.geodeticLatitudeToMercatorAngle(z),W=1/(ne.a.geodeticLatitudeToMercatorAngle(B)-k),X=!0)}var re=ra;re.frameState=a,re.surfaceTile=r,re.showReflectiveOcean=m,re.showOceanWaves=_,re.enableLighting=e.enableLighting,re.dynamicAtmosphereLighting=e.dynamicAtmosphereLighting,re.dynamicAtmosphereLightingFromSun=e.dynamicAtmosphereLightingFromSun,re.showGroundAtmosphere=b,re.perFragmentGroundAtmosphere=P,re.hasVertexNormals=g,re.useWebMercatorProjection=X,re.clippedByBoundaries=r.clippedByBoundaries,re.splitTerrain=e.splitDirection!==O.default.NONE;var oe=r.imagery,se=0,fe=oe.length,ce=e.backFaceCulling?e._renderState:e._disableCullingRenderState,he=e.backFaceCulling?e._blendRenderState:e._disableCullingBlendRenderState,me=ce,pe=e._firstPassInitialColor,_e=a.context;Object(o.default)(e._debug.boundingSphereTile)||$t();do{var ge,ve,ye=0;if(e._drawCommands.length<=e._usedDrawCommands?((ge=new ue.a).owner=t,ge.cull=!1,ge.boundingVolume=new v.default,ge.orientedBoundingBox=void 0,ve=ta(a,e),e._drawCommands.push(ge),e._uniformMaps.push(ve)):(ge=e._drawCommands[e._usedDrawCommands],ve=e._uniformMaps[e._usedDrawCommands]),ge.owner=t,++e._usedDrawCommands,t===e._debug.boundingSphereTile){var be=r.orientedBoundingBox;Object(o.default)(be)?Kt(be,G.default.RED).update(a):Object(o.default)(N)&&Object(o.default)(N.boundingSphere3D)&&Jt(N.boundingSphere3D,G.default.RED).update(a)}var we=ve.properties;H.a.clone(pe,we.initialColor),we.oceanNormalMap=p,we.lightingFadeDistance.x=e.lightingFadeOutDistance,we.lightingFadeDistance.y=e.lightingFadeInDistance,we.nightFadeDistance.x=e.nightFadeOutDistance,we.nightFadeDistance.y=e.nightFadeInDistance,we.zoomedOutOceanSpecularIntensity=e.zoomedOutOceanSpecularIntensity;var Oe=!Object(o.default)(r.vertexArray)&&Object(o.default)(e.fillHighlightColor)&&e.fillHighlightColor.alpha>0;Oe&&G.default.clone(e.fillHighlightColor,we.fillHighlightColor),we.center3D=N.center,i.default.clone(j,we.rtc),H.a.clone(U,we.tileRectangle),we.southAndNorthLatitude.x=z,we.southAndNorthLatitude.y=B,we.southMercatorYAndOneOverHeight.x=k,we.southMercatorYAndOneOverHeight.y=W;var xe=Wt,Ce=Vt(t.rectangle,e.cartographicLimitRectangle);i.default.fromElements(C,E,A,we.hsbShift);var Te=t.rectangle,Ee=1/Te.width,Ae=1/Te.height;xe.x=(Ce.west-Te.west)*Ee,xe.y=(Ce.south-Te.south)*Ae,xe.z=(Ce.east-Te.west)*Ee,xe.w=(Ce.north-Te.south)*Ae,H.a.clone(xe,we.localizedCartographicLimitRectangle);var Se=y&&K.default.fog(t._distance,a.fog.density)>K.default.EPSILON3;S=S&&(Se||b);for(var Pe=!1,De=!1,Ie=!1,Me=!1,Fe=!1,Re=!1,Ne=!1,je=!1,Ve=!1;ye<f&&se<fe;){var ze=oe[se],Be=ze.readyImagery;if(++se,Object(o.default)(Be)&&0!==Be.imageryLayer.alpha){var He=ze.useWebMercatorT?Be.textureWebMercator:Be.texture,ke=Be.imageryLayer;Object(o.default)(ze.textureTranslationAndScale)||(ze.textureTranslationAndScale=ke._calculateTextureTranslationAndScale(t,ze)),we.dayTextures[ye]=He,we.dayTextureTranslationAndScale[ye]=ze.textureTranslationAndScale,we.dayTextureTexCoordsRectangle[ye]=ze.textureCoordinateRectangle,we.dayTextureUseWebMercatorT[ye]=ze.useWebMercatorT,we.dayTextureAlpha[ye]=ke.alpha,Re=Re||1!==we.dayTextureAlpha[ye],we.dayTextureBrightness[ye]=ke.brightness,Pe=Pe||we.dayTextureBrightness[ye]!==Le.default.DEFAULT_BRIGHTNESS,we.dayTextureContrast[ye]=ke.contrast,De=De||we.dayTextureContrast[ye]!==Le.default.DEFAULT_CONTRAST,we.dayTextureHue[ye]=ke.hue,Ie=Ie||we.dayTextureHue[ye]!==Le.default.DEFAULT_HUE,we.dayTextureSaturation[ye]=ke.saturation,Me=Me||we.dayTextureSaturation[ye]!==Le.default.DEFAULT_SATURATION,we.dayTextureOneOverGamma[ye]=1/ke.gamma,Fe=Fe||we.dayTextureOneOverGamma[ye]!==1/Le.default.DEFAULT_GAMMA,we.dayTextureSplit[ye]=ke.splitDirection,Ne=Ne||0!==we.dayTextureSplit[ye];var Ge=we.dayTextureCutoutRectangles[ye];if(Object(o.default)(Ge)||(Ge=we.dayTextureCutoutRectangles[ye]=new H.a),H.a.clone(H.a.ZERO,Ge),Object(o.default)(ke.cutoutRectangle)){var We=Vt(Te,ke.cutoutRectangle),Ye=T.default.simpleIntersection(We,Te,Nt);je=Object(o.default)(Ye)||je,Ge.x=(We.west-Te.west)*Ee,Ge.y=(We.south-Te.south)*Ae,Ge.z=(We.east-Te.west)*Ee,Ge.w=(We.north-Te.south)*Ae}var Xe=we.colorsToAlpha[ye];Object(o.default)(Xe)||(Xe=we.colorsToAlpha[ye]=new H.a);var Qe=Object(o.default)(ke.colorToAlpha)&&ke.colorToAlphaThreshold>0;if(Ve=Ve||Qe,Qe){var qe=ke.colorToAlpha;Xe.x=qe.red,Xe.y=qe.green,Xe.z=qe.blue,Xe.w=ke.colorToAlphaThreshold}else Xe.w=-1;if(Object(o.default)(Be.credits))for(var Ze=Be.credits,Ke=0,Je=Ze.length;Ke<Je;++Ke)n.addCredit(Ze[Ke]);++ye}}we.dayTextures.length=ye,we.waterMask=c,H.a.clone(h,we.waterMaskTranslationAndScale),we.minMaxHeight.x=V.minimumHeight,we.minMaxHeight.y=V.maximumHeight,J.default.clone(V.matrix,we.scaleAndBias);var $e=e._clippingPlanes,et=Object(o.default)($e)&&$e.enabled&&t.isClipped;et&&(we.clippingPlanesEdgeColor=G.default.clone($e.edgeColor,we.clippingPlanesEdgeColor),we.clippingPlanesEdgeWidth=$e.edgeWidth),Object(o.default)(e.uniformMap)&&(ve=Object(Y.default)(ve,e.uniformMap)),re.numberOfDayTextures=ye,re.applyBrightness=Pe,re.applyContrast=De,re.applyHue=Ie,re.applySaturation=Me,re.applyGamma=Fe,re.applyAlpha=Re,re.applySplit=Ne,re.enableFog=Se,re.enableClippingPlanes=et,re.clippingPlanes=$e,re.hasImageryLayerCutout=je,re.colorCorrect=S,re.highlightFillTile=Oe,re.colorToAlpha=Ve;var tt=r.renderedMesh.indices.length;e.showSkirts||(tt=r.renderedMesh.indexCountWithoutSkirts),ge.shaderProgram=e._surfaceShaderSet.getShaderProgram(re),ge.castShadows=w,ge.receiveShadows=x,ge.renderState=me,ge.primitiveType=te.a.TRIANGLES,ge.vertexArray=r.vertexArray||r.fill.vertexArray,ge.count=tt,ge.uniformMap=ve,ge.pass=de.a.GLOBE,e._debug.wireframe&&(aa(_e,0,t),Object(o.default)(r.wireframeVertexArray)&&(ge.vertexArray=r.wireframeVertexArray,ge.primitiveType=te.a.LINES,ge.count=2*tt));var at=ge.boundingVolume,it=ge.orientedBoundingBox;if(a.mode!==L.a.SCENE3D){var rt=r.tileBoundingRegion;v.default.fromRectangleWithHeights2D(t.rectangle,a.mapProjection,rt.minimumHeight,rt.maximumHeight,at),i.default.fromElements(at.center.z,at.center.x,at.center.y,at.center),a.mode===L.a.MORPHING&&(at=v.default.union(N.boundingSphere3D,at,at))}else ge.boundingVolume=v.default.clone(N.boundingSphere3D,at),ge.orientedBoundingBox=$.a.clone(r.orientedBoundingBox,it);ge.dirty=!0,a.commandList.push(ge),me=he,pe=ia}while(se<fe)}var oa=Mt;function sa(){this._layers=[],this.layerAdded=new w.default,this.layerRemoved=new w.default,this.layerMoved=new w.default,this.layerShownOrHidden=new w.default}function la(e,t){return e.indexOf(t)}function ua(e,t,a){var i=e._layers;if((t=K.default.clamp(t,0,i.length-1))!==(a=K.default.clamp(a,0,i.length-1))){var r=i[t];i[t]=i[a],i[a]=r,e._update(),e.layerMoved.raiseEvent(r,a,t)}}Object(s.default)(sa.prototype,{length:{get:function(){return this._layers.length}}}),sa.prototype.add=function(e,t){Object(o.default)(t)?this._layers.splice(t,0,e):(t=this._layers.length,this._layers.push(e)),this._update(),this.layerAdded.raiseEvent(e,t)},sa.prototype.addImageryProvider=function(e,t){var a=new Le.default(e);return this.add(a,t),a},sa.prototype.remove=function(e,t){t=Object(n.default)(t,!0);var a=this._layers.indexOf(e);return-1!==a&&(this._layers.splice(a,1),this._update(),this.layerRemoved.raiseEvent(e,a),t&&e.destroy(),!0)},sa.prototype.removeAll=function(e){e=Object(n.default)(e,!0);for(var t=this._layers,a=0,i=t.length;a<i;a++){var r=t[a];this.layerRemoved.raiseEvent(r,a),e&&r.destroy()}this._layers=[]},sa.prototype.contains=function(e){return-1!==this.indexOf(e)},sa.prototype.indexOf=function(e){return this._layers.indexOf(e)},sa.prototype.get=function(e){return this._layers[e]},sa.prototype.raise=function(e){var t=la(this._layers,e);ua(this,t,t+1)},sa.prototype.lower=function(e){var t=la(this._layers,e);ua(this,t,t-1)},sa.prototype.raiseToTop=function(e){var t=la(this._layers,e);t!==this._layers.length-1&&(this._layers.splice(t,1),this._layers.push(e),this._update(),this.layerMoved.raiseEvent(e,this._layers.length-1,t))},sa.prototype.lowerToBottom=function(e){var t=la(this._layers,e);0!==t&&(this._layers.splice(t,1),this._layers.splice(0,0,e),this._update(),this.layerMoved.raiseEvent(e,0,t))};var da=new T.default;sa.prototype.pickImageryLayerFeatures=function(e,t){var a=t.globe.pick(e,t);if(Object(o.default)(a)){for(var i,r=t.globe.ellipsoid.cartesianToCartographic(a),n=t.globe._surface._tilesToRender,s=0;!Object(o.default)(i)&&s<n.length;++s){var l=n[s];T.default.contains(l.rectangle,r)&&(i=l)}if(Object(o.default)(i)){for(var u=i.data.imagery,d=[],f=[],c=u.length-1;c>=0;--c){var h=u[c],m=h.readyImagery;if(Object(o.default)(m)){var p=m.imageryLayer.imageryProvider;if(Object(o.default)(p.pickFeatures)&&T.default.contains(m.rectangle,r)){var _=da;if(_.west=K.default.lerp(i.rectangle.west,i.rectangle.east,h.textureCoordinateRectangle.x-1/1024),_.east=K.default.lerp(i.rectangle.west,i.rectangle.east,h.textureCoordinateRectangle.z+1/1024),_.south=K.default.lerp(i.rectangle.south,i.rectangle.north,h.textureCoordinateRectangle.y-1/1024),_.north=K.default.lerp(i.rectangle.south,i.rectangle.north,h.textureCoordinateRectangle.w+1/1024),T.default.contains(_,r)){var g=p.pickFeatures(m.x,m.y,m.level,r.longitude,r.latitude);Object(o.default)(g)&&(d.push(g),f.push(m.imageryLayer))}}}}if(0!==d.length)return M.default.all(d,(function(e){for(var t=[],a=0;a<e.length;++a){var i=e[a],n=f[a];if(Object(o.default)(i)&&i.length>0)for(var s=0;s<i.length;++s){var l=i[s];l.imageryLayer=n,Object(o.default)(l.position)||(l.position=r),t.push(l)}}return t}))}}},sa.prototype.queueReprojectionCommands=function(e){for(var t=this._layers,a=0,i=t.length;a<i;++a)t[a].queueReprojectionCommands(e)},sa.prototype.cancelReprojections=function(){for(var e=this._layers,t=0,a=e.length;t<a;++t)e[t].cancelReprojections()},sa.prototype.isDestroyed=function(){return!1},sa.prototype.destroy=function(){return this.removeAll(!0),Object(l.default)(this)},sa.prototype._update=function(){var e,t,a,i,r=!0,n=this._layers;for(a=0,i=n.length;a<i;++a)(t=n[a])._layerIndex=a,t.show?(t._isBaseLayer=r,r=!1):t._isBaseLayer=!1,t.show!==t._show&&(Object(o.default)(t._show)&&(Object(o.default)(e)||(e=[]),e.push(t)),t._show=t.show);if(Object(o.default)(e))for(a=0,i=e.length;a<i;++a)t=e[a],this.layerShownOrHidden.raiseEvent(t,t._layerIndex,t.show)};var fa=sa,ca=a(100),ha=a(169),ma=a(422);function pa(e){this._ellipsoid=new ma.a(e.ellipsoid,i.default.ZERO)}Object(s.default)(pa.prototype,{ellipsoid:{get:function(){return this._ellipsoid}}});var _a=pa;function ga(e){this._tilingScheme=e.tilingScheme,this._x=e.x,this._y=e.y,this._level=e.level,this._parent=e.parent,this._rectangle=this._tilingScheme.tileXYToRectangle(this._x,this._y,this._level),this._southwestChild=void 0,this._southeastChild=void 0,this._northwestChild=void 0,this._northeastChild=void 0,this.replacementPrevious=void 0,this.replacementNext=void 0,this._distance=0,this._loadPriority=0,this._customData=[],this._frameUpdated=void 0,this._lastSelectionResult=Qe.NONE,this._lastSelectionResultFrame=void 0,this._loadedCallbacks={},this.state=Ae.START,this.renderable=!1,this.upsampledFromParent=!1,this.data=void 0}function va(e){Object(o.default)(e)&&e.freeResources()}ga.createLevelZeroTiles=function(e){for(var t=e.getNumberOfXTilesAtLevel(0),a=e.getNumberOfYTilesAtLevel(0),i=new Array(t*a),r=0,n=0;n<a;++n)for(var o=0;o<t;++o)i[r++]=new ga({tilingScheme:e,x:o,y:n,level:0});return i},ga.prototype._updateCustomData=function(e,t,a){var i,r,n,s=this.customData;if(Object(o.default)(t)&&Object(o.default)(a)){for(s=s.filter((function(e){return-1===a.indexOf(e)})),this._customData=s,n=this._rectangle,i=0;i<t.length;++i)r=t[i],T.default.contains(n,r.positionCartographic)&&s.push(r);this._frameUpdated=e}else{var l=this._parent;if(Object(o.default)(l)&&this._frameUpdated!==l._frameUpdated){s.length=0,n=this._rectangle;var u=l.customData;for(i=0;i<u.length;++i)r=u[i],T.default.contains(n,r.positionCartographic)&&s.push(r);this._frameUpdated=l._frameUpdated}}},Object(s.default)(ga.prototype,{tilingScheme:{get:function(){return this._tilingScheme}},x:{get:function(){return this._x}},y:{get:function(){return this._y}},level:{get:function(){return this._level}},parent:{get:function(){return this._parent}},rectangle:{get:function(){return this._rectangle}},children:{get:function(){return[this.northwestChild,this.northeastChild,this.southwestChild,this.southeastChild]}},southwestChild:{get:function(){return Object(o.default)(this._southwestChild)||(this._southwestChild=new ga({tilingScheme:this.tilingScheme,x:2*this.x,y:2*this.y+1,level:this.level+1,parent:this})),this._southwestChild}},southeastChild:{get:function(){return Object(o.default)(this._southeastChild)||(this._southeastChild=new ga({tilingScheme:this.tilingScheme,x:2*this.x+1,y:2*this.y+1,level:this.level+1,parent:this})),this._southeastChild}},northwestChild:{get:function(){return Object(o.default)(this._northwestChild)||(this._northwestChild=new ga({tilingScheme:this.tilingScheme,x:2*this.x,y:2*this.y,level:this.level+1,parent:this})),this._northwestChild}},northeastChild:{get:function(){return Object(o.default)(this._northeastChild)||(this._northeastChild=new ga({tilingScheme:this.tilingScheme,x:2*this.x+1,y:2*this.y,level:this.level+1,parent:this})),this._northeastChild}},customData:{get:function(){return this._customData}},needsLoading:{get:function(){return this.state<Ae.DONE}},eligibleForUnloading:{get:function(){var e=!0;return Object(o.default)(this.data)&&(e=this.data.eligibleForUnloading,Object(o.default)(e)||(e=!0)),e}}}),ga.prototype.findLevelZeroTile=function(e,t,a){var i=this.tilingScheme.getNumberOfXTilesAtLevel(0);if(t<0?t+=i:t>=i&&(t-=i),!(a<0||a>=this.tilingScheme.getNumberOfYTilesAtLevel(0)))return e.filter((function(e){return e.x===t&&e.y===a}))[0]},ga.prototype.findTileToWest=function(e){var t=this.parent;if(void 0===t)return this.findLevelZeroTile(e,this.x-1,this.y);if(t.southeastChild===this)return t.southwestChild;if(t.northeastChild===this)return t.northwestChild;var a=t.findTileToWest(e);return void 0!==a?t.southwestChild===this?a.southeastChild:a.northeastChild:void 0},ga.prototype.findTileToEast=function(e){var t=this.parent;if(void 0===t)return this.findLevelZeroTile(e,this.x+1,this.y);if(t.southwestChild===this)return t.southeastChild;if(t.northwestChild===this)return t.northeastChild;var a=t.findTileToEast(e);return void 0!==a?t.southeastChild===this?a.southwestChild:a.northwestChild:void 0},ga.prototype.findTileToSouth=function(e){var t=this.parent;if(void 0===t)return this.findLevelZeroTile(e,this.x,this.y+1);if(t.northwestChild===this)return t.southwestChild;if(t.northeastChild===this)return t.southeastChild;var a=t.findTileToSouth(e);return void 0!==a?t.southwestChild===this?a.northwestChild:a.northeastChild:void 0},ga.prototype.findTileToNorth=function(e){var t=this.parent;if(void 0===t)return this.findLevelZeroTile(e,this.x,this.y-1);if(t.southwestChild===this)return t.northwestChild;if(t.southeastChild===this)return t.northeastChild;var a=t.findTileToNorth(e);return void 0!==a?t.northwestChild===this?a.southwestChild:a.southeastChild:void 0},ga.prototype.freeResources=function(){this.state=Ae.START,this.renderable=!1,this.upsampledFromParent=!1,Object(o.default)(this.data)&&Object(o.default)(this.data.freeResources)&&this.data.freeResources(),va(this._southwestChild),this._southwestChild=void 0,va(this._southeastChild),this._southeastChild=void 0,va(this._northwestChild),this._northwestChild=void 0,va(this._northeastChild),this._northeastChild=void 0};var ya=ga;function ba(){this.head=void 0,this.tail=void 0,this.count=0,this._lastBeforeStartOfFrame=void 0}function wa(e,t){var a=t.replacementPrevious,i=t.replacementNext;t===e._lastBeforeStartOfFrame&&(e._lastBeforeStartOfFrame=i),t===e.head?e.head=i:a.replacementNext=i,t===e.tail?e.tail=a:i.replacementPrevious=a,t.replacementPrevious=void 0,t.replacementNext=void 0,--e.count}ba.prototype.markStartOfRenderFrame=function(){this._lastBeforeStartOfFrame=this.head},ba.prototype.trimTiles=function(e){for(var t=this.tail,a=!0;a&&Object(o.default)(this._lastBeforeStartOfFrame)&&this.count>e&&Object(o.default)(t);){a=t!==this._lastBeforeStartOfFrame;var i=t.replacementPrevious;t.eligibleForUnloading&&(t.freeResources(),wa(this,t)),t=i}},ba.prototype.markTileRendered=function(e){var t=this.head;if(t!==e){if(++this.count,!Object(o.default)(t))return e.replacementPrevious=void 0,e.replacementNext=void 0,this.head=e,void(this.tail=e);(Object(o.default)(e.replacementPrevious)||Object(o.default)(e.replacementNext))&&wa(this,e),e.replacementPrevious=void 0,e.replacementNext=t,t.replacementPrevious=e,this.head=e}else e===this._lastBeforeStartOfFrame&&(this._lastBeforeStartOfFrame=e.replacementNext)};var Oa,xa=ba;function Ca(e){this._tileProvider=e.tileProvider,this._tileProvider.quadtree=this,this._debug={enableDebugOutput:!1,maxDepth:0,maxDepthVisited:0,tilesVisited:0,tilesCulled:0,tilesRendered:0,tilesWaitingForChildren:0,lastMaxDepth:-1,lastMaxDepthVisited:-1,lastTilesVisited:-1,lastTilesCulled:-1,lastTilesRendered:-1,lastTilesWaitingForChildren:-1,suspendLodUpdate:!1};var t=this._tileProvider.tilingScheme.ellipsoid;this._tilesToRender=[],this._tileLoadQueueHigh=[],this._tileLoadQueueMedium=[],this._tileLoadQueueLow=[],this._tileReplacementQueue=new xa,this._levelZeroTiles=void 0,this._loadQueueTimeSlice=5,this._tilesInvalidated=!1,this._addHeightCallbacks=[],this._removeHeightCallbacks=[],this._tileToUpdateHeights=[],this._lastTileIndex=0,this._updateHeightsTimeSlice=2,this._cameraPositionCartographic=void 0,this._cameraReferenceFrameOriginCartographic=void 0,this.maximumScreenSpaceError=Object(n.default)(e.maximumScreenSpaceError,2),this.tileCacheSize=Object(n.default)(e.tileCacheSize,100),this.loadingDescendantLimit=20,this.preloadAncestors=!0,this.preloadSiblings=!1,this._occluders=new _a({ellipsoid:t}),this._tileLoadProgressEvent=new w.default,this._lastTileLoadQueueLength=0,this._lastSelectionFrameNumber=void 0}function Ta(e){var t=e._debug;t.maxDepth=0,t.maxDepthVisited=0,t.tilesVisited=0,t.tilesCulled=0,t.tilesRendered=0,t.tilesWaitingForChildren=0,e._tileLoadQueueHigh.length=0,e._tileLoadQueueMedium.length=0,e._tileLoadQueueLow.length=0}Object(s.default)(Ca.prototype,{tileProvider:{get:function(){return this._tileProvider}},tileLoadProgressEvent:{get:function(){return this._tileLoadProgressEvent}},occluders:{get:function(){return this._occluders}}}),Ca.prototype.invalidateAllTiles=function(){this._tilesInvalidated=!0},Ca.prototype.forEachLoadedTile=function(e){for(var t=this._tileReplacementQueue.head;Object(o.default)(t);)t.state!==Ae.START&&e(t),t=t.replacementNext},Ca.prototype.forEachRenderedTile=function(e){for(var t=this._tilesToRender,a=0,i=t.length;a<i;++a)e(t[a])},Ca.prototype.updateHeight=function(e,t){var a=this,i={positionOnEllipsoidSurface:void 0,positionCartographic:e,level:-1,callback:t,removeFunc:function(){for(var e=a._addHeightCallbacks,t=e.length,r=0;r<t;++r)if(e[r]===i){e.splice(r,1);break}a._removeHeightCallbacks.push(i)}};return a._addHeightCallbacks.push(i),i.removeFunc},Ca.prototype.update=function(e){Object(o.default)(this._tileProvider.update)&&this._tileProvider.update(e)},Ca.prototype.beginFrame=function(e){e.passes.render&&(this._tilesInvalidated&&(!function(e){var t=e._tileReplacementQueue;t.head=void 0,t.tail=void 0,t.count=0,Ta(e);var a=e._levelZeroTiles;if(Object(o.default)(a))for(var i=0;i<a.length;++i){for(var r=a[i].customData,n=r.length,s=0;s<n;++s){var l=r[s];l.level=0,e._addHeightCallbacks.push(l)}a[i].freeResources()}e._levelZeroTiles=void 0,e._tileProvider.cancelReprojections()}(this),this._tilesInvalidated=!1),this._tileProvider.initialize(e),Ta(this),this._debug.suspendLodUpdate||this._tileReplacementQueue.markStartOfRenderFrame())},Ca.prototype.render=function(e){var t=e.passes,a=this._tileProvider;t.render&&(a.beginUpdate(e),function(e,t){var a,i=e._debug;if(i.suspendLodUpdate)return;e._tilesToRender.length=0;var r,n=e._tileProvider;if(!Object(o.default)(e._levelZeroTiles)){if(!n.ready)return;var s=n.tilingScheme;e._levelZeroTiles=ya.createLevelZeroTiles(s);var l=e._levelZeroTiles.length;if(Pa.length<l)for(Pa=new Array(l),a=0;a<l;++a)void 0===Pa[a]&&(Pa[a]=new Ia)}e._occluders.ellipsoid.cameraPosition=t.camera.positionWC;var u=e._levelZeroTiles,d=u.length>1?e._occluders:void 0;Oa=t.camera.positionCartographic,u.sort(Aa);var f,c=e._addHeightCallbacks,h=e._removeHeightCallbacks,m=t.frameNumber;if(c.length>0||h.length>0){for(a=0,f=u.length;a<f;++a)(r=u[a])._updateCustomData(m,c,h);c.length=0,h.length=0}var p=t.camera;e._cameraPositionCartographic=p.positionCartographic;var _=J.default.getTranslation(p.transform,Sa);for(e._cameraReferenceFrameOriginCartographic=e.tileProvider.tilingScheme.ellipsoid.cartesianToCartographic(_,e._cameraReferenceFrameOriginCartographic),a=0,f=u.length;a<f;++a)r=u[a],e._tileReplacementQueue.markTileRendered(r),r.renderable?La(e,r,n,t,d,!1,Pa[a]):(Da(e,e._tileLoadQueueHigh,r,t),++i.tilesWaitingForChildren);e._lastSelectionFrameNumber=m}(this,e),function(e,t){for(var a=e._tileProvider,i=e._tilesToRender,r=0,n=i.length;r<n;++r){var o=i[r];a.showTileThisFrame(o,t)}}(this,e),a.endUpdate(e)),t.pick&&this._tilesToRender.length>0&&a.updateForPick(e)},Ca.prototype.endFrame=function(e){e.passes.render&&e.mode!==L.a.MORPHING&&(function(e,t){var a=e._tileLoadQueueHigh,i=e._tileLoadQueueMedium,r=e._tileLoadQueueLow;if(0===a.length&&0===i.length&&0===r.length)return;e._tileReplacementQueue.trimTiles(e.tileCacheSize);var n=Object(ca.default)()+e._loadQueueTimeSlice,o=e._tileProvider,s=Ua(e,t,o,n,a,!1);s=Ua(e,t,o,n,i,s),Ua(e,t,o,n,r,s)}(this,e),function(e,t){if(!e.tileProvider.ready)return;var a=ka;a.length=0;var r,s=e._tileToUpdateHeights,l=e._tileProvider.terrainProvider,u=Object(ca.default)(),d=e._updateHeightsTimeSlice,f=u+d,c=t.mode,h=t.mapProjection,m=e.tileProvider.tilingScheme.ellipsoid;for(;s.length>0;){var p=s[0];if(Object(o.default)(p.data)&&Object(o.default)(p.data.mesh)){var _=p.customData,g=_.length,v=!1;for(r=e._lastTileIndex;r<g;++r){var b=_[r];if(p.level>b.level){if(Object(o.default)(b.positionOnEllipsoidSurface)||(b.positionOnEllipsoidSurface=i.default.fromRadians(b.positionCartographic.longitude,b.positionCartographic.latitude,0,m)),c===L.a.SCENE3D){var w=m.geodeticSurfaceNormal(b.positionOnEllipsoidSurface,za.direction),O=m.getSurfaceNormalIntersectionWithZAxis(b.positionOnEllipsoidSurface,11500,za.origin);if(!Object(o.default)(O)){var x;Object(o.default)(p.data.tileBoundingRegion)&&(x=p.data.tileBoundingRegion.minimumHeight);var C=Math.min(Object(n.default)(x,0),-11500),E=i.default.multiplyByScalar(w,Math.abs(C)+1,Ha);i.default.subtract(b.positionOnEllipsoidSurface,E,za.origin)}}else y.default.clone(b.positionCartographic,Ba),Ba.height=-11500,h.project(Ba,Ha),i.default.fromElements(Ha.z,Ha.x,Ha.y,Ha),i.default.clone(Ha,za.origin),i.default.clone(i.default.UNIT_X,za.direction);var A=p.data.pick(za,c,h,!1,Ha);Object(o.default)(A)&&(b.callback(A),b.level=p.level)}else if(p.level===b.level){for(var S,P=p.children,D=P.length,I=0;I<D&&(S=P[I],!T.default.contains(S.rectangle,b.positionCartographic));++I);var M=l.getTileDataAvailable(S.x,S.y,S.level),F=p.parent;(Object(o.default)(M)&&!M||Object(o.default)(F)&&Object(o.default)(F.data)&&Object(o.default)(F.data.terrainData)&&!F.data.terrainData.isChildAvailable(F.x,F.y,S.x,S.y))&&b.removeFunc()}if(Object(ca.default)()>=f){v=!0;break}}if(v){e._lastTileIndex=r;break}e._lastTileIndex=0,s.shift()}else{var R=p._lastSelectionResultFrame===e._lastSelectionFrameNumber?p._lastSelectionResult:Qe.NONE;R!==Qe.RENDERED&&R!==Qe.CULLED_BUT_NEEDED||a.push(p),s.shift(),e._lastTileIndex=0}}for(r=0;r<a.length;r++)s.push(a[r])}(this,e),function(e,t){var a=e._tileLoadQueueHigh.length+e._tileLoadQueueMedium.length+e._tileLoadQueueLow.length;(a!==e._lastTileLoadQueueLength||e._tilesInvalidated)&&(t.afterRender.push(w.default.prototype.raiseEvent.bind(e._tileLoadProgressEvent,a)),e._lastTileLoadQueueLength=a);var i=e._debug;i.enableDebugOutput&&!i.suspendLodUpdate&&(i.maxDepth=e._tilesToRender.reduce((function(e,t){return Math.max(e,t.level)}),-1),i.tilesRendered=e._tilesToRender.length,i.tilesVisited===i.lastTilesVisited&&i.tilesRendered===i.lastTilesRendered&&i.tilesCulled===i.lastTilesCulled&&i.maxDepth===i.lastMaxDepth&&i.tilesWaitingForChildren===i.lastTilesWaitingForChildren&&i.maxDepthVisited===i.lastMaxDepthVisited||(console.log("Visited "+i.tilesVisited+", Rendered: "+i.tilesRendered+", Culled: "+i.tilesCulled+", Max Depth Rendered: "+i.maxDepth+", Max Depth Visited: "+i.maxDepthVisited+", Waiting for children: "+i.tilesWaitingForChildren),i.lastTilesVisited=i.tilesVisited,i.lastTilesRendered=i.tilesRendered,i.lastTilesCulled=i.tilesCulled,i.lastMaxDepth=i.maxDepth,i.lastTilesWaitingForChildren=i.tilesWaitingForChildren,i.lastMaxDepthVisited=i.maxDepthVisited))}(this,e))},Ca.prototype.isDestroyed=function(){return!1},Ca.prototype.destroy=function(){this._tileProvider=this._tileProvider&&this._tileProvider.destroy()};var Ea=new y.default;function Aa(e,t){var a=T.default.center(e.rectangle,Ea),i=a.longitude-Oa.longitude,r=a.latitude-Oa.latitude,n=(a=T.default.center(t.rectangle,Ea)).longitude-Oa.longitude,o=a.latitude-Oa.latitude;return i*i+r*r-(n*n+o*o)}var Sa=new i.default,Pa=[];function Da(e,t,a,i){a.needsLoading&&(void 0!==e.tileProvider.computeTileLoadPriority&&(a._loadPriority=e.tileProvider.computeTileLoadPriority(a,i)),t.push(a))}function Ia(){this.allAreRenderable=!0,this.anyWereRenderedLastFrame=!1,this.notYetRenderableCount=0}function Ma(){this.southwest=new Ia,this.southeast=new Ia,this.northwest=new Ia,this.northeast=new Ia}Ma.prototype.combine=function(e){var t=this.southwest,a=this.southeast,i=this.northwest,r=this.northeast;e.allAreRenderable=t.allAreRenderable&&a.allAreRenderable&&i.allAreRenderable&&r.allAreRenderable,e.anyWereRenderedLastFrame=t.anyWereRenderedLastFrame||a.anyWereRenderedLastFrame||i.anyWereRenderedLastFrame||r.anyWereRenderedLastFrame,e.notYetRenderableCount=t.notYetRenderableCount+a.notYetRenderableCount+i.notYetRenderableCount+r.notYetRenderableCount};for(var Fa=new Array(31),Ra=0;Ra<Fa.length;++Ra)Fa[Ra]=new Ma;function Na(e,t,a,i,r){var n=e._debug;++n.tilesVisited,e._tileReplacementQueue.markTileRendered(a),a._updateCustomData(t.frameNumber),a.level>n.maxDepthVisited&&(n.maxDepthVisited=a.level);var s=function(e,t,a){if(t.mode===L.a.SCENE2D||t.camera.frustum instanceof ee.a||t.camera.frustum instanceof ha.a)return function(e,t,a){var i=t.camera.frustum;Object(o.default)(i._offCenterFrustum)&&(i=i._offCenterFrustum);var r=t.context,n=r.drawingBufferWidth,s=r.drawingBufferHeight,l=e._tileProvider.getLevelMaximumGeometricError(a.level),u=Math.max(i.top-i.bottom,i.right-i.left)/Math.max(n,s),d=l/u;t.fog.enabled&&t.mode!==L.a.SCENE2D&&(d-=K.default.fog(a._distance,t.fog.density)*t.fog.sse);return d/=t.pixelRatio}(e,t,a);var i=e._tileProvider.getLevelMaximumGeometricError(a.level),r=a._distance,n=t.context.drawingBufferHeight,s=t.camera.frustum.sseDenominator,l=i*n/(r*s);t.fog.enabled&&(l-=K.default.fog(r,t.fog.density)*t.fog.sse);return l/=t.pixelRatio}(e,t,a)<e.maximumScreenSpaceError,l=a.southwestChild,u=a.southeastChild,d=a.northwestChild,f=a.northeastChild,c=e._lastSelectionFrameNumber,h=a._lastSelectionResultFrame===c?a._lastSelectionResult:Qe.NONE,m=e.tileProvider;if(s||i){var p=Qe.originalResult(h)===Qe.RENDERED,_=Qe.originalResult(h)===Qe.CULLED||h===Qe.NONE,g=a.state===Ae.DONE,v=p||_||g;if(v||Object(o.default)(m.canRenderWithoutLosingDetail)&&(v=m.canRenderWithoutLosingDetail(a)),v)return s&&Da(e,e._tileLoadQueueMedium,a,t),ja(e,a),r.allAreRenderable=a.renderable,r.anyWereRenderedLastFrame=h===Qe.RENDERED,r.notYetRenderableCount=a.renderable?0:1,a._lastSelectionResultFrame=t.frameNumber,a._lastSelectionResult=Qe.RENDERED,void(r.anyWereRenderedLastFrame||e._tileToUpdateHeights.push(a));i=!0,s&&Da(e,e._tileLoadQueueHigh,a,t)}if(m.canRefine(a)){if(l.upsampledFromParent&&u.upsampledFromParent&&d.upsampledFromParent&&f.upsampledFromParent)return ja(e,a),Da(e,e._tileLoadQueueMedium,a,t),e._tileReplacementQueue.markTileRendered(l),e._tileReplacementQueue.markTileRendered(u),e._tileReplacementQueue.markTileRendered(d),e._tileReplacementQueue.markTileRendered(f),r.allAreRenderable=a.renderable,r.anyWereRenderedLastFrame=h===Qe.RENDERED,r.notYetRenderableCount=a.renderable?0:1,a._lastSelectionResultFrame=t.frameNumber,a._lastSelectionResult=Qe.RENDERED,void(r.anyWereRenderedLastFrame||e._tileToUpdateHeights.push(a));a._lastSelectionResultFrame=t.frameNumber,a._lastSelectionResult=Qe.REFINED;var y=e._tilesToRender.length,b=e._tileLoadQueueLow.length,w=e._tileLoadQueueMedium.length,O=e._tileLoadQueueHigh.length,x=e._tileToUpdateHeights.length;if(function(e,t,a,i,r,n,o,s){var l=n.camera.positionCartographic,u=e._tileProvider,d=e._occluders,f=Fa[t.level],c=f.southwest,h=f.southeast,m=f.northwest,p=f.northeast;l.longitude<t.rectangle.east?l.latitude<t.rectangle.north?(La(e,t,u,n,d,o,c),La(e,a,u,n,d,o,h),La(e,i,u,n,d,o,m),La(e,r,u,n,d,o,p)):(La(e,i,u,n,d,o,m),La(e,t,u,n,d,o,c),La(e,r,u,n,d,o,p),La(e,a,u,n,d,o,h)):l.latitude<t.rectangle.north?(La(e,a,u,n,d,o,h),La(e,t,u,n,d,o,c),La(e,r,u,n,d,o,p),La(e,i,u,n,d,o,m)):(La(e,r,u,n,d,o,p),La(e,i,u,n,d,o,m),La(e,a,u,n,d,o,h),La(e,t,u,n,d,o,c));f.combine(s)}(e,l,u,d,f,t,i,r),y!==e._tilesToRender.length){var C=r.allAreRenderable,T=r.anyWereRenderedLastFrame,E=r.notYetRenderableCount,A=!1;if(!C&&!T){for(var S=e._tilesToRender,P=y;P<S.length;++P)for(var D=S[P];void 0!==D&&D._lastSelectionResult!==Qe.KICKED&&D!==a;)D._lastSelectionResult=Qe.kick(D._lastSelectionResult),D=D.parent;e._tilesToRender.length=y,e._tileToUpdateHeights.length=x,ja(e,a),a._lastSelectionResult=Qe.RENDERED;var I=h===Qe.RENDERED;!I&&E>e.loadingDescendantLimit&&(e._tileLoadQueueLow.length=b,e._tileLoadQueueMedium.length=w,e._tileLoadQueueHigh.length=O,Da(e,e._tileLoadQueueMedium,a,t),r.notYetRenderableCount=a.renderable?0:1,A=!0),r.allAreRenderable=a.renderable,r.anyWereRenderedLastFrame=I,I||e._tileToUpdateHeights.push(a),++n.tilesWaitingForChildren}e.preloadAncestors&&!A&&Da(e,e._tileLoadQueueLow,a,t)}}else a._lastSelectionResultFrame=t.frameNumber,a._lastSelectionResult=Qe.RENDERED,ja(e,a),Da(e,e._tileLoadQueueHigh,a,t),r.allAreRenderable=a.renderable,r.anyWereRenderedLastFrame=h===Qe.RENDERED,r.notYetRenderableCount=a.renderable?0:1}function La(e,t,a,i,r,n,s){if(a.computeTileVisibility(t,i,r)!==re.NONE)return Na(e,i,t,n,s);if(++e._debug.tilesCulled,e._tileReplacementQueue.markTileRendered(t),s.allAreRenderable=!0,s.anyWereRenderedLastFrame=!1,s.notYetRenderableCount=0,function(e,t){var a=t.rectangle;return Object(o.default)(e._cameraPositionCartographic)&&T.default.contains(a,e._cameraPositionCartographic)||Object(o.default)(e._cameraReferenceFrameOriginCartographic)&&T.default.contains(a,e._cameraReferenceFrameOriginCartographic)}(e,t)){Object(o.default)(t.data)&&Object(o.default)(t.data.vertexArray)||Da(e,e._tileLoadQueueMedium,t,i);var l=e._lastSelectionFrameNumber,u=t._lastSelectionResultFrame===l?t._lastSelectionResult:Qe.NONE;u!==Qe.CULLED_BUT_NEEDED&&u!==Qe.RENDERED&&e._tileToUpdateHeights.push(t),t._lastSelectionResult=Qe.CULLED_BUT_NEEDED}else e.preloadSiblings||0===t.level?(Da(e,e._tileLoadQueueLow,t,i),t._lastSelectionResult=Qe.CULLED):t._lastSelectionResult=Qe.CULLED;t._lastSelectionResultFrame=i.frameNumber}function ja(e,t){e._tilesToRender.push(t)}function Va(e,t){return e._loadPriority-t._loadPriority}function Ua(e,t,a,i,r,n){void 0!==a.computeTileLoadPriority&&r.sort(Va);for(var o=0,s=r.length;o<s&&(Object(ca.default)()<i||!n);++o){var l=r[o];e._tileReplacementQueue.markTileRendered(l),a.loadTile(t,l),n=!0}return n}var za=new C.default,Ba=new y.default,Ha=new i.default,ka=[];var Ga=Ca;function Wa(e){e=Object(n.default)(e,d.default.WGS84);var t=new b.default({ellipsoid:e}),i=new fa;this._ellipsoid=e,this._imageryLayerCollection=i,this._surfaceShaderSet=new U,this._material=void 0,this._surface=new Ga({tileProvider:new oa({terrainProvider:t,imageryLayers:i,surfaceShaderSet:this._surfaceShaderSet})}),this._terrainProvider=t,this._terrainProviderChanged=new w.default,Ya(this),this.show=!0,this._oceanNormalMapResourceDirty=!0,this._oceanNormalMapResource=new E.default({url:a(1603)}),this.maximumScreenSpaceError=2,this.tileCacheSize=100,this.loadingDescendantLimit=20,this.preloadAncestors=!0,this.preloadSiblings=!1,this.fillHighlightColor=void 0,this.enableLighting=!1,this.dynamicAtmosphereLighting=!0,this.dynamicAtmosphereLightingFromSun=!1,this.showGroundAtmosphere=!0,this.lightingFadeOutDistance=1e7,this.lightingFadeInDistance=2e7,this.nightFadeOutDistance=1e7,this.nightFadeInDistance=5e7,this.showWaterEffect=!0,this.depthTestAgainstTerrain=!1,this.shadows=Ue.default.RECEIVE_ONLY,this.splitDirection=O.default.NONE,this.atmosphereHueShift=0,this.atmosphereSaturationShift=0,this.atmosphereBrightnessShift=0,this.showSkirts=!0,this.backFaceCulling=!0,this._oceanNormalMap=void 0,this._zoomedOutOceanSpecularIntensity=void 0}function Ya(e){var t=[],a=Object(o.default)(e._material)&&(e._material.shaderSource.match(/slope/)||e._material.shaderSource.match("normalEC")),i=[I];!Object(o.default)(e._material)||a&&!e._terrainProvider.requestVertexNormals?e._surface._tileProvider.uniformMap=void 0:(i.push(e._material.shaderSource),t.push("APPLY_MATERIAL"),e._surface._tileProvider.uniformMap=e._material._uniforms),i.push(P),e._surfaceShaderSet.baseVertexShaderSource=new A.a({sources:[I,D],defines:t}),e._surfaceShaderSet.baseFragmentShaderSource=new A.a({sources:i,defines:t}),e._surfaceShaderSet.material=e._material}function Xa(e){return function(t,a){return v.default.distanceSquaredTo(t.data.pickBoundingSphere,e)-v.default.distanceSquaredTo(a.data.pickBoundingSphere,e)}}Object(s.default)(Wa.prototype,{ellipsoid:{get:function(){return this._ellipsoid}},imageryLayers:{get:function(){return this._imageryLayerCollection}},imageryLayersUpdatedEvent:{get:function(){return this._surface.tileProvider.imageryLayersUpdatedEvent}},tilesLoaded:{get:function(){return!Object(o.default)(this._surface)||this._surface.tileProvider.ready&&0===this._surface._tileLoadQueueHigh.length&&0===this._surface._tileLoadQueueMedium.length&&0===this._surface._tileLoadQueueLow.length}},baseColor:{get:function(){return this._surface.tileProvider.baseColor},set:function(e){this._surface.tileProvider.baseColor=e}},clippingPlanes:{get:function(){return this._surface.tileProvider.clippingPlanes},set:function(e){this._surface.tileProvider.clippingPlanes=e}},cartographicLimitRectangle:{get:function(){return this._surface.tileProvider.cartographicLimitRectangle},set:function(e){Object(o.default)(e)||(e=T.default.clone(T.default.MAX_VALUE)),this._surface.tileProvider.cartographicLimitRectangle=e}},oceanNormalMapUrl:{get:function(){return this._oceanNormalMapResource.url},set:function(e){this._oceanNormalMapResource.url=e,this._oceanNormalMapResourceDirty=!0}},terrainProvider:{get:function(){return this._terrainProvider},set:function(e){e!==this._terrainProvider&&(this._terrainProvider=e,this._terrainProviderChanged.raiseEvent(e),Object(o.default)(this._material)&&Ya(this))}},terrainProviderChanged:{get:function(){return this._terrainProviderChanged}},tileLoadProgressEvent:{get:function(){return this._surface.tileLoadProgressEvent}},material:{get:function(){return this._material},set:function(e){this._material!==e&&(this._material=e,Ya(this))}}});var Qa=[],qa={start:0,stop:0};Wa.prototype.pickWorldCoordinates=function(e,t,a){var r=t.mode,n=t.mapProjection,s=Qa;s.length=0;var l,u,d,f=this._surface._tilesToRender,c=f.length;for(u=0;u<c;++u){var h=(l=f[u]).data;if(Object(o.default)(h)){var m=h.pickBoundingSphere;if(r!==L.a.SCENE3D)h.pickBoundingSphere=m=v.default.fromRectangleWithHeights2D(l.rectangle,n,h.tileBoundingRegion.minimumHeight,h.tileBoundingRegion.maximumHeight,m),i.default.fromElements(m.center.z,m.center.x,m.center.y,m.center);else{if(!Object(o.default)(h.renderedMesh))continue;v.default.clone(h.renderedMesh.boundingSphere3D,m)}var p=x.default.raySphere(e,m,qa);Object(o.default)(p)&&s.push(l)}}for(s.sort(Xa(e.origin)),c=s.length,u=0;u<c&&(d=s[u].data.pick(e,t.mode,t.mapProjection,!0,a),!Object(o.default)(d));++u);return d},Wa.prototype.pickTriangle=function(e,t,a){var r=t.mode,n=t.mapProjection,s=Qa;s.length=0;var l,u,d,f=this._surface._tilesToRender,c=f.length;for(u=0;u<c;++u){var h=(l=f[u]).data;if(Object(o.default)(h)){var m=h.pickBoundingSphere;r!==L.a.SCENE3D?(v.default.fromRectangleWithHeights2D(l.rectangle,n,h.minimumHeight,h.maximumHeight,m),i.default.fromElements(m.center.z,m.center.x,m.center.y,m.center)):v.default.clone(h.boundingSphere3D,m);var p=x.default.raySphere(e,m,qa);Object(o.default)(p)&&s.push(l)}}for(s.sort(Xa(e.origin)),c=s.length,u=0;u<c;++u)if(d=s[u].data.pickTriangle(e,t.mode,t.mapProjection,!0,a),Object(o.default)(d)){d.tile=s[u];break}return d};var Za=new y.default;Wa.prototype.pick=function(e,t,a){if(a=this.pickWorldCoordinates(e,t,a),Object(o.default)(a)&&t.mode!==L.a.SCENE3D){a=i.default.fromElements(a.y,a.z,a.x,a);var r=t.mapProjection.unproject(a,Za);a=t.globe.ellipsoid.cartographicToCartesian(r,a)}return a};var Ka=new i.default,Ja=new i.default,$a=new y.default,ei=new C.default;function ti(e,t){return T.default.contains(e.rectangle,t)?e:void 0}Wa.prototype.getHeight=function(e){var t=this._surface._levelZeroTiles;if(Object(o.default)(t)){var a,r,s=t.length;for(r=0;r<s&&(a=t[r],!T.default.contains(a.rectangle,e));++r);if(!(r>=s)){for(var l=a;a._lastSelectionResult===Qe.REFINED;)a=ti(a.southwestChild,e)||ti(a.southeastChild,e)||ti(a.northwestChild,e)||a.northeastChild,Object(o.default)(a.data)&&Object(o.default)(a.data.renderedMesh)&&(l=a);if(a=l,Object(o.default)(a)){var u=this._surface._tileProvider.tilingScheme.ellipsoid,d=i.default.fromRadians(e.longitude,e.latitude,0,u,Ka),f=ei,c=u.geodeticSurfaceNormal(d,f.direction),h=u.getSurfaceNormalIntersectionWithZAxis(d,11500,f.origin);if(!Object(o.default)(h)){var m;Object(o.default)(a.data.tileBoundingRegion)&&(m=a.data.tileBoundingRegion.minimumHeight);var p=Math.min(Object(n.default)(m,0),-11500),_=i.default.multiplyByScalar(c,Math.abs(p)+1,Ja);i.default.subtract(d,_,f.origin)}var g=a.data.pick(f,void 0,void 0,!1,Ja);if(Object(o.default)(g))return u.cartesianToCartographic(g,$a).height}}}},Wa.prototype.update=function(e){this.show&&e.passes.render&&this._surface.update(e)},Wa.prototype.beginFrame=function(e){var t=this._surface,a=t.tileProvider,i=this.terrainProvider,r=this.showWaterEffect&&i.ready&&i.hasWaterMask;if(r&&this._oceanNormalMapResourceDirty){this._oceanNormalMapResourceDirty=!1;var n=this._oceanNormalMapResource,s=n.url;if(Object(o.default)(s)){var l=this;Object(M.default)(n.fetchImage(),(function(t){s===l._oceanNormalMapResource.url&&(l._oceanNormalMap=l._oceanNormalMap&&l._oceanNormalMap.destroy(),l._oceanNormalMap=new S.a({context:e.context,source:t}))}))}else this._oceanNormalMap=this._oceanNormalMap&&this._oceanNormalMap.destroy()}var u=e.passes,d=e.mode;u.render&&(this.showGroundAtmosphere?this._zoomedOutOceanSpecularIntensity=.4:this._zoomedOutOceanSpecularIntensity=.5,t.maximumScreenSpaceError=this.maximumScreenSpaceError,t.tileCacheSize=this.tileCacheSize,t.loadingDescendantLimit=this.loadingDescendantLimit,t.preloadAncestors=this.preloadAncestors,t.preloadSiblings=this.preloadSiblings,a.terrainProvider=this.terrainProvider,a.lightingFadeOutDistance=this.lightingFadeOutDistance,a.lightingFadeInDistance=this.lightingFadeInDistance,a.nightFadeOutDistance=this.nightFadeOutDistance,a.nightFadeInDistance=this.nightFadeInDistance,a.zoomedOutOceanSpecularIntensity=d===L.a.SCENE3D?this._zoomedOutOceanSpecularIntensity:0,a.hasWaterMask=r,a.oceanNormalMap=this._oceanNormalMap,a.enableLighting=this.enableLighting,a.dynamicAtmosphereLighting=this.dynamicAtmosphereLighting,a.dynamicAtmosphereLightingFromSun=this.dynamicAtmosphereLightingFromSun,a.showGroundAtmosphere=this.showGroundAtmosphere,a.shadows=this.shadows,a.splitDirection=this.splitDirection,a.hueShift=this.atmosphereHueShift,a.saturationShift=this.atmosphereSaturationShift,a.brightnessShift=this.atmosphereBrightnessShift,a.fillHighlightColor=this.fillHighlightColor,a.showSkirts=this.showSkirts,a.backFaceCulling=this.backFaceCulling,t.beginFrame(e))},Wa.prototype.render=function(e){this.show&&(Object(o.default)(this._material)&&this._material.update(e.context),this._surface.render(e))},Wa.prototype.endFrame=function(e){this.show&&e.passes.render&&this._surface.endFrame(e)},Wa.prototype.isDestroyed=function(){return!1},Wa.prototype.destroy=function(){return this._surfaceShaderSet=this._surfaceShaderSet&&this._surfaceShaderSet.destroy(),this._surface=this._surface&&this._surface.destroy(),this._oceanNormalMap=this._oceanNormalMap&&this._oceanNormalMap.destroy(),Object(l.default)(this)};var ai=Wa;var ii=function(e,t,a,i){this.rightAscension=e,this.declination=t,this.rotation=a,this.rotationRate=i},ri=a(44),ni=a(197),oi={},si=-.0529921,li=-.1059842,ui=13.0120009,di=13.3407154,fi=26.4057084,ci=13.064993,hi=1.7484877,mi=new ri.default;oi.ComputeMoon=function(e,t){Object(o.default)(e)||(e=ri.default.now()),mi=ri.default.addSeconds(e,32.184,mi);var a=ri.default.totalDays(mi)-2451545,i=a/ni.a.DAYS_PER_JULIAN_CENTURY,r=(125.045+si*a)*K.default.RADIANS_PER_DEGREE,n=(250.089+li*a)*K.default.RADIANS_PER_DEGREE,s=(260.008+ui*a)*K.default.RADIANS_PER_DEGREE,l=(176.625+di*a)*K.default.RADIANS_PER_DEGREE,u=(357.529+.9856003*a)*K.default.RADIANS_PER_DEGREE,d=(311.589+fi*a)*K.default.RADIANS_PER_DEGREE,f=(134.963+ci*a)*K.default.RADIANS_PER_DEGREE,c=(276.617+.3287146*a)*K.default.RADIANS_PER_DEGREE,h=(34.226+hi*a)*K.default.RADIANS_PER_DEGREE,m=(15.134+-.1589763*a)*K.default.RADIANS_PER_DEGREE,p=(119.743+.0036096*a)*K.default.RADIANS_PER_DEGREE,_=(239.961+.1643573*a)*K.default.RADIANS_PER_DEGREE,g=(25.053+12.9590088*a)*K.default.RADIANS_PER_DEGREE,v=Math.sin(r),y=Math.sin(n),b=Math.sin(s),w=Math.sin(l),O=Math.sin(u),x=Math.sin(d),C=Math.sin(f),T=Math.sin(c),E=Math.sin(h),A=Math.sin(m),S=Math.sin(p),P=Math.sin(_),D=Math.sin(g),I=Math.cos(r),M=Math.cos(n),F=Math.cos(s),R=Math.cos(l),N=Math.cos(u),L=Math.cos(d),j=Math.cos(f),V=Math.cos(c),U=Math.cos(h),z=Math.cos(m),B=Math.cos(p),H=Math.cos(_),k=Math.cos(g),G=(269.9949+.0031*i-3.8787*v-.1204*y+.07*b-.0172*w+.0072*x-.0052*A+.0043*D)*K.default.RADIANS_PER_DEGREE,W=(66.5392+.013*i+1.5419*I+.0239*M-.0278*F+.0068*R-.0029*L+9e-4*j+8e-4*z-9e-4*k)*K.default.RADIANS_PER_DEGREE,Y=(38.3213+13.17635815*a-14e-13*a*a+3.561*v+.1208*y-.0642*b+.0158*w+.0252*O-.0066*x-.0047*C-.0046*T+.0028*E+.0052*A+.004*S+.0019*P-.0044*D)*K.default.RADIANS_PER_DEGREE,X=(13.17635815-2*a*14e-13+3.561*I*si+.1208*M*li-.0642*F*ui+.0158*R*di+.0252*N*.9856003-.0066*L*fi-.0047*j*ci-.0046*V*.3287146+.0028*U*hi+.0052*z*-.1589763+.004*B*.0036096+.0019*H*.1643573-.0044*k*12.9590088)/86400*K.default.RADIANS_PER_DEGREE;return Object(o.default)(t)||(t=new ii),t.rightAscension=G,t.declination=W,t.rotation=Y,t.rotationRate=X,t};var pi=oi,_i=a(45),gi=a(55);function vi(e){Object(o.default)(e)&&"function"==typeof e||(e=pi.ComputeMoon),this._computeFunction=e}var yi=new i.default,bi=new i.default,wi=new i.default;var Oi=new _i.default,xi=new gi.default;vi.prototype.evaluate=function(e,t){Object(o.default)(e)||(e=ri.default.now());var a=this._computeFunction(e),r=function(e,t,a){var r=yi;r.x=Math.cos(e+K.default.PI_OVER_TWO),r.y=Math.sin(e+K.default.PI_OVER_TWO),r.z=0;var n=Math.cos(t),s=wi;s.x=n*Math.cos(e),s.y=n*Math.sin(e),s.z=Math.sin(t);var l=i.default.cross(s,r,bi);return Object(o.default)(a)||(a=new _i.default),a[0]=r.x,a[1]=l.x,a[2]=s.x,a[3]=r.y,a[4]=l.y,a[5]=s.y,a[6]=r.z,a[7]=l.z,a[8]=s.z,a}(a.rightAscension,a.declination,t),n=K.default.zeroToTwoPi(a.rotation),s=gi.default.fromAxisAngle(i.default.UNIT_Z,n,xi),l=_i.default.fromQuaternion(gi.default.conjugate(s,s),Oi);return _i.default.multiply(l,r,r)};var Ci=vi,Ti=a(291),Ei={};var Ai=32.184,Si=2451545;function Pi(e,t){t=ri.default.addSeconds(e,Ai,t);var a,i=ri.default.totalDays(t)-Si;return t=ri.default.addSeconds(t,(a=6.239996+.0172019696544*i,.001657*Math.sin(a+.01671*Math.sin(a))),t)}var Di=new ri.default(2451545,0,Ti.a.TAI),Ii=1e3,Mi=K.default.RADIANS_PER_DEGREE,Fi=K.default.RADIANS_PER_ARCSECOND,Ri=new _i.default;function Ni(e,t,a,r,n,s,l){a<0&&(a=-a,n+=K.default.PI);var u=e*(1-t),d=r-n,f=n,c=function(e,t){return function(e,t){var a=Math.floor(e/K.default.TWO_PI);e-=a*K.default.TWO_PI;var i=Math.cos(e)-t,r=Math.sin(e)*Math.sqrt(1-t*t),n=Math.atan2(r,i);n=K.default.zeroToTwoPi(n),e<0&&(n-=K.default.TWO_PI);return n+=a*K.default.TWO_PI}(function(e,t){var a,i=Math.floor(e/K.default.TWO_PI),r=(e-=i*K.default.TWO_PI)+t*Math.sin(e)/(1-Math.sin(e+t)+Math.sin(e)),n=Number.MAX_VALUE;for(a=0;a<Li&&Math.abs(n-r)>ji;++a){var o=(n=r)-t*Math.sin(n)-e,s=1-t*Math.cos(n);r=n-o/s}return n=r+i*K.default.TWO_PI}(e,t),t)}(s-r,t);!function(e,t){if(e<=t)return"Circular";if(e<1-t)return"Elliptical";if(e<=1+t)return"Parabolic"}(t,0);!function(e,t,a,i){var r=Math.cos(e),n=Math.sin(e),s=Math.cos(t),l=Math.sin(t),u=Math.cos(a),d=Math.sin(a);Object(o.default)(i)?(i[0]=u*r-d*n*s,i[1]=d*r+u*n*s,i[2]=n*l,i[3]=-u*n-d*r*s,i[4]=-d*n+u*r*s,i[5]=r*l,i[6]=d*l,i[7]=-u*l,i[8]=s):i=new _i.default(u*r-d*n*s,-u*n-d*r*s,d*l,d*r+u*n*s,-d*n+u*r*s,-u*l,n*l,r*l,s)}(d,a,f,Ri);var h=u*(1+t),m=Math.cos(c),p=Math.sin(c),_=h/(1+t*m);return Object(o.default)(l)?(l.x=_*m,l.y=_*p,l.z=0):l=new i.default(_*m,_*p,0),_i.default.multiplyByVector(Ri,l,l)}var Li=50,ji=K.default.EPSILON8;var Vi=149598022260.7121,Ui=100.46645683*Mi,zi=1295977422.83429*Fi,Bi=16002,Hi=21863,ki=32004,Gi=10931,Wi=14529,Yi=16368,Xi=15318,Qi=32794,qi=64e-7*14959787e4,Zi=-2273887.624,Ki=927506.794,Ji=14959787e4*-8e-7,$i=32e-7*14959787e4,er=-613351.267,tr=284235.953,ar=-164557.657,ir=-2243968.05,rr=-688150.202,nr=1017265.516,or=807828.498,sr=14e-7*14959787e4,lr=359034.888,ur=14959787e4*-28e-7,dr=329115.314,fr=10,cr=16002,hr=21863,mr=10931,pr=1473,_r=32004,gr=4387,vr=73,yr=-325e-7,br=-322e-7,wr=1e-7*-79,Or=232*1e-7,xr=1e-7*-52,Cr=97e-7,Tr=55e-7,Er=-41e-7,Ar=-105e-7,Sr=-137e-7,Pr=258e-7,Dr=35e-7,Ir=1e-7*-116,Mr=-88e-7,Fr=-112e-7,Rr=-8e-6,Nr=new ri.default(0,0,Ti.a.TAI);function Lr(e,t){Pi(e,Nr);var a=(Nr.dayNumber-Di.dayNumber+(Nr.secondsOfDay-Di.secondsOfDay)/ni.a.SECONDS_PER_DAY)/ni.a.DAYS_PER_JULIAN_CENTURY,i=a*a,r=i*a,n=r*a,o=383397.7725+.004*a,s=.055545526-16e-9*a,l=5.15668983*Mi,u=-8e-5*a+.02966*i-42e-6*r-13e-8*n,d=83.35324312*Mi,f=14643420.2669*a-38.2702*i-.045047*r+21301e-8*n,c=125.04455501*Mi,h=-6967919.3631*a+6.3602*i+.007625*r-3586e-8*n,m=218.31664563*Mi,p=1732559343.4847*a-6.391*i+.006588*r-3169e-8*n,_=297.85019547*Mi+Fi*(1602961601.209*a-6.3706*i+.006593*r-3169e-8*n),g=134.96340251*Mi+Fi*(1717915923.2178*a+31.8792*i+.051635*r-2447e-7*n),v=357.52910918*Mi+Fi*(129596581.0481*a-.5532*i+136e-6*r-1149e-8*n),y=310.17137918*Mi-Fi*(6967051.436*a+6.2068*i+.007618*r-3219e-8*n),b=2*_,w=4*_,O=6*_,x=2*g,C=3*g,T=4*g,E=2*(93.27209062*Mi+Fi*(1739527262.8478*a-12.7512*i-.001037*r+417e-8*n));o+=3400.4*Math.cos(b)-635.6*Math.cos(b-g)-235.6*Math.cos(g)+218.1*Math.cos(b-v)+181*Math.cos(b+g),s+=.014216*Math.cos(b-g)+.008551*Math.cos(b-x)-.001383*Math.cos(g)+.001356*Math.cos(b+g)-.001147*Math.cos(w-C)-914e-6*Math.cos(w-x)+869e-6*Math.cos(b-v-g)-627e-6*Math.cos(b)-394e-6*Math.cos(w-T)+282e-6*Math.cos(b-v-x)-279e-6*Math.cos(_-g)-236e-6*Math.cos(x)+231e-6*Math.cos(w)+229e-6*Math.cos(O-T)-201e-6*Math.cos(x-E),u+=486.26*Math.cos(b-E)-40.13*Math.cos(b)+37.51*Math.cos(E)+25.73*Math.cos(x-E)+19.97*Math.cos(b-v-E),f+=-55609*Math.sin(b-g)-34711*Math.sin(b-x)-9792*Math.sin(g)+9385*Math.sin(w-C)+7505*Math.sin(w-x)+5318*Math.sin(b+g)+3484*Math.sin(w-T)-3417*Math.sin(b-v-g)-2530*Math.sin(O-T)-2376*Math.sin(b)-2075*Math.sin(b-C)-1883*Math.sin(x)-1736*Math.sin(O-5*g)+1626*Math.sin(v)-1370*Math.sin(O-C),h+=-5392*Math.sin(b-E)-540*Math.sin(v)-441*Math.sin(b)+423*Math.sin(E)-288*Math.sin(x-E),p+=-3332.9*Math.sin(b)+1197.4*Math.sin(b-g)-662.5*Math.sin(v)+396.3*Math.sin(g)-218*Math.sin(b-v);var A=2*y,S=3*y;u+=46.997*Math.cos(y)*a-.614*Math.cos(b-E+y)*a+.614*Math.cos(b-E-y)*a-.0297*Math.cos(A)*i-.0335*Math.cos(y)*i+.0012*Math.cos(b-E+A)*i-16e-5*Math.cos(y)*r+4e-5*Math.cos(S)*r+4e-5*Math.cos(A)*r;var P=2.116*Math.sin(y)*a-.111*Math.sin(b-E-y)*a-.0015*Math.sin(y)*i;return f+=P,p+=P,h+=-520.77*Math.sin(y)*a+13.66*Math.sin(b-E+y)*a+1.12*Math.sin(b-y)*a-1.06*Math.sin(E-y)*a+.66*Math.sin(A)*i+.371*Math.sin(y)*i-.035*Math.sin(b-E+A)*i-.015*Math.sin(b-E+y)*i+.0014*Math.sin(y)*r-.0011*Math.sin(S)*r-9e-4*Math.sin(A)*r,Ni(o*=Ii,s,l+u*Fi,d+f*Fi,c+h*Fi,m+p*Fi,t)}var jr=-.01215058143522694;var Vr=new _i.default(1.0000000000000002,5619723173785822e-31,4690511510146299e-34,-5154129427414611e-31,.9174820620691819,-.39777715593191376,-223970096136568e-30,.39777715593191376,.9174820620691819),Ur=new i.default;Ei.computeSunPositionInEarthInertialFrame=function(e,t){return Object(o.default)(e)||(e=ri.default.now()),Object(o.default)(t)||(t=new i.default),Ur=function(e,t){Pi(e,Nr);var a=(Nr.dayNumber-Di.dayNumber+(Nr.secondsOfDay-Di.secondsOfDay)/ni.a.SECONDS_PER_DAY)/(10*ni.a.DAYS_PER_JULIAN_CENTURY),i=.3595362*a,r=Vi+qi*Math.cos(Bi*i)+ir*Math.sin(Bi*i)+Zi*Math.cos(Hi*i)+rr*Math.sin(Hi*i)+Ki*Math.cos(ki*i)+nr*Math.sin(ki*i)+Ji*Math.cos(Gi*i)+or*Math.sin(Gi*i)+$i*Math.cos(Wi*i)+sr*Math.sin(Wi*i)+er*Math.cos(Yi*i)+lr*Math.sin(Yi*i)+tr*Math.cos(Xi*i)+ur*Math.sin(Xi*i)+ar*Math.cos(Qi*i)+dr*Math.sin(Qi*i),n=Ui+zi*a+yr*Math.cos(fr*i)+Ar*Math.sin(fr*i)+br*Math.cos(cr*i)+Sr*Math.sin(cr*i)+wr*Math.cos(hr*i)+Pr*Math.sin(hr*i)+Or*Math.cos(mr*i)+Dr*Math.sin(mr*i)+xr*Math.cos(pr*i)+Ir*Math.sin(pr*i)+Cr*Math.cos(_r*i)+Mr*Math.sin(_r*i)+Tr*Math.cos(gr*i)+Fr*Math.sin(gr*i)+Er*Math.cos(vr*i)+Rr*Math.sin(vr*i);return Ni(r,.0167086342-.0004203654*a,469.97289*Fi*a,102.93734808*Mi+11612.3529*Fi*a,174.87317577*Mi-8679.27034*Fi*a,n,t)}(e,Ur),t=i.default.negate(Ur,t),function(e,t){t=Lr(e,t),i.default.multiplyByScalar(t,jr,t)}(e,Ur),i.default.subtract(t,Ur,t),_i.default.multiplyByVector(Vr,t,t),t},Ei.computeMoonPositionInEarthInertialFrame=function(e,t){return Object(o.default)(e)||(e=ri.default.now()),t=Lr(e,t),_i.default.multiplyByVector(Vr,t,t),t};var zr=Ei,Br=a(64),Hr=a(363),kr=a(80),Gr="#ifdef WRITE_DEPTH\n#ifdef GL_EXT_frag_depth\n#extension GL_EXT_frag_depth : enable\n#endif\n#endif\n\nuniform vec3 u_radii;\nuniform vec3 u_oneOverEllipsoidRadiiSquared;\n\nvarying vec3 v_positionEC;\n\nvec4 computeEllipsoidColor(czm_ray ray, float intersection, float side)\n{\n    vec3 positionEC = czm_pointAlongRay(ray, intersection);\n    vec3 positionMC = (czm_inverseModelView * vec4(positionEC, 1.0)).xyz;\n    vec3 geodeticNormal = normalize(czm_geodeticSurfaceNormal(positionMC, vec3(0.0), u_oneOverEllipsoidRadiiSquared));\n    vec3 sphericalNormal = normalize(positionMC / u_radii);\n    vec3 normalMC = geodeticNormal * side;              // normalized surface normal (always facing the viewer) in model coordinates\n    vec3 normalEC = normalize(czm_normal * normalMC);   // normalized surface normal in eye coordiantes\n\n    vec2 st = czm_ellipsoidWgs84TextureCoordinates(sphericalNormal);\n    vec3 positionToEyeEC = -positionEC;\n\n    czm_materialInput materialInput;\n    materialInput.s = st.s;\n    materialInput.st = st;\n    materialInput.str = (positionMC + u_radii) / u_radii;\n    materialInput.normalEC = normalEC;\n    materialInput.tangentToEyeMatrix = czm_eastNorthUpToEyeCoordinates(positionMC, normalEC);\n    materialInput.positionToEyeEC = positionToEyeEC;\n    czm_material material = czm_getMaterial(materialInput);\n\n#ifdef ONLY_SUN_LIGHTING\n    return czm_private_phong(normalize(positionToEyeEC), material, czm_sunDirectionEC);\n#else\n    return czm_phong(normalize(positionToEyeEC), material, czm_lightDirectionEC);\n#endif\n}\n\nvoid main()\n{\n    // PERFORMANCE_TODO: When dynamic branching is available, compute ratio of maximum and minimum radii\n    // in the vertex shader. Only when it is larger than some constant, march along the ray.\n    // Otherwise perform one intersection test which will be the common case.\n\n    // Test if the ray intersects a sphere with the ellipsoid's maximum radius.\n    // For very oblate ellipsoids, using the ellipsoid's radii for an intersection test\n    // may cause false negatives. This will discard fragments before marching the ray forward.\n    float maxRadius = max(u_radii.x, max(u_radii.y, u_radii.z)) * 1.5;\n    vec3 direction = normalize(v_positionEC);\n    vec3 ellipsoidCenter = czm_modelView[3].xyz;\n\n    float t1 = -1.0;\n    float t2 = -1.0;\n\n    float b = -2.0 * dot(direction, ellipsoidCenter);\n    float c = dot(ellipsoidCenter, ellipsoidCenter) - maxRadius * maxRadius;\n\n    float discriminant = b * b - 4.0 * c;\n    if (discriminant >= 0.0) {\n        t1 = (-b - sqrt(discriminant)) * 0.5;\n        t2 = (-b + sqrt(discriminant)) * 0.5;\n    }\n\n    if (t1 < 0.0 && t2 < 0.0) {\n        discard;\n    }\n\n    float t = min(t1, t2);\n    if (t < 0.0) {\n        t = 0.0;\n    }\n\n    // March ray forward to intersection with larger sphere and find\n    czm_ray ray = czm_ray(t * direction, direction);\n\n    vec3 ellipsoid_inverseRadii = vec3(1.0 / u_radii.x, 1.0 / u_radii.y, 1.0 / u_radii.z);\n\n    czm_raySegment intersection = czm_rayEllipsoidIntersectionInterval(ray, ellipsoidCenter, ellipsoid_inverseRadii);\n\n    if (czm_isEmpty(intersection))\n    {\n        discard;\n    }\n\n    // If the viewer is outside, compute outsideFaceColor, with normals facing outward.\n    vec4 outsideFaceColor = (intersection.start != 0.0) ? computeEllipsoidColor(ray, intersection.start, 1.0) : vec4(0.0);\n\n    // If the viewer either is inside or can see inside, compute insideFaceColor, with normals facing inward.\n    vec4 insideFaceColor = (outsideFaceColor.a < 1.0) ? computeEllipsoidColor(ray, intersection.stop, -1.0) : vec4(0.0);\n\n    gl_FragColor = mix(insideFaceColor, outsideFaceColor, outsideFaceColor.a);\n    gl_FragColor.a = 1.0 - (1.0 - insideFaceColor.a) * (1.0 - outsideFaceColor.a);\n\n#ifdef WRITE_DEPTH\n#ifdef GL_EXT_frag_depth\n    t = (intersection.start != 0.0) ? intersection.start : intersection.stop;\n    vec3 positionEC = czm_pointAlongRay(ray, t);\n    vec4 positionCC = czm_projection * vec4(positionEC, 1.0);\n#ifdef LOG_DEPTH\n    czm_writeLogDepth(1.0 + positionCC.w);\n#else\n    float z = positionCC.z / positionCC.w;\n\n    float n = czm_depthRange.near;\n    float f = czm_depthRange.far;\n\n    gl_FragDepthEXT = (z * (f - n) + f + n) * 0.5;\n#endif\n#endif\n#endif\n}\n",Wr="attribute vec3 position;\n\nuniform vec3 u_radii;\n\nvarying vec3 v_positionEC;\n\nvoid main()\n{\n    // In the vertex data, the cube goes from (-1.0, -1.0, -1.0) to (1.0, 1.0, 1.0) in model coordinates.\n    // Scale to consider the radii.  We could also do this once on the CPU when using the BoxGeometry,\n    // but doing it here allows us to change the radii without rewriting the vertex data, and\n    // allows all ellipsoids to reuse the same vertex data.\n    vec4 p = vec4(u_radii * position, 1.0);\n\n    v_positionEC = (czm_modelView * p).xyz;     // position in eye coordinates\n    gl_Position = czm_modelViewProjection * p;  // position in clip coordinates\n\n    // With multi-frustum, when the ellipsoid primitive is positioned on the intersection of two frustums\n    // and close to terrain, the terrain (writes depth) in the closest frustum can overwrite part of the\n    // ellipsoid (does not write depth) that was rendered in the farther frustum.\n    //\n    // Here, we clamp the depth in the vertex shader to avoid being overwritten; however, this creates\n    // artifacts since some fragments can be alpha blended twice.  This is solved by only rendering\n    // the ellipsoid in the closest frustum to the viewer.\n    gl_Position.z = clamp(gl_Position.z, czm_depthRange.near, czm_depthRange.far);\n\n    czm_vertexLogDepth();\n}\n",Yr=a(202),Xr=a(216),Qr={position:0};function qr(e){e=Object(n.default)(e,n.default.EMPTY_OBJECT),this.center=i.default.clone(Object(n.default)(e.center,i.default.ZERO)),this._center=new i.default,this.radii=i.default.clone(e.radii),this._radii=new i.default,this._oneOverEllipsoidRadiiSquared=new i.default,this._boundingSphere=new v.default,this.modelMatrix=J.default.clone(Object(n.default)(e.modelMatrix,J.default.IDENTITY)),this._modelMatrix=new J.default,this._computedModelMatrix=new J.default,this.show=Object(n.default)(e.show,!0),this.material=Object(n.default)(e.material,Xr.a.fromType(Xr.a.ColorType)),this._material=void 0,this._translucent=void 0,this.id=e.id,this._id=void 0,this.debugShowBoundingVolume=Object(n.default)(e.debugShowBoundingVolume,!1),this.onlySunLighting=Object(n.default)(e.onlySunLighting,!1),this._onlySunLighting=!1,this._depthTestEnabled=Object(n.default)(e.depthTestEnabled,!0),this._useLogDepth=!1,this._sp=void 0,this._rs=void 0,this._va=void 0,this._pickSP=void 0,this._pickId=void 0,this._colorCommand=new ue.a({owner:Object(n.default)(e._owner,this)}),this._pickCommand=new ue.a({owner:Object(n.default)(e._owner,this),pickOnly:!0});var t=this;this._uniforms={u_radii:function(){return t.radii},u_oneOverEllipsoidRadiiSquared:function(){return t._oneOverEllipsoidRadiiSquared}},this._pickUniforms={czm_pickColor:function(){return t._pickId.color}}}var Zr="#ifdef GL_EXT_frag_depth \n#extension GL_EXT_frag_depth : enable \n#endif \n\n";qr.prototype.update=function(e){if(this.show&&e.mode===L.a.SCENE3D&&Object(o.default)(this.center)&&Object(o.default)(this.radii)){var t=e.context,a=this.material.isTranslucent(),r=this._translucent!==a;Object(o.default)(this._rs)&&!r||(this._translucent=a,this._rs=fe.a.fromCache({cull:{enabled:!0,face:Yr.a.FRONT},depthTest:{enabled:this._depthTestEnabled},depthMask:!a&&t.fragmentDepth,blending:a?he.a.ALPHA_BLEND:void 0})),Object(o.default)(this._va)||(this._va=function(e){var t=e.cache.ellipsoidPrimitive_vertexArray;if(Object(o.default)(t))return t;var a=Hr.a.createGeometry(Hr.a.fromDimensions({dimensions:new i.default(2,2,2),vertexFormat:kr.default.POSITION_ONLY}));return t=ce.a.fromGeometry({context:e,geometry:a,attributeLocations:Qr,bufferUsage:se.a.STATIC_DRAW,interleave:!0}),e.cache.ellipsoidPrimitive_vertexArray=t,t}(t));var n=!1,s=this.radii;if(!i.default.equals(this._radii,s)){i.default.clone(s,this._radii);var l=this._oneOverEllipsoidRadiiSquared;l.x=1/(s.x*s.x),l.y=1/(s.y*s.y),l.z=1/(s.z*s.z),n=!0}J.default.equals(this.modelMatrix,this._modelMatrix)&&i.default.equals(this.center,this._center)||(J.default.clone(this.modelMatrix,this._modelMatrix),i.default.clone(this.center,this._center),J.default.multiplyByTranslation(this.modelMatrix,this.center,this._computedModelMatrix),n=!0),n&&(i.default.clone(i.default.ZERO,this._boundingSphere.center),this._boundingSphere.radius=i.default.maximumComponent(s),v.default.transform(this._boundingSphere,this._computedModelMatrix,this._boundingSphere));var u=this._material!==this.material;this._material=this.material,this._material.update(t);var d=this.onlySunLighting!==this._onlySunLighting;this._onlySunLighting=this.onlySunLighting;var f=e.useLogDepth,c=this._useLogDepth!==f;this._useLogDepth=f;var h,m,p=this._colorCommand;(u||d||r||c)&&(h=new A.a({sources:[Wr]}),m=new A.a({sources:[this.material.shaderSource,Gr]}),this.onlySunLighting&&m.defines.push("ONLY_SUN_LIGHTING"),!a&&t.fragmentDepth&&m.defines.push("WRITE_DEPTH"),this._useLogDepth&&(h.defines.push("LOG_DEPTH","DISABLE_GL_POSITION_LOG_DEPTH"),m.defines.push("LOG_DEPTH"),m.sources.push(Zr)),this._sp=R.a.replaceCache({context:t,shaderProgram:this._sp,vertexShaderSource:h,fragmentShaderSource:m,attributeLocations:Qr}),p.vertexArray=this._va,p.renderState=this._rs,p.shaderProgram=this._sp,p.uniformMap=Object(Y.default)(this._uniforms,this.material._uniforms),p.executeInClosestFrustum=a);var _=e.commandList,g=e.passes;if(g.render&&(p.boundingVolume=this._boundingSphere,p.debugShowBoundingVolume=this.debugShowBoundingVolume,p.modelMatrix=this._computedModelMatrix,p.pass=a?de.a.TRANSLUCENT:de.a.OPAQUE,_.push(p)),g.pick){var y=this._pickCommand;Object(o.default)(this._pickId)&&this._id===this.id||(this._id=this.id,this._pickId=this._pickId&&this._pickId.destroy(),this._pickId=t.createPickId({primitive:this,id:this.id})),(u||d||!Object(o.default)(this._pickSP)||c)&&(h=new A.a({sources:[Wr]}),m=new A.a({sources:[this.material.shaderSource,Gr],pickColorQualifier:"uniform"}),this.onlySunLighting&&m.defines.push("ONLY_SUN_LIGHTING"),!a&&t.fragmentDepth&&m.defines.push("WRITE_DEPTH"),this._useLogDepth&&(h.defines.push("LOG_DEPTH"),m.defines.push("LOG_DEPTH"),m.sources.push(Zr)),this._pickSP=R.a.replaceCache({context:t,shaderProgram:this._pickSP,vertexShaderSource:h,fragmentShaderSource:m,attributeLocations:Qr}),y.vertexArray=this._va,y.renderState=this._rs,y.shaderProgram=this._pickSP,y.uniformMap=Object(Y.default)(Object(Y.default)(this._uniforms,this._pickUniforms),this.material._uniforms),y.executeInClosestFrustum=a),y.boundingVolume=this._boundingSphere,y.modelMatrix=this._computedModelMatrix,y.pass=a?de.a.TRANSLUCENT:de.a.OPAQUE,_.push(y)}}},qr.prototype.isDestroyed=function(){return!1},qr.prototype.destroy=function(){return this._sp=this._sp&&this._sp.destroy(),this._pickSP=this._pickSP&&this._pickSP.destroy(),this._pickId=this._pickId&&this._pickId.destroy(),Object(l.default)(this)};var Kr=qr;function Jr(e){var t=(e=Object(n.default)(e,n.default.EMPTY_OBJECT)).textureUrl;Object(o.default)(t)||(t=a(1604)),this.show=Object(n.default)(e.show,!0),this.textureUrl=t,this._ellipsoid=Object(n.default)(e.ellipsoid,d.default.MOON),this.onlySunLighting=Object(n.default)(e.onlySunLighting,!0),this._ellipsoidPrimitive=new Kr({radii:this.ellipsoid.radii,material:Xr.a.fromType(Xr.a.ImageType),depthTestEnabled:!1,_owner:this}),this._ellipsoidPrimitive.material.translucent=!1,this._axes=new Ci}Object(s.default)(Jr.prototype,{ellipsoid:{get:function(){return this._ellipsoid}}});var $r=new _i.default,en=new _i.default,tn=new i.default,an=[];Jr.prototype.update=function(e){if(this.show){var t=this._ellipsoidPrimitive;t.material.uniforms.image=this.textureUrl,t.onlySunLighting=this.onlySunLighting;var a=e.time;Object(o.default)(Br.default.computeIcrfToFixedMatrix(a,$r))||Br.default.computeTemeToPseudoFixedMatrix(a,$r);var i=this._axes.evaluate(a,en);_i.default.transpose(i,i),_i.default.multiply($r,i,i);var r=zr.computeMoonPositionInEarthInertialFrame(a,tn);_i.default.multiplyByVector($r,r,r),J.default.fromRotationTranslation(i,r,t.modelMatrix);var n=e.commandList;return e.commandList=an,an.length=0,t.update(e),e.commandList=n,1===an.length?an[0]:void 0}},Jr.prototype.isDestroyed=function(){return!1},Jr.prototype.destroy=function(){return this._ellipsoidPrimitive=this._ellipsoidPrimitive&&this._ellipsoidPrimitive.destroy(),Object(l.default)(this)};var rn=Jr,nn=a(60),on=a(76),sn=a(231),ln=a(208),un=a(505),dn=a(106),fn=[],cn=[];function hn(e,t,a,i,r){if(!(i>=r)){var n=Math.floor(.5*(i+r));hn(e,t,a,i,n),hn(e,t,a,n+1,r),function(e,t,a,i,r,n){var o,s,l=r-i+1,u=n-r,d=fn,f=cn;for(o=0;o<l;++o)d[o]=e[i+o];for(s=0;s<u;++s)f[s]=e[r+s+1];o=0,s=0;for(var c=i;c<=n;++c){var h=d[o],m=f[s];o<l&&(s>=u||t(h,m,a)<=0)?(e[c]=h,++o):s<u&&(e[c]=m,++s)}}(e,t,a,i,n,r)}}var mn=function(e,t,a){var i=e.length,r=Math.ceil(.5*i);fn.length=r,cn.length=r,hn(e,t,a,0,i-1),fn.length=0,cn.length=0};function pn(e,t){this._occluderPosition=i.default.clone(e.center),this._occluderRadius=e.radius,this._horizonDistance=0,this._horizonPlaneNormal=void 0,this._horizonPlanePosition=void 0,this._cameraPosition=void 0,this.cameraPosition=t}var _n=new i.default;Object(s.default)(pn.prototype,{position:{get:function(){return this._occluderPosition}},radius:{get:function(){return this._occluderRadius}},cameraPosition:{set:function(e){e=i.default.clone(e,this._cameraPosition);var t,a,r,n=i.default.subtract(this._occluderPosition,e,_n),o=i.default.magnitudeSquared(n),s=this._occluderRadius*this._occluderRadius;if(o>s){t=Math.sqrt(o-s),o=1/Math.sqrt(o),a=i.default.multiplyByScalar(n,o,_n);var l=t*t*o;r=i.default.add(e,i.default.multiplyByScalar(a,l,_n),_n)}else t=Number.MAX_VALUE;this._horizonDistance=t,this._horizonPlaneNormal=a,this._horizonPlanePosition=r,this._cameraPosition=e}}}),pn.fromBoundingSphere=function(e,t,a){return Object(o.default)(a)?(i.default.clone(e.center,a._occluderPosition),a._occluderRadius=e.radius,a.cameraPosition=t,a):new pn(e,t)};var gn=new i.default;pn.prototype.isPointVisible=function(e){if(this._horizonDistance!==Number.MAX_VALUE){var t=i.default.subtract(e,this._occluderPosition,gn),a=this._occluderRadius;if((a=i.default.magnitudeSquared(t)-a*a)>0)return a=Math.sqrt(a)+this._horizonDistance,t=i.default.subtract(e,this._cameraPosition,t),a*a>i.default.magnitudeSquared(t)}return!1};var vn=new i.default;pn.prototype.isBoundingSphereVisible=function(e){var t=i.default.clone(e.center,vn),a=e.radius;if(this._horizonDistance!==Number.MAX_VALUE){var r=i.default.subtract(t,this._occluderPosition,gn),n=this._occluderRadius-a;if(n=i.default.magnitudeSquared(r)-n*n,a<this._occluderRadius)return n>0&&(n=Math.sqrt(n)+this._horizonDistance,r=i.default.subtract(t,this._cameraPosition,r),n*n+a*a>i.default.magnitudeSquared(r));if(n>0){r=i.default.subtract(t,this._cameraPosition,r);var o=i.default.magnitudeSquared(r),s=this._occluderRadius*this._occluderRadius,l=a*a;return(this._horizonDistance*this._horizonDistance+s)*l>o*s||(n=Math.sqrt(n)+this._horizonDistance)*n+l>o}return!0}return!1};var yn=new i.default;pn.prototype.computeVisibility=function(e){var t=i.default.clone(e.center),a=e.radius;if(a>this._occluderRadius)return re.FULL;if(this._horizonDistance!==Number.MAX_VALUE){var r=i.default.subtract(t,this._occluderPosition,yn),n=this._occluderRadius-a,o=i.default.magnitudeSquared(r);if((n=o-n*n)>0){n=Math.sqrt(n)+this._horizonDistance,r=i.default.subtract(t,this._cameraPosition,r);var s=i.default.magnitudeSquared(r);return n*n+a*a<s?re.NONE:(n=o-(n=this._occluderRadius+a)*n)>0?s<(n=Math.sqrt(n)+this._horizonDistance)*n+a*a?re.FULL:re.PARTIAL:(r=i.default.subtract(t,this._horizonPlanePosition,r),i.default.dot(r,this._horizonPlaneNormal)>-a?re.PARTIAL:re.FULL)}}return re.NONE};var bn=new i.default;pn.computeOccludeePoint=function(e,t,a){var r=i.default.clone(t),n=i.default.clone(e.center),o=e.radius,s=a.length,l=i.default.normalize(i.default.subtract(r,n,bn),bn),u=-i.default.dot(l,n),d=pn._anyRotationVector(n,l,u),f=pn._horizonToPlaneNormalDotProduct(e,l,u,d,a[0]);if(f){for(var c,h=1;h<s;++h){if(!(c=pn._horizonToPlaneNormalDotProduct(e,l,u,d,a[h])))return;c<f&&(f=c)}if(!(f<.0017453283658983088)){var m=o/f;return i.default.add(n,i.default.multiplyByScalar(l,m,bn),bn)}}};var wn=[];pn.computeOccludeePointFromRectangle=function(e,t){t=Object(n.default)(t,d.default.WGS84);var a=T.default.subsample(e,t,0,wn),r=v.default.fromPoints(a),o=i.default.ZERO;if(!i.default.equals(o,r.center))return pn.computeOccludeePoint(new v.default(o,t.minimumRadius),r.center,a)};var On=new i.default;pn._anyRotationVector=function(e,t,a){var r=i.default.abs(t,On),n=r.x>r.y?0:1;(0===n&&r.z>r.x||1===n&&r.z>r.y)&&(n=2);var o,s=new i.default;0===n?(r.x=e.x,r.y=e.y+1,r.z=e.z+1,o=i.default.UNIT_X):1===n?(r.x=e.x+1,r.y=e.y,r.z=e.z+1,o=i.default.UNIT_Y):(r.x=e.x+1,r.y=e.y+1,r.z=e.z,o=i.default.UNIT_Z);var l=(i.default.dot(t,r)+a)/-i.default.dot(t,o);return i.default.normalize(i.default.subtract(i.default.add(r,i.default.multiplyByScalar(o,l,s),r),e,r),r)};var xn=new i.default;pn._rotationVector=function(e,t,a,r,n){var o=i.default.subtract(r,e,xn);if(o=i.default.normalize(o,o),i.default.dot(t,o)<.9999999847691291){var s=i.default.cross(t,o,o);if(i.default.magnitude(s)>K.default.EPSILON13)return i.default.normalize(s,new i.default)}return n};var Cn=new i.default,Tn=new i.default,En=new i.default,An=new i.default;pn._horizonToPlaneNormalDotProduct=function(e,t,a,r,n){var o=i.default.clone(n,Cn),s=i.default.clone(e.center,Tn),l=e.radius,u=i.default.subtract(s,o,En),d=i.default.magnitudeSquared(u),f=l*l;if(d<f)return!1;var c=d-f,h=Math.sqrt(c),m=h*(1/Math.sqrt(d))*h;u=i.default.normalize(u,u);var p=i.default.add(o,i.default.multiplyByScalar(u,m,An),An),_=Math.sqrt(c-m*m),g=this._rotationVector(s,t,a,o,r),v=i.default.fromElements(g.x*g.x*u.x+(g.x*g.y-g.z)*u.y+(g.x*g.z+g.y)*u.z,(g.x*g.y+g.z)*u.x+g.y*g.y*u.y+(g.y*g.z-g.x)*u.z,(g.x*g.z-g.y)*u.x+(g.y*g.z+g.x)*u.y+g.z*g.z*u.z,Cn);v=i.default.normalize(v,v);var y=i.default.multiplyByScalar(v,_,Cn);g=i.default.normalize(i.default.subtract(i.default.add(p,y,En),s,En),En);var b=i.default.dot(t,g);g=i.default.normalize(i.default.subtract(i.default.subtract(p,y,g),s,g),g);var w=i.default.dot(t,g);return b<w?b:w};var Sn,Pn=pn,Dn=a(173),In=a(277),Mn=a(517),Fn=a(137),Rn=a(121),Nn=(a(16),"attribute vec4 position;\nattribute vec2 textureCoordinates;\n\nvarying vec2 v_textureCoordinates;\n\nvoid main() \n{\n    gl_Position = position;\n    v_textureCoordinates = textureCoordinates;\n}\n"),Ln=a(102);function jn(e){this._context=e}var Vn=new ue.a({primitiveType:te.a.TRIANGLES}),Un=new Rn.a({color:new G.default(0,0,0,0)});jn.prototype.execute=function(e){Object(o.default)(e.preExecute)&&e.preExecute(e);var t=e.outputTexture,a=t.width,i=t.height,r=this._context,n=Object(o.default)(e.vertexArray)?e.vertexArray:r.getViewportQuadVertexArray(),s=Object(o.default)(e.shaderProgram)?e.shaderProgram:function(e,t){return R.a.fromCache({context:e,vertexShaderSource:Nn,fragmentShaderSource:t,attributeLocations:{position:0,textureCoordinates:1}})}(r,e.fragmentShaderSource),l=function(e,t){return new Ln.a({context:e,colorTextures:[t],destroyAttachments:!1})}(r,t),u=function(e,t){return Object(o.default)(Sn)&&Sn.viewport.width===e&&Sn.viewport.height===t||(Sn=fe.a.fromCache({viewport:new nn.default(0,0,e,t)})),Sn}(a,i),d=e.uniformMap,f=Un;f.framebuffer=l,f.renderState=u,f.execute(r);var c=Vn;c.vertexArray=n,c.renderState=u,c.shaderProgram=s,c.uniformMap=d,c.framebuffer=l,c.execute(r),l.destroy(),e.persists||(s.destroy(),Object(o.default)(e.vertexArray)&&n.destroy()),Object(o.default)(e.postExecute)&&e.postExecute(t)},jn.prototype.isDestroyed=function(){return!1},jn.prototype.destroy=function(){return Object(l.default)(this)};var zn=jn,Bn=a(36),Hn=a(53),kn=a(54),Gn=a(43),Wn=a(49),Yn="uniform sampler2D u_floatTexture;\n\nvoid main()\n{\n    float actual = texture2D(u_floatTexture, vec2(0.5, 0.5)).r;\n    float expected = 123456.0;\n    gl_FragColor = vec4(abs(actual - expected), 0.0, 0.0, 1.0);\n}\n",Xn=a(327);function Qn(e){if(!e.floatingPointTexture)return!1;var t=new zn(e),a=new S.a({context:e,width:1,height:1,pixelFormat:_e.a.RGBA}),i=new S.a({context:e,width:1,height:1,pixelFormat:_e.a.RGBA,pixelDatatype:Qn._getFloatPixelType(),source:{width:1,height:1,arrayBufferView:Qn._getArray([123456,0,0,0])}}),r=new Ln.a({context:e,colorTextures:[a],destroyAttachments:!1}),n={framebuffer:r,x:0,y:0,width:1,height:1},o=!1;return new Xn.a({fragmentShaderSource:Yn,outputTexture:a,uniformMap:{u_floatTexture:function(){return i}},persists:!1,postExecute:function(){var t=e.readPixels(n);o=0===t[0]}}).execute(t),t.destroy(),r.destroy(),o}Qn._getFloatPixelType=function(){return we.a.FLOAT},Qn._getArray=function(e){return new Float32Array(e)};var qn=Qn,Zn=a(246);var Kn=function(e){this.context=e,this.framebuffer=void 0,this.blendingEnabled=void 0,this.scissorTest=void 0,this.viewport=void 0};function Jn(e){this._context=e,this._shaders={},this._numberOfShaders=0,this._shadersToRelease={}}function $n(e,t){for(var a=t.derivedKeywords,i=a.length,r=0;r<i;++r){var n=a[r]+t.keyword;$n(e,e._shaders[n])}delete e._shaders[t.keyword],t.shaderProgram.finalDestroy()}Object(s.default)(Jn.prototype,{numberOfShaders:{get:function(){return this._numberOfShaders}}}),Jn.prototype.replaceShaderProgram=function(e){return Object(o.default)(e.shaderProgram)&&e.shaderProgram.destroy(),this.getShaderProgram(e)},Jn.prototype.getShaderProgram=function(e){var t=e.vertexShaderSource,a=e.fragmentShaderSource,i=e.attributeLocations;"string"==typeof t&&(t=new A.a({sources:[t]})),"string"==typeof a&&(a=new A.a({sources:[a]}));var r,n=t.createCombinedVertexShader(this._context),s=a.createCombinedFragmentShader(this._context),l=n+s+JSON.stringify(i);if(Object(o.default)(this._shaders[l]))r=this._shaders[l],delete this._shadersToRelease[l];else{var u=this._context,d=new R.a({gl:u._gl,logShaderCompilation:u.logShaderCompilation,debugShaders:u.debugShaders,vertexShaderSource:t,vertexShaderText:n,fragmentShaderSource:a,fragmentShaderText:s,attributeLocations:i});r={cache:this,shaderProgram:d,keyword:l,derivedKeywords:[],count:0},d._cachedShader=r,this._shaders[l]=r,++this._numberOfShaders}return++r.count,r.shaderProgram},Jn.prototype.replaceDerivedShaderProgram=function(e,t,a){var i=e._cachedShader,r=t+i.keyword,n=this._shaders[r];if(Object(o.default)(n)){$n(this,n);var s=i.derivedKeywords.indexOf(t);s>-1&&i.derivedKeywords.splice(s,1)}return this.createDerivedShaderProgram(e,t,a)},Jn.prototype.getDerivedShaderProgram=function(e,t){var a=t+e._cachedShader.keyword,i=this._shaders[a];if(Object(o.default)(i))return i.shaderProgram},Jn.prototype.createDerivedShaderProgram=function(e,t,a){var i=e._cachedShader,r=t+i.keyword,n=a.vertexShaderSource,o=a.fragmentShaderSource,s=a.attributeLocations;"string"==typeof n&&(n=new A.a({sources:[n]})),"string"==typeof o&&(o=new A.a({sources:[o]}));var l=this._context,u=n.createCombinedVertexShader(l),d=o.createCombinedFragmentShader(l),f=new R.a({gl:l._gl,logShaderCompilation:l.logShaderCompilation,debugShaders:l.debugShaders,vertexShaderSource:n,vertexShaderText:u,fragmentShaderSource:o,fragmentShaderText:d,attributeLocations:s}),c={cache:this,shaderProgram:f,keyword:r,derivedKeywords:[],count:0};return i.derivedKeywords.push(t),f._cachedShader=c,this._shaders[r]=c,f},Jn.prototype.destroyReleasedShaderPrograms=function(){var e=this._shadersToRelease;for(var t in e){if(e.hasOwnProperty(t))$n(this,e[t]),--this._numberOfShaders}this._shadersToRelease={}},Jn.prototype.releaseShaderProgram=function(e){if(Object(o.default)(e)){var t=e._cachedShader;t&&0==--t.count&&(this._shadersToRelease[t.keyword]=t)}},Jn.prototype.isDestroyed=function(){return!1},Jn.prototype.destroy=function(){var e=this._shaders;for(var t in e)e.hasOwnProperty(t)&&e[t].shaderProgram.finalDestroy();return Object(l.default)(this)};var eo=Jn;function to(){this._textures={},this._numberOfTextures=0,this._texturesToRelease={}}Object(s.default)(to.prototype,{numberOfTextures:{get:function(){return this._numberOfTextures}}}),to.prototype.getTexture=function(e){var t=this._textures[e];if(Object(o.default)(t))return delete this._texturesToRelease[e],++t.count,t.texture},to.prototype.addTexture=function(e,t){var a={texture:t,count:1};t.finalDestroy=t.destroy;var i=this;t.destroy=function(){0==--a.count&&(i._texturesToRelease[e]=a)},this._textures[e]=a,++this._numberOfTextures},to.prototype.destroyReleasedTextures=function(){var e=this._texturesToRelease;for(var t in e)if(e.hasOwnProperty(t)){var a=e[t];delete this._textures[t],a.texture.finalDestroy(),--this._numberOfTextures}this._texturesToRelease={}},to.prototype.isDestroyed=function(){return!1},to.prototype.destroy=function(){var e=this._textures;for(var t in e)e.hasOwnProperty(t)&&e[t].texture.finalDestroy();return Object(l.default)(this)};var ao=to,io=a(182);var ro=function(e){e=Object(n.default)(e,n.default.EMPTY_OBJECT),this.color=Object(o.default)(e.color)?G.default.clone(e.color):G.default.WHITE,this.intensity=Object(n.default)(e.intensity,2)};function no(){this.globeDepthTexture=void 0,this.gamma=void 0,this._viewport=new nn.default,this._viewportCartesian4=new H.a,this._viewportDirty=!1,this._viewportOrthographicMatrix=J.default.clone(J.default.IDENTITY),this._viewportTransformation=J.default.clone(J.default.IDENTITY),this._model=J.default.clone(J.default.IDENTITY),this._view=J.default.clone(J.default.IDENTITY),this._inverseView=J.default.clone(J.default.IDENTITY),this._projection=J.default.clone(J.default.IDENTITY),this._infiniteProjection=J.default.clone(J.default.IDENTITY),this._entireFrustum=new B.default,this._currentFrustum=new B.default,this._frustumPlanes=new H.a,this._log2FarDistance=void 0,this._log2FarPlusOne=void 0,this._log2NearDistance=void 0,this._frameState=void 0,this._temeToPseudoFixed=_i.default.clone(J.default.IDENTITY),this._view3DDirty=!0,this._view3D=new J.default,this._inverseView3DDirty=!0,this._inverseView3D=new J.default,this._inverseModelDirty=!0,this._inverseModel=new J.default,this._inverseTransposeModelDirty=!0,this._inverseTransposeModel=new _i.default,this._viewRotation=new _i.default,this._inverseViewRotation=new _i.default,this._viewRotation3D=new _i.default,this._inverseViewRotation3D=new _i.default,this._inverseProjectionDirty=!0,this._inverseProjection=new J.default,this._modelViewDirty=!0,this._modelView=new J.default,this._modelView3DDirty=!0,this._modelView3D=new J.default,this._modelViewRelativeToEyeDirty=!0,this._modelViewRelativeToEye=new J.default,this._inverseModelViewDirty=!0,this._inverseModelView=new J.default,this._inverseModelView3DDirty=!0,this._inverseModelView3D=new J.default,this._viewProjectionDirty=!0,this._viewProjection=new J.default,this._inverseViewProjectionDirty=!0,this._inverseViewProjection=new J.default,this._modelViewProjectionDirty=!0,this._modelViewProjection=new J.default,this._inverseModelViewProjectionDirty=!0,this._inverseModelViewProjection=new J.default,this._modelViewProjectionRelativeToEyeDirty=!0,this._modelViewProjectionRelativeToEye=new J.default,this._modelViewInfiniteProjectionDirty=!0,this._modelViewInfiniteProjection=new J.default,this._normalDirty=!0,this._normal=new _i.default,this._normal3DDirty=!0,this._normal3D=new _i.default,this._inverseNormalDirty=!0,this._inverseNormal=new _i.default,this._inverseNormal3DDirty=!0,this._inverseNormal3D=new _i.default,this._encodedCameraPositionMCDirty=!0,this._encodedCameraPositionMC=new io.a,this._cameraPosition=new i.default,this._sunPositionWC=new i.default,this._sunPositionColumbusView=new i.default,this._sunDirectionWC=new i.default,this._sunDirectionEC=new i.default,this._moonDirectionEC=new i.default,this._lightDirectionWC=new i.default,this._lightDirectionEC=new i.default,this._lightColor=new i.default,this._lightColorHdr=new i.default,this._pass=void 0,this._mode=void 0,this._mapProjection=void 0,this._cameraDirection=new i.default,this._cameraRight=new i.default,this._cameraUp=new i.default,this._frustum2DWidth=0,this._eyeHeight2D=new B.default,this._pixelRatio=1,this._orthographicIn3D=!1,this._backgroundColor=new G.default,this._brdfLut=void 0,this._environmentMap=void 0,this._sphericalHarmonicCoefficients=void 0,this._specularEnvironmentMaps=void 0,this._specularEnvironmentMapsDimensions=new B.default,this._specularEnvironmentMapsMaximumLOD=void 0,this._fogDensity=void 0,this._invertClassificationColor=void 0,this._imagerySplitPosition=0,this._pixelSizePerMeter=void 0,this._geometricToleranceOverMeter=void 0,this._minimumDisableDepthTestDistance=void 0}Object(s.default)(no.prototype,{frameState:{get:function(){return this._frameState}},viewport:{get:function(){return this._viewport},set:function(e){if(!nn.default.equals(e,this._viewport)){nn.default.clone(e,this._viewport);var t=this._viewport,a=this._viewportCartesian4;a.x=t.x,a.y=t.y,a.z=t.width,a.w=t.height,this._viewportDirty=!0}}},viewportCartesian4:{get:function(){return this._viewportCartesian4}},viewportOrthographic:{get:function(){return fo(this),this._viewportOrthographicMatrix}},viewportTransformation:{get:function(){return fo(this),this._viewportTransformation}},model:{get:function(){return this._model},set:function(e){J.default.clone(e,this._model),this._modelView3DDirty=!0,this._inverseModelView3DDirty=!0,this._inverseModelDirty=!0,this._inverseTransposeModelDirty=!0,this._modelViewDirty=!0,this._inverseModelViewDirty=!0,this._modelViewRelativeToEyeDirty=!0,this._inverseModelViewDirty=!0,this._modelViewProjectionDirty=!0,this._inverseModelViewProjectionDirty=!0,this._modelViewProjectionRelativeToEyeDirty=!0,this._modelViewInfiniteProjectionDirty=!0,this._normalDirty=!0,this._inverseNormalDirty=!0,this._normal3DDirty=!0,this._inverseNormal3DDirty=!0,this._encodedCameraPositionMCDirty=!0}},inverseModel:{get:function(){return this._inverseModelDirty&&(this._inverseModelDirty=!1,J.default.inverse(this._model,this._inverseModel)),this._inverseModel}},inverseTransposeModel:{get:function(){var e=this._inverseTransposeModel;return this._inverseTransposeModelDirty&&(this._inverseTransposeModelDirty=!1,J.default.getMatrix3(this.inverseModel,e),_i.default.transpose(e,e)),e}},view:{get:function(){return this._view}},view3D:{get:function(){return wo(this),this._view3D}},viewRotation:{get:function(){return wo(this),this._viewRotation}},viewRotation3D:{get:function(){return wo(this),this._viewRotation3D}},inverseView:{get:function(){return this._inverseView}},inverseView3D:{get:function(){return Oo(this),this._inverseView3D}},inverseViewRotation:{get:function(){return this._inverseViewRotation}},inverseViewRotation3D:{get:function(){return Oo(this),this._inverseViewRotation3D}},projection:{get:function(){return this._projection}},inverseProjection:{get:function(){var e;return(e=this)._inverseProjectionDirty&&(e._inverseProjectionDirty=!1,e._mode===L.a.SCENE2D||e._mode===L.a.MORPHING||e._orthographicIn3D?J.default.clone(J.default.ZERO,e._inverseProjection):J.default.inverse(e._projection,e._inverseProjection)),this._inverseProjection}},infiniteProjection:{get:function(){return this._infiniteProjection}},modelView:{get:function(){var e;return(e=this)._modelViewDirty&&(e._modelViewDirty=!1,J.default.multiplyTransformation(e._view,e._model,e._modelView)),this._modelView}},modelView3D:{get:function(){var e;return(e=this)._modelView3DDirty&&(e._modelView3DDirty=!1,J.default.multiplyTransformation(e.view3D,e._model,e._modelView3D)),this._modelView3D}},modelViewRelativeToEye:{get:function(){return function(e){if(e._modelViewRelativeToEyeDirty){e._modelViewRelativeToEyeDirty=!1;var t=e.modelView,a=e._modelViewRelativeToEye;a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7],a[8]=t[8],a[9]=t[9],a[10]=t[10],a[11]=t[11],a[12]=0,a[13]=0,a[14]=0,a[15]=t[15]}}(this),this._modelViewRelativeToEye}},inverseModelView:{get:function(){var e;return(e=this)._inverseModelViewDirty&&(e._inverseModelViewDirty=!1,J.default.inverse(e.modelView,e._inverseModelView)),this._inverseModelView}},inverseModelView3D:{get:function(){var e;return(e=this)._inverseModelView3DDirty&&(e._inverseModelView3DDirty=!1,J.default.inverse(e.modelView3D,e._inverseModelView3D)),this._inverseModelView3D}},viewProjection:{get:function(){var e;return(e=this)._viewProjectionDirty&&(e._viewProjectionDirty=!1,J.default.multiply(e._projection,e._view,e._viewProjection)),this._viewProjection}},inverseViewProjection:{get:function(){var e;return(e=this)._inverseViewProjectionDirty&&(e._inverseViewProjectionDirty=!1,J.default.inverse(e.viewProjection,e._inverseViewProjection)),this._inverseViewProjection}},modelViewProjection:{get:function(){var e;return(e=this)._modelViewProjectionDirty&&(e._modelViewProjectionDirty=!1,J.default.multiply(e._projection,e.modelView,e._modelViewProjection)),this._modelViewProjection}},inverseModelViewProjection:{get:function(){var e;return(e=this)._inverseModelViewProjectionDirty&&(e._inverseModelViewProjectionDirty=!1,J.default.inverse(e.modelViewProjection,e._inverseModelViewProjection)),this._inverseModelViewProjection}},modelViewProjectionRelativeToEye:{get:function(){var e;return(e=this)._modelViewProjectionRelativeToEyeDirty&&(e._modelViewProjectionRelativeToEyeDirty=!1,J.default.multiply(e._projection,e.modelViewRelativeToEye,e._modelViewProjectionRelativeToEye)),this._modelViewProjectionRelativeToEye}},modelViewInfiniteProjection:{get:function(){var e;return(e=this)._modelViewInfiniteProjectionDirty&&(e._modelViewInfiniteProjectionDirty=!1,J.default.multiply(e._infiniteProjection,e.modelView,e._modelViewInfiniteProjection)),this._modelViewInfiniteProjection}},normal:{get:function(){return function(e){if(e._normalDirty){e._normalDirty=!1;var t=e._normal;J.default.getMatrix3(e.inverseModelView,t),_i.default.getRotation(t,t),_i.default.transpose(t,t)}}(this),this._normal}},normal3D:{get:function(){return function(e){if(e._normal3DDirty){e._normal3DDirty=!1;var t=e._normal3D;J.default.getMatrix3(e.inverseModelView3D,t),_i.default.getRotation(t,t),_i.default.transpose(t,t)}}(this),this._normal3D}},inverseNormal:{get:function(){var e;return(e=this)._inverseNormalDirty&&(e._inverseNormalDirty=!1,J.default.getMatrix3(e.inverseModelView,e._inverseNormal),_i.default.getRotation(e._inverseNormal,e._inverseNormal)),this._inverseNormal}},inverseNormal3D:{get:function(){var e;return(e=this)._inverseNormal3DDirty&&(e._inverseNormal3DDirty=!1,J.default.getMatrix3(e.inverseModelView3D,e._inverseNormal3D),_i.default.getRotation(e._inverseNormal3D,e._inverseNormal3D)),this._inverseNormal3D}},entireFrustum:{get:function(){return this._entireFrustum}},currentFrustum:{get:function(){return this._currentFrustum}},frustumPlanes:{get:function(){return this._frustumPlanes}},log2FarDistance:{get:function(){return this._log2FarDistance}},log2FarPlusOne:{get:function(){return this._log2FarPlusOne}},log2NearDistance:{get:function(){return this._log2NearDistance}},eyeHeight2D:{get:function(){return this._eyeHeight2D}},sunPositionWC:{get:function(){return this._sunPositionWC}},sunPositionColumbusView:{get:function(){return this._sunPositionColumbusView}},sunDirectionWC:{get:function(){return this._sunDirectionWC}},sunDirectionEC:{get:function(){return this._sunDirectionEC}},moonDirectionEC:{get:function(){return this._moonDirectionEC}},lightDirectionWC:{get:function(){return this._lightDirectionWC}},lightDirectionEC:{get:function(){return this._lightDirectionEC}},lightColor:{get:function(){return this._lightColor}},lightColorHdr:{get:function(){return this._lightColorHdr}},encodedCameraPositionMCHigh:{get:function(){return ho(this),this._encodedCameraPositionMC.high}},encodedCameraPositionMCLow:{get:function(){return ho(this),this._encodedCameraPositionMC.low}},temeToPseudoFixedMatrix:{get:function(){return this._temeToPseudoFixed}},pixelRatio:{get:function(){return this._pixelRatio}},fogDensity:{get:function(){return this._fogDensity}},geometricToleranceOverMeter:{get:function(){return this._geometricToleranceOverMeter}},pass:{get:function(){return this._pass}},backgroundColor:{get:function(){return this._backgroundColor}},brdfLut:{get:function(){return this._brdfLut}},environmentMap:{get:function(){return this._environmentMap}},sphericalHarmonicCoefficients:{get:function(){return this._sphericalHarmonicCoefficients}},specularEnvironmentMaps:{get:function(){return this._specularEnvironmentMaps}},specularEnvironmentMapsDimensions:{get:function(){return this._specularEnvironmentMapsDimensions}},specularEnvironmentMapsMaximumLOD:{get:function(){return this._specularEnvironmentMapsMaximumLOD}},imagerySplitPosition:{get:function(){return this._imagerySplitPosition}},minimumDisableDepthTestDistance:{get:function(){return this._minimumDisableDepthTestDistance}},invertClassificationColor:{get:function(){return this._invertClassificationColor}},orthographicIn3D:{get:function(){return this._orthographicIn3D}}});var oo=new _i.default,so=new y.default;no.prototype.updateCamera=function(e){var t,a;t=this,a=e.viewMatrix,J.default.clone(a,t._view),J.default.getMatrix3(a,t._viewRotation),t._view3DDirty=!0,t._inverseView3DDirty=!0,t._modelViewDirty=!0,t._modelView3DDirty=!0,t._modelViewRelativeToEyeDirty=!0,t._inverseModelViewDirty=!0,t._inverseModelView3DDirty=!0,t._viewProjectionDirty=!0,t._inverseViewProjectionDirty=!0,t._modelViewProjectionDirty=!0,t._modelViewProjectionRelativeToEyeDirty=!0,t._modelViewInfiniteProjectionDirty=!0,t._normalDirty=!0,t._inverseNormalDirty=!0,t._normal3DDirty=!0,t._inverseNormal3DDirty=!0,function(e,t){J.default.clone(t,e._inverseView),J.default.getMatrix3(t,e._inverseViewRotation)}(this,e.inverseViewMatrix),function(e,t){i.default.clone(t.positionWC,e._cameraPosition),i.default.clone(t.directionWC,e._cameraDirection),i.default.clone(t.rightWC,e._cameraRight),i.default.clone(t.upWC,e._cameraUp),e._encodedCameraPositionMCDirty=!0}(this,e),this._entireFrustum.x=e.frustum.near,this._entireFrustum.y=e.frustum.far,this.updateFrustum(e.frustum),this._orthographicIn3D=this._mode!==L.a.SCENE2D&&e.frustum instanceof ee.a},no.prototype.updateFrustum=function(e){var t,a;t=this,a=e.projectionMatrix,J.default.clone(a,t._projection),t._inverseProjectionDirty=!0,t._viewProjectionDirty=!0,t._inverseViewProjectionDirty=!0,t._modelViewProjectionDirty=!0,t._modelViewProjectionRelativeToEyeDirty=!0,Object(o.default)(e.infiniteProjectionMatrix)&&function(e,t){J.default.clone(t,e._infiniteProjection),e._modelViewInfiniteProjectionDirty=!0}(this,e.infiniteProjectionMatrix),this._currentFrustum.x=e.near,this._currentFrustum.y=e.far,this._log2FarDistance=2/K.default.log2(e.far+1),this._log2FarPlusOne=K.default.log2(e.far+1),this._log2NearDistance=K.default.log2(e.near),Object(o.default)(e._offCenterFrustum)&&(e=e._offCenterFrustum),this._frustumPlanes.x=e.top,this._frustumPlanes.y=e.bottom,this._frustumPlanes.z=e.left,this._frustumPlanes.w=e.right},no.prototype.updatePass=function(e){this._pass=e};var lo=[],uo=new ro;function fo(e){if(e._viewportDirty){var t=e._viewport;J.default.computeOrthographicOffCenter(t.x,t.x+t.width,t.y,t.y+t.height,0,1,e._viewportOrthographicMatrix),J.default.computeViewportTransformation(t,0,1,e._viewportTransformation),e._viewportDirty=!1}}no.prototype.update=function(e){this._mode=e.mode,this._mapProjection=e.mapProjection,this._pixelRatio=e.pixelRatio;var t=e.camera;this.updateCamera(t),e.mode===L.a.SCENE2D?(this._frustum2DWidth=t.frustum.right-t.frustum.left,this._eyeHeight2D.x=.5*this._frustum2DWidth,this._eyeHeight2D.y=this._eyeHeight2D.x*this._eyeHeight2D.x):(this._frustum2DWidth=0,this._eyeHeight2D.x=0,this._eyeHeight2D.y=0),function(e,t){Object(o.default)(Br.default.computeIcrfToFixedMatrix(t.time,oo))||(oo=Br.default.computeTemeToPseudoFixedMatrix(t.time,oo));var a=zr.computeSunPositionInEarthInertialFrame(t.time,e._sunPositionWC);_i.default.multiplyByVector(oo,a,a),i.default.normalize(a,e._sunDirectionWC),a=_i.default.multiplyByVector(e.viewRotation3D,a,e._sunDirectionEC),i.default.normalize(a,a),a=zr.computeMoonPositionInEarthInertialFrame(t.time,e._moonDirectionEC),_i.default.multiplyByVector(oo,a,a),_i.default.multiplyByVector(e.viewRotation3D,a,a),i.default.normalize(a,a);var r=t.mapProjection,n=r.ellipsoid.cartesianToCartographic(e._sunPositionWC,so);r.project(n,e._sunPositionColumbusView)}(this,e);var a=Object(n.default)(e.light,uo);a instanceof ro?(this._lightDirectionWC=i.default.clone(this._sunDirectionWC,this._lightDirectionWC),this._lightDirectionEC=i.default.clone(this._sunDirectionEC,this._lightDirectionEC)):(this._lightDirectionWC=i.default.normalize(i.default.negate(a.direction,this._lightDirectionWC),this._lightDirectionWC),this._lightDirectionEC=_i.default.multiplyByVector(this.viewRotation3D,this._lightDirectionWC,this._lightDirectionEC));var r=a.color,s=i.default.fromElements(r.red,r.green,r.blue,this._lightColorHdr);s=i.default.multiplyByScalar(s,a.intensity,s);var l=i.default.maximumComponent(s);l>1?i.default.divideByScalar(s,l,this._lightColor):i.default.clone(s,this._lightColor);var u=e.brdfLutGenerator,d=Object(o.default)(u)?u.colorTexture:void 0;this._brdfLut=d,this._environmentMap=Object(n.default)(e.environmentMap,e.context.defaultCubeMap),this._sphericalHarmonicCoefficients=Object(n.default)(e.sphericalHarmonicCoefficients,lo),this._specularEnvironmentMaps=e.specularEnvironmentMaps,this._specularEnvironmentMapsMaximumLOD=e.specularEnvironmentMapsMaximumLOD,Object(o.default)(this._specularEnvironmentMaps)&&B.default.clone(this._specularEnvironmentMaps.dimensions,this._specularEnvironmentMapsDimensions),this._fogDensity=e.fog.density,this._invertClassificationColor=e.invertClassificationColor,this._frameState=e,this._temeToPseudoFixed=Br.default.computeTemeToPseudoFixedMatrix(e.time,this._temeToPseudoFixed),this._imagerySplitPosition=e.imagerySplitPosition*e.context.drawingBufferWidth;var f,c=t.frustum.fov,h=this._viewport;f=h.height>h.width?2*Math.tan(.5*c)/h.height:2*Math.tan(.5*c)/h.width,this._geometricToleranceOverMeter=f*e.maximumScreenSpaceError,G.default.clone(e.backgroundColor,this._backgroundColor),this._minimumDisableDepthTestDistance=e.minimumDisableDepthTestDistance,this._minimumDisableDepthTestDistance*=this._minimumDisableDepthTestDistance,this._minimumDisableDepthTestDistance===Number.POSITIVE_INFINITY&&(this._minimumDisableDepthTestDistance=-1)};var co=new i.default;function ho(e){e._encodedCameraPositionMCDirty&&(e._encodedCameraPositionMCDirty=!1,J.default.multiplyByPoint(e.inverseModel,e._cameraPosition,co),io.a.fromCartesian(co,e._encodedCameraPositionMC))}var mo=new i.default,po=new i.default,_o=new i.default,go=new i.default,vo=new y.default,yo=new i.default,bo=new J.default;function wo(e){e._view3DDirty&&(e._mode===L.a.SCENE3D?J.default.clone(e._view,e._view3D):function(e,t,a,r,n,s,l,u){var d=mo;d.x=e.y,d.y=e.z,d.z=e.x;var f=po;f.x=a.y,f.y=a.z,f.z=a.x;var c=_o;c.x=r.y,c.y=r.z,c.z=r.x;var h=go;h.x=t.y,h.y=t.z,h.z=t.x,s===L.a.SCENE2D&&(d.z=.5*n);var m=l.unproject(d,vo);m.longitude=K.default.clamp(m.longitude,-Math.PI,Math.PI),m.latitude=K.default.clamp(m.latitude,-K.default.PI_OVER_TWO,K.default.PI_OVER_TWO);var p=l.ellipsoid,_=p.cartographicToCartesian(m,yo),g=Br.default.eastNorthUpToFixedFrame(_,p,bo);J.default.multiplyByPointAsVector(g,f,f),J.default.multiplyByPointAsVector(g,c,c),J.default.multiplyByPointAsVector(g,h,h),Object(o.default)(u)||(u=new J.default),u[0]=f.x,u[1]=c.x,u[2]=-h.x,u[3]=0,u[4]=f.y,u[5]=c.y,u[6]=-h.y,u[7]=0,u[8]=f.z,u[9]=c.z,u[10]=-h.z,u[11]=0,u[12]=-i.default.dot(f,_),u[13]=-i.default.dot(c,_),u[14]=i.default.dot(h,_),u[15]=1}(e._cameraPosition,e._cameraDirection,e._cameraRight,e._cameraUp,e._frustum2DWidth,e._mode,e._mapProjection,e._view3D),J.default.getMatrix3(e._view3D,e._viewRotation3D),e._view3DDirty=!1)}function Oo(e){e._inverseView3DDirty&&(J.default.inverseTransformation(e.view3D,e._inverseView3D),J.default.getMatrix3(e._inverseView3D,e._inverseViewRotation3D),e._inverseView3DDirty=!1)}var xo=no;function Co(e,t,a){var i=e.getError();if(i!==e.NO_ERROR)throw new Gn.default(function(e,t,a,i){for(var r=function(e,t){var a="WebGL Error:  ";switch(t){case e.INVALID_ENUM:a+="INVALID_ENUM";break;case e.INVALID_VALUE:a+="INVALID_VALUE";break;case e.INVALID_OPERATION:a+="INVALID_OPERATION";break;case e.OUT_OF_MEMORY:a+="OUT_OF_MEMORY";break;case e.CONTEXT_LOST_WEBGL:a+="CONTEXT_LOST_WEBGL lost";break;default:a+="Unknown ("+t+")"}return a}(e,i)+": "+t.name+"(",n=0;n<a.length;++n)0!==n&&(r+=", "),r+=a[n];return r+=");"}(e,t,a,i))}function To(e,t,a){return{get:function(){var i=e[t];return a(e,"get: "+t,i),e[t]},set:function(i){e[t]=i,a(e,"set: "+t,i)}}}function Eo(e,t){for(var a=t.length,i=0;i<a;++i){var r=e.getExtension(t[i]);if(r)return r}}function Ao(e,t){if("undefined"==typeof WebGLRenderingContext)throw new Gn.default("The browser does not support WebGL.  Visit http://get.webgl.org.");this._canvas=e,t=Object(k.default)(t,!0),(t=Object(n.default)(t,{})).allowTextureFilterAnisotropic=Object(n.default)(t.allowTextureFilterAnisotropic,!0);var a=Object(n.default)(t.webgl,{});a.alpha=Object(n.default)(a.alpha,!1),a.stencil=Object(n.default)(a.stencil,!0);var i,r=Object(n.default)(t.requestWebgl2,!1)&&"undefined"!=typeof WebGL2RenderingContext,s=!1,l=t.getWebGLStub;if(Object(o.default)(l))i=l(e,a);else if(r&&(i=e.getContext("webgl2",a)||e.getContext("experimental-webgl2",a)||void 0,Object(o.default)(i)&&(s=!0)),Object(o.default)(i)||(i=e.getContext("webgl",a)||e.getContext("experimental-webgl",a)||void 0),!Object(o.default)(i))throw new Gn.default("The browser supports WebGL, but initialization failed.");this._originalGLContext=i,this._gl=i,this._webgl2=s,this._id=Object(on.default)(),this.validateFramebuffer=!1,this.validateShaderProgram=!1,this.logShaderCompilation=!1,this._throwOnWebGLError=!1,this._shaderCache=new eo(this),this._textureCache=new ao;var u=i;this._stencilBits=u.getParameter(u.STENCIL_BITS),le.a._maximumCombinedTextureImageUnits=u.getParameter(u.MAX_COMBINED_TEXTURE_IMAGE_UNITS),le.a._maximumCubeMapSize=u.getParameter(u.MAX_CUBE_MAP_TEXTURE_SIZE),le.a._maximumFragmentUniformVectors=u.getParameter(u.MAX_FRAGMENT_UNIFORM_VECTORS),le.a._maximumTextureImageUnits=u.getParameter(u.MAX_TEXTURE_IMAGE_UNITS),le.a._maximumRenderbufferSize=u.getParameter(u.MAX_RENDERBUFFER_SIZE),le.a._maximumTextureSize=u.getParameter(u.MAX_TEXTURE_SIZE),le.a._maximumVaryingVectors=u.getParameter(u.MAX_VARYING_VECTORS),le.a._maximumVertexAttributes=u.getParameter(u.MAX_VERTEX_ATTRIBS),le.a._maximumVertexTextureImageUnits=u.getParameter(u.MAX_VERTEX_TEXTURE_IMAGE_UNITS),le.a._maximumVertexUniformVectors=u.getParameter(u.MAX_VERTEX_UNIFORM_VECTORS);var d=u.getParameter(u.ALIASED_LINE_WIDTH_RANGE);le.a._minimumAliasedLineWidth=d[0],le.a._maximumAliasedLineWidth=d[1];var f=u.getParameter(u.ALIASED_POINT_SIZE_RANGE);le.a._minimumAliasedPointSize=f[0],le.a._maximumAliasedPointSize=f[1];var c=u.getParameter(u.MAX_VIEWPORT_DIMS);le.a._maximumViewportWidth=c[0],le.a._maximumViewportHeight=c[1];var h=u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.HIGH_FLOAT);le.a._highpFloatSupported=0!==h.precision;var m=u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.HIGH_INT);le.a._highpIntSupported=0!==m.rangeMax,this._antialias=u.getContextAttributes().antialias,this._standardDerivatives=!!Eo(u,["OES_standard_derivatives"]),this._blendMinmax=!!Eo(u,["EXT_blend_minmax"]),this._elementIndexUint=!!Eo(u,["OES_element_index_uint"]),this._depthTexture=!!Eo(u,["WEBGL_depth_texture","WEBKIT_WEBGL_depth_texture"]),this._fragDepth=!!Eo(u,["EXT_frag_depth"]),this._debugShaders=Eo(u,["WEBGL_debug_shaders"]),this._textureFloat=!!Eo(u,["OES_texture_float"]),this._textureHalfFloat=!!Eo(u,["OES_texture_half_float"]),this._textureFloatLinear=!!Eo(u,["OES_texture_float_linear"]),this._textureHalfFloatLinear=!!Eo(u,["OES_texture_half_float_linear"]),this._colorBufferFloat=!!Eo(u,["EXT_color_buffer_float","WEBGL_color_buffer_float"]),this._floatBlend=!!Eo(u,["EXT_float_blend"]),this._colorBufferHalfFloat=!!Eo(u,["EXT_color_buffer_half_float"]),this._s3tc=!!Eo(u,["WEBGL_compressed_texture_s3tc","MOZ_WEBGL_compressed_texture_s3tc","WEBKIT_WEBGL_compressed_texture_s3tc"]),this._pvrtc=!!Eo(u,["WEBGL_compressed_texture_pvrtc","WEBKIT_WEBGL_compressed_texture_pvrtc"]),this._etc1=!!Eo(u,["WEBGL_compressed_texture_etc1"]);var p,_,g,v,y,b,w,O,x,C,T=t.allowTextureFilterAnisotropic?Eo(u,["EXT_texture_filter_anisotropic","WEBKIT_EXT_texture_filter_anisotropic"]):void 0;if(this._textureFilterAnisotropic=T,le.a._maximumTextureFilterAnisotropy=Object(o.default)(T)?u.getParameter(T.MAX_TEXTURE_MAX_ANISOTROPY_EXT):1,s){var E=this;p=function(){return E._gl.createVertexArray()},_=function(e){E._gl.bindVertexArray(e)},g=function(e){E._gl.deleteVertexArray(e)},v=function(e,t,a,i,r){u.drawElementsInstanced(e,t,a,i,r)},y=function(e,t,a,i){u.drawArraysInstanced(e,t,a,i)},b=function(e,t){u.vertexAttribDivisor(e,t)},w=function(e){u.drawBuffers(e)}}else O=Eo(u,["OES_vertex_array_object"]),Object(o.default)(O)&&(p=function(){return O.createVertexArrayOES()},_=function(e){O.bindVertexArrayOES(e)},g=function(e){O.deleteVertexArrayOES(e)}),x=Eo(u,["ANGLE_instanced_arrays"]),Object(o.default)(x)&&(v=function(e,t,a,i,r){x.drawElementsInstancedANGLE(e,t,a,i,r)},y=function(e,t,a,i){x.drawArraysInstancedANGLE(e,t,a,i)},b=function(e,t){x.vertexAttribDivisorANGLE(e,t)}),C=Eo(u,["WEBGL_draw_buffers"]),Object(o.default)(C)&&(w=function(e){C.drawBuffersWEBGL(e)});this.glCreateVertexArray=p,this.glBindVertexArray=_,this.glDeleteVertexArray=g,this.glDrawElementsInstanced=v,this.glDrawArraysInstanced=y,this.glVertexAttribDivisor=b,this.glDrawBuffers=w,this._vertexArrayObject=!!O,this._instancedArrays=!!x,this._drawBuffers=!!C,le.a._maximumDrawBuffers=this.drawBuffers?u.getParameter(Wn.a.MAX_DRAW_BUFFERS):1,le.a._maximumColorAttachments=this.drawBuffers?u.getParameter(Wn.a.MAX_COLOR_ATTACHMENTS):1,this._clearColor=new G.default(0,0,0,0),this._clearDepth=1,this._clearStencil=0;var A=new xo,S=new Kn(this),P=fe.a.fromCache();this._defaultPassState=S,this._defaultRenderState=P,this._defaultTexture=void 0,this._defaultCubeMap=void 0,this._us=A,this._currentRenderState=P,this._currentPassState=S,this._currentFramebuffer=void 0,this._maxFrameTextureUnitIndex=0,this._vertexAttribDivisors=[],this._previousDrawInstanced=!1;for(var D=0;D<le.a._maximumVertexAttributes;D++)this._vertexAttribDivisors.push(0);this._pickObjects={},this._nextPickColor=new Uint32Array(1),this.options=t,this.cache={},fe.a.apply(u,P,S),this._floatTexSixPlaces=qn(this)}var So,Po={};function Do(e,t,a,i){var r=e._currentRenderState,n=e._currentPassState;e._currentRenderState=t,e._currentPassState=a,fe.a.partialApply(e._gl,r,t,n,a,i)}function Io(e,t){if(t!==e._currentFramebuffer){e._currentFramebuffer=t;var a=So;if(Object(o.default)(t))t._bind(),a=t._getActiveColorAttachments();else{var i=e._gl;i.bindFramebuffer(i.FRAMEBUFFER,null)}e.drawBuffers&&e.glDrawBuffers(a)}}Object(s.default)(Ao.prototype,{id:{get:function(){return this._id}},webgl2:{get:function(){return this._webgl2}},canvas:{get:function(){return this._canvas}},shaderCache:{get:function(){return this._shaderCache}},textureCache:{get:function(){return this._textureCache}},uniformState:{get:function(){return this._us}},stencilBits:{get:function(){return this._stencilBits}},stencilBuffer:{get:function(){return this._stencilBits>=8}},antialias:{get:function(){return this._antialias}},standardDerivatives:{get:function(){return this._standardDerivatives||this._webgl2}},floatBlend:{get:function(){return this._floatBlend}},blendMinmax:{get:function(){return this._blendMinmax||this._webgl2}},elementIndexUint:{get:function(){return this._elementIndexUint||this._webgl2}},depthTexture:{get:function(){return this._depthTexture||this._webgl2}},floatingPointTexture:{get:function(){return this._webgl2||this._textureFloat}},floatTextureSixPlaces:{get:function(){return this._floatTexSixPlaces}},halfFloatingPointTexture:{get:function(){return this._webgl2||this._textureHalfFloat}},textureFloatLinear:{get:function(){return this._textureFloatLinear}},textureHalfFloatLinear:{get:function(){return this._webgl2&&this._textureFloatLinear||!this._webgl2&&this._textureHalfFloatLinear}},textureFilterAnisotropic:{get:function(){return!!this._textureFilterAnisotropic}},s3tc:{get:function(){return this._s3tc}},pvrtc:{get:function(){return this._pvrtc}},etc1:{get:function(){return this._etc1}},vertexArrayObject:{get:function(){return this._vertexArrayObject||this._webgl2}},fragmentDepth:{get:function(){return this._fragDepth||this._webgl2}},instancedArrays:{get:function(){return this._instancedArrays||this._webgl2}},colorBufferFloat:{get:function(){return this._colorBufferFloat}},colorBufferHalfFloat:{get:function(){return this._webgl2&&this._colorBufferFloat||!this._webgl2&&this._colorBufferHalfFloat}},drawBuffers:{get:function(){return this._drawBuffers||this._webgl2}},debugShaders:{get:function(){return this._debugShaders}},throwOnWebGLError:{get:function(){return this._throwOnWebGLError},set:function(e){this._throwOnWebGLError=e,this._gl=function(e,t){if(!Object(o.default)(t))return e;function a(a){return function(){var i=a.apply(e,arguments);return t(e,a,arguments),i}}var i={};for(var r in e){var n=e[r];n instanceof Function?i[r]=a(n):Object.defineProperty(i,r,To(e,r,t))}return i}(this._originalGLContext,e?Co:void 0)}},defaultTexture:{get:function(){return void 0===this._defaultTexture&&(this._defaultTexture=new S.a({context:this,source:{width:1,height:1,arrayBufferView:new Uint8Array([255,255,255,255])},flipY:!1})),this._defaultTexture}},defaultCubeMap:{get:function(){if(void 0===this._defaultCubeMap){var e={width:1,height:1,arrayBufferView:new Uint8Array([255,255,255,255])};this._defaultCubeMap=new Zn.a({context:this,source:{positiveX:e,negativeX:e,positiveY:e,negativeY:e,positiveZ:e,negativeZ:e},flipY:!1})}return this._defaultCubeMap}},drawingBufferHeight:{get:function(){return this._gl.drawingBufferHeight}},drawingBufferWidth:{get:function(){return this._gl.drawingBufferWidth}},defaultFramebuffer:{get:function(){return Po}}}),"undefined"!=typeof WebGLRenderingContext&&(So=[Wn.a.BACK]);var Mo=new Rn.a;Ao.prototype.clear=function(e,t){e=Object(n.default)(e,Mo),t=Object(n.default)(t,this._defaultPassState);var a=this._gl,i=0,r=e.color,s=e.depth,l=e.stencil;Object(o.default)(r)&&(G.default.equals(this._clearColor,r)||(G.default.clone(r,this._clearColor),a.clearColor(r.red,r.green,r.blue,r.alpha)),i|=a.COLOR_BUFFER_BIT),Object(o.default)(s)&&(s!==this._clearDepth&&(this._clearDepth=s,a.clearDepth(s)),i|=a.DEPTH_BUFFER_BIT),Object(o.default)(l)&&(l!==this._clearStencil&&(this._clearStencil=l,a.clearStencil(l)),i|=a.STENCIL_BUFFER_BIT),Do(this,Object(n.default)(e.renderState,this._defaultRenderState),t,!0),Io(this,Object(n.default)(e.framebuffer,t.framebuffer)),a.clear(i)},Ao.prototype.draw=function(e,t,a,i){t=Object(n.default)(t,this._defaultPassState);var r=Object(n.default)(e._framebuffer,t.framebuffer),s=Object(n.default)(e._renderState,this._defaultRenderState);a=Object(n.default)(a,e._shaderProgram),i=Object(n.default)(i,e._uniformMap),function(e,t,a,i,r){Io(e,t),Do(e,r,a,!1),i._bind(),e._maxFrameTextureUnitIndex=Math.max(e._maxFrameTextureUnitIndex,i.maximumTextureUnitIndex)}(this,r,t,a,s),function(e,t,a,i){var r=t._primitiveType,s=t._vertexArray,l=t._offset,u=t._count,d=t.instanceCount;e._us.model=Object(n.default)(t._modelMatrix,J.default.IDENTITY),a._setUniforms(i,e._us,e.validateShaderProgram),s._bind();var f=s.indexBuffer;Object(o.default)(f)?(l*=f.bytesPerIndex,u=Object(n.default)(u,f.numberOfIndices),0===d?e._gl.drawElements(r,u,f.indexDatatype,l):e.glDrawElementsInstanced(r,u,f.indexDatatype,l,d)):(u=Object(n.default)(u,s.numberOfVertices),0===d?e._gl.drawArrays(r,l,u):e.glDrawArraysInstanced(r,l,u,d)),s._unBind()}(this,e,a,i)},Ao.prototype.endFrame=function(){var e=this._gl;e.useProgram(null),this._currentFramebuffer=void 0,e.bindFramebuffer(e.FRAMEBUFFER,null);var t=So;this.drawBuffers&&this.glDrawBuffers(t);var a=this._maxFrameTextureUnitIndex;this._maxFrameTextureUnitIndex=0;for(var i=0;i<a;++i)e.activeTexture(e.TEXTURE0+i),e.bindTexture(e.TEXTURE_2D,null),e.bindTexture(e.TEXTURE_CUBE_MAP,null)},Ao.prototype.readPixels=function(e){var t=this._gl;e=Object(n.default)(e,n.default.EMPTY_OBJECT);var a=Math.max(Object(n.default)(e.x,0),0),i=Math.max(Object(n.default)(e.y,0),0),r=Object(n.default)(e.width,t.drawingBufferWidth),s=Object(n.default)(e.height,t.drawingBufferHeight),l=e.framebuffer,u=we.a.UNSIGNED_BYTE;Object(o.default)(l)&&l.numberOfColorAttachments>0&&(u=l.getColorTexture(0).pixelDatatype);var d=_e.a.createTypedArray(_e.a.RGBA,u,r,s);return Io(this,l),t.readPixels(a,i,r,s,_e.a.RGBA,u,d),d};var Fo={position:0,textureCoordinates:1};function Ro(e,t,a){this._pickObjects=e,this.key=t,this.color=a}Ao.prototype.getViewportQuadVertexArray=function(){var e=this.cache.viewportQuad_vertexArray;if(!Object(o.default)(e)){var t=new Hn.a({attributes:{position:new kn.a({componentDatatype:Bn.a.FLOAT,componentsPerAttribute:2,values:[-1,-1,1,-1,1,1,-1,1]}),textureCoordinates:new kn.a({componentDatatype:Bn.a.FLOAT,componentsPerAttribute:2,values:[0,0,1,0,1,1,0,1]})},indices:new Uint16Array([0,1,2,0,2,3]),primitiveType:te.a.TRIANGLES});e=ce.a.fromGeometry({context:this,geometry:t,attributeLocations:Fo,bufferUsage:se.a.STATIC_DRAW,interleave:!0}),this.cache.viewportQuad_vertexArray=e}return e},Ao.prototype.createViewportQuadCommand=function(e,t){return t=Object(n.default)(t,n.default.EMPTY_OBJECT),new ue.a({vertexArray:this.getViewportQuadVertexArray(),primitiveType:te.a.TRIANGLES,renderState:t.renderState,shaderProgram:R.a.fromCache({context:this,vertexShaderSource:Nn,fragmentShaderSource:e,attributeLocations:Fo}),uniformMap:t.uniformMap,owner:t.owner,framebuffer:t.framebuffer,pass:t.pass})},Ao.prototype.getObjectByPickColor=function(e){return this._pickObjects[e.toRgba()]},Object(s.default)(Ro.prototype,{object:{get:function(){return this._pickObjects[this.key]},set:function(e){this._pickObjects[this.key]=e}}}),Ro.prototype.destroy=function(){delete this._pickObjects[this.key]},Ao.prototype.createPickId=function(e){++this._nextPickColor[0];var t=this._nextPickColor[0];if(0===t)throw new Gn.default("Out of unique Pick IDs.");return this._pickObjects[t]=e,new Ro(this._pickObjects,t,G.default.fromRgba(t))},Ao.prototype.isDestroyed=function(){return!1},Ao.prototype.destroy=function(){var e=this.cache;for(var t in e)if(e.hasOwnProperty(t)){var a=e[t];Object(o.default)(a.destroy)&&a.destroy()}return this._shaderCache=this._shaderCache.destroy(),this._textureCache=this._textureCache.destroy(),this._defaultTexture=this._defaultTexture&&this._defaultTexture.destroy(),this._defaultCubeMap=this._defaultCubeMap&&this._defaultCubeMap.destroy(),Object(l.default)(this)};var No=Ao,Lo="varying vec2 v_textureCoordinates;\nconst float M_PI = 3.141592653589793;\n\nfloat vdcRadicalInverse(int i)\n{\n    float r;\n    float base = 2.0;\n    float value = 0.0;\n    float invBase = 1.0 / base;\n    float invBi = invBase;\n    for (int x = 0; x < 100; x++)\n    {\n        if (i <= 0)\n        {\n            break;\n        }\n        r = mod(float(i), base);\n        value += r * invBi;\n        invBi *= invBase;\n        i = int(float(i) * invBase);\n    }\n    return value;\n}\n\nvec2 hammersley2D(int i, int N)\n{\n    return vec2(float(i) / float(N), vdcRadicalInverse(i));\n}\n\nvec3 importanceSampleGGX(vec2 xi, float roughness, vec3 N)\n{\n    float a = roughness * roughness;\n    float phi = 2.0 * M_PI * xi.x;\n    float cosTheta = sqrt((1.0 - xi.y) / (1.0 + (a * a - 1.0) * xi.y));\n    float sinTheta = sqrt(1.0 - cosTheta * cosTheta);\n    vec3 H = vec3(sinTheta * cos(phi), sinTheta * sin(phi), cosTheta);\n    vec3 upVector = abs(N.z) < 0.999 ? vec3(0.0, 0.0, 1.0) : vec3(1.0, 0.0, 0.0);\n    vec3 tangentX = normalize(cross(upVector, N));\n    vec3 tangentY = cross(N, tangentX);\n    return tangentX * H.x + tangentY * H.y + N * H.z;\n}\n\nfloat G1_Smith(float NdotV, float k)\n{\n    return NdotV / (NdotV * (1.0 - k) + k);\n}\n\nfloat G_Smith(float roughness, float NdotV, float NdotL)\n{\n    float k = roughness * roughness / 2.0;\n    return G1_Smith(NdotV, k) * G1_Smith(NdotL, k);\n}\n\nvec2 integrateBrdf(float roughness, float NdotV)\n{\n    vec3 V = vec3(sqrt(1.0 - NdotV * NdotV), 0.0, NdotV);\n    float A = 0.0;\n    float B = 0.0;\n    const int NumSamples = 1024;\n    for (int i = 0; i < NumSamples; i++)\n    {\n        vec2 xi = hammersley2D(i, NumSamples);\n        vec3 H = importanceSampleGGX(xi, roughness, vec3(0.0, 0.0, 1.0));\n        vec3 L = 2.0 * dot(V, H) * H - V;\n        float NdotL = clamp(L.z, 0.0, 1.0);\n        float NdotH = clamp(H.z, 0.0, 1.0);\n        float VdotH = clamp(dot(V, H), 0.0, 1.0);\n        if (NdotL > 0.0)\n        {\n            float G = G_Smith(roughness, NdotV, NdotL);\n            float G_Vis = G * VdotH / (NdotH * NdotV);\n            float Fc = pow(1.0 - VdotH, 5.0);\n            A += (1.0 - Fc) * G_Vis;\n            B += Fc * G_Vis;\n        }\n    }\n    return vec2(A, B) / float(NumSamples);\n}\n\nvoid main()\n{\n    gl_FragColor = vec4(integrateBrdf(v_textureCoordinates.y, v_textureCoordinates.x), 0.0, 1.0);\n}\n";function jo(){this._framebuffer=void 0,this._colorTexture=void 0,this._drawCommand=void 0}Object(s.default)(jo.prototype,{colorTexture:{get:function(){return this._colorTexture}}}),jo.prototype.update=function(e){if(!Object(o.default)(this._colorTexture)){var t=e.context;!function(e,t){var a=new S.a({context:t,width:256,height:256,pixelFormat:_e.a.RGBA,pixelDatatype:we.a.UNSIGNED_BYTE,sampler:new Oe.a({wrapS:Te.a.CLAMP_TO_EDGE,wrapT:Te.a.CLAMP_TO_EDGE,minificationFilter:Ce.a.NEAREST,magnificationFilter:xe.a.NEAREST})});e._colorTexture=a;var i=new Ln.a({context:t,colorTextures:[a],destroyAttachments:!1});e._framebuffer=i}(this,t),function(e,t){var a=e._framebuffer,i=t.createViewportQuadCommand(Lo,{framebuffer:a,renderState:fe.a.fromCache({viewport:new nn.default(0,0,256,256)})});e._drawCommand=i}(this,t),this._drawCommand.execute(t),this._framebuffer=this._framebuffer&&this._framebuffer.destroy(),this._drawCommand.shaderProgram=this._drawCommand.shaderProgram&&this._drawCommand.shaderProgram.destroy()}},jo.prototype.isDestroyed=function(){return!1},jo.prototype.destroy=function(){return this._colorTexture=this._colorTexture&&this._colorTexture.destroy(),Object(l.default)(this)};var Vo=jo,Uo=a(201),zo=a(228),Bo=a(345),Ho=a(262),ko=a(721),Go=Object(ie.default)({ROTATE:0,INFINITE_SCROLL:1});function Wo(e){this._scene=e,this._transform=J.default.clone(J.default.IDENTITY),this._invTransform=J.default.clone(J.default.IDENTITY),this._actualTransform=J.default.clone(J.default.IDENTITY),this._actualInvTransform=J.default.clone(J.default.IDENTITY),this._transformChanged=!1,this.position=new i.default,this._position=new i.default,this._positionWC=new i.default,this._positionCartographic=new y.default,this._oldPositionWC=void 0,this.positionWCDeltaMagnitude=0,this.positionWCDeltaMagnitudeLastFrame=0,this.timeSinceMoved=0,this._lastMovedTimestamp=0,this.direction=new i.default,this._direction=new i.default,this._directionWC=new i.default,this.up=new i.default,this._up=new i.default,this._upWC=new i.default,this.right=new i.default,this._right=new i.default,this._rightWC=new i.default,this.frustum=new Dn.a,this.frustum.aspectRatio=e.drawingBufferWidth/e.drawingBufferHeight,this.frustum.fov=K.default.toRadians(60),this.defaultMoveAmount=1e5,this.defaultLookAmount=Math.PI/60,this.defaultRotateAmount=Math.PI/3600,this.defaultZoomAmount=1e5,this.constrainedAxis=void 0,this.maximumZoomFactor=1.5,this._moveStart=new w.default,this._moveEnd=new w.default,this._changed=new w.default,this._changedPosition=void 0,this._changedDirection=void 0,this._changedFrustum=void 0,this.percentageChanged=.5,this._viewMatrix=new J.default,this._invViewMatrix=new J.default,Yo(this),this._mode=L.a.SCENE3D,this._modeChanged=!0;var t=e.mapProjection;this._projection=t,this._maxCoord=t.project(new y.default(Math.PI,K.default.PI_OVER_TWO)),this._max2Dfrustum=void 0,sl(this,Wo.DEFAULT_VIEW_RECTANGLE,this.position,!0);var a=i.default.magnitude(this.position);a+=a*Wo.DEFAULT_VIEW_FACTOR,i.default.normalize(this.position,this.position),i.default.multiplyByScalar(this.position,a,this.position)}function Yo(e){J.default.computeView(e._position,e._direction,e._up,e._right,e._viewMatrix),J.default.multiply(e._viewMatrix,e._actualInvTransform,e._viewMatrix),J.default.inverseTransformation(e._viewMatrix,e._invViewMatrix)}Wo.TRANSFORM_2D=new J.default(0,0,1,0,1,0,0,0,0,1,0,0,0,0,0,1),Wo.TRANSFORM_2D_INVERSE=J.default.inverseTransformation(Wo.TRANSFORM_2D,new J.default),Wo.DEFAULT_VIEW_RECTANGLE=T.default.fromDegrees(-95,-20,-70,90),Wo.DEFAULT_VIEW_FACTOR=.5,Wo.DEFAULT_OFFSET=new Bo.default(0,-K.default.PI_OVER_FOUR,0),Wo.prototype.canPreloadFlight=function(){return Object(o.default)(this._currentFlight)&&this._mode!==L.a.SCENE2D},Wo.prototype._updateCameraChanged=function(){if(function(e){if(Object(o.default)(e._oldPositionWC)){e.positionWCDeltaMagnitudeLastFrame=e.positionWCDeltaMagnitude;var t=i.default.subtract(e.positionWC,e._oldPositionWC,e._oldPositionWC);e.positionWCDeltaMagnitude=i.default.magnitude(t),e._oldPositionWC=i.default.clone(e.positionWC,e._oldPositionWC),e.positionWCDeltaMagnitude>0?(e.timeSinceMoved=0,e._lastMovedTimestamp=Object(ca.default)()):e.timeSinceMoved=Math.max(Object(ca.default)()-e._lastMovedTimestamp,0)/1e3}else e._oldPositionWC=i.default.clone(e.positionWC,e._oldPositionWC)}(this),0!==this._changed.numberOfListeners){var e=this.percentageChanged;if(this._mode!==L.a.SCENE2D){if(!Object(o.default)(this._changedDirection))return this._changedPosition=i.default.clone(this.positionWC,this._changedPosition),void(this._changedDirection=i.default.clone(this.directionWC,this._changedDirection));var t,a=K.default.acosClamped(i.default.dot(this.directionWC,this._changedDirection));t=Object(o.default)(this.frustum.fovy)?a/(.5*this.frustum.fovy):a;var r=i.default.distance(this.positionWC,this._changedPosition)/this.positionCartographic.height;(t>e||r>e)&&(this._changed.raiseEvent(Math.max(t,r)),this._changedPosition=i.default.clone(this.positionWC,this._changedPosition),this._changedDirection=i.default.clone(this.directionWC,this._changedDirection))}else{if(!Object(o.default)(this._changedFrustum))return this._changedPosition=i.default.clone(this.position,this._changedPosition),void(this._changedFrustum=this.frustum.clone());var n,s=this.position,l=this._changedPosition,u=this.frustum,d=this._changedFrustum,f=s.x+u.left,c=s.x+u.right,h=l.x+d.left,m=l.x+d.right,p=s.y+u.bottom,_=s.y+u.top,g=l.y+d.bottom,v=l.y+d.top,y=Math.max(f,h),b=Math.min(c,m),w=Math.max(p,g),O=Math.min(_,v);if(y>=b||w>=_)n=1;else{var x=d;f<h&&c>m&&p<g&&_>v&&(x=u),n=1-(b-y)*(O-w)/((x.right-x.left)*(x.top-x.bottom))}n>e&&(this._changed.raiseEvent(n),this._changedPosition=i.default.clone(this.position,this._changedPosition),this._changedFrustum=this.frustum.clone(this._changedFrustum))}}};var Xo=new y.default,Qo=new i.default,qo=new i.default,Zo=new H.a,Ko=new H.a,Jo=new H.a,$o=new H.a,es=new H.a;var ts=new i.default;function as(e){var t=e._mode,a=!1,r=0;t===L.a.SCENE2D&&(a=(r=e.frustum.right-e.frustum.left)!==e._positionCartographic.height);var n=e._position,o=!i.default.equals(n,e.position)||a;o&&(n=i.default.clone(e.position,e._position));var s=e._direction,l=!i.default.equals(s,e.direction);l&&(i.default.normalize(e.direction,e.direction),s=i.default.clone(e.direction,e._direction));var u=e._up,d=!i.default.equals(u,e.up);d&&(i.default.normalize(e.up,e.up),u=i.default.clone(e.up,e._up));var f=e._right,c=!i.default.equals(f,e.right);c&&(i.default.normalize(e.right,e.right),f=i.default.clone(e.right,e._right));var h=e._transformChanged||e._modeChanged;e._transformChanged=!1,h&&(J.default.inverseTransformation(e._transform,e._invTransform),e._mode===L.a.COLUMBUS_VIEW||e._mode===L.a.SCENE2D?J.default.equals(J.default.IDENTITY,e._transform)?J.default.clone(Wo.TRANSFORM_2D,e._actualTransform):e._mode===L.a.COLUMBUS_VIEW?function(e){Br.default.basisTo2D(e._projection,e._transform,e._actualTransform)}(e):function(e){var t=e._projection,a=t.ellipsoid,r=J.default.getColumn(e._transform,3,Zo),n=a.cartesianToCartographic(r,Xo),o=t.project(n,Qo),s=Ko;s.x=o.z,s.y=o.x,s.z=o.y,s.w=1;var l=H.a.clone(H.a.UNIT_X,es),u=H.a.add(J.default.getColumn(e._transform,0,qo),r,qo);a.cartesianToCartographic(u,n),t.project(n,o);var d=Jo;d.x=o.z,d.y=o.x,d.z=o.y,d.w=0,i.default.subtract(d,s,d),d.x=0;var f=$o;if(i.default.magnitudeSquared(d)>K.default.EPSILON10)i.default.cross(l,d,f);else{var c=H.a.add(J.default.getColumn(e._transform,1,qo),r,qo);a.cartesianToCartographic(c,n),t.project(n,o),f.x=o.z,f.y=o.x,f.z=o.y,f.w=0,i.default.subtract(f,s,f),f.x=0,i.default.magnitudeSquared(f)<K.default.EPSILON10&&(H.a.clone(H.a.UNIT_Y,d),H.a.clone(H.a.UNIT_Z,f))}i.default.cross(f,l,d),i.default.normalize(d,d),i.default.cross(l,d,f),i.default.normalize(f,f),J.default.setColumn(e._actualTransform,0,d,e._actualTransform),J.default.setColumn(e._actualTransform,1,f,e._actualTransform),J.default.setColumn(e._actualTransform,2,l,e._actualTransform),J.default.setColumn(e._actualTransform,3,s,e._actualTransform)}(e):J.default.clone(e._transform,e._actualTransform),J.default.inverseTransformation(e._actualTransform,e._actualInvTransform),e._modeChanged=!1);var m=e._actualTransform;if(o||h)if(e._positionWC=J.default.multiplyByPoint(m,n,e._positionWC),t===L.a.SCENE3D||t===L.a.MORPHING)e._positionCartographic=e._projection.ellipsoid.cartesianToCartographic(e._positionWC,e._positionCartographic);else{var p=ts;p.x=e._positionWC.y,p.y=e._positionWC.z,p.z=e._positionWC.x,t===L.a.SCENE2D&&(p.z=r),e._projection.unproject(p,e._positionCartographic)}if(l||d||c){var _=i.default.dot(s,i.default.cross(u,f,ts));if(Math.abs(1-_)>K.default.EPSILON2){var g=1/i.default.magnitudeSquared(u),v=i.default.dot(u,s)*g,y=i.default.multiplyByScalar(s,v,ts);u=i.default.normalize(i.default.subtract(u,y,e._up),e._up),i.default.clone(u,e.up),f=i.default.cross(s,u,e._right),i.default.clone(f,e.right)}}(l||h)&&(e._directionWC=J.default.multiplyByPointAsVector(m,s,e._directionWC),i.default.normalize(e._directionWC,e._directionWC)),(d||h)&&(e._upWC=J.default.multiplyByPointAsVector(m,u,e._upWC),i.default.normalize(e._upWC,e._upWC)),(c||h)&&(e._rightWC=J.default.multiplyByPointAsVector(m,f,e._rightWC),i.default.normalize(e._rightWC,e._rightWC)),(o||l||d||c||h)&&Yo(e)}function is(e,t){var a;return a=K.default.equalsEpsilon(Math.abs(e.z),1,K.default.EPSILON3)?Math.atan2(t.y,t.x)-K.default.PI_OVER_TWO:Math.atan2(e.y,e.x)-K.default.PI_OVER_TWO,K.default.TWO_PI-K.default.zeroToTwoPi(a)}function rs(e){return K.default.PI_OVER_TWO-K.default.acosClamped(e.z)}function ns(e,t,a){var i=0;return K.default.equalsEpsilon(Math.abs(e.z),1,K.default.EPSILON3)||(i=Math.atan2(-a.z,t.z),i=K.default.zeroToTwoPi(i+K.default.TWO_PI)),i}var os=new J.default,ss=new J.default;Object(s.default)(Wo.prototype,{transform:{get:function(){return this._transform}},inverseTransform:{get:function(){return as(this),this._invTransform}},viewMatrix:{get:function(){return as(this),this._viewMatrix}},inverseViewMatrix:{get:function(){return as(this),this._invViewMatrix}},positionCartographic:{get:function(){return as(this),this._positionCartographic}},positionWC:{get:function(){return as(this),this._positionWC}},directionWC:{get:function(){return as(this),this._directionWC}},upWC:{get:function(){return as(this),this._upWC}},rightWC:{get:function(){return as(this),this._rightWC}},heading:{get:function(){if(this._mode!==L.a.MORPHING){var e=this._projection.ellipsoid,t=J.default.clone(this._transform,os),a=Br.default.eastNorthUpToFixedFrame(this.positionWC,e,ss);this._setTransform(a);var i=is(this.direction,this.up);return this._setTransform(t),i}}},pitch:{get:function(){if(this._mode!==L.a.MORPHING){var e=this._projection.ellipsoid,t=J.default.clone(this._transform,os),a=Br.default.eastNorthUpToFixedFrame(this.positionWC,e,ss);this._setTransform(a);var i=rs(this.direction);return this._setTransform(t),i}}},roll:{get:function(){if(this._mode!==L.a.MORPHING){var e=this._projection.ellipsoid,t=J.default.clone(this._transform,os),a=Br.default.eastNorthUpToFixedFrame(this.positionWC,e,ss);this._setTransform(a);var i=ns(this.direction,this.up,this.right);return this._setTransform(t),i}}},moveStart:{get:function(){return this._moveStart}},moveEnd:{get:function(){return this._moveEnd}},changed:{get:function(){return this._changed}}}),Wo.prototype.update=function(e){var t=!1;if(e!==this._mode&&(this._mode=e,this._modeChanged=e!==L.a.MORPHING,t=this._mode===L.a.SCENE2D),t){var a=this._max2Dfrustum=this.frustum.clone(),i=a.top/a.right;a.right=2*this._maxCoord.x,a.left=-a.right,a.top=i*a.right,a.bottom=-a.top}this._mode===L.a.SCENE2D&&Ss(this,this.position)};var ls=new i.default,us=new i.default,ds=new i.default;Wo.prototype._setTransform=function(e){var t=i.default.clone(this.positionWC,ls),a=i.default.clone(this.upWC,us),r=i.default.clone(this.directionWC,ds);J.default.clone(e,this._transform),this._transformChanged=!0,as(this);var n=this._actualInvTransform;J.default.multiplyByPoint(n,t,this.position),J.default.multiplyByPointAsVector(n,r,this.direction),J.default.multiplyByPointAsVector(n,a,this.up),i.default.cross(this.direction,this.up,this.right),as(this)};var fs=new B.default,cs=new C.default,hs=new i.default,ms=new i.default;Wo.prototype._adjustOrthographicFrustum=function(e){if(this.frustum instanceof ee.a&&(e||!(this._positionCartographic.height<15e4)))if(J.default.equals(J.default.IDENTITY,this.transform)){var t,a,r=this._scene,n=r.globe;if(Object(o.default)(n)){var s=fs;s.x=r.drawingBufferWidth/2,s.y=r.drawingBufferHeight/2;var l=this.getPickRay(s,cs);if(t=n.pickWorldCoordinates(l,r,hs),r.pickPositionSupported&&(a=r.pickPositionWorldCoordinates(s,ms)),Object(o.default)(t)&&Object(o.default)(a)){var u=Object(o.default)(a)?i.default.distance(a,this.positionWC):Number.POSITIVE_INFINITY,d=Object(o.default)(t)?i.default.distance(t,this.positionWC):Number.POSITIVE_INFINITY;this.frustum.width=Math.min(u,d)}else Object(o.default)(a)?this.frustum.width=i.default.distance(a,this.positionWC):Object(o.default)(t)&&(this.frustum.width=i.default.distance(t,this.positionWC))}if(!Object(o.default)(n)||!Object(o.default)(t)&&!Object(o.default)(a)){var f=Math.max(this.positionCartographic.height,0);this.frustum.width=f}}else this.frustum.width=i.default.magnitude(this.position)};var ps=new i.default,_s=new J.default,gs=new J.default,vs=new gi.default,ys=new _i.default,bs=new y.default;var ws=new i.default,Os=new i.default,xs=new i.default;function Cs(e,t,a,r){var n=i.default.clone(a.direction,ws),o=i.default.clone(a.up,Os);if(e._scene.mode===L.a.SCENE3D){var s=e._projection.ellipsoid,l=Br.default.eastNorthUpToFixedFrame(t,s,os),u=J.default.inverseTransformation(l,ss);J.default.multiplyByPointAsVector(u,n,n),J.default.multiplyByPointAsVector(u,o,o)}var d=i.default.cross(n,o,xs);return r.heading=is(n,o),r.pitch=rs(n),r.roll=ns(n,o,d),r}var Ts={destination:void 0,orientation:{direction:void 0,up:void 0,heading:void 0,pitch:void 0,roll:void 0},convert:void 0,endTransform:void 0},Es=new Ho.default;Wo.prototype.setView=function(e){e=Object(n.default)(e,n.default.EMPTY_OBJECT);var t=Object(n.default)(e.orientation,n.default.EMPTY_OBJECT),a=this._mode;if(a!==L.a.MORPHING){Object(o.default)(e.endTransform)&&this._setTransform(e.endTransform);var r=Object(n.default)(e.convert,!0),s=Object(n.default)(e.destination,i.default.clone(this.positionWC,ps));Object(o.default)(s)&&Object(o.default)(s.west)&&(s=this.getRectangleCameraCoordinates(s,ps),r=!1),Object(o.default)(t.direction)&&(t=Cs(this,s,t,Ts.orientation)),Es.heading=Object(n.default)(t.heading,0),Es.pitch=Object(n.default)(t.pitch,-K.default.PI_OVER_TWO),Es.roll=Object(n.default)(t.roll,0),a===L.a.SCENE3D?function(e,t,a){var r=J.default.clone(e.transform,_s),n=Br.default.eastNorthUpToFixedFrame(t,e._projection.ellipsoid,gs);e._setTransform(n),i.default.clone(i.default.ZERO,e.position),a.heading=a.heading-K.default.PI_OVER_TWO;var o=gi.default.fromHeadingPitchRoll(a,vs),s=_i.default.fromQuaternion(o,ys);_i.default.getColumn(s,0,e.direction),_i.default.getColumn(s,2,e.up),i.default.cross(e.direction,e.up,e.right),e._setTransform(r),e._adjustOrthographicFrustum(!0)}(this,s,Es):a===L.a.SCENE2D?function(e,t,a,r){var n=J.default.clone(e.transform,_s);if(e._setTransform(J.default.IDENTITY),!i.default.equals(t,e.positionWC)){if(r){var o=e._projection,s=o.ellipsoid.cartesianToCartographic(t,bs);t=o.project(s,ps)}B.default.clone(t,e.position);var l=.5*-t.z,u=-l,d=e.frustum;if(u>l){var f=d.top/d.right;d.right=u,d.left=l,d.top=d.right*f,d.bottom=-d.top}}if(e._scene.mapMode2D===Go.ROTATE){a.heading=a.heading-K.default.PI_OVER_TWO,a.pitch=-K.default.PI_OVER_TWO,a.roll=0;var c=gi.default.fromHeadingPitchRoll(a,vs),h=_i.default.fromQuaternion(c,ys);_i.default.getColumn(h,2,e.up),i.default.cross(e.direction,e.up,e.right)}e._setTransform(n)}(this,s,Es,r):function(e,t,a,r){var n=J.default.clone(e.transform,_s);if(e._setTransform(J.default.IDENTITY),!i.default.equals(t,e.positionWC)){if(r){var o=e._projection,s=o.ellipsoid.cartesianToCartographic(t,bs);t=o.project(s,ps)}i.default.clone(t,e.position)}a.heading=a.heading-K.default.PI_OVER_TWO;var l=gi.default.fromHeadingPitchRoll(a,vs),u=_i.default.fromQuaternion(l,ys);_i.default.getColumn(u,0,e.direction),_i.default.getColumn(u,2,e.up),i.default.cross(e.direction,e.up,e.right),e._setTransform(n),e._adjustOrthographicFrustum(!0)}(this,s,Es,r)}};var As=new i.default;function Ss(e,t){var a,i,r=e._scene.mapMode2D===Go.ROTATE,n=e._maxCoord.x,o=e._maxCoord.y;r?a=-(i=n):(i=t.x-2*n,a=t.x+2*n),t.x>n&&(t.x=i),t.x<-n&&(t.x=a),t.y>o&&(t.y=o),t.y<-o&&(t.y=-o)}Wo.prototype.flyHome=function(e){var t=this._mode;if(t===L.a.MORPHING&&this._scene.completeMorph(),t===L.a.SCENE2D)this.flyTo({destination:Wo.DEFAULT_VIEW_RECTANGLE,duration:e,endTransform:J.default.IDENTITY});else if(t===L.a.SCENE3D){var a=this.getRectangleCameraCoordinates(Wo.DEFAULT_VIEW_RECTANGLE),r=i.default.magnitude(a);r+=r*Wo.DEFAULT_VIEW_FACTOR,i.default.normalize(a,a),i.default.multiplyByScalar(a,r,a),this.flyTo({destination:a,duration:e,endTransform:J.default.IDENTITY})}else if(t===L.a.COLUMBUS_VIEW){var n=this._projection.ellipsoid.maximumRadius,o=new i.default(0,-1,1);o=i.default.multiplyByScalar(i.default.normalize(o,o),5*n,o),this.flyTo({destination:o,duration:e,orientation:{heading:0,pitch:-Math.acos(i.default.normalize(o,As).z),roll:0},endTransform:J.default.IDENTITY,convert:!1})}},Wo.prototype.worldToCameraCoordinates=function(e,t){return Object(o.default)(t)||(t=new H.a),as(this),J.default.multiplyByVector(this._actualInvTransform,e,t)},Wo.prototype.worldToCameraCoordinatesPoint=function(e,t){return Object(o.default)(t)||(t=new i.default),as(this),J.default.multiplyByPoint(this._actualInvTransform,e,t)},Wo.prototype.worldToCameraCoordinatesVector=function(e,t){return Object(o.default)(t)||(t=new i.default),as(this),J.default.multiplyByPointAsVector(this._actualInvTransform,e,t)},Wo.prototype.cameraToWorldCoordinates=function(e,t){return Object(o.default)(t)||(t=new H.a),as(this),J.default.multiplyByVector(this._actualTransform,e,t)},Wo.prototype.cameraToWorldCoordinatesPoint=function(e,t){return Object(o.default)(t)||(t=new i.default),as(this),J.default.multiplyByPoint(this._actualTransform,e,t)},Wo.prototype.cameraToWorldCoordinatesVector=function(e,t){return Object(o.default)(t)||(t=new i.default),as(this),J.default.multiplyByPointAsVector(this._actualTransform,e,t)};var Ps=new i.default;Wo.prototype.move=function(e,t){var a=this.position;i.default.multiplyByScalar(e,t,Ps),i.default.add(a,Ps,a),this._mode===L.a.SCENE2D&&Ss(this,a),this._adjustOrthographicFrustum(!0)},Wo.prototype.moveForward=function(e){e=Object(n.default)(e,this.defaultMoveAmount),this._mode===L.a.SCENE2D?zs(this,e):this.move(this.direction,e)},Wo.prototype.moveBackward=function(e){e=Object(n.default)(e,this.defaultMoveAmount),this._mode===L.a.SCENE2D?zs(this,-e):this.move(this.direction,-e)},Wo.prototype.moveUp=function(e){e=Object(n.default)(e,this.defaultMoveAmount),this.move(this.up,e)},Wo.prototype.moveDown=function(e){e=Object(n.default)(e,this.defaultMoveAmount),this.move(this.up,-e)},Wo.prototype.moveRight=function(e){e=Object(n.default)(e,this.defaultMoveAmount),this.move(this.right,e)},Wo.prototype.moveLeft=function(e){e=Object(n.default)(e,this.defaultMoveAmount),this.move(this.right,-e)},Wo.prototype.lookLeft=function(e){e=Object(n.default)(e,this.defaultLookAmount),this._mode!==L.a.SCENE2D&&this.look(this.up,-e)},Wo.prototype.lookRight=function(e){e=Object(n.default)(e,this.defaultLookAmount),this._mode!==L.a.SCENE2D&&this.look(this.up,e)},Wo.prototype.lookUp=function(e){e=Object(n.default)(e,this.defaultLookAmount),this._mode!==L.a.SCENE2D&&this.look(this.right,-e)},Wo.prototype.lookDown=function(e){e=Object(n.default)(e,this.defaultLookAmount),this._mode!==L.a.SCENE2D&&this.look(this.right,e)};var Ds=new gi.default,Is=new _i.default;Wo.prototype.look=function(e,t){var a=Object(n.default)(t,this.defaultLookAmount),i=gi.default.fromAxisAngle(e,-a,Ds),r=_i.default.fromQuaternion(i,Is),o=this.direction,s=this.up,l=this.right;_i.default.multiplyByVector(r,o,o),_i.default.multiplyByVector(r,s,s),_i.default.multiplyByVector(r,l,l)},Wo.prototype.twistLeft=function(e){e=Object(n.default)(e,this.defaultLookAmount),this.look(this.direction,e)},Wo.prototype.twistRight=function(e){e=Object(n.default)(e,this.defaultLookAmount),this.look(this.direction,-e)};var Ms=new gi.default,Fs=new _i.default;Wo.prototype.rotate=function(e,t){var a=Object(n.default)(t,this.defaultRotateAmount),r=gi.default.fromAxisAngle(e,-a,Ms),o=_i.default.fromQuaternion(r,Fs);_i.default.multiplyByVector(o,this.position,this.position),_i.default.multiplyByVector(o,this.direction,this.direction),_i.default.multiplyByVector(o,this.up,this.up),i.default.cross(this.direction,this.up,this.right),i.default.cross(this.right,this.direction,this.up),this._adjustOrthographicFrustum(!1)},Wo.prototype.rotateDown=function(e){Vs(this,e=Object(n.default)(e,this.defaultRotateAmount))},Wo.prototype.rotateUp=function(e){Vs(this,-(e=Object(n.default)(e,this.defaultRotateAmount)))};var Rs=new i.default,Ns=new i.default,Ls=new i.default,js=new i.default;function Vs(e,t){var a=e.position;if(Object(o.default)(e.constrainedAxis)&&!i.default.equalsEpsilon(e.position,i.default.ZERO,K.default.EPSILON2)){var r=i.default.normalize(a,Rs),n=i.default.equalsEpsilon(r,e.constrainedAxis,K.default.EPSILON2),s=i.default.equalsEpsilon(r,i.default.negate(e.constrainedAxis,js),K.default.EPSILON2);if(n||s)(n&&t<0||s&&t>0)&&e.rotate(e.right,t);else{var l=i.default.normalize(e.constrainedAxis,Ns),u=i.default.dot(r,l),d=K.default.acosClamped(u);t>0&&t>d&&(t=d-K.default.EPSILON4),u=i.default.dot(r,i.default.negate(l,js)),d=K.default.acosClamped(u),t<0&&-t>d&&(t=-d+K.default.EPSILON4);var f=i.default.cross(l,r,Ls);e.rotate(f,t)}}else e.rotate(e.right,t)}function Us(e,t){Object(o.default)(e.constrainedAxis)?e.rotate(e.constrainedAxis,t):e.rotate(e.up,t)}function zs(e,t){var a,i=e.frustum;if(t*=.5,Math.abs(i.top)+Math.abs(i.bottom)>Math.abs(i.left)+Math.abs(i.right)){var r=i.top-t,n=i.bottom+t,o=e._maxCoord.y;e._scene.mapMode2D===Go.ROTATE&&(o*=e.maximumZoomFactor),n>o&&(n=o,r=-o),r<=n&&(r=1,n=-1),a=i.right/i.top,i.top=r,i.bottom=n,i.right=i.top*a,i.left=-i.right}else{var s=i.right-t,l=i.left+t,u=e._maxCoord.x;e._scene.mapMode2D===Go.ROTATE&&(u*=e.maximumZoomFactor),s>u&&(s=u,l=-u),s<=l&&(s=1,l=-1),a=i.top/i.right,i.right=s,i.left=l,i.top=i.right*a,i.bottom=-i.top}}function Bs(e,t){e.move(e.direction,t)}Wo.prototype.rotateRight=function(e){Us(this,-(e=Object(n.default)(e,this.defaultRotateAmount)))},Wo.prototype.rotateLeft=function(e){Us(this,e=Object(n.default)(e,this.defaultRotateAmount))},Wo.prototype.zoomIn=function(e){e=Object(n.default)(e,this.defaultZoomAmount),this._mode===L.a.SCENE2D?zs(this,e):Bs(this,e)},Wo.prototype.zoomOut=function(e){e=Object(n.default)(e,this.defaultZoomAmount),this._mode===L.a.SCENE2D?zs(this,-e):Bs(this,-e)},Wo.prototype.getMagnitude=function(){return this._mode===L.a.SCENE3D?i.default.magnitude(this.position):this._mode===L.a.COLUMBUS_VIEW?Math.abs(this.position.z):this._mode===L.a.SCENE2D?Math.max(this.frustum.right-this.frustum.left,this.frustum.top-this.frustum.bottom):void 0};var Hs=new J.default;Wo.prototype.lookAt=function(e,t){var a=Br.default.eastNorthUpToFixedFrame(e,d.default.WGS84,Hs);this.lookAtTransform(a,t)};var ks=new i.default,Gs=new gi.default,Ws=new gi.default,Ys=new _i.default;function Xs(e,t,a){t=K.default.clamp(t,-K.default.PI_OVER_TWO,K.default.PI_OVER_TWO),e=K.default.zeroToTwoPi(e)-K.default.PI_OVER_TWO;var r=gi.default.fromAxisAngle(i.default.UNIT_Y,-t,Gs),n=gi.default.fromAxisAngle(i.default.UNIT_Z,-e,Ws),o=gi.default.multiply(n,r,n),s=_i.default.fromQuaternion(o,Ys),l=i.default.clone(i.default.UNIT_X,ks);return _i.default.multiplyByVector(s,l,l),i.default.negate(l,l),i.default.multiplyByScalar(l,a,l),l}Wo.prototype.lookAtTransform=function(e,t){if(this._setTransform(e),Object(o.default)(t)){var a;if(a=Object(o.default)(t.heading)?Xs(t.heading,t.pitch,t.range):t,this._mode===L.a.SCENE2D){B.default.clone(B.default.ZERO,this.position),i.default.negate(a,this.up),this.up.z=0,i.default.magnitudeSquared(this.up)<K.default.EPSILON10&&i.default.clone(i.default.UNIT_Y,this.up),i.default.normalize(this.up,this.up),this._setTransform(J.default.IDENTITY),i.default.negate(i.default.UNIT_Z,this.direction),i.default.cross(this.direction,this.up,this.right),i.default.normalize(this.right,this.right);var r=this.frustum,n=r.top/r.right;return r.right=.5*i.default.magnitude(a),r.left=-r.right,r.top=n*r.right,r.bottom=-r.top,void this._setTransform(e)}i.default.clone(a,this.position),i.default.negate(this.position,this.direction),i.default.normalize(this.direction,this.direction),i.default.cross(this.direction,i.default.UNIT_Z,this.right),i.default.magnitudeSquared(this.right)<K.default.EPSILON10&&i.default.clone(i.default.UNIT_X,this.right),i.default.normalize(this.right,this.right),i.default.cross(this.right,this.direction,this.up),i.default.normalize(this.up,this.up),this._adjustOrthographicFrustum(!0)}};var Qs,qs=new y.default,Zs=new y.default,Ks=new i.default,Js=new i.default,$s=new i.default,el=new i.default,tl=new i.default,al=new i.default,il=new i.default,rl=new i.default,nl={direction:new i.default,right:new i.default,up:new i.default};function ol(e,t,a,r){return Math.abs(i.default.dot(t,a))/r-i.default.dot(e,a)}function sl(e,t,a,r){var n=e._projection.ellipsoid,s=r?e:nl,l=t.north,u=t.south,d=t.east,f=t.west;f>d&&(d+=K.default.TWO_PI);var c,h=.5*(f+d);if(u<-K.default.PI_OVER_TWO+K.default.RADIANS_PER_DEGREE&&l>K.default.PI_OVER_TWO-K.default.RADIANS_PER_DEGREE)c=0;else{var m=qs;m.longitude=h,m.latitude=l,m.height=0;var p=Zs;p.longitude=h,p.latitude=u,p.height=0;var _=Qs;Object(o.default)(_)&&_.ellipsoid===n||(Qs=_=new zo.default(void 0,void 0,n)),_.setEndPoints(m,p),c=_.interpolateUsingFraction(.5,qs).latitude}var g=qs;g.longitude=h,g.latitude=c,g.height=0;var v=n.cartographicToCartesian(g,il),y=qs;y.longitude=d,y.latitude=l;var b=n.cartographicToCartesian(y,Ks);y.longitude=f;var w=n.cartographicToCartesian(y,$s);y.longitude=h;var O=n.cartographicToCartesian(y,tl);y.latitude=u;var x=n.cartographicToCartesian(y,al);y.longitude=d;var C=n.cartographicToCartesian(y,el);y.longitude=f;var T=n.cartographicToCartesian(y,Js);i.default.subtract(w,v,w),i.default.subtract(C,v,C),i.default.subtract(b,v,b),i.default.subtract(T,v,T),i.default.subtract(O,v,O),i.default.subtract(x,v,x);var E=n.geodeticSurfaceNormal(v,s.direction);i.default.negate(E,E);var A=i.default.cross(E,i.default.UNIT_Z,s.right);i.default.normalize(A,A);var S,P=i.default.cross(A,E,s.up);if(e.frustum instanceof ee.a){var D,I,M=Math.max(i.default.distance(b,w),i.default.distance(C,T)),F=Math.max(i.default.distance(b,C),i.default.distance(w,T)),R=e.frustum._offCenterFrustum.right/e.frustum._offCenterFrustum.top,N=F*R;M>N?I=(D=M)/R:(I=F,D=N),S=Math.max(D,I)}else{var L=Math.tan(.5*e.frustum.fovy),j=e.frustum.aspectRatio*L;if(S=Math.max(ol(E,P,w,L),ol(E,P,C,L),ol(E,P,b,L),ol(E,P,T,L),ol(E,P,O,L),ol(E,P,x,L),ol(E,A,w,j),ol(E,A,C,j),ol(E,A,b,j),ol(E,A,T,j),ol(E,A,O,j),ol(E,A,x,j)),u<0&&l>0){var V=qs;V.longitude=f,V.latitude=0,V.height=0;var U=n.cartographicToCartesian(V,rl);i.default.subtract(U,v,U),S=Math.max(S,ol(E,P,U,L),ol(E,A,U,j)),V.longitude=d,U=n.cartographicToCartesian(V,rl),i.default.subtract(U,v,U),S=Math.max(S,ol(E,P,U,L),ol(E,A,U,j))}}return i.default.add(v,i.default.multiplyByScalar(E,-S,rl),a)}var ll=new y.default,ul=new i.default,dl=new i.default;var fl=new y.default,cl=new i.default,hl=new i.default;Wo.prototype.getRectangleCameraCoordinates=function(e,t){var a=this._mode;return Object(o.default)(t)||(t=new i.default),a===L.a.SCENE3D?sl(this,e,t):a===L.a.COLUMBUS_VIEW?function(e,t,a){var i=e._projection;t.west>t.east&&(t=T.default.MAX_VALUE);var r=e._actualTransform,n=e._actualInvTransform,s=ll;s.longitude=t.east,s.latitude=t.north;var l=i.project(s,ul);J.default.multiplyByPoint(r,l,l),J.default.multiplyByPoint(n,l,l),s.longitude=t.west,s.latitude=t.south;var u=i.project(s,dl);if(J.default.multiplyByPoint(r,u,u),J.default.multiplyByPoint(n,u,u),a.x=.5*(l.x-u.x)+u.x,a.y=.5*(l.y-u.y)+u.y,Object(o.default)(e.frustum.fovy)){var d=Math.tan(.5*e.frustum.fovy),f=e.frustum.aspectRatio*d;a.z=.5*Math.max((l.x-u.x)/f,(l.y-u.y)/d)}else{var c=l.x-u.x,h=l.y-u.y;a.z=Math.max(c,h)}return a}(this,e,t):a===L.a.SCENE2D?function(e,t,a){var i=e._projection,r=t.east;t.west>t.east&&(e._scene.mapMode2D===Go.INFINITE_SCROLL?r+=K.default.TWO_PI:r=(t=T.default.MAX_VALUE).east);var n=fl;n.longitude=r,n.latitude=t.north;var o=i.project(n,cl);n.longitude=t.west,n.latitude=t.south;var s,l,u=i.project(n,hl),d=.5*Math.abs(o.x-u.x),f=.5*Math.abs(o.y-u.y),c=e.frustum.right/e.frustum.top,h=f*c;return d>h?l=(s=d)/c:(l=f,s=h),f=Math.max(2*s,2*l),a.x=.5*(o.x-u.x)+u.x,a.y=.5*(o.y-u.y)+u.y,(n=i.unproject(a,n)).height=f,a=i.project(n,a)}(this,e,t):void 0};var ml=new C.default;var pl=new C.default;var _l=new C.default;Wo.prototype.pickEllipsoid=function(e,t,a){var r=this._scene.canvas;if(0!==r.clientWidth&&0!==r.clientHeight){if(Object(o.default)(a)||(a=new i.default),t=Object(n.default)(t,d.default.WGS84),this._mode===L.a.SCENE3D)a=function(e,t,a,i){a=Object(n.default)(a,d.default.WGS84);var r=e.getPickRay(t,ml),o=x.default.rayEllipsoid(r,a);if(o){var s=o.start>0?o.start:o.stop;return C.default.getPoint(r,s,i)}}(this,e,t,a);else if(this._mode===L.a.SCENE2D)a=function(e,t,a,r){var n=e.getPickRay(t,pl).origin;n=i.default.fromElements(n.y,n.z,0,n);var o=a.unproject(n);if(!(o.latitude<-K.default.PI_OVER_TWO||o.latitude>K.default.PI_OVER_TWO))return a.ellipsoid.cartographicToCartesian(o,r)}(this,e,this._projection,a);else{if(this._mode!==L.a.COLUMBUS_VIEW)return;a=function(e,t,a,r){var n=e.getPickRay(t,_l),o=-n.origin.x/n.direction.x;C.default.getPoint(n,o,r);var s=a.unproject(new i.default(r.y,r.z,0));if(!(s.latitude<-K.default.PI_OVER_TWO||s.latitude>K.default.PI_OVER_TWO||s.longitude<-Math.PI||s.longitude>Math.PI))return a.ellipsoid.cartographicToCartesian(s,r)}(this,e,this._projection,a)}return a}};var gl=new i.default,vl=new i.default,yl=new i.default;var bl=new i.default;Wo.prototype.getPickRay=function(e,t){Object(o.default)(t)||(t=new C.default);var a=this.frustum;return Object(o.default)(a.aspectRatio)&&Object(o.default)(a.fov)&&Object(o.default)(a.near)?function(e,t,a){var r=e._scene.canvas,n=r.clientWidth,o=r.clientHeight,s=Math.tan(.5*e.frustum.fovy),l=e.frustum.aspectRatio*s,u=e.frustum.near,d=2/n*t.x-1,f=2/o*(o-t.y)-1,c=e.positionWC;i.default.clone(c,a.origin);var h=i.default.multiplyByScalar(e.directionWC,u,gl);i.default.add(c,h,h);var m=i.default.multiplyByScalar(e.rightWC,d*u*l,vl),p=i.default.multiplyByScalar(e.upWC,f*u*s,yl),_=i.default.add(h,m,a.direction);return i.default.add(_,p,_),i.default.subtract(_,c,_),i.default.normalize(_,_),a}(this,e,t):function(e,t,a){var r=e._scene.canvas,n=r.clientWidth,s=r.clientHeight,l=e.frustum;Object(o.default)(l._offCenterFrustum)&&(l=l._offCenterFrustum);var u=2/n*t.x-1;u*=.5*(l.right-l.left);var d=2/s*(s-t.y)-1;d*=.5*(l.top-l.bottom);var f=a.origin;return i.default.clone(e.position,f),i.default.multiplyByScalar(e.right,u,bl),i.default.add(bl,f,f),i.default.multiplyByScalar(e.up,d,bl),i.default.add(bl,f,f),i.default.clone(e.directionWC,a.direction),e._mode!==L.a.COLUMBUS_VIEW&&e._mode!==L.a.SCENE2D||i.default.fromElements(a.origin.z,a.origin.x,a.origin.y,a.origin),a}(this,e,t)};var wl=new i.default,Ol=new i.default;Wo.prototype.distanceToBoundingSphere=function(e){var t=i.default.subtract(this.positionWC,e.center,wl),a=i.default.multiplyByScalar(this.directionWC,i.default.dot(t,this.directionWC),Ol);return Math.max(0,i.default.magnitude(a)-e.radius)};var xl=new B.default;Wo.prototype.getPixelSize=function(e,t,a){var i=this.distanceToBoundingSphere(e),r=this.frustum.getPixelDimensions(t,a,i,this._scene.pixelRatio,xl);return Math.max(r.x,r.y)};var Cl=new i.default,Tl=new i.default,El=new i.default,Al=new i.default;function Sl(e,t){var a=e.position,r=e.direction,n=e.worldToCameraCoordinatesVector(i.default.UNIT_X,Cl),o=-i.default.dot(n,a)/i.default.dot(n,r),s=i.default.add(a,i.default.multiplyByScalar(r,o,Tl),Tl);e.cameraToWorldCoordinatesPoint(s,s),a=e.cameraToWorldCoordinatesPoint(e.position,El);var l=Math.tan(.5*e.frustum.fovy),u=e.frustum.aspectRatio*l,d=i.default.magnitude(i.default.subtract(a,s,Al)),f=u*d,c=l*d,h=e._maxCoord.x,m=e._maxCoord.y,p=Math.max(f-h,h),_=Math.max(c-m,m);if(a.z<-p||a.z>p||a.y<-_||a.y>_){var g=s.y<-p||s.y>p,v=s.z<-_||s.z>_;if(g||v)return function(e,t,a,r,n,o){var s=i.default.clone(t);return a.y>r?s.y-=a.y-r:a.y<-r&&(s.y+=-r-a.y),a.z>n?s.z-=a.z-n:a.z<-n&&(s.z+=-n-a.z),{easingFunction:Uo.default.EXPONENTIAL_OUT,startObject:{time:0},stopObject:{time:1},duration:o,update:function(a){var r=i.default.lerp(t,s,a.time,new i.default);e.worldToCameraCoordinatesPoint(r,e.position)}}}(e,a,s,p,_,t)}}Wo.prototype.createCorrectPositionTween=function(e){if(this._mode===L.a.COLUMBUS_VIEW)return Sl(this,e)};var Pl=new i.default,Dl={destination:void 0,heading:void 0,pitch:void 0,roll:void 0,duration:void 0,complete:void 0,cancel:void 0,endTransform:void 0,maximumHeight:void 0,easingFunction:void 0};Wo.prototype.cancelFlight=function(){Object(o.default)(this._currentFlight)&&(this._currentFlight.cancelTween(),this._currentFlight=void 0)},Wo.prototype.flyTo=function(e){var t=(e=Object(n.default)(e,n.default.EMPTY_OBJECT)).destination;if(this._mode!==L.a.MORPHING){this.cancelFlight();var a=Object(n.default)(e.orientation,n.default.EMPTY_OBJECT);if(Object(o.default)(a.direction)&&(a=Cs(this,t,a,Ts.orientation)),Object(o.default)(e.duration)&&e.duration<=0){var i=Ts;return i.destination=e.destination,i.orientation.heading=a.heading,i.orientation.pitch=a.pitch,i.orientation.roll=a.roll,i.convert=e.convert,i.endTransform=e.endTransform,this.setView(i),void("function"==typeof e.complete&&e.complete())}var r=Object(o.default)(t.west);r&&(t=this.getRectangleCameraCoordinates(t,Pl));var s,l=this;Dl.destination=t,Dl.heading=a.heading,Dl.pitch=a.pitch,Dl.roll=a.roll,Dl.duration=e.duration,Dl.complete=function(){s===l._currentFlight&&(l._currentFlight=void 0),Object(o.default)(e.complete)&&e.complete()},Dl.cancel=e.cancel,Dl.endTransform=e.endTransform,Dl.convert=!r&&e.convert,Dl.maximumHeight=e.maximumHeight,Dl.pitchAdjustHeight=e.pitchAdjustHeight,Dl.flyOverLongitude=e.flyOverLongitude,Dl.flyOverLongitudeWeight=e.flyOverLongitudeWeight,Dl.easingFunction=e.easingFunction;var u=this._scene,d=ko.default.createTween(u,Dl);if(0!==d.duration){s=u.tweens.add(d),this._currentFlight=s;var f=this._scene.preloadFlightCamera;this._mode!==L.a.SCENE2D&&(Object(o.default)(f)||(f=Wo.clone(this)),f.setView({destination:t,orientation:a}),this._scene.preloadFlightCullingVolume=f.frustum.computeCullingVolume(f.positionWC,f.directionWC,f.upWC))}else"function"==typeof d.complete&&d.complete()}};var Il=100;function Ml(e,t,a){a=Bo.default.clone(Object(o.default)(a)?a:Wo.DEFAULT_OFFSET);var i=e._scene.screenSpaceCameraController.minimumZoomDistance,r=e._scene.screenSpaceCameraController.maximumZoomDistance,n=a.range;if(!Object(o.default)(n)||0===n){var s=t.radius;0===s?a.range=Il:e.frustum instanceof ee.a||e._mode===L.a.SCENE2D?a.range=function(e,t){var a,i,r=e.frustum;Object(o.default)(r._offCenterFrustum)&&(r=r._offCenterFrustum);var n=r.right/r.top,s=t*n;return t>s?i=(a=t)/n:(i=t,a=s),1.5*Math.max(a,i)}(e,s):a.range=function(e,t){var a=e.frustum,i=Math.tan(.5*a.fovy),r=a.aspectRatio*i;return Math.max(t/r,t/i)}(e,s),a.range=K.default.clamp(a.range,i,r)}return a}Wo.prototype.viewBoundingSphere=function(e,t){t=Ml(this,e,t),this.lookAt(e.center,t)};var Fl=new J.default,Rl=new i.default,Nl=new i.default,Ll=new i.default,jl=new i.default,Vl=new H.a,Ul=new gi.default,zl=new _i.default;Wo.prototype.flyToBoundingSphere=function(e,t){t=Object(n.default)(t,n.default.EMPTY_OBJECT);var a=this._mode===L.a.SCENE2D||this._mode===L.a.COLUMBUS_VIEW;this._setTransform(J.default.IDENTITY);var r,o=Ml(this,e,t.offset);r=a?i.default.multiplyByScalar(i.default.UNIT_Z,o.range,Rl):Xs(o.heading,o.pitch,o.range);var s,l,u=Br.default.eastNorthUpToFixedFrame(e.center,d.default.WGS84,Fl);if(J.default.multiplyByPoint(u,r,r),!a){if(s=i.default.subtract(e.center,r,Nl),i.default.normalize(s,s),l=J.default.multiplyByPointAsVector(u,i.default.UNIT_Z,Ll),1-Math.abs(i.default.dot(s,l))<K.default.EPSILON6){var f=gi.default.fromAxisAngle(s,o.heading,Ul),c=_i.default.fromQuaternion(f,zl);i.default.fromCartesian4(J.default.getColumn(u,1,Vl),l),_i.default.multiplyByVector(c,l,l)}var h=i.default.cross(s,l,jl);i.default.cross(h,s,l),i.default.normalize(l,l)}this.flyTo({destination:r,orientation:{direction:s,up:l},duration:t.duration,complete:t.complete,cancel:t.cancel,endTransform:t.endTransform,maximumHeight:t.maximumHeight,easingFunction:t.easingFunction,flyOverLongitude:t.flyOverLongitude,flyOverLongitudeWeight:t.flyOverLongitudeWeight,pitchAdjustHeight:t.pitchAdjustHeight})};var Bl=new i.default,Hl=new i.default,kl=new i.default,Gl=new i.default,Wl=[new i.default,new i.default,new i.default,new i.default];var Yl=new B.default,Xl=new i.default,Ql=[new y.default,new y.default,new y.default,new y.default];function ql(e,t,a,i,r,n){Yl.x=e,Yl.y=t;var s=i.pickEllipsoid(Yl,r,Xl);return Object(o.default)(s)?(Ql[a]=r.cartesianToCartographic(s,Ql[a]),1):(Ql[a]=r.cartesianToCartographic(n[a],Ql[a]),0)}Wo.prototype.computeViewRectangle=function(e,t){e=Object(n.default)(e,d.default.WGS84);var a=this.frustum.computeCullingVolume(this.positionWC,this.directionWC,this.upWC),r=new v.default(i.default.ZERO,e.maximumRadius);if(a.computeVisibility(r)!==Z.default.OUTSIDE){var o=this._scene.canvas,s=o.clientWidth,l=o.clientHeight,u=0,f=function(e,t){var a,r,n=t.radii,o=e.positionWC,s=i.default.multiplyComponents(t.oneOverRadii,o,Bl),l=i.default.magnitude(s),u=i.default.normalize(s,Hl);i.default.equalsEpsilon(u,i.default.UNIT_Z,K.default.EPSILON10)?(a=new i.default(0,1,0),r=new i.default(0,0,1)):(a=i.default.normalize(i.default.cross(i.default.UNIT_Z,u,kl),kl),r=i.default.normalize(i.default.cross(u,a,Gl),Gl));var d=Math.sqrt(i.default.magnitudeSquared(s)-1),f=i.default.multiplyByScalar(u,1/l,Bl),c=d/l,h=i.default.multiplyByScalar(a,c,Hl),m=i.default.multiplyByScalar(r,c,kl),p=i.default.add(f,m,Wl[0]);i.default.subtract(p,h,p),i.default.multiplyComponents(n,p,p);var _=i.default.subtract(f,m,Wl[1]);i.default.subtract(_,h,_),i.default.multiplyComponents(n,_,_);var g=i.default.subtract(f,m,Wl[2]);i.default.add(g,h,g),i.default.multiplyComponents(n,g,g);var v=i.default.add(f,m,Wl[3]);return i.default.add(v,h,v),i.default.multiplyComponents(n,v,v),Wl}(this,e);if(u+=ql(0,0,0,this,e,f),u+=ql(0,l,1,this,e,f),u+=ql(s,l,2,this,e,f),(u+=ql(s,0,3,this,e,f))<2)return T.default.MAX_VALUE;t=T.default.fromCartographicArray(Ql,t);for(var c=0,h=Ql[3].longitude,m=0;m<4;++m){var p=Ql[m].longitude,_=Math.abs(p-h);_>K.default.PI?c+=K.default.TWO_PI-_:c+=_,h=p}return K.default.equalsEpsilon(Math.abs(c),K.default.TWO_PI,K.default.EPSILON9)&&(t.west=-K.default.PI,t.east=K.default.PI,Ql[0].latitude>=0?t.north=K.default.PI_OVER_TWO:t.south=-K.default.PI_OVER_TWO),t}},Wo.prototype.switchToPerspectiveFrustum=function(){if(!(this._mode===L.a.SCENE2D||this.frustum instanceof Dn.a)){var e=this._scene;this.frustum=new Dn.a,this.frustum.aspectRatio=e.drawingBufferWidth/e.drawingBufferHeight,this.frustum.fov=K.default.toRadians(60)}},Wo.prototype.switchToOrthographicFrustum=function(){if(!(this._mode===L.a.SCENE2D||this.frustum instanceof ee.a)){var e=this._scene;this.frustum=new ee.a,this.frustum.aspectRatio=e.drawingBufferWidth/e.drawingBufferHeight,this.frustum.width=i.default.magnitude(this.position);var t=this.frustum.projectionMatrix;Object(o.default)(t)&&this._adjustOrthographicFrustum(!0)}},Wo.clone=function(e,t){return Object(o.default)(t)||(t=new Wo(e._scene)),i.default.clone(e.position,t.position),i.default.clone(e.direction,t.direction),i.default.clone(e.up,t.up),i.default.clone(e.right,t.right),J.default.clone(e._transform,t.transform),t._transformChanged=!0,t.frustum=e.frustum.clone(),t};var Zl=Wo,Kl=a(368);var Jl=function(e){this.pass=e.pass,this.commandList=e.commandList,this.camera=e.camera,this.cullingVolume=e.cullingVolume,this.ready=!1},$l=a(717),eu=a(66),tu=0,au=1;function iu(e){var t,a,r=e.frustum,o=e.orientation,s=e.origin,l=Object(n.default)(e.vertexFormat,kr.default.DEFAULT),u=Object(n.default)(e._drawNearPlane,!0);r instanceof Dn.a?(t=tu,a=Dn.a.packedLength):r instanceof ee.a&&(t=au,a=ee.a.packedLength),this._frustumType=t,this._frustum=r.clone(),this._origin=i.default.clone(s),this._orientation=gi.default.clone(o),this._drawNearPlane=u,this._vertexFormat=l,this._workerName="createFrustumGeometry",this.packedLength=2+a+i.default.packedLength+gi.default.packedLength+kr.default.packedLength}iu.pack=function(e,t,a){a=Object(n.default)(a,0);var r=e._frustumType,o=e._frustum;return t[a++]=r,r===tu?(Dn.a.pack(o,t,a),a+=Dn.a.packedLength):(ee.a.pack(o,t,a),a+=ee.a.packedLength),i.default.pack(e._origin,t,a),a+=i.default.packedLength,gi.default.pack(e._orientation,t,a),a+=gi.default.packedLength,kr.default.pack(e._vertexFormat,t,a),t[a+=kr.default.packedLength]=e._drawNearPlane?1:0,t};var ru=new Dn.a,nu=new ee.a,ou=new gi.default,su=new i.default,lu=new kr.default;function uu(e,t,a,i,r,n,s,l){for(var u=e/3*2,d=0;d<4;++d)Object(o.default)(t)&&(t[e]=n.x,t[e+1]=n.y,t[e+2]=n.z),Object(o.default)(a)&&(a[e]=s.x,a[e+1]=s.y,a[e+2]=s.z),Object(o.default)(i)&&(i[e]=l.x,i[e+1]=l.y,i[e+2]=l.z),e+=3;r[u]=0,r[u+1]=0,r[u+2]=1,r[u+3]=0,r[u+4]=1,r[u+5]=1,r[u+6]=0,r[u+7]=1}iu.unpack=function(e,t,a){t=Object(n.default)(t,0);var r,s=e[t++];s===tu?(r=Dn.a.unpack(e,t,ru),t+=Dn.a.packedLength):(r=ee.a.unpack(e,t,nu),t+=ee.a.packedLength);var l=i.default.unpack(e,t,su);t+=i.default.packedLength;var u=gi.default.unpack(e,t,ou);t+=gi.default.packedLength;var d=kr.default.unpack(e,t,lu),f=1===e[t+=kr.default.packedLength];if(!Object(o.default)(a))return new iu({frustum:r,origin:l,orientation:u,vertexFormat:d,_drawNearPlane:f});var c=s===a._frustumType?a._frustum:void 0;return a._frustum=r.clone(c),a._frustumType=s,a._origin=i.default.clone(l,a._origin),a._orientation=gi.default.clone(u,a._orientation),a._vertexFormat=kr.default.clone(d,a._vertexFormat),a._drawNearPlane=f,a};var du=new _i.default,fu=new J.default,cu=new J.default,hu=new i.default,mu=new i.default,pu=new i.default,_u=new i.default,gu=new i.default,vu=new i.default,yu=new Array(3),bu=new Array(4);bu[0]=new H.a(-1,-1,1,1),bu[1]=new H.a(1,-1,1,1),bu[2]=new H.a(1,1,1,1),bu[3]=new H.a(-1,1,1,1);for(var wu=new Array(4),Ou=0;Ou<4;++Ou)wu[Ou]=new H.a;iu._computeNearFarPlanes=function(e,t,a,r,s,l,u,d){var f=_i.default.fromQuaternion(t,du),c=Object(n.default)(l,hu),h=Object(n.default)(u,mu),m=Object(n.default)(d,pu);c=_i.default.getColumn(f,0,c),h=_i.default.getColumn(f,1,h),m=_i.default.getColumn(f,2,m),i.default.normalize(c,c),i.default.normalize(h,h),i.default.normalize(m,m),i.default.negate(c,c);var p,_,g=J.default.computeView(e,m,h,c,fu);if(a===tu){var v=r.projectionMatrix,y=J.default.multiply(v,g,cu);_=J.default.inverse(y,cu)}else p=J.default.inverseTransformation(g,cu);Object(o.default)(_)?(yu[0]=r.near,yu[1]=r.far):(yu[0]=0,yu[1]=r.near,yu[2]=r.far);for(var b=0;b<2;++b)for(var w=0;w<4;++w){var O=H.a.clone(bu[w],wu[w]);if(Object(o.default)(_)){var x=1/(O=J.default.multiplyByVector(_,O,O)).w;i.default.multiplyByScalar(O,x,O),i.default.subtract(O,e,O),i.default.normalize(O,O);var C=i.default.dot(m,O);i.default.multiplyByScalar(O,yu[b]/C,O),i.default.add(O,e,O)}else{Object(o.default)(r._offCenterFrustum)&&(r=r._offCenterFrustum);var T=yu[b],E=yu[b+1];O.x=.5*(O.x*(r.right-r.left)+r.left+r.right),O.y=.5*(O.y*(r.top-r.bottom)+r.bottom+r.top),O.z=.5*(O.z*(T-E)-T-E),O.w=1,J.default.multiplyByVector(p,O,O)}s[12*b+3*w]=O.x,s[12*b+3*w+1]=O.y,s[12*b+3*w+2]=O.z}},iu.createGeometry=function(e){var t=e._frustumType,a=e._frustum,r=e._origin,n=e._orientation,s=e._drawNearPlane,l=e._vertexFormat,u=s?6:5,d=new Float64Array(72);iu._computeNearFarPlanes(r,n,t,a,d);var f=24;d[f]=d[12],d[f+1]=d[13],d[f+2]=d[14],d[f+3]=d[0],d[f+4]=d[1],d[f+5]=d[2],d[f+6]=d[9],d[f+7]=d[10],d[f+8]=d[11],d[f+9]=d[21],d[f+10]=d[22],d[f+11]=d[23],d[f+=12]=d[15],d[f+1]=d[16],d[f+2]=d[17],d[f+3]=d[3],d[f+4]=d[4],d[f+5]=d[5],d[f+6]=d[0],d[f+7]=d[1],d[f+8]=d[2],d[f+9]=d[12],d[f+10]=d[13],d[f+11]=d[14],d[f+=12]=d[3],d[f+1]=d[4],d[f+2]=d[5],d[f+3]=d[15],d[f+4]=d[16],d[f+5]=d[17],d[f+6]=d[18],d[f+7]=d[19],d[f+8]=d[20],d[f+9]=d[6],d[f+10]=d[7],d[f+11]=d[8],d[f+=12]=d[6],d[f+1]=d[7],d[f+2]=d[8],d[f+3]=d[18],d[f+4]=d[19],d[f+5]=d[20],d[f+6]=d[21],d[f+7]=d[22],d[f+8]=d[23],d[f+9]=d[9],d[f+10]=d[10],d[f+11]=d[11],s||(d=d.subarray(12));var c=new eu.a({position:new kn.a({componentDatatype:Bn.a.DOUBLE,componentsPerAttribute:3,values:d})});if(Object(o.default)(l.normal)||Object(o.default)(l.tangent)||Object(o.default)(l.bitangent)||Object(o.default)(l.st)){var h=Object(o.default)(l.normal)?new Float32Array(12*u):void 0,m=Object(o.default)(l.tangent)?new Float32Array(12*u):void 0,p=Object(o.default)(l.bitangent)?new Float32Array(12*u):void 0,_=Object(o.default)(l.st)?new Float32Array(8*u):void 0,g=hu,y=mu,b=pu,w=i.default.negate(g,_u),O=i.default.negate(y,gu),x=i.default.negate(b,vu);f=0,s&&(uu(f,h,m,p,_,x,g,y),f+=12),uu(f,h,m,p,_,b,w,y),uu(f+=12,h,m,p,_,w,x,y),uu(f+=12,h,m,p,_,O,x,w),uu(f+=12,h,m,p,_,g,b,y),uu(f+=12,h,m,p,_,y,b,w),Object(o.default)(h)&&(c.normal=new kn.a({componentDatatype:Bn.a.FLOAT,componentsPerAttribute:3,values:h})),Object(o.default)(m)&&(c.tangent=new kn.a({componentDatatype:Bn.a.FLOAT,componentsPerAttribute:3,values:m})),Object(o.default)(p)&&(c.bitangent=new kn.a({componentDatatype:Bn.a.FLOAT,componentsPerAttribute:3,values:p})),Object(o.default)(_)&&(c.st=new kn.a({componentDatatype:Bn.a.FLOAT,componentsPerAttribute:2,values:_}))}for(var C=new Uint16Array(6*u),T=0;T<u;++T){var E=6*T,A=4*T;C[E]=A,C[E+1]=A+1,C[E+2]=A+2,C[E+3]=A,C[E+4]=A+2,C[E+5]=A+3}return new Hn.a({attributes:c,indices:C,primitiveType:te.a.TRIANGLES,boundingSphere:v.default.fromVertices(d)})};var xu=iu,Cu=0,Tu=1;function Eu(e){var t,a,r=e.frustum,o=e.orientation,s=e.origin,l=Object(n.default)(e._drawNearPlane,!0);r instanceof Dn.a?(t=Cu,a=Dn.a.packedLength):r instanceof ee.a&&(t=Tu,a=ee.a.packedLength),this._frustumType=t,this._frustum=r.clone(),this._origin=i.default.clone(s),this._orientation=gi.default.clone(o),this._drawNearPlane=l,this._workerName="createFrustumOutlineGeometry",this.packedLength=2+a+i.default.packedLength+gi.default.packedLength}Eu.pack=function(e,t,a){a=Object(n.default)(a,0);var r=e._frustumType,o=e._frustum;return t[a++]=r,r===Cu?(Dn.a.pack(o,t,a),a+=Dn.a.packedLength):(ee.a.pack(o,t,a),a+=ee.a.packedLength),i.default.pack(e._origin,t,a),a+=i.default.packedLength,gi.default.pack(e._orientation,t,a),t[a+=gi.default.packedLength]=e._drawNearPlane?1:0,t};var Au=new Dn.a,Su=new ee.a,Pu=new gi.default,Du=new i.default;Eu.unpack=function(e,t,a){t=Object(n.default)(t,0);var r,s=e[t++];s===Cu?(r=Dn.a.unpack(e,t,Au),t+=Dn.a.packedLength):(r=ee.a.unpack(e,t,Su),t+=ee.a.packedLength);var l=i.default.unpack(e,t,Du);t+=i.default.packedLength;var u=gi.default.unpack(e,t,Pu),d=1===e[t+=gi.default.packedLength];if(!Object(o.default)(a))return new Eu({frustum:r,origin:l,orientation:u,_drawNearPlane:d});var f=s===a._frustumType?a._frustum:void 0;return a._frustum=r.clone(f),a._frustumType=s,a._origin=i.default.clone(l,a._origin),a._orientation=gi.default.clone(u,a._orientation),a._drawNearPlane=d,a},Eu.createGeometry=function(e){var t=e._frustumType,a=e._frustum,i=e._origin,r=e._orientation,n=e._drawNearPlane,o=new Float64Array(24);xu._computeNearFarPlanes(i,r,t,a,o);for(var s,l,u=new eu.a({position:new kn.a({componentDatatype:Bn.a.DOUBLE,componentsPerAttribute:3,values:o})}),d=n?2:1,f=new Uint16Array(8*(d+1)),c=n?0:1;c<2;++c)l=4*c,f[s=n?8*c:0]=l,f[s+1]=l+1,f[s+2]=l+1,f[s+3]=l+2,f[s+4]=l+2,f[s+5]=l+3,f[s+6]=l+3,f[s+7]=l;for(c=0;c<2;++c)l=4*c,f[s=8*(d+c)]=l,f[s+1]=l+4,f[s+2]=l+1,f[s+3]=l+5,f[s+4]=l+2,f[s+5]=l+6,f[s+6]=l+3,f[s+7]=l+7;return new Hn.a({attributes:u,indices:f,primitiveType:te.a.LINES,boundingSphere:v.default.fromVertices(o)})};var Iu=Eu;function Mu(e){e=Object(n.default)(e,n.default.EMPTY_OBJECT),this._camera=e.camera,this._color=Object(n.default)(e.color,G.default.CYAN),this._updateOnChange=Object(n.default)(e.updateOnChange,!0),this.show=Object(n.default)(e.show,!0),this.id=e.id,this._id=void 0,this._outlinePrimitives=[],this._planesPrimitives=[]}var Fu=new i.default,Ru=new _i.default,Nu=new gi.default,Lu=new Dn.a,ju=new In.a,Vu=new ee.a,Uu=new ha.a,zu=new G.default,Bu=[1,1e5];Mu.prototype.update=function(e){if(this.show){var t,a,r=this._planesPrimitives,n=this._outlinePrimitives;if(this._updateOnChange){for(a=r.length,t=0;t<a;++t)n[t]=n[t]&&n[t].destroy(),r[t]=r[t]&&r[t].destroy();r.length=0,n.length=0}if(0===r.length){var o,s=this._camera,l=s.frustum;o=l instanceof Dn.a?Lu:l instanceof In.a?ju:l instanceof ee.a?Vu:Uu,o=l.clone(o);var u=e.frustumSplits,d=u.length-1;d<=0&&((u=Bu)[0]=this._camera.frustum.near,u[1]=this._camera.frustum.far,d=1);var f=s.positionWC,c=s.directionWC,h=s.upWC,m=s.rightWC;m=i.default.negate(m,Fu);var p=Ru;_i.default.setColumn(p,0,m,p),_i.default.setColumn(p,1,h,p),_i.default.setColumn(p,2,c,p);var _=gi.default.fromRotationMatrix(p,Nu);for(r.length=n.length=d,t=0;t<d;++t)o.near=u[t],o.far=u[t+1],r[t]=new Ve.a({geometryInstances:new X.a({geometry:new xu({origin:f,orientation:_,frustum:o,_drawNearPlane:0===t}),attributes:{color:W.a.fromColor(G.default.fromAlpha(this._color,.1,zu))},id:this.id,pickPrimitive:this}),appearance:new je.a({translucent:!0,flat:!0}),asynchronous:!1}),n[t]=new Ve.a({geometryInstances:new X.a({geometry:new Iu({origin:f,orientation:_,frustum:o,_drawNearPlane:0===t}),attributes:{color:W.a.fromColor(this._color)},id:this.id,pickPrimitive:this}),appearance:new je.a({translucent:!1,flat:!0}),asynchronous:!1})}for(a=r.length,t=0;t<a;++t)n[t].update(e),r[t].update(e)}},Mu.prototype.isDestroyed=function(){return!1},Mu.prototype.destroy=function(){for(var e=this._planesPrimitives.length,t=0;t<e;++t)this._outlinePrimitives[t]=this._outlinePrimitives[t]&&this._outlinePrimitives[t].destroy(),this._planesPrimitives[t]=this._planesPrimitives[t]&&this._planesPrimitives[t].destroy();return Object(l.default)(this)};var Hu=Mu;function ku(){this._rs=void 0,this._sp=void 0,this._va=void 0,this._command=void 0,this._mode=void 0,this._useLogDepth=!1}var Gu=f.default.supportsTypedArrays()?new Float32Array(12):[],Wu=new i.default,Yu=new i.default,Xu=new i.default,Qu=new i.default;ku.prototype.update=function(e){if(this._mode=e.mode,e.mode===L.a.SCENE3D){var t=e.context,a=e.mapProjection.ellipsoid,r=e.useLogDepth;if(Object(o.default)(this._command)||(this._rs=fe.a.fromCache({cull:{enabled:!0},depthTest:{enabled:!0},colorMask:{red:!1,green:!1,blue:!1,alpha:!1}}),this._command=new ue.a({renderState:this._rs,boundingVolume:new v.default(i.default.ZERO,a.maximumRadius),pass:de.a.OPAQUE,owner:this})),!Object(o.default)(this._sp)||this._useLogDepth!==r){this._useLogDepth=r;var n=new A.a({sources:["attribute vec4 position;\n\nvarying vec4 positionEC;\n\nvoid main()\n{\n    positionEC = czm_modelView * position;\n    gl_Position = czm_projection * positionEC;\n\n    czm_vertexLogDepth();\n}\n"]}),s=new A.a({sources:["varying vec4 positionEC;\n\nvoid main()\n{\n    vec3 direction = normalize(positionEC.xyz);\n    czm_ray ray = czm_ray(vec3(0.0), direction);\n\n    vec3 ellipsoid_center = czm_view[3].xyz;\n\n    czm_raySegment intersection = czm_rayEllipsoidIntersectionInterval(ray, ellipsoid_center, czm_ellipsoidInverseRadii);\n    if (!czm_isEmpty(intersection))\n    {\n        gl_FragColor = vec4(1.0, 1.0, 0.0, 1.0);\n    }\n    else\n    {\n        discard;\n    }\n\n    czm_writeLogDepth();\n}\n"]});if(r){s.sources.push("#ifdef GL_EXT_frag_depth \n#extension GL_EXT_frag_depth : enable \n#endif \n\n"),s.defines.push("LOG_DEPTH"),n.defines.push("LOG_DEPTH"),n.defines.push("DISABLE_GL_POSITION_LOG_DEPTH")}this._sp=R.a.replaceCache({shaderProgram:this._sp,context:t,vertexShaderSource:n,fragmentShaderSource:s,attributeLocations:{position:0}}),this._command.shaderProgram=this._sp}var l=function(e,t){var a=e.radii,r=t.camera.positionWC,n=i.default.multiplyComponents(e.oneOverRadii,r,Wu),o=i.default.magnitude(n),s=i.default.normalize(n,Yu),l=i.default.normalize(i.default.cross(i.default.UNIT_Z,n,Xu),Xu),u=i.default.normalize(i.default.cross(s,l,Qu),Qu),d=Math.sqrt(i.default.magnitudeSquared(n)-1),f=i.default.multiplyByScalar(s,1/o,Wu),c=d/o,h=i.default.multiplyByScalar(l,c,Yu),m=i.default.multiplyByScalar(u,c,Xu),p=i.default.add(f,m,Qu);i.default.subtract(p,h,p),i.default.multiplyComponents(a,p,p),i.default.pack(p,Gu,0);var _=i.default.subtract(f,m,Qu);i.default.subtract(_,h,_),i.default.multiplyComponents(a,_,_),i.default.pack(_,Gu,3);var g=i.default.add(f,m,Qu);i.default.add(g,h,g),i.default.multiplyComponents(a,g,g),i.default.pack(g,Gu,6);var v=i.default.subtract(f,m,Qu);return i.default.add(v,h,v),i.default.multiplyComponents(a,v,v),i.default.pack(v,Gu,9),Gu}(a,e);if(Object(o.default)(this._va))this._va.getAttribute(0).vertexBuffer.copyFromArrayView(l);else{var u=new Hn.a({attributes:{position:new kn.a({componentDatatype:Bn.a.FLOAT,componentsPerAttribute:3,values:l})},indices:[0,1,2,2,1,3],primitiveType:te.a.TRIANGLES});this._va=ce.a.fromGeometry({context:t,geometry:u,attributeLocations:{position:0},bufferUsage:se.a.DYNAMIC_DRAW}),this._command.vertexArray=this._va}}},ku.prototype.execute=function(e,t){this._mode===L.a.SCENE3D&&this._command.execute(e,t)},ku.prototype.isDestroyed=function(){return!1},ku.prototype.destroy=function(){this._sp=this._sp&&this._sp.destroy(),this._va=this._va&&this._va.destroy()};var qu=ku;function Zu(){}var Ku=/\bgl_FragDepthEXT\b/,Ju=/\bdiscard\b/;Zu.createDepthOnlyDerivedCommand=function(e,t,a,i){var r,n;return Object(o.default)(i)||(i={}),Object(o.default)(i.depthOnlyCommand)&&(r=i.depthOnlyCommand.shaderProgram,n=i.depthOnlyCommand.renderState),i.depthOnlyCommand=ue.a.shallowClone(t,i.depthOnlyCommand),Object(o.default)(r)&&i.shaderProgramId===t.shaderProgram.id?(i.depthOnlyCommand.shaderProgram=r,i.depthOnlyCommand.renderState=n):(i.depthOnlyCommand.shaderProgram=function(e,t){var a=e.shaderCache.getDerivedShaderProgram(t,"depthOnly");if(!Object(o.default)(a)){var i,r=t._attributeLocations,n=t.fragmentShaderSource,s=!1,l=n.sources,u=l.length;for(i=0;i<u;++i)if(Ku.test(l[i])||Ju.test(l[i])){s=!0;break}var d,f=!1,c=n.defines;for(u=c.length,i=0;i<u;++i)if("LOG_DEPTH"===c[i]){f=!0;break}s||f?!s&&f&&(d="#ifdef GL_EXT_frag_depth \n#extension GL_EXT_frag_depth : enable \n#endif \n\nvoid main() \n{ \n    gl_FragColor = vec4(1.0); \n    czm_writeLogDepth(); \n} \n",n=new A.a({defines:["LOG_DEPTH"],sources:[d]})):(d="void main() \n{ \n    gl_FragColor = vec4(1.0); \n} \n",n=new A.a({sources:[d]})),a=e.shaderCache.createDerivedShaderProgram(t,"depthOnly",{vertexShaderSource:t.vertexShaderSource,fragmentShaderSource:n,attributeLocations:r})}return a}(a,t.shaderProgram),i.depthOnlyCommand.renderState=function(e,t){var a=e._depthOnlyRenderStateCache,i=a[t.id];if(!Object(o.default)(i)){var r=fe.a.getState(t);r.depthMask=!0,r.colorMask={red:!1,green:!1,blue:!1,alpha:!1},i=fe.a.fromCache(r),a[t.id]=i}return i}(e,t.renderState),i.shaderProgramId=t.shaderProgram.id),i};var $u=/\s+czm_writeLogDepth\(/,ed=/\s+czm_vertexLogDepth\(/,td=/\s*#extension\s+GL_EXT_frag_depth\s*:\s*enable/;Zu.createLogDepthCommand=function(e,t,a){var i;return Object(o.default)(a)||(a={}),Object(o.default)(a.command)&&(i=a.command.shaderProgram),a.command=ue.a.shallowClone(e,a.command),Object(o.default)(i)&&a.shaderProgramId===e.shaderProgram.id?a.command.shaderProgram=i:(a.command.shaderProgram=function(e,t){var a=e.shaderCache.getDerivedShaderProgram(t,"logDepth");if(!Object(o.default)(a)){var i,r=t._attributeLocations,n=t.vertexShaderSource.clone(),s=t.fragmentShaderSource.clone();n.defines=Object(o.default)(n.defines)?n.defines.slice(0):[],n.defines.push("LOG_DEPTH"),s.defines=Object(o.default)(s.defines)?s.defines.slice(0):[],s.defines.push("LOG_DEPTH");var l=!1,u=n.sources,d=u.length;for(i=0;i<d;++i)if(ed.test(u[i])){l=!0;break}if(!l){for(i=0;i<d;++i)u[i]=A.a.replaceMain(u[i],"czm_log_depth_main");"\n\nvoid main() \n{ \n    czm_log_depth_main(); \n    czm_vertexLogDepth(); \n} \n",u.push("\n\nvoid main() \n{ \n    czm_log_depth_main(); \n    czm_vertexLogDepth(); \n} \n")}var f=!0;for(l=!1,d=(u=s.sources).length,i=0;i<d;++i)$u.test(u[i])&&(l=!0),td.test(u[i])&&(f=!1);var c="";if(f&&(c+="#ifdef GL_EXT_frag_depth \n#extension GL_EXT_frag_depth : enable \n#endif \n\n"),!l){for(i=0;i<d;i++)u[i]=A.a.replaceMain(u[i],"czm_log_depth_main");c+="\nvoid main() \n{ \n    czm_log_depth_main(); \n    czm_writeLogDepth(); \n} \n"}u.push(c),a=e.shaderCache.createDerivedShaderProgram(t,"logDepth",{vertexShaderSource:n,fragmentShaderSource:s,attributeLocations:r})}return a}(t,e.shaderProgram),a.shaderProgramId=e.shaderProgram.id),a},Zu.createPickDerivedCommand=function(e,t,a,i){var r,n;return Object(o.default)(i)||(i={}),Object(o.default)(i.pickCommand)&&(r=i.pickCommand.shaderProgram,n=i.pickCommand.renderState),i.pickCommand=ue.a.shallowClone(t,i.pickCommand),Object(o.default)(r)&&i.shaderProgramId===t.shaderProgram.id?(i.pickCommand.shaderProgram=r,i.pickCommand.renderState=n):(i.pickCommand.shaderProgram=function(e,t,a){var i=e.shaderCache.getDerivedShaderProgram(t,"pick");if(!Object(o.default)(i)){for(var r=t._attributeLocations,n=t.fragmentShaderSource,s=n.sources,l=s.length,u="void main() \n{ \n    czm_non_pick_main(); \n    if (gl_FragColor.a == 0.0) { \n        discard; \n    } \n    gl_FragColor = "+a+"; \n} \n",d=new Array(l+1),f=0;f<l;++f)d[f]=A.a.replaceMain(s[f],"czm_non_pick_main");d[l]=u,n=new A.a({sources:d,defines:n.defines}),i=e.shaderCache.createDerivedShaderProgram(t,"pick",{vertexShaderSource:t.vertexShaderSource,fragmentShaderSource:n,attributeLocations:r})}return i}(a,t.shaderProgram,t.pickId),i.pickCommand.renderState=function(e,t){var a=e.picking.pickRenderStateCache,i=a[t.id];if(!Object(o.default)(i)){var r=fe.a.getState(t);r.blending.enabled=!1,r.depthMask=!0,i=fe.a.fromCache(r),a[t.id]=i}return i}(e,t.renderState),i.shaderProgramId=t.shaderProgram.id),i},Zu.createHdrCommand=function(e,t,a){var i;return Object(o.default)(a)||(a={}),Object(o.default)(a.command)&&(i=a.command.shaderProgram),a.command=ue.a.shallowClone(e,a.command),Object(o.default)(i)&&a.shaderProgramId===e.shaderProgram.id?a.command.shaderProgram=i:(a.command.shaderProgram=function(e,t){var a=e.shaderCache.getDerivedShaderProgram(t,"HDR");if(!Object(o.default)(a)){var i=t._attributeLocations,r=t.vertexShaderSource.clone(),n=t.fragmentShaderSource.clone();r.defines=Object(o.default)(r.defines)?r.defines.slice(0):[],r.defines.push("HDR"),n.defines=Object(o.default)(n.defines)?n.defines.slice(0):[],n.defines.push("HDR"),a=e.shaderCache.createDerivedShaderProgram(t,"HDR",{vertexShaderSource:r,fragmentShaderSource:n,attributeLocations:i})}return a}(t,e.shaderProgram),a.shaderProgramId=e.shaderProgram.id),a};var ad=Zu;function id(e){this._scene=e,this._lastAlpha=void 0,this._lastBeta=void 0,this._lastGamma=void 0,this._alpha=void 0,this._beta=void 0,this._gamma=void 0;var t=this;function a(e){var a=e.alpha;if(!Object(o.default)(a))return t._alpha=void 0,t._beta=void 0,void(t._gamma=void 0);t._alpha=K.default.toRadians(a),t._beta=K.default.toRadians(e.beta),t._gamma=K.default.toRadians(e.gamma)}window.addEventListener("deviceorientation",a,!1),this._removeListener=function(){window.removeEventListener("deviceorientation",a,!1)}}var rd=new gi.default,nd=new gi.default,od=new _i.default;id.prototype.update=function(){if(Object(o.default)(this._alpha)){Object(o.default)(this._lastAlpha)||(this._lastAlpha=this._alpha,this._lastBeta=this._beta,this._lastGamma=this._gamma);var e=this._lastAlpha-this._alpha,t=this._lastBeta-this._beta,a=this._lastGamma-this._gamma;!function(e,t,a,i){var r=e.direction,n=e.right,o=e.up,s=gi.default.fromAxisAngle(r,a,nd),l=gi.default.fromAxisAngle(n,i,rd),u=gi.default.multiply(l,s,l),d=gi.default.fromAxisAngle(o,t,nd);gi.default.multiply(d,u,u);var f=_i.default.fromQuaternion(u,od);_i.default.multiplyByVector(f,n,n),_i.default.multiplyByVector(f,o,o),_i.default.multiplyByVector(f,r,r)}(this._scene.camera,-e,t,a),this._lastAlpha=this._alpha,this._lastBeta=this._beta,this._lastGamma=this._gamma}},id.prototype.isDestroyed=function(){return!1},id.prototype.destroy=function(){return this._removeListener(),Object(l.default)(this)};var sd=id;function ld(){this.enabled=!0,this.density=2e-4,this.screenSpaceErrorFactor=2,this.minimumBrightness=.03}for(var ud=[359.393,800.749,1275.6501,2151.1192,3141.7763,4777.5198,6281.2493,12364.307,15900.765,49889.0549,78026.8259,99260.7344,120036.3873,151011.0158,156091.1953,203849.3112,274866.9803,319916.3149,493552.0528,628733.5874],dd=[2e-5,2e-4,1e-4,7e-5,5e-5,4e-5,3e-5,19e-6,1e-5,85e-7,62e-7,58e-7,53e-7,52e-7,51e-7,42e-7,4e-6,34e-7,26e-7,22e-7],fd=0;fd<dd.length;++fd)dd[fd]*=1e6;for(var cd=dd[1],hd=dd[dd.length-1],md=0;md<dd.length;++md)dd[md]=(dd[md]-hd)/(cd-hd);var pd=0;var _d=new i.default;ld.prototype.update=function(e){if(e.fog.enabled=this.enabled){var t=e.camera,a=t.positionCartographic;if(!Object(o.default)(a)||a.height>8e5||e.mode!==L.a.SCENE3D)e.fog.enabled=!1;else{var r=a.height,n=function(e){var t,a=ud,i=a.length;if(e<a[0])return pd=0;if(e>a[i-1])return pd=i-2;if(e>=a[pd]){if(pd+1<i&&e<a[pd+1])return pd;if(pd+2<i&&e<a[pd+2])return++pd}else if(pd-1>=0&&e>=a[pd-1])return--pd;for(t=0;t<i-2&&!(e>=a[t]&&e<a[t+1]);++t);return pd=t}(r),s=K.default.clamp((r-ud[n])/(ud[n+1]-ud[n]),0,1),l=K.default.lerp(dd[n],dd[n+1],s),u=1e6*this.density;l=l*(u-u/cd*hd)*1e-6;var d=i.default.normalize(t.positionWC,_d);l*=1-Math.abs(i.default.dot(t.directionWC,d)),e.fog.density=l,e.fog.sse=this.screenSpaceErrorFactor,e.fog.minimumBrightness=this.minimumBrightness}}};var gd=ld;var vd=function(e,t,a){this.context=e,this.commandList=[],this.shadowMaps=[],this.brdfLutGenerator=void 0,this.environmentMap=void 0,this.sphericalHarmonicCoefficients=void 0,this.specularEnvironmentMaps=void 0,this.specularEnvironmentMapsMaximumLOD=void 0,this.mode=L.a.SCENE3D,this.morphTime=L.a.getMorphTime(L.a.SCENE3D),this.frameNumber=0,this.newFrame=!1,this.time=void 0,this.jobScheduler=a,this.mapProjection=void 0,this.camera=void 0,this.cullingVolume=void 0,this.occluder=void 0,this.maximumScreenSpaceError=void 0,this.pixelRatio=1,this.passes={render:!1,pick:!1,depth:!1,postProcess:!1,offscreen:!1},this.creditDisplay=t,this.afterRender=[],this.scene3DOnly=!1,this.fog={enabled:!1,density:void 0,sse:void 0,minimumBrightness:void 0},this.terrainExaggeration=1,this.shadowState={shadowsEnabled:!0,lightShadowsEnabled:!0,shadowMaps:[],lightShadowMaps:[],nearPlane:1,farPlane:5e3,closestObjectSize:1e3,lastDirtyTime:0,outOfView:!0},this.imagerySplitPosition=0,this.frustumSplits=[],this.backgroundColor=void 0,this.light=void 0,this.minimumDisableDepthTestDistance=void 0,this.invertClassification=!1,this.invertClassificationColor=void 0,this.useLogDepth=!1,this.tilesetPassState=void 0,this.minimumTerrainHeight=0},yd="uniform sampler2D colorTexture;\n\nvarying vec2 v_textureCoordinates;\n\nvoid main()\n{\n    gl_FragColor = texture2D(colorTexture, v_textureCoordinates);\n}\n",bd="uniform sampler2D u_depthTexture;\n\nvarying vec2 v_textureCoordinates;\n\nvoid main()\n{\n    gl_FragColor = czm_packDepth(texture2D(u_depthTexture, v_textureCoordinates).r);\n}\n",wd=a(155),Od=a(204),xd=a(205);function Cd(){this._globeColorTexture=void 0,this._primitiveColorTexture=void 0,this._depthStencilTexture=void 0,this._globeDepthTexture=void 0,this._tempGlobeDepthTexture=void 0,this._tempCopyDepthTexture=void 0,this._globeColorFramebuffer=void 0,this._primitiveColorFramebuffer=void 0,this._copyDepthFramebuffer=void 0,this._tempCopyDepthFramebuffer=void 0,this._updateDepthFramebuffer=void 0,this._clearGlobeColorCommand=void 0,this._clearPrimitiveColorCommand=void 0,this._copyColorCommand=void 0,this._copyDepthCommand=void 0,this._tempCopyDepthCommand=void 0,this._updateDepthCommand=void 0,this._mergeColorCommand=void 0,this._viewport=new nn.default,this._rs=void 0,this._rsBlend=void 0,this._rsUpdate=void 0,this._useScissorTest=!1,this._scissorRectangle=void 0,this._useLogDepth=void 0,this._useHdr=void 0,this._clearGlobeDepth=void 0,this._debugGlobeDepthViewportCommand=void 0}function Td(e){e._globeColorTexture=e._globeColorTexture&&!e._globeColorTexture.isDestroyed()&&e._globeColorTexture.destroy(),e._depthStencilTexture=e._depthStencilTexture&&!e._depthStencilTexture.isDestroyed()&&e._depthStencilTexture.destroy(),e._globeDepthTexture=e._globeDepthTexture&&!e._globeDepthTexture.isDestroyed()&&e._globeDepthTexture.destroy()}function Ed(e){e._globeColorFramebuffer=e._globeColorFramebuffer&&!e._globeColorFramebuffer.isDestroyed()&&e._globeColorFramebuffer.destroy(),e._copyDepthFramebuffer=e._copyDepthFramebuffer&&!e._copyDepthFramebuffer.isDestroyed()&&e._copyDepthFramebuffer.destroy()}function Ad(e){e._tempCopyDepthFramebuffer=e._tempCopyDepthFramebuffer&&!e._tempCopyDepthFramebuffer.isDestroyed()&&e._tempCopyDepthFramebuffer.destroy(),e._updateDepthFramebuffer=e._updateDepthFramebuffer&&!e._updateDepthFramebuffer.isDestroyed()&&e._updateDepthFramebuffer.destroy(),e._tempGlobeDepthTexture=e._tempGlobeDepthTexture&&!e._tempGlobeDepthTexture.isDestroyed()&&e._tempGlobeDepthTexture.destroy()}function Sd(e){e._primitiveColorTexture=e._primitiveColorTexture&&!e._primitiveColorTexture.isDestroyed()&&e._primitiveColorTexture.destroy(),e._primitiveColorFramebuffer=e._primitiveColorFramebuffer&&!e._primitiveColorFramebuffer.isDestroyed()&&e._primitiveColorFramebuffer.destroy()}function Pd(e,t,a,i,r,n){var s=e._globeColorTexture,l=!Object(o.default)(s)||s.width!==a||s.height!==i||r!==e._useHdr;l&&(Td(e),Ed(e),function(e,t,a,i,r){var n=r?t.halfFloatingPointTexture?we.a.HALF_FLOAT:we.a.FLOAT:we.a.UNSIGNED_BYTE;e._globeColorTexture=new S.a({context:t,width:a,height:i,pixelFormat:_e.a.RGBA,pixelDatatype:n,sampler:new Oe.a({wrapS:Te.a.CLAMP_TO_EDGE,wrapT:Te.a.CLAMP_TO_EDGE,minificationFilter:Ce.a.NEAREST,magnificationFilter:xe.a.NEAREST})}),e._depthStencilTexture=new S.a({context:t,width:a,height:i,pixelFormat:_e.a.DEPTH_STENCIL,pixelDatatype:we.a.UNSIGNED_INT_24_8}),e._globeDepthTexture=new S.a({context:t,width:a,height:i,pixelFormat:_e.a.RGBA,pixelDatatype:we.a.UNSIGNED_BYTE,sampler:new Oe.a({wrapS:Te.a.CLAMP_TO_EDGE,wrapT:Te.a.CLAMP_TO_EDGE,minificationFilter:Ce.a.NEAREST,magnificationFilter:xe.a.NEAREST})})}(e,t,a,i,r),function(e,t){e._globeColorFramebuffer=new Ln.a({context:t,colorTextures:[e._globeColorTexture],depthStencilTexture:e._depthStencilTexture,destroyAttachments:!1}),e._copyDepthFramebuffer=new Ln.a({context:t,colorTextures:[e._globeDepthTexture],destroyAttachments:!1})}(e,t)),(l||n!==e._clearGlobeDepth)&&(Sd(e),n&&function(e,t,a,i,r){var n=r?t.halfFloatingPointTexture?we.a.HALF_FLOAT:we.a.FLOAT:we.a.UNSIGNED_BYTE;e._primitiveColorTexture=new S.a({context:t,width:a,height:i,pixelFormat:_e.a.RGBA,pixelDatatype:n,sampler:new Oe.a({wrapS:Te.a.CLAMP_TO_EDGE,wrapT:Te.a.CLAMP_TO_EDGE,minificationFilter:Ce.a.NEAREST,magnificationFilter:xe.a.NEAREST})}),e._primitiveColorFramebuffer=new Ln.a({context:t,colorTextures:[e._primitiveColorTexture],depthStencilTexture:e._depthStencilTexture,destroyAttachments:!1})}(e,t,a,i,r))}function Dd(e,t,a,i,r){e._viewport.width=a,e._viewport.height=i;var n=!nn.default.equals(e._viewport,r.viewport),s=n!==e._useScissorTest;e._useScissorTest=n,nn.default.equals(e._scissorRectangle,r.viewport)||(e._scissorRectangle=nn.default.clone(r.viewport,e._scissorRectangle),s=!0),Object(o.default)(e._rs)&&nn.default.equals(e._viewport,e._rs.viewport)&&!s||(e._rs=fe.a.fromCache({viewport:e._viewport,scissorTest:{enabled:e._useScissorTest,rectangle:e._scissorRectangle}}),e._rsBlend=fe.a.fromCache({viewport:e._viewport,scissorTest:{enabled:e._useScissorTest,rectangle:e._scissorRectangle},blending:he.a.ALPHA_BLEND}),e._rsUpdate=fe.a.fromCache({viewport:e._viewport,scissorTest:{enabled:e._useScissorTest,rectangle:e._scissorRectangle},stencilTest:{enabled:!0,frontFunction:Od.a.EQUAL,frontOperation:{fail:xd.a.KEEP,zFail:xd.a.KEEP,zPass:xd.a.KEEP},backFunction:Od.a.NEVER,reference:wd.a.CESIUM_3D_TILE_MASK,mask:wd.a.CESIUM_3D_TILE_MASK}})),Object(o.default)(e._copyDepthCommand)||(e._copyDepthCommand=t.createViewportQuadCommand(bd,{uniformMap:{u_depthTexture:function(){return e._depthStencilTexture}},owner:e})),e._copyDepthCommand.framebuffer=e._copyDepthFramebuffer,e._copyDepthCommand.renderState=e._rs,Object(o.default)(e._copyColorCommand)||(e._copyColorCommand=t.createViewportQuadCommand(yd,{uniformMap:{colorTexture:function(){return e._globeColorTexture}},owner:e})),e._copyColorCommand.renderState=e._rs,Object(o.default)(e._tempCopyDepthCommand)||(e._tempCopyDepthCommand=t.createViewportQuadCommand(bd,{uniformMap:{u_depthTexture:function(){return e._tempCopyDepthTexture}},owner:e})),e._tempCopyDepthCommand.framebuffer=e._tempCopyDepthFramebuffer,e._tempCopyDepthCommand.renderState=e._rs,Object(o.default)(e._updateDepthCommand)||(e._updateDepthCommand=t.createViewportQuadCommand(yd,{uniformMap:{colorTexture:function(){return e._tempGlobeDepthTexture}},owner:e})),e._updateDepthCommand.framebuffer=e._updateDepthFramebuffer,e._updateDepthCommand.renderState=e._rsUpdate,Object(o.default)(e._clearGlobeColorCommand)||(e._clearGlobeColorCommand=new Rn.a({color:new G.default(0,0,0,0),stencil:0,owner:e})),e._clearGlobeColorCommand.framebuffer=e._globeColorFramebuffer,Object(o.default)(e._clearPrimitiveColorCommand)||(e._clearPrimitiveColorCommand=new Rn.a({color:new G.default(0,0,0,0),stencil:0,owner:e})),e._clearPrimitiveColorCommand.framebuffer=e._primitiveColorFramebuffer,Object(o.default)(e._mergeColorCommand)||(e._mergeColorCommand=t.createViewportQuadCommand(yd,{uniformMap:{colorTexture:function(){return e._primitiveColorTexture}},owner:e})),e._mergeColorCommand.framebuffer=e._globeColorFramebuffer,e._mergeColorCommand.renderState=e._rsBlend}Object(s.default)(Cd.prototype,{framebuffer:{get:function(){return this._globeColorFramebuffer}},primitiveFramebuffer:{get:function(){return this._primitiveColorFramebuffer}}}),Cd.prototype.executeDebugGlobeDepth=function(e,t,a){!function(e,t,a,i){if(!Object(o.default)(e._debugGlobeDepthViewportCommand)||i!==e._useLogDepth){var r=new A.a({defines:[i?"LOG_DEPTH":""],sources:["uniform sampler2D u_depthTexture;\nvarying vec2 v_textureCoordinates;\nvoid main()\n{\n    float z_window = czm_unpackDepth(texture2D(u_depthTexture, v_textureCoordinates));\n    z_window = czm_reverseLogDepth(z_window); \n    float n_range = czm_depthRange.near;\n    float f_range = czm_depthRange.far;\n    float z_ndc = (2.0 * z_window - n_range - f_range) / (f_range - n_range);\n    float scale = pow(z_ndc * 0.5 + 0.5, 8.0);\n    gl_FragColor = vec4(mix(vec3(0.0), vec3(1.0), scale), 1.0);\n}\n"]});e._debugGlobeDepthViewportCommand=t.createViewportQuadCommand(r,{uniformMap:{u_depthTexture:function(){return e._globeDepthTexture}},owner:e}),e._useLogDepth=i}e._debugGlobeDepthViewportCommand.execute(t,a)}(this,e,t,a)},Cd.prototype.update=function(e,t,a,i,r){var n=a.width,o=a.height;Pd(this,e,n,o,i,r),Dd(this,e,n,o,t),e.uniformState.globeDepthTexture=void 0,this._useHdr=i,this._clearGlobeDepth=r},Cd.prototype.executeCopyDepth=function(e,t){Object(o.default)(this._copyDepthCommand)&&(this._copyDepthCommand.execute(e,t),e.uniformState.globeDepthTexture=this._globeDepthTexture)},Cd.prototype.executeUpdateDepth=function(e,t,a){var i=t.framebuffer.depthStencilTexture;if(a||i!==this._depthStencilTexture){if(Object(o.default)(this._updateDepthCommand)){if(!Object(o.default)(this._updateDepthFramebuffer)||this._updateDepthFramebuffer.depthStencilTexture!==i||this._updateDepthFramebuffer.getColorTexture(0)!==this._globeDepthTexture){var r=this._globeDepthTexture.width,n=this._globeDepthTexture.height;Ad(this),function(e,t,a,i,r){e._tempGlobeDepthTexture=new S.a({context:t,width:a,height:i,pixelFormat:_e.a.RGBA,pixelDatatype:we.a.UNSIGNED_BYTE,sampler:new Oe.a({wrapS:Te.a.CLAMP_TO_EDGE,wrapT:Te.a.CLAMP_TO_EDGE,minificationFilter:Ce.a.NEAREST,magnificationFilter:xe.a.NEAREST})}),e._tempCopyDepthFramebuffer=new Ln.a({context:t,colorTextures:[e._tempGlobeDepthTexture],destroyAttachments:!1}),e._updateDepthFramebuffer=new Ln.a({context:t,colorTextures:[e._globeDepthTexture],depthStencilTexture:r.framebuffer.depthStencilTexture,destroyAttachments:!1})}(this,e,r,n,t),Dd(this,e,r,n,t)}this._tempCopyDepthTexture=i,this._tempCopyDepthCommand.execute(e,t),this._updateDepthCommand.execute(e,t)}}else Object(o.default)(this._copyDepthCommand)&&this._copyDepthCommand.execute(e,t)},Cd.prototype.executeCopyColor=function(e,t){Object(o.default)(this._copyColorCommand)&&this._copyColorCommand.execute(e,t)},Cd.prototype.executeMergeColor=function(e,t){Object(o.default)(this._mergeColorCommand)&&this._mergeColorCommand.execute(e,t)},Cd.prototype.clear=function(e,t,a){var i=this._clearGlobeColorCommand;Object(o.default)(i)&&(G.default.clone(a,i.color),i.execute(e,t)),i=this._clearPrimitiveColorCommand,Object(o.default)(i)&&Object(o.default)(this._primitiveColorFramebuffer)&&i.execute(e,t)},Cd.prototype.isDestroyed=function(){return!1},Cd.prototype.destroy=function(){return Td(this),Ed(this),Sd(this),Ad(this),Object(o.default)(this._copyColorCommand)&&(this._copyColorCommand.shaderProgram=this._copyColorCommand.shaderProgram.destroy()),Object(o.default)(this._copyDepthCommand)&&(this._copyDepthCommand.shaderProgram=this._copyDepthCommand.shaderProgram.destroy()),Object(o.default)(this._tempCopyDepthCommand)&&(this._tempCopyDepthCommand.shaderProgram=this._tempCopyDepthCommand.shaderProgram.destroy()),Object(o.default)(this._updateDepthCommand)&&(this._updateDepthCommand.shaderProgram=this._updateDepthCommand.shaderProgram.destroy()),Object(o.default)(this._mergeColorCommand)&&(this._mergeColorCommand.shaderProgram=this._mergeColorCommand.shaderProgram.destroy()),Object(o.default)(this._debugGlobeDepthViewportCommand)&&(this._debugGlobeDepthViewportCommand.shaderProgram=this._debugGlobeDepthViewportCommand.shaderProgram.destroy()),Object(l.default)(this)};var Id=Cd;function Md(){this.previousFramebuffer=void 0,this._previousFramebuffer=void 0,this._texture=void 0,this._classifiedTexture=void 0,this._depthStencilTexture=void 0,this._fbo=void 0,this._fboClassified=void 0,this._rsUnclassified=void 0,this._rsClassified=void 0,this._unclassifiedCommand=void 0,this._classifiedCommand=void 0,this._translucentCommand=void 0,this._clearColorCommand=new Rn.a({color:new G.default(0,0,0,0),owner:this}),this._clearCommand=new Rn.a({color:new G.default(0,0,0,0),depth:1,stencil:0});var e=this;this._uniformMap={colorTexture:function(){return e._texture},depthTexture:function(){return e._depthStencilTexture},classifiedTexture:function(){return e._classifiedTexture}}}Object(s.default)(Md.prototype,{unclassifiedCommand:{get:function(){return this._unclassifiedCommand}}}),Md.isTranslucencySupported=function(e){return e.depthTexture&&e.fragmentDepth};var Fd={depthMask:!1,stencilTest:{enabled:!0,frontFunction:Od.a.EQUAL,frontOperation:{fail:xd.a.KEEP,zFail:xd.a.KEEP,zPass:xd.a.KEEP},backFunction:Od.a.NEVER,reference:0,mask:wd.a.CLASSIFICATION_MASK},blending:he.a.ALPHA_BLEND},Rd={depthMask:!1,stencilTest:{enabled:!0,frontFunction:Od.a.NOT_EQUAL,frontOperation:{fail:xd.a.KEEP,zFail:xd.a.KEEP,zPass:xd.a.KEEP},backFunction:Od.a.NEVER,reference:0,mask:wd.a.CLASSIFICATION_MASK},blending:he.a.ALPHA_BLEND},Nd={depthMask:!0,depthTest:{enabled:!0},stencilTest:wd.a.setCesium3DTileBit(),stencilMask:wd.a.CESIUM_3D_TILE_MASK,blending:he.a.ALPHA_BLEND};Md.prototype.update=function(e){var t=this._texture,a=!Object(o.default)(t)||this.previousFramebuffer!==this._previousFramebuffer;this._previousFramebuffer=this.previousFramebuffer;var i,r,n=e.drawingBufferWidth,s=e.drawingBufferHeight,l=!Object(o.default)(t)||t.width!==n||t.height!==s;((l||a)&&(this._texture=this._texture&&this._texture.destroy(),this._classifiedTexture=this._classifiedTexture&&this._classifiedTexture.destroy(),this._depthStencilTexture=this._depthStencilTexture&&this._depthStencilTexture.destroy(),this._texture=new S.a({context:e,width:n,height:s,pixelFormat:_e.a.RGBA,pixelDatatype:we.a.UNSIGNED_BYTE,sampler:new Oe.a({wrapS:Te.a.CLAMP_TO_EDGE,wrapT:Te.a.CLAMP_TO_EDGE,minificationFilter:Ce.a.LINEAR,magnificationFilter:xe.a.LINEAR})}),Object(o.default)(this._previousFramebuffer)||(this._classifiedTexture=new S.a({context:e,width:n,height:s,pixelFormat:_e.a.RGBA,pixelDatatype:we.a.UNSIGNED_BYTE,sampler:new Oe.a({wrapS:Te.a.CLAMP_TO_EDGE,wrapT:Te.a.CLAMP_TO_EDGE,minificationFilter:Ce.a.LINEAR,magnificationFilter:xe.a.LINEAR})}),this._depthStencilTexture=new S.a({context:e,width:n,height:s,pixelFormat:_e.a.DEPTH_STENCIL,pixelDatatype:we.a.UNSIGNED_INT_24_8}))),!Object(o.default)(this._fbo)||l||a)&&(this._fbo=this._fbo&&this._fbo.destroy(),this._fboClassified=this._fboClassified&&this._fboClassified.destroy(),Object(o.default)(this._previousFramebuffer)?(i=this._previousFramebuffer.depthStencilTexture,r=this._previousFramebuffer.depthStencilRenderbuffer):i=this._depthStencilTexture,this._fbo=new Ln.a({context:e,colorTextures:[this._texture],depthStencilTexture:i,depthStencilRenderbuffer:r,destroyAttachments:!1}),Object(o.default)(this._previousFramebuffer)||(this._fboClassified=new Ln.a({context:e,colorTextures:[this._classifiedTexture],depthStencilTexture:i,destroyAttachments:!1})));if(Object(o.default)(this._rsUnclassified)||(this._rsUnclassified=fe.a.fromCache(Fd),this._rsClassified=fe.a.fromCache(Rd),this._rsDefault=fe.a.fromCache(Nd)),!Object(o.default)(this._unclassifiedCommand)||a){Object(o.default)(this._unclassifiedCommand)&&(this._unclassifiedCommand.shaderProgram=this._unclassifiedCommand.shaderProgram&&this._unclassifiedCommand.shaderProgram.destroy(),this._classifiedCommand.shaderProgram=this._classifiedCommand.shaderProgram&&this._classifiedCommand.shaderProgram.destroy());var u=Object(o.default)(this._previousFramebuffer)?"uniform sampler2D colorTexture;\nvarying vec2 v_textureCoordinates;\nvoid main()\n{\n    vec4 color = texture2D(colorTexture, v_textureCoordinates);\n    if (color.a == 0.0)\n    {\n        discard;\n    }\n#ifdef UNCLASSIFIED\n    gl_FragColor = color * czm_invertClassificationColor;\n#else\n    gl_FragColor = color;\n#endif\n}\n":"#extension GL_EXT_frag_depth : enable\nuniform sampler2D colorTexture;\nuniform sampler2D depthTexture;\nuniform sampler2D classifiedTexture;\nvarying vec2 v_textureCoordinates;\nvoid main()\n{\n    vec4 color = texture2D(colorTexture, v_textureCoordinates);\n    if (color.a == 0.0)\n    {\n        discard;\n    }\n    bool isClassified = all(equal(texture2D(classifiedTexture, v_textureCoordinates), vec4(0.0)));\n#ifdef UNCLASSIFIED\n    vec4 highlightColor = czm_invertClassificationColor;\n    if (isClassified)\n    {\n        discard;\n    }\n#else\n    vec4 highlightColor = vec4(1.0);\n    if (!isClassified)\n    {\n        discard;\n    }\n#endif\n    gl_FragColor = color * highlightColor;\n    gl_FragDepthEXT = texture2D(depthTexture, v_textureCoordinates).r;\n}\n",d=new A.a({defines:["UNCLASSIFIED"],sources:[u]}),f=new A.a({sources:[u]});this._unclassifiedCommand=e.createViewportQuadCommand(d,{renderState:Object(o.default)(this._previousFramebuffer)?this._rsUnclassified:this._rsDefault,uniformMap:this._uniformMap,owner:this}),this._classifiedCommand=e.createViewportQuadCommand(f,{renderState:Object(o.default)(this._previousFramebuffer)?this._rsClassified:this._rsDefault,uniformMap:this._uniformMap,owner:this}),Object(o.default)(this._translucentCommand)&&(this._translucentCommand.shaderProgram=this._translucentCommand.shaderProgram&&this._translucentCommand.shaderProgram.destroy()),Object(o.default)(this._previousFramebuffer)||(this._translucentCommand=e.createViewportQuadCommand(yd,{renderState:this._rsUnclassified,uniformMap:this._uniformMap,owner:this}))}},Md.prototype.clear=function(e,t){var a=t.framebuffer;Object(o.default)(this._previousFramebuffer)?(t.framebuffer=this._fbo,this._clearColorCommand.execute(e,t)):(t.framebuffer=this._fbo,this._clearCommand.execute(e,t),t.framebuffer=this._fboClassified,this._clearCommand.execute(e,t)),t.framebuffer=a},Md.prototype.executeClassified=function(e,t){if(!Object(o.default)(this._previousFramebuffer)){var a=t.framebuffer;t.framebuffer=this._fboClassified,this._translucentCommand.execute(e,t),t.framebuffer=a}this._classifiedCommand.execute(e,t)},Md.prototype.executeUnclassified=function(e,t){this._unclassifiedCommand.execute(e,t)},Md.prototype.isDestroyed=function(){return!1},Md.prototype.destroy=function(){return this._fbo=this._fbo&&this._fbo.destroy(),this._texture=this._texture&&this._texture.destroy(),this._depthStencilTexture=this._depthStencilTexture&&this._depthStencilTexture.destroy(),Object(o.default)(this._unclassifiedCommand)&&(this._unclassifiedCommand.shaderProgram=this._unclassifiedCommand.shaderProgram&&this._unclassifiedCommand.shaderProgram.destroy(),this._classifiedCommand.shaderProgram=this._classifiedCommand.shaderProgram&&this._classifiedCommand.shaderProgram.destroy()),Object(l.default)(this)};var Ld=Md,jd=a(631);function Vd(e){this._total=e,this.usedThisFrame=0,this.stolenFromMeThisFrame=0,this.starvedThisFrame=!1,this.starvedLastFrame=!1}function Ud(e){var t=new Array(jd.a.NUMBER_OF_JOB_TYPES);t[jd.a.TEXTURE]=new Vd(Object(o.default)(e)?e[jd.a.TEXTURE]:10),t[jd.a.PROGRAM]=new Vd(Object(o.default)(e)?e[jd.a.PROGRAM]:10),t[jd.a.BUFFER]=new Vd(Object(o.default)(e)?e[jd.a.BUFFER]:30);var a,i=t.length,r=0;for(a=0;a<i;++a)r+=t[a].total;var n=new Array(i);for(a=0;a<i;++a)n[a]=!1;this._totalBudget=r,this._totalUsedThisFrame=0,this._budgets=t,this._executedThisFrame=n}Object(s.default)(Vd.prototype,{total:{get:function(){return this._total}}}),Ud.getTimestamp=ca.default,Object(s.default)(Ud.prototype,{totalBudget:{get:function(){return this._totalBudget}}}),Ud.prototype.disableThisFrame=function(){this._totalUsedThisFrame=this._totalBudget},Ud.prototype.resetBudgets=function(){for(var e=this._budgets,t=e.length,a=0;a<t;++a){var i=e[a];i.starvedLastFrame=i.starvedThisFrame,i.starvedThisFrame=!1,i.usedThisFrame=0,i.stolenFromMeThisFrame=0}this._totalUsedThisFrame=0},Ud.prototype.execute=function(e,t){var a,i=this._budgets,r=i[t],n=this._executedThisFrame[t];if(this._totalUsedThisFrame>=this._totalBudget&&n)return r.starvedThisFrame=!0,!1;if(r.usedThisFrame+r.stolenFromMeThisFrame>=r.total){var o,s=i.length;for(o=0;o<s&&(!((a=i[o]).usedThisFrame+a.stolenFromMeThisFrame<a.total)||a.starvedLastFrame);++o);if(o===s&&n)return!1;n&&(r.starvedThisFrame=!0)}var l=Ud.getTimestamp();e.execute();var u=Ud.getTimestamp()-l;return this._totalUsedThisFrame+=u,a?a.stolenFromMeThisFrame+=u:r.usedThisFrame+=u,this._executedThisFrame[t]=!0,!0};var zd=Ud,Bd=a(759),Hd=a(353);function kd(e){e=Object(n.default)(e,n.default.EMPTY_OBJECT);var t=Object(Hd.default)(e.container);this._container=t;var a=document.createElement("div");a.className="cesium-performanceDisplay";var i=document.createElement("div");i.className="cesium-performanceDisplay-fps",this._fpsText=document.createTextNode(""),i.appendChild(this._fpsText);var r=document.createElement("div");r.className="cesium-performanceDisplay-ms",this._msText=document.createTextNode(""),r.appendChild(this._msText),a.appendChild(r),a.appendChild(i),this._container.appendChild(a),this._lastFpsSampleTime=Object(ca.default)(),this._lastMsSampleTime=Object(ca.default)(),this._fpsFrameCount=0,this._msFrameCount=0,this._throttled=!1;var o=document.createElement("div");o.className="cesium-performanceDisplay-throttled",this._throttledText=document.createTextNode(""),o.appendChild(this._throttledText),a.appendChild(o)}Object(s.default)(kd.prototype,{throttled:{get:function(){return this._throttled},set:function(e){this._throttled!==e&&(this._throttledText.nodeValue=e?"(throttled)":"",this._throttled=e)}}}),kd.prototype.update=function(e){var t=Object(ca.default)(),a=Object(n.default)(e,!0);this._fpsFrameCount++;var i=t-this._lastFpsSampleTime;if(i>1e3){var r="N/A";a&&(r=1e3*this._fpsFrameCount/i|0),this._fpsText.nodeValue=r+" FPS",this._lastFpsSampleTime=t,this._fpsFrameCount=0}this._msFrameCount++;var o=t-this._lastMsSampleTime;if(o>200){var s="N/A";a&&(s=(o/this._msFrameCount).toFixed(2)),this._msText.nodeValue=s+" MS",this._lastMsSampleTime=t,this._msFrameCount=0}},kd.prototype.destroy=function(){return Object(l.default)(this)};var Gd=kd,Wd=a(152),Yd=a(94),Xd=a(235);function Qd(){this._framebuffer=void 0,this._depthTexture=void 0,this._textureToCopy=void 0,this._copyDepthCommand=void 0,this._useLogDepth=void 0,this._debugPickDepthViewportCommand=void 0}function qd(e){e._depthTexture=e._depthTexture&&!e._depthTexture.isDestroyed()&&e._depthTexture.destroy()}function Zd(e){e._framebuffer=e._framebuffer&&!e._framebuffer.isDestroyed()&&e._framebuffer.destroy()}function Kd(e,t,a,i){qd(e),Zd(e),function(e,t,a,i){e._depthTexture=new S.a({context:t,width:a,height:i,pixelFormat:_e.a.RGBA,pixelDatatype:we.a.UNSIGNED_BYTE})}(e,t,a,i),e._framebuffer=new Ln.a({context:t,colorTextures:[e._depthTexture],destroyAttachments:!1})}Qd.prototype.executeDebugPickDepth=function(e,t,a){!function(e,t,a,i){if(!Object(o.default)(e._debugPickDepthViewportCommand)||i!==e._useLogDepth){var r=new A.a({defines:[i?"LOG_DEPTH":""],sources:["uniform sampler2D u_texture;\nvarying vec2 v_textureCoordinates;\nvoid main()\n{\n    float z_window = czm_unpackDepth(texture2D(u_texture, v_textureCoordinates));\n    z_window = czm_reverseLogDepth(z_window); \n    float n_range = czm_depthRange.near;\n    float f_range = czm_depthRange.far;\n    float z_ndc = (2.0 * z_window - n_range - f_range) / (f_range - n_range);\n    float scale = pow(z_ndc * 0.5 + 0.5, 8.0);\n    gl_FragColor = vec4(mix(vec3(0.0), vec3(1.0), scale), 1.0);\n}\n"]});e._debugPickDepthViewportCommand=t.createViewportQuadCommand(r,{uniformMap:{u_texture:function(){return e._depthTexture}},owner:e}),e._useLogDepth=i}e._debugPickDepthViewportCommand.execute(t,a)}(this,e,t,a)},Qd.prototype.update=function(e,t){!function(e,t,a){var i=a.width,r=a.height,n=e._depthTexture,s=!Object(o.default)(n)||n.width!==i||n.height!==r;Object(o.default)(e._framebuffer)&&!s||Kd(e,t,i,r)}(this,e,t),function(e,t,a){if(!Object(o.default)(e._copyDepthCommand)){e._copyDepthCommand=t.createViewportQuadCommand("uniform sampler2D u_texture;\nvarying vec2 v_textureCoordinates;\nvoid main()\n{\n    gl_FragColor = czm_packDepth(texture2D(u_texture, v_textureCoordinates).r);\n}\n",{renderState:fe.a.fromCache(),uniformMap:{u_texture:function(){return e._textureToCopy}},owner:e})}e._textureToCopy=a,e._copyDepthCommand.framebuffer=e._framebuffer}(this,e,t)};var Jd=new H.a,$d=new H.a(1,1/255,1/65025,1/16581375);Qd.prototype.getDepth=function(e,t,a){var i=e.readPixels({x:t,y:a,width:1,height:1,framebuffer:this._framebuffer}),r=H.a.unpack(i,0,Jd);return H.a.divideByScalar(r,255,r),H.a.dot(r,$d)},Qd.prototype.executeCopyDepth=function(e,t){this._copyDepthCommand.execute(e,t)},Qd.prototype.isDestroyed=function(){return!1},Qd.prototype.destroy=function(){return qd(this),Zd(this),this._copyDepthCommand.shaderProgram=Object(o.default)(this._copyDepthCommand.shaderProgram)&&this._copyDepthCommand.shaderProgram.destroy(),Object(l.default)(this)};var ef=Qd,tf=a(364),af=a(184),rf=a(315);var nf=function(e,t){this.near=Object(n.default)(e,0),this.far=Object(n.default)(t,0);for(var a=de.a.NUMBER_OF_PASSES,i=new Array(a),r=new Array(a),o=0;o<a;++o)i[o]=[],r[o]=0;this.commands=i,this.indices=r},of="#ifdef MRT\n#extension GL_EXT_draw_buffers : enable\n#endif\n\nuniform vec4 u_bgColor;\nuniform sampler2D u_depthTexture;\n\nvarying vec2 v_textureCoordinates;\n\nvoid main()\n{\n    if (texture2D(u_depthTexture, v_textureCoordinates).r < 1.0)\n    {\n#ifdef MRT\n        gl_FragData[0] = u_bgColor;\n        gl_FragData[1] = vec4(u_bgColor.a);\n#else\n        gl_FragColor = u_bgColor;\n#endif\n        return;\n    }\n    \n    discard;\n}\n",sf=a(570),lf=a(571);function uf(e){this._translucentMultipassSupport=!1,this._translucentMRTSupport=!1;var t=e.colorBufferFloat&&e.depthTexture;this._translucentMRTSupport=e.drawBuffers&&t,this._translucentMultipassSupport=!this._translucentMRTSupport&&t,this._opaqueFBO=void 0,this._opaqueTexture=void 0,this._depthStencilTexture=void 0,this._accumulationTexture=void 0,this._translucentFBO=void 0,this._alphaFBO=void 0,this._adjustTranslucentFBO=void 0,this._adjustAlphaFBO=void 0,this._opaqueClearCommand=new Rn.a({color:new G.default(0,0,0,0),owner:this}),this._translucentMRTClearCommand=new Rn.a({color:new G.default(0,0,0,1),owner:this}),this._translucentMultipassClearCommand=new Rn.a({color:new G.default(0,0,0,0),owner:this}),this._alphaClearCommand=new Rn.a({color:new G.default(1,1,1,1),owner:this}),this._translucentRenderStateCache={},this._alphaRenderStateCache={},this._compositeCommand=void 0,this._adjustTranslucentCommand=void 0,this._adjustAlphaCommand=void 0,this._viewport=new nn.default,this._rs=void 0,this._useScissorTest=!1,this._scissorRectangle=void 0,this._useHDR=!1}function df(e){e._accumulationTexture=e._accumulationTexture&&!e._accumulationTexture.isDestroyed()&&e._accumulationTexture.destroy(),e._revealageTexture=e._revealageTexture&&!e._revealageTexture.isDestroyed()&&e._revealageTexture.destroy()}function ff(e){e._translucentFBO=e._translucentFBO&&!e._translucentFBO.isDestroyed()&&e._translucentFBO.destroy(),e._alphaFBO=e._alphaFBO&&!e._alphaFBO.isDestroyed()&&e._alphaFBO.destroy(),e._adjustTranslucentFBO=e._adjustTranslucentFBO&&!e._adjustTranslucentFBO.isDestroyed()&&e._adjustTranslucentFBO.destroy(),e._adjustAlphaFBO=e._adjustAlphaFBO&&!e._adjustAlphaFBO.isDestroyed()&&e._adjustAlphaFBO.destroy()}function cf(e){df(e),ff(e)}uf.prototype.update=function(e,t,a,i){if(this.isSupported()){this._opaqueFBO=a,this._opaqueTexture=a.getColorTexture(0),this._depthStencilTexture=a.depthStencilTexture;var r=this._opaqueTexture.width,n=this._opaqueTexture.height,s=this._accumulationTexture,l=!Object(o.default)(s)||s.width!==r||s.height!==n||i!==this._useHDR;if(l&&function(e,t,a,i){df(e),e._accumulationTexture=new S.a({context:t,width:a,height:i,pixelFormat:_e.a.RGBA,pixelDatatype:we.a.FLOAT});var r=new Float32Array(a*i*4);e._revealageTexture=new S.a({context:t,pixelFormat:_e.a.RGBA,pixelDatatype:we.a.FLOAT,source:{arrayBufferView:r,width:a,height:i},flipY:!1})}(this,e,r,n),Object(o.default)(this._translucentFBO)&&!l||function(e,t){ff(e);var a=Wn.a.FRAMEBUFFER_COMPLETE,i=!0;if(e._translucentMRTSupport&&(e._translucentFBO=new Ln.a({context:t,colorTextures:[e._accumulationTexture,e._revealageTexture],depthStencilTexture:e._depthStencilTexture,destroyAttachments:!1}),e._adjustTranslucentFBO=new Ln.a({context:t,colorTextures:[e._accumulationTexture,e._revealageTexture],destroyAttachments:!1}),e._translucentFBO.status===a&&e._adjustTranslucentFBO.status===a||(ff(e),e._translucentMRTSupport=!1)),!e._translucentMRTSupport){e._translucentFBO=new Ln.a({context:t,colorTextures:[e._accumulationTexture],depthStencilTexture:e._depthStencilTexture,destroyAttachments:!1}),e._alphaFBO=new Ln.a({context:t,colorTextures:[e._revealageTexture],depthStencilTexture:e._depthStencilTexture,destroyAttachments:!1}),e._adjustTranslucentFBO=new Ln.a({context:t,colorTextures:[e._accumulationTexture],destroyAttachments:!1}),e._adjustAlphaFBO=new Ln.a({context:t,colorTextures:[e._revealageTexture],destroyAttachments:!1});var r=e._translucentFBO.status===a,n=e._alphaFBO.status===a,o=e._adjustTranslucentFBO.status===a,s=e._adjustAlphaFBO.status===a;r&&n&&o&&s||(cf(e),e._translucentMultipassSupport=!1,i=!1)}return i}(this,e)){this._useHDR=i;var u,d,f=this;Object(o.default)(this._compositeCommand)||(u=new A.a({sources:["/**\n * Compositing for Weighted Blended Order-Independent Transparency. See:\n * - http://jcgt.org/published/0002/02/09/\n * - http://casual-effects.blogspot.com/2014/03/weighted-blended-order-independent.html\n */\n\nuniform sampler2D u_opaque;\nuniform sampler2D u_accumulation;\nuniform sampler2D u_revealage;\n\nvarying vec2 v_textureCoordinates;\n\nvoid main()\n{\n    vec4 opaque = texture2D(u_opaque, v_textureCoordinates);\n    vec4 accum = texture2D(u_accumulation, v_textureCoordinates);\n    float r = texture2D(u_revealage, v_textureCoordinates).r;\n\n#ifdef MRT\n    vec4 transparent = vec4(accum.rgb / clamp(r, 1e-4, 5e4), accum.a);\n#else\n    vec4 transparent = vec4(accum.rgb / clamp(accum.a, 1e-4, 5e4), r);\n#endif\n\n    gl_FragColor = (1.0 - transparent.a) * transparent + transparent.a * opaque;\n\n    if (opaque != czm_backgroundColor)\n    {\n        gl_FragColor.a = 1.0;\n    }\n}\n"]}),this._translucentMRTSupport&&u.defines.push("MRT"),d={u_opaque:function(){return f._opaqueTexture},u_accumulation:function(){return f._accumulationTexture},u_revealage:function(){return f._revealageTexture}},this._compositeCommand=e.createViewportQuadCommand(u,{uniformMap:d,owner:this})),Object(o.default)(this._adjustTranslucentCommand)||(this._translucentMRTSupport?(u=new A.a({defines:["MRT"],sources:[of]}),d={u_bgColor:function(){return f._translucentMRTClearCommand.color},u_depthTexture:function(){return f._depthStencilTexture}},this._adjustTranslucentCommand=e.createViewportQuadCommand(u,{uniformMap:d,owner:this})):this._translucentMultipassSupport&&(u=new A.a({sources:[of]}),d={u_bgColor:function(){return f._translucentMultipassClearCommand.color},u_depthTexture:function(){return f._depthStencilTexture}},this._adjustTranslucentCommand=e.createViewportQuadCommand(u,{uniformMap:d,owner:this}),d={u_bgColor:function(){return f._alphaClearCommand.color},u_depthTexture:function(){return f._depthStencilTexture}},this._adjustAlphaCommand=e.createViewportQuadCommand(u,{uniformMap:d,owner:this}))),this._viewport.width=r,this._viewport.height=n;var c=!nn.default.equals(this._viewport,t.viewport),h=c!==this._useScissorTest;this._useScissorTest=c,nn.default.equals(this._scissorRectangle,t.viewport)||(this._scissorRectangle=nn.default.clone(t.viewport,this._scissorRectangle),h=!0),Object(o.default)(this._rs)&&nn.default.equals(this._viewport,this._rs.viewport)&&!h||(this._rs=fe.a.fromCache({viewport:this._viewport,scissorTest:{enabled:this._useScissorTest,rectangle:this._scissorRectangle}})),Object(o.default)(this._compositeCommand)&&(this._compositeCommand.renderState=this._rs),this._adjustTranslucentCommand&&(this._adjustTranslucentCommand.renderState=this._rs),Object(o.default)(this._adjustAlphaCommand)&&(this._adjustAlphaCommand.renderState=this._rs)}}};var hf={enabled:!0,color:new G.default(0,0,0,0),equationRgb:sf.a.ADD,equationAlpha:sf.a.ADD,functionSourceRgb:lf.a.ONE,functionDestinationRgb:lf.a.ONE,functionSourceAlpha:lf.a.ZERO,functionDestinationAlpha:lf.a.ONE_MINUS_SOURCE_ALPHA},mf={enabled:!0,color:new G.default(0,0,0,0),equationRgb:sf.a.ADD,equationAlpha:sf.a.ADD,functionSourceRgb:lf.a.ONE,functionDestinationRgb:lf.a.ONE,functionSourceAlpha:lf.a.ONE,functionDestinationAlpha:lf.a.ONE},pf={enabled:!0,color:new G.default(0,0,0,0),equationRgb:sf.a.ADD,equationAlpha:sf.a.ADD,functionSourceRgb:lf.a.ZERO,functionDestinationRgb:lf.a.ONE_MINUS_SOURCE_ALPHA,functionSourceAlpha:lf.a.ZERO,functionDestinationAlpha:lf.a.ONE_MINUS_SOURCE_ALPHA};function _f(e,t,a,i){var r=a[i.id];if(!Object(o.default)(r)){var n=fe.a.getState(i);n.depthMask=!1,n.blending=t,r=fe.a.fromCache(n),a[i.id]=r}return r}var gf="    vec3 Ci = czm_gl_FragColor.rgb * czm_gl_FragColor.a;\n    float ai = czm_gl_FragColor.a;\n    float wzi = czm_alphaWeight(ai);\n    gl_FragData[0] = vec4(Ci * wzi, ai);\n    gl_FragData[1] = vec4(ai * wzi);\n",vf="    vec3 Ci = czm_gl_FragColor.rgb * czm_gl_FragColor.a;\n    float ai = czm_gl_FragColor.a;\n    float wzi = czm_alphaWeight(ai);\n    gl_FragColor = vec4(Ci, ai) * wzi;\n",yf="    float ai = czm_gl_FragColor.a;\n    gl_FragColor = vec4(ai);\n";function bf(e,t,a,i){var r=e.shaderCache.getDerivedShaderProgram(t,a);if(!Object(o.default)(r)){var n=t._attributeLocations,s=t.fragmentShaderSource.clone();s.sources=s.sources.map((function(e){return e=(e=(e=(e=A.a.replaceMain(e,"czm_translucent_main")).replace(/gl_FragColor/g,"czm_gl_FragColor")).replace(/\bdiscard\b/g,"czm_discard = true")).replace(/czm_phong/g,"czm_translucentPhong")})),s.sources.splice(0,0,(-1!==i.indexOf("gl_FragData")?"#extension GL_EXT_draw_buffers : enable \n":"")+"vec4 czm_gl_FragColor;\nbool czm_discard = false;\n"),s.sources.push("void main()\n{\n    czm_translucent_main();\n    if (czm_discard)\n    {\n        discard;\n    }\n"+i+"}\n"),r=e.shaderCache.createDerivedShaderProgram(t,a,{vertexShaderSource:t.vertexShaderSource,fragmentShaderSource:s,attributeLocations:n})}return r}uf.prototype.createDerivedCommands=function(e,t,a){var i,r,n,s,l,u,d,f;(Object(o.default)(a)||(a={}),this._translucentMRTSupport)?(Object(o.default)(a.translucentCommand)&&(i=a.translucentCommand.shaderProgram,r=a.translucentCommand.renderState),a.translucentCommand=ue.a.shallowClone(e,a.translucentCommand),Object(o.default)(i)&&a.shaderProgramId===e.shaderProgram.id?(a.translucentCommand.shaderProgram=i,a.translucentCommand.renderState=r):(a.translucentCommand.shaderProgram=function(e,t){return bf(e,t,"translucentMRT",gf)}(t,e.shaderProgram),a.translucentCommand.renderState=(d=this,f=e.renderState,_f(0,hf,d._translucentRenderStateCache,f)),a.shaderProgramId=e.shaderProgram.id)):(Object(o.default)(a.translucentCommand)&&(n=a.translucentCommand.shaderProgram,s=a.translucentCommand.renderState,l=a.alphaCommand.shaderProgram,u=a.alphaCommand.renderState),a.translucentCommand=ue.a.shallowClone(e,a.translucentCommand),a.alphaCommand=ue.a.shallowClone(e,a.alphaCommand),Object(o.default)(n)&&a.shaderProgramId===e.shaderProgram.id?(a.translucentCommand.shaderProgram=n,a.translucentCommand.renderState=s,a.alphaCommand.shaderProgram=l,a.alphaCommand.renderState=u):(a.translucentCommand.shaderProgram=function(e,t){return bf(e,t,"translucentMultipass",vf)}(t,e.shaderProgram),a.translucentCommand.renderState=function(e,t,a){return _f(0,mf,e._translucentRenderStateCache,a)}(this,0,e.renderState),a.alphaCommand.shaderProgram=function(e,t){return bf(e,t,"alphaMultipass",yf)}(t,e.shaderProgram),a.alphaCommand.renderState=function(e,t,a){return _f(0,pf,e._alphaRenderStateCache,a)}(this,0,e.renderState),a.shaderProgramId=e.shaderProgram.id));return a},uf.prototype.executeCommands=function(e,t,a,i,r){this._translucentMRTSupport?function(e,t,a,i,r,n){var s=t.context,l=t.frameState.useLogDepth,u=t._hdr,d=i.framebuffer,f=r.length,c=t.frameState.shadowState.lightShadowsEnabled;i.framebuffer=e._adjustTranslucentFBO,e._adjustTranslucentCommand.execute(s,i);var h,m=e._opaqueFBO;i.framebuffer=e._translucentFBO;for(var p=0;p<f;++p)h=r[p],h=l?h.derivedCommands.logDepth.command:h,h=u?h.derivedCommands.hdr.command:h,a(c&&h.receiveShadows?h.derivedCommands.oit.shadows.translucentCommand:h.derivedCommands.oit.translucentCommand,t,s,i,m);Object(o.default)(n)&&(h=n.unclassifiedCommand,a(c&&h.receiveShadows?h.derivedCommands.oit.shadows.translucentCommand:h.derivedCommands.oit.translucentCommand,t,s,i,m)),i.framebuffer=d}(this,e,t,a,i,r):function(e,t,a,i,r,n){var s,l,u=t.context,d=t.frameState.useLogDepth,f=t._hdr,c=i.framebuffer,h=r.length,m=t.frameState.shadowState.lightShadowsEnabled;i.framebuffer=e._adjustTranslucentFBO,e._adjustTranslucentCommand.execute(u,i),i.framebuffer=e._adjustAlphaFBO,e._adjustAlphaCommand.execute(u,i);var p=e._opaqueFBO;for(i.framebuffer=e._translucentFBO,l=0;l<h;++l)s=r[l],s=d?s.derivedCommands.logDepth.command:s,s=f?s.derivedCommands.hdr.command:s,a(m&&s.receiveShadows?s.derivedCommands.oit.shadows.translucentCommand:s.derivedCommands.oit.translucentCommand,t,u,i,p);for(Object(o.default)(n)&&(s=n.unclassifiedCommand,a(m&&s.receiveShadows?s.derivedCommands.oit.shadows.translucentCommand:s.derivedCommands.oit.translucentCommand,t,u,i,p)),i.framebuffer=e._alphaFBO,l=0;l<h;++l)s=r[l],s=d?s.derivedCommands.logDepth.command:s,s=f?s.derivedCommands.hdr.command:s,a(m&&s.receiveShadows?s.derivedCommands.oit.shadows.alphaCommand:s.derivedCommands.oit.alphaCommand,t,u,i,p);Object(o.default)(n)&&(s=n.unclassifiedCommand,a(m&&s.receiveShadows?s.derivedCommands.oit.shadows.alphaCommand:s.derivedCommands.oit.alphaCommand,t,u,i,p)),i.framebuffer=c}(this,e,t,a,i,r)},uf.prototype.execute=function(e,t){this._compositeCommand.execute(e,t)},uf.prototype.clear=function(e,t,a){var i=t.framebuffer;t.framebuffer=this._opaqueFBO,G.default.clone(a,this._opaqueClearCommand.color),this._opaqueClearCommand.execute(e,t),t.framebuffer=this._translucentFBO,(this._translucentMRTSupport?this._translucentMRTClearCommand:this._translucentMultipassClearCommand).execute(e,t),this._translucentMultipassSupport&&(t.framebuffer=this._alphaFBO,this._alphaClearCommand.execute(e,t)),t.framebuffer=i},uf.prototype.isSupported=function(){return this._translucentMRTSupport||this._translucentMultipassSupport},uf.prototype.isDestroyed=function(){return!1},uf.prototype.destroy=function(){return cf(this),Object(o.default)(this._compositeCommand)&&(this._compositeCommand.shaderProgram=this._compositeCommand.shaderProgram&&this._compositeCommand.shaderProgram.destroy()),Object(o.default)(this._adjustTranslucentCommand)&&(this._adjustTranslucentCommand.shaderProgram=this._adjustTranslucentCommand.shaderProgram&&this._adjustTranslucentCommand.shaderProgram.destroy()),Object(o.default)(this._adjustAlphaCommand)&&(this._adjustAlphaCommand.shaderProgram=this._adjustAlphaCommand.shaderProgram&&this._adjustAlphaCommand.shaderProgram.destroy()),Object(l.default)(this)};var wf=uf;function Of(){this._depthStencilTexture=void 0,this._framebuffer=void 0,this._passState=void 0}function xf(e){e._framebuffer=e._framebuffer&&e._framebuffer.destroy(),e._depthStencilTexture=e._depthStencilTexture&&e._depthStencilTexture.destroy()}Of.prototype.update=function(e,t,a){var i=a.width,r=a.height;Object(o.default)(this._framebuffer)&&i===this._depthStencilTexture.width&&r===this._depthStencilTexture.height||(xf(this),function(e,t){var a=t.drawingBufferWidth,i=t.drawingBufferHeight;e._depthStencilTexture=new S.a({context:t,width:a,height:i,pixelFormat:_e.a.DEPTH_STENCIL,pixelDatatype:we.a.UNSIGNED_INT_24_8}),e._framebuffer=new Ln.a({context:t,depthStencilTexture:e._depthStencilTexture,destroyAttachments:!1});var r=new Kn(t);r.blendingEnabled=!1,r.scissorTest={enabled:!0,rectangle:new nn.default},r.viewport=new nn.default,e._passState=r}(this,e));var n=this._framebuffer,s=this._passState;return s.framebuffer=n,s.viewport.width=i,s.viewport.height=r,s.scissorTest.rectangle.x=t.x,s.scissorTest.rectangle.y=r-t.y,s.scissorTest.rectangle.width=1,s.scissorTest.rectangle.height=1,s},Of.prototype.isDestroyed=function(){return!1},Of.prototype.destroy=function(){return xf(this),Object(l.default)(this)};var Cf=Of,Tf={RGBA4:Wn.a.RGBA4,RGB5_A1:Wn.a.RGB5_A1,RGB565:Wn.a.RGB565,DEPTH_COMPONENT16:Wn.a.DEPTH_COMPONENT16,STENCIL_INDEX8:Wn.a.STENCIL_INDEX8,DEPTH_STENCIL:Wn.a.DEPTH_STENCIL,validate:function(e){return e===Tf.RGBA4||e===Tf.RGB5_A1||e===Tf.RGB565||e===Tf.DEPTH_COMPONENT16||e===Tf.STENCIL_INDEX8||e===Tf.DEPTH_STENCIL}},Ef=Object(ie.default)(Tf);function Af(e){var t=(e=Object(n.default)(e,n.default.EMPTY_OBJECT)).context._gl,a=(le.a.maximumRenderbufferSize,Object(n.default)(e.format,Ef.RGBA4)),i=Object(o.default)(e.width)?e.width:t.drawingBufferWidth,r=Object(o.default)(e.height)?e.height:t.drawingBufferHeight;this._gl=t,this._format=a,this._width=i,this._height=r,this._renderbuffer=this._gl.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,this._renderbuffer),t.renderbufferStorage(t.RENDERBUFFER,a,i,r),t.bindRenderbuffer(t.RENDERBUFFER,null)}Object(s.default)(Af.prototype,{format:{get:function(){return this._format}},width:{get:function(){return this._width}},height:{get:function(){return this._height}}}),Af.prototype._getRenderbuffer=function(){return this._renderbuffer},Af.prototype.isDestroyed=function(){return!1},Af.prototype.destroy=function(){return this._gl.deleteRenderbuffer(this._renderbuffer),Object(l.default)(this)};var Sf=Af;function Pf(e){var t=new Kn(e);t.blendingEnabled=!1,t.scissorTest={enabled:!0,rectangle:new nn.default},t.viewport=new nn.default,this._context=e,this._fb=void 0,this._passState=t,this._width=0,this._height=0}Pf.prototype.begin=function(e,t){var a=this._context,i=t.width,r=t.height;return nn.default.clone(e,this._passState.scissorTest.rectangle),Object(o.default)(this._fb)&&this._width===i&&this._height===r||(this._width=i,this._height=r,this._fb=this._fb&&this._fb.destroy(),this._fb=new Ln.a({context:a,colorTextures:[new S.a({context:a,width:i,height:r})],depthStencilRenderbuffer:new Sf({context:a,width:i,height:r,format:Ef.DEPTH_STENCIL})}),this._passState.framebuffer=this._fb),this._passState.viewport.width=i,this._passState.viewport.height=r,this._passState};var Df=new G.default;Pf.prototype.end=function(e){for(var t=Object(n.default)(e.width,1),a=Object(n.default)(e.height,1),i=this._context,r=i.readPixels({x:e.x,y:e.y,width:t,height:a,framebuffer:this._fb}),s=Math.max(t,a),l=s*s,u=Math.floor(.5*t),d=Math.floor(.5*a),f=0,c=0,h=0,m=-1,p=0;p<l;++p){if(-u<=f&&f<=u&&-d<=c&&c<=d){var _=4*((d-c)*t+f+u);Df.red=G.default.byteToFloat(r[_]),Df.green=G.default.byteToFloat(r[_+1]),Df.blue=G.default.byteToFloat(r[_+2]),Df.alpha=G.default.byteToFloat(r[_+3]);var g=i.getObjectByPickColor(Df);if(Object(o.default)(g))return g}if(f===c||f<0&&-f===c||f>0&&f===1-c){var v=h;h=-m,m=v}f+=h,c+=m}},Pf.prototype.isDestroyed=function(){return!1},Pf.prototype.destroy=function(){return this._fb=this._fb&&this._fb.destroy(),Object(l.default)(this)};var If=Pf;function Mf(){this._colorTexture=void 0,this._idTexture=void 0,this._depthStencilTexture=void 0,this._depthStencilRenderbuffer=void 0,this._framebuffer=void 0,this._idFramebuffer=void 0,this._idClearColor=new G.default(0,0,0,0),this._useHdr=void 0,this._clearCommand=new Rn.a({color:new G.default(0,0,0,0),depth:1,owner:this})}function Ff(e){e._framebuffer=e._framebuffer&&e._framebuffer.destroy(),e._idFramebuffer=e._idFramebuffer&&e._idFramebuffer.destroy(),e._colorTexture=e._colorTexture&&e._colorTexture.destroy(),e._idTexture=e._idTexture&&e._idTexture.destroy(),e._depthStencilTexture=e._depthStencilTexture&&e._depthStencilTexture.destroy(),e._depthStencilRenderbuffer=e._depthStencilRenderbuffer&&e._depthStencilRenderbuffer.destroy(),e._depthStencilIdTexture=e._depthStencilIdTexture&&e._depthStencilIdTexture.destroy(),e._depthStencilIdRenderbuffer=e._depthStencilIdRenderbuffer&&e._depthStencilIdRenderbuffer.destroy(),e._framebuffer=void 0,e._idFramebuffer=void 0,e._colorTexture=void 0,e._idTexture=void 0,e._depthStencilTexture=void 0,e._depthStencilRenderbuffer=void 0,e._depthStencilIdTexture=void 0,e._depthStencilIdRenderbuffer=void 0}Mf.prototype.update=function(e,t,a){var i=t.width,r=t.height,n=this._colorTexture;if(!Object(o.default)(n)||n.width!==i||n.height!==r||a!==this._useHdr){Ff(this),this._useHdr=a;var s=a?e.halfFloatingPointTexture?we.a.HALF_FLOAT:we.a.FLOAT:we.a.UNSIGNED_BYTE;this._colorTexture=new S.a({context:e,width:i,height:r,pixelFormat:_e.a.RGBA,pixelDatatype:s,sampler:new Oe.a({wrapS:Te.a.CLAMP_TO_EDGE,wrapT:Te.a.CLAMP_TO_EDGE,minificationFilter:Ce.a.NEAREST,magnificationFilter:xe.a.NEAREST})}),this._idTexture=new S.a({context:e,width:i,height:r,pixelFormat:_e.a.RGBA,pixelDatatype:we.a.UNSIGNED_BYTE,sampler:new Oe.a({wrapS:Te.a.CLAMP_TO_EDGE,wrapT:Te.a.CLAMP_TO_EDGE,minificationFilter:Ce.a.NEAREST,magnificationFilter:xe.a.NEAREST})}),e.depthTexture?(this._depthStencilTexture=new S.a({context:e,width:i,height:r,pixelFormat:_e.a.DEPTH_STENCIL,pixelDatatype:we.a.UNSIGNED_INT_24_8,sampler:new Oe.a({wrapS:Te.a.CLAMP_TO_EDGE,wrapT:Te.a.CLAMP_TO_EDGE,minificationFilter:Ce.a.NEAREST,magnificationFilter:xe.a.NEAREST})}),this._depthStencilIdTexture=new S.a({context:e,width:i,height:r,pixelFormat:_e.a.DEPTH_STENCIL,pixelDatatype:we.a.UNSIGNED_INT_24_8,sampler:new Oe.a({wrapS:Te.a.CLAMP_TO_EDGE,wrapT:Te.a.CLAMP_TO_EDGE,minificationFilter:Ce.a.NEAREST,magnificationFilter:xe.a.NEAREST})})):(this._depthStencilRenderbuffer=new Sf({context:e,width:i,height:r,format:Ef.DEPTH_STENCIL}),this._depthStencilIdRenderbuffer=new Sf({context:e,width:i,height:r,format:Ef.DEPTH_STENCIL})),this._framebuffer=new Ln.a({context:e,colorTextures:[this._colorTexture],depthStencilTexture:this._depthStencilTexture,depthStencilRenderbuffer:this._depthStencilRenderbuffer,destroyAttachments:!1}),this._idFramebuffer=new Ln.a({context:e,colorTextures:[this._idTexture],depthStencilTexture:this._depthStencilIdTexture,depthStencilRenderbuffer:this._depthStencilIdRenderbuffer,destroyAttachments:!1})}},Mf.prototype.clear=function(e,t,a){var i=t.framebuffer;t.framebuffer=this._framebuffer,G.default.clone(a,this._clearCommand.color),this._clearCommand.execute(e,t),t.framebuffer=this._idFramebuffer,G.default.clone(this._idClearColor,this._clearCommand.color),this._clearCommand.execute(e,t),t.framebuffer=i},Mf.prototype.getFramebuffer=function(){return this._framebuffer},Mf.prototype.getIdFramebuffer=function(){return this._idFramebuffer},Mf.prototype.isDestroyed=function(){return!1},Mf.prototype.destroy=function(){return Ff(this),Object(l.default)(this)};var Rf=Mf;function Nf(){}Nf.getShadowCastShaderKeyword=function(e,t,a,i){return"castShadow "+e+" "+t+" "+a+" "+i},Nf.createShadowCastVertexShader=function(e,t,a){var i=e.defines.slice(0),r=e.sources.slice(0);i.push("SHADOW_MAP"),a&&i.push("GENERATE_POSITION");var n=A.a.findPositionVarying(e),s=Object(o.default)(n);if(t&&!s){for(var l=r.length,u=0;u<l;++u)r[u]=A.a.replaceMain(r[u],"czm_shadow_cast_main");r.push("varying vec3 v_positionEC; \nvoid main() \n{ \n    czm_shadow_cast_main(); \n    v_positionEC = (czm_inverseProjection * gl_Position).xyz; \n}")}return new A.a({defines:i,sources:r})},Nf.createShadowCastFragmentShader=function(e,t,a,i){var r=e.defines.slice(0),n=e.sources.slice(0),s=A.a.findPositionVarying(e),l=Object(o.default)(s);l||(s="v_positionEC");for(var u=n.length,d=0;d<u;++d)n[d]=A.a.replaceMain(n[d],"czm_shadow_cast_main");var f="";return t&&(l||(f+="varying vec3 v_positionEC; \n"),f+="uniform vec4 shadowMap_lightPositionEC; \n"),f+=i?"void main() \n{ \n":"void main() \n{ \n    czm_shadow_cast_main(); \n    if (gl_FragColor.a == 0.0) \n    { \n       discard; \n    } \n",f+=t?"    float distance = length("+s+"); \n    if (distance >= shadowMap_lightPositionEC.w) \n    { \n        discard; \n    } \n    distance /= shadowMap_lightPositionEC.w; // radius \n    gl_FragColor = czm_packDepth(distance); \n":a?"    gl_FragColor = vec4(1.0); \n":"    gl_FragColor = czm_packDepth(gl_FragCoord.z); \n",f+="} \n",n.push(f),new A.a({defines:r,sources:n})},Nf.getShadowReceiveShaderKeyword=function(e,t,a,i){return"receiveShadow "+e._usesDepthTexture+e._polygonOffsetSupported+e._isPointLight+e._isSpotLight+(e._numberOfCascades>1)+e.debugCascadeColors+e.softShadows+t+a+i},Nf.createShadowReceiveVertexShader=function(e,t,a){var i=e.defines.slice(0),r=e.sources.slice(0);return i.push("SHADOW_MAP"),t&&(a?i.push("GENERATE_POSITION_AND_NORMAL"):i.push("GENERATE_POSITION")),new A.a({defines:i,sources:r})},Nf.createShadowReceiveFragmentShader=function(e,t,a,i,r){for(var n=A.a.findNormalVarying(e),s=!i&&Object(o.default)(n)||i&&r,l=A.a.findPositionVarying(e),u=Object(o.default)(l),d=t._usesDepthTexture,f=t._polygonOffsetSupported,c=t._isPointLight,h=t._isSpotLight,m=t._numberOfCascades>1,p=t.debugCascadeColors,_=t.softShadows,g=c?t._pointBias:i?t._terrainBias:t._primitiveBias,v=e.defines.slice(0),y=e.sources.slice(0),b=y.length,w=0;w<b;++w)y[w]=A.a.replaceMain(y[w],"czm_shadow_receive_main");c?v.push("USE_CUBE_MAP_SHADOW"):d&&v.push("USE_SHADOW_DEPTH_TEXTURE"),_&&!c&&v.push("USE_SOFT_SHADOWS"),m&&a&&i&&(s?v.push("ENABLE_VERTEX_LIGHTING"):v.push("ENABLE_DAYNIGHT_SHADING")),a&&g.normalShading&&s&&(v.push("USE_NORMAL_SHADING"),g.normalShadingSmooth>0&&v.push("USE_NORMAL_SHADING_SMOOTH"));var O="";return O+=c?"uniform samplerCube shadowMap_textureCube; \n":"uniform sampler2D shadowMap_texture; \n",O+="uniform mat4 shadowMap_matrix; \nuniform vec3 shadowMap_lightDirectionEC; \nuniform vec4 shadowMap_lightPositionEC; \nuniform vec4 shadowMap_normalOffsetScaleDistanceMaxDistanceAndDarkness; \nuniform vec4 shadowMap_texelSizeDepthBiasAndNormalShadingSmooth; \n#ifdef LOG_DEPTH \nvarying vec3 v_logPositionEC; \n#endif \nvec4 getPositionEC() \n{ \n"+(u?"    return vec4("+l+", 1.0); \n":"#ifndef LOG_DEPTH \n    return czm_windowToEyeCoordinates(gl_FragCoord); \n#else \n    return vec4(v_logPositionEC, 1.0); \n#endif \n")+"} \nvec3 getNormalEC() \n{ \n"+(s?"    return normalize("+n+"); \n":"    return vec3(1.0); \n")+"} \nvoid applyNormalOffset(inout vec4 positionEC, vec3 normalEC, float nDotL) \n{ \n"+(g.normalOffset&&s?"    float normalOffset = shadowMap_normalOffsetScaleDistanceMaxDistanceAndDarkness.x; \n    float normalOffsetScale = 1.0 - nDotL; \n    vec3 offset = normalOffset * normalOffsetScale * normalEC; \n    positionEC.xyz += offset; \n":"")+"} \n",O+="void main() \n{ \n    czm_shadow_receive_main(); \n    vec4 positionEC = getPositionEC(); \n    vec3 normalEC = getNormalEC(); \n    float depth = -positionEC.z; \n",O+="    czm_shadowParameters shadowParameters; \n    shadowParameters.texelStepSize = shadowMap_texelSizeDepthBiasAndNormalShadingSmooth.xy; \n    shadowParameters.depthBias = shadowMap_texelSizeDepthBiasAndNormalShadingSmooth.z; \n    shadowParameters.normalShadingSmooth = shadowMap_texelSizeDepthBiasAndNormalShadingSmooth.w; \n    shadowParameters.darkness = shadowMap_normalOffsetScaleDistanceMaxDistanceAndDarkness.w; \n",i?O+="    shadowParameters.depthBias *= max(depth * 0.01, 1.0); \n":f||(O+="    shadowParameters.depthBias *= mix(1.0, 100.0, depth * 0.0015); \n"),O+=c?"    vec3 directionEC = positionEC.xyz - shadowMap_lightPositionEC.xyz; \n    float distance = length(directionEC); \n    directionEC = normalize(directionEC); \n    float radius = shadowMap_lightPositionEC.w; \n    // Stop early if the fragment is beyond the point light radius \n    if (distance > radius) \n    { \n        return; \n    } \n    vec3 directionWC  = czm_inverseViewRotation * directionEC; \n    shadowParameters.depth = distance / radius; \n    shadowParameters.nDotL = clamp(dot(normalEC, -directionEC), 0.0, 1.0); \n    shadowParameters.texCoords = directionWC; \n    float visibility = czm_shadowVisibility(shadowMap_textureCube, shadowParameters); \n":h?"    vec3 directionEC = normalize(positionEC.xyz - shadowMap_lightPositionEC.xyz); \n    float nDotL = clamp(dot(normalEC, -directionEC), 0.0, 1.0); \n    applyNormalOffset(positionEC, normalEC, nDotL); \n    vec4 shadowPosition = shadowMap_matrix * positionEC; \n    // Spot light uses a perspective projection, so perform the perspective divide \n    shadowPosition /= shadowPosition.w; \n    // Stop early if the fragment is not in the shadow bounds \n    if (any(lessThan(shadowPosition.xyz, vec3(0.0))) || any(greaterThan(shadowPosition.xyz, vec3(1.0)))) \n    { \n        return; \n    } \n    shadowParameters.texCoords = shadowPosition.xy; \n    shadowParameters.depth = shadowPosition.z; \n    shadowParameters.nDotL = nDotL; \n    float visibility = czm_shadowVisibility(shadowMap_texture, shadowParameters); \n":m?"    float maxDepth = shadowMap_cascadeSplits[1].w; \n    // Stop early if the eye depth exceeds the last cascade \n    if (depth > maxDepth) \n    { \n        return; \n    } \n    // Get the cascade based on the eye-space depth \n    vec4 weights = czm_cascadeWeights(depth); \n    // Apply normal offset \n    float nDotL = clamp(dot(normalEC, shadowMap_lightDirectionEC), 0.0, 1.0); \n    applyNormalOffset(positionEC, normalEC, nDotL); \n    // Transform position into the cascade \n    vec4 shadowPosition = czm_cascadeMatrix(weights) * positionEC; \n    // Get visibility \n    shadowParameters.texCoords = shadowPosition.xy; \n    shadowParameters.depth = shadowPosition.z; \n    shadowParameters.nDotL = nDotL; \n    float visibility = czm_shadowVisibility(shadowMap_texture, shadowParameters); \n    // Fade out shadows that are far away \n    float shadowMapMaximumDistance = shadowMap_normalOffsetScaleDistanceMaxDistanceAndDarkness.z; \n    float fade = max((depth - shadowMapMaximumDistance * 0.8) / (shadowMapMaximumDistance * 0.2), 0.0); \n    visibility = mix(visibility, 1.0, fade); \n"+(p?"    // Draw cascade colors for debugging \n    gl_FragColor *= czm_cascadeColor(weights); \n":""):"    float nDotL = clamp(dot(normalEC, shadowMap_lightDirectionEC), 0.0, 1.0); \n    applyNormalOffset(positionEC, normalEC, nDotL); \n    vec4 shadowPosition = shadowMap_matrix * positionEC; \n    // Stop early if the fragment is not in the shadow bounds \n    if (any(lessThan(shadowPosition.xyz, vec3(0.0))) || any(greaterThan(shadowPosition.xyz, vec3(1.0)))) \n    { \n        return; \n    } \n    shadowParameters.texCoords = shadowPosition.xy; \n    shadowParameters.depth = shadowPosition.z; \n    shadowParameters.nDotL = nDotL; \n    float visibility = czm_shadowVisibility(shadowMap_texture, shadowParameters); \n",O+="    gl_FragColor.rgb *= visibility; \n} \n",y.push(O),new A.a({defines:v,sources:y})};var Lf=Nf;function jf(e){var t=(e=Object(n.default)(e,n.default.EMPTY_OBJECT)).context;this._enabled=Object(n.default)(e.enabled,!0),this._softShadows=Object(n.default)(e.softShadows,!1),this._normalOffset=Object(n.default)(e.normalOffset,!0),this.dirty=!0,this.fromLightSource=Object(n.default)(e.fromLightSource,!0),this.darkness=Object(n.default)(e.darkness,.3),this._darkness=this.darkness,this.maximumDistance=Object(n.default)(e.maximumDistance,5e3),this._outOfView=!1,this._outOfViewPrevious=!1,this._needsUpdate=!0;var a,r=!0;(f.default.isInternetExplorer()||f.default.isEdge()||(f.default.isChrome()||f.default.isFirefox())&&f.default.isWindows()&&!t.depthTexture)&&(r=!1),this._polygonOffsetSupported=r,this._terrainBias={polygonOffset:r,polygonOffsetFactor:1.1,polygonOffsetUnits:4,normalOffset:this._normalOffset,normalOffsetScale:.5,normalShading:!0,normalShadingSmooth:.3,depthBias:1e-4},this._primitiveBias={polygonOffset:r,polygonOffsetFactor:1.1,polygonOffsetUnits:4,normalOffset:this._normalOffset,normalOffsetScale:.1,normalShading:!0,normalShadingSmooth:.05,depthBias:2e-5},this._pointBias={polygonOffset:!1,polygonOffsetFactor:1.1,polygonOffsetUnits:4,normalOffset:this._normalOffset,normalOffsetScale:0,normalShading:!0,normalShadingSmooth:.1,depthBias:5e-4},this._depthAttachment=void 0,this._colorAttachment=void 0,this._shadowMapMatrix=new J.default,this._shadowMapTexture=void 0,this._lightDirectionEC=new i.default,this._lightPositionEC=new H.a,this._distance=0,this._lightCamera=e.lightCamera,this._shadowMapCamera=new tc,this._shadowMapCullingVolume=void 0,this._sceneCamera=void 0,this._boundingSphere=new v.default,this._isPointLight=Object(n.default)(e.isPointLight,!1),this._pointLightRadius=Object(n.default)(e.pointLightRadius,100),this._cascadesEnabled=!this._isPointLight&&Object(n.default)(e.cascadesEnabled,!0),this._numberOfCascades=this._cascadesEnabled?Object(n.default)(e.numberOfCascades,4):0,this._fitNearFar=!0,this._maximumCascadeDistances=[25,150,700,Number.MAX_VALUE],this._textureSize=new B.default,this._isSpotLight=!1,this._cascadesEnabled?this._shadowMapCamera.frustum=new ha.a:Object(o.default)(this._lightCamera.frustum.fov)&&(this._isSpotLight=!0),this._cascadeSplits=[new H.a,new H.a],this._cascadeMatrices=[new J.default,new J.default,new J.default,new J.default],this._cascadeDistances=new H.a,a=this._isPointLight?6:this._cascadesEnabled?this._numberOfCascades:1,this._passes=new Array(a);for(var s=0;s<a;++s)this._passes[s]=new Vf(t);this.debugShow=!1,this.debugFreezeFrame=!1,this._debugFreezeFrame=!1,this._debugCascadeColors=!1,this._debugLightFrustum=void 0,this._debugCameraFrustum=void 0,this._debugCascadeFrustums=new Array(this._numberOfCascades),this._debugShadowViewCommand=void 0,this._usesDepthTexture=t.depthTexture,this._isPointLight&&(this._usesDepthTexture=!1),this._primitiveRenderState=void 0,this._terrainRenderState=void 0,this._pointRenderState=void 0,zf(this),this._clearCommand=new Rn.a({depth:1,color:new G.default}),this._clearPassState=new Kn(t),this._size=Object(n.default)(e.size,2048),this.size=this._size}function Vf(e){this.camera=new tc,this.passState=new Kn(e),this.framebuffer=void 0,this.textureOffsets=void 0,this.commandList=[],this.cullingVolume=void 0}function Uf(e,t){return fe.a.fromCache({cull:{enabled:!0,face:Yr.a.BACK},depthTest:{enabled:!0},colorMask:{red:e,green:e,blue:e,alpha:e},depthMask:!0,polygonOffset:{enabled:t.polygonOffset,factor:t.polygonOffsetFactor,units:t.polygonOffsetUnits}})}function zf(e){var t=!e._usesDepthTexture;e._primitiveRenderState=Uf(t,e._primitiveBias),e._terrainRenderState=Uf(t,e._terrainBias),e._pointRenderState=Uf(t,e._pointBias)}function Bf(e){for(var t=e._passes.length,a=0;a<t;++a){var i=e._passes[a],r=i.framebuffer;Object(o.default)(r)&&!r.isDestroyed()&&r.destroy(),i.framebuffer=void 0}e._depthAttachment=e._depthAttachment&&e._depthAttachment.destroy(),e._colorAttachment=e._colorAttachment&&e._colorAttachment.destroy()}function Hf(){return new Oe.a({wrapS:Te.a.CLAMP_TO_EDGE,wrapT:Te.a.CLAMP_TO_EDGE,minificationFilter:Ce.a.NEAREST,magnificationFilter:xe.a.NEAREST})}function kf(e,t){e._isPointLight?function(e,t){for(var a=new Sf({context:t,width:e._textureSize.x,height:e._textureSize.y,format:Ef.DEPTH_COMPONENT16}),i=new Zn.a({context:t,width:e._textureSize.x,height:e._textureSize.y,pixelFormat:_e.a.RGBA,pixelDatatype:we.a.UNSIGNED_BYTE,sampler:Hf()}),r=[i.negativeX,i.negativeY,i.negativeZ,i.positiveX,i.positiveY,i.positiveZ],n=0;n<6;++n){var o=new Ln.a({context:t,depthRenderbuffer:a,colorTextures:[r[n]],destroyAttachments:!1}),s=e._passes[n];s.framebuffer=o,s.passState.framebuffer=o}e._shadowMapTexture=i,e._depthAttachment=a,e._colorAttachment=i}(e,t):e._usesDepthTexture?function(e,t){for(var a=new S.a({context:t,width:e._textureSize.x,height:e._textureSize.y,pixelFormat:_e.a.DEPTH_STENCIL,pixelDatatype:we.a.UNSIGNED_INT_24_8,sampler:Hf()}),i=new Ln.a({context:t,depthStencilTexture:a,destroyAttachments:!1}),r=e._passes.length,n=0;n<r;++n){var o=e._passes[n];o.framebuffer=i,o.passState.framebuffer=i}e._shadowMapTexture=a,e._depthAttachment=a}(e,t):function(e,t){for(var a=new Sf({context:t,width:e._textureSize.x,height:e._textureSize.y,format:Ef.DEPTH_COMPONENT16}),i=new S.a({context:t,width:e._textureSize.x,height:e._textureSize.y,pixelFormat:_e.a.RGBA,pixelDatatype:we.a.UNSIGNED_BYTE,sampler:Hf()}),r=new Ln.a({context:t,depthRenderbuffer:a,colorTextures:[i],destroyAttachments:!1}),n=e._passes.length,o=0;o<n;++o){var s=e._passes[o];s.framebuffer=r,s.passState.framebuffer=r}e._shadowMapTexture=i,e._depthAttachment=a,e._colorAttachment=i}(e,t)}function Gf(e,t){Object(o.default)(e._passes[0].framebuffer)&&e._shadowMapTexture.width===e._textureSize.x||(Bf(e),kf(e,t),function(e,t){e._usesDepthTexture&&e._passes[0].framebuffer.status!==Wn.a.FRAMEBUFFER_COMPLETE&&(e._usesDepthTexture=!1,zf(e),Bf(e),kf(e,t))}(e,t),Wf(e,t))}function Wf(e,t,a){a=Object(n.default)(a,0),(e._isPointLight||0===a)&&(e._clearCommand.framebuffer=e._passes[a].framebuffer,e._clearCommand.execute(t,e._clearPassState))}jf.MAXIMUM_DISTANCE=2e4,jf.prototype.debugCreateRenderStates=function(){zf(this)},Object(s.default)(jf.prototype,{enabled:{get:function(){return this._enabled},set:function(e){this.dirty=this._enabled!==e,this._enabled=e}},normalOffset:{get:function(){return this._normalOffset},set:function(e){this.dirty=this._normalOffset!==e,this._normalOffset=e,this._terrainBias.normalOffset=e,this._primitiveBias.normalOffset=e,this._pointBias.normalOffset=e}},softShadows:{get:function(){return this._softShadows},set:function(e){this.dirty=this._softShadows!==e,this._softShadows=e}},size:{get:function(){return this._size},set:function(e){!function(e,t){e._size=t;var a=e._passes,i=a.length,r=e._textureSize;if(e._isPointLight){t=le.a.maximumCubeMapSize>=t?t:le.a.maximumCubeMapSize,r.x=t,r.y=t;var n=new nn.default(0,0,t,t);a[0].passState.viewport=n,a[1].passState.viewport=n,a[2].passState.viewport=n,a[3].passState.viewport=n,a[4].passState.viewport=n,a[5].passState.viewport=n}else 1===i?(t=le.a.maximumTextureSize>=t?t:le.a.maximumTextureSize,r.x=t,r.y=t,a[0].passState.viewport=new nn.default(0,0,t,t)):4===i&&(t=le.a.maximumTextureSize>=2*t?t:le.a.maximumTextureSize/2,r.x=2*t,r.y=2*t,a[0].passState.viewport=new nn.default(0,0,t,t),a[1].passState.viewport=new nn.default(t,0,t,t),a[2].passState.viewport=new nn.default(0,t,t,t),a[3].passState.viewport=new nn.default(t,t,t,t));e._clearPassState.viewport=new nn.default(0,0,r.x,r.y);for(var o=0;o<i;++o){var s=a[o],l=s.passState.viewport,u=l.x/r.x,d=l.y/r.y,f=l.width/r.x,c=l.height/r.y;s.textureOffsets=new J.default(f,0,0,u,0,c,0,d,0,0,1,0,0,0,0,1)}}(this,e)}},outOfView:{get:function(){return this._outOfView}},shadowMapCullingVolume:{get:function(){return this._shadowMapCullingVolume}},passes:{get:function(){return this._passes}},isPointLight:{get:function(){return this._isPointLight}},debugCascadeColors:{get:function(){return this._debugCascadeColors},set:function(e){this.dirty=this._debugCascadeColors!==e,this._debugCascadeColors=e}}});var Yf=new nn.default;function Xf(e,t){var a=t.context,i=t.context.drawingBufferWidth,r=t.context.drawingBufferHeight,n=.3*Math.min(i,r),s=Yf;s.x=i-n,s.y=0,s.width=n,s.height=n;var l=e._debugShadowViewCommand;Object(o.default)(l)||(l=function(e,t){var a;a=e._isPointLight?"uniform samplerCube shadowMap_textureCube; \nvarying vec2 v_textureCoordinates; \nvoid main() \n{ \n    vec2 uv = v_textureCoordinates; \n    vec3 dir; \n \n    if (uv.y < 0.5) \n    { \n        if (uv.x < 0.333) \n        { \n            dir.x = -1.0; \n            dir.y = uv.x * 6.0 - 1.0; \n            dir.z = uv.y * 4.0 - 1.0; \n        } \n        else if (uv.x < 0.666) \n        { \n            dir.y = -1.0; \n            dir.x = uv.x * 6.0 - 3.0; \n            dir.z = uv.y * 4.0 - 1.0; \n        } \n        else \n        { \n            dir.z = -1.0; \n            dir.x = uv.x * 6.0 - 5.0; \n            dir.y = uv.y * 4.0 - 1.0; \n        } \n    } \n    else \n    { \n        if (uv.x < 0.333) \n        { \n            dir.x = 1.0; \n            dir.y = uv.x * 6.0 - 1.0; \n            dir.z = uv.y * 4.0 - 3.0; \n        } \n        else if (uv.x < 0.666) \n        { \n            dir.y = 1.0; \n            dir.x = uv.x * 6.0 - 3.0; \n            dir.z = uv.y * 4.0 - 3.0; \n        } \n        else \n        { \n            dir.z = 1.0; \n            dir.x = uv.x * 6.0 - 5.0; \n            dir.y = uv.y * 4.0 - 3.0; \n        } \n    } \n \n    float shadow = czm_unpackDepth(textureCube(shadowMap_textureCube, dir)); \n    gl_FragColor = vec4(vec3(shadow), 1.0); \n} \n":"uniform sampler2D shadowMap_texture; \nvarying vec2 v_textureCoordinates; \nvoid main() \n{ \n"+(e._usesDepthTexture?"    float shadow = texture2D(shadowMap_texture, v_textureCoordinates).r; \n":"    float shadow = czm_unpackDepth(texture2D(shadowMap_texture, v_textureCoordinates)); \n")+"    gl_FragColor = vec4(vec3(shadow), 1.0); \n} \n";var i=t.createViewportQuadCommand(a,{uniformMap:{shadowMap_texture:function(){return e._shadowMapTexture},shadowMap_textureCube:function(){return e._shadowMapTexture}}});return i.pass=de.a.OVERLAY,i}(e,a),e._debugShadowViewCommand=l),Object(o.default)(l.renderState)&&nn.default.equals(l.renderState.viewport,s)||(l.renderState=fe.a.fromCache({viewport:nn.default.clone(s)})),t.commandList.push(e._debugShadowViewCommand)}var Qf=new Array(8);Qf[0]=new H.a(-1,-1,-1,1),Qf[1]=new H.a(1,-1,-1,1),Qf[2]=new H.a(1,1,-1,1),Qf[3]=new H.a(-1,1,-1,1),Qf[4]=new H.a(-1,-1,1,1),Qf[5]=new H.a(1,-1,1,1),Qf[6]=new H.a(1,1,1,1),Qf[7]=new H.a(-1,1,1,1);for(var qf=new J.default,Zf=new Array(8),Kf=0;Kf<8;++Kf)Zf[Kf]=new H.a;var Jf=[G.default.RED,G.default.GREEN,G.default.BLUE,G.default.MAGENTA],$f=new i.default;function ec(e,t){Xf(e,t);var a=e.debugFreezeFrame&&!e._debugFreezeFrame;if(e._debugFreezeFrame=e.debugFreezeFrame,e.debugFreezeFrame&&(a&&(e._debugCameraFrustum=e._debugCameraFrustum&&e._debugCameraFrustum.destroy(),e._debugCameraFrustum=new Hu({camera:e._sceneCamera,color:G.default.CYAN,updateOnChange:!1})),e._debugCameraFrustum.update(t)),e._cascadesEnabled){if(e.debugFreezeFrame){a&&(e._debugLightFrustum=e._debugLightFrustum&&e._debugLightFrustum.destroy(),e._debugLightFrustum=new Hu({camera:e._shadowMapCamera,color:G.default.YELLOW,updateOnChange:!1})),e._debugLightFrustum.update(t);for(var r=0;r<e._numberOfCascades;++r)a&&(e._debugCascadeFrustums[r]=e._debugCascadeFrustums[r]&&e._debugCascadeFrustums[r].destroy(),e._debugCascadeFrustums[r]=new Hu({camera:e._passes[r].camera,color:Jf[r],updateOnChange:!1})),e._debugCascadeFrustums[r].update(t)}}else if(e._isPointLight){if(!Object(o.default)(e._debugLightFrustum)||e._needsUpdate){var n=e._shadowMapCamera.positionWC,s=gi.default.IDENTITY,l=2*e._pointLightRadius,u=i.default.fromElements(l,l,l,$f),d=J.default.fromTranslationQuaternionRotationScale(n,s,u,qf);e._debugLightFrustum=e._debugLightFrustum&&e._debugLightFrustum.destroy(),e._debugLightFrustum=function(e,t){var a=new X.a({geometry:new z.a({minimum:new i.default(-.5,-.5,-.5),maximum:new i.default(.5,.5,.5)}),attributes:{color:W.a.fromColor(t)}}),r=new X.a({geometry:new ae.a({radius:.5}),attributes:{color:W.a.fromColor(t)}});return new Ve.a({geometryInstances:[a,r],appearance:new je.a({translucent:!1,flat:!0}),asynchronous:!1,modelMatrix:e})}(d,G.default.YELLOW)}e._debugLightFrustum.update(t)}else Object(o.default)(e._debugLightFrustum)&&!e._needsUpdate||(e._debugLightFrustum=new Hu({camera:e._shadowMapCamera,color:G.default.YELLOW,updateOnChange:!1})),e._debugLightFrustum.update(t)}function tc(){this.viewMatrix=new J.default,this.inverseViewMatrix=new J.default,this.frustum=void 0,this.positionCartographic=new y.default,this.positionWC=new i.default,this.directionWC=i.default.clone(i.default.UNIT_Z),this.upWC=i.default.clone(i.default.UNIT_Y),this.rightWC=i.default.clone(i.default.UNIT_X),this.viewProjectionMatrix=new J.default}tc.prototype.clone=function(e){J.default.clone(e.viewMatrix,this.viewMatrix),J.default.clone(e.inverseViewMatrix,this.inverseViewMatrix),this.frustum=e.frustum.clone(this.frustum),y.default.clone(e.positionCartographic,this.positionCartographic),i.default.clone(e.positionWC,this.positionWC),i.default.clone(e.directionWC,this.directionWC),i.default.clone(e.upWC,this.upWC),i.default.clone(e.rightWC,this.rightWC)};var ac=new J.default(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1);tc.prototype.getViewProjection=function(){var e=this.viewMatrix,t=this.frustum.projectionMatrix;return J.default.multiply(t,e,this.viewProjectionMatrix),J.default.multiply(ac,this.viewProjectionMatrix,this.viewProjectionMatrix),this.viewProjectionMatrix};var ic=new Array(5),rc=new Dn.a,nc=new Array(4),oc=new i.default,sc=new i.default;var lc=new J.default,uc=new i.default,dc=new i.default,fc=new i.default;var cc=[new i.default(-1,0,0),new i.default(0,-1,0),new i.default(0,0,-1),new i.default(1,0,0),new i.default(0,1,0),new i.default(0,0,1)],hc=[new i.default(0,-1,0),new i.default(0,0,-1),new i.default(0,-1,0),new i.default(0,-1,0),new i.default(0,0,1),new i.default(0,-1,0)],mc=[new i.default(0,0,1),new i.default(1,0,0),new i.default(-1,0,0),new i.default(0,0,-1),new i.default(1,0,0),new i.default(1,0,0)];var pc=new i.default,_c=new i.default,gc=new v.default,vc=gc.center;function yc(e,t){var a=t.camera,r=e._lightCamera,n=e._sceneCamera,o=e._shadowMapCamera;e._cascadesEnabled?i.default.clone(r.directionWC,o.directionWC):e._isPointLight?i.default.clone(r.positionWC,o.positionWC):o.clone(r);var s,l,u=e._lightDirectionEC;J.default.multiplyByPointAsVector(a.viewMatrix,o.directionWC,u),i.default.normalize(u,u),i.default.negate(u,u),J.default.multiplyByPoint(a.viewMatrix,o.positionWC,e._lightPositionEC),e._lightPositionEC.w=e._pointLightRadius,e._fitNearFar?(s=Math.min(t.shadowState.nearPlane,e.maximumDistance),l=Math.min(t.shadowState.farPlane,e.maximumDistance+1)):(s=a.frustum.near,l=e.maximumDistance),e._sceneCamera=Zl.clone(a,n),a.frustum.clone(e._sceneCamera.frustum),e._sceneCamera.frustum.near=s,e._sceneCamera.frustum.far=l,e._distance=l-s,function(e,t){var a=e._sceneCamera,r=e._shadowMapCamera,n=gc;if(e._cascadesEnabled){if(a.frustum.near>=e.maximumDistance)return e._outOfView=!0,void(e._needsUpdate=!1);var o=t.mapProjection.ellipsoid.geodeticSurfaceNormal(a.positionWC,pc),s=i.default.negate(r.directionWC,_c),l=i.default.dot(o,s),u=K.default.clamp(l/.1,0,1);if(e._darkness=K.default.lerp(1,e.darkness,u),l<0)return e._outOfView=!0,void(e._needsUpdate=!1);e._needsUpdate=!0,e._outOfView=!1}else if(e._isPointLight)n.center=r.positionWC,n.radius=e._pointLightRadius,e._outOfView=t.cullingVolume.computeVisibility(n)===Z.default.OUTSIDE,e._needsUpdate=!e._outOfView&&!e._boundingSphere.equals(n),v.default.clone(n,e._boundingSphere);else{var d=r.frustum.far/2,f=i.default.add(r.positionWC,i.default.multiplyByScalar(r.directionWC,d,vc),vc);n.center=f,n.radius=d,e._outOfView=t.cullingVolume.computeVisibility(n)===Z.default.OUTSIDE,e._needsUpdate=!e._outOfView&&!e._boundingSphere.equals(n),v.default.clone(n,e._boundingSphere)}}(e,t),!e._outOfViewPrevious&&e._outOfView&&(e._needsUpdate=!0),e._outOfViewPrevious=e._outOfView}jf.prototype.update=function(e){if(yc(this,e),this._needsUpdate)if(Gf(this,e.context),this._isPointLight&&function(e,t){var a=new Dn.a;a.fov=K.default.PI_OVER_TWO,a.near=1,a.far=e._pointLightRadius,a.aspectRatio=1;for(var i=0;i<6;++i){var r=e._passes[i].camera;r.positionWC=e._shadowMapCamera.positionWC,r.positionCartographic=t.mapProjection.ellipsoid.cartesianToCartographic(r.positionWC,r.positionCartographic),r.directionWC=cc[i],r.upWC=hc[i],r.rightWC=mc[i],J.default.computeView(r.positionWC,r.directionWC,r.upWC,r.rightWC,r.viewMatrix),J.default.inverse(r.viewMatrix,r.inverseViewMatrix),r.frustum=a}}(this,e),this._cascadesEnabled&&(function(e,t){var a=e._shadowMapCamera,r=e._sceneCamera,n=J.default.multiply(r.frustum.projectionMatrix,r.viewMatrix,qf),o=J.default.inverse(n,qf),s=a.directionWC,l=r.directionWC;i.default.equalsEpsilon(s,l,K.default.EPSILON10)&&(l=r.upWC);var u=i.default.cross(s,l,uc);l=i.default.cross(u,s,dc),i.default.normalize(l,l),i.default.normalize(u,u);for(var d=i.default.fromElements(0,0,0,fc),f=J.default.computeView(d,s,l,u,lc),c=J.default.multiply(f,o,qf),h=i.default.fromElements(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,oc),m=i.default.fromElements(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE,sc),p=0;p<8;++p){var _=H.a.clone(Qf[p],Zf[p]);J.default.multiplyByVector(c,_,_),i.default.divideByScalar(_,_.w,_),i.default.minimumByComponent(_,h,h),i.default.maximumByComponent(_,m,m)}m.z+=1e3,h.z-=10;var g=fc;g.x=-.5*(h.x+m.x),g.y=-.5*(h.y+m.y),g.z=-m.z;var v=J.default.fromTranslation(g,qf);f=J.default.multiply(v,f,f);var y=.5*(m.x-h.x),b=.5*(m.y-h.y),w=m.z-h.z,O=a.frustum;O.left=-y,O.right=y,O.bottom=-b,O.top=b,O.near=.01,O.far=w,J.default.clone(f,a.viewMatrix),J.default.inverse(f,a.inverseViewMatrix),J.default.getTranslation(a.inverseViewMatrix,a.positionWC),t.mapProjection.ellipsoid.cartesianToCartographic(a.positionWC,a.positionCartographic),i.default.clone(s,a.directionWC),i.default.clone(l,a.upWC),i.default.clone(u,a.rightWC)}(this,e),this._numberOfCascades>1&&function(e,t){var a,r=e._shadowMapCamera,n=e._sceneCamera,o=n.frustum.near,s=n.frustum.far,l=e._numberOfCascades,u=s-o,d=s/o,f=.9,c=!1;t.shadowState.closestObjectSize<200&&(c=!0,f=.9);var h=nc,m=ic;for(m[0]=o,m[l]=s,a=0;a<l;++a){var p=(a+1)/l,_=o*Math.pow(d,p),g=o+u*p,v=K.default.lerp(g,_,f);m[a+1]=v,h[a]=v-m[a]}if(c){for(a=0;a<l;++a)h[a]=Math.min(h[a],e._maximumCascadeDistances[a]);var y=m[0];for(a=0;a<l-1;++a)y+=h[a],m[a+1]=y}H.a.unpack(m,0,e._cascadeSplits[0]),H.a.unpack(m,1,e._cascadeSplits[1]),H.a.unpack(h,0,e._cascadeDistances);var b=r.frustum,w=b.left,O=b.right,x=b.bottom,C=b.top,T=b.near,E=b.far,A=r.positionWC,S=r.directionWC,P=r.upWC,D=n.frustum.clone(rc),I=r.getViewProjection();for(a=0;a<l;++a){D.near=m[a],D.far=m[a+1];for(var M=J.default.multiply(D.projectionMatrix,n.viewMatrix,qf),F=J.default.inverse(M,qf),R=J.default.multiply(I,F,qf),N=i.default.fromElements(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,oc),L=i.default.fromElements(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE,sc),j=0;j<8;++j){var V=H.a.clone(Qf[j],Zf[j]);J.default.multiplyByVector(R,V,V),i.default.divideByScalar(V,V.w,V),i.default.minimumByComponent(V,N,N),i.default.maximumByComponent(V,L,L)}N.x=Math.max(N.x,0),N.y=Math.max(N.y,0),N.z=0,L.x=Math.min(L.x,1),L.y=Math.min(L.y,1),L.z=Math.min(L.z,1);var U=e._passes[a],z=U.camera;z.clone(r);var B=z.frustum;B.left=w+N.x*(O-w),B.right=w+L.x*(O-w),B.bottom=x+N.y*(C-x),B.top=x+L.y*(C-x),B.near=T+N.z*(E-T),B.far=T+L.z*(E-T),U.cullingVolume=z.frustum.computeCullingVolume(A,S,P);var k=e._cascadeMatrices[a];J.default.multiply(z.getViewProjection(),n.inverseViewMatrix,k),J.default.multiply(U.textureOffsets,k,k)}}(this,e)),this._isPointLight)this._shadowMapCullingVolume=sn.a.fromBoundingSphere(this._boundingSphere);else{var t=this._shadowMapCamera,a=t.positionWC,r=t.directionWC,n=t.upWC;this._shadowMapCullingVolume=t.frustum.computeCullingVolume(a,r,n),1===this._passes.length&&this._passes[0].camera.clone(t)}if(1===this._passes.length){var o=this._sceneCamera.inverseViewMatrix;J.default.multiply(this._shadowMapCamera.getViewProjection(),o,this._shadowMapMatrix)}this.debugShow&&ec(this,e)},jf.prototype.updatePass=function(e,t){Wf(this,e,t)};var bc=new B.default;function wc(e,t,a){var i=e._isPointLight?e._pointBias:a?e._terrainBias:e._primitiveBias,r={shadowMap_texture:function(){return e._shadowMapTexture},shadowMap_textureCube:function(){return e._shadowMapTexture},shadowMap_matrix:function(){return e._shadowMapMatrix},shadowMap_cascadeSplits:function(){return e._cascadeSplits},shadowMap_cascadeMatrices:function(){return e._cascadeMatrices},shadowMap_lightDirectionEC:function(){return e._lightDirectionEC},shadowMap_lightPositionEC:function(){return e._lightPositionEC},shadowMap_cascadeDistances:function(){return e._cascadeDistances},shadowMap_texelSizeDepthBiasAndNormalShadingSmooth:function(){var t=bc;return t.x=1/e._textureSize.x,t.y=1/e._textureSize.y,H.a.fromElements(t.x,t.y,i.depthBias,i.normalShadingSmooth,this.combinedUniforms1)},shadowMap_normalOffsetScaleDistanceMaxDistanceAndDarkness:function(){return H.a.fromElements(i.normalOffsetScale,e._distance,e.maximumDistance,e._darkness,this.combinedUniforms2)},combinedUniforms1:new H.a,combinedUniforms2:new H.a};return Object(Y.default)(t,r,!1)}function Oc(e,t,a,i,r,n){var s,l,u;if(Object(o.default)(n)&&(s=n.shaderProgram,l=n.renderState,u=n.uniformMap),(n=ue.a.shallowClone(a,n)).castShadows=!0,n.receiveShadows=!1,!Object(o.default)(s)||r!==a.shaderProgram.id||t){var d=a.shaderProgram,f=a.pass===de.a.GLOBE,c=a.pass!==de.a.TRANSLUCENT,h=e._isPointLight,m=e._usesDepthTexture,p=Lf.getShadowCastShaderKeyword(h,f,m,c);if(s=i.shaderCache.getDerivedShaderProgram(d,p),!Object(o.default)(s)){var _=d.vertexShaderSource,g=d.fragmentShaderSource,v=Lf.createShadowCastVertexShader(_,h,f),y=Lf.createShadowCastFragmentShader(g,h,m,c);s=i.shaderCache.createDerivedShaderProgram(d,p,{vertexShaderSource:v,fragmentShaderSource:y,attributeLocations:d._attributeLocations})}l=e._primitiveRenderState,h?l=e._pointRenderState:f&&(l=e._terrainRenderState),a.renderState.cull.enabled||((l=Object(k.default)(l,!1)).cull=Object(k.default)(l.cull,!1),l.cull.enabled=!1,l=fe.a.fromCache(l)),u=wc(e,a.uniformMap,f)}return n.shaderProgram=s,n.renderState=l,n.uniformMap=u,n}jf.createReceiveDerivedCommand=function(e,t,a,i,r){Object(o.default)(r)||(r={});var n=e.length>0,s=t.shaderProgram,l=s.vertexShaderSource,u=s.fragmentShaderSource,d=t.pass===de.a.GLOBE,f=!1;if(d&&(f=t.owner.data.renderedMesh.encoding.hasVertexNormals),t.receiveShadows&&n){var c,h;Object(o.default)(r.receiveCommand)&&(c=r.receiveCommand.shaderProgram,h=r.receiveCommand.uniformMap),r.receiveCommand=ue.a.shallowClone(t,r.receiveCommand),r.castShadows=!1,r.receiveShadows=!0;var m=r.receiveShaderCastShadows!==t.castShadows,p=r.receiveShaderProgramId!==t.shaderProgram.id;if(!Object(o.default)(c)||p||a||m){var _=Lf.getShadowReceiveShaderKeyword(e[0],t.castShadows,d,f);if(c=i.shaderCache.getDerivedShaderProgram(s,_),!Object(o.default)(c)){var g=Lf.createShadowReceiveVertexShader(l,d,f),v=Lf.createShadowReceiveFragmentShader(u,e[0],t.castShadows,d,f);c=i.shaderCache.createDerivedShaderProgram(s,_,{vertexShaderSource:g,fragmentShaderSource:v,attributeLocations:s._attributeLocations})}h=wc(e[0],t.uniformMap,d)}r.receiveCommand.shaderProgram=c,r.receiveCommand.uniformMap=h,r.receiveShaderProgramId=t.shaderProgram.id,r.receiveShaderCastShadows=t.castShadows}return r},jf.createCastDerivedCommand=function(e,t,a,i,r){if(Object(o.default)(r)||(r={}),t.castShadows){var n=r.castCommands;Object(o.default)(n)||(n=r.castCommands=[]);var s=r.castShaderProgramId,l=e.length;n.length=l;for(var u=0;u<l;++u)n[u]=Oc(e[u],a,t,i,s,n[u]);r.castShaderProgramId=t.shaderProgram.id}return r},jf.prototype.isDestroyed=function(){return!1},jf.prototype.destroy=function(){Bf(this),this._debugLightFrustum=this._debugLightFrustum&&this._debugLightFrustum.destroy(),this._debugCameraFrustum=this._debugCameraFrustum&&this._debugCameraFrustum.destroy(),this._debugShadowViewCommand=this._debugShadowViewCommand&&this._debugShadowViewCommand.shaderProgram&&this._debugShadowViewCommand.shaderProgram.destroy();for(var e=0;e<this._numberOfCascades;++e)this._debugCascadeFrustums[e]=this._debugCascadeFrustums[e]&&this._debugCascadeFrustums[e].destroy();return Object(l.default)(this)};var xc=jf;function Cc(e,t,a){var i,r,n=e.context,o=[],s=t.frustum.near,l=t.frustum.far,u=e.logarithmicDepthBuffer?e.logarithmicDepthFarToNearRatio:e.farToNearRatio;Sc(s,l,u,Math.ceil(Math.log(l/s)/Math.log(u)),e.logarithmicDepthBuffer,o,!1,void 0),n.depthTexture&&(i=new Id),e._useOIT&&n.depthTexture&&(r=new wf(n));var d=new Kn(n);d.viewport=nn.default.clone(a),this.camera=t,this._cameraClone=Zl.clone(t),this._cameraStartFired=!1,this._cameraMovedTime=void 0,this.viewport=a,this.passState=d,this.pickFramebuffer=new If(n),this.pickDepthFramebuffer=new Cf,this.sceneFramebuffer=new Rf,this.globeDepth=i,this.oit=r,this.pickDepths=[],this.debugGlobeDepths=[],this.frustumCommandsList=o,this.debugFrustumStatistics=void 0,this.updateFrustums=!1}var Tc=new i.default,Ec=new i.default;function Ac(e,t,a){var r,n,o,s,l,u=1/Math.max(1,(r=e.position,n=t.position,o=Math.max(Math.abs(r.x),Math.abs(n.x)),s=Math.max(Math.abs(r.y),Math.abs(n.y)),l=Math.max(Math.abs(r.z),Math.abs(n.z)),Math.max(Math.max(o,s),l)));return i.default.multiplyByScalar(e.position,u,Tc),i.default.multiplyByScalar(t.position,u,Ec),i.default.equalsEpsilon(Tc,Ec,a)&&i.default.equalsEpsilon(e.direction,t.direction,a)&&i.default.equalsEpsilon(e.up,t.up,a)&&i.default.equalsEpsilon(e.right,t.right,a)&&J.default.equalsEpsilon(e.transform,t.transform,a)&&e.frustum.equalsEpsilon(t.frustum,a)}function Sc(e,t,a,i,r,n,s,l){n.length=i;for(var u=0;u<i;++u){var d,f;s?(d=Math.min(t-l,e+u*l),f=Math.min(t,d+l)):(f=a*(d=Math.max(e,Math.pow(a,u)*e)),r||(f=Math.min(t,f)));var c=n[u];Object(o.default)(c)?(c.near=d,c.far=f):c=n[u]=new nf(d,f)}}function Pc(e,t,a,i){e.debugShowFrustums&&(a.debugOverlappingFrustums=0);for(var r=t.frustumCommandsList,n=r.length,s=0;s<n;++s){var l=r[s],u=l.near,d=l.far;if(!(i.start>d)){if(i.stop<u)break;var f=a.pass,c=l.indices[f]++;if(l.commands[f][c]=a,e.debugShowFrustums&&(a.debugOverlappingFrustums|=1<<s),a.executeInClosestFrustum)break}}if(e.debugShowFrustums){var h=t.debugFrustumStatistics.commandsInFrustums;h[a.debugOverlappingFrustums]=Object(o.default)(h[a.debugOverlappingFrustums])?h[a.debugOverlappingFrustums]+1:1,++t.debugFrustumStatistics.totalCommands}e.updateDerivedCommands(a)}Cc.prototype.checkForCameraUpdates=function(e){var t=this.camera,a=this._cameraClone;return Ac(t,a,K.default.EPSILON15)?(this._cameraStartFired&&Object(ca.default)()-this._cameraMovedTime>e.cameraEventWaitTime&&(t.moveEnd.raiseEvent(),this._cameraStartFired=!1),!1):(this._cameraStartFired||(t.moveStart.raiseEvent(),this._cameraStartFired=!0),this._cameraMovedTime=Object(ca.default)(),Zl.clone(t,a),!0)};var Dc=new sn.a,Ic=new rf.a;Cc.prototype.createPotentiallyVisibleSet=function(e){var t=e.frameState,a=t.camera,i=a.directionWC,r=a.positionWC,n=e._computeCommandList,s=e._overlayCommandList,l=t.commandList;e.debugShowFrustums&&(this.debugFrustumStatistics={totalCommands:0,commandsInFrustums:{}});for(var u=this.frustumCommandsList,d=u.length,f=de.a.NUMBER_OF_PASSES,c=0;c<d;++c)for(var h=0;h<f;++h)u[c].indices[h]=0;n.length=0,s.length=0;for(var m=Number.MAX_VALUE,p=-Number.MAX_VALUE,_=!1,g=t.shadowState.shadowsEnabled,v=Number.MAX_VALUE,y=-Number.MAX_VALUE,b=Number.MAX_VALUE,w=t.mode===L.a.SCENE3D?t.occluder:void 0,O=t.cullingVolume,x=Dc.planes,C=0;C<5;++C)x[C]=O.planes[C];O=Dc;for(var T=l.length,E=0;E<T;++E){var A=l[E],S=A.pass;if(S===de.a.COMPUTE)n.push(A);else if(S===de.a.OVERLAY)s.push(A);else{var P=A.boundingVolume;if(Object(o.default)(P)){if(!e.isVisible(A,O,w))continue;if(Ic=P.computePlaneDistances(r,i,Ic),m=Math.min(m,Ic.start),p=Math.max(p,Ic.stop),g&&A.receiveShadows&&Ic.start<xc.MAXIMUM_DISTANCE&&!(S===de.a.GLOBE&&Ic.start<-100&&Ic.stop>100)){var D=Ic.stop-Ic.start;S!==de.a.GLOBE&&Ic.start<100&&(b=Math.min(b,D)),v=Math.min(v,Ic.start),y=Math.max(y,Ic.stop)}}else Ic.start=a.frustum.near,Ic.stop=a.frustum.far,_=!(A instanceof Rn.a);Pc(e,this,A,Ic)}}_?(m=a.frustum.near,p=a.frustum.far):(m=Math.min(Math.max(m,a.frustum.near),a.frustum.far),p=Math.max(Math.min(p,a.frustum.far),m),g&&(v=Math.min(Math.max(v,a.frustum.near),a.frustum.far),y=Math.max(Math.min(y,a.frustum.far),v))),g&&(t.shadowState.nearPlane=v,t.shadowState.farPlane=y,t.shadowState.closestObjectSize=b);var I,M=e.mode===L.a.SCENE2D,F=t.useLogDepth,R=F?e.logarithmicDepthFarToNearRatio:e.farToNearRatio;M?(p=Math.min(p,a.position.z+e.nearToFarDistance2D),m=Math.min(m,p),I=Math.ceil(Math.max(1,p-m)/e.nearToFarDistance2D)):I=Math.ceil(Math.log(p/m)/Math.log(R)),(this.updateFrustums||m!==Number.MAX_VALUE&&(I!==d||0!==u.length&&(m<u[0].near||p>u[d-1].far&&(F||!K.default.equalsEpsilon(p,u[d-1].far,K.default.EPSILON8)))))&&(this.updateFrustums=!1,Sc(m,p,R,I,F,u,M,e.nearToFarDistance2D),this.createPotentiallyVisibleSet(e));var N=t.frustumSplits;N.length=I+1;for(var j=0;j<I;++j)N[j]=u[j].near,j===I-1&&(N[j+1]=u[j].far)},Cc.prototype.destroy=function(){var e,t;this.pickFramebuffer=this.pickFramebuffer&&this.pickFramebuffer.destroy(),this.pickDepthFramebuffer=this.pickDepthFramebuffer&&this.pickDepthFramebuffer.destroy(),this.sceneFramebuffer=this.sceneFramebuffer&&this.sceneFramebuffer.destroy(),this.globeDepth=this.globeDepth&&this.globeDepth.destroy(),this.oit=this.oit&&this.oit.destroy();var a=this.pickDepths,i=this.debugGlobeDepths;for(t=a.length,e=0;e<t;++e)a[e].destroy();for(t=i.length,e=0;e<t;++e)i[e].destroy()};var Mc=Cc,Fc=.1,Rc=new Jl({pass:Kl.a.MOST_DETAILED_PRELOAD}),Nc=new Jl({pass:Kl.a.MOST_DETAILED_PICK}),Lc=new Jl({pass:Kl.a.PICK});function jc(e){this._mostDetailedRayPicks=[],this.pickRenderStateCache={},this._pickPositionCache={},this._pickPositionCacheDirty=!1;var t=new nn.default(0,0,1,1),a=new Zl(e);a.frustum=new ee.a({width:Fc,aspectRatio:1,near:.1}),this._pickOffscreenView=new Mc(e,a,t)}jc.prototype.update=function(){this._pickPositionCacheDirty=!0},jc.prototype.getPickDepth=function(e,t){var a=e.view.pickDepths,i=a[t];return Object(o.default)(i)||(i=new ef,a[t]=i),i};var Vc=new ha.a,Uc=new i.default,zc=new i.default,Bc=new B.default,Hc=new J.default;var kc=new In.a,Gc=new B.default;function Wc(e,t,a,r,n){var s=e.camera.frustum;return s instanceof ee.a||s instanceof ha.a?function(e,t,a,r,n){var s=e.camera,l=s.frustum;Object(o.default)(l._offCenterFrustum)&&(l=l._offCenterFrustum);var u=2*(t.x-n.x)/n.width-1;u*=.5*(l.right-l.left);var d=2*(n.height-t.y-n.y)/n.height-1;d*=.5*(l.top-l.bottom);var f=J.default.clone(s.transform,Hc);s._setTransform(J.default.IDENTITY);var c=i.default.clone(s.position,Uc);i.default.multiplyByScalar(s.right,u,zc),i.default.add(zc,c,c),i.default.multiplyByScalar(s.up,d,zc),i.default.add(zc,c,c),s._setTransform(f),e.mode===L.a.SCENE2D&&i.default.fromElements(c.z,c.x,c.y,c);var h=l.getPixelDimensions(n.width,n.height,1,1,Bc),m=Vc;return m.right=.5*h.x,m.left=-m.right,m.top=.5*h.y,m.bottom=-m.top,m.near=l.near,m.far=l.far,m.computeCullingVolume(c,s.directionWC,s.upWC)}(e,t,0,0,n):function(e,t,a,i,r){var n=e.camera,o=n.frustum,s=o.near,l=Math.tan(.5*o.fovy),u=o.aspectRatio*l,d=(2*(t.x-r.x)/r.width-1)*s*u,f=(2*(r.height-t.y-r.y)/r.height-1)*s*l,c=o.getPixelDimensions(r.width,r.height,1,1,Gc),h=c.x*a*.5,m=c.y*i*.5,p=kc;return p.top=f+m,p.bottom=f-m,p.right=d+h,p.left=d-h,p.near=s,p.far=o.far,p.computeCullingVolume(n.positionWC,n.directionWC,n.upWC)}(e,t,a,r,n)}var Yc=3,Xc=3,Qc=new nn.default(0,0,Yc,Xc),qc=new B.default,Zc=new G.default(0,0,0,0);jc.prototype.pick=function(e,t,a,i){Yc=Object(n.default)(a,3),Xc=Object(n.default)(i,Yc);var r=e.context,o=r.uniformState,s=e.frameState,l=e.defaultView;e.view=l;var u=l.viewport;u.x=0,u.y=0,u.width=r.drawingBufferWidth,u.height=r.drawingBufferHeight;var d=l.passState;d.viewport=nn.default.clone(u,d.viewport);var f=af.default.transformWindowToDrawingBuffer(e,t,qc);e.jobScheduler.disableThisFrame(),e.updateFrameState(),s.cullingVolume=Wc(e,f,Yc,Xc,u),s.invertClassification=!1,s.passes.pick=!0,s.tilesetPassState=Lc,o.update(s),e.updateEnvironment(),Qc.x=f.x-.5*(Yc-1),Qc.y=e.drawingBufferHeight-f.y-.5*(Xc-1),Qc.width=Yc,Qc.height=Xc,d=l.pickFramebuffer.begin(Qc,l.viewport),e.updateAndExecuteCommands(d,Zc),e.resolveFramebuffers(d);var c=l.pickFramebuffer.end(Qc);return r.endFrame(),c};var Kc=new Dn.a,Jc=new In.a,$c=new ee.a,eh=new ha.a;jc.prototype.pickPositionWorldCoordinates=function(e,t,a){if(e.useDepthPicking){var r=t.toString();if(this._pickPositionCacheDirty)this._pickPositionCache={},this._pickPositionCacheDirty=!1;else if(this._pickPositionCache.hasOwnProperty(r))return i.default.clone(this._pickPositionCache[r],a);var n=e.frameState,s=e.context,l=s.uniformState,u=e.defaultView;e.view=u;var d=af.default.transformWindowToDrawingBuffer(e,t,qc);e.pickTranslucentDepth?function(e,t){var a=e.context,i=e.frameState,r=e.environmentState,n=e.defaultView;e.view=n;var o=n.viewport;o.x=0,o.y=0,o.width=a.drawingBufferWidth,o.height=a.drawingBufferHeight;var s=n.passState;s.viewport=nn.default.clone(o,s.viewport),e.clearPasses(i.passes),i.passes.pick=!0,i.passes.depth=!0,i.cullingVolume=Wc(e,t,1,1,o),i.tilesetPassState=Lc,e.updateEnvironment(),r.renderTranslucentDepthForPick=!0,s=n.pickDepthFramebuffer.update(a,t,o),e.updateAndExecuteCommands(s,Zc),e.resolveFramebuffers(s),a.endFrame()}(e,d):(e.updateFrameState(),l.update(n),e.updateEnvironment()),d.y=e.drawingBufferHeight-d.y;var f,c=e.camera;f=Object(o.default)(c.frustum.fov)?c.frustum.clone(Kc):Object(o.default)(c.frustum.infiniteProjectionMatrix)?c.frustum.clone(Jc):Object(o.default)(c.frustum.width)?c.frustum.clone($c):c.frustum.clone(eh);for(var h=u.frustumCommandsList,m=h.length,p=0;p<m;++p){var _=this.getPickDepth(e,p).getDepth(s,d.x,d.y);if(_>0&&_<1){var g,v=h[p];return e.mode===L.a.SCENE2D?(g=c.position.z,c.position.z=g-v.near+1,f.far=Math.max(1,v.far-v.near),f.near=1,l.update(n),l.updateFrustum(f)):(f.near=v.near*(0!==p?e.opaqueFrustumNearOffset:1),f.far=v.far,l.updateFrustum(f)),a=af.default.drawingBufferToWgs84Coordinates(e,d,_,a),e.mode===L.a.SCENE2D&&(c.position.z=g,l.update(n)),this._pickPositionCache[r]=i.default.clone(a),a}}this._pickPositionCache[r]=void 0}};var th=new y.default;function ah(e,t){var a,i,r=[],n=[],s=[],l=[];Object(o.default)(e)||(e=Number.MAX_VALUE);for(var u=t();Object(o.default)(u);){var d=u.object,f=u.position,c=u.exclude;if(Object(o.default)(f)&&!Object(o.default)(d)){r.push(u);break}if(!Object(o.default)(d)||!Object(o.default)(d.primitive))break;if(!c&&(r.push(u),0>=--e))break;var h=d.primitive,m=!1;"function"==typeof h.getGeometryInstanceAttributes&&Object(o.default)(d.id)&&(i=h.getGeometryInstanceAttributes(d.id),Object(o.default)(i)&&Object(o.default)(i.show)&&(m=!0,i.show=Yd.a.toValue(!1,i.show),s.push(i))),d instanceof Xd.a&&(m=!0,d.show=!1,l.push(d)),m||(h.show=!1,n.push(h)),u=t()}for(a=0;a<n.length;++a)n[a].show=!0;for(a=0;a<s.length;++a)(i=s[a]).show=Yd.a.toValue(!0,i.show);for(a=0;a<l.length;++a)l[a].show=!0;return r}jc.prototype.pickPosition=function(e,t,a){if(a=this.pickPositionWorldCoordinates(e,t,a),Object(o.default)(a)&&e.mode!==L.a.SCENE3D){i.default.fromElements(a.y,a.z,a.x,a);var r=e.mapProjection,n=r.ellipsoid,s=r.unproject(a,th);n.cartographicToCartesian(s,a)}return a},jc.prototype.drillPick=function(e,t,a,i,r){var n=this;return ah(a,(function(){var a=n.pick(e,t,i,r);if(Object(o.default)(a))return{object:a,position:void 0,exclude:!1}})).map((function(e){return e.object}))};var ih=new i.default,rh=new i.default;function nh(e,t,a){this.ray=e,this.width=t,this.tilesets=a,this.ready=!1,this.deferred=M.default.defer(),this.promise=this.deferred.promise}function oh(e,t,a,r){var o=t.direction,s=i.default.mostOrthogonalAxis(o,ih),l=i.default.cross(o,s,ih),u=i.default.cross(o,l,rh);return r.position=t.origin,r.direction=o,r.up=u,r.right=l,r.frustum.width=Object(n.default)(a,Fc),r.frustum.computeCullingVolume(r.positionWC,r.directionWC,r.upWC)}function sh(e,t,a){var i=t.frameState,r=a.ray,n=a.width,o=a.tilesets,s=e._pickOffscreenView.camera,l=oh(0,r,n,s),u=Rc;u.camera=s,u.cullingVolume=l;for(var d=!0,f=o.length,c=0;c<f;++c){var h=o[c];h.show&&t.primitives.contains(h)&&(h.updateForPass(i,u),d=d&&u.ready)}return d&&a.deferred.resolve(),d}function lh(e,t,a,i,r,n){var s=[];if(function e(t,a,i){for(var r=t.length,n=0;n<r;++n){var s=t.get(n);s.show&&(Object(o.default)(s.isCesium3DTileset)?Object(o.default)(a)&&-1!==a.indexOf(s)||i.push(s):s instanceof tf.a&&e(s,a,i))}}(t.primitives,i,s),0===s.length)return M.default.resolve(n());var l=new nh(a,r,s);return e._mostDetailedRayPicks.push(l),l.promise.then((function(){return n()}))}function uh(e,t){return!(!Object(o.default)(e)||!Object(o.default)(t)||0===t.length)&&(t.indexOf(e)>-1||t.indexOf(e.primitive)>-1||t.indexOf(e.id)>-1)}function dh(e,t,a,i,r,n,s,l){return ah(i,(function(){return function(e,t,a,i,r,n,s){var l=t.context,u=l.uniformState,d=t.frameState,f=e._pickOffscreenView;t.view=f,oh(0,a,r,f.camera),Qc=nn.default.clone(f.viewport,Qc);var c,h=f.pickFramebuffer.begin(Qc,f.viewport);t.jobScheduler.disableThisFrame(),t.updateFrameState(),d.invertClassification=!1,d.passes.pick=!0,d.passes.offscreen=!0,d.tilesetPassState=s?Nc:Lc,u.update(d),t.updateEnvironment(),t.updateAndExecuteCommands(h,Zc),t.resolveFramebuffers(h);var m=f.pickFramebuffer.end(l);if(t.context.depthTexture)for(var p=f.frustumCommandsList.length,_=0;_<p;++_){var g=e.getPickDepth(t,_).getDepth(l,0,0);if(g>0&&g<1){var v=f.frustumCommandsList[_],y=v.near*(0!==_?t.opaqueFrustumNearOffset:1),b=y+g*(v.far-y);c=C.default.getPoint(a,b);break}}if(t.view=t.defaultView,l.endFrame(),Object(o.default)(m)||Object(o.default)(c))return{object:m,position:c,exclude:!Object(o.default)(c)&&n||uh(m,i)}}(e,t,a,r,n,s,l)}))}function fh(e,t,a,i,r,n,o){var s=dh(e,t,a,1,i,r,n,o);if(s.length>0)return s[0]}function ch(e,t,a,i,r,n,o,s){return dh(e,t,a,i,r,n,o,s)}function hh(e,t){var a=M.default.defer();return t.then((function(t){var i=e.postRender.addEventListener((function(){a.resolve(t),i()}));e.requestRender()})).otherwise((function(e){a.reject(e)})),a.promise}jc.prototype.updateMostDetailedRayPicks=function(e){for(var t=this._mostDetailedRayPicks,a=0;a<t.length;++a)sh(this,e,t[a])&&t.splice(a--,1)},jc.prototype.pickFromRay=function(e,t,a,i){return fh(this,e,t,a,i,!1,!1)},jc.prototype.drillPickFromRay=function(e,t,a,i,r){return ch(this,e,t,a,i,r,!1,!1)},jc.prototype.pickFromRayMostDetailed=function(e,t,a,i){var r=this;return t=C.default.clone(t),a=Object(o.default)(a)?a.slice():a,hh(e,lh(r,e,t,a,i,(function(){return fh(r,e,t,a,i,!1,!0)})))},jc.prototype.drillPickFromRayMostDetailed=function(e,t,a,i,r){var n=this;return t=C.default.clone(t),i=Object(o.default)(i)?i.slice():i,hh(e,lh(n,e,t,i,r,(function(){return ch(n,e,t,a,i,r,!1,!0)})))};var mh=new i.default,ph=new i.default,_h=new C.default,gh=new y.default;function vh(e,t){var a=e.globe,r=Object(o.default)(a)?a.ellipsoid:e.mapProjection.ellipsoid,n=Wd.a._defaultMaxTerrainHeight,s=r.geodeticSurfaceNormalCartographic(t,ph),l=y.default.toCartesian(t,r,mh),u=_h;u.origin=l,u.direction=s;var d=new C.default;return C.default.getPoint(u,n,d.origin),i.default.negate(s,d.direction),d}function yh(e,t){var a=e.globe,i=Object(o.default)(a)?a.ellipsoid:e.mapProjection.ellipsoid;return vh(e,y.default.fromCartesian(t,i,gh))}function bh(e,t){var a=e.globe,i=Object(o.default)(a)?a.ellipsoid:e.mapProjection.ellipsoid;return y.default.fromCartesian(t,i,gh).height}function wh(e,t,a,i,r){var n=vh(t,a);return lh(e,t,n,i,r,(function(){var a=fh(e,t,n,i,r,!0,!0);if(Object(o.default)(a))return bh(t,a.position)}))}function Oh(e,t,a,r,n,s){var l=yh(t,a);return lh(e,t,l,r,n,(function(){var a=fh(e,t,l,r,n,!0,!0);if(Object(o.default)(a))return i.default.clone(a.position,s)}))}jc.prototype.sampleHeight=function(e,t,a,i){var r=fh(this,e,vh(e,t),a,i,!0,!1);if(Object(o.default)(r))return bh(e,r.position)},jc.prototype.clampToHeight=function(e,t,a,r,n){var s=fh(this,e,yh(e,t),a,r,!0,!1);if(Object(o.default)(s))return i.default.clone(s.position,n)},jc.prototype.sampleHeightMostDetailed=function(e,t,a,i){a=Object(o.default)(a)?a.slice():a;for(var r=t.length,n=new Array(r),s=0;s<r;++s)n[s]=wh(this,e,t[s],a,i);return hh(e,M.default.all(n).then((function(e){for(var a=e.length,i=0;i<a;++i)t[i].height=e[i];return t})))},jc.prototype.clampToHeightMostDetailed=function(e,t,a,i){a=Object(o.default)(a)?a.slice():a;for(var r=t.length,n=new Array(r),s=0;s<r;++s)n[s]=Oh(this,e,t[s],a,i,t[s]);return hh(e,M.default.all(n).then((function(e){for(var a=e.length,i=0;i<a;++i)t[i]=e[i];return t})))},jc.prototype.destroy=function(){this._pickOffscreenView=this._pickOffscreenView&&this._pickOffscreenView.destroy()};var xh=jc,Ch=a(187),Th="#define SAMPLES 8\n\nuniform float delta;\nuniform float sigma;\nuniform float direction; // 0.0 for x direction, 1.0 for y direction\n\nuniform sampler2D colorTexture;\n\n#ifdef USE_STEP_SIZE\nuniform float stepSize;\n#else\nuniform vec2 step;\n#endif\n\nvarying vec2 v_textureCoordinates;\n\n//  Incremental Computation of the Gaussian:\n//  https://developer.nvidia.com/gpugems/GPUGems3/gpugems3_ch40.html\n\nvoid main()\n{\n    vec2 st = v_textureCoordinates;\n    vec2 dir = vec2(1.0 - direction, direction);\n\n#ifdef USE_STEP_SIZE\n    vec2 step = vec2(stepSize * (czm_pixelRatio / czm_viewport.zw));\n#else\n    vec2 step = step;\n#endif\n\n    vec3 g;\n    g.x = 1.0 / (sqrt(czm_twoPi) * sigma);\n    g.y = exp((-0.5 * delta * delta) / (sigma * sigma));\n    g.z = g.y * g.y;\n\n    vec4 result = texture2D(colorTexture, st) * g.x;\n    for (int i = 1; i < SAMPLES; ++i)\n    {\n        g.xy *= g.yz;\n\n        vec2 offset = float(i) * dir * step;\n        result += texture2D(colorTexture, st - offset) * g.x;\n        result += texture2D(colorTexture, st + offset) * g.x;\n    }\n\n    gl_FragColor = result;\n}\n";function Eh(){this._uniformMap=void 0,this._command=void 0,this._colorTexture=void 0,this._depthTexture=void 0,this._ready=!1,this._name="czm_autoexposure",this._logDepthChanged=void 0,this._useLogDepth=void 0,this._framebuffers=void 0,this._previousLuminance=void 0,this._commands=void 0,this._clearCommand=void 0,this._minMaxLuminance=new B.default,this.enabled=!0,this._enabled=!0,this.minimumLuminance=.1,this.maximumLuminance=10}function Ah(e){var t=e._framebuffers;if(Object(o.default)(t)){for(var a=t.length,i=0;i<a;++i)t[i].destroy();e._framebuffers=void 0,e._previousLuminance.destroy(),e._previousLuminance=void 0}}function Sh(e){var t=e._commands;if(Object(o.default)(t)){for(var a=t.length,i=0;i<a;++i)t[i].shaderProgram.destroy();e._commands=void 0}}function Ph(e,t){var a;if(0===t)a={colorTexture:function(){return e._colorTexture},colorTextureDimensions:function(){return e._colorTexture.dimensions}};else{var i=e._framebuffers[t-1].getColorTexture(0);a={colorTexture:function(){return i},colorTextureDimensions:function(){return i.dimensions}}}return a.minMaxLuminance=function(){return e._minMaxLuminance},a.previousLuminance=function(){return e._previousLuminance.getColorTexture(0)},a}function Dh(e,t){var a="uniform sampler2D colorTexture; \nvarying vec2 v_textureCoordinates; \nfloat sampleTexture(vec2 offset) { \n";return a+=0===e?"    vec4 color = texture2D(colorTexture, v_textureCoordinates + offset); \n    return czm_luminance(color.rgb); \n":"    return texture2D(colorTexture, v_textureCoordinates + offset).r; \n",a+="}\n\n",a+="uniform vec2 colorTextureDimensions; \nuniform vec2 minMaxLuminance; \nuniform sampler2D previousLuminance; \nvoid main() { \n    float color = 0.0; \n    float xStep = 1.0 / colorTextureDimensions.x; \n    float yStep = 1.0 / colorTextureDimensions.y; \n    int count = 0; \n    for (int i = 0; i < 3; ++i) { \n        for (int j = 0; j < 3; ++j) { \n            vec2 offset; \n            offset.x = -xStep + float(i) * xStep; \n            offset.y = -yStep + float(j) * yStep; \n            if (offset.x < 0.0 || offset.x > 1.0 || offset.y < 0.0 || offset.y > 1.0) { \n                continue; \n            } \n            color += sampleTexture(offset); \n            ++count; \n        } \n    } \n    if (count > 0) { \n        color /= float(count); \n    } \n",e===t-1&&(a+="    float previous = texture2D(previousLuminance, vec2(0.5)).r; \n    color = clamp(color, minMaxLuminance.x, minMaxLuminance.y); \n    color = previous + (color - previous) / (60.0 * 1.5); \n    color = clamp(color, minMaxLuminance.x, minMaxLuminance.y); \n"),a+="    gl_FragColor = vec4(color); \n} \n"}Object(s.default)(Eh.prototype,{ready:{get:function(){return this._ready}},name:{get:function(){return this._name}},outputTexture:{get:function(){var e=this._framebuffers;if(Object(o.default)(e))return e[e.length-1].getColorTexture(0)}}}),Eh.prototype.clear=function(e){var t=this._framebuffers;if(Object(o.default)(t)){var a=this._clearCommand;Object(o.default)(a)||(a=this._clearCommand=new Rn.a({color:new G.default(0,0,0,0),framebuffer:void 0}));for(var i=t.length,r=0;r<i;++r)a.framebuffer=t[r],a.execute(e)}},Eh.prototype.update=function(e){var t=e.drawingBufferWidth,a=e.drawingBufferHeight;t===this._width&&a===this._height||(this._width=t,this._height=a,function(e,t){Ah(e);for(var a=e._width,i=e._height,r=_e.a.RGBA,n=t.halfFloatingPointTexture?we.a.HALF_FLOAT:we.a.FLOAT,o=new Oe.a({wrapS:Te.a.CLAMP_TO_EDGE,wrapT:Te.a.CLAMP_TO_EDGE,minificationFilter:Ce.a.NEAREST,magnificationFilter:xe.a.NEAREST}),s=Math.ceil(Math.log(Math.max(a,i))/Math.log(3)),l=new Array(s),u=0;u<s;++u)a=Math.max(Math.ceil(a/3),1),i=Math.max(Math.ceil(i/3),1),l[u]=new Ln.a({context:t,colorTextures:[new S.a({context:t,width:a,height:i,pixelFormat:r,pixelDatatype:n,sampler:o})]});var d=l[s-1].getColorTexture(0);e._previousLuminance=new Ln.a({context:t,colorTextures:[new S.a({context:t,width:d.width,height:d.height,pixelFormat:r,pixelDatatype:n,sampler:o})]}),e._framebuffers=l}(this,e),function(e,t){Sh(e);for(var a=e._framebuffers,i=a.length,r=new Array(i),n=0;n<i;++n)r[n]=t.createViewportQuadCommand(Dh(n,i),{framebuffer:a[n],uniformMap:Ph(e,n)});e._commands=r}(this,e),this._ready||(this._ready=!0)),this._minMaxLuminance.x=this.minimumLuminance,this._minMaxLuminance.y=this.maximumLuminance;var i=this._framebuffers,r=i[i.length-1];i[i.length-1]=this._previousLuminance,this._commands[this._commands.length-1].framebuffer=this._previousLuminance,this._previousLuminance=r},Eh.prototype.execute=function(e,t){this._colorTexture=t;var a=this._commands;if(Object(o.default)(a))for(var i=a.length,r=0;r<i;++r)a[r].execute(e)},Eh.prototype.isDestroyed=function(){return!1},Eh.prototype.destroy=function(){return Ah(this),Sh(this),Object(l.default)(this)};var Ih=Eh,Mh={NEAREST:0,LINEAR:1};function Fh(e){var t=(e=Object(n.default)(e,n.default.EMPTY_OBJECT)).fragmentShader,a=Object(n.default)(e.textureScale,1),i=Object(n.default)(e.pixelFormat,_e.a.RGBA);this._fragmentShader=t,this._uniforms=e.uniforms,this._textureScale=a,this._forcePowerOfTwo=Object(n.default)(e.forcePowerOfTwo,!1),this._sampleMode=Object(n.default)(e.sampleMode,Mh.NEAREST),this._pixelFormat=i,this._pixelDatatype=Object(n.default)(e.pixelDatatype,we.a.UNSIGNED_BYTE),this._clearColor=Object(n.default)(e.clearColor,G.default.BLACK),this._uniformMap=void 0,this._command=void 0,this._colorTexture=void 0,this._depthTexture=void 0,this._idTexture=void 0,this._actualUniforms={},this._dirtyUniforms=[],this._texturesToRelease=[],this._texturesToCreate=[],this._texturePromise=void 0;var r=new Kn;r.scissorTest={enabled:!0,rectangle:Object(o.default)(e.scissorRectangle)?nn.default.clone(e.scissorRectangle):new nn.default},this._passState=r,this._ready=!1;var s=e.name;Object(o.default)(s)||(s=Object(on.default)()),this._name=s,this._logDepthChanged=void 0,this._useLogDepth=void 0,this._selectedIdTexture=void 0,this._selected=void 0,this._selectedShadow=void 0,this._parentSelected=void 0,this._parentSelectedShadow=void 0,this._combinedSelected=void 0,this._combinedSelectedShadow=void 0,this._selectedLength=0,this._parentSelectedLength=0,this._selectedDirty=!0,this._textureCache=void 0,this._index=void 0,this.enabled=!0,this._enabled=!0}Object(s.default)(Fh.prototype,{ready:{get:function(){return this._ready}},name:{get:function(){return this._name}},fragmentShader:{get:function(){return this._fragmentShader}},uniforms:{get:function(){return this._uniforms}},textureScale:{get:function(){return this._textureScale}},forcePowerOfTwo:{get:function(){return this._forcePowerOfTwo}},sampleMode:{get:function(){return this._sampleMode}},pixelFormat:{get:function(){return this._pixelFormat}},pixelDatatype:{get:function(){return this._pixelDatatype}},clearColor:{get:function(){return this._clearColor}},scissorRectangle:{get:function(){return this._passState.scissorTest.rectangle}},outputTexture:{get:function(){if(Object(o.default)(this._textureCache)){var e=this._textureCache.getFramebuffer(this._name);if(Object(o.default)(e))return e.getColorTexture(0)}}},selected:{get:function(){return this._selected},set:function(e){this._selected=e}},parentSelected:{get:function(){return this._parentSelected},set:function(e){this._parentSelected=e}}});var Rh=/uniform\s+sampler2D\s+depthTexture/g;function Nh(e,t,a){var i=t[a];return("string"==typeof i||i instanceof HTMLCanvasElement||i instanceof HTMLImageElement||i instanceof HTMLVideoElement||i instanceof ImageData)&&e._dirtyUniforms.push(a),{get:function(){return t[a]},set:function(i){var r=t[a];t[a]=i;var n=e._actualUniforms,s=n[a];Object(o.default)(s)&&s!==r&&s instanceof S.a&&!Object(o.default)(e._textureCache.getStageByName(a))&&(e._texturesToRelease.push(s),delete n[a],delete n[a+"Dimensions"]),r instanceof S.a&&e._texturesToRelease.push(r),"string"==typeof i||i instanceof HTMLCanvasElement||i instanceof HTMLImageElement||i instanceof HTMLVideoElement||i instanceof ImageData?e._dirtyUniforms.push(a):n[a]=i}}}function Lh(e,t){return function(){var a=e._actualUniforms[t];return"function"==typeof a?a():a}}function jh(e,t){return function(){var a=e[t]();if(Object(o.default)(a))return a.dimensions}}function Vh(e,t){return function(a){e._texturesToCreate.push({name:t,source:a})}}function Uh(e,t){return function(){return e._textureCache.getOutputTexture(t)}}function zh(e){Object(o.default)(e._command)&&(e._command.shaderProgram=e._command.shaderProgram&&e._command.shaderProgram.destroy(),e._command=void 0),e._selectedIdTexture=e._selectedIdTexture&&e._selectedIdTexture.destroy();var t=e._textureCache;if(Object(o.default)(t)){var a=e._uniforms,i=e._actualUniforms;for(var r in i)i.hasOwnProperty(r)&&i[r]instanceof S.a&&(Object(o.default)(t.getStageByName(a[r]))||i[r].destroy(),e._dirtyUniforms.push(r))}}Fh.prototype._isSupported=function(e){return!Rh.test(this._fragmentShader)||e.depthTexture},Fh.prototype.update=function(e,t){if(this.enabled===this._enabled||this.enabled||zh(this),this._enabled=this.enabled,this._enabled&&(this._logDepthChanged=t!==this._useLogDepth,this._useLogDepth=t,this._selectedDirty=function(e){var t=Object(o.default)(e._selected)?e._selected.length:0,a=Object(o.default)(e._parentSelected)?e._parentSelected:0,i=e._selected!==e._selectedShadow||t!==e._selectedLength;if(i=i||e._parentSelected!==e._parentSelectedShadow||a!==e._parentSelectedLength,Object(o.default)(e._selected)&&Object(o.default)(e._parentSelected)?e._combinedSelected=e._selected.concat(e._parentSelected):Object(o.default)(e._parentSelected)?e._combinedSelected=e._parentSelected:e._combinedSelected=e._selected,!i&&Object(o.default)(e._combinedSelected)){if(!Object(o.default)(e._combinedSelectedShadow))return!0;t=e._combinedSelected.length;for(var r=0;r<t;++r)if(e._combinedSelected[r]!==e._combinedSelectedShadow[r])return!0}return i}(this),this._selectedShadow=this._selected,this._parentSelectedShadow=this._parentSelected,this._combinedSelectedShadow=this._combinedSelected,this._selectedLength=Object(o.default)(this._selected)?this._selected.length:0,this._parentSelectedLength=Object(o.default)(this._parentSelected)?this._parentSelected.length:0,function(e,t){if(e._selectedDirty){e._selectedIdTexture=e._selectedIdTexture&&e._selectedIdTexture.destroy(),e._selectedIdTexture=void 0;var a=e._combinedSelected;if(Object(o.default)(a)){var i,r,n,s=0,l=a.length;for(i=0;i<l;++i)r=a[i],Object(o.default)(r.pickIds)?s+=r.pickIds.length:Object(o.default)(r.pickId)&&++s;if(0===l||0===s){var u=new Uint8Array(4);return u[0]=255,u[1]=255,u[2]=255,u[3]=255,void(e._selectedIdTexture=new S.a({context:t,pixelFormat:_e.a.RGBA,pixelDatatype:we.a.UNSIGNED_BYTE,source:{arrayBufferView:u,width:1,height:1},sampler:new Oe.a({wrapS:Te.a.CLAMP_TO_EDGE,wrapT:Te.a.CLAMP_TO_EDGE,minificationFilter:Ce.a.NEAREST,magnificationFilter:xe.a.NEAREST})}))}var d=0,f=new Uint8Array(4*s);for(i=0;i<l;++i)if(r=a[i],Object(o.default)(r.pickIds))for(var c=r.pickIds,h=c.length,m=0;m<h;++m)n=c[m].color,f[d]=G.default.floatToByte(n.red),f[d+1]=G.default.floatToByte(n.green),f[d+2]=G.default.floatToByte(n.blue),f[d+3]=G.default.floatToByte(n.alpha),d+=4;else Object(o.default)(r.pickId)&&(n=r.pickId.color,f[d]=G.default.floatToByte(n.red),f[d+1]=G.default.floatToByte(n.green),f[d+2]=G.default.floatToByte(n.blue),f[d+3]=G.default.floatToByte(n.alpha),d+=4);e._selectedIdTexture=new S.a({context:t,pixelFormat:_e.a.RGBA,pixelDatatype:we.a.UNSIGNED_BYTE,source:{arrayBufferView:f,width:s,height:1},sampler:new Oe.a({wrapS:Te.a.CLAMP_TO_EDGE,wrapT:Te.a.CLAMP_TO_EDGE,minificationFilter:Ce.a.NEAREST,magnificationFilter:xe.a.NEAREST})})}}}(this,e),function(e){if(!Object(o.default)(e._uniformMap)){var t={},a={},i=e._uniforms,r=e._actualUniforms;for(var n in i)if(i.hasOwnProperty(n)){"function"!=typeof i[n]?(t[n]=Lh(e,n),a[n]=Nh(e,i,n)):(t[n]=i[n],a[n]=i[n]),r[n]=i[n];var l=t[n]();("string"==typeof l||l instanceof S.a||l instanceof HTMLImageElement||l instanceof HTMLCanvasElement||l instanceof HTMLVideoElement)&&(t[n+"Dimensions"]=jh(t,n))}e._uniforms={},Object(s.default)(e._uniforms,a),e._uniformMap=Object(Y.default)(t,{colorTexture:function(){return e._colorTexture},colorTextureDimensions:function(){return e._colorTexture.dimensions},depthTexture:function(){return e._depthTexture},depthTextureDimensions:function(){return e._depthTexture.dimensions},czm_idTexture:function(){return e._idTexture},czm_selectedIdTexture:function(){return e._selectedIdTexture},czm_selectedIdTextureStep:function(){return 1/e._selectedIdTexture.width}})}}(this),function(e,t){var a,i,r,n=e._texturesToRelease,s=n.length;for(a=0;a<s;++a)i=(i=n[a])&&i.destroy();n.length=0;var l=e._texturesToCreate;for(s=l.length,a=0;a<s;++a){var u=l[a];r=u.name;var d=u.source;e._actualUniforms[r]=new S.a({context:t,source:d})}l.length=0;var f=e._dirtyUniforms;if(0!==f.length||Object(o.default)(e._texturePromise)){if(0!==f.length&&!Object(o.default)(e._texturePromise)){s=f.length;var c=e._uniforms,h=[];for(a=0;a<s;++a){var m=c[r=f[a]],p=e._textureCache.getStageByName(m);if(Object(o.default)(p))e._actualUniforms[r]=Uh(e,m);else if("string"==typeof m){var _=new E.default({url:m});h.push(_.fetchImage().then(Vh(e,r)))}else e._texturesToCreate.push({name:r,source:m})}f.length=0,h.length>0?(e._ready=!1,e._texturePromise=M.default.all(h).then((function(){e._ready=!0,e._texturePromise=void 0}))):e._ready=!0}}else e._ready=!0}(this,e),function(e,t){if(!Object(o.default)(e._command)||e._logDepthChanged||e._selectedDirty){var a=e._fragmentShader;if(Object(o.default)(e._selectedIdTexture))a="#define CZM_SELECTED_FEATURE \nuniform sampler2D czm_idTexture; \nuniform sampler2D czm_selectedIdTexture; \nuniform float czm_selectedIdTextureStep; \nvarying vec2 v_textureCoordinates; \nbool czm_selected(vec2 offset) \n{ \n    bool selected = false;\n    vec4 id = texture2D(czm_idTexture, v_textureCoordinates + offset); \n    for (int i = 0; i < "+e._selectedIdTexture.width+"; ++i) \n    { \n        vec4 selectedId = texture2D(czm_selectedIdTexture, vec2((float(i) + 0.5) * czm_selectedIdTextureStep, 0.5)); \n        if (all(equal(id, selectedId))) \n        { \n            return true; \n        } \n    } \n    return false; \n} \n\nbool czm_selected() \n{ \n    return czm_selected(vec2(0.0)); \n} \n\n"+(a=a.replace(/varying\s+vec2\s+v_textureCoordinates;/g,""));var i=new A.a({defines:[e._useLogDepth?"LOG_DEPTH":""],sources:[a]});e._command=t.createViewportQuadCommand(i,{uniformMap:e._uniformMap,owner:e})}}(this,e),function(e){var t,a;e._sampleMode===Mh.LINEAR?(t=Ce.a.LINEAR,a=xe.a.LINEAR):(t=Ce.a.NEAREST,a=xe.a.NEAREST);var i=e._sampler;Object(o.default)(i)&&i.minificationFilter===t&&i.magnificationFilter===a||(e._sampler=new Oe.a({wrapS:Te.a.CLAMP_TO_EDGE,wrapT:Te.a.CLAMP_TO_EDGE,minificationFilter:t,magnificationFilter:a}))}(this),this._selectedDirty=!1,this._ready)){var a=this._textureCache.getFramebuffer(this._name);if(this._command.framebuffer=a,Object(o.default)(a)){var i,r=a.getColorTexture(0);r.width===e.drawingBufferWidth&&r.height===e.drawingBufferHeight||(i=this._renderState,Object(o.default)(i)&&r.width===i.viewport.width&&r.height===i.viewport.height||(this._renderState=fe.a.fromCache({viewport:new nn.default(0,0,r.width,r.height)}))),this._command.renderState=i}}},Fh.prototype.execute=function(e,t,a,i){if(Object(o.default)(this._command)&&Object(o.default)(this._command.framebuffer)&&this._ready&&this._enabled){this._colorTexture=t,this._depthTexture=a,this._idTexture=i,Oe.a.equals(this._colorTexture.sampler,this._sampler)||(this._colorTexture.sampler=this._sampler);var r=this.scissorRectangle.width>0&&this.scissorRectangle.height>0?this._passState:void 0;Object(o.default)(r)&&(r.context=e),this._command.execute(e,r)}},Fh.prototype.isDestroyed=function(){return!1},Fh.prototype.destroy=function(){return zh(this),Object(l.default)(this)};var Bh=Fh;function Hh(e){e=Object(n.default)(e,n.default.EMPTY_OBJECT),this._stages=e.stages,this._inputPreviousStageTexture=Object(n.default)(e.inputPreviousStageTexture,!0);var t=e.name;Object(o.default)(t)||(t=Object(on.default)()),this._name=t,this._uniforms=e.uniforms,this._textureCache=void 0,this._index=void 0,this._selected=void 0,this._selectedShadow=void 0,this._parentSelected=void 0,this._parentSelectedShadow=void 0,this._combinedSelected=void 0,this._combinedSelectedShadow=void 0,this._selectedLength=0,this._parentSelectedLength=0,this._selectedDirty=!0}Object(s.default)(Hh.prototype,{ready:{get:function(){for(var e=this._stages,t=e.length,a=0;a<t;++a)if(!e[a].ready)return!1;return!0}},name:{get:function(){return this._name}},enabled:{get:function(){return this._stages[0].enabled},set:function(e){for(var t=this._stages,a=t.length,i=0;i<a;++i)t[i].enabled=e}},uniforms:{get:function(){return this._uniforms}},inputPreviousStageTexture:{get:function(){return this._inputPreviousStageTexture}},length:{get:function(){return this._stages.length}},selected:{get:function(){return this._selected},set:function(e){this._selected=e}},parentSelected:{get:function(){return this._parentSelected},set:function(e){this._parentSelected=e}}}),Hh.prototype._isSupported=function(e){for(var t=this._stages,a=t.length,i=0;i<a;++i)if(!t[i]._isSupported(e))return!1;return!0},Hh.prototype.get=function(e){return this._stages[e]},Hh.prototype.update=function(e,t){this._selectedDirty=function(e){var t=Object(o.default)(e._selected)?e._selected.length:0,a=Object(o.default)(e._parentSelected)?e._parentSelected:0,i=e._selected!==e._selectedShadow||t!==e._selectedLength;if(i=i||e._parentSelected!==e._parentSelectedShadow||a!==e._parentSelectedLength,Object(o.default)(e._selected)&&Object(o.default)(e._parentSelected)?e._combinedSelected=e._selected.concat(e._parentSelected):Object(o.default)(e._parentSelected)?e._combinedSelected=e._parentSelected:e._combinedSelected=e._selected,!i&&Object(o.default)(e._combinedSelected)){if(!Object(o.default)(e._combinedSelectedShadow))return!0;t=e._combinedSelected.length;for(var r=0;r<t;++r)if(e._combinedSelected[r]!==e._combinedSelectedShadow[r])return!0}return i}(this),this._selectedShadow=this._selected,this._parentSelectedShadow=this._parentSelected,this._combinedSelectedShadow=this._combinedSelected,this._selectedLength=Object(o.default)(this._selected)?this._selected.length:0,this._parentSelectedLength=Object(o.default)(this._parentSelected)?this._parentSelected.length:0;for(var a=this._stages,i=a.length,r=0;r<i;++r){var n=a[r];this._selectedDirty&&(n.parentSelected=this._combinedSelected),n.update(e,t)}},Hh.prototype.isDestroyed=function(){return!1},Hh.prototype.destroy=function(){for(var e=this._stages,t=e.length,a=0;a<t;++a)e[a].destroy();return Object(l.default)(this)};var kh=Hh,Gh={};function Wh(e){var t="#define USE_STEP_SIZE\n"+Th,a=new Bh({name:e+"_x_direction",fragmentShader:t,uniforms:{delta:1,sigma:2,stepSize:1,direction:0},sampleMode:Mh.LINEAR}),i=new Bh({name:e+"_y_direction",fragmentShader:t,uniforms:{delta:1,sigma:2,stepSize:1,direction:1},sampleMode:Mh.LINEAR}),r={};return Object(s.default)(r,{delta:{get:function(){return a.uniforms.delta},set:function(e){var t=a.uniforms,r=i.uniforms;t.delta=r.delta=e}},sigma:{get:function(){return a.uniforms.sigma},set:function(e){var t=a.uniforms,r=i.uniforms;t.sigma=r.sigma=e}},stepSize:{get:function(){return a.uniforms.stepSize},set:function(e){var t=a.uniforms,r=i.uniforms;t.stepSize=r.stepSize=e}}}),new kh({name:e,stages:[a,i],uniforms:r})}Gh.createBlurStage=function(){return Wh("czm_blur")},Gh.createDepthOfFieldStage=function(){var e=Wh("czm_depth_of_field_blur"),t=new Bh({name:"czm_depth_of_field_composite",fragmentShader:"uniform sampler2D colorTexture;\nuniform sampler2D blurTexture;\nuniform sampler2D depthTexture;\nuniform float focalDistance;\n\nvarying vec2 v_textureCoordinates;\n\nvec4 toEye(vec2 uv, float depth)\n{\n   vec2 xy = vec2((uv.x * 2.0 - 1.0), ((1.0 - uv.y) * 2.0 - 1.0));\n   vec4 posInCamera = czm_inverseProjection * vec4(xy, depth, 1.0);\n   posInCamera = posInCamera / posInCamera.w;\n   return posInCamera;\n}\n\nfloat computeDepthBlur(float depth)\n{\n    float f;\n    if (depth < focalDistance)\n    {\n        f = (focalDistance - depth) / (focalDistance - czm_currentFrustum.x);\n    }\n    else\n    {\n        f = (depth - focalDistance) / (czm_currentFrustum.y - focalDistance);\n        f = pow(f, 0.1);\n    }\n    f *= f;\n    f = clamp(f, 0.0, 1.0);\n    return pow(f, 0.5);\n}\n\nvoid main(void)\n{\n    float depth = czm_readDepth(depthTexture, v_textureCoordinates);\n    vec4 posInCamera = toEye(v_textureCoordinates, depth);\n    float d = computeDepthBlur(-posInCamera.z);\n    gl_FragColor = mix(texture2D(colorTexture, v_textureCoordinates), texture2D(blurTexture, v_textureCoordinates), d);\n}\n",uniforms:{focalDistance:5,blurTexture:e.name}}),a={};return Object(s.default)(a,{focalDistance:{get:function(){return t.uniforms.focalDistance},set:function(e){t.uniforms.focalDistance=e}},delta:{get:function(){return e.uniforms.delta},set:function(t){e.uniforms.delta=t}},sigma:{get:function(){return e.uniforms.sigma},set:function(t){e.uniforms.sigma=t}},stepSize:{get:function(){return e.uniforms.stepSize},set:function(t){e.uniforms.stepSize=t}}}),new kh({name:"czm_depth_of_field",stages:[e,t],inputPreviousStageTexture:!1,uniforms:a})},Gh.isDepthOfFieldSupported=function(e){return e.context.depthTexture},Gh.createEdgeDetectionStage=function(){var e=Object(on.default)();return new Bh({name:"czm_edge_detection_"+e,fragmentShader:"uniform sampler2D depthTexture;\nuniform float length;\nuniform vec4 color;\n\nvarying vec2 v_textureCoordinates;\n\nvoid main(void)\n{\n    float directions[3];\n    directions[0] = -1.0;\n    directions[1] = 0.0;\n    directions[2] = 1.0;\n\n    float scalars[3];\n    scalars[0] = 3.0;\n    scalars[1] = 10.0;\n    scalars[2] = 3.0;\n\n    float padx = czm_pixelRatio / czm_viewport.z;\n    float pady = czm_pixelRatio / czm_viewport.w;\n\n#ifdef CZM_SELECTED_FEATURE\n    bool selected = false;\n    for (int i = 0; i < 3; ++i)\n    {\n        float dir = directions[i];\n        selected = selected || czm_selected(vec2(-padx, dir * pady));\n        selected = selected || czm_selected(vec2(padx, dir * pady));\n        selected = selected || czm_selected(vec2(dir * padx, -pady));\n        selected = selected || czm_selected(vec2(dir * padx, pady));\n        if (selected)\n        {\n            break;\n        }\n    }\n    if (!selected)\n    {\n        gl_FragColor = vec4(color.rgb, 0.0);\n        return;\n    }\n#endif\n\n    float horizEdge = 0.0;\n    float vertEdge = 0.0;\n\n    for (int i = 0; i < 3; ++i)\n    {\n        float dir = directions[i];\n        float scale = scalars[i];\n\n        horizEdge -= texture2D(depthTexture, v_textureCoordinates + vec2(-padx, dir * pady)).x * scale;\n        horizEdge += texture2D(depthTexture, v_textureCoordinates + vec2(padx, dir * pady)).x * scale;\n\n        vertEdge -= texture2D(depthTexture, v_textureCoordinates + vec2(dir * padx, -pady)).x * scale;\n        vertEdge += texture2D(depthTexture, v_textureCoordinates + vec2(dir * padx, pady)).x * scale;\n    }\n\n    float len = sqrt(horizEdge * horizEdge + vertEdge * vertEdge);\n    gl_FragColor = vec4(color.rgb, len > length ? color.a : 0.0);\n}\n",uniforms:{length:.25,color:G.default.clone(G.default.BLACK)}})},Gh.isEdgeDetectionSupported=function(e){return e.context.depthTexture},Gh.createSilhouetteStage=function(e){var t=function(e){if(!Object(o.default)(e))return Gh.createEdgeDetectionStage();for(var t=new kh({name:"czm_edge_detection_multiple",stages:e,inputPreviousStageTexture:!1}),a={},i="",r="",n=0;n<e.length;++n)i+="uniform sampler2D edgeTexture"+n+"; \n",r+="        vec4 edge"+n+" = texture2D(edgeTexture"+n+", v_textureCoordinates); \n        if (edge"+n+".a > 0.0) \n        { \n            color = edge"+n+"; \n            break; \n        } \n",a["edgeTexture"+n]=e[n].name;var s=i+"varying vec2 v_textureCoordinates; \nvoid main() { \n    vec4 color = vec4(0.0); \n    for (int i = 0; i < "+e.length+"; i++) \n    { \n"+r+"    } \n    gl_FragColor = color; \n} \n",l=new Bh({name:"czm_edge_detection_combine",fragmentShader:s,uniforms:a});return new kh({name:"czm_edge_detection_composite",stages:[t,l]})}(e),a=new Bh({name:"czm_silhouette_color_edges",fragmentShader:"uniform sampler2D colorTexture;\nuniform sampler2D silhouetteTexture;\n\nvarying vec2 v_textureCoordinates;\n\nvoid main(void)\n{\n    vec4 silhouetteColor = texture2D(silhouetteTexture, v_textureCoordinates);\n    vec4 color = texture2D(colorTexture, v_textureCoordinates);\n    gl_FragColor = mix(color, silhouetteColor, silhouetteColor.a);\n}\n",uniforms:{silhouetteTexture:t.name}});return new kh({name:"czm_silhouette",stages:[t,a],inputPreviousStageTexture:!1,uniforms:t.uniforms})},Gh.isSilhouetteSupported=function(e){return e.context.depthTexture},Gh.createBloomStage=function(){var e=new Bh({name:"czm_bloom_contrast_bias",fragmentShader:"uniform sampler2D colorTexture;\nuniform float contrast;\nuniform float brightness;\n\nvarying vec2 v_textureCoordinates;\n\nvoid main(void)\n{\n    vec3 sceneColor = texture2D(colorTexture, v_textureCoordinates).xyz;\n    sceneColor = czm_RGBToHSB(sceneColor);\n    sceneColor.z += brightness;\n    sceneColor = czm_HSBToRGB(sceneColor);\n\n    float factor = (259.0 * (contrast + 255.0)) / (255.0 * (259.0 - contrast));\n    sceneColor = factor * (sceneColor - vec3(0.5)) + vec3(0.5);\n    gl_FragColor = vec4(sceneColor, 1.0);\n}\n",uniforms:{contrast:128,brightness:-.3}}),t=Wh("czm_bloom_blur"),a=new kh({name:"czm_bloom_contrast_bias_blur",stages:[e,t]}),i=new Bh({name:"czm_bloom_generate_composite",fragmentShader:"uniform sampler2D colorTexture;\nuniform sampler2D bloomTexture;\nuniform bool glowOnly;\n\nvarying vec2 v_textureCoordinates;\n\nvoid main(void)\n{\n    vec4 color = texture2D(colorTexture, v_textureCoordinates);\n\n#ifdef CZM_SELECTED_FEATURE\n    if (czm_selected()) {\n        gl_FragColor = color;\n        return;\n    }\n#endif\n\n    vec4 bloom = texture2D(bloomTexture, v_textureCoordinates);\n    gl_FragColor = glowOnly ? bloom : bloom + color;\n}\n",uniforms:{glowOnly:!1,bloomTexture:a.name}}),r={};return Object(s.default)(r,{glowOnly:{get:function(){return i.uniforms.glowOnly},set:function(e){i.uniforms.glowOnly=e}},contrast:{get:function(){return e.uniforms.contrast},set:function(t){e.uniforms.contrast=t}},brightness:{get:function(){return e.uniforms.brightness},set:function(t){e.uniforms.brightness=t}},delta:{get:function(){return t.uniforms.delta},set:function(e){t.uniforms.delta=e}},sigma:{get:function(){return t.uniforms.sigma},set:function(e){t.uniforms.sigma=e}},stepSize:{get:function(){return t.uniforms.stepSize},set:function(e){t.uniforms.stepSize=e}}}),new kh({name:"czm_bloom",stages:[a,i],inputPreviousStageTexture:!1,uniforms:r})},Gh.createAmbientOcclusionStage=function(){var e=new Bh({name:"czm_ambient_occlusion_generate",fragmentShader:"uniform sampler2D randomTexture;\nuniform sampler2D depthTexture;\nuniform float intensity;\nuniform float bias;\nuniform float lengthCap;\nuniform float stepSize;\nuniform float frustumLength;\n\nvarying vec2 v_textureCoordinates;\n\nvec4 clipToEye(vec2 uv, float depth)\n{\n    vec2 xy = vec2((uv.x * 2.0 - 1.0), ((1.0 - uv.y) * 2.0 - 1.0));\n    vec4 posEC = czm_inverseProjection * vec4(xy, depth, 1.0);\n    posEC = posEC / posEC.w;\n    return posEC;\n}\n\n//Reconstruct Normal Without Edge Removation\nvec3 getNormalXEdge(vec3 posInCamera, float depthU, float depthD, float depthL, float depthR, vec2 pixelSize)\n{\n    vec4 posInCameraUp = clipToEye(v_textureCoordinates - vec2(0.0, pixelSize.y), depthU);\n    vec4 posInCameraDown = clipToEye(v_textureCoordinates + vec2(0.0, pixelSize.y), depthD);\n    vec4 posInCameraLeft = clipToEye(v_textureCoordinates - vec2(pixelSize.x, 0.0), depthL);\n    vec4 posInCameraRight = clipToEye(v_textureCoordinates + vec2(pixelSize.x, 0.0), depthR);\n\n    vec3 up = posInCamera.xyz - posInCameraUp.xyz;\n    vec3 down = posInCameraDown.xyz - posInCamera.xyz;\n    vec3 left = posInCamera.xyz - posInCameraLeft.xyz;\n    vec3 right = posInCameraRight.xyz - posInCamera.xyz;\n\n    vec3 DX = length(left) < length(right) ? left : right;\n    vec3 DY = length(up) < length(down) ? up : down;\n\n    return normalize(cross(DY, DX));\n}\n\nvoid main(void)\n{\n    float depth = czm_readDepth(depthTexture, v_textureCoordinates);\n    vec4 posInCamera = clipToEye(v_textureCoordinates, depth);\n\n    if (posInCamera.z > frustumLength)\n    {\n        gl_FragColor = vec4(1.0);\n        return;\n    }\n\n    vec2 pixelSize = czm_pixelRatio / czm_viewport.zw;\n    float depthU = czm_readDepth(depthTexture, v_textureCoordinates - vec2(0.0, pixelSize.y));\n    float depthD = czm_readDepth(depthTexture, v_textureCoordinates + vec2(0.0, pixelSize.y));\n    float depthL = czm_readDepth(depthTexture, v_textureCoordinates - vec2(pixelSize.x, 0.0));\n    float depthR = czm_readDepth(depthTexture, v_textureCoordinates + vec2(pixelSize.x, 0.0));\n    vec3 normalInCamera = getNormalXEdge(posInCamera.xyz, depthU, depthD, depthL, depthR, pixelSize);\n\n    float ao = 0.0;\n    vec2 sampleDirection = vec2(1.0, 0.0);\n    float gapAngle = 90.0 * czm_radiansPerDegree;\n\n    // RandomNoise\n    float randomVal = texture2D(randomTexture, v_textureCoordinates).x;\n\n    //Loop for each direction\n    for (int i = 0; i < 4; i++)\n    {\n        float newGapAngle = gapAngle * (float(i) + randomVal);\n        float cosVal = cos(newGapAngle);\n        float sinVal = sin(newGapAngle);\n\n        //Rotate Sampling Direction\n        vec2 rotatedSampleDirection = vec2(cosVal * sampleDirection.x - sinVal * sampleDirection.y, sinVal * sampleDirection.x + cosVal * sampleDirection.y);\n        float localAO = 0.0;\n        float localStepSize = stepSize;\n\n        //Loop for each step\n        for (int j = 0; j < 6; j++)\n        {\n            vec2 newCoords = v_textureCoordinates + rotatedSampleDirection * localStepSize * pixelSize;\n\n            //Exception Handling\n            if(newCoords.x > 1.0 || newCoords.y > 1.0 || newCoords.x < 0.0 || newCoords.y < 0.0)\n            {\n                break;\n            }\n\n            float stepDepthInfo = czm_readDepth(depthTexture, newCoords);\n            vec4 stepPosInCamera = clipToEye(newCoords, stepDepthInfo);\n            vec3 diffVec = stepPosInCamera.xyz - posInCamera.xyz;\n            float len = length(diffVec);\n\n            if (len > lengthCap)\n            {\n                break;\n            }\n\n            float dotVal = clamp(dot(normalInCamera, normalize(diffVec)), 0.0, 1.0 );\n            float weight = len / lengthCap;\n            weight = 1.0 - weight * weight;\n\n            if (dotVal < bias)\n            {\n                dotVal = 0.0;\n            }\n\n            localAO = max(localAO, dotVal * weight);\n            localStepSize += stepSize;\n        }\n        ao += localAO;\n    }\n\n    ao /= 4.0;\n    ao = 1.0 - clamp(ao, 0.0, 1.0);\n    ao = pow(ao, intensity);\n    gl_FragColor = vec4(vec3(ao), 1.0);\n}\n",uniforms:{intensity:3,bias:.1,lengthCap:.26,stepSize:1.95,frustumLength:1e3,randomTexture:void 0}}),t=Wh("czm_ambient_occlusion_blur");t.uniforms.stepSize=.86;var a=new kh({name:"czm_ambient_occlusion_generate_blur",stages:[e,t]}),i=new Bh({name:"czm_ambient_occlusion_composite",fragmentShader:"uniform sampler2D colorTexture;\nuniform sampler2D ambientOcclusionTexture;\nuniform bool ambientOcclusionOnly;\nvarying vec2 v_textureCoordinates;\n\nvoid main(void)\n{\n    vec3 color = texture2D(colorTexture, v_textureCoordinates).rgb;\n    vec3 ao = texture2D(ambientOcclusionTexture, v_textureCoordinates).rgb;\n    gl_FragColor.rgb = ambientOcclusionOnly ? ao : ao * color;\n}\n",uniforms:{ambientOcclusionOnly:!1,ambientOcclusionTexture:a.name}}),r={};return Object(s.default)(r,{intensity:{get:function(){return e.uniforms.intensity},set:function(t){e.uniforms.intensity=t}},bias:{get:function(){return e.uniforms.bias},set:function(t){e.uniforms.bias=t}},lengthCap:{get:function(){return e.uniforms.lengthCap},set:function(t){e.uniforms.lengthCap=t}},stepSize:{get:function(){return e.uniforms.stepSize},set:function(t){e.uniforms.stepSize=t}},frustumLength:{get:function(){return e.uniforms.frustumLength},set:function(t){e.uniforms.frustumLength=t}},randomTexture:{get:function(){return e.uniforms.randomTexture},set:function(t){e.uniforms.randomTexture=t}},delta:{get:function(){return t.uniforms.delta},set:function(e){t.uniforms.delta=e}},sigma:{get:function(){return t.uniforms.sigma},set:function(e){t.uniforms.sigma=e}},blurStepSize:{get:function(){return t.uniforms.stepSize},set:function(e){t.uniforms.stepSize=e}},ambientOcclusionOnly:{get:function(){return i.uniforms.ambientOcclusionOnly},set:function(e){i.uniforms.ambientOcclusionOnly=e}}}),new kh({name:"czm_ambient_occlusion",stages:[a,i],inputPreviousStageTexture:!1,uniforms:r})},Gh.isAmbientOcclusionSupported=function(e){return e.context.depthTexture};Gh.createFXAAStage=function(){return new Bh({name:"czm_FXAA",fragmentShader:"#define FXAA_QUALITY_PRESET 39 \n/**\n * @license\n * Copyright (c) 2014-2015, NVIDIA CORPORATION. All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions\n * are met:\n *  * Redistributions of source code must retain the above copyright\n *    notice, this list of conditions and the following disclaimer.\n *  * Redistributions in binary form must reproduce the above copyright\n *    notice, this list of conditions and the following disclaimer in the\n *    documentation and/or other materials provided with the distribution.\n *  * Neither the name of NVIDIA CORPORATION nor the names of its\n *    contributors may be used to endorse or promote products derived\n *    from this software without specific prior written permission.\n *\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS ``AS IS'' AND ANY\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR\n * PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR\n * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,\n * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,\n * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR\n * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY\n * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\n// NVIDIA GameWorks Graphics Samples GitHub link: https://github.com/NVIDIAGameWorks/GraphicsSamples\n// Original FXAA 3.11 shader link: https://github.com/NVIDIAGameWorks/GraphicsSamples/blob/master/samples/es3-kepler/FXAA/FXAA3_11.h\n\n// Steps used to integrate into Cesium:\n// * The following defines are set:\n//       #define FXAA_PC 1\n//       #define FXAA_WEBGL_1 1\n//       #define FXAA_GREEN_AS_LUMA 1\n//       #define FXAA_EARLY_EXIT 1\n//       #define FXAA_GLSL_120 1\n// * All other preprocessor directives besides the FXAA_QUALITY__P* directives were removed.\n// * Double underscores are invalid for preprocessor directives so replace them with a single underscore. Replace\n//   /FXAA_QUALITY__P(.*)/g with /FXAA_QUALITY__P$1/.\n// * There are no implicit conversions from ivec* to vec* so replace:\n//       #define FxaaInt2 ivec2\n//           with\n//       #define FxaaInt2 vec2\n// * The texture2DLod function is only available in vertex shaders so replace:\n//       #define FxaaTexTop(t, p) texture2DLod(t, p, 0.0)\n//       #define FxaaTexOff(t, p, o, r) texture2DLod(t, p + (o * r), 0.0)\n//           with\n//       #define FxaaTexTop(t, p) texture2D(t, p)\n//       #define FxaaTexOff(t, p, o, r) texture2D(t, p + (o * r))\n// * FXAA_QUALITY_PRESET is prepended in the javascript code. We may want to expose that setting in the future.\n// * The following parameters to FxaaPixelShader are unused and can be removed:\n//       fxaaConsolePosPos\n//       fxaaConsoleRcpFrameOpt\n//       fxaaConsoleRcpFrameOpt2\n//       fxaaConsole360RcpFrameOpt2\n//       fxaaConsoleEdgeSharpness\n//       fxaaConsoleEdgeThreshold\n//       fxaaConsoleEdgeThresholdMi\n//       fxaaConsole360ConstDir\n\n//\n// Choose the quality preset.\n// This needs to be compiled into the shader as it effects code.\n// Best option to include multiple presets is to\n// in each shader define the preset, then include this file.\n//\n// OPTIONS\n// -----------------------------------------------------------------------\n// 10 to 15 - default medium dither (10=fastest, 15=highest quality)\n// 20 to 29 - less dither, more expensive (20=fastest, 29=highest quality)\n// 39       - no dither, very expensive\n//\n// NOTES\n// -----------------------------------------------------------------------\n// 12 = slightly faster then FXAA 3.9 and higher edge quality (default)\n// 13 = about same speed as FXAA 3.9 and better than 12\n// 23 = closest to FXAA 3.9 visually and performance wise\n//  _ = the lowest digit is directly related to performance\n// _  = the highest digit is directly related to style\n//\n//#define FXAA_QUALITY_PRESET 12\n\n\n#if (FXAA_QUALITY_PRESET == 10)\n    #define FXAA_QUALITY_PS 3\n    #define FXAA_QUALITY_P0 1.5\n    #define FXAA_QUALITY_P1 3.0\n    #define FXAA_QUALITY_P2 12.0\n#endif\n#if (FXAA_QUALITY_PRESET == 11)\n    #define FXAA_QUALITY_PS 4\n    #define FXAA_QUALITY_P0 1.0\n    #define FXAA_QUALITY_P1 1.5\n    #define FXAA_QUALITY_P2 3.0\n    #define FXAA_QUALITY_P3 12.0\n#endif\n#if (FXAA_QUALITY_PRESET == 12)\n    #define FXAA_QUALITY_PS 5\n    #define FXAA_QUALITY_P0 1.0\n    #define FXAA_QUALITY_P1 1.5\n    #define FXAA_QUALITY_P2 2.0\n    #define FXAA_QUALITY_P3 4.0\n    #define FXAA_QUALITY_P4 12.0\n#endif\n#if (FXAA_QUALITY_PRESET == 13)\n    #define FXAA_QUALITY_PS 6\n    #define FXAA_QUALITY_P0 1.0\n    #define FXAA_QUALITY_P1 1.5\n    #define FXAA_QUALITY_P2 2.0\n    #define FXAA_QUALITY_P3 2.0\n    #define FXAA_QUALITY_P4 4.0\n    #define FXAA_QUALITY_P5 12.0\n#endif\n#if (FXAA_QUALITY_PRESET == 14)\n    #define FXAA_QUALITY_PS 7\n    #define FXAA_QUALITY_P0 1.0\n    #define FXAA_QUALITY_P1 1.5\n    #define FXAA_QUALITY_P2 2.0\n    #define FXAA_QUALITY_P3 2.0\n    #define FXAA_QUALITY_P4 2.0\n    #define FXAA_QUALITY_P5 4.0\n    #define FXAA_QUALITY_P6 12.0\n#endif\n#if (FXAA_QUALITY_PRESET == 15)\n    #define FXAA_QUALITY_PS 8\n    #define FXAA_QUALITY_P0 1.0\n    #define FXAA_QUALITY_P1 1.5\n    #define FXAA_QUALITY_P2 2.0\n    #define FXAA_QUALITY_P3 2.0\n    #define FXAA_QUALITY_P4 2.0\n    #define FXAA_QUALITY_P5 2.0\n    #define FXAA_QUALITY_P6 4.0\n    #define FXAA_QUALITY_P7 12.0\n#endif\n#if (FXAA_QUALITY_PRESET == 20)\n    #define FXAA_QUALITY_PS 3\n    #define FXAA_QUALITY_P0 1.5\n    #define FXAA_QUALITY_P1 2.0\n    #define FXAA_QUALITY_P2 8.0\n#endif\n#if (FXAA_QUALITY_PRESET == 21)\n    #define FXAA_QUALITY_PS 4\n    #define FXAA_QUALITY_P0 1.0\n    #define FXAA_QUALITY_P1 1.5\n    #define FXAA_QUALITY_P2 2.0\n    #define FXAA_QUALITY_P3 8.0\n#endif\n#if (FXAA_QUALITY_PRESET == 22)\n    #define FXAA_QUALITY_PS 5\n    #define FXAA_QUALITY_P0 1.0\n    #define FXAA_QUALITY_P1 1.5\n    #define FXAA_QUALITY_P2 2.0\n    #define FXAA_QUALITY_P3 2.0\n    #define FXAA_QUALITY_P4 8.0\n#endif\n#if (FXAA_QUALITY_PRESET == 23)\n    #define FXAA_QUALITY_PS 6\n    #define FXAA_QUALITY_P0 1.0\n    #define FXAA_QUALITY_P1 1.5\n    #define FXAA_QUALITY_P2 2.0\n    #define FXAA_QUALITY_P3 2.0\n    #define FXAA_QUALITY_P4 2.0\n    #define FXAA_QUALITY_P5 8.0\n#endif\n#if (FXAA_QUALITY_PRESET == 24)\n    #define FXAA_QUALITY_PS 7\n    #define FXAA_QUALITY_P0 1.0\n    #define FXAA_QUALITY_P1 1.5\n    #define FXAA_QUALITY_P2 2.0\n    #define FXAA_QUALITY_P3 2.0\n    #define FXAA_QUALITY_P4 2.0\n    #define FXAA_QUALITY_P5 3.0\n    #define FXAA_QUALITY_P6 8.0\n#endif\n#if (FXAA_QUALITY_PRESET == 25)\n    #define FXAA_QUALITY_PS 8\n    #define FXAA_QUALITY_P0 1.0\n    #define FXAA_QUALITY_P1 1.5\n    #define FXAA_QUALITY_P2 2.0\n    #define FXAA_QUALITY_P3 2.0\n    #define FXAA_QUALITY_P4 2.0\n    #define FXAA_QUALITY_P5 2.0\n    #define FXAA_QUALITY_P6 4.0\n    #define FXAA_QUALITY_P7 8.0\n#endif\n#if (FXAA_QUALITY_PRESET == 26)\n    #define FXAA_QUALITY_PS 9\n    #define FXAA_QUALITY_P0 1.0\n    #define FXAA_QUALITY_P1 1.5\n    #define FXAA_QUALITY_P2 2.0\n    #define FXAA_QUALITY_P3 2.0\n    #define FXAA_QUALITY_P4 2.0\n    #define FXAA_QUALITY_P5 2.0\n    #define FXAA_QUALITY_P6 2.0\n    #define FXAA_QUALITY_P7 4.0\n    #define FXAA_QUALITY_P8 8.0\n#endif\n#if (FXAA_QUALITY_PRESET == 27)\n    #define FXAA_QUALITY_PS 10\n    #define FXAA_QUALITY_P0 1.0\n    #define FXAA_QUALITY_P1 1.5\n    #define FXAA_QUALITY_P2 2.0\n    #define FXAA_QUALITY_P3 2.0\n    #define FXAA_QUALITY_P4 2.0\n    #define FXAA_QUALITY_P5 2.0\n    #define FXAA_QUALITY_P6 2.0\n    #define FXAA_QUALITY_P7 2.0\n    #define FXAA_QUALITY_P8 4.0\n    #define FXAA_QUALITY_P9 8.0\n#endif\n#if (FXAA_QUALITY_PRESET == 28)\n    #define FXAA_QUALITY_PS 11\n    #define FXAA_QUALITY_P0 1.0\n    #define FXAA_QUALITY_P1 1.5\n    #define FXAA_QUALITY_P2 2.0\n    #define FXAA_QUALITY_P3 2.0\n    #define FXAA_QUALITY_P4 2.0\n    #define FXAA_QUALITY_P5 2.0\n    #define FXAA_QUALITY_P6 2.0\n    #define FXAA_QUALITY_P7 2.0\n    #define FXAA_QUALITY_P8 2.0\n    #define FXAA_QUALITY_P9 4.0\n    #define FXAA_QUALITY_P10 8.0\n#endif\n#if (FXAA_QUALITY_PRESET == 29)\n    #define FXAA_QUALITY_PS 12\n    #define FXAA_QUALITY_P0 1.0\n    #define FXAA_QUALITY_P1 1.5\n    #define FXAA_QUALITY_P2 2.0\n    #define FXAA_QUALITY_P3 2.0\n    #define FXAA_QUALITY_P4 2.0\n    #define FXAA_QUALITY_P5 2.0\n    #define FXAA_QUALITY_P6 2.0\n    #define FXAA_QUALITY_P7 2.0\n    #define FXAA_QUALITY_P8 2.0\n    #define FXAA_QUALITY_P9 2.0\n    #define FXAA_QUALITY_P10 4.0\n    #define FXAA_QUALITY_P11 8.0\n#endif\n#if (FXAA_QUALITY_PRESET == 39)\n    #define FXAA_QUALITY_PS 12\n    #define FXAA_QUALITY_P0 1.0\n    #define FXAA_QUALITY_P1 1.0\n    #define FXAA_QUALITY_P2 1.0\n    #define FXAA_QUALITY_P3 1.0\n    #define FXAA_QUALITY_P4 1.0\n    #define FXAA_QUALITY_P5 1.5\n    #define FXAA_QUALITY_P6 2.0\n    #define FXAA_QUALITY_P7 2.0\n    #define FXAA_QUALITY_P8 2.0\n    #define FXAA_QUALITY_P9 2.0\n    #define FXAA_QUALITY_P10 4.0\n    #define FXAA_QUALITY_P11 8.0\n#endif\n\n#define FxaaBool bool\n#define FxaaFloat float\n#define FxaaFloat2 vec2\n#define FxaaFloat3 vec3\n#define FxaaFloat4 vec4\n#define FxaaHalf float\n#define FxaaHalf2 vec2\n#define FxaaHalf3 vec3\n#define FxaaHalf4 vec4\n#define FxaaInt2 vec2\n#define FxaaTex sampler2D\n\n#define FxaaSat(x) clamp(x, 0.0, 1.0)\n#define FxaaTexTop(t, p) texture2D(t, p)\n#define FxaaTexOff(t, p, o, r) texture2D(t, p + (o * r))\n\nFxaaFloat FxaaLuma(FxaaFloat4 rgba) { return rgba.y; }\n\nFxaaFloat4 FxaaPixelShader(\n    //\n    // Use noperspective interpolation here (turn off perspective interpolation).\n    // {xy} = center of pixel\n    FxaaFloat2 pos,\n    //\n    // Input color texture.\n    // {rgb_} = color in linear or perceptual color space\n    // if (FXAA_GREEN_AS_LUMA == 0)\n    //     {___a} = luma in perceptual color space (not linear)\n    FxaaTex tex,\n    //\n    // Only used on FXAA Quality.\n    // This must be from a constant/uniform.\n    // {x_} = 1.0/screenWidthInPixels\n    // {_y} = 1.0/screenHeightInPixels\n    FxaaFloat2 fxaaQualityRcpFrame,\n    //\n    // Only used on FXAA Quality.\n    // This used to be the FXAA_QUALITY_SUBPIX define.\n    // It is here now to allow easier tuning.\n    // Choose the amount of sub-pixel aliasing removal.\n    // This can effect sharpness.\n    //   1.00 - upper limit (softer)\n    //   0.75 - default amount of filtering\n    //   0.50 - lower limit (sharper, less sub-pixel aliasing removal)\n    //   0.25 - almost off\n    //   0.00 - completely off\n    FxaaFloat fxaaQualitySubpix,\n    //\n    // Only used on FXAA Quality.\n    // This used to be the FXAA_QUALITY_EDGE_THRESHOLD define.\n    // It is here now to allow easier tuning.\n    // The minimum amount of local contrast required to apply algorithm.\n    //   0.333 - too little (faster)\n    //   0.250 - low quality\n    //   0.166 - default\n    //   0.125 - high quality\n    //   0.063 - overkill (slower)\n    FxaaFloat fxaaQualityEdgeThreshold,\n    //\n    // Only used on FXAA Quality.\n    // This used to be the FXAA_QUALITY_EDGE_THRESHOLD_MIN define.\n    // It is here now to allow easier tuning.\n    // Trims the algorithm from processing darks.\n    //   0.0833 - upper limit (default, the start of visible unfiltered edges)\n    //   0.0625 - high quality (faster)\n    //   0.0312 - visible limit (slower)\n    // Special notes when using FXAA_GREEN_AS_LUMA,\n    //   Likely want to set this to zero.\n    //   As colors that are mostly not-green\n    //   will appear very dark in the green channel!\n    //   Tune by looking at mostly non-green content,\n    //   then start at zero and increase until aliasing is a problem.\n    FxaaFloat fxaaQualityEdgeThresholdMin\n) {\n/*--------------------------------------------------------------------------*/\n    FxaaFloat2 posM;\n    posM.x = pos.x;\n    posM.y = pos.y;\n    FxaaFloat4 rgbyM = FxaaTexTop(tex, posM);\n    #define lumaM rgbyM.y\n    FxaaFloat lumaS = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0, 1), fxaaQualityRcpFrame.xy));\n    FxaaFloat lumaE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 0), fxaaQualityRcpFrame.xy));\n    FxaaFloat lumaN = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0,-1), fxaaQualityRcpFrame.xy));\n    FxaaFloat lumaW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 0), fxaaQualityRcpFrame.xy));\n/*--------------------------------------------------------------------------*/\n    FxaaFloat maxSM = max(lumaS, lumaM);\n    FxaaFloat minSM = min(lumaS, lumaM);\n    FxaaFloat maxESM = max(lumaE, maxSM);\n    FxaaFloat minESM = min(lumaE, minSM);\n    FxaaFloat maxWN = max(lumaN, lumaW);\n    FxaaFloat minWN = min(lumaN, lumaW);\n    FxaaFloat rangeMax = max(maxWN, maxESM);\n    FxaaFloat rangeMin = min(minWN, minESM);\n    FxaaFloat rangeMaxScaled = rangeMax * fxaaQualityEdgeThreshold;\n    FxaaFloat range = rangeMax - rangeMin;\n    FxaaFloat rangeMaxClamped = max(fxaaQualityEdgeThresholdMin, rangeMaxScaled);\n    FxaaBool earlyExit = range < rangeMaxClamped;\n/*--------------------------------------------------------------------------*/\n    if(earlyExit)\n        return rgbyM;\n/*--------------------------------------------------------------------------*/\n    FxaaFloat lumaNW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1,-1), fxaaQualityRcpFrame.xy));\n    FxaaFloat lumaSE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 1), fxaaQualityRcpFrame.xy));\n    FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1,-1), fxaaQualityRcpFrame.xy));\n    FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));\n/*--------------------------------------------------------------------------*/\n    FxaaFloat lumaNS = lumaN + lumaS;\n    FxaaFloat lumaWE = lumaW + lumaE;\n    FxaaFloat subpixRcpRange = 1.0/range;\n    FxaaFloat subpixNSWE = lumaNS + lumaWE;\n    FxaaFloat edgeHorz1 = (-2.0 * lumaM) + lumaNS;\n    FxaaFloat edgeVert1 = (-2.0 * lumaM) + lumaWE;\n/*--------------------------------------------------------------------------*/\n    FxaaFloat lumaNESE = lumaNE + lumaSE;\n    FxaaFloat lumaNWNE = lumaNW + lumaNE;\n    FxaaFloat edgeHorz2 = (-2.0 * lumaE) + lumaNESE;\n    FxaaFloat edgeVert2 = (-2.0 * lumaN) + lumaNWNE;\n/*--------------------------------------------------------------------------*/\n    FxaaFloat lumaNWSW = lumaNW + lumaSW;\n    FxaaFloat lumaSWSE = lumaSW + lumaSE;\n    FxaaFloat edgeHorz4 = (abs(edgeHorz1) * 2.0) + abs(edgeHorz2);\n    FxaaFloat edgeVert4 = (abs(edgeVert1) * 2.0) + abs(edgeVert2);\n    FxaaFloat edgeHorz3 = (-2.0 * lumaW) + lumaNWSW;\n    FxaaFloat edgeVert3 = (-2.0 * lumaS) + lumaSWSE;\n    FxaaFloat edgeHorz = abs(edgeHorz3) + edgeHorz4;\n    FxaaFloat edgeVert = abs(edgeVert3) + edgeVert4;\n/*--------------------------------------------------------------------------*/\n    FxaaFloat subpixNWSWNESE = lumaNWSW + lumaNESE;\n    FxaaFloat lengthSign = fxaaQualityRcpFrame.x;\n    FxaaBool horzSpan = edgeHorz >= edgeVert;\n    FxaaFloat subpixA = subpixNSWE * 2.0 + subpixNWSWNESE;\n/*--------------------------------------------------------------------------*/\n    if(!horzSpan) lumaN = lumaW;\n    if(!horzSpan) lumaS = lumaE;\n    if(horzSpan) lengthSign = fxaaQualityRcpFrame.y;\n    FxaaFloat subpixB = (subpixA * (1.0/12.0)) - lumaM;\n/*--------------------------------------------------------------------------*/\n    FxaaFloat gradientN = lumaN - lumaM;\n    FxaaFloat gradientS = lumaS - lumaM;\n    FxaaFloat lumaNN = lumaN + lumaM;\n    FxaaFloat lumaSS = lumaS + lumaM;\n    FxaaBool pairN = abs(gradientN) >= abs(gradientS);\n    FxaaFloat gradient = max(abs(gradientN), abs(gradientS));\n    if(pairN) lengthSign = -lengthSign;\n    FxaaFloat subpixC = FxaaSat(abs(subpixB) * subpixRcpRange);\n/*--------------------------------------------------------------------------*/\n    FxaaFloat2 posB;\n    posB.x = posM.x;\n    posB.y = posM.y;\n    FxaaFloat2 offNP;\n    offNP.x = (!horzSpan) ? 0.0 : fxaaQualityRcpFrame.x;\n    offNP.y = ( horzSpan) ? 0.0 : fxaaQualityRcpFrame.y;\n    if(!horzSpan) posB.x += lengthSign * 0.5;\n    if( horzSpan) posB.y += lengthSign * 0.5;\n/*--------------------------------------------------------------------------*/\n    FxaaFloat2 posN;\n    posN.x = posB.x - offNP.x * FXAA_QUALITY_P0;\n    posN.y = posB.y - offNP.y * FXAA_QUALITY_P0;\n    FxaaFloat2 posP;\n    posP.x = posB.x + offNP.x * FXAA_QUALITY_P0;\n    posP.y = posB.y + offNP.y * FXAA_QUALITY_P0;\n    FxaaFloat subpixD = ((-2.0)*subpixC) + 3.0;\n    FxaaFloat lumaEndN = FxaaLuma(FxaaTexTop(tex, posN));\n    FxaaFloat subpixE = subpixC * subpixC;\n    FxaaFloat lumaEndP = FxaaLuma(FxaaTexTop(tex, posP));\n/*--------------------------------------------------------------------------*/\n    if(!pairN) lumaNN = lumaSS;\n    FxaaFloat gradientScaled = gradient * 1.0/4.0;\n    FxaaFloat lumaMM = lumaM - lumaNN * 0.5;\n    FxaaFloat subpixF = subpixD * subpixE;\n    FxaaBool lumaMLTZero = lumaMM < 0.0;\n/*--------------------------------------------------------------------------*/\n    lumaEndN -= lumaNN * 0.5;\n    lumaEndP -= lumaNN * 0.5;\n    FxaaBool doneN = abs(lumaEndN) >= gradientScaled;\n    FxaaBool doneP = abs(lumaEndP) >= gradientScaled;\n    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P1;\n    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P1;\n    FxaaBool doneNP = (!doneN) || (!doneP);\n    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P1;\n    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P1;\n/*--------------------------------------------------------------------------*/\n    if(doneNP) {\n        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n        doneN = abs(lumaEndN) >= gradientScaled;\n        doneP = abs(lumaEndP) >= gradientScaled;\n        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P2;\n        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P2;\n        doneNP = (!doneN) || (!doneP);\n        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P2;\n        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P2;\n/*--------------------------------------------------------------------------*/\n        #if (FXAA_QUALITY_PS > 3)\n        if(doneNP) {\n            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n            doneN = abs(lumaEndN) >= gradientScaled;\n            doneP = abs(lumaEndP) >= gradientScaled;\n            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P3;\n            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P3;\n            doneNP = (!doneN) || (!doneP);\n            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P3;\n            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P3;\n/*--------------------------------------------------------------------------*/\n            #if (FXAA_QUALITY_PS > 4)\n            if(doneNP) {\n                if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n                if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n                if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n                if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n                doneN = abs(lumaEndN) >= gradientScaled;\n                doneP = abs(lumaEndP) >= gradientScaled;\n                if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P4;\n                if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P4;\n                doneNP = (!doneN) || (!doneP);\n                if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P4;\n                if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P4;\n/*--------------------------------------------------------------------------*/\n                #if (FXAA_QUALITY_PS > 5)\n                if(doneNP) {\n                    if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n                    if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n                    if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n                    if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n                    doneN = abs(lumaEndN) >= gradientScaled;\n                    doneP = abs(lumaEndP) >= gradientScaled;\n                    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P5;\n                    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P5;\n                    doneNP = (!doneN) || (!doneP);\n                    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P5;\n                    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P5;\n/*--------------------------------------------------------------------------*/\n                    #if (FXAA_QUALITY_PS > 6)\n                    if(doneNP) {\n                        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n                        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n                        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n                        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n                        doneN = abs(lumaEndN) >= gradientScaled;\n                        doneP = abs(lumaEndP) >= gradientScaled;\n                        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P6;\n                        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P6;\n                        doneNP = (!doneN) || (!doneP);\n                        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P6;\n                        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P6;\n/*--------------------------------------------------------------------------*/\n                        #if (FXAA_QUALITY_PS > 7)\n                        if(doneNP) {\n                            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n                            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n                            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n                            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n                            doneN = abs(lumaEndN) >= gradientScaled;\n                            doneP = abs(lumaEndP) >= gradientScaled;\n                            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P7;\n                            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P7;\n                            doneNP = (!doneN) || (!doneP);\n                            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P7;\n                            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P7;\n/*--------------------------------------------------------------------------*/\n    #if (FXAA_QUALITY_PS > 8)\n    if(doneNP) {\n        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n        doneN = abs(lumaEndN) >= gradientScaled;\n        doneP = abs(lumaEndP) >= gradientScaled;\n        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P8;\n        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P8;\n        doneNP = (!doneN) || (!doneP);\n        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P8;\n        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P8;\n/*--------------------------------------------------------------------------*/\n        #if (FXAA_QUALITY_PS > 9)\n        if(doneNP) {\n            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n            doneN = abs(lumaEndN) >= gradientScaled;\n            doneP = abs(lumaEndP) >= gradientScaled;\n            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P9;\n            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P9;\n            doneNP = (!doneN) || (!doneP);\n            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P9;\n            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P9;\n/*--------------------------------------------------------------------------*/\n            #if (FXAA_QUALITY_PS > 10)\n            if(doneNP) {\n                if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n                if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n                if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n                if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n                doneN = abs(lumaEndN) >= gradientScaled;\n                doneP = abs(lumaEndP) >= gradientScaled;\n                if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P10;\n                if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P10;\n                doneNP = (!doneN) || (!doneP);\n                if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P10;\n                if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P10;\n/*--------------------------------------------------------------------------*/\n                #if (FXAA_QUALITY_PS > 11)\n                if(doneNP) {\n                    if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n                    if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n                    if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n                    if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n                    doneN = abs(lumaEndN) >= gradientScaled;\n                    doneP = abs(lumaEndP) >= gradientScaled;\n                    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P11;\n                    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P11;\n                    doneNP = (!doneN) || (!doneP);\n                    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P11;\n                    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P11;\n/*--------------------------------------------------------------------------*/\n                    #if (FXAA_QUALITY_PS > 12)\n                    if(doneNP) {\n                        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n                        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n                        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n                        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n                        doneN = abs(lumaEndN) >= gradientScaled;\n                        doneP = abs(lumaEndP) >= gradientScaled;\n                        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P12;\n                        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P12;\n                        doneNP = (!doneN) || (!doneP);\n                        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P12;\n                        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P12;\n/*--------------------------------------------------------------------------*/\n                    }\n                    #endif\n/*--------------------------------------------------------------------------*/\n                }\n                #endif\n/*--------------------------------------------------------------------------*/\n            }\n            #endif\n/*--------------------------------------------------------------------------*/\n        }\n        #endif\n/*--------------------------------------------------------------------------*/\n    }\n    #endif\n/*--------------------------------------------------------------------------*/\n                        }\n                        #endif\n/*--------------------------------------------------------------------------*/\n                    }\n                    #endif\n/*--------------------------------------------------------------------------*/\n                }\n                #endif\n/*--------------------------------------------------------------------------*/\n            }\n            #endif\n/*--------------------------------------------------------------------------*/\n        }\n        #endif\n/*--------------------------------------------------------------------------*/\n    }\n/*--------------------------------------------------------------------------*/\n    FxaaFloat dstN = posM.x - posN.x;\n    FxaaFloat dstP = posP.x - posM.x;\n    if(!horzSpan) dstN = posM.y - posN.y;\n    if(!horzSpan) dstP = posP.y - posM.y;\n/*--------------------------------------------------------------------------*/\n    FxaaBool goodSpanN = (lumaEndN < 0.0) != lumaMLTZero;\n    FxaaFloat spanLength = (dstP + dstN);\n    FxaaBool goodSpanP = (lumaEndP < 0.0) != lumaMLTZero;\n    FxaaFloat spanLengthRcp = 1.0/spanLength;\n/*--------------------------------------------------------------------------*/\n    FxaaBool directionN = dstN < dstP;\n    FxaaFloat dst = min(dstN, dstP);\n    FxaaBool goodSpan = directionN ? goodSpanN : goodSpanP;\n    FxaaFloat subpixG = subpixF * subpixF;\n    FxaaFloat pixelOffset = (dst * (-spanLengthRcp)) + 0.5;\n    FxaaFloat subpixH = subpixG * fxaaQualitySubpix;\n/*--------------------------------------------------------------------------*/\n    FxaaFloat pixelOffsetGood = goodSpan ? pixelOffset : 0.0;\n    FxaaFloat pixelOffsetSubpix = max(pixelOffsetGood, subpixH);\n    if(!horzSpan) posM.x += pixelOffsetSubpix * lengthSign;\n    if( horzSpan) posM.y += pixelOffsetSubpix * lengthSign;\n    return FxaaFloat4(FxaaTexTop(tex, posM).xyz, lumaM);\n}\n\nvarying vec2 v_textureCoordinates;\n\nuniform sampler2D colorTexture;\n\nconst float fxaaQualitySubpix = 0.5;\nconst float fxaaQualityEdgeThreshold = 0.125;\nconst float fxaaQualityEdgeThresholdMin = 0.0833;\n\nvoid main()\n{\n    vec2 fxaaQualityRcpFrame = vec2(1.0) / czm_viewport.zw;\n    vec4 color = FxaaPixelShader(\n        v_textureCoordinates,\n        colorTexture,\n        fxaaQualityRcpFrame,\n        fxaaQualitySubpix,\n        fxaaQualityEdgeThreshold,\n        fxaaQualityEdgeThresholdMin);\n    float alpha = texture2D(colorTexture, v_textureCoordinates).a;\n    gl_FragColor = vec4(color.rgb, alpha);\n}\n",sampleMode:Mh.LINEAR})},Gh.createAcesTonemappingStage=function(e){var t=e?"#define AUTO_EXPOSURE\n":"";return new Bh({name:"czm_aces",fragmentShader:t+="uniform sampler2D colorTexture;\n\nvarying vec2 v_textureCoordinates;\n\n#ifdef AUTO_EXPOSURE\nuniform sampler2D autoExposure;\n#endif\n\nvoid main()\n{\n    vec4 fragmentColor = texture2D(colorTexture, v_textureCoordinates);\n    vec3 color = fragmentColor.rgb;\n\n#ifdef AUTO_EXPOSURE\n    color /= texture2D(autoExposure, vec2(0.5)).r;\n#endif\n    color = czm_acesTonemapping(color);\n    color = czm_inverseGamma(color);\n\n    gl_FragColor = vec4(color, fragmentColor.a);\n}\n",uniforms:{autoExposure:void 0}})},Gh.createFilmicTonemappingStage=function(e){var t=e?"#define AUTO_EXPOSURE\n":"";return new Bh({name:"czm_filmic",fragmentShader:t+="uniform sampler2D colorTexture;\n\nvarying vec2 v_textureCoordinates;\n\n#ifdef AUTO_EXPOSURE\nuniform sampler2D autoExposure;\n#endif\n\n// See slides 142 and 143:\n//     http://www.gdcvault.com/play/1012459/Uncharted_2__HDR_Lighting\n\nvoid main()\n{\n    vec4 fragmentColor = texture2D(colorTexture, v_textureCoordinates);\n    vec3 color = fragmentColor.rgb;\n\n#ifdef AUTO_EXPOSURE\n    float exposure = texture2D(autoExposure, vec2(0.5)).r;\n    color /= exposure;\n#endif\n\n\tconst float A = 0.22; // shoulder strength\n\tconst float B = 0.30; // linear strength\n\tconst float C = 0.10; // linear angle\n\tconst float D = 0.20; // toe strength\n\tconst float E = 0.01; // toe numerator\n\tconst float F = 0.30; // toe denominator\n\n\tconst float white = 11.2; // linear white point value\n\n\tvec3 c = ((color * (A * color + C * B) + D * E) / (color * ( A * color + B) + D * F)) - E / F;\n\tfloat w = ((white * (A * white + C * B) + D * E) / (white * ( A * white + B) + D * F)) - E / F;\n\n\tc = czm_inverseGamma(c / w);\n\tgl_FragColor = vec4(c, fragmentColor.a);\n}\n",uniforms:{autoExposure:void 0}})},Gh.createReinhardTonemappingStage=function(e){var t=e?"#define AUTO_EXPOSURE\n":"";return new Bh({name:"czm_reinhard",fragmentShader:t+="uniform sampler2D colorTexture;\n\nvarying vec2 v_textureCoordinates;\n\n#ifdef AUTO_EXPOSURE\nuniform sampler2D autoExposure;\n#endif\n\n// See equation 3:\n//    http://www.cs.utah.edu/~reinhard/cdrom/tonemap.pdf\n\nvoid main()\n{\n    vec4 fragmentColor = texture2D(colorTexture, v_textureCoordinates);\n    vec3 color = fragmentColor.rgb;\n#ifdef AUTO_EXPOSURE\n    float exposure = texture2D(autoExposure, vec2(0.5)).r;\n    color /= exposure;\n#endif\n    color = color / (1.0 + color);\n    color = czm_inverseGamma(color);\n    gl_FragColor = vec4(color, fragmentColor.a);\n}\n",uniforms:{autoExposure:void 0}})},Gh.createModifiedReinhardTonemappingStage=function(e){var t=e?"#define AUTO_EXPOSURE\n":"";return new Bh({name:"czm_modified_reinhard",fragmentShader:t+="uniform sampler2D colorTexture;\nuniform vec3 white;\n\nvarying vec2 v_textureCoordinates;\n\n#ifdef AUTO_EXPOSURE\nuniform sampler2D autoExposure;\n#endif\n\n// See equation 4:\n//    http://www.cs.utah.edu/~reinhard/cdrom/tonemap.pdf\n\nvoid main()\n{\n    vec4 fragmentColor = texture2D(colorTexture, v_textureCoordinates);\n    vec3 color = fragmentColor.rgb;\n#ifdef AUTO_EXPOSURE\n    float exposure = texture2D(autoExposure, vec2(0.5)).r;\n    color /= exposure;\n#endif\n    color = (color * (1.0 + color / white)) / (1.0 + color);\n    color = czm_inverseGamma(color);\n    gl_FragColor = vec4(color, fragmentColor.a);\n}\n",uniforms:{white:G.default.WHITE,autoExposure:void 0}})},Gh.createAutoExposureStage=function(){return new Ih},Gh.createBlackAndWhiteStage=function(){return new Bh({name:"czm_black_and_white",fragmentShader:"uniform sampler2D colorTexture;\nuniform float gradations;\n\nvarying vec2 v_textureCoordinates;\n\nvoid main(void)\n{\n    vec3 rgb = texture2D(colorTexture, v_textureCoordinates).rgb;\n#ifdef CZM_SELECTED_FEATURE\n    if (czm_selected()) {\n        gl_FragColor = vec4(rgb, 1.0);\n        return;\n    }\n#endif\n    float luminance = czm_luminance(rgb);\n    float darkness = luminance * gradations;\n    darkness = (darkness - fract(darkness)) / gradations;\n    gl_FragColor = vec4(vec3(darkness), 1.0);\n}\n",uniforms:{gradations:5}})},Gh.createBrightnessStage=function(){return new Bh({name:"czm_brightness",fragmentShader:"uniform sampler2D colorTexture;\nuniform float brightness;\n\nvarying vec2 v_textureCoordinates;\n\nvoid main(void)\n{\n    vec3 rgb = texture2D(colorTexture, v_textureCoordinates).rgb;\n    vec3 target = vec3(0.0);\n    gl_FragColor = vec4(mix(target, rgb, brightness), 1.0);\n}\n",uniforms:{brightness:.5}})},Gh.createNightVisionStage=function(){return new Bh({name:"czm_night_vision",fragmentShader:"uniform sampler2D colorTexture;\n\nvarying vec2 v_textureCoordinates;\n\nfloat rand(vec2 co)\n{\n    return fract(sin(dot(co.xy ,vec2(12.9898, 78.233))) * 43758.5453);\n}\n\nvoid main(void)\n{\n    float noiseValue = rand(v_textureCoordinates + sin(czm_frameNumber)) * 0.1;\n    vec3 rgb = texture2D(colorTexture, v_textureCoordinates).rgb;\n    vec3 green = vec3(0.0, 1.0, 0.0);\n    gl_FragColor = vec4((noiseValue + rgb) * green, 1.0);\n}\n"})},Gh.createDepthViewStage=function(){return new Bh({name:"czm_depth_view",fragmentShader:"uniform sampler2D depthTexture;\n\nvarying vec2 v_textureCoordinates;\n\nvoid main(void)\n{\n    float depth = czm_readDepth(depthTexture, v_textureCoordinates);\n    gl_FragColor = vec4(vec3(depth), 1.0);\n}\n"})},Gh.createLensFlareStage=function(){return new Bh({name:"czm_lens_flare",fragmentShader:"uniform sampler2D colorTexture;\nuniform sampler2D dirtTexture;\nuniform sampler2D starTexture;\nuniform vec2 dirtTextureDimensions;\nuniform float distortion;\nuniform float ghostDispersal;\nuniform float haloWidth;\nuniform float dirtAmount;\nuniform float earthRadius;\nuniform float intensity;\n\nvarying vec2 v_textureCoordinates;\n\n// whether it is in space or not\n// 6500000.0 is empirical value\n#define DISTANCE_TO_SPACE 6500000.0\n\n// return ndc from world coordinate biased earthRadius\nvec4 getNDCFromWC(vec3 WC, float earthRadius)\n{\n    vec4 positionEC = czm_view * vec4(WC, 1.0);\n    positionEC = vec4(positionEC.x + earthRadius, positionEC.y, positionEC.z, 1.0);\n    vec4 positionWC = czm_eyeToWindowCoordinates(positionEC);\n    return czm_viewportOrthographic * vec4(positionWC.xy, -positionWC.z, 1.0);\n}\n\n// Check if current pixel is included Earth\n// if then mask it gradually\nfloat isInEarth(vec2 texcoord, vec2 sceneSize)\n{\n    vec2 NDC = texcoord * 2.0 - 1.0;\n    vec4 earthPosSC = getNDCFromWC(vec3(0.0), 0.0);\n    vec4 earthPosSCEdge = getNDCFromWC(vec3(0.0), earthRadius * 1.5);\n    NDC.xy -= earthPosSC.xy;\n\n    float X = abs(NDC.x) * sceneSize.x;\n    float Y = abs(NDC.y) * sceneSize.y;\n\n    return clamp(0.0, 1.0, max(sqrt(X * X + Y * Y) / max(abs(earthPosSCEdge.x * sceneSize.x), 1.0) - 0.8 , 0.0));\n}\n\n// For Chromatic effect\nvec4 textureDistorted(sampler2D tex, vec2 texcoord, vec2 direction, vec3 distortion, bool isSpace)\n{\n    vec2 sceneSize = czm_viewport.zw;\n    vec3 color;\n    if(isSpace)\n    {\n        color.r = isInEarth(texcoord + direction * distortion.r, sceneSize) * texture2D(tex, texcoord + direction * distortion.r).r;\n        color.g = isInEarth(texcoord + direction * distortion.g, sceneSize) * texture2D(tex, texcoord + direction * distortion.g).g;\n        color.b = isInEarth(texcoord + direction * distortion.b, sceneSize) * texture2D(tex, texcoord + direction * distortion.b).b;\n    }\n    else\n    {\n        color.r = texture2D(tex, texcoord + direction * distortion.r).r;\n        color.g = texture2D(tex, texcoord + direction * distortion.g).g;\n        color.b = texture2D(tex, texcoord + direction * distortion.b).b;\n    }\n    return vec4(clamp(color, 0.0, 1.0), 0.0);\n}\n\nvoid main(void)\n{\n    vec4 originalColor = texture2D(colorTexture, v_textureCoordinates);\n    vec3 rgb = originalColor.rgb;\n    bool isSpace = length(czm_viewerPositionWC.xyz) > DISTANCE_TO_SPACE;\n\n    // Sun position\n    vec4 sunPos = czm_morphTime == 1.0 ? vec4(czm_sunPositionWC, 1.0) : vec4(czm_sunPositionColumbusView.zxy, 1.0);\n    vec4 sunPositionEC = czm_view * sunPos;\n    vec4 sunPositionWC = czm_eyeToWindowCoordinates(sunPositionEC);\n    sunPos = czm_viewportOrthographic * vec4(sunPositionWC.xy, -sunPositionWC.z, 1.0);\n\n    // If sun is not in the screen space, use original color.\n    if(!isSpace || !((sunPos.x >= -1.1 && sunPos.x <= 1.1) && (sunPos.y >= -1.1 && sunPos.y <= 1.1)))\n    {\n        // Lens flare is disabled when not in space until #5932 is fixed.\n        //    https://github.com/AnalyticalGraphicsInc/cesium/issues/5932\n        gl_FragColor = originalColor;\n        return;\n    }\n\n    vec2 texcoord = vec2(1.0) - v_textureCoordinates;\n    vec2 pixelSize = czm_pixelRatio / czm_viewport.zw;\n    vec2 invPixelSize = 1.0 / pixelSize;\n    vec3 distortionVec = pixelSize.x * vec3(-distortion, 0.0, distortion);\n\n    // ghost vector to image centre:\n    vec2 ghostVec = (vec2(0.5) - texcoord) * ghostDispersal;\n    vec3 direction = normalize(vec3(ghostVec, 0.0));\n\n    // sample ghosts:\n    vec4 result = vec4(0.0);\n    vec4 ghost = vec4(0.0);\n    for (int i = 0; i < 4; ++i)\n    {\n        vec2 offset = fract(texcoord + ghostVec * float(i));\n        // Only bright spots from the centre of the source image\n        ghost += textureDistorted(colorTexture, offset, direction.xy, distortionVec, isSpace);\n    }\n    result += ghost;\n\n    // sample halo\n    vec2 haloVec = normalize(ghostVec) * haloWidth;\n    float weightForHalo = length(vec2(0.5) - fract(texcoord + haloVec)) / length(vec2(0.5));\n    weightForHalo = pow(1.0 - weightForHalo, 5.0);\n\n    result += textureDistorted(colorTexture, texcoord + haloVec, direction.xy, distortionVec, isSpace) * weightForHalo * 1.5;\n\n    // dirt on lens\n    vec2 dirtTexCoords = (v_textureCoordinates * invPixelSize) / dirtTextureDimensions;\n    if (dirtTexCoords.x > 1.0)\n    {\n        dirtTexCoords.x = mod(floor(dirtTexCoords.x), 2.0) == 1.0 ? 1.0 - fract(dirtTexCoords.x) :  fract(dirtTexCoords.x);\n    }\n    if (dirtTexCoords.y > 1.0)\n    {\n        dirtTexCoords.y = mod(floor(dirtTexCoords.y), 2.0) == 1.0 ? 1.0 - fract(dirtTexCoords.y) :  fract(dirtTexCoords.y);\n    }\n    result += dirtAmount * texture2D(dirtTexture, dirtTexCoords);\n\n    // Rotating starburst texture's coordinate\n    // dot(czm_view[0].xyz, vec3(0.0, 0.0, 1.0)) + dot(czm_view[1].xyz, vec3(0.0, 1.0, 0.0))\n    float camrot = czm_view[0].z + czm_view[1].y;\n    float cosValue = cos(camrot);\n    float sinValue = sin(camrot);\n    mat3 rotation = mat3(\n        cosValue, -sinValue, 0.0,\n        sinValue, cosValue, 0.0,\n        0.0, 0.0, 1.0\n    );\n\n    vec3 st1 = vec3(v_textureCoordinates * 2.0 - vec2(1.0), 1.0);\n    vec3 st2 = vec3((rotation * st1).xy, 1.0);\n    vec3 st3 = st2 * 0.5 + vec3(0.5);\n    vec2 lensStarTexcoord = st3.xy;\n    float weightForLensFlare = length(vec3(sunPos.xy, 0.0));\n    float oneMinusWeightForLensFlare = max(1.0 - weightForLensFlare, 0.0);\n\n    if (!isSpace)\n    {\n        result *= oneMinusWeightForLensFlare * intensity * 0.2;\n    }\n    else\n    {\n        result *= oneMinusWeightForLensFlare * intensity;\n        result *= texture2D(starTexture, lensStarTexcoord) * pow(weightForLensFlare, 1.0) * max((1.0 - length(vec3(st1.xy, 0.0))), 0.0) * 2.0;\n    }\n\n    result += texture2D(colorTexture, v_textureCoordinates);\n\n    gl_FragColor = result;\n}\n",uniforms:{dirtTexture:a(1605),starTexture:a(1606),intensity:2,distortion:10,ghostDispersal:.4,haloWidth:.4,dirtAmount:.4,earthRadius:d.default.WGS84.maximumRadius}})};var Yh=Gh;function Xh(e){this._collection=e,this._framebuffers=[],this._stageNameToFramebuffer={},this._width=void 0,this._height=void 0,this._updateDependencies=!1}function Qh(e){for(;Object(o.default)(e.length);)e=e.get(e.length-1);return e.name}function qh(e,t,a,i,r){if(!i.enabled||!i._isSupported(t))return r;var n=a[i.name]={};Object(o.default)(r)&&(n[Qh(e.getStageByName(r))]=!0);var s=i.uniforms;if(Object(o.default)(s))for(var l=Object.getOwnPropertyNames(s),u=l.length,d=0;d<u;++d){var f=s[l[d]];if("string"==typeof f){var c=e.getStageByName(f);Object(o.default)(c)&&(n[Qh(c)]=!0)}}return i.name}function Zh(e,t,a,i,r){if(Object(o.default)(i.enabled)&&!i.enabled||Object(o.default)(i._isSupported)&&!i._isSupported(t))return r;for(var n,s,l=r,u=!Object(o.default)(i.inputPreviousStageTexture)||i.inputPreviousStageTexture,d=r,f=i.length,c=0;c<f;++c){var h=i.get(c);d=Object(o.default)(h.length)?Zh(e,t,a,h,r):qh(e,t,a,h,r),u&&(r=d)}if(u)for(n=1;n<f;++n)s=Qh(i.get(n)),Object(o.default)(a[s])||(a[s]={}),a[s][l]=!0;else for(n=1;n<f;++n)for(var m=a[s=Qh(i.get(n))],p=0;p<n;++p)m[Qh(i.get(p))]=!0;return d}function Kh(e,t,a){var i,r,n=e._collection.getStageByName(t),s=n._textureScale,l=n._forcePowerOfTwo,u=n._pixelFormat,d=n._pixelDatatype,f=n._clearColor,c=e._framebuffers,h=c.length;for(i=0;i<h;++i)if(s===(r=c[i]).textureScale&&l===r.forcePowerOfTwo&&u===r.pixelFormat&&d===r.pixelDatatype&&G.default.equals(f,r.clearColor)){for(var m=r.stages,p=m.length,_=!1,g=0;g<p;++g)if(a[m[g]]){_=!0;break}if(!_)break}return Object(o.default)(r)&&i<h?(r.stages.push(t),r):(r={textureScale:s,forcePowerOfTwo:l,pixelFormat:u,pixelDatatype:d,clearColor:f,stages:[t],buffer:void 0,clear:void 0},c.push(r),r)}function Jh(e,t){var a=function(e,t){var a={};if(Object(o.default)(e.ambientOcclusion)){var i=e.ambientOcclusion,r=e.bloom,n=e._tonemapping,s=e.fxaa,l=Zh(e,t,a,i,void 0);l=qh(e,t,a,n,l=Zh(e,t,a,r,l)),qh(e,t,a,s,l=Zh(e,t,a,e,l))}else Zh(e,t,a,e,void 0);return a}(e._collection,t);for(var i in a)a.hasOwnProperty(i)&&(e._stageNameToFramebuffer[i]=Kh(e,i,a[i]))}function $h(e){for(var t=e._framebuffers,a=t.length,i=0;i<a;++i){var r=t[i];r.buffer=r.buffer&&r.buffer.destroy(),r.buffer=void 0}}Xh.prototype.updateDependencies=function(){this._updateDependencies=!0},Xh.prototype.update=function(e){var t=this._collection,a=this._updateDependencies,i=Object(o.default)(t.ambientOcclusion)&&t.ambientOcclusion.enabled&&t.ambientOcclusion._isSupported(e),r=Object(o.default)(t.bloom)&&t.bloom.enabled&&t.bloom._isSupported(e),n=Object(o.default)(t._tonemapping)&&t._tonemapping.enabled&&t._tonemapping._isSupported(e),s=Object(o.default)(t.fxaa)&&t.fxaa.enabled&&t.fxaa._isSupported(e),l=!Object(o.default)(t._activeStages)||t._activeStages.length>0||i||r||n||s;if((a||!l&&this._framebuffers.length>0)&&($h(this),this._framebuffers.length=0,this._stageNameToFramebuffer={},this._width=void 0,this._height=void 0),a||l){0===this._framebuffers.length&&Jh(this,e);var u=e.drawingBufferWidth,d=e.drawingBufferHeight,f=this._width!==u||this._height!==d;(a||f)&&(this._width=u,this._height=d,this._updateDependencies=!1,$h(this),function(e,t){for(var a=e._width,i=e._height,r=e._framebuffers,n=r.length,o=0;o<n;++o){var s=r[o],l=s.textureScale,u=Math.ceil(a*l),d=Math.ceil(i*l),f=Math.min(u,d);s.forcePowerOfTwo&&(K.default.isPowerOfTwo(f)||(f=K.default.nextPowerOfTwo(f)),u=f,d=f),s.buffer=new Ln.a({context:t,colorTextures:[new S.a({context:t,width:u,height:d,pixelFormat:s.pixelFormat,pixelDatatype:s.pixelDatatype})]}),s.clear=new Rn.a({color:s.clearColor,framebuffer:s.buffer})}}(this,e))}},Xh.prototype.clear=function(e){for(var t=this._framebuffers,a=0;a<t.length;++a)t[a].clear.execute(e)},Xh.prototype.getStageByName=function(e){return this._collection.getStageByName(e)},Xh.prototype.getOutputTexture=function(e){return this._collection.getOutputTexture(e)},Xh.prototype.getFramebuffer=function(e){var t=this._stageNameToFramebuffer[e];if(Object(o.default)(t))return t.buffer},Xh.prototype.isDestroyed=function(){return!1},Xh.prototype.destroy=function(){return $h(this),Object(l.default)(this)};var em=Xh,tm={REINHARD:0,MODIFIED_REINHARD:1,FILMIC:2,ACES:3,validate:function(e){return e===tm.REINHARD||e===tm.MODIFIED_REINHARD||e===tm.FILMIC||e===tm.ACES}},am=Object(ie.default)(tm),im=[];function rm(){var e=Yh.createFXAAStage(),t=Yh.createAmbientOcclusionStage(),a=Yh.createBloomStage();this._autoExposureEnabled=!1,this._autoExposure=Yh.createAutoExposureStage(),this._tonemapping=void 0,this._tonemapper=void 0,this.tonemapper=am.ACES;var i=this._tonemapping;e.enabled=!1,t.enabled=!1,a.enabled=!1,i.enabled=!1;var r=new em(this),n={},s=im;for(s.push(e,t,a,i);s.length>0;){var l=s.pop();n[l.name]=l,l._textureCache=r;var u=l.length;if(Object(o.default)(u))for(var d=0;d<u;++d)s.push(l.get(d))}this._stages=[],this._activeStages=[],this._previousActiveStages=[],this._randomTexture=void 0;var f=this;t.uniforms.randomTexture=function(){return f._randomTexture},this._ao=t,this._bloom=a,this._fxaa=e,this._lastLength=void 0,this._aoEnabled=void 0,this._bloomEnabled=void 0,this._tonemappingEnabled=void 0,this._fxaaEnabled=void 0,this._stagesRemoved=!1,this._textureCacheDirty=!1,this._stageNames=n,this._textureCache=r}function nm(e){if(e._stagesRemoved){e._stagesRemoved=!1;for(var t=[],a=e._stages,i=a.length,r=0,n=0;r<i;++r){var o=a[r];o&&(o._index=n++,t.push(o))}e._stages=t}}function om(e){for(;Object(o.default)(e.length);)e=e.get(e.length-1);return e.outputTexture}function sm(e,t,a,i,r){if(Object(o.default)(e.execute))e.execute(t,a,i,r);else{var n,s=e.length;if(e.inputPreviousStageTexture)for(sm(e.get(0),t,a,i,r),n=1;n<s;++n)sm(e.get(n),t,om(e.get(n-1)),i,r);else for(n=0;n<s;++n)sm(e.get(n),t,a,i,r)}}Object(s.default)(rm.prototype,{ready:{get:function(){for(var e=!1,t=this._stages,a=t.length-1;a>=0;--a){var i=t[a];e=e||i.ready&&i.enabled}var r=this._fxaa,n=this._ao,o=this._bloom,s=this._tonemapping;return e=(e=(e=(e=e||r.ready&&r.enabled)||n.ready&&n.enabled)||o.ready&&o.enabled)||s.ready&&s.enabled}},fxaa:{get:function(){return this._fxaa}},ambientOcclusion:{get:function(){return this._ao}},bloom:{get:function(){return this._bloom}},length:{get:function(){return nm(this),this._stages.length}},outputTexture:{get:function(){var e=this._fxaa;if(e.enabled&&e.ready)return this.getOutputTexture(e.name);for(var t=this._stages,a=t.length-1;a>=0;--a){var i=t[a];if(Object(o.default)(i)&&i.ready&&i.enabled)return this.getOutputTexture(i.name)}var r=this._tonemapping;if(r.enabled&&r.ready)return this.getOutputTexture(r.name);var n=this._bloom;if(n.enabled&&n.ready)return this.getOutputTexture(n.name);var s=this._ao;return s.enabled&&s.ready?this.getOutputTexture(s.name):void 0}},hasSelected:{get:function(){for(var e=Object(Ch.a)(this._stages);e.length>0;){var t=e.pop();if(Object(o.default)(t)){if(Object(o.default)(t.selected))return!0;var a=t.length;if(Object(o.default)(a))for(var i=0;i<a;++i)e.push(t.get(i))}}return!1}},tonemapper:{get:function(){return this._tonemapper},set:function(e){if(this._tonemapper!==e){Object(o.default)(this._tonemapping)&&(delete this._stageNames[this._tonemapping.name],this._tonemapping.destroy());var t,a=this._autoExposureEnabled;switch(e){case am.REINHARD:t=Yh.createReinhardTonemappingStage(a);break;case am.MODIFIED_REINHARD:t=Yh.createModifiedReinhardTonemappingStage(a);break;case am.FILMIC:t=Yh.createFilmicTonemappingStage(a);break;default:t=Yh.createAcesTonemappingStage(a)}if(a){var i=this._autoExposure;t.uniforms.autoExposure=function(){return i.outputTexture}}this._tonemapper=e,this._tonemapping=t,Object(o.default)(this._stageNames)&&(this._stageNames[t.name]=t,t._textureCache=this._textureCache),this._textureCacheDirty=!0}}}}),rm.prototype.add=function(e){var t=this._stageNames,a=im;for(a.push(e);a.length>0;){var i=a.pop();t[i.name]=i,i._textureCache=this._textureCache;var r=i.length;if(Object(o.default)(r))for(var n=0;n<r;++n)a.push(i.get(n))}var s=this._stages;return e._index=s.length,s.push(e),this._textureCacheDirty=!0,e},rm.prototype.remove=function(e){if(!this.contains(e))return!1;var t=this._stageNames,a=im;for(a.push(e);a.length>0;){var i=a.pop();delete t[i.name];var r=i.length;if(Object(o.default)(r))for(var n=0;n<r;++n)a.push(i.get(n))}return this._stages[e._index]=void 0,this._stagesRemoved=!0,this._textureCacheDirty=!0,e._index=void 0,e._textureCache=void 0,e.destroy(),!0},rm.prototype.contains=function(e){return Object(o.default)(e)&&Object(o.default)(e._index)&&e._textureCache===this._textureCache},rm.prototype.get=function(e){return nm(this),this._stages[e]},rm.prototype.removeAll=function(){for(var e=this._stages,t=e.length,a=0;a<t;++a)this.remove(e[a]);e.length=0},rm.prototype.getStageByName=function(e){return this._stageNames[e]},rm.prototype.update=function(e,t,a){nm(this);var i=this._activeStages,r=this._activeStages=this._previousActiveStages;this._previousActiveStages=i;var n,s,l=this._stages,u=r.length=l.length,d=0;for(n=0;n<u;++n)(s=l[n]).ready&&s.enabled&&s._isSupported(e)&&(r[d++]=s);r.length=d;var f=d!==i.length;if(!f)for(n=0;n<d;++n)if(r[n]!==i[n]){f=!0;break}var c=this._ao,h=this._bloom,m=this._autoExposure,p=this._tonemapping,_=this._fxaa;p.enabled=a;var g=c.enabled&&c._isSupported(e),v=h.enabled&&h._isSupported(e),y=p.enabled&&p._isSupported(e),b=_.enabled&&_._isSupported(e);if((f||this._textureCacheDirty||d!==this._lastLength||g!==this._aoEnabled||v!==this._bloomEnabled||y!==this._tonemappingEnabled||b!==this._fxaaEnabled)&&(this._textureCache.updateDependencies(),this._lastLength=d,this._aoEnabled=g,this._bloomEnabled=v,this._tonemappingEnabled=y,this._fxaaEnabled=b,this._textureCacheDirty=!1),Object(o.default)(this._randomTexture)&&!g&&(this._randomTexture.destroy(),this._randomTexture=void 0),!Object(o.default)(this._randomTexture)&&g){u=196608;var w=new Uint8Array(u);for(n=0;n<u;n+=3)w[n]=Math.floor(255*Math.random());this._randomTexture=new S.a({context:e,pixelFormat:_e.a.RGB,pixelDatatype:we.a.UNSIGNED_BYTE,source:{arrayBufferView:w,width:256,height:256},sampler:new Oe.a({wrapS:Te.a.REPEAT,wrapT:Te.a.REPEAT,minificationFilter:Ce.a.NEAREST,magnificationFilter:xe.a.NEAREST})})}for(this._textureCache.update(e),_.update(e,t),c.update(e,t),h.update(e,t),p.update(e,t),this._autoExposureEnabled&&m.update(e,t),u=l.length,n=0;n<u;++n)l[n].update(e,t)},rm.prototype.clear=function(e){this._textureCache.clear(e),this._autoExposureEnabled&&this._autoExposure.clear(e)},rm.prototype.getOutputTexture=function(e){var t=this.getStageByName(e);if(Object(o.default)(t))return om(t)},rm.prototype.execute=function(e,t,a,i){var r=this._activeStages,n=r.length,o=this._fxaa,s=this._ao,l=this._bloom,u=this._autoExposure,d=this._tonemapping,f=s.enabled&&s._isSupported(e),c=l.enabled&&l._isSupported(e),h=this._autoExposureEnabled,m=d.enabled&&d._isSupported(e),p=o.enabled&&o._isSupported(e);if(p||f||c||m||0!==n){var _=t;f&&s.ready&&(sm(s,e,_,a,i),_=om(s)),c&&l.ready&&(sm(l,e,_,a,i),_=om(l)),h&&u.ready&&sm(u,e,_,a,i),m&&d.ready&&(sm(d,e,_,a,i),_=om(d));var g=_;if(n>0){sm(r[0],e,_,a,i);for(var v=1;v<n;++v)sm(r[v],e,om(r[v-1]),a,i);g=om(r[n-1])}p&&o.ready&&sm(o,e,g,a,i)}},rm.prototype.copy=function(e,t){if(!Object(o.default)(this._copyColorCommand)){var a=this;this._copyColorCommand=e.createViewportQuadCommand(yd,{uniformMap:{colorTexture:function(){return a.outputTexture}},owner:this})}this._copyColorCommand.framebuffer=t,this._copyColorCommand.execute(e)},rm.prototype.isDestroyed=function(){return!1},rm.prototype.destroy=function(){return this._fxaa.destroy(),this._ao.destroy(),this._bloom.destroy(),this._autoExposure.destroy(),this._tonemapping.destroy(),this.removeAll(),this._textureCache=this._textureCache&&this._textureCache.destroy(),Object(l.default)(this)};var lm=rm,um=a(212);function dm(e){this._scene=e,this._currentTweens=[],this._morphHandler=void 0,this._morphCancelled=!1,this._completeMorph=void 0,this._morphToOrthographic=!1}dm.prototype.completeMorph=function(){Object(o.default)(this._completeMorph)&&this._completeMorph()},dm.prototype.morphTo2D=function(e,t){Object(o.default)(this._completeMorph)&&this._completeMorph();var a=this._scene;this._previousMode=a.mode,this._morphToOrthographic=a.camera.frustum instanceof ee.a,this._previousMode!==L.a.SCENE2D&&this._previousMode!==L.a.MORPHING&&(this._scene.morphStart.raiseEvent(this,this._previousMode,L.a.SCENE2D,!0),a._mode=L.a.MORPHING,a.camera._setTransform(J.default.IDENTITY),this._previousMode===L.a.COLUMBUS_VIEW?function(e,t){t*=.5;var a=e._scene,r=a.camera,n=i.default.clone(r.position,Xm),s=i.default.clone(r.direction,Qm),l=i.default.clone(r.up,qm),u=i.default.negate(i.default.UNIT_Z,Km),d=i.default.clone(i.default.UNIT_Y,Jm),f=Zm;if(t>0)i.default.clone(i.default.ZERO,Zm),f.z=5*a.mapProjection.ellipsoid.maximumRadius;else{i.default.clone(n,Zm);var c=ep;J.default.multiplyByPoint(Zl.TRANSFORM_2D,n,c.origin),J.default.multiplyByPointAsVector(Zl.TRANSFORM_2D,s,c.direction);var h=a.globe;if(Object(o.default)(h)){var m=h.pickWorldCoordinates(c,a,tp);Object(o.default)(m)&&(J.default.multiplyByPoint(Zl.TRANSFORM_2D_INVERSE,m,f),f.z+=i.default.distance(n,f))}}var p=$m;p.right=.5*f.z,p.left=-p.right,p.top=p.right*(a.drawingBufferHeight/a.drawingBufferWidth),p.bottom=-p.top;var _=ap;_.position=f,_.direction=u,_.up=d,_.frustum=p;var g=mp(_);function v(e,t){e.position.z=t}Tm(e,g);var y=a.tweens.add({duration:t,easingFunction:Uo.default.QUARTIC_OUT,startObject:{time:0},stopObject:{time:1},update:function(e){Wm(n,f,e.time,r.position),Wm(s,u,e.time,r.direction),Wm(l,d,e.time,r.up),i.default.cross(r.direction,r.up,r.right),i.default.normalize(r.right,r.right),r._adjustOrthographicFrustum(!0)},complete:function(){Ym(e,t,_,v,g)}});e._currentTweens.push(y)}(this,e):function(e,t,a){t*=.5;var r=e._scene,n=r.camera,s=rp;if(t>0)i.default.clone(i.default.ZERO,s.position),s.position.z=5*a.maximumRadius,i.default.negate(i.default.UNIT_Z,s.direction),i.default.clone(i.default.UNIT_Y,s.up);else{a.cartesianToCartographic(n.positionWC,ip),r.mapProjection.project(ip,s.position),i.default.negate(i.default.UNIT_Z,s.direction),i.default.clone(i.default.UNIT_Y,s.up);var l=sp;i.default.clone(s.position2D,l.origin);var u=i.default.clone(n.directionWC,l.direction),d=a.scaleToGeodeticSurface(n.positionWC,up),f=Br.default.eastNorthUpToFixedFrame(d,a,lp);J.default.inverseTransformation(f,f),J.default.multiplyByPointAsVector(f,u,u),J.default.multiplyByPointAsVector(Zl.TRANSFORM_2D,u,u);var c=r.globe;if(Object(o.default)(c)){var h=c.pickWorldCoordinates(l,r,op);if(Object(o.default)(h)){var m=i.default.distance(s.position2D,h);h.x+=m,i.default.clone(h,s.position2D)}}}function p(e,t){e.position.x=t}J.default.multiplyByPoint(Zl.TRANSFORM_2D,s.position,s.position2D),J.default.multiplyByPointAsVector(Zl.TRANSFORM_2D,s.direction,s.direction2D),J.default.multiplyByPointAsVector(Zl.TRANSFORM_2D,s.up,s.up2D);var _=s.frustum;_.right=.5*s.position.z,_.left=-_.right,_.top=_.right*(r.drawingBufferHeight/r.drawingBufferWidth),_.bottom=-_.top;var g=np;J.default.multiplyByPoint(Zl.TRANSFORM_2D_INVERSE,s.position2D,g.position),i.default.clone(s.direction,g.direction),i.default.clone(s.up,g.up),g.frustum=_;var v=mp(g);Tm(e,v),fp(e,t,s,(function(){Ym(e,t,s,p,v)}))}(this,e,t),0===e&&Object(o.default)(this._completeMorph)&&this._completeMorph())};var fm=new i.default,cm=new i.default,hm=new i.default,mm=new i.default,pm=new i.default,_m=new i.default,gm=new i.default,vm=new y.default,ym=new J.default,bm=new Dn.a,wm=new ee.a,Om={position:void 0,direction:void 0,up:void 0,position2D:void 0,direction2D:void 0,up2D:void 0,frustum:void 0};dm.prototype.morphToColumbusView=function(e,t){Object(o.default)(this._completeMorph)&&this._completeMorph();var a=this._scene;if(this._previousMode=a.mode,this._previousMode!==L.a.COLUMBUS_VIEW&&this._previousMode!==L.a.MORPHING){this._scene.morphStart.raiseEvent(this,this._previousMode,L.a.COLUMBUS_VIEW,!0),a.camera._setTransform(J.default.IDENTITY);var r,n=fm,s=cm,l=hm;if(e>0)n.x=0,n.y=-1,n.z=1,n=i.default.multiplyByScalar(i.default.normalize(n,n),5*t.maximumRadius,n),i.default.negate(i.default.normalize(n,s),s),i.default.cross(i.default.UNIT_X,s,l);else{var u=a.camera;if(this._previousMode===L.a.SCENE2D)i.default.clone(u.position,n),n.z=u.frustum.right-u.frustum.left,i.default.negate(i.default.UNIT_Z,s),i.default.clone(i.default.UNIT_Y,l);else{i.default.clone(u.positionWC,n),i.default.clone(u.directionWC,s),i.default.clone(u.upWC,l);var d=t.scaleToGeodeticSurface(n,gm),f=Br.default.eastNorthUpToFixedFrame(d,t,ym);J.default.inverseTransformation(f,f),a.mapProjection.project(t.cartesianToCartographic(n,vm),n),J.default.multiplyByPointAsVector(f,s,s),J.default.multiplyByPointAsVector(f,l,l)}}this._morphToOrthographic?((r=wm).width=a.camera.frustum.right-a.camera.frustum.left,r.aspectRatio=a.drawingBufferWidth/a.drawingBufferHeight):((r=bm).aspectRatio=a.drawingBufferWidth/a.drawingBufferHeight,r.fov=K.default.toRadians(60));var c=Om;c.position=n,c.direction=s,c.up=l,c.frustum=r;var h=function(e){return function(t){var a=t._scene;a._mode=L.a.COLUMBUS_VIEW,a.morphTime=L.a.getMorphTime(L.a.COLUMBUS_VIEW),Em(t);var r=a.camera;(t._previousModeMode!==L.a.MORPHING||t._morphCancelled)&&(t._morphCancelled=!1,i.default.clone(e.position,r.position),i.default.clone(e.direction,r.direction),i.default.clone(e.up,r.up),i.default.cross(r.direction,r.up,r.right),i.default.normalize(r.right,r.right));var n=r.frustum;a.frameState.useLogDepth&&(n.near=.1,n.far=1e10);var s=Object(o.default)(t._completeMorph);t._completeMorph=void 0,a.camera.update(a.mode),t._scene.morphComplete.raiseEvent(t,t._previousMode,L.a.COLUMBUS_VIEW,s)}}(c);Tm(this,h),this._previousMode===L.a.SCENE2D?function(e,t,a,r){t*=.5;var n=e._scene,o=n.camera,s=i.default.clone(a.position,Hm),l=i.default.clone(a.direction,km),u=i.default.clone(a.up,Gm);function d(){o.frustum=a.frustum.clone();var d=i.default.clone(o.position,Um),f=i.default.clone(o.direction,zm),c=i.default.clone(o.up,Bm);d.z=s.z;var h=n.tweens.add({duration:t,easingFunction:Uo.default.QUARTIC_OUT,startObject:{time:0},stopObject:{time:1},update:function(e){Wm(d,s,e.time,o.position),Wm(f,l,e.time,o.direction),Wm(c,u,e.time,o.up),i.default.cross(o.direction,o.up,o.right),i.default.normalize(o.right,o.right)},complete:function(){r(e)}});e._currentTweens.push(h)}n._mode=L.a.MORPHING,e._morphToOrthographic?d():dp(e,0,a,d)}(this,e,c,h):(c.position2D=J.default.multiplyByPoint(Zl.TRANSFORM_2D,n,mm),c.direction2D=J.default.multiplyByPointAsVector(Zl.TRANSFORM_2D,s,pm),c.up2D=J.default.multiplyByPointAsVector(Zl.TRANSFORM_2D,l,_m),a._mode=L.a.MORPHING,fp(this,e,c,h)),0===e&&Object(o.default)(this._completeMorph)&&this._completeMorph()}};var xm={position:new i.default,direction:new i.default,up:new i.default,frustum:void 0},Cm=new Dn.a;function Tm(e,t){if(e._scene.completeMorphOnUserInput){e._morphHandler=new m.default(e._scene.canvas);var a=function(){e._morphCancelled=!0,e._scene.camera.cancelFlight(),t(e)};e._completeMorph=a,e._morphHandler.setInputAction(a,um.default.LEFT_DOWN),e._morphHandler.setInputAction(a,um.default.MIDDLE_DOWN),e._morphHandler.setInputAction(a,um.default.RIGHT_DOWN),e._morphHandler.setInputAction(a,um.default.WHEEL)}}function Em(e){for(var t=e._currentTweens,a=0;a<t.length;++a)t[a].cancelTween();e._currentTweens.length=0,e._morphHandler=e._morphHandler&&e._morphHandler.destroy()}dm.prototype.morphTo3D=function(e,t){Object(o.default)(this._completeMorph)&&this._completeMorph();var a=this._scene;if(this._previousMode=a.mode,this._previousMode!==L.a.SCENE3D&&this._previousMode!==L.a.MORPHING){if(this._scene.morphStart.raiseEvent(this,this._previousMode,L.a.SCENE3D,!0),a._mode=L.a.MORPHING,a.camera._setTransform(J.default.IDENTITY),this._previousMode===L.a.SCENE2D)!function(e,t,a){t/=3;var r,n,o=e._scene,s=o.camera;t>0?(r=xm,i.default.fromDegrees(0,0,5*a.maximumRadius,a,r.position),i.default.negate(r.position,r.direction),i.default.normalize(r.direction,r.direction),i.default.clone(i.default.UNIT_Z,r.up)):(s.position.z=s.frustum.right-s.frustum.left,r=Dm(e,a));e._morphToOrthographic?((n=Vm).aspectRatio=o.drawingBufferWidth/o.drawingBufferHeight,n.width=s.frustum.right-s.frustum.left):((n=Cm).aspectRatio=o.drawingBufferWidth/o.drawingBufferHeight,n.fov=K.default.toRadians(60));r.frustum=n;var l,u=hp(r);Tm(e,u),l=e._morphToOrthographic?function(){jm(e,t,r,u)}:function(){dp(e,t,r,(function(){jm(e,t,r,u)}))};t>0?(o._mode=L.a.SCENE2D,s.flyTo({duration:t,destination:i.default.fromDegrees(0,0,5*a.maximumRadius,a,Hm),complete:function(){o._mode=L.a.MORPHING,l()}})):l()}(this,e,t);else{var r,n;e>0?(r=xm,i.default.fromDegrees(0,0,5*t.maximumRadius,t,r.position),i.default.negate(r.position,r.direction),i.default.normalize(r.direction,r.direction),i.default.clone(i.default.UNIT_Z,r.up)):r=Dm(this,t);var s=a.camera;s.frustum instanceof ee.a?n=s.frustum.clone():((n=Cm).aspectRatio=a.drawingBufferWidth/a.drawingBufferHeight,n.fov=K.default.toRadians(60)),r.frustum=n;var l=hp(r);Tm(this,l),jm(this,e,r,l)}0===e&&Object(o.default)(this._completeMorph)&&this._completeMorph()}},dm.prototype.isDestroyed=function(){return!1},dm.prototype.destroy=function(){return Em(this),Object(l.default)(this)};var Am=new y.default,Sm=new i.default,Pm=new J.default;function Dm(e,t){var a=e._scene,i=a.camera,r=xm,n=r.position,o=r.direction,s=r.up,l=a.mapProjection.unproject(i.position,Am);t.cartographicToCartesian(l,n);var u=t.scaleToGeodeticSurface(n,Sm),d=Br.default.eastNorthUpToFixedFrame(u,t,Pm);return J.default.multiplyByPointAsVector(d,i.direction,o),J.default.multiplyByPointAsVector(d,i.up,s),r}var Im=new i.default,Mm=new i.default,Fm=new i.default,Rm=new i.default,Nm=new i.default,Lm=new i.default;function jm(e,t,a,r){t*=.5;var n=e._scene,o=n.camera,s=i.default.clone(o.position,Im),l=i.default.clone(o.direction,Mm),u=i.default.clone(o.up,Fm),d=J.default.multiplyByPoint(Zl.TRANSFORM_2D_INVERSE,a.position,Rm),f=J.default.multiplyByPointAsVector(Zl.TRANSFORM_2D_INVERSE,a.direction,Nm),c=J.default.multiplyByPointAsVector(Zl.TRANSFORM_2D_INVERSE,a.up,Lm);var h=n.tweens.add({duration:t,easingFunction:Uo.default.QUARTIC_OUT,startObject:{time:0},stopObject:{time:1},update:function(e){Wm(s,d,e.time,o.position),Wm(l,f,e.time,o.direction),Wm(u,c,e.time,o.up),i.default.cross(o.direction,o.up,o.right),i.default.normalize(o.right,o.right)},complete:function(){cp(e,n,0,1,t,r)}});e._currentTweens.push(h)}var Vm=new ee.a,Um=new i.default,zm=new i.default,Bm=new i.default,Hm=new i.default,km=new i.default,Gm=new i.default;function Wm(e,t,a,r){return i.default.lerp(e,t,a,r)}function Ym(e,t,a,i,r){var n=e._scene,o=n.camera;if(!(o.frustum instanceof ee.a)){var s=o.frustum.fov,l=.5*K.default.RADIANS_PER_DEGREE,u=a.position.z*Math.tan(.5*s);o.frustum.far=u/Math.tan(.5*l)+1e7;var d=n.tweens.add({duration:t,easingFunction:Uo.default.QUARTIC_OUT,startObject:{time:0},stopObject:{time:1},update:function(e){o.frustum.fov=K.default.lerp(s,l,e.time);var t=u/Math.tan(.5*o.frustum.fov);i(o,t)},complete:function(){o.frustum=a.frustum.clone(),r(e)}});e._currentTweens.push(d)}}var Xm=new i.default,Qm=new i.default,qm=new i.default,Zm=new i.default,Km=new i.default,Jm=new i.default,$m=new ha.a,ep=new C.default,tp=new i.default,ap={position:void 0,direction:void 0,up:void 0,frustum:void 0};var ip=new y.default,rp={position:new i.default,direction:new i.default,up:new i.default,position2D:new i.default,direction2D:new i.default,up2D:new i.default,frustum:new ha.a},np={position:new i.default,direction:new i.default,up:new i.default,frustum:void 0},op=new i.default,sp=new C.default,lp=new J.default,up=new i.default;function dp(e,t,a,i){var r=e._scene,n=r.camera,o=n.frustum.right-n.frustum.left;n.frustum=a.frustum.clone();var s=n.frustum.fov,l=.5*K.default.RADIANS_PER_DEGREE,u=o*Math.tan(.5*s);n.frustum.far=u/Math.tan(.5*l)+1e7,n.frustum.fov=l;var d=r.tweens.add({duration:t,easingFunction:Uo.default.QUARTIC_OUT,startObject:{time:0},stopObject:{time:1},update:function(e){n.frustum.fov=K.default.lerp(l,s,e.time),n.position.z=u/Math.tan(.5*n.frustum.fov)},complete:function(){i(e)}});e._currentTweens.push(d)}function fp(e,t,a,r){var n=e._scene,o=n.camera,s=i.default.clone(o.position,Um),l=i.default.clone(o.direction,zm),u=i.default.clone(o.up,Bm),d=i.default.clone(a.position2D,Hm),f=i.default.clone(a.direction2D,km),c=i.default.clone(a.up2D,Gm);var h=n.tweens.add({duration:t,easingFunction:Uo.default.QUARTIC_OUT,startObject:{time:0},stopObject:{time:1},update:function(e){Wm(s,d,e.time,o.position),Wm(l,f,e.time,o.direction),Wm(u,c,e.time,o.up),i.default.cross(o.direction,o.up,o.right),i.default.normalize(o.right,o.right),o._adjustOrthographicFrustum(!0)},complete:function(){cp(e,n,1,0,t,r)}});e._currentTweens.push(h)}function cp(e,t,a,i,r,n){var s={object:t,property:"morphTime",startValue:a,stopValue:i,duration:r,easingFunction:Uo.default.QUARTIC_OUT};Object(o.default)(n)&&(s.complete=function(){n(e)});var l=t.tweens.addProperty(s);e._currentTweens.push(l)}function hp(e){return function(t){var a=t._scene;a._mode=L.a.SCENE3D,a.morphTime=L.a.getMorphTime(L.a.SCENE3D),Em(t);var r=a.camera;(t._previousMode!==L.a.MORPHING||t._morphCancelled)&&(t._morphCancelled=!1,i.default.clone(e.position,r.position),i.default.clone(e.direction,r.direction),i.default.clone(e.up,r.up),i.default.cross(r.direction,r.up,r.right),i.default.normalize(r.right,r.right),r.frustum=e.frustum.clone());var n=r.frustum;a.frameState.useLogDepth&&(n.near=.1,n.far=1e10);var s=Object(o.default)(t._completeMorph);t._completeMorph=void 0,a.camera.update(a.mode),t._scene.morphComplete.raiseEvent(t,t._previousMode,L.a.SCENE3D,s)}}function mp(e){return function(t){var a=t._scene;a._mode=L.a.SCENE2D,a.morphTime=L.a.getMorphTime(L.a.SCENE2D),Em(t);var r=a.camera;i.default.clone(e.position,r.position),r.position.z=2*a.mapProjection.ellipsoid.maximumRadius,i.default.clone(e.direction,r.direction),i.default.clone(e.up,r.up),i.default.cross(r.direction,r.up,r.right),i.default.normalize(r.right,r.right),r.frustum=e.frustum.clone();var n=Object(o.default)(t._completeMorph);t._completeMorph=void 0,a.camera.update(a.mode),t._scene.morphComplete.raiseEvent(t,t._previousMode,L.a.SCENE2D,n)}}var pp=dm,_p=a(90),gp=a(273),vp=a(139),yp=Object(ie.default)({LEFT_DRAG:0,RIGHT_DRAG:1,MIDDLE_DRAG:2,WHEEL:3,PINCH:4});function bp(e,t){var a=e;return Object(o.default)(t)&&(a+="+"+t),a}function wp(e,t,a){var i=bp(yp.PINCH,t),r=e._update,n=e._isDown,s=e._eventStartPosition,l=e._pressTime,u=e._releaseTime;r[i]=!0,n[i]=!1,s[i]=new B.default;var d=e._movement[i];Object(o.default)(d)||(d=e._movement[i]={}),d.distance={startPosition:new B.default,endPosition:new B.default},d.angleAndHeight={startPosition:new B.default,endPosition:new B.default},d.prevAngle=0,e._eventHandler.setInputAction((function(t){e._buttonsDown++,n[i]=!0,l[i]=new Date,B.default.lerp(t.position1,t.position2,.5,s[i])}),um.default.PINCH_START,t),e._eventHandler.setInputAction((function(){e._buttonsDown=Math.max(e._buttonsDown-1,0),n[i]=!1,u[i]=new Date}),um.default.PINCH_END,t),e._eventHandler.setInputAction((function(e){if(n[i]){r[i]?(l=e,u=d,B.default.clone(l.distance.startPosition,u.distance.startPosition),B.default.clone(l.distance.endPosition,u.distance.endPosition),B.default.clone(l.angleAndHeight.startPosition,u.angleAndHeight.startPosition),B.default.clone(l.angleAndHeight.endPosition,u.angleAndHeight.endPosition),r[i]=!1,d.prevAngle=d.angleAndHeight.startPosition.x):(B.default.clone(e.distance.endPosition,d.distance.endPosition),B.default.clone(e.angleAndHeight.endPosition,d.angleAndHeight.endPosition));for(var t=d.angleAndHeight.endPosition.x,o=d.prevAngle,s=2*Math.PI;t>=o+Math.PI;)t-=s;for(;t<o-Math.PI;)t+=s;d.angleAndHeight.endPosition.x=-t*a.clientWidth/12,d.angleAndHeight.startPosition.x=-o*a.clientWidth/12}var l,u}),um.default.PINCH_MOVE,t)}function Op(e,t){var a=bp(yp.WHEEL,t),i=e._update;i[a]=!0;var r=e._movement[a];Object(o.default)(r)||(r=e._movement[a]={}),r.startPosition=new B.default,r.endPosition=new B.default,e._eventHandler.setInputAction((function(e){var t=15*K.default.toRadians(e);i[a]?(B.default.clone(B.default.ZERO,r.startPosition),r.endPosition.x=0,r.endPosition.y=t,i[a]=!1):r.endPosition.y=r.endPosition.y+t}),um.default.WHEEL,t)}function xp(e,t,a){var i=bp(a,t),r=e._isDown,n=e._eventStartPosition,s=e._pressTime,l=e._releaseTime;r[i]=!1,n[i]=new B.default;var u,d,f=e._lastMovement[i];Object(o.default)(f)||(f=e._lastMovement[i]={startPosition:new B.default,endPosition:new B.default,valid:!1}),a===yp.LEFT_DRAG?(u=um.default.LEFT_DOWN,d=um.default.LEFT_UP):a===yp.RIGHT_DRAG?(u=um.default.RIGHT_DOWN,d=um.default.RIGHT_UP):a===yp.MIDDLE_DRAG&&(u=um.default.MIDDLE_DOWN,d=um.default.MIDDLE_UP),e._eventHandler.setInputAction((function(t){e._buttonsDown++,f.valid=!1,r[i]=!0,s[i]=new Date,B.default.clone(t.position,n[i])}),u,t),e._eventHandler.setInputAction((function(){e._buttonsDown=Math.max(e._buttonsDown-1,0),r[i]=!1,l[i]=new Date}),d,t)}function Cp(e,t){B.default.clone(e.startPosition,t.startPosition),B.default.clone(e.endPosition,t.endPosition)}function Tp(e,t){var a=e._update,i=e._movement,r=e._lastMovement,n=e._isDown;for(var s in yp)if(yp.hasOwnProperty(s)){var l=yp[s];if(Object(o.default)(l)){var u=bp(l,t);a[u]=!0,Object(o.default)(e._lastMovement[u])||(e._lastMovement[u]={startPosition:new B.default,endPosition:new B.default,valid:!1}),Object(o.default)(e._movement[u])||(e._movement[u]={startPosition:new B.default,endPosition:new B.default})}}e._eventHandler.setInputAction((function(s){for(var l in yp)if(yp.hasOwnProperty(l)){var u=yp[l];if(Object(o.default)(u)){var d=bp(u,t);n[d]&&(a[d]?(Cp(i[d],r[d]),r[d].valid=!0,Cp(s,i[d]),a[d]=!1):B.default.clone(s.endPosition,i[d].endPosition))}}B.default.clone(s.endPosition,e._currentMousePosition)}),um.default.MOUSE_MOVE,t)}function Ep(e){for(var t in this._eventHandler=new m.default(e),this._update={},this._movement={},this._lastMovement={},this._isDown={},this._eventStartPosition={},this._pressTime={},this._releaseTime={},this._buttonsDown=0,this._currentMousePosition=new B.default,Op(this,void 0),wp(this,void 0,e),xp(this,void 0,yp.LEFT_DRAG),xp(this,void 0,yp.RIGHT_DRAG),xp(this,void 0,yp.MIDDLE_DRAG),Tp(this,void 0),gp.default)if(gp.default.hasOwnProperty(t)){var a=gp.default[t];Object(o.default)(a)&&(Op(this,a),wp(this,a,e),xp(this,a,yp.LEFT_DRAG),xp(this,a,yp.RIGHT_DRAG),xp(this,a,yp.MIDDLE_DRAG),Tp(this,a))}}Object(s.default)(Ep.prototype,{currentMousePosition:{get:function(){return this._currentMousePosition}},anyButtonDown:{get:function(){var e=!(this._update[bp(yp.WHEEL)]&&this._update[bp(yp.WHEEL,gp.default.SHIFT)]&&this._update[bp(yp.WHEEL,gp.default.CTRL)]&&this._update[bp(yp.WHEEL,gp.default.ALT)]);return this._buttonsDown>0||e}}}),Ep.prototype.isMoving=function(e,t){var a=bp(e,t);return!this._update[a]},Ep.prototype.getMovement=function(e,t){var a=bp(e,t);return this._movement[a]},Ep.prototype.getLastMovement=function(e,t){var a=bp(e,t),i=this._lastMovement[a];if(i.valid)return i},Ep.prototype.isButtonDown=function(e,t){var a=bp(e,t);return this._isDown[a]},Ep.prototype.getStartMousePosition=function(e,t){if(e===yp.WHEEL)return this._currentMousePosition;var a=bp(e,t);return this._eventStartPosition[a]},Ep.prototype.getButtonPressTime=function(e,t){var a=bp(e,t);return this._pressTime[a]},Ep.prototype.getButtonReleaseTime=function(e,t){var a=bp(e,t);return this._releaseTime[a]},Ep.prototype.reset=function(){for(var e in this._update)this._update.hasOwnProperty(e)&&(this._update[e]=!0)},Ep.prototype.isDestroyed=function(){return!1},Ep.prototype.destroy=function(){return this._eventHandler=this._eventHandler&&this._eventHandler.destroy(),Object(l.default)(this)};var Ap=Ep,Sp=a(401);function Pp(e){this.enableInputs=!0,this.enableTranslate=!0,this.enableZoom=!0,this.enableRotate=!0,this.enableTilt=!0,this.enableLook=!0,this.inertiaSpin=.9,this.inertiaTranslate=.9,this.inertiaZoom=.8,this.maximumMovementRatio=.1,this.bounceAnimationTime=3,this.minimumZoomDistance=1,this.maximumZoomDistance=Number.POSITIVE_INFINITY,this.translateEventTypes=yp.LEFT_DRAG,this.zoomEventTypes=[yp.RIGHT_DRAG,yp.WHEEL,yp.PINCH],this.rotateEventTypes=yp.LEFT_DRAG,this.tiltEventTypes=[yp.MIDDLE_DRAG,yp.PINCH,{eventType:yp.LEFT_DRAG,modifier:gp.default.CTRL},{eventType:yp.RIGHT_DRAG,modifier:gp.default.CTRL}],this.lookEventTypes={eventType:yp.LEFT_DRAG,modifier:gp.default.SHIFT},this.minimumPickingTerrainHeight=15e4,this._minimumPickingTerrainHeight=this.minimumPickingTerrainHeight,this.minimumCollisionTerrainHeight=15e3,this._minimumCollisionTerrainHeight=this.minimumCollisionTerrainHeight,this.minimumTrackBallHeight=75e5,this._minimumTrackBallHeight=this.minimumTrackBallHeight,this.enableCollisionDetection=!0,this._scene=e,this._globe=void 0,this._ellipsoid=void 0,this._aggregator=new Ap(e.canvas),this._lastInertiaSpinMovement=void 0,this._lastInertiaZoomMovement=void 0,this._lastInertiaTranslateMovement=void 0,this._lastInertiaTiltMovement=void 0,this._tweens=new Sp.default,this._tween=void 0,this._horizontalRotationAxis=void 0,this._tiltCenterMousePosition=new B.default(-1,-1),this._tiltCenter=new i.default,this._rotateMousePosition=new B.default(-1,-1),this._rotateStartPosition=new i.default,this._strafeStartPosition=new i.default,this._zoomMouseStart=new B.default(-1,-1),this._zoomWorldPosition=new i.default,this._useZoomWorldPosition=!1,this._tiltCVOffMap=!1,this._looking=!1,this._rotating=!1,this._strafing=!1,this._zoomingOnVector=!1,this._rotatingZoom=!1,this._adjustedHeightForTerrain=!1;var t=e.mapProjection;this._maxCoord=t.project(new y.default(Math.PI,K.default.PI_OVER_TWO)),this._zoomFactor=5,this._rotateFactor=void 0,this._rotateRateRangeAdjustment=void 0,this._maximumRotateRate=1.77,this._minimumRotateRate=2e-4,this._minimumZoomRate=20,this._maximumZoomRate=5906376272e3}var Dp=.4;function Ip(e,t,a,i,r,n,s){var l=n[s];Object(o.default)(l)||(l=n[s]={startPosition:new B.default,endPosition:new B.default,motion:new B.default,active:!1});var u,d=e.getButtonPressTime(t,a),f=e.getButtonReleaseTime(t,a),c=d&&f&&(f.getTime()-d.getTime())/1e3,h=new Date,m=f&&(h.getTime()-f.getTime())/1e3;if(d&&f&&c<Dp){var p=function(e,t){if(e<0)return 0;var a=25*(1-t);return Math.exp(-a*e)}(m,i);if(l.active)l.startPosition=B.default.clone(l.endPosition,l.startPosition),l.endPosition=B.default.multiplyByScalar(l.motion,p,l.endPosition),l.endPosition=B.default.add(l.startPosition,l.endPosition,l.endPosition),l.motion=B.default.clone(B.default.ZERO,l.motion);else{var _=e.getLastMovement(t,a);if(!Object(o.default)(_)||(u=_,B.default.equalsEpsilon(u.startPosition,u.endPosition,K.default.EPSILON14)))return;l.motion.x=.5*(_.endPosition.x-_.startPosition.x),l.motion.y=.5*(_.endPosition.y-_.startPosition.y),l.startPosition=B.default.clone(_.startPosition,l.startPosition),l.endPosition=B.default.multiplyByScalar(l.motion,p,l.endPosition),l.endPosition=B.default.add(l.startPosition,l.endPosition,l.endPosition),l.active=!0}if(isNaN(l.endPosition.x)||isNaN(l.endPosition.y)||B.default.distance(l.startPosition,l.endPosition)<.5)return void(l.active=!1);if(!e.isButtonDown(t,a))r(n,e.getStartMousePosition(t,a),l)}else l.active=!1}var Mp=[];function Fp(e,t,a,i,r,n){if(Object(o.default)(a)){var s=e._aggregator;Object(_p.default)(a)||(Mp[0]=a,a=Mp);for(var l=a.length,u=0;u<l;++u){var d=a[u],f=Object(o.default)(d.eventType)?d.eventType:d,c=d.modifier,h=s.isMoving(f,c)&&s.getMovement(f,c),m=s.getStartMousePosition(f,c);e.enableInputs&&t&&(h?i(e,m,h):r<1&&Ip(s,f,c,r,i,e,n))}}}var Rp=new C.default,Np=new i.default,Lp=new B.default,jp=new i.default,Vp=new B.default,Up=new i.default,zp=new i.default,Bp=new i.default,Hp=new i.default,kp=new i.default,Gp=new i.default,Wp=new i.default,Yp=new i.default,Xp=new i.default,Qp=new i.default,qp=new i.default,Zp=new i.default,Kp=new i.default,Jp=new i.default,$p=new i.default,e_=new i.default,t_=new i.default,a_=new i.default,i_={orientation:new Ho.default};function r_(e,t,a,r,n,s){var l=1;Object(o.default)(s)&&(l=K.default.clamp(Math.abs(s),.25,1));var u=e.minimumZoomDistance*l,d=e.maximumZoomDistance,f=r*(n-u);f=K.default.clamp(f,e._minimumZoomRate,e._maximumZoomRate);var c=(a.endPosition.y-a.startPosition.y)/e._scene.canvas.clientHeight,h=f*(c=Math.min(c,e.maximumMovementRatio));if(!(h>0&&Math.abs(n-u)<1||h<0&&Math.abs(n-d)<1)){n-h<u?h=n-u-1:n-h>d&&(h=n-d);var m=e._scene,p=m.camera,_=m.mode,g=i_.orientation;if(g.heading=p.heading,g.pitch=p.pitch,g.roll=p.roll,p.frustum instanceof ee.a)Math.abs(h)>0&&(p.zoomIn(h),p._adjustOrthographicFrustum());else{var v,y=B.default.equals(t,e._zoomMouseStart),b=e._zoomingOnVector,w=e._rotatingZoom;if(y||(e._zoomMouseStart=B.default.clone(t,e._zoomMouseStart),Object(o.default)(e._globe)&&(_===L.a.SCENE2D?(v=p.getPickRay(t,Rp).origin,v=i.default.fromElements(v.y,v.z,v.x)):v=__(e,t,Np)),Object(o.default)(v)?(e._useZoomWorldPosition=!0,e._zoomWorldPosition=i.default.clone(v,e._zoomWorldPosition)):e._useZoomWorldPosition=!1,b=e._zoomingOnVector=!1,w=e._rotatingZoom=!1),e._useZoomWorldPosition){var O=_===L.a.COLUMBUS_VIEW;if(p.positionCartographic.height<2e6&&(w=!0),!y||w){if(_===L.a.SCENE2D){var x=e._zoomWorldPosition,C=p.position;if(!i.default.equals(x,C)&&p.positionCartographic.height<2*e._maxCoord.x){var T=p.position.x,E=i.default.subtract(x,C,jp);i.default.normalize(E,E);var A=i.default.distance(x,C)*h/(.5*p.getMagnitude());p.move(E,.5*A),(p.position.x<0&&T>0||p.position.x>0&&T<0)&&(v=p.getPickRay(t,Rp).origin,v=i.default.fromElements(v.y,v.z,v.x),e._zoomWorldPosition=i.default.clone(v,e._zoomWorldPosition))}}else if(_===L.a.SCENE3D){var S=i.default.normalize(p.position,kp);if(p.positionCartographic.height<3e3&&Math.abs(i.default.dot(p.direction,S))<.6)O=!0;else{var P=m.canvas,D=Vp;D.x=P.clientWidth/2,D.y=P.clientHeight/2;var I=__(e,D,Up);if(Object(o.default)(I)&&p.positionCartographic.height<1e6){var M=Wp;i.default.clone(p.position,M);var F=e._zoomWorldPosition,R=Gp;if(R=i.default.normalize(F,R),i.default.dot(R,S)<0)return;var N=$p,j=Qp;i.default.clone(p.direction,j),i.default.add(M,i.default.multiplyByScalar(j,1e3,e_),N);var V=qp,U=Zp;i.default.subtract(F,M,V),i.default.normalize(V,U);var z=i.default.dot(S,U);if(z>=0)return void(e._zoomMouseStart.x=-1);var H=Math.acos(-z),k=i.default.magnitude(M),G=i.default.magnitude(F),W=k-h,Y=i.default.magnitude(V),X=Math.asin(K.default.clamp(Y/G*Math.sin(H),-1,1))-Math.asin(K.default.clamp(W/G*Math.sin(H),-1,1))+H,Q=Yp;i.default.normalize(M,Q);var q=Xp;q=i.default.cross(U,Q,q),q=i.default.normalize(q,q),i.default.normalize(i.default.cross(Q,q,e_),j),i.default.multiplyByScalar(i.default.normalize(N,e_),i.default.magnitude(N)-h,N),i.default.normalize(M,M),i.default.multiplyByScalar(M,W,M);var Z=Kp;i.default.multiplyByScalar(i.default.add(i.default.multiplyByScalar(Q,Math.cos(X)-1,t_),i.default.multiplyByScalar(j,Math.sin(X),a_),e_),W,Z),i.default.add(M,Z,M),i.default.normalize(N,Q),i.default.normalize(i.default.cross(Q,q,e_),j);var J=Jp;return i.default.multiplyByScalar(i.default.add(i.default.multiplyByScalar(Q,Math.cos(X)-1,t_),i.default.multiplyByScalar(j,Math.sin(X),a_),e_),i.default.magnitude(N),J),i.default.add(N,J,N),i.default.clone(M,p.position),i.default.normalize(i.default.subtract(N,M,e_),p.direction),i.default.clone(p.direction,p.direction),i.default.cross(p.direction,p.up,p.right),i.default.cross(p.right,p.direction,p.up),void p.setView(i_)}if(Object(o.default)(I)){var $=i.default.normalize(I,zp),te=i.default.normalize(e._zoomWorldPosition,Bp),ae=i.default.dot(te,$);if(ae>0&&ae<1){var ie=K.default.acosClamped(ae),re=i.default.cross(te,$,Hp),ne=h/(Math.abs(ie)>K.default.toRadians(20)?.75*p.positionCartographic.height:p.positionCartographic.height-h);p.rotate(re,ie*ne)}}else O=!0}}e._rotatingZoom=!O}if(!y&&O||b){var oe=af.default.wgs84ToWindowCoordinates(m,e._zoomWorldPosition,Lp),se=(_!==L.a.COLUMBUS_VIEW&&B.default.equals(t,e._zoomMouseStart)&&Object(o.default)(oe)?p.getPickRay(oe,Rp):p.getPickRay(t,Rp)).direction;_!==L.a.COLUMBUS_VIEW&&_!==L.a.SCENE2D||i.default.fromElements(se.y,se.z,se.x,se),p.move(se,h),e._zoomingOnVector=!0}else p.zoomIn(h);p.setView(i_)}else p.zoomIn(h)}}}var n_=new C.default,o_=new C.default,s_=new i.default;function l_(e,t,a){var r=e._scene.camera,n=r.getPickRay(a.startPosition,n_).origin,o=r.getPickRay(a.endPosition,o_).origin;n=i.default.fromElements(n.y,n.z,n.x,n),o=i.default.fromElements(o.y,o.z,o.x,o);var s=i.default.subtract(n,o,s_),l=i.default.magnitude(s);l>0&&(i.default.normalize(s,s),r.move(s,l))}function u_(e,t,a){Object(o.default)(a.distance)&&(a=a.distance);var i=e._scene.camera;r_(e,t,a,e._zoomFactor,i.getMagnitude())}var d_=new B.default,f_=new B.default;function c_(e,t,a){if(Object(o.default)(a.angleAndHeight))!function(e,t,a){var i=e._rotateFactor*e._rotateRateRangeAdjustment;i>e._maximumRotateRate&&(i=e._maximumRotateRate);i<e._minimumRotateRate&&(i=e._minimumRotateRate);var r=e._scene,n=r.camera,o=r.canvas,s=(a.endPosition.x-a.startPosition.x)/o.clientWidth;s=Math.min(s,e.maximumMovementRatio);var l=i*s*Math.PI*4;n.twistRight(l)}(e,0,a.angleAndHeight);else{var i=e._scene,r=i.camera,n=i.canvas,s=n.clientWidth,l=n.clientHeight,u=d_;u.x=2/s*a.startPosition.x-1,u.y=2/l*(l-a.startPosition.y)-1,u=B.default.normalize(u,u);var d=f_;d.x=2/s*a.endPosition.x-1,d.y=2/l*(l-a.endPosition.y)-1,d=B.default.normalize(d,d);var f=K.default.acosClamped(u.x);u.y<0&&(f=K.default.TWO_PI-f);var c=K.default.acosClamped(d.x);d.y<0&&(c=K.default.TWO_PI-c);var h=c-f;r.twistRight(h)}}var h_=new C.default,m_=new i.default,p_=new i.default;function __(e,t,a){var r=e._scene,n=e._globe,s=r.camera;if(Object(o.default)(n)){var l;r.pickPositionSupported&&(l=r.pickPositionWorldCoordinates(t,m_));var u=s.getPickRay(t,h_),d=n.pickWorldCoordinates(u,r,p_);return(Object(o.default)(l)?i.default.distance(l,s.positionWC):Number.POSITIVE_INFINITY)<(Object(o.default)(d)?i.default.distance(d,s.positionWC):Number.POSITIVE_INFINITY)?i.default.clone(l,a):i.default.clone(d,a)}}var g_=new C.default,v_=new C.default,y_=new i.default,b_=new i.default,w_=new i.default,O_=new i.default,x_=new vp.a(i.default.UNIT_X,0),C_=new B.default,T_=new B.default;function E_(e,t,a){if(i.default.equals(t,e._translateMousePosition)||(e._looking=!1),i.default.equals(t,e._strafeMousePosition)||(e._strafing=!1),e._looking)Lg(e,t,a);else if(e._strafing)K_(e,t,a);else{var r,n=e._scene.camera,s=B.default.clone(a.startPosition,C_),l=B.default.clone(a.endPosition,T_),u=n.getPickRay(s,g_),d=i.default.clone(i.default.ZERO,O_),f=i.default.UNIT_X;if(n.position.z<e._minimumPickingTerrainHeight&&(r=__(e,s,y_),Object(o.default)(r)&&(d.x=r.x)),d.x>n.position.z&&Object(o.default)(r))return i.default.clone(r,e._strafeStartPosition),e._strafing=!0,K_(e,t,a),void(e._strafeMousePosition=B.default.clone(t,e._strafeMousePosition));var c=vp.a.fromPointNormal(d,f,x_);u=n.getPickRay(s,g_);var h=x.default.rayPlane(u,c,y_),m=n.getPickRay(l,v_),p=x.default.rayPlane(m,c,b_);if(!Object(o.default)(h)||!Object(o.default)(p))return e._looking=!0,Lg(e,t,a),void B.default.clone(t,e._translateMousePosition);var _=i.default.subtract(h,p,w_),g=_.x;_.x=_.y,_.y=_.z,_.z=g;var v=i.default.magnitude(_);v>K.default.EPSILON6&&(i.default.normalize(_,_),n.move(_,v))}}var A_=new B.default,S_=new C.default,P_=new i.default,D_=new i.default,I_=new J.default,M_=new J.default,F_=new i.default,R_=new vp.a(i.default.UNIT_X,0),N_=new i.default,L_=new y.default,j_=new J.default,V_=new gi.default,U_=new _i.default,z_=new i.default;function B_(e,t,a){if(Object(o.default)(a.angleAndHeight)&&(a=a.angleAndHeight),B.default.equals(t,e._tiltCenterMousePosition)||(e._tiltCVOffMap=!1,e._looking=!1),e._looking)Lg(e,t,a);else{var r=e._scene.camera,n=e._maxCoord,s=Math.abs(r.position.x)-n.x<0&&Math.abs(r.position.y)-n.y<0;e._tiltCVOffMap||!s||r.position.z>e._minimumPickingTerrainHeight?(e._tiltCVOffMap=!0,function(e,t,a){var r=e._scene,n=r.camera,s=r.canvas,l=A_;l.x=s.clientWidth/2,l.y=s.clientHeight/2;var u,f=n.getPickRay(l,S_),c=i.default.UNIT_X,h=f.origin,m=f.direction,p=i.default.dot(c,m);Math.abs(p)>K.default.EPSILON6&&(u=-i.default.dot(c,h)/p);if(!Object(o.default)(u)||u<=0)return e._looking=!0,Lg(e,t,a),void B.default.clone(t,e._tiltCenterMousePosition);var _=i.default.multiplyByScalar(m,u,P_);i.default.add(h,_,_);var g=r.mapProjection,v=g.ellipsoid;i.default.fromElements(_.y,_.z,_.x,_);var y=g.unproject(_,L_);v.cartographicToCartesian(y,_);var b=Br.default.eastNorthUpToFixedFrame(_,v,I_),w=e._globe,O=e._ellipsoid;e._globe=void 0,e._ellipsoid=d.default.UNIT_SPHERE,e._rotateFactor=1,e._rotateRateRangeAdjustment=1;var x=J.default.clone(n.transform,j_);n._setTransform(b),rg(e,t,a,i.default.UNIT_Z),n._setTransform(x),e._globe=w,e._ellipsoid=O;var C=O.maximumRadius;e._rotateFactor=1/C,e._rotateRateRangeAdjustment=C}(e,t,a)):function(e,t,a){var r,n,s=e._scene,l=s.camera,u=i.default.UNIT_X;if(B.default.equals(t,e._tiltCenterMousePosition))r=i.default.clone(e._tiltCenter,P_);else{if(l.position.z<e._minimumPickingTerrainHeight&&(r=__(e,t,P_)),!Object(o.default)(r)){var f,c=(n=l.getPickRay(t,S_)).origin,h=n.direction,m=i.default.dot(u,h);if(Math.abs(m)>K.default.EPSILON6&&(f=-i.default.dot(u,c)/m),!Object(o.default)(f)||f<=0)return e._looking=!0,Lg(e,t,a),void B.default.clone(t,e._tiltCenterMousePosition);r=i.default.multiplyByScalar(h,f,P_),i.default.add(c,r,r)}B.default.clone(t,e._tiltCenterMousePosition),i.default.clone(r,e._tiltCenter)}var p=s.canvas,_=A_;_.x=p.clientWidth/2,_.y=e._tiltCenterMousePosition.y,n=l.getPickRay(_,S_);var g=i.default.clone(i.default.ZERO,F_);g.x=r.x;var v=vp.a.fromPointNormal(g,u,R_),y=x.default.rayPlane(n,v,D_),b=l._projection,w=b.ellipsoid;i.default.fromElements(r.y,r.z,r.x,r);var O=b.unproject(r,L_);w.cartographicToCartesian(O,r);var C,T=Br.default.eastNorthUpToFixedFrame(r,w,I_);Object(o.default)(y)?(i.default.fromElements(y.y,y.z,y.x,y),O=b.unproject(y,L_),w.cartographicToCartesian(O,y),C=Br.default.eastNorthUpToFixedFrame(y,w,M_)):C=T;var E=e._globe,A=e._ellipsoid;e._globe=void 0,e._ellipsoid=d.default.UNIT_SPHERE,e._rotateFactor=1,e._rotateRateRangeAdjustment=1;var S=i.default.UNIT_Z,P=J.default.clone(l.transform,j_);l._setTransform(T);var D=i.default.cross(i.default.UNIT_Z,i.default.normalize(l.position,N_),N_),I=i.default.dot(l.right,D);if(rg(e,t,a,S,!1,!0),l._setTransform(C),I<0){a.startPosition.y>a.endPosition.y&&(S=void 0);var M=l.constrainedAxis;l.constrainedAxis=void 0,rg(e,t,a,S,!0,!1),l.constrainedAxis=M}else rg(e,t,a,S,!0,!1);if(Object(o.default)(l.constrainedAxis)){var F=i.default.cross(l.direction,l.constrainedAxis,z_);i.default.equalsEpsilon(F,i.default.ZERO,K.default.EPSILON6)||(i.default.dot(F,l.right)<0&&i.default.negate(F,F),i.default.cross(F,l.direction,l.up),i.default.cross(l.direction,l.up,l.right),i.default.normalize(l.up,l.up),i.default.normalize(l.right,l.right))}l._setTransform(P),e._globe=E,e._ellipsoid=A;var R=A.maximumRadius;e._rotateFactor=1/R,e._rotateRateRangeAdjustment=R;var N=i.default.clone(l.positionWC,N_);e.enableCollisionDetection&&Ug(e);if(!i.default.equals(l.positionWC,N)){l._setTransform(C),l.worldToCameraCoordinatesPoint(N,N);var L=i.default.magnitudeSquared(N);i.default.magnitudeSquared(l.position)>L&&(i.default.normalize(l.position,l.position),i.default.multiplyByScalar(l.position,Math.sqrt(L),l.position));var j=i.default.angleBetween(N,l.position),V=i.default.cross(N,l.position,N);i.default.normalize(V,V);var U=gi.default.fromAxisAngle(V,j,V_),z=_i.default.fromQuaternion(U,U_);_i.default.multiplyByVector(z,l.direction,l.direction),_i.default.multiplyByVector(z,l.up,l.up),i.default.cross(l.direction,l.up,l.right),i.default.cross(l.right,l.direction,l.up),l._setTransform(P)}}(e,t,a)}}var H_=new B.default,k_=new C.default,G_=new i.default;function W_(e,t,a){Object(o.default)(a.distance)&&(a=a.distance);var r=e._scene,n=r.camera,s=r.canvas,l=H_;l.x=s.clientWidth/2,l.y=s.clientHeight/2;var u,d,f=n.getPickRay(l,k_);if(n.position.z<e._minimumPickingTerrainHeight&&(u=__(e,l,G_)),Object(o.default)(u))d=i.default.distance(f.origin,u);else{var c=i.default.UNIT_X,h=f.origin,m=f.direction;d=-i.default.dot(c,h)/i.default.dot(c,m)}r_(e,t,a,e._zoomFactor,d)}var Y_=new C.default,X_=new vp.a(i.default.UNIT_X,0),Q_=new i.default,q_=new i.default,Z_=new i.default;function K_(e,t,a){var r=e._scene,n=r.camera,s=__(e,a.startPosition,Z_);if(Object(o.default)(s)){var l=a.endPosition,u=n.getPickRay(l,Y_),d=i.default.clone(n.direction,q_);r.mode===L.a.COLUMBUS_VIEW&&i.default.fromElements(d.z,d.x,d.y,d);var f=vp.a.fromPointNormal(s,d,X_),c=x.default.rayPlane(u,f,Q_);Object(o.default)(c)&&(d=i.default.subtract(s,c,d),r.mode===L.a.COLUMBUS_VIEW&&i.default.fromElements(d.y,d.z,d.x,d),i.default.add(n.position,d,n.position))}}var J_=new i.default,$_=new y.default,eg=new i.default,tg=new d.default,ag=new i.default;function ig(e,t,a){var r=e._scene.camera;if(J.default.equals(r.transform,J.default.IDENTITY)){var n,s,l,u=e._ellipsoid.geodeticSurfaceNormal(r.position,ag),f=e._ellipsoid.cartesianToCartographic(r.positionWC,$_).height,c=e._globe;if(Object(o.default)(c)&&f<e._minimumPickingTerrainHeight&&(l=__(e,a.startPosition,Z_),Object(o.default)(l))){var h=r.getPickRay(a.startPosition,h_),m=e._ellipsoid.geodeticSurfaceNormal(l);Math.abs(i.default.dot(h.direction,m))<.05&&!e._looking&&(e._rotating=!1,e._strafing=!0)}B.default.equals(t,e._rotateMousePosition)?e._looking?Lg(e,t,a,u):e._rotating?rg(e,t,a):e._strafing?(i.default.clone(l,e._strafeStartPosition),K_(e,0,a)):(n=i.default.magnitude(e._rotateStartPosition),(s=eg).x=s.y=s.z=n,hg(e,t,a,d.default.fromCartesian3(s,tg))):(e._looking=!1,e._rotating=!1,e._strafing=!1,Object(o.default)(c)&&f<e._minimumPickingTerrainHeight?Object(o.default)(l)?i.default.magnitude(r.position)<i.default.magnitude(l)?(i.default.clone(l,e._strafeStartPosition),e._strafing=!0,K_(e,0,a)):(n=i.default.magnitude(l),(s=eg).x=s.y=s.z=n,hg(e,t,a,d.default.fromCartesian3(s,tg)),i.default.clone(l,e._rotateStartPosition)):(e._looking=!0,Lg(e,t,a,u)):Object(o.default)(r.pickEllipsoid(a.startPosition,e._ellipsoid,J_))?(hg(e,t,a,e._ellipsoid),i.default.clone(J_,e._rotateStartPosition)):f>e._minimumTrackBallHeight?(e._rotating=!0,rg(e,t,a)):(e._looking=!0,Lg(e,t,a,u)),B.default.clone(t,e._rotateMousePosition))}else rg(e,t,a)}function rg(e,t,a,r,s,l){s=Object(n.default)(s,!1),l=Object(n.default)(l,!1);var u=e._scene,d=u.camera,f=u.canvas,c=d.constrainedAxis;Object(o.default)(r)&&(d.constrainedAxis=r);var h=i.default.magnitude(d.position),m=e._rotateFactor*(h-e._rotateRateRangeAdjustment);m>e._maximumRotateRate&&(m=e._maximumRotateRate),m<e._minimumRotateRate&&(m=e._minimumRotateRate);var p=(a.startPosition.x-a.endPosition.x)/f.clientWidth,_=(a.startPosition.y-a.endPosition.y)/f.clientHeight;p=Math.min(p,e.maximumMovementRatio),_=Math.min(_,e.maximumMovementRatio);var g=m*p*Math.PI*2,v=m*_*Math.PI;s||d.rotateRight(g),l||d.rotateUp(v),d.constrainedAxis=c}var ng=H.a.clone(H.a.UNIT_W),og=H.a.clone(H.a.UNIT_W),sg=new i.default,lg=new i.default,ug=new i.default,dg=new i.default,fg=new B.default,cg=new B.default;function hg(e,t,a,r){var n=e._scene.camera,s=B.default.clone(a.startPosition,fg),l=B.default.clone(a.endPosition,cg),u=n.pickEllipsoid(s,r,ng),d=n.pickEllipsoid(l,r,og);if(!Object(o.default)(u)||!Object(o.default)(d))return e._rotating=!0,void rg(e,0,a);if(u=n.worldToCameraCoordinates(u,u),d=n.worldToCameraCoordinates(d,d),Object(o.default)(n.constrainedAxis)){var f=n.constrainedAxis,c=i.default.mostOrthogonalAxis(f,sg);i.default.cross(c,f,c),i.default.normalize(c,c);var h=i.default.cross(f,c,lg),m=i.default.magnitude(u),p=i.default.dot(f,u),_=Math.acos(p/m),g=i.default.multiplyByScalar(f,p,ug);i.default.subtract(u,g,g),i.default.normalize(g,g);var v=i.default.magnitude(d),y=i.default.dot(f,d),b=Math.acos(y/v),w=i.default.multiplyByScalar(f,y,dg);i.default.subtract(d,w,w),i.default.normalize(w,w);var O=Math.acos(i.default.dot(g,c));i.default.dot(g,h)<0&&(O=K.default.TWO_PI-O);var x=Math.acos(i.default.dot(w,c));i.default.dot(w,h)<0&&(x=K.default.TWO_PI-x);var C,T=O-x;C=i.default.equalsEpsilon(f,n.position,K.default.EPSILON2)?n.right:i.default.cross(f,n.position,sg);var E,A=i.default.cross(f,C,sg),S=i.default.dot(A,i.default.subtract(u,f,lg)),P=i.default.dot(A,i.default.subtract(d,f,lg));E=S>0&&P>0?b-_:S>0&&P<=0?i.default.dot(n.position,f)>0?-_-b:_+b:_-b,n.rotateRight(T),n.rotateUp(E)}else{i.default.normalize(u,u),i.default.normalize(d,d);var D=i.default.dot(u,d),I=i.default.cross(u,d,sg);if(D<1&&!i.default.equalsEpsilon(I,i.default.ZERO,K.default.EPSILON14)){var M=Math.acos(D);n.rotate(I,M)}}}var mg=new i.default,pg=new y.default;function _g(e,t,a){Object(o.default)(a.distance)&&(a=a.distance);var r=e._ellipsoid,n=e._scene,s=n.camera,l=n.canvas,u=H_;u.x=l.clientWidth/2,u.y=l.clientHeight/2;var d,f,c=s.getPickRay(u,k_),h=r.cartesianToCartographic(s.position,pg).height;h<e._minimumPickingTerrainHeight&&(d=__(e,u,G_)),f=Object(o.default)(d)?i.default.distance(c.origin,d):h;var m=i.default.normalize(s.position,mg);r_(e,t,a,e._zoomFactor,f,i.default.dot(m,s.direction))}var gg=new B.default,vg=new C.default,yg=new i.default,bg=new i.default,wg=new J.default,Og=new J.default,xg=new J.default,Cg=new gi.default,Tg=new _i.default,Eg=new y.default,Ag=new i.default;function Sg(e,t,a){var r=e._scene.camera;if(J.default.equals(r.transform,J.default.IDENTITY))if(Object(o.default)(a.angleAndHeight)&&(a=a.angleAndHeight),B.default.equals(t,e._tiltCenterMousePosition)||(e._tiltOnEllipsoid=!1,e._looking=!1),e._looking){var n=e._ellipsoid.geodeticSurfaceNormal(r.position,Ag);Lg(e,t,a,n)}else{var s=e._ellipsoid.cartesianToCartographic(r.position,Eg);e._tiltOnEllipsoid||s.height>e._minimumCollisionTerrainHeight?(e._tiltOnEllipsoid=!0,function(e,t,a){var r=e._ellipsoid,n=e._scene,s=n.camera,l=.25*e.minimumZoomDistance,u=r.cartesianToCartographic(s.positionWC,Pg).height;if(u-l-1<K.default.EPSILON3&&a.endPosition.y-a.startPosition.y<0)return;var f=n.canvas,c=gg;c.x=f.clientWidth/2,c.y=f.clientHeight/2;var h,m=s.getPickRay(c,vg),p=x.default.rayEllipsoid(m,r);if(Object(o.default)(p))h=C.default.getPoint(m,p.start,yg);else{if(!(u>e._minimumTrackBallHeight)){e._looking=!0;var _=e._ellipsoid.geodeticSurfaceNormal(s.position,Ag);return Lg(e,t,a,_),void B.default.clone(t,e._tiltCenterMousePosition)}var g=x.default.grazingAltitudeLocation(m,r);if(!Object(o.default)(g))return;var v=r.cartesianToCartographic(g,Eg);v.height=0,h=r.cartographicToCartesian(v,yg)}var y=Br.default.eastNorthUpToFixedFrame(h,r,wg),b=e._globe,w=e._ellipsoid;e._globe=void 0,e._ellipsoid=d.default.UNIT_SPHERE,e._rotateFactor=1,e._rotateRateRangeAdjustment=1;var O=J.default.clone(s.transform,xg);s._setTransform(y),rg(e,0,a,i.default.UNIT_Z),s._setTransform(O),e._globe=b,e._ellipsoid=w;var T=w.maximumRadius;e._rotateFactor=1/T,e._rotateRateRangeAdjustment=T}(e,t,a)):function(e,t,a){var r,n,s,l=e._ellipsoid,u=e._scene,f=u.camera;if(B.default.equals(t,e._tiltCenterMousePosition))r=i.default.clone(e._tiltCenter,yg);else{if(r=__(e,t,yg),!Object(o.default)(r)){if(n=f.getPickRay(t,vg),s=x.default.rayEllipsoid(n,l),!Object(o.default)(s)){if(l.cartesianToCartographic(f.position,Eg).height<=e._minimumTrackBallHeight){e._looking=!0;var c=e._ellipsoid.geodeticSurfaceNormal(f.position,Ag);Lg(e,t,a,c),B.default.clone(t,e._tiltCenterMousePosition)}return}r=C.default.getPoint(n,s.start,yg)}B.default.clone(t,e._tiltCenterMousePosition),i.default.clone(r,e._tiltCenter)}var h=u.canvas,m=gg;m.x=h.clientWidth/2,m.y=e._tiltCenterMousePosition.y,n=f.getPickRay(m,vg);var p=i.default.magnitude(r),_=i.default.fromElements(p,p,p,eg),g=d.default.fromCartesian3(_,tg);if(s=x.default.rayEllipsoid(n,g),!Object(o.default)(s))return;var v=i.default.magnitude(n.origin)>p?s.start:s.stop,y=C.default.getPoint(n,v,bg),b=Br.default.eastNorthUpToFixedFrame(r,l,wg),w=Br.default.eastNorthUpToFixedFrame(y,g,Og),O=e._globe,T=e._ellipsoid;e._globe=void 0,e._ellipsoid=d.default.UNIT_SPHERE,e._rotateFactor=1,e._rotateRateRangeAdjustment=1;var E=i.default.UNIT_Z,A=J.default.clone(f.transform,xg);f._setTransform(b);var S=i.default.cross(y,f.positionWC,z_),P=i.default.dot(f.rightWC,S);if(rg(e,0,a,E,!1,!0),f._setTransform(w),P<0){a.startPosition.y>a.endPosition.y&&(E=void 0);var D=f.constrainedAxis;f.constrainedAxis=void 0,rg(e,0,a,E,!0,!1),f.constrainedAxis=D}else rg(e,0,a,E,!0,!1);if(Object(o.default)(f.constrainedAxis)){var I=i.default.cross(f.direction,f.constrainedAxis,z_);i.default.equalsEpsilon(I,i.default.ZERO,K.default.EPSILON6)||(i.default.dot(I,f.right)<0&&i.default.negate(I,I),i.default.cross(I,f.direction,f.up),i.default.cross(f.direction,f.up,f.right),i.default.normalize(f.up,f.up),i.default.normalize(f.right,f.right))}f._setTransform(A),e._globe=O,e._ellipsoid=T;var M=T.maximumRadius;e._rotateFactor=1/M,e._rotateRateRangeAdjustment=M;var F=i.default.clone(f.positionWC,z_);e.enableCollisionDetection&&Ug(e);if(!i.default.equals(f.positionWC,F)){f._setTransform(w),f.worldToCameraCoordinatesPoint(F,F);var R=i.default.magnitudeSquared(F);i.default.magnitudeSquared(f.position)>R&&(i.default.normalize(f.position,f.position),i.default.multiplyByScalar(f.position,Math.sqrt(R),f.position));var N=i.default.angleBetween(F,f.position),L=i.default.cross(F,f.position,F);i.default.normalize(L,L);var j=gi.default.fromAxisAngle(L,N,Cg),V=_i.default.fromQuaternion(j,Tg);_i.default.multiplyByVector(V,f.direction,f.direction),_i.default.multiplyByVector(V,f.up,f.up),i.default.cross(f.direction,f.up,f.right),i.default.cross(f.right,f.direction,f.up),f._setTransform(A)}}(e,t,a)}}var Pg=new y.default;var Dg=new B.default,Ig=new B.default,Mg=new C.default,Fg=new C.default,Rg=new i.default,Ng=new i.default;function Lg(e,t,a,r){var s=e._scene.camera,l=Dg;l.x=a.startPosition.x,l.y=0;var u=Ig;u.x=a.endPosition.x,u.y=0;var d,f,c=s.getPickRay(l,Mg),h=s.getPickRay(u,Fg),m=0;s.frustum instanceof ee.a?(d=c.origin,f=h.origin,i.default.add(s.direction,d,d),i.default.add(s.direction,f,f),i.default.subtract(d,s.position,d),i.default.subtract(f,s.position,f),i.default.normalize(d,d),i.default.normalize(f,f)):(d=c.direction,f=h.direction);var p=i.default.dot(d,f);p<1&&(m=Math.acos(p)),m=a.startPosition.x>a.endPosition.x?-m:m;var _=e._horizontalRotationAxis;if(Object(o.default)(r)?s.look(r,-m):Object(o.default)(_)?s.look(_,-m):s.lookLeft(m),l.x=0,l.y=a.startPosition.y,u.x=0,u.y=a.endPosition.y,c=s.getPickRay(l,Mg),h=s.getPickRay(u,Fg),m=0,s.frustum instanceof ee.a?(d=c.origin,f=h.origin,i.default.add(s.direction,d,d),i.default.add(s.direction,f,f),i.default.subtract(d,s.position,d),i.default.subtract(f,s.position,f),i.default.normalize(d,d),i.default.normalize(f,f)):(d=c.direction,f=h.direction),(p=i.default.dot(d,f))<1&&(m=Math.acos(p)),m=a.startPosition.y>a.endPosition.y?-m:m,r=Object(n.default)(r,_),Object(o.default)(r)){var g=s.direction,v=i.default.negate(r,Rg),y=i.default.equalsEpsilon(g,r,K.default.EPSILON2),b=i.default.equalsEpsilon(g,v,K.default.EPSILON2);if(y||b)(y&&m<0||b&&m>0)&&s.look(s.right,-m);else{p=i.default.dot(g,r);var w=K.default.acosClamped(p);m>0&&m>w&&(m=w-K.default.EPSILON4),p=i.default.dot(g,v),w=K.default.acosClamped(p),m<0&&-m>w&&(m=-w+K.default.EPSILON4);var O=i.default.cross(r,g,Ng);s.look(O,m)}}else s.lookUp(m)}var jg=new J.default,Vg=new y.default;function Ug(e){e._adjustedHeightForTerrain=!0;var t=e._scene,a=t.mode,r=t.globe;if(Object(o.default)(r)&&a!==L.a.SCENE2D&&a!==L.a.MORPHING){var n,s,l=t.camera,u=r.ellipsoid,d=t.mapProjection;J.default.equals(l.transform,J.default.IDENTITY)||(n=J.default.clone(l.transform,jg),s=i.default.magnitude(l.position),l._setTransform(J.default.IDENTITY));var f=Vg;a===L.a.SCENE3D?u.cartesianToCartographic(l.position,f):d.unproject(l.position,f);var c=!1;if(f.height<e._minimumCollisionTerrainHeight){var h=r.getHeight(f);Object(o.default)(h)&&(h+=e.minimumZoomDistance,f.height<h&&(f.height=h,a===L.a.SCENE3D?u.cartographicToCartesian(f,l.position):d.project(f,l.position),c=!0))}Object(o.default)(n)&&(l._setTransform(n),c&&(i.default.normalize(l.position,l.position),i.default.negate(l.position,l.direction),i.default.multiplyByScalar(l.position,Math.max(s,e.minimumZoomDistance),l.position),i.default.normalize(l.direction,l.direction),i.default.cross(l.direction,l.up,l.right),i.default.cross(l.right,l.direction,l.up)))}}var zg=new i.default,Bg=new i.default;Pp.prototype.update=function(){var e=this._scene.camera;J.default.equals(e.transform,J.default.IDENTITY)?(this._globe=this._scene.globe,this._ellipsoid=Object(o.default)(this._globe)?this._globe.ellipsoid:this._scene.mapProjection.ellipsoid):(this._globe=void 0,this._ellipsoid=d.default.UNIT_SPHERE),this._minimumCollisionTerrainHeight=this.minimumCollisionTerrainHeight*this._scene.terrainExaggeration,this._minimumPickingTerrainHeight=this.minimumPickingTerrainHeight*this._scene.terrainExaggeration,this._minimumTrackBallHeight=this.minimumTrackBallHeight*this._scene.terrainExaggeration;var t=this._ellipsoid.maximumRadius;this._rotateFactor=1/t,this._rotateRateRangeAdjustment=t,this._adjustedHeightForTerrain=!1;var a,r,n=i.default.clone(e.positionWC,zg),s=i.default.clone(e.directionWC,Bg),l=this._scene.mode;(l===L.a.SCENE2D?(r=(a=this)._scene.mapMode2D===Go.ROTATE,J.default.equals(J.default.IDENTITY,a._scene.camera.transform)?(Fp(a,a.enableTranslate,a.translateEventTypes,l_,a.inertiaTranslate,"_lastInertiaTranslateMovement"),Fp(a,a.enableZoom,a.zoomEventTypes,u_,a.inertiaZoom,"_lastInertiaZoomMovement"),r&&Fp(a,a.enableRotate,a.tiltEventTypes,c_,a.inertiaSpin,"_lastInertiaTiltMovement")):(Fp(a,a.enableZoom,a.zoomEventTypes,u_,a.inertiaZoom,"_lastInertiaZoomMovement"),r&&Fp(a,a.enableRotate,a.translateEventTypes,c_,a.inertiaSpin,"_lastInertiaSpinMovement"))):l===L.a.COLUMBUS_VIEW?(this._horizontalRotationAxis=i.default.UNIT_Z,function(e){var t=e._scene.camera;if(J.default.equals(J.default.IDENTITY,t.transform)){var a=e._tweens;if(e._aggregator.anyButtonDown&&a.removeAll(),Fp(e,e.enableTilt,e.tiltEventTypes,B_,e.inertiaSpin,"_lastInertiaTiltMovement"),Fp(e,e.enableTranslate,e.translateEventTypes,E_,e.inertiaTranslate,"_lastInertiaTranslateMovement"),Fp(e,e.enableZoom,e.zoomEventTypes,W_,e.inertiaZoom,"_lastInertiaZoomMovement"),Fp(e,e.enableLook,e.lookEventTypes,Lg),!(e._aggregator.anyButtonDown||Object(o.default)(e._lastInertiaZoomMovement)&&e._lastInertiaZoomMovement.active||Object(o.default)(e._lastInertiaTranslateMovement)&&e._lastInertiaTranslateMovement.active||a.contains(e._tween))){var i=t.createCorrectPositionTween(e.bounceAnimationTime);Object(o.default)(i)&&(e._tween=a.add(i))}a.update()}else Fp(e,e.enableRotate,e.rotateEventTypes,rg,e.inertiaSpin,"_lastInertiaSpinMovement"),Fp(e,e.enableZoom,e.zoomEventTypes,_g,e.inertiaZoom,"_lastInertiaZoomMovement")}(this)):l===L.a.SCENE3D&&(this._horizontalRotationAxis=void 0,function(e){Fp(e,e.enableRotate,e.rotateEventTypes,ig,e.inertiaSpin,"_lastInertiaSpinMovement"),Fp(e,e.enableZoom,e.zoomEventTypes,_g,e.inertiaZoom,"_lastInertiaZoomMovement"),Fp(e,e.enableTilt,e.tiltEventTypes,Sg,e.inertiaSpin,"_lastInertiaTiltMovement"),Fp(e,e.enableLook,e.lookEventTypes,Lg)}(this)),this.enableCollisionDetection&&!this._adjustedHeightForTerrain)&&((!i.default.equals(n,e.positionWC)||!i.default.equals(s,e.directionWC))&&Ug(this));this._aggregator.reset()},Pp.prototype.isDestroyed=function(){return!1},Pp.prototype.destroy=function(){return this._tweens.removeAll(),this._aggregator=this._aggregator&&this._aggregator.destroy(),Object(l.default)(this)};var Hg=Pp,kg="uniform sampler2D colorTexture;\nuniform sampler2D colorTexture2;\n\nuniform vec2 center;\nuniform float radius;\n\nvarying vec2 v_textureCoordinates;\n\nvoid main()\n{\n    vec4 color0 = texture2D(colorTexture, v_textureCoordinates);\n    vec4 color1 = texture2D(colorTexture2, v_textureCoordinates);\n\n    float x = length(gl_FragCoord.xy - center) / radius;\n    float t = smoothstep(0.5, 0.8, x);\n    gl_FragColor = mix(color0 + color1, color1, t);\n}\n",Gg='uniform sampler2D colorTexture;\n\nuniform float avgLuminance;\nuniform float threshold;\nuniform float offset;\n\nvarying vec2 v_textureCoordinates;\n\nfloat key(float avg)\n{\n    float guess = 1.5 - (1.5 / (avg * 0.1 + 1.0));\n    return max(0.0, guess) + 0.1;\n}\n\n// See section 9. "The bright-pass filter" of Realtime HDR Rendering\n// http://www.cg.tuwien.ac.at/research/publications/2007/Luksch_2007_RHR/Luksch_2007_RHR-RealtimeHDR%20.pdf\n\nvoid main()\n{\n    vec4 color = texture2D(colorTexture, v_textureCoordinates);\n    vec3 xyz = czm_RGBToXYZ(color.rgb);\n    float luminance = xyz.r;\n\n    float scaledLum = key(avgLuminance) * luminance / avgLuminance;\n    float brightLum = max(scaledLum - threshold, 0.0);\n    float brightness = brightLum / (offset + brightLum);\n\n    xyz.r = brightness;\n    gl_FragColor = vec4(czm_XYZToRGB(xyz), 1.0);\n}\n';function Wg(){this._sceneFramebuffer=new Rf;var e=new Array(6);e[0]=new Bh({fragmentShader:yd,textureScale:.125,forcePowerOfTwo:!0,sampleMode:Mh.LINEAR});var t=e[1]=new Bh({fragmentShader:Gg,uniforms:{avgLuminance:.5,threshold:.25,offset:.1},textureScale:.125,forcePowerOfTwo:!0}),a=this;this._delta=1,this._sigma=2,this._blurStep=new B.default,e[2]=new Bh({fragmentShader:Th,uniforms:{step:function(){return a._blurStep.x=a._blurStep.y=1/t.outputTexture.width,a._blurStep},delta:function(){return a._delta},sigma:function(){return a._sigma},direction:0},textureScale:.125,forcePowerOfTwo:!0}),e[3]=new Bh({fragmentShader:Th,uniforms:{step:function(){return a._blurStep.x=a._blurStep.y=1/t.outputTexture.width,a._blurStep},delta:function(){return a._delta},sigma:function(){return a._sigma},direction:1},textureScale:.125,forcePowerOfTwo:!0}),e[4]=new Bh({fragmentShader:yd,sampleMode:Mh.LINEAR}),this._uCenter=new B.default,this._uRadius=void 0,e[5]=new Bh({fragmentShader:kg,uniforms:{center:function(){return a._uCenter},radius:function(){return a._uRadius},colorTexture2:function(){return a._sceneFramebuffer.getFramebuffer().getColorTexture(0)}}}),this._stages=new kh({stages:e});for(var i=new em(this),r=e.length,n=0;n<r;++n)e[n]._textureCache=i;this._textureCache=i,this.length=e.length}Wg.prototype.get=function(e){return this._stages.get(e)},Wg.prototype.getStageByName=function(e){for(var t=this._stages.length,a=0;a<t;++a){var i=this._stages.get(a);if(i.name===e)return i}};var Yg=new H.a,Xg=new B.default,Qg=new B.default,qg=new J.default;Wg.prototype.clear=function(e,t,a){this._sceneFramebuffer.clear(e,t,a),this._textureCache.clear(e)},Wg.prototype.update=function(e){var t=e.context,a=e.viewport,i=this._sceneFramebuffer;i.update(t,a);var r=i.getFramebuffer();return this._textureCache.update(t),this._stages.update(t,!1),function(e,t,a){var i=t.uniformState,r=i.sunPositionWC,n=i.view,o=i.viewProjection,s=i.projection,l=J.default.computeViewportTransformation(a,0,1,qg),u=J.default.multiplyByPoint(n,r,Yg),d=Br.default.pointToGLWindowCoordinates(o,l,r,Xg);u.x+=K.default.SOLAR_RADIUS;var f=Br.default.pointToGLWindowCoordinates(s,l,u,u),c=30*B.default.magnitude(B.default.subtract(f,d,f))*2,h=Qg;h.x=c,h.y=c,e._uCenter=B.default.clone(d,e._uCenter),e._uRadius=.15*Math.max(h.x,h.y);var m=t.drawingBufferWidth,p=t.drawingBufferHeight,_=e._stages,g=_.get(0),v=g.outputTexture.width,y=g.outputTexture.height,b=new nn.default;b.width=v,b.height=y,l=J.default.computeViewportTransformation(b,0,1,qg),d=Br.default.pointToGLWindowCoordinates(o,l,r,Xg),h.x*=v/m,h.y*=y/p;var w=g.scissorRectangle;w.x=Math.max(d.x-.5*h.x,0),w.y=Math.max(d.y-.5*h.y,0),w.width=Math.min(h.x,m),w.height=Math.min(h.y,p);for(var O=1;O<4;++O)nn.default.clone(w,_.get(O).scissorRectangle)}(this,t,a),r},Wg.prototype.execute=function(e){var t=this._sceneFramebuffer.getFramebuffer().getColorTexture(0),a=this._stages,i=a.length;a.get(0).execute(e,t);for(var r=1;r<i;++r)a.get(r).execute(e,a.get(r-1).outputTexture)},Wg.prototype.copy=function(e,t){if(!Object(o.default)(this._copyColorCommand)){var a=this;this._copyColorCommand=e.createViewportQuadCommand(yd,{uniformMap:{colorTexture:function(){return a._stages.get(a._stages.length-1).outputTexture}},owner:this})}this._copyColorCommand.framebuffer=t,this._copyColorCommand.execute(e)},Wg.prototype.isDestroyed=function(){return!1},Wg.prototype.destroy=function(){return this._textureCache.destroy(),this._stages.destroy(),Object(l.default)(this)};var Zg=Wg,Kg=function(e){return function(){e.frameState.afterRender.push((function(){e.requestRender()}))}};function Jg(e){var t=(e=Object(n.default)(e,n.default.EMPTY_OBJECT)).canvas,a=e.creditContainer,i=e.creditViewport,r=Object(k.default)(e.contextOptions);Object(o.default)(r)||(r={}),Object(o.default)(r.webgl)||(r.webgl={}),r.webgl.powerPreference=Object(n.default)(r.webgl.powerPreference,"high-performance");var s=Object(o.default)(a),l=new No(t,r);s||((a=document.createElement("div")).style.position="absolute",a.style.bottom="0",a.style["text-shadow"]="0 0 2px #000000",a.style.color="#ffffff",a.style["font-size"]="10px",a.style["padding-right"]="5px",t.parentNode.appendChild(a)),Object(o.default)(i)||(i=t.parentNode),this._id=Object(on.default)(),this._jobScheduler=new zd,this._frameState=new vd(l,new $l.default(a,"  ",i),this._jobScheduler),this._frameState.scene3DOnly=Object(n.default)(e.scene3DOnly,!1),this._removeCreditContainer=!s,this._creditContainer=a,this._canvas=t,this._context=l,this._computeEngine=new zn(l),this._globe=void 0,this._primitives=new tf.a,this._groundPrimitives=new tf.a,this._logDepthBuffer=l.fragmentDepth,this._logDepthBufferDirty=!0,this._tweens=new Sp.default,this._shaderFrameCount=0,this._sunPostProcess=void 0,this._computeCommandList=[],this._overlayCommandList=[],this._useOIT=Object(n.default)(e.orderIndependentTranslucency,!0),this._executeOITFunction=void 0,this._depthPlane=new qu,this._clearColorCommand=new Rn.a({color:new G.default,stencil:0,owner:this}),this._depthClearCommand=new Rn.a({depth:1,owner:this}),this._stencilClearCommand=new Rn.a({stencil:0}),this._classificationStencilClearCommand=new Rn.a({stencil:0,renderState:fe.a.fromCache({stencilMask:wd.a.CLASSIFICATION_MASK})}),this._depthOnlyRenderStateCache={},this._transitioner=new pp(this),this._preUpdate=new w.default,this._postUpdate=new w.default,this._renderError=new w.default,this._preRender=new w.default,this._postRender=new w.default,this._minimumDisableDepthTestDistance=0,this.rethrowRenderErrors=!1,this.completeMorphOnUserInput=!0,this.morphStart=new w.default,this.morphComplete=new w.default,this.skyBox=void 0,this.skyAtmosphere=void 0,this.sun=void 0,this.sunBloom=!0,this._sunBloom=void 0,this.moon=void 0,this.backgroundColor=G.default.clone(G.default.BLACK),this._mode=L.a.SCENE3D,this._mapProjection=Object(o.default)(e.mapProjection)?e.mapProjection:new dn.a,this.morphTime=1,this.farToNearRatio=1e3,this.logarithmicDepthFarToNearRatio=1e9,this.nearToFarDistance2D=175e4,this.debugCommandFilter=void 0,this.debugShowCommands=!1,this.debugShowFrustums=!1,this.debugShowFramesPerSecond=!1,this.debugShowGlobeDepth=!1,this.debugShowDepthFrustum=1,this.debugShowFrustumPlanes=!1,this._debugShowFrustumPlanes=!1,this._debugFrustumPlanes=void 0,this.useDepthPicking=!0,this.pickTranslucentDepth=!1,this.cameraEventWaitTime=500,this.fog=new gd,this._shadowMapCamera=new Zl(this),this.shadowMap=new xc({context:l,lightCamera:this._shadowMapCamera,enabled:Object(n.default)(e.shadows,!1)}),this.invertClassification=!1,this.invertClassificationColor=G.default.clone(G.default.WHITE),this._actualInvertClassificationColor=G.default.clone(this._invertClassificationColor),this._invertClassification=new Ld,this.focalLength=void 0,this.eyeSeparation=void 0,this.postProcessStages=new lm,this._brdfLutGenerator=new Vo,this._terrainExaggeration=Object(n.default)(e.terrainExaggeration,1),this._performanceDisplay=void 0,this._debugVolume=void 0,this._screenSpaceCameraController=new Hg(this),this._mapMode2D=Object(n.default)(e.mapMode2D,Go.INFINITE_SCROLL),this._environmentState={skyBoxCommand:void 0,skyAtmosphereCommand:void 0,sunDrawCommand:void 0,sunComputeCommand:void 0,moonCommand:void 0,isSunVisible:!1,isMoonVisible:!1,isReadyForAtmosphere:!1,isSkyAtmosphereVisible:!1,clearGlobeDepth:!1,useDepthPlane:!1,renderTranslucentDepthForPick:!1,originalFramebuffer:void 0,useGlobeDepthFramebuffer:!1,separatePrimitiveFramebuffer:!1,useOIT:!1,useInvertClassification:!1,usePostProcess:!1,usePostProcessSelected:!1,useWebVR:!1},this._useWebVR=!1,this._cameraVR=void 0,this._aspectRatioVR=void 0,this.requestRenderMode=Object(n.default)(e.requestRenderMode,!1),this._renderRequested=!0,this.maximumRenderTimeChange=Object(n.default)(e.maximumRenderTimeChange,0),this._lastRenderTime=void 0,this._frameRateMonitor=void 0,this._removeRequestListenerCallback=Mn.a.requestCompletedEvent.addEventListener(Kg(this)),this._removeTaskProcessorListenerCallback=Fn.default.taskCompletedEvent.addEventListener(Kg(this)),this._removeGlobeCallbacks=[];var u=new nn.default(0,0,l.drawingBufferWidth,l.drawingBufferHeight),d=new Zl(this);this._logDepthBuffer&&(d.frustum.near=.1,d.frustum.far=1e10),this.preloadFlightCamera=new Zl(this),this.preloadFlightCullingVolume=void 0,this._picking=new xh(this),this._defaultView=new Mc(this,d,u),this._view=this._defaultView,this._hdr=void 0,this._hdrDirty=void 0,this.highDynamicRange=!1,this.gamma=2.2,this.sphericalHarmonicCoefficients=void 0,this.specularEnvironmentMaps=void 0,this._specularEnvironmentMapAtlas=void 0,this.light=new ro,sv(this,0,ri.default.now()),this.updateFrameState(),this.initializeFrame()}var $g=new H.a;function ev(e,t,a){var i=e._frameState,r=e._context,n=e._view.oit,s=i.shadowState.lightShadowMaps,l=i.shadowState.lightShadowsEnabled,u=t.derivedCommands;Object(o.default)(t.pickId)&&(u.picking=ad.createPickDerivedCommand(e,t,r,u.picking)),t.pickOnly||(u.depth=ad.createDepthOnlyDerivedCommand(e,t,r,u.depth)),u.originalCommand=t,e._hdr&&(u.hdr=ad.createHdrCommand(t,r,u.hdr),u=(t=u.hdr.command).derivedCommands),l&&t.receiveShadows&&(u.shadows=xc.createReceiveDerivedCommand(s,t,a,r,u.shadows)),t.pass===de.a.TRANSLUCENT&&Object(o.default)(n)&&n.isSupported()&&(l&&t.receiveShadows?(u.oit=Object(o.default)(u.oit)?u.oit:{},u.oit.shadows=n.createDerivedCommands(u.shadows.receiveCommand,r,u.oit.shadows)):u.oit=n.createDerivedCommands(t,r,u.oit))}Object(s.default)(Jg.prototype,{canvas:{get:function(){return this._canvas}},drawingBufferHeight:{get:function(){return this._context.drawingBufferHeight}},drawingBufferWidth:{get:function(){return this._context.drawingBufferWidth}},maximumAliasedLineWidth:{get:function(){return le.a.maximumAliasedLineWidth}},maximumCubeMapSize:{get:function(){return le.a.maximumCubeMapSize}},pickPositionSupported:{get:function(){return this._context.depthTexture}},sampleHeightSupported:{get:function(){return this._context.depthTexture}},clampToHeightSupported:{get:function(){return this._context.depthTexture}},invertClassificationSupported:{get:function(){return this._context.depthTexture}},specularEnvironmentMapsSupported:{get:function(){return Bd.a.isSupported(this._context)}},globe:{get:function(){return this._globe},set:function(e){this._globe=this._globe&&this._globe.destroy(),this._globe=e,function(e,t){for(var a=0;a<e._removeGlobeCallbacks.length;++a)e._removeGlobeCallbacks[a]();e._removeGlobeCallbacks.length=0;var i=[];Object(o.default)(t)&&(i.push(t.imageryLayersUpdatedEvent.addEventListener(Kg(e))),i.push(t.terrainProviderChanged.addEventListener(Kg(e)))),e._removeGlobeCallbacks=i}(this,e)}},primitives:{get:function(){return this._primitives}},groundPrimitives:{get:function(){return this._groundPrimitives}},camera:{get:function(){return this._view.camera},set:function(e){this._view.camera=e}},view:{get:function(){return this._view},set:function(e){this._view=e}},defaultView:{get:function(){return this._defaultView}},picking:{get:function(){return this._picking}},screenSpaceCameraController:{get:function(){return this._screenSpaceCameraController}},mapProjection:{get:function(){return this._mapProjection}},jobScheduler:{get:function(){return this._jobScheduler}},frameState:{get:function(){return this._frameState}},environmentState:{get:function(){return this._environmentState}},tweens:{get:function(){return this._tweens}},imageryLayers:{get:function(){if(Object(o.default)(this.globe))return this.globe.imageryLayers}},terrainProvider:{get:function(){if(Object(o.default)(this.globe))return this.globe.terrainProvider},set:function(e){Object(o.default)(this.globe)&&(this.globe.terrainProvider=e)}},terrainProviderChanged:{get:function(){if(Object(o.default)(this.globe))return this.globe.terrainProviderChanged}},preUpdate:{get:function(){return this._preUpdate}},postUpdate:{get:function(){return this._postUpdate}},renderError:{get:function(){return this._renderError}},preRender:{get:function(){return this._preRender}},postRender:{get:function(){return this._postRender}},lastRenderTime:{get:function(){return this._lastRenderTime}},context:{get:function(){return this._context}},debugFrustumStatistics:{get:function(){return this._view.debugFrustumStatistics}},scene3DOnly:{get:function(){return this._frameState.scene3DOnly}},orderIndependentTranslucency:{get:function(){return this._useOIT}},id:{get:function(){return this._id}},mode:{get:function(){return this._mode},set:function(e){e===L.a.SCENE2D?this.morphTo2D(0):e===L.a.SCENE3D?this.morphTo3D(0):e===L.a.COLUMBUS_VIEW&&this.morphToColumbusView(0),this._mode=e}},frustumCommandsList:{get:function(){return this._view.frustumCommandsList}},numberOfFrustums:{get:function(){return this._view.frustumCommandsList.length}},terrainExaggeration:{get:function(){return this._terrainExaggeration}},useWebVR:{get:function(){return this._useWebVR},set:function(e){this._useWebVR=e,this._useWebVR?(this._frameState.creditDisplay.container.style.visibility="hidden",this._cameraVR=new Zl(this),Object(o.default)(this._deviceOrientationCameraController)||(this._deviceOrientationCameraController=new sd(this)),this._aspectRatioVR=this.camera.frustum.aspectRatio):(this._frameState.creditDisplay.container.style.visibility="visible",this._cameraVR=void 0,this._deviceOrientationCameraController=this._deviceOrientationCameraController&&!this._deviceOrientationCameraController.isDestroyed()&&this._deviceOrientationCameraController.destroy(),this.camera.frustum.aspectRatio=this._aspectRatioVR,this.camera.frustum.xOffset=0)}},mapMode2D:{get:function(){return this._mapMode2D}},imagerySplitPosition:{get:function(){return this._frameState.imagerySplitPosition},set:function(e){this._frameState.imagerySplitPosition=e}},minimumDisableDepthTestDistance:{get:function(){return this._minimumDisableDepthTestDistance},set:function(e){this._minimumDisableDepthTestDistance=e}},logarithmicDepthBuffer:{get:function(){return this._logDepthBuffer},set:function(e){e=this._context.fragmentDepth&&e,this._logDepthBuffer!==e&&(this._logDepthBuffer=e,this._logDepthBufferDirty=!0,this._defaultView.updateFrustums=!0)}},gamma:{get:function(){return this._context.uniformState.gamma},set:function(e){this._context.uniformState.gamma=e}},highDynamicRange:{get:function(){return this._hdr},set:function(e){var t=this._context,a=e&&t.depthTexture&&(t.colorBufferFloat||t.colorBufferHalfFloat);this._hdrDirty=a!==this._hdr,this._hdr=a}},highDynamicRangeSupported:{get:function(){var e=this._context;return e.depthTexture&&(e.colorBufferFloat||e.colorBufferHalfFloat)}},sunColor:{get:function(){return Object(ln.default)("sun-color-removed","scene.sunColor will be removed in Cesium 1.69. Use scene.light.color and scene.light.intensity instead."),this.light.color},set:function(e){Object(ln.default)("sun-color-removed","scene.sunColor will be removed in Cesium 1.69. Use scene.light.color and scene.light.intensity instead.");var t=i.default.maximumComponent(e),a=H.a.fromElements(e.x,e.y,e.z,1,$g),r=1;t>1&&(i.default.divideByScalar(a,t,a),r=t),this.light.color=G.default.fromCartesian4(a,this.light.color),this.light.intensity=r}},pixelRatio:{get:function(){return this._frameState.pixelRatio},set:function(e){this._frameState.pixelRatio=e}},opaqueFrustumNearOffset:{get:function(){return this._frameState.useLogDepth?.9:.9999}}}),Jg.prototype.getCompressedTextureFormatSupported=function(e){var t=this.context;return("WEBGL_compressed_texture_s3tc"===e||"s3tc"===e)&&t.s3tc||("WEBGL_compressed_texture_pvrtc"===e||"pvrtc"===e)&&t.pvrtc||("WEBGL_compressed_texture_etc1"===e||"etc1"===e)&&t.etc1},Jg.prototype.updateDerivedCommands=function(e){if(Object(o.default)(e.derivedCommands)){var t=this._frameState,a=this._context,i=!1,r=t.shadowState.lastDirtyTime;e.lastDirtyTime!==r&&(e.lastDirtyTime=r,e.dirty=!0,i=!0);var n=t.useLogDepth,s=this._hdr,l=e.derivedCommands,u=Object(o.default)(l.logDepth),d=Object(o.default)(l.hdr),f=Object(o.default)(l.originalCommand),c=n&&!u,h=s&&!d,m=!(n&&s||f);if(e.dirty=e.dirty||c||h||m,e.dirty){e.dirty=!1;var p=t.shadowState.shadowMaps;t.shadowState.shadowsEnabled&&e.castShadows&&(l.shadows=xc.createCastDerivedCommand(p,e,i,a,l.shadows)),(u||c)&&(l.logDepth=ad.createLogDepthCommand(e,a,l.logDepth),ev(this,l.logDepth.command,i)),(f||m)&&ev(this,e,i)}}};var tv,av=new Jl({pass:Kl.a.RENDER}),iv=new Jl({pass:Kl.a.PRELOAD}),rv=new Jl({pass:Kl.a.PRELOAD_FLIGHT}),nv=new Jl({pass:Kl.a.REQUEST_RENDER_MODE_DEFER_CHECK}),ov=new v.default;function sv(e,t,a){var i=e._frameState;i.frameNumber=t,i.time=ri.default.clone(a,i.time)}function lv(e,t,a){var i=ue.a.shallowClone(e);i.shaderProgram=function(e,t,a){var i=t.context,r=Object(n.default)(a,e.shaderProgram),s=r.fragmentShaderSource.clone(),l=[];s.sources=s.sources.map((function(e){e=A.a.replaceMain(e,"czm_Debug_main");for(var t,a=/gl_FragData\[(\d+)\]/g;null!==(t=a.exec(e));)-1===l.indexOf(t[1])&&l.push(t[1]);return e}));var u,d=l.length,f="void main() \n{ \n    czm_Debug_main(); \n";if(t.debugShowCommands){Object(o.default)(e._debugColor)||(e._debugColor=G.default.fromRandom());var c=e._debugColor;if(d>0)for(u=0;u<d;++u)f+="    gl_FragData["+l[u]+"].rgb *= vec3("+c.red+", "+c.green+", "+c.blue+"); \n";else f+="    gl_FragColor.rgb *= vec3("+c.red+", "+c.green+", "+c.blue+"); \n"}if(t.debugShowFrustums){var h=1&e.debugOverlappingFrustums?"1.0":"0.0",m=2&e.debugOverlappingFrustums?"1.0":"0.0",p=4&e.debugOverlappingFrustums?"1.0":"0.0";if(d>0)for(u=0;u<d;++u)f+="    gl_FragData["+l[u]+"].rgb *= vec3("+h+", "+m+", "+p+"); \n";else f+="    gl_FragColor.rgb *= vec3("+h+", "+m+", "+p+"); \n"}f+="}",s.sources.push(f);var _=function(e){var t={},a=e.vertexAttributes;for(var i in a)a.hasOwnProperty(i)&&(t[i]=a[i].index);return t}(r);return R.a.fromCache({context:i,vertexShaderSource:r.vertexShaderSource,fragmentShaderSource:s,attributeLocations:_})}(e,t),i.execute(t.context,a),i.shaderProgram.destroy()}Jg.prototype.clearPasses=function(e){e.render=!1,e.pick=!1,e.depth=!1,e.postProcess=!1,e.offscreen=!1},Jg.prototype.updateFrameState=function(){var e=this.camera,t=this._frameState;t.commandList.length=0,t.shadowMaps.length=0,t.brdfLutGenerator=this._brdfLutGenerator,t.environmentMap=this.skyBox&&this.skyBox._cubeMap,t.mode=this._mode,t.morphTime=this.morphTime,t.mapProjection=this.mapProjection,t.camera=e,t.cullingVolume=e.frustum.computeCullingVolume(e.positionWC,e.directionWC,e.upWC),t.occluder=function(e){var t=e.globe;if(e._mode===L.a.SCENE3D&&Object(o.default)(t)&&t.show){var a=t.ellipsoid,i=e.frameState.minimumTerrainHeight;return ov.radius=a.minimumRadius+i,tv=Pn.fromBoundingSphere(ov,e.camera.positionWC,tv)}}(this),t.terrainExaggeration=this._terrainExaggeration,t.minimumTerrainHeight=0,t.minimumDisableDepthTestDistance=this._minimumDisableDepthTestDistance,t.invertClassification=this.invertClassification,t.useLogDepth=this._logDepthBuffer&&!(this.camera.frustum instanceof ee.a||this.camera.frustum instanceof ha.a),t.light=this.light,Object(o.default)(this._specularEnvironmentMapAtlas)&&this._specularEnvironmentMapAtlas.ready?(t.specularEnvironmentMaps=this._specularEnvironmentMapAtlas.texture,t.specularEnvironmentMapsMaximumLOD=this._specularEnvironmentMapAtlas.maximumMipmapLevel):(t.specularEnvironmentMaps=void 0,t.specularEnvironmentMapsMaximumLOD=void 0),t.sphericalHarmonicCoefficients=this.sphericalHarmonicCoefficients,this._actualInvertClassificationColor=G.default.clone(this.invertClassificationColor,this._actualInvertClassificationColor),Ld.isTranslucencySupported(this._context)||(this._actualInvertClassificationColor.alpha=1),t.invertClassificationColor=this._actualInvertClassificationColor,Object(o.default)(this.globe)?t.maximumScreenSpaceError=this.globe.maximumScreenSpaceError:t.maximumScreenSpaceError=2,this.clearPasses(t.passes),t.tilesetPassState=void 0},Jg.prototype.isVisible=function(e,t,a){return Object(o.default)(e)&&(!Object(o.default)(e.boundingVolume)||!e.cull||t.computeVisibility(e.boundingVolume)!==Z.default.OUTSIDE&&(!Object(o.default)(a)||!e.occlude||!e.boundingVolume.isOccluded(a)))};var uv=new J.default(0,0,1,0,1,0,0,0,0,1,0,0,0,0,0,1);function dv(e,t,a,r,n){var s=t._frameState;if(!Object(o.default)(t.debugCommandFilter)||t.debugCommandFilter(e))if(e instanceof Rn.a)e.execute(a,r);else{e.debugShowBoundingVolume&&Object(o.default)(e.boundingVolume)&&function(e,t,a,r){var n,s=t._frameState,l=s.context,u=e.boundingVolume;Object(o.default)(t._debugVolume)&&t._debugVolume.destroy();var d=i.default.clone(u.center);if(s.mode!==L.a.SCENE3D){d=J.default.multiplyByPoint(uv,d,d);var f=s.mapProjection,c=f.unproject(d);d=f.ellipsoid.cartographicToCartesian(c)}if(Object(o.default)(u.radius)){var h=u.radius;n=Q.a.toWireframe(un.a.createGeometry(new un.a({radii:new i.default(h,h,h),vertexFormat:je.a.FLAT_VERTEX_FORMAT}))),t._debugVolume=new Ve.a({geometryInstances:new X.a({geometry:n,modelMatrix:J.default.fromTranslation(d),attributes:{color:new W.a(1,0,0,1)}}),appearance:new je.a({flat:!0,translucent:!1}),asynchronous:!1})}else{var m=u.halfAxes;n=Q.a.toWireframe(Hr.a.createGeometry(Hr.a.fromDimensions({dimensions:new i.default(2,2,2),vertexFormat:je.a.FLAT_VERTEX_FORMAT}))),t._debugVolume=new Ve.a({geometryInstances:new X.a({geometry:n,modelMatrix:J.default.fromRotationTranslation(m,d,new J.default),attributes:{color:new W.a(1,0,0,1)}}),appearance:new je.a({flat:!0,translucent:!1}),asynchronous:!1})}var p,_=s.commandList,g=s.commandList=[];t._debugVolume.update(s),e=g[0],s.useLogDepth&&(e=ad.createLogDepthCommand(e,l).command),Object(o.default)(r)&&(p=a.framebuffer,a.framebuffer=r),e.execute(l,a),Object(o.default)(p)&&(a.framebuffer=p),s.commandList=_}(e,t,r,n),s.useLogDepth&&Object(o.default)(e.derivedCommands.logDepth)&&(e=e.derivedCommands.logDepth.command);var l=s.passes;if(!l.pick&&t._hdr&&Object(o.default)(e.derivedCommands)&&Object(o.default)(e.derivedCommands.hdr)&&(e=e.derivedCommands.hdr.command),l.pick||l.depth){if(l.pick&&!l.depth&&Object(o.default)(e.derivedCommands.picking))return void(e=e.derivedCommands.picking.pickCommand).execute(a,r);if(Object(o.default)(e.derivedCommands.depth))return void(e=e.derivedCommands.depth.depthOnlyCommand).execute(a,r)}t.debugShowCommands||t.debugShowFrustums?lv(e,t,r):s.shadowState.lightShadowsEnabled&&e.receiveShadows&&Object(o.default)(e.derivedCommands.shadows)?e.derivedCommands.shadows.receiveCommand.execute(a,r):e.execute(a,r)}}function fv(e,t,a,i){var r=t._frameState,n=e.derivedCommands;Object(o.default)(n)&&(r.useLogDepth&&Object(o.default)(n.logDepth)&&(e=n.logDepth.command),n=e.derivedCommands,Object(o.default)(n.picking)?(e=n.picking.pickCommand).execute(a,i):Object(o.default)(n.depth)&&(e=n.depth.depthOnlyCommand).execute(a,i))}function cv(e,t,a){return t.boundingVolume.distanceSquaredTo(a)-e.boundingVolume.distanceSquaredTo(a)}function hv(e,t,a){return e.boundingVolume.distanceSquaredTo(a)-t.boundingVolume.distanceSquaredTo(a)+K.default.EPSILON12}function mv(e,t,a,i,r){var n=e.context;mn(i,cv,e.camera.positionWC),Object(o.default)(r)&&t(r.unclassifiedCommand,e,n,a);for(var s=i.length,l=0;l<s;++l)t(i[l],e,n,a)}function pv(e,t,a,i,r){var n=e.context;mn(i,hv,e.camera.positionWC),Object(o.default)(r)&&t(r.unclassifiedCommand,e,n,a);for(var s=i.length,l=0;l<s;++l)t(i[l],e,n,a)}function _v(e,t){var a=e._view.debugGlobeDepths,i=a[t];return!Object(o.default)(i)&&e.context.depthTexture&&(i=new Id,a[t]=i),i}uv=J.default.inverseTransformation(uv,uv);var gv=new Dn.a,vv=new In.a,yv=new ee.a,bv=new ha.a;function wv(e,t){var a,i=e.camera,r=e.context,n=r.uniformState;n.updateCamera(i),(a=Object(o.default)(i.frustum.fov)?i.frustum.clone(gv):Object(o.default)(i.frustum.infiniteProjectionMatrix)?i.frustum.clone(vv):Object(o.default)(i.frustum.width)?i.frustum.clone(yv):i.frustum.clone(bv)).near=i.frustum.near,a.far=i.frustum.far,n.updateFrustum(a),n.updatePass(de.a.ENVIRONMENT);var s,l=e._frameState.passes,u=l.pick,d=e._environmentState,f=e._view,c=d.renderTranslucentDepthForPick,h=d.useWebVR;if(!u){var m,p=d.skyBoxCommand;if(Object(o.default)(p)&&dv(p,e,r,t),d.isSkyAtmosphereVisible&&dv(d.skyAtmosphereCommand,e,r,t),d.isSunVisible)if(d.sunDrawCommand.execute(r,t),e.sunBloom&&!h)m=d.useGlobeDepthFramebuffer?f.globeDepth.framebuffer:d.usePostProcess?f.sceneFramebuffer.getFramebuffer():d.originalFramebuffer,e._sunPostProcess.execute(r),e._sunPostProcess.copy(r,m),t.framebuffer=m;d.isMoonVisible&&d.moonCommand.execute(r,t)}d.useOIT?(Object(o.default)(e._executeOITFunction)||(e._executeOITFunction=function(e,t,a,i,r){f.oit.executeCommands(e,t,a,i,r)}),s=e._executeOITFunction):s=l.render?mv:pv;for(var _,g=f.frustumCommandsList,v=g.length,y=d.clearGlobeDepth,b=d.useDepthPlane,w=d.separatePrimitiveFramebuffer=!1,O=e._depthClearCommand,x=e._stencilClearCommand,C=e._classificationStencilClearCommand,T=e._depthPlane,E=d.usePostProcessSelected,A=i.position.z,S=0;S<v;++S){var P=v-S-1,D=g[P];e.mode===L.a.SCENE2D?(i.position.z=A-D.near+1,a.far=Math.max(1,D.far-D.near),a.near=1,n.update(e.frameState),n.updateFrustum(a)):(a.near=0!==P?D.near*e.opaqueFrustumNearOffset:D.near,a.far=D.far,n.updateFrustum(a));var I,M=e.debugShowGlobeDepth?_v(e,P):f.globeDepth;w&&(t.framebuffer=M.framebuffer),e.debugShowGlobeDepth&&Object(o.default)(M)&&d.useGlobeDepthFramebuffer&&(M.update(r,t,f.viewport,e._hdr,y),M.clear(r,t,e._clearColorCommand.color),I=t.framebuffer,t.framebuffer=M.framebuffer),O.execute(r,t),r.stencilBuffer&&x.execute(r,t),n.updatePass(de.a.GLOBE);var F,R=D.commands[de.a.GLOBE],N=D.indices[de.a.GLOBE];for(_=0;_<N;++_)dv(R[_],e,r,t);for(Object(o.default)(M)&&d.useGlobeDepthFramebuffer&&M.executeCopyDepth(r,t),e.debugShowGlobeDepth&&Object(o.default)(M)&&d.useGlobeDepthFramebuffer&&(t.framebuffer=I),n.updatePass(de.a.TERRAIN_CLASSIFICATION),R=D.commands[de.a.TERRAIN_CLASSIFICATION],N=D.indices[de.a.TERRAIN_CLASSIFICATION],_=0;_<N;++_)dv(R[_],e,r,t);if(y&&(O.execute(r,t),b&&T.execute(r,t)),w&&(t.framebuffer=M.primitiveFramebuffer),!d.useInvertClassification||u){for(n.updatePass(de.a.CESIUM_3D_TILE),R=D.commands[de.a.CESIUM_3D_TILE],N=D.indices[de.a.CESIUM_3D_TILE],_=0;_<N;++_)dv(R[_],e,r,t);if(N>0)for(Object(o.default)(M)&&d.useGlobeDepthFramebuffer&&M.executeUpdateDepth(r,t,y),n.updatePass(de.a.CESIUM_3D_TILE_CLASSIFICATION),R=D.commands[de.a.CESIUM_3D_TILE_CLASSIFICATION],N=D.indices[de.a.CESIUM_3D_TILE_CLASSIFICATION],_=0;_<N;++_)dv(R[_],e,r,t)}else{e._invertClassification.clear(r,t);var j=t.framebuffer;for(t.framebuffer=e._invertClassification._fbo,n.updatePass(de.a.CESIUM_3D_TILE),R=D.commands[de.a.CESIUM_3D_TILE],N=D.indices[de.a.CESIUM_3D_TILE],_=0;_<N;++_)dv(R[_],e,r,t);for(Object(o.default)(M)&&d.useGlobeDepthFramebuffer&&M.executeUpdateDepth(r,t,y),n.updatePass(de.a.CESIUM_3D_TILE_CLASSIFICATION_IGNORE_SHOW),R=D.commands[de.a.CESIUM_3D_TILE_CLASSIFICATION_IGNORE_SHOW],N=D.indices[de.a.CESIUM_3D_TILE_CLASSIFICATION_IGNORE_SHOW],_=0;_<N;++_)dv(R[_],e,r,t);for(t.framebuffer=j,e._invertClassification.executeClassified(r,t),1===e.frameState.invertClassificationColor.alpha&&e._invertClassification.executeUnclassified(r,t),N>0&&r.stencilBuffer&&C.execute(r,t),n.updatePass(de.a.CESIUM_3D_TILE_CLASSIFICATION),R=D.commands[de.a.CESIUM_3D_TILE_CLASSIFICATION],N=D.indices[de.a.CESIUM_3D_TILE_CLASSIFICATION],_=0;_<N;++_)dv(R[_],e,r,t)}for(N>0&&r.stencilBuffer&&x.execute(r,t),n.updatePass(de.a.OPAQUE),R=D.commands[de.a.OPAQUE],N=D.indices[de.a.OPAQUE],_=0;_<N;++_)dv(R[_],e,r,t);if(0!==P&&e.mode!==L.a.SCENE2D&&(a.near=D.near,n.updateFrustum(a)),!u&&d.useInvertClassification&&e.frameState.invertClassificationColor.alpha<1&&(F=e._invertClassification),n.updatePass(de.a.TRANSLUCENT),(R=D.commands[de.a.TRANSLUCENT]).length=D.indices[de.a.TRANSLUCENT],s(e,dv,t,R,F),r.depthTexture&&e.useDepthPicking&&(d.useGlobeDepthFramebuffer||c)){var V=c?t.framebuffer.depthStencilTexture:M.framebuffer.depthStencilTexture,U=e._picking.getPickDepth(e,P);U.update(r,V),U.executeCopyDepth(r,t)}if(w&&(t.framebuffer=M.framebuffer),!u&&E){var z=t.framebuffer;for(t.framebuffer=f.sceneFramebuffer.getIdFramebuffer(),a.near=0!==P?D.near*e.opaqueFrustumNearOffset:D.near,a.far=D.far,n.updateFrustum(a),n.updatePass(de.a.GLOBE),R=D.commands[de.a.GLOBE],N=D.indices[de.a.GLOBE],_=0;_<N;++_)fv(R[_],e,r,t);for(y&&(O.framebuffer=t.framebuffer,O.execute(r,t),O.framebuffer=void 0),y&&b&&T.execute(r,t),n.updatePass(de.a.CESIUM_3D_TILE),R=D.commands[de.a.CESIUM_3D_TILE],N=D.indices[de.a.CESIUM_3D_TILE],_=0;_<N;++_)fv(R[_],e,r,t);for(n.updatePass(de.a.OPAQUE),R=D.commands[de.a.OPAQUE],N=D.indices[de.a.OPAQUE],_=0;_<N;++_)fv(R[_],e,r,t);for(n.updatePass(de.a.TRANSLUCENT),R=D.commands[de.a.TRANSLUCENT],N=D.indices[de.a.TRANSLUCENT],_=0;_<N;++_)fv(R[_],e,r,t);t.framebuffer=z}}}function Ov(e){e.context.uniformState.updatePass(de.a.COMPUTE);var t=e._environmentState.sunComputeCommand;Object(o.default)(t)&&t.execute(e._computeEngine);for(var a=e._computeCommandList,i=a.length,r=0;r<i;++r)a[r].execute(e._computeEngine)}function xv(e,t,a){for(var i=a.shadowMapCullingVolume,r=a.isPointLight,n=a.passes,o=n.length,s=t.length,l=0;l<s;++l){var u=t[l];if(e.updateDerivedCommands(u),u.castShadows&&(u.pass===de.a.GLOBE||u.pass===de.a.CESIUM_3D_TILE||u.pass===de.a.OPAQUE||u.pass===de.a.TRANSLUCENT)&&e.isVisible(u,i))if(r)for(var d=0;d<o;++d)n[d].commandList.push(u);else if(1===o)n[0].commandList.push(u);else for(var f=!1,c=o-1;c>=0;--c){var h=n[c].cullingVolume;if(e.isVisible(u,h))n[c].commandList.push(u),f=!0;else if(f)break}}}function Cv(e){var t=e.frameState,a=t.shadowState.shadowMaps,i=a.length;if(t.shadowState.shadowsEnabled)for(var r=e.context,n=r.uniformState,o=0;o<i;++o){var s=a[o];if(!s.outOfView){var l,u=s.passes,d=u.length;for(l=0;l<d;++l)u[l].commandList.length=0;for(xv(e,e.frameState.commandList,s),l=0;l<d;++l){var f=s.passes[l];n.updateCamera(f.camera),s.updatePass(r,l);for(var c=f.commandList.length,h=0;h<c;++h){var m=f.commandList[h];n.updatePass(m.pass),dv(m.derivedCommands.shadows.castCommands[o],e,r,f.passState)}}}}}var Tv=new i.default;Jg.prototype.updateAndExecuteCommands=function(e,t){var a=this._frameState.mode;this._environmentState.useWebVR?function(e,t,a){var r=e._view,o=r.camera,s=e._environmentState.renderTranslucentDepthForPick;jv(e,t,a),s||Lv(e);r.createPotentiallyVisibleSet(e),s||(Ov(e),Cv(e));var l=t.viewport;l.x=0,l.y=0,l.width=.5*l.width;var u=Zl.clone(o,e._cameraVR);u.frustum=o.frustum;var d=o.frustum.near,f=d*Object(n.default)(e.focalLength,5),c=Object(n.default)(e.eyeSeparation,f/30),h=i.default.multiplyByScalar(u.right,.5*c,Tv);o.frustum.aspectRatio=l.width/l.height;var m=.5*c*d/f;i.default.add(u.position,h,o.position),o.frustum.xOffset=m,wv(e,t),l.x=l.width,i.default.subtract(u.position,h,o.position),o.frustum.xOffset=-m,wv(e,t),Zl.clone(u,o)}(this,e,t):a!==L.a.SCENE2D||this._mapMode2D===Go.ROTATE?Rv(!0,this,e,t):(jv(this,e,t),function(e,t){var a=e.context,r=e.frameState,n=e.camera,o=t.viewport,s=nn.default.clone(o,Fv);t.viewport=s;var l=Ev,u=Av;e.mapProjection.project(l,u);var d=i.default.clone(n.position,Sv),f=J.default.clone(n.transform,Dv),c=n.frustum.clone();n._setTransform(J.default.IDENTITY);var h=J.default.computeViewportTransformation(s,0,1,Pv),m=n.frustum.projectionMatrix,p=n.positionWC.y,_=i.default.fromElements(K.default.sign(p)*u.x-p,0,-n.positionWC.x,Iv),g=Br.default.pointToGLWindowCoordinates(m,h,_,Mv);g.x=Math.floor(g.x);var v=s.x,y=s.width;if(0===p||g.x<=v||g.x>=v+y)Rv(!0,e,t);else if(Math.abs(v+.5*y-g.x)<1)s.width=g.x-s.x,n.position.x*=K.default.sign(n.position.x),n.frustum.right=0,r.cullingVolume=n.frustum.computeCullingVolume(n.positionWC,n.directionWC,n.upWC),a.uniformState.update(r),Rv(!0,e,t),s.x=g.x,n.position.x=-n.position.x,n.frustum.right=-n.frustum.left,n.frustum.left=0,r.cullingVolume=n.frustum.computeCullingVolume(n.positionWC,n.directionWC,n.upWC),a.uniformState.update(r),Rv(!1,e,t);else if(g.x>v+.5*y){s.width=g.x-v;var b=n.frustum.right;n.frustum.right=u.x-p,r.cullingVolume=n.frustum.computeCullingVolume(n.positionWC,n.directionWC,n.upWC),a.uniformState.update(r),Rv(!0,e,t),s.x=g.x,s.width=v+y-g.x,n.position.x=-n.position.x,n.frustum.left=-n.frustum.right,n.frustum.right=b-2*n.frustum.right,r.cullingVolume=n.frustum.computeCullingVolume(n.positionWC,n.directionWC,n.upWC),a.uniformState.update(r),Rv(!1,e,t)}else{s.x=g.x,s.width=v+y-g.x;var w=n.frustum.left;n.frustum.left=-u.x-p,r.cullingVolume=n.frustum.computeCullingVolume(n.positionWC,n.directionWC,n.upWC),a.uniformState.update(r),Rv(!0,e,t),s.x=v,s.width=g.x-v,n.position.x=-n.position.x,n.frustum.right=-n.frustum.left,n.frustum.left=w-2*n.frustum.left,r.cullingVolume=n.frustum.computeCullingVolume(n.positionWC,n.directionWC,n.upWC),a.uniformState.update(r),Rv(!1,e,t)}n._setTransform(f),i.default.clone(d,n.position),n.frustum=c.clone(),t.viewport=o}(this,e))};var Ev=new y.default(Math.PI,K.default.PI_OVER_TWO),Av=new i.default,Sv=new i.default,Pv=new J.default,Dv=new J.default,Iv=new i.default,Mv=new i.default,Fv=new nn.default;function Rv(e,t,a,i){var r=t._environmentState,n=t._view,s=r.renderTranslucentDepthForPick;e||s||(t.frameState.commandList.length=0),s||Lv(t),n.createPotentiallyVisibleSet(t),e&&(Object(o.default)(i)&&jv(t,a,i),s||(Ov(t),Cv(t))),wv(t,a)}var Nv=new sn.a;function Lv(e){var t=e._frameState;e._groundPrimitives.update(t),e._primitives.update(t),function(e){var t=e._frameState;e.debugShowFrustumPlanes!==e._debugShowFrustumPlanes&&(e.debugShowFrustumPlanes?e._debugFrustumPlanes=new Hu({camera:e.camera,updateOnChange:!1}):e._debugFrustumPlanes=e._debugFrustumPlanes&&e._debugFrustumPlanes.destroy(),e._debugShowFrustumPlanes=e.debugShowFrustumPlanes),Object(o.default)(e._debugFrustumPlanes)&&e._debugFrustumPlanes.update(t)}(e),function(e){var t=e._frameState,a=t.shadowMaps,i=a.length,r=i>0&&!t.passes.pick&&e.mode===L.a.SCENE3D;if(r!==t.shadowState.shadowsEnabled&&(++t.shadowState.lastDirtyTime,t.shadowState.shadowsEnabled=r),t.shadowState.lightShadowsEnabled=!1,r){for(var n=0;n<i;++n)if(a[n]!==t.shadowState.shadowMaps[n]){++t.shadowState.lastDirtyTime;break}t.shadowState.shadowMaps.length=0,t.shadowState.lightShadowMaps.length=0;for(var o=0;o<i;++o){var s=a[o];s.update(t),t.shadowState.shadowMaps.push(s),s.fromLightSource&&(t.shadowState.lightShadowMaps.push(s),t.shadowState.lightShadowsEnabled=!0),s.dirty&&(++t.shadowState.lastDirtyTime,s.dirty=!1)}}}(e),e._globe&&e._globe.render(t)}function jv(e,t,a){var i=e._context,r=e._frameState,n=e._environmentState,s=e._view,l=e._frameState.passes.pick,u=n.useWebVR;n.originalFramebuffer=t.framebuffer,Object(o.default)(e.sun)&&e.sunBloom!==e._sunBloom?(e.sunBloom&&!u?e._sunPostProcess=new Zg:Object(o.default)(e._sunPostProcess)&&(e._sunPostProcess=e._sunPostProcess.destroy()),e._sunBloom=e.sunBloom):!Object(o.default)(e.sun)&&Object(o.default)(e._sunPostProcess)&&(e._sunPostProcess=e._sunPostProcess.destroy(),e._sunBloom=!1);var d=e._clearColorCommand;G.default.clone(a,d.color),d.execute(i,t);var f=n.useGlobeDepthFramebuffer=Object(o.default)(s.globeDepth);f&&(s.globeDepth.update(i,t,s.viewport,e._hdr,n.clearGlobeDepth),s.globeDepth.clear(i,t,a));var c=s.oit,h=n.useOIT=!l&&Object(o.default)(c)&&c.isSupported();h&&(c.update(i,t,s.globeDepth.framebuffer,e._hdr),c.clear(i,t,a),n.useOIT=c.isSupported());var m,p=e.postProcessStages,_=n.usePostProcess=!l&&(e._hdr||p.length>0||p.ambientOcclusion.enabled||p.fxaa.enabled||p.bloom.enabled);if(n.usePostProcessSelected=!1,_&&(s.sceneFramebuffer.update(i,s.viewport,e._hdr),s.sceneFramebuffer.clear(i,t,a),p.update(i,r.useLogDepth,e._hdr),p.clear(i),_=n.usePostProcess=p.ready,n.usePostProcessSelected=_&&p.hasSelected),n.isSunVisible&&e.sunBloom&&!u?(t.framebuffer=e._sunPostProcess.update(t),e._sunPostProcess.clear(i,t,a)):f?t.framebuffer=s.globeDepth.framebuffer:_&&(t.framebuffer=s.sceneFramebuffer.getFramebuffer()),Object(o.default)(t.framebuffer)&&d.execute(i,t),n.useInvertClassification=!l&&Object(o.default)(t.framebuffer)&&e.invertClassification)if(1===e.frameState.invertClassificationColor.alpha&&n.useGlobeDepthFramebuffer&&(m=s.globeDepth.framebuffer),Object(o.default)(m)||i.depthTexture){if(e._invertClassification.previousFramebuffer=m,e._invertClassification.update(i),e._invertClassification.clear(i,t),e.frameState.invertClassificationColor.alpha<1&&h){var g=e._invertClassification.unclassifiedCommand,v=g.derivedCommands;v.oit=c.createDerivedCommands(g,i,v.oit)}}else n.useInvertClassification=!1}function Vv(e){e._jobScheduler.resetBudgets();var t=e._frameState;e.primitives.prePassesUpdate(t),Object(o.default)(e.globe)&&e.globe.update(t),e._picking.update(),t.creditDisplay.update()}function Uv(e){var t=e._frameState;e.primitives.postPassesUpdate(t),Mn.a.update()}Jg.prototype.updateEnvironment=function(){var e=this._frameState,t=this._view,a=this._environmentState,i=e.passes.render,r=e.passes.offscreen,n=this.skyAtmosphere,s=this.globe;if(!i||this._mode!==L.a.SCENE2D&&t.camera.frustum instanceof ee.a)a.skyAtmosphereCommand=void 0,a.skyBoxCommand=void 0,a.sunDrawCommand=void 0,a.sunComputeCommand=void 0,a.moonCommand=void 0;else{Object(o.default)(n)&&Object(o.default)(s)&&(n.setDynamicAtmosphereColor(s.enableLighting&&s.dynamicAtmosphereLighting,s.dynamicAtmosphereLightingFromSun),a.isReadyForAtmosphere=a.isReadyForAtmosphere||s._surface._tilesToRender.length>0),a.skyAtmosphereCommand=Object(o.default)(n)?n.update(e):void 0,a.skyBoxCommand=Object(o.default)(this.skyBox)?this.skyBox.update(e,this._hdr):void 0;var l=Object(o.default)(this.sun)?this.sun.update(e,t.passState,this._hdr):void 0;a.sunDrawCommand=Object(o.default)(l)?l.drawCommand:void 0,a.sunComputeCommand=Object(o.default)(l)?l.computeCommand:void 0,a.moonCommand=Object(o.default)(this.moon)?this.moon.update(e):void 0}var u=a.clearGlobeDepth=Object(o.default)(s)&&(!s.depthTestAgainstTerrain||this.mode===L.a.SCENE2D);(a.useDepthPlane=u&&this.mode===L.a.SCENE3D)&&this._depthPlane.update(e),a.renderTranslucentDepthForPick=!1,a.useWebVR=this._useWebVR&&this.mode!==L.a.SCENE2D&&!r;for(var d=e.mode===L.a.SCENE3D?e.occluder:void 0,f=e.cullingVolume,c=Nv.planes,h=0;h<5;++h)c[h]=f.planes[h];f=Nv,a.isSkyAtmosphereVisible=Object(o.default)(a.skyAtmosphereCommand)&&a.isReadyForAtmosphere,a.isSunVisible=this.isVisible(a.sunDrawCommand,f,d),a.isMoonVisible=this.isVisible(a.moonCommand,f,d);var m=this.specularEnvironmentMaps,p=this._specularEnvironmentMapAtlas;!Object(o.default)(m)||Object(o.default)(p)&&p.url===m?!Object(o.default)(m)&&Object(o.default)(p)&&(p.destroy(),this._specularEnvironmentMapAtlas=void 0):(p=p&&p.destroy(),this._specularEnvironmentMapAtlas=new Bd.a(m)),Object(o.default)(this._specularEnvironmentMapAtlas)&&this._specularEnvironmentMapAtlas.update(e)},Jg.prototype.resolveFramebuffers=function(e){var t=this._context,a=this._frameState,i=this._environmentState,r=this._view,o=r.globeDepth,s=i.useOIT,l=i.useGlobeDepthFramebuffer,u=i.usePostProcess,d=i.originalFramebuffer,f=l?o.framebuffer:void 0,c=r.sceneFramebuffer.getFramebuffer(),h=r.sceneFramebuffer.getIdFramebuffer();if(i.separatePrimitiveFramebuffer&&o.executeMergeColor(t,e),s&&(e.framebuffer=u?c:d,r.oit.execute(t,e)),u){var m=c;l&&!s&&(m=f);var p=this.postProcessStages,_=m.getColorTexture(0),g=h.getColorTexture(0),v=Object(n.default)(f,c).depthStencilTexture;p.execute(t,_,v,g),p.copy(t,d)}s||u||!l||(e.framebuffer=d,o.executeCopyColor(t,e));var y=a.useLogDepth;this.debugShowGlobeDepth&&l&&_v(this,this.debugShowDepthFrustum-1).executeDebugGlobeDepth(t,e,y);this.debugShowPickDepth&&l&&this._picking.getPickDepth(this,this.debugShowDepthFrustum-1).executeDebugPickDepth(t,e,y)},Jg.prototype.initializeFrame=function(){120==this._shaderFrameCount++&&(this._shaderFrameCount=0,this._context.shaderCache.destroyReleasedShaderPrograms(),this._context.textureCache.destroyReleasedTextures()),this._tweens.update(),this._screenSpaceCameraController.update(),Object(o.default)(this._deviceOrientationCameraController)&&this._deviceOrientationCameraController.update(),this.camera.update(this._mode),this.camera._updateCameraChanged()};var zv=new G.default;function Bv(e){var t=e._frameState,a=e.context,r=a.uniformState,s=e._defaultView;e._view=s,e.updateFrameState(),t.passes.render=!0,t.passes.postProcess=e.postProcessStages.hasSelected,t.tilesetPassState=av;var l=Object(n.default)(e.backgroundColor,G.default.BLACK);e._hdr&&((l=G.default.clone(l,zv)).red=Math.pow(l.red,e.gamma),l.green=Math.pow(l.green,e.gamma),l.blue=Math.pow(l.blue,e.gamma)),t.backgroundColor=l,e.fog.update(t),r.update(t);var u=e.shadowMap;Object(o.default)(u)&&u.enabled&&(!Object(o.default)(e.light)||e.light instanceof ro?i.default.negate(r.sunDirectionWC,e._shadowMapCamera.direction):i.default.clone(e.light.direction,e._shadowMapCamera.direction),t.shadowMaps.push(u)),e._computeCommandList.length=0,e._overlayCommandList.length=0;var d=s.viewport;d.x=0,d.y=0,d.width=a.drawingBufferWidth,d.height=a.drawingBufferHeight;var f=s.passState;f.framebuffer=void 0,f.blendingEnabled=void 0,f.scissorTest=void 0,f.viewport=nn.default.clone(d,f.viewport),Object(o.default)(e.globe)&&e.globe.beginFrame(t),e.updateEnvironment(),e.updateAndExecuteCommands(f,l),e.resolveFramebuffers(f),f.framebuffer=void 0,function(e,t){e.context.uniformState.updatePass(de.a.OVERLAY);for(var a=e.context,i=e._overlayCommandList,r=i.length,n=0;n<r;++n)i[n].execute(a,t)}(e,f),Object(o.default)(e.globe)&&(e.globe.endFrame(t),e.globe.tilesLoaded||(e._renderRequested=!0)),a.endFrame()}function Hv(e,t){try{t(e)}catch(t){if(e._renderError.raiseEvent(e,t),e.rethrowRenderErrors)throw t}}function kv(e){return e._picking.updateMostDetailedRayPicks(e)}function Gv(e){var t=e._frameState;iv.camera=t.camera,iv.cullingVolume=t.cullingVolume,e.primitives.updateForPass(t,iv)}function Wv(e){var t=e._frameState;t.camera.canPreloadFlight()&&(rv.camera=e.preloadFlightCamera,rv.cullingVolume=e.preloadFlightCullingVolume,e.primitives.updateForPass(t,rv))}function Yv(e){e.primitives.updateForPass(e._frameState,nv)}Jg.prototype.render=function(e){this._preUpdate.raiseEvent(this,e);var t=this._frameState;t.newFrame=!1,Object(o.default)(e)||(e=ri.default.now());var a=this._view.checkForCameraUpdates(this),i=!this.requestRenderMode||this._renderRequested||a||this._logDepthBufferDirty||this._hdrDirty||this.mode===L.a.MORPHING;if(!i&&Object(o.default)(this.maximumRenderTimeChange)&&Object(o.default)(this._lastRenderTime)){var r=Math.abs(ri.default.secondsDifference(this._lastRenderTime,e));i=i||r>this.maximumRenderTimeChange}i&&(this._lastRenderTime=ri.default.clone(e,this._lastRenderTime),this._renderRequested=!1,this._logDepthBufferDirty=!1,this._hdrDirty=!1,sv(this,K.default.incrementWrap(t.frameNumber,15e6,1),e),t.newFrame=!0);Hv(this,Vv),this.primitives.show&&(Hv(this,kv),Hv(this,Gv),Hv(this,Wv),i||Hv(this,Yv)),this._postUpdate.raiseEvent(this,e),i&&(this._preRender.raiseEvent(this,e),t.creditDisplay.beginFrame(),Hv(this,Bv)),function(e,t){if(e.debugShowFramesPerSecond){if(!Object(o.default)(e._performanceDisplay)){var a=document.createElement("div");a.className="cesium-performanceDisplay-defaultContainer",e._canvas.parentNode.appendChild(a);var i=new Gd({container:a});e._performanceDisplay=i,e._performanceContainer=a}e._performanceDisplay.throttled=e.requestRenderMode,e._performanceDisplay.update(t)}else Object(o.default)(e._performanceDisplay)&&(e._performanceDisplay=e._performanceDisplay&&e._performanceDisplay.destroy(),e._performanceContainer.parentNode.removeChild(e._performanceContainer))}(this,i),Hv(this,Uv),function(e){for(var t=e._frameState.afterRender,a=0,i=t.length;a<i;++a)t[a](),e.requestRender();t.length=0}(this),i&&(this._postRender.raiseEvent(this,e),t.creditDisplay.endFrame())},Jg.prototype.forceRender=function(e){this._renderRequested=!0,this.render(e)},Jg.prototype.requestRender=function(){this._renderRequested=!0},Jg.prototype.clampLineWidth=function(e){return Math.max(le.a.minimumAliasedLineWidth,Math.min(e,le.a.maximumAliasedLineWidth))},Jg.prototype.pick=function(e,t,a){return this._picking.pick(this,e,t,a)},Jg.prototype.pickPositionWorldCoordinates=function(e,t){return this._picking.pickPositionWorldCoordinates(this,e,t)},Jg.prototype.pickPosition=function(e,t){return this._picking.pickPosition(this,e,t)},Jg.prototype.drillPick=function(e,t,a,i){return this._picking.drillPick(this,e,t,a,i)},Jg.prototype.pickFromRay=function(e,t,a){return this._picking.pickFromRay(this,e,t,a)},Jg.prototype.drillPickFromRay=function(e,t,a,i){return this._picking.drillPickFromRay(this,e,t,a,i)},Jg.prototype.pickFromRayMostDetailed=function(e,t,a){return this._picking.pickFromRayMostDetailed(this,e,t,a)},Jg.prototype.drillPickFromRayMostDetailed=function(e,t,a,i){return this._picking.drillPickFromRayMostDetailed(this,e,t,a,i)},Jg.prototype.sampleHeight=function(e,t,a){return this._picking.sampleHeight(this,e,t,a)},Jg.prototype.clampToHeight=function(e,t,a,i){return this._picking.clampToHeight(this,e,t,a,i)},Jg.prototype.sampleHeightMostDetailed=function(e,t,a){return this._picking.sampleHeightMostDetailed(this,e,t,a)},Jg.prototype.clampToHeightMostDetailed=function(e,t,a){return this._picking.clampToHeightMostDetailed(this,e,t,a)},Jg.prototype.cartesianToCanvasCoordinates=function(e,t){return af.default.wgs84ToWindowCoordinates(this,e,t)},Jg.prototype.completeMorph=function(){this._transitioner.completeMorph()},Jg.prototype.morphTo2D=function(e){var t,a=this.globe;t=Object(o.default)(a)?a.ellipsoid:this.mapProjection.ellipsoid,e=Object(n.default)(e,2),this._transitioner.morphTo2D(e,t)},Jg.prototype.morphToColumbusView=function(e){var t,a=this.globe;t=Object(o.default)(a)?a.ellipsoid:this.mapProjection.ellipsoid,e=Object(n.default)(e,2),this._transitioner.morphToColumbusView(e,t)},Jg.prototype.morphTo3D=function(e){var t,a=this.globe;t=Object(o.default)(a)?a.ellipsoid:this.mapProjection.ellipsoid,e=Object(n.default)(e,2),this._transitioner.morphTo3D(e,t)},Jg.prototype.isDestroyed=function(){return!1},Jg.prototype.destroy=function(){this._tweens.removeAll(),this._computeEngine=this._computeEngine&&this._computeEngine.destroy(),this._screenSpaceCameraController=this._screenSpaceCameraController&&this._screenSpaceCameraController.destroy(),this._deviceOrientationCameraController=this._deviceOrientationCameraController&&!this._deviceOrientationCameraController.isDestroyed()&&this._deviceOrientationCameraController.destroy(),this._primitives=this._primitives&&this._primitives.destroy(),this._groundPrimitives=this._groundPrimitives&&this._groundPrimitives.destroy(),this._globe=this._globe&&this._globe.destroy(),this.skyBox=this.skyBox&&this.skyBox.destroy(),this.skyAtmosphere=this.skyAtmosphere&&this.skyAtmosphere.destroy(),this._debugSphere=this._debugSphere&&this._debugSphere.destroy(),this.sun=this.sun&&this.sun.destroy(),this._sunPostProcess=this._sunPostProcess&&this._sunPostProcess.destroy(),this._depthPlane=this._depthPlane&&this._depthPlane.destroy(),this._transitioner=this._transitioner&&this._transitioner.destroy(),this._debugFrustumPlanes=this._debugFrustumPlanes&&this._debugFrustumPlanes.destroy(),this._brdfLutGenerator=this._brdfLutGenerator&&this._brdfLutGenerator.destroy(),this._picking=this._picking&&this._picking.destroy(),this._defaultView=this._defaultView&&this._defaultView.destroy(),this._view=void 0,this._removeCreditContainer&&this._canvas.parentNode.removeChild(this._creditContainer),this.postProcessStages=this.postProcessStages&&this.postProcessStages.destroy(),this._context=this._context&&this._context.destroy(),this._frameState.creditDisplay=this._frameState.creditDisplay&&this._frameState.creditDisplay.destroy(),Object(o.default)(this._performanceDisplay)&&(this._performanceDisplay=this._performanceDisplay&&this._performanceDisplay.destroy(),this._performanceContainer.parentNode.removeChild(this._performanceContainer)),this._removeRequestListenerCallback(),this._removeTaskProcessorListenerCallback();for(var e=0;e<this._removeGlobeCallbacks.length;++e)this._removeGlobeCallbacks[e]();return this._removeGlobeCallbacks.length=0,Object(l.default)(this)};var Xv=Jg,Qv='/**\n * @license\n * Copyright (c) 2000-2005, Sean O\'Neil (s_p_oneil@hotmail.com)\n * All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions\n * are met:\n *\n * * Redistributions of source code must retain the above copyright notice,\n *   this list of conditions and the following disclaimer.\n * * Redistributions in binary form must reproduce the above copyright notice,\n *   this list of conditions and the following disclaimer in the documentation\n *   and/or other materials provided with the distribution.\n * * Neither the name of the project nor the names of its contributors may be\n *   used to endorse or promote products derived from this software without\n *   specific prior written permission.\n *\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"\n * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE\n * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR\n * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER\n * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,\n * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n *\n * Modifications made by Analytical Graphics, Inc.\n */\n\n // Code:  http://sponeil.net/\n // GPU Gems 2 Article:  https://developer.nvidia.com/gpugems/GPUGems2/gpugems2_chapter16.html\n\n#ifdef COLOR_CORRECT\nuniform vec3 u_hsbShift; // Hue, saturation, brightness\n#endif\n\nuniform vec4 u_cameraAndRadiiAndDynamicAtmosphereColor; // Camera height, outer radius, inner radius, dynamic atmosphere color flag\n\n#ifdef SPLIT_ATMOSPHERE\nuniform float u_splitDirection;\n#endif\n\nconst float g = -0.95;\nconst float g2 = g * g;\n\nvarying vec3 v_rayleighColor;\nvarying vec3 v_mieColor;\nvarying vec3 v_toCamera;\nvarying vec3 v_positionEC;\n\nvoid main (void)\n{\n#ifdef SPLIT_ATMOSPHERE\n    float splitPosition = czm_imagerySplitPosition;\n    if (u_splitDirection < 0.0 && gl_FragCoord.x > splitPosition) {\n        discard;\n    } else if (u_splitDirection > 0.0 && gl_FragCoord.x < splitPosition) {\n        discard;\n    }\n#endif\n\n     float lightEnum = u_cameraAndRadiiAndDynamicAtmosphereColor.w;\n    vec3 lightDirection =\n        czm_viewerPositionWC * float(lightEnum == 0.0) +\n        czm_lightDirectionWC * float(lightEnum == 1.0) +\n        czm_sunDirectionWC * float(lightEnum == 2.0);\n    lightDirection = normalize(lightDirection);\n\n    // Extra normalize added for Android\n    float cosAngle = dot(lightDirection, normalize(v_toCamera)) / length(v_toCamera);\n    float rayleighPhase = 0.75 * (1.0 + cosAngle * cosAngle);\n    float miePhase = 1.5 * ((1.0 - g2) / (2.0 + g2)) * (1.0 + cosAngle * cosAngle) / pow(1.0 + g2 - 2.0 * g * cosAngle, 1.5);\n\n    vec3 rgb = rayleighPhase * v_rayleighColor + miePhase * v_mieColor;\n\n#ifndef HDR\n    const float exposure = 2.0;\n    rgb = vec3(1.0) - exp(-exposure * rgb);\n#endif\n\n#ifdef COLOR_CORRECT\n    // Convert rgb color to hsb\n    vec3 hsb = czm_RGBToHSB(rgb);\n    // Perform hsb shift\n    hsb.x += u_hsbShift.x; // hue\n    hsb.y = clamp(hsb.y + u_hsbShift.y, 0.0, 1.0); // saturation\n    hsb.z = hsb.z > czm_epsilon7 ? hsb.z + u_hsbShift.z : 0.0; // brightness\n    // Convert shifted hsb back to rgb\n    rgb = czm_HSBToRGB(hsb);\n#endif\n\n    // Alter alpha based on how close the viewer is to the ground (1.0 = on ground, 0.0 = at edge of atmosphere)\n    float atmosphereAlpha = clamp((u_cameraAndRadiiAndDynamicAtmosphereColor.y - u_cameraAndRadiiAndDynamicAtmosphereColor.x) / (u_cameraAndRadiiAndDynamicAtmosphereColor.y - u_cameraAndRadiiAndDynamicAtmosphereColor.z), 0.0, 1.0);\n\n    // Alter alpha based on time of day (0.0 = night , 1.0 = day)\n    float nightAlpha = (lightEnum != 0.0) ? clamp(dot(normalize(czm_viewerPositionWC), lightDirection), 0.0, 1.0) : 1.0;\n    atmosphereAlpha *= pow(nightAlpha, 0.5);\n\n    gl_FragColor = vec4(rgb, mix(rgb.b, 1.0, atmosphereAlpha) * smoothstep(0.0, 1.0, czm_morphTime));\n}\n',qv="/**\n * @license\n * Copyright (c) 2000-2005, Sean O'Neil (s_p_oneil@hotmail.com)\n * All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions\n * are met:\n *\n * * Redistributions of source code must retain the above copyright notice,\n *   this list of conditions and the following disclaimer.\n * * Redistributions in binary form must reproduce the above copyright notice,\n *   this list of conditions and the following disclaimer in the documentation\n *   and/or other materials provided with the distribution.\n * * Neither the name of the project nor the names of its contributors may be\n *   used to endorse or promote products derived from this software without\n *   specific prior written permission.\n *\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\"\n * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE\n * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR\n * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER\n * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,\n * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n *\n * Modifications made by Analytical Graphics, Inc.\n */\n\n // Code:  http://sponeil.net/\n // GPU Gems 2 Article:  https://developer.nvidia.com/gpugems/GPUGems2/gpugems2_chapter16.html\n\nattribute vec4 position;\n\nuniform vec4 u_cameraAndRadiiAndDynamicAtmosphereColor; // Camera height, outer radius, inner radius, dynamic atmosphere color flag\n\nconst float Kr = 0.0025;\nconst float Kr4PI = Kr * 4.0 * czm_pi;\nconst float Km = 0.0015;\nconst float Km4PI = Km * 4.0 * czm_pi;\nconst float ESun = 15.0;\nconst float KmESun = Km * ESun;\nconst float KrESun = Kr * ESun;\nconst vec3 InvWavelength = vec3(\n    5.60204474633241,  // Red = 1.0 / Math.pow(0.650, 4.0)\n    9.473284437923038, // Green = 1.0 / Math.pow(0.570, 4.0)\n    19.643802610477206); // Blue = 1.0 / Math.pow(0.475, 4.0)\nconst float rayleighScaleDepth = 0.25;\n\nconst int nSamples = 2;\nconst float fSamples = 2.0;\n\nvarying vec3 v_rayleighColor;\nvarying vec3 v_mieColor;\nvarying vec3 v_toCamera;\n\nfloat scale(float cosAngle)\n{\n    float x = 1.0 - cosAngle;\n    return rayleighScaleDepth  * exp(-0.00287 + x*(0.459 + x*(3.83 + x*(-6.80 + x*5.25))));\n}\n\nvoid main(void)\n{\n    // Unpack attributes\n    float cameraHeight = u_cameraAndRadiiAndDynamicAtmosphereColor.x;\n    float outerRadius = u_cameraAndRadiiAndDynamicAtmosphereColor.y;\n    float innerRadius = u_cameraAndRadiiAndDynamicAtmosphereColor.z;\n\n    // Get the ray from the camera to the vertex and its length (which is the far point of the ray passing through the atmosphere)\n    vec3 positionV3 = position.xyz;\n    vec3 ray = positionV3 - czm_viewerPositionWC;\n    float far = length(ray);\n    ray /= far;\n    float atmosphereScale = 1.0 / (outerRadius - innerRadius);\n\n#ifdef SKY_FROM_SPACE\n    // Calculate the closest intersection of the ray with the outer atmosphere (which is the near point of the ray passing through the atmosphere)\n    float B = 2.0 * dot(czm_viewerPositionWC, ray);\n    float C = cameraHeight * cameraHeight - outerRadius * outerRadius;\n    float det = max(0.0, B*B - 4.0 * C);\n    float near = 0.5 * (-B - sqrt(det));\n\n    // Calculate the ray's starting position, then calculate its scattering offset\n    vec3 start = czm_viewerPositionWC + ray * near;\n    far -= near;\n    float startAngle = dot(ray, start) / outerRadius;\n    float startDepth = exp(-1.0 / rayleighScaleDepth );\n    float startOffset = startDepth*scale(startAngle);\n#else // SKY_FROM_ATMOSPHERE\n    // Calculate the ray's starting position, then calculate its scattering offset\n    vec3 start = czm_viewerPositionWC;\n    float height = length(start);\n    float depth = exp((atmosphereScale / rayleighScaleDepth ) * (innerRadius - cameraHeight));\n    float startAngle = dot(ray, start) / height;\n    float startOffset = depth*scale(startAngle);\n#endif\n\n    float lightEnum = u_cameraAndRadiiAndDynamicAtmosphereColor.w;\n    vec3 lightDirection =\n        czm_viewerPositionWC * float(lightEnum == 0.0) +\n        czm_lightDirectionWC * float(lightEnum == 1.0) +\n        czm_sunDirectionWC * float(lightEnum == 2.0);\n    lightDirection = normalize(lightDirection);\n\n    // Initialize the scattering loop variables\n    float sampleLength = far / fSamples;\n    float scaledLength = sampleLength * atmosphereScale;\n    vec3 sampleRay = ray * sampleLength;\n    vec3 samplePoint = start + sampleRay * 0.5;\n\n    // Now loop through the sample rays\n    vec3 frontColor = vec3(0.0, 0.0, 0.0);\n\n    for(int i=0; i<nSamples; i++)\n    {\n        float height = length(samplePoint);\n        float depth = exp((atmosphereScale / rayleighScaleDepth ) * (innerRadius - height));\n        float fLightAngle = dot(lightDirection, samplePoint) / height;\n        float fCameraAngle = dot(ray, samplePoint) / height;\n        float fScatter = (startOffset + depth*(scale(fLightAngle) - scale(fCameraAngle)));\n        vec3 attenuate = exp(-fScatter * (InvWavelength * Kr4PI + Km4PI));\n        frontColor += attenuate * (depth * scaledLength);\n        samplePoint += sampleRay;\n    }\n\n    // Finally, scale the Mie and Rayleigh colors and set up the varying variables for the pixel shader\n    v_mieColor = frontColor * KmESun;\n    v_rayleighColor = frontColor * (InvWavelength * KrESun);\n    v_toCamera = czm_viewerPositionWC - positionV3;\n    gl_Position = czm_modelViewProjection * position;\n}\n";
/**
 * @license
 * Copyright (c) 2000-2005, Sean O'Neil (s_p_oneil@hotmail.com)
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 *
 * * Redistributions of source code must retain the above copyright notice,
 *   this list of conditions and the following disclaimer.
 * * Redistributions in binary form must reproduce the above copyright notice,
 *   this list of conditions and the following disclaimer in the documentation
 *   and/or other materials provided with the distribution.
 * * Neither the name of the project nor the names of its contributors may be
 *   used to endorse or promote products derived from this software without
 *   specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
 * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
 * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
 * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 * Modifications made by Analytical Graphics, Inc.
 */function Zv(e){e=Object(n.default)(e,d.default.WGS84),this.show=!0,this._ellipsoid=e,this._command=new ue.a({owner:this}),this._spSkyFromSpace=void 0,this._spSkyFromAtmosphere=void 0,this._spSkyFromSpaceColorCorrect=void 0,this._spSkyFromAtmosphereColorCorrect=void 0,this.hueShift=0,this.saturationShift=0,this.brightnessShift=0,this.splitDirection=O.default.NONE,this._splitDirection=void 0,this._hueSaturationBrightness=new i.default;var t=new H.a;t.w=0,t.y=i.default.maximumComponent(i.default.multiplyByScalar(e.radii,1.025,new i.default)),t.z=e.maximumRadius,this._cameraAndRadiiAndDynamicAtmosphereColor=t;var a=this;this._command.uniformMap={u_cameraAndRadiiAndDynamicAtmosphereColor:function(){return a._cameraAndRadiiAndDynamicAtmosphereColor},u_hsbShift:function(){return a._hueSaturationBrightness.x=a.hueShift,a._hueSaturationBrightness.y=a.saturationShift,a._hueSaturationBrightness.z=a.brightnessShift,a._hueSaturationBrightness},u_splitDirection:function(){return a.splitDirection}}}Object(s.default)(Zv.prototype,{ellipsoid:{get:function(){return this._ellipsoid}}}),Zv.prototype.setDynamicAtmosphereColor=function(e,t){this._cameraAndRadiiAndDynamicAtmosphereColor.w=e?t?2:1:0},Zv.prototype.update=function(e){if(this.show){var t=e.mode;if((t===L.a.SCENE3D||t===L.a.MORPHING)&&e.passes.render){var a=this._command,r=e.context;if(!Object(o.default)(a.vertexArray)){var n=un.a.createGeometry(new un.a({radii:i.default.multiplyByScalar(this._ellipsoid.radii,1.025,new i.default),slicePartitions:256,stackPartitions:256,vertexFormat:kr.default.POSITION_ONLY}));a.vertexArray=ce.a.fromGeometry({context:r,geometry:n,attributeLocations:Q.a.createAttributeLocations(n),bufferUsage:se.a.STATIC_DRAW}),a.renderState=fe.a.fromCache({cull:{enabled:!0,face:Yr.a.FRONT},blending:he.a.ALPHA_BLEND,depthMask:!1})}if(this.splitDirection!==this._splitDirection){this._spSkyFromSpace=this._spSkyFromSpace&&this._spSkyFromSpace.destroy(),this._spSkyFromAtmosphere=this._spSkyFromAtmosphere&&this._spSkyFromAtmosphere.destroy(),this._spSkyFromSpaceColorCorrect=this._spSkyFromSpaceColorCorrect&&this._spSkyFromSpaceColorCorrect.destroy(),this._spSkyFromAtmosphereColorCorrect=this._spSkyFromAtmosphereColorCorrect&&this._spSkyFromAtmosphereColorCorrect.destroy();var s=new A.a({defines:["SKY_FROM_SPACE"],sources:[qv]}),l=Qv;this.splitDirection!==O.default.NONE&&(l=new A.a({defines:["SPLIT_ATMOSPHERE"],sources:[Qv]})),this._spSkyFromSpace=R.a.fromCache({context:r,vertexShaderSource:s,fragmentShaderSource:l}),s=new A.a({defines:["SKY_FROM_ATMOSPHERE"],sources:[qv]}),this._spSkyFromAtmosphere=R.a.fromCache({context:r,vertexShaderSource:s,fragmentShaderSource:l}),this._splitDirection=this.splitDirection}var u,d=(u=this,!(K.default.equalsEpsilon(u.hueShift,0,K.default.EPSILON7)&&K.default.equalsEpsilon(u.saturationShift,0,K.default.EPSILON7)&&K.default.equalsEpsilon(u.brightnessShift,0,K.default.EPSILON7)));if(d&&(!Object(o.default)(this._spSkyFromSpaceColorCorrect)||!Object(o.default)(this._spSkyFromAtmosphereColorCorrect))){var f=e.context,c=new A.a({defines:["SKY_FROM_SPACE"],sources:[qv]}),h=new A.a({defines:O.default.NONE?["COLOR_CORRECT"]:["COLOR_CORRECT","SPLIT_ATMOSPHERE"],sources:[Qv]});this._spSkyFromSpaceColorCorrect=R.a.fromCache({context:f,vertexShaderSource:c,fragmentShaderSource:h}),c=new A.a({defines:["SKY_FROM_ATMOSPHERE"],sources:[qv]}),this._spSkyFromAtmosphereColorCorrect=R.a.fromCache({context:f,vertexShaderSource:c,fragmentShaderSource:h})}var m=e.camera.positionWC,p=i.default.magnitude(m);return this._cameraAndRadiiAndDynamicAtmosphereColor.x=p,p>this._cameraAndRadiiAndDynamicAtmosphereColor.y?a.shaderProgram=d?this._spSkyFromSpaceColorCorrect:this._spSkyFromSpace:a.shaderProgram=d?this._spSkyFromAtmosphereColorCorrect:this._spSkyFromAtmosphere,a}}},Zv.prototype.isDestroyed=function(){return!1},Zv.prototype.destroy=function(){var e=this._command;return e.vertexArray=e.vertexArray&&e.vertexArray.destroy(),this._spSkyFromSpace=this._spSkyFromSpace&&this._spSkyFromSpace.destroy(),this._spSkyFromAtmosphere=this._spSkyFromAtmosphere&&this._spSkyFromAtmosphere.destroy(),this._spSkyFromSpaceColorCorrect=this._spSkyFromSpaceColorCorrect&&this._spSkyFromSpaceColorCorrect.destroy(),this._spSkyFromAtmosphereColorCorrect=this._spSkyFromAtmosphereColorCorrect&&this._spSkyFromAtmosphereColorCorrect.destroy(),Object(l.default)(this)};var Kv=Zv;var Jv=function(e,t){var a={flipY:!0,preferImageBitmap:!0},i=[E.default.createIfNeeded(t.positiveX).fetchImage(a),E.default.createIfNeeded(t.negativeX).fetchImage(a),E.default.createIfNeeded(t.positiveY).fetchImage(a),E.default.createIfNeeded(t.negativeY).fetchImage(a),E.default.createIfNeeded(t.positiveZ).fetchImage(a),E.default.createIfNeeded(t.negativeZ).fetchImage(a)];return M.default.all(i,(function(t){return new Zn.a({context:e,source:{positiveX:t[0],negativeX:t[1],positiveY:t[2],negativeY:t[3],positiveZ:t[4],negativeZ:t[5]}})}))};function $v(e){this.sources=e.sources,this._sources=void 0,this.show=Object(n.default)(e.show,!0),this._command=new ue.a({modelMatrix:J.default.clone(J.default.IDENTITY),owner:this}),this._cubeMap=void 0,this._attributeLocations=void 0,this._useHdr=void 0}$v.prototype.update=function(e,t){var a=this;if(this.show&&(e.mode===L.a.SCENE3D||e.mode===L.a.MORPHING)&&e.passes.render){var r=e.context;if(this._sources!==this.sources){this._sources=this.sources;var n=this.sources;"string"==typeof n.positiveX?Jv(r,this._sources).then((function(e){a._cubeMap=a._cubeMap&&a._cubeMap.destroy(),a._cubeMap=e})):(this._cubeMap=this._cubeMap&&this._cubeMap.destroy(),this._cubeMap=new Zn.a({context:r,source:n}))}var s=this._command;if(!Object(o.default)(s.vertexArray)){s.uniformMap={u_cubeMap:function(){return a._cubeMap}};var l=Hr.a.createGeometry(Hr.a.fromDimensions({dimensions:new i.default(2,2,2),vertexFormat:kr.default.POSITION_ONLY})),u=this._attributeLocations=Q.a.createAttributeLocations(l);s.vertexArray=ce.a.fromGeometry({context:r,geometry:l,attributeLocations:u,bufferUsage:se.a.STATIC_DRAW}),s.renderState=fe.a.fromCache({blending:he.a.ALPHA_BLEND})}if(!Object(o.default)(s.shaderProgram)||this._useHdr!==t){var d=new A.a({defines:[t?"HDR":""],sources:["uniform samplerCube u_cubeMap;\n\nvarying vec3 v_texCoord;\n\nvoid main()\n{\n    vec4 color = textureCube(u_cubeMap, normalize(v_texCoord));\n    gl_FragColor = vec4(czm_gammaCorrect(color).rgb, czm_morphTime);\n}\n"]});s.shaderProgram=R.a.fromCache({context:r,vertexShaderSource:"attribute vec3 position;\n\nvarying vec3 v_texCoord;\n\nvoid main()\n{\n    vec3 p = czm_viewRotation * (czm_temeToPseudoFixed * (czm_entireFrustum.y * position));\n    gl_Position = czm_projection * vec4(p, 1.0);\n    v_texCoord = position.xyz;\n}\n",fragmentShaderSource:d,attributeLocations:this._attributeLocations}),this._useHdr=t}if(Object(o.default)(this._cubeMap))return s}},$v.prototype.isDestroyed=function(){return!1},$v.prototype.destroy=function(){var e=this._command;return e.vertexArray=e.vertexArray&&e.vertexArray.destroy(),e.shaderProgram=e.shaderProgram&&e.shaderProgram.destroy(),this._cubeMap=this._cubeMap&&this._cubeMap.destroy(),Object(l.default)(this)};var ey=$v;function ty(){this.show=!0,this._drawCommand=new ue.a({primitiveType:te.a.TRIANGLES,boundingVolume:new v.default,owner:this}),this._commands={drawCommand:this._drawCommand,computeCommand:void 0},this._boundingVolume=new v.default,this._boundingVolume2D=new v.default,this._texture=void 0,this._drawingBufferWidth=void 0,this._drawingBufferHeight=void 0,this._radiusTS=void 0,this._size=void 0,this.glowFactor=1,this._glowFactorDirty=!1,this._useHdr=void 0;var e=this;this._uniformMap={u_texture:function(){return e._texture},u_size:function(){return e._size}}}Object(s.default)(ty.prototype,{glowFactor:{get:function(){return this._glowFactor},set:function(e){e=Math.max(e,0),this._glowFactor=e,this._glowFactorDirty=!0}}});var ay=new B.default,iy=new B.default,ry=new H.a,ny=new H.a;ty.prototype.update=function(e,t,a){if(this.show){var r=e.mode;if(r!==L.a.SCENE2D&&r!==L.a.MORPHING&&e.passes.render){var n=e.context,s=t.viewport.width,l=t.viewport.height;if(!Object(o.default)(this._texture)||s!==this._drawingBufferWidth||l!==this._drawingBufferHeight||this._glowFactorDirty||a!==this._useHdr){this._texture=this._texture&&this._texture.destroy(),this._drawingBufferWidth=s,this._drawingBufferHeight=l,this._glowFactorDirty=!1,this._useHdr=a;var u=Math.max(s,l);u=Math.pow(2,Math.ceil(Math.log(u)/Math.log(2))-2),u=Math.max(1,u);var d=a?n.halfFloatingPointTexture?we.a.HALF_FLOAT:we.a.FLOAT:we.a.UNSIGNED_BYTE;this._texture=new S.a({context:n,width:u,height:u,pixelFormat:_e.a.RGBA,pixelDatatype:d}),this._glowLengthTS=5*this._glowFactor,this._radiusTS=1/(1+2*this._glowLengthTS)*.5;var f=this,c={u_radiusTS:function(){return f._radiusTS}};this._commands.computeCommand=new Xn.a({fragmentShaderSource:"uniform float u_radiusTS;\n\nvarying vec2 v_textureCoordinates;\n\nvec2 rotate(vec2 p, vec2 direction)\n{\n    return vec2(p.x * direction.x - p.y * direction.y, p.x * direction.y + p.y * direction.x);\n}\n\nvec4 addBurst(vec2 position, vec2 direction, float lengthScalar)\n{\n    vec2 rotatedPosition = rotate(position, direction) * vec2(25.0, 0.75);\n    float radius = length(rotatedPosition) * lengthScalar;\n    float burst = 1.0 - smoothstep(0.0, 0.55, radius);\n    return vec4(burst);\n}\n\nvoid main()\n{\n    float lengthScalar = 2.0 / sqrt(2.0);\n    vec2 position = v_textureCoordinates - vec2(0.5);\n    float radius = length(position) * lengthScalar;\n    float surface = step(radius, u_radiusTS);\n    vec4 color = vec4(vec2(1.0), surface + 0.2, surface);\n\n    float glow = 1.0 - smoothstep(0.0, 0.55, radius);\n    color.ba += mix(vec2(0.0), vec2(1.0), glow) * 0.75;\n\n    vec4 burst = vec4(0.0);\n\n    // The following loop has been manually unrolled for speed, to\n    // avoid sin() and cos().\n    //\n    //for (float i = 0.4; i < 3.2; i += 1.047) {\n    //    vec2 direction = vec2(sin(i), cos(i));\n    //    burst += 0.4 * addBurst(position, direction, lengthScalar);\n    //\n    //    direction = vec2(sin(i - 0.08), cos(i - 0.08));\n    //    burst += 0.3 * addBurst(position, direction, lengthScalar);\n    //}\n\n    burst += 0.4 * addBurst(position, vec2(0.38942,  0.92106), lengthScalar);  // angle == 0.4\n    burst += 0.4 * addBurst(position, vec2(0.99235,  0.12348), lengthScalar);  // angle == 0.4 + 1.047\n    burst += 0.4 * addBurst(position, vec2(0.60327, -0.79754), lengthScalar);  // angle == 0.4 + 1.047 * 2.0\n\n    burst += 0.3 * addBurst(position, vec2(0.31457,  0.94924), lengthScalar);  // angle == 0.4 - 0.08\n    burst += 0.3 * addBurst(position, vec2(0.97931,  0.20239), lengthScalar);  // angle == 0.4 + 1.047 - 0.08\n    burst += 0.3 * addBurst(position, vec2(0.66507, -0.74678), lengthScalar);  // angle == 0.4 + 1.047 * 2.0 - 0.08\n\n    // End of manual loop unrolling.\n\n    color += clamp(burst, vec4(0.0), vec4(1.0)) * 0.15;\n\n    gl_FragColor = clamp(color, vec4(0.0), vec4(1.0));\n}\n",outputTexture:this._texture,uniformMap:c,persists:!1,owner:this,postExecute:function(){f._commands.computeCommand=void 0}})}var h=this._drawCommand;if(!Object(o.default)(h.vertexArray)){var m={direction:0},p=new Uint8Array(8);p[0]=0,p[1]=0,p[2]=255,p[3]=0,p[4]=255,p[5]=255,p[6]=0,p[7]=255;var _=oe.a.createVertexBuffer({context:n,typedArray:p,usage:se.a.STATIC_DRAW}),g=[{index:m.direction,vertexBuffer:_,componentsPerAttribute:2,normalize:!0,componentDatatype:Bn.a.UNSIGNED_BYTE}],y=oe.a.createIndexBuffer({context:n,typedArray:new Uint16Array([0,1,2,0,2,3]),usage:se.a.STATIC_DRAW,indexDatatype:q.a.UNSIGNED_SHORT});h.vertexArray=new ce.a({context:n,attributes:g,indexBuffer:y}),h.shaderProgram=R.a.fromCache({context:n,vertexShaderSource:"attribute vec2 direction;\n\nuniform float u_size;\n\nvarying vec2 v_textureCoordinates;\n\nvoid main() \n{\n    vec4 position;\n    if (czm_morphTime == 1.0)\n    {\n        position = vec4(czm_sunPositionWC, 1.0);\n    }\n    else\n    {\n        position = vec4(czm_sunPositionColumbusView.zxy, 1.0);\n    }\n    \n    vec4 positionEC = czm_view * position;\n    vec4 positionWC = czm_eyeToWindowCoordinates(positionEC);\n    \n    vec2 halfSize = vec2(u_size * 0.5);\n    halfSize *= ((direction * 2.0) - 1.0);\n    \n    gl_Position = czm_viewportOrthographic * vec4(positionWC.xy + halfSize, -positionWC.z, 1.0);\n    \n    v_textureCoordinates = direction;\n}\n",fragmentShaderSource:"uniform sampler2D u_texture;\n\nvarying vec2 v_textureCoordinates;\n\nvoid main()\n{\n    vec4 color = texture2D(u_texture, v_textureCoordinates);\n    gl_FragColor = czm_gammaCorrect(color);\n}\n",attributeLocations:m}),h.renderState=fe.a.fromCache({blending:he.a.ALPHA_BLEND}),h.uniformMap=this._uniformMap}var b=n.uniformState.sunPositionWC,w=n.uniformState.sunPositionColumbusView,O=this._boundingVolume,x=this._boundingVolume2D;i.default.clone(b,O.center),x.center.x=w.z,x.center.y=w.x,x.center.z=w.y,O.radius=K.default.SOLAR_RADIUS+K.default.SOLAR_RADIUS*this._glowLengthTS,x.radius=O.radius,r===L.a.SCENE3D?v.default.clone(O,h.boundingVolume):r===L.a.COLUMBUS_VIEW&&v.default.clone(x,h.boundingVolume);var C=af.default.computeActualWgs84Position(e,b,ny),T=i.default.magnitude(i.default.subtract(C,e.camera.position,ny)),E=n.uniformState.projection,A=ry;A.x=0,A.y=0,A.z=-T,A.w=1;var P=J.default.multiplyByVector(E,A,ny),D=af.default.clipToGLWindowCoordinates(t.viewport,P,ay);A.x=K.default.SOLAR_RADIUS;var I=J.default.multiplyByVector(E,A,ny),M=af.default.clipToGLWindowCoordinates(t.viewport,I,iy);return this._size=B.default.magnitude(B.default.subtract(M,D,ny)),this._size=2*this._size*(1+2*this._glowLengthTS),this._size=Math.ceil(this._size),this._commands}}},ty.prototype.isDestroyed=function(){return!1},ty.prototype.destroy=function(){var e=this._drawCommand;return e.vertexArray=e.vertexArray&&e.vertexArray.destroy(),e.shaderProgram=e.shaderProgram&&e.shaderProgram.destroy(),this._texture=this._texture&&this._texture.destroy(),Object(l.default)(this)};var oy=ty;function sy(e){return a(1607)("./tycho2t3_80_"+e+".jpg")}function ly(e){var t=e._useBrowserRecommendedResolution?1:window.devicePixelRatio;return t*=e._resolutionScale,Object(o.default)(e._scene)&&(e._scene.pixelRatio=t),t}function uy(e){var t=e._canvas,a=t.clientWidth,i=t.clientHeight,r=ly(e);e._canvasClientWidth=a,e._canvasClientHeight=i,a*=r,i*=r,t.width=a,t.height=i,e._canRender=0!==a&&0!==i,e._lastDevicePixelRatio=window.devicePixelRatio}function dy(e){var t=e._canvas,a=t.width,i=t.height;if(0!==a&&0!==i){var r=e._scene.camera.frustum;Object(o.default)(r.aspectRatio)?r.aspectRatio=a/i:(r.top=r.right*(i/a),r.bottom=-r.top)}}function fy(e,t){e=Object(Hd.default)(e),t=Object(n.default)(t,n.default.EMPTY_OBJECT);var a=document.createElement("div");a.className="cesium-widget",e.appendChild(a);var s=document.createElement("canvas"),l=f.default.supportsImageRenderingPixelated();this._supportsImageRenderingPixelated=l,l&&(s.style.imageRendering=f.default.imageRenderingValue()),s.oncontextmenu=function(){return!1},s.onselectstart=function(){return!1},a.appendChild(s);var u=document.createElement("div");u.className="cesium-widget-credits";var c=Object(o.default)(t.creditContainer)?Object(Hd.default)(t.creditContainer):a;c.appendChild(u);var h=Object(o.default)(t.creditViewport)?Object(Hd.default)(t.creditViewport):a,p=Object(n.default)(t.showRenderLoopErrors,!0),_=Object(n.default)(t.useBrowserRecommendedResolution,!0);this._element=a,this._container=e,this._canvas=s,this._canvasClientWidth=0,this._canvasClientHeight=0,this._lastDevicePixelRatio=0,this._creditViewport=h,this._creditContainer=c,this._innerCreditContainer=u,this._canRender=!1,this._renderLoopRunning=!1,this._showRenderLoopErrors=p,this._resolutionScale=1,this._useBrowserRecommendedResolution=_,this._forceResize=!1,this._clock=Object(o.default)(t.clock)?t.clock:new r.default,uy(this);try{var v=new Xv({canvas:s,contextOptions:t.contextOptions,creditContainer:u,creditViewport:h,mapProjection:t.mapProjection,orderIndependentTranslucency:t.orderIndependentTranslucency,scene3DOnly:Object(n.default)(t.scene3DOnly,!1),terrainExaggeration:t.terrainExaggeration,shadows:t.shadows,mapMode2D:t.mapMode2D,requestRenderMode:t.requestRenderMode,maximumRenderTimeChange:t.maximumRenderTimeChange});this._scene=v,v.camera.constrainedAxis=i.default.UNIT_Z,ly(this),dy(this);var y=Object(n.default)(v.mapProjection.ellipsoid,d.default.WGS84),b=t.globe;Object(o.default)(b)||(b=new ai(y)),!1!==b&&(v.globe=b,v.globe.shadows=Object(n.default)(t.terrainShadows,Ue.default.RECEIVE_ONLY));var w=t.skyBox;Object(o.default)(w)||(w=new ey({sources:{positiveX:sy("px"),negativeX:sy("mx"),positiveY:sy("py"),negativeY:sy("my"),positiveZ:sy("pz"),negativeZ:sy("mz")}})),!1!==w&&(v.skyBox=w,v.sun=new oy,v.moon=new rn);var O=t.skyAtmosphere;Object(o.default)(O)||(O=new Kv(y)),!1!==O&&(v.skyAtmosphere=O);var x=!1!==t.globe&&t.imageryProvider;Object(o.default)(x)||(x=g()),!1!==x&&v.imageryLayers.addImageryProvider(x),Object(o.default)(t.terrainProvider)&&!1!==t.globe&&(v.terrainProvider=t.terrainProvider),this._screenSpaceEventHandler=new m.default(s),Object(o.default)(t.sceneMode)&&(t.sceneMode===L.a.SCENE2D&&this._scene.morphTo2D(0),t.sceneMode===L.a.COLUMBUS_VIEW&&this._scene.morphToColumbusView(0)),this._useDefaultRenderLoop=void 0,this.useDefaultRenderLoop=Object(n.default)(t.useDefaultRenderLoop,!0),this._targetFrameRate=void 0,this.targetFrameRate=t.targetFrameRate;var C=this;v.renderError.addEventListener((function(e,t){if(C._useDefaultRenderLoop=!1,C._renderLoopRunning=!1,C._showRenderLoopErrors){C.showErrorPanel("An error occurred while rendering.  Rendering has stopped.",void 0,t)}}))}catch(e){if(p){this.showErrorPanel("Error constructing CesiumWidget.",'Visit <a href="http://get.webgl.org">http://get.webgl.org</a> to verify that your web browser and hardware support WebGL.  Consider trying a different web browser or updating your video drivers.  Detailed error information is below:',e)}throw e}}Object(s.default)(fy.prototype,{container:{get:function(){return this._container}},canvas:{get:function(){return this._canvas}},creditContainer:{get:function(){return this._creditContainer}},creditViewport:{get:function(){return this._creditViewport}},scene:{get:function(){return this._scene}},imageryLayers:{get:function(){return this._scene.imageryLayers}},terrainProvider:{get:function(){return this._scene.terrainProvider},set:function(e){this._scene.terrainProvider=e}},camera:{get:function(){return this._scene.camera}},clock:{get:function(){return this._clock}},screenSpaceEventHandler:{get:function(){return this._screenSpaceEventHandler}},targetFrameRate:{get:function(){return this._targetFrameRate},set:function(e){this._targetFrameRate=e}},useDefaultRenderLoop:{get:function(){return this._useDefaultRenderLoop},set:function(e){this._useDefaultRenderLoop!==e&&(this._useDefaultRenderLoop=e,e&&!this._renderLoopRunning&&function(e){e._renderLoopRunning=!0;var t=0;Object(h.default)((function a(i){if(!e.isDestroyed())if(e._useDefaultRenderLoop)try{var r=e._targetFrameRate;if(Object(o.default)(r)){var n=1e3/r,s=i-t;s>n&&(e.resize(),e.render(),t=i-s%n),Object(h.default)(a)}else e.resize(),e.render(),Object(h.default)(a)}catch(t){if(e._useDefaultRenderLoop=!1,e._renderLoopRunning=!1,e._showRenderLoopErrors){e.showErrorPanel("An error occurred while rendering.  Rendering has stopped.",void 0,t)}}else e._renderLoopRunning=!1}))}(this))}},resolutionScale:{get:function(){return this._resolutionScale},set:function(e){this._resolutionScale!==e&&(this._resolutionScale=e,this._forceResize=!0)}},useBrowserRecommendedResolution:{get:function(){return this._useBrowserRecommendedResolution},set:function(e){this._useBrowserRecommendedResolution!==e&&(this._useBrowserRecommendedResolution=e,this._forceResize=!0)}}}),fy.prototype.showErrorPanel=function(e,t,a){var i=this._element,r=document.createElement("div");r.className="cesium-widget-errorPanel";var n=document.createElement("div");n.className="cesium-widget-errorPanel-content",r.appendChild(n);var s=document.createElement("div");s.className="cesium-widget-errorPanel-header",s.appendChild(document.createTextNode(e)),n.appendChild(s);var l=document.createElement("div");function u(){l.style.maxHeight=Math.max(Math.round(.9*i.clientHeight-100),30)+"px"}if(l.className="cesium-widget-errorPanel-scroll",n.appendChild(l),u(),Object(o.default)(window.addEventListener)&&window.addEventListener("resize",u,!1),Object(o.default)(t)){var d=document.createElement("div");d.className="cesium-widget-errorPanel-message",d.innerHTML="<p>"+t+"</p>",l.appendChild(d)}var f="(no error details available)";Object(o.default)(a)&&(f=Object(c.default)(a));var h=document.createElement("div");h.className="cesium-widget-errorPanel-message",h.appendChild(document.createTextNode(f)),l.appendChild(h);var m=document.createElement("div");m.className="cesium-widget-errorPanel-buttonPanel",n.appendChild(m);var p=document.createElement("button");p.setAttribute("type","button"),p.className="cesium-button",p.appendChild(document.createTextNode("OK")),p.onclick=function(){Object(o.default)(u)&&Object(o.default)(window.removeEventListener)&&window.removeEventListener("resize",u,!1),i.removeChild(r)},m.appendChild(p),i.appendChild(r),"undefined"!=typeof console&&console.error(e+"\n"+t+"\n"+f)},fy.prototype.isDestroyed=function(){return!1},fy.prototype.destroy=function(){this._scene=this._scene&&this._scene.destroy(),this._container.removeChild(this._element),this._creditContainer.removeChild(this._innerCreditContainer),Object(l.default)(this)},fy.prototype.resize=function(){var e=this._canvas;(this._forceResize||this._canvasClientWidth!==e.clientWidth||this._canvasClientHeight!==e.clientHeight||this._lastDevicePixelRatio!==window.devicePixelRatio)&&(this._forceResize=!1,uy(this),dy(this),this._scene.requestRender())},fy.prototype.forceResize=function(){this._lastWidth=0,this.resize()},fy.prototype.render=function(){if(this._canRender){this._scene.initializeFrame();var e=this._clock.tick();this._scene.render(e)}else this._clock.tick()};t.default=fy},751:function(e,t,a){"use strict";a.r(t);var i=a(152),r=a(35),n=(a(16),a(76)),o=a(9),s=a(8),l=a(10),u=a(20),d=a(145),f=a(367),c=a(245),h=a(364);function m(){this._length=0,this._collections={},this._collectionsArray=[],this.show=!0}Object(l.default)(m.prototype,{length:{get:function(){return this._length}}}),m.prototype.add=function(e,t){t=Object(o.default)(t,0);var a=this._collections[t];if(!Object(s.default)(a)){(a=new h.a({destroyPrimitives:!1}))._zIndex=t,this._collections[t]=a;for(var i=this._collectionsArray,r=0;r<i.length&&i[r]._zIndex<t;)r++;i.splice(r,0,a)}return a.add(e),this._length++,e._zIndex=t,e},m.prototype.set=function(e,t){return t===e._zIndex?e:(this.remove(e,!0),this.add(e,t),e)},m.prototype.remove=function(e,t){if(this.contains(e)){var a,i=e._zIndex,r=this._collections[i];return(a=t?r.remove(e):r.removeAndDestroy(e))&&this._length--,0===r.length&&(this._collectionsArray.splice(this._collectionsArray.indexOf(r),1),this._collections[i]=void 0,r.destroy()),a}return!1},m.prototype.removeAll=function(){for(var e=this._collectionsArray,t=0;t<e.length;t++){var a=e[t];a.destroyPrimitives=!0,a.destroy()}this._collections={},this._collectionsArray=[],this._length=0},m.prototype.contains=function(e){if(!Object(s.default)(e))return!1;var t=this._collections[e._zIndex];return Object(s.default)(t)&&t.contains(e)},m.prototype.update=function(e){if(this.show)for(var t=this._collectionsArray,a=0;a<t.length;a++)t[a].update(e)},m.prototype.isDestroyed=function(){return!1},m.prototype.destroy=function(){return this.removeAll(),Object(u.default)(this)};var p=m,_=a(82),g=a(60),v=a(25),y=a(13),b=a(23),w=a(11),O=a(88),x=a(168),C=a(71),T=a(157),E=a(144),A=a(93),S=a(40),P=b.default.WHITE,D=y.default.ZERO,I=C.default.NONE,M=v.default.ZERO,F=y.default.ZERO,R=T.default.CENTER,N=E.default.CENTER,L=new y.default,j=new b.default,V=new y.default,U=new v.default,z=new x.a,B=new x.a,H=new x.a,k=new g.default,G=new O.a;function W(e){this.entity=e,this.billboard=void 0,this.textureValue=void 0}function Y(e,t){t.collectionChanged.addEventListener(Y.prototype._onCollectionChanged,this),this._cluster=e,this._entityCollection=t,this._items=new _.default,this._onCollectionChanged(t,t.values,[],[])}function X(e,t,a){Object(s.default)(e)&&(e.billboard=void 0,a.removeBillboard(t))}Y.prototype.update=function(e){for(var t=this._items.values,a=this._cluster,i=0,r=t.length;i<r;i++){var n,o,l=t[i],u=l.entity,d=u._billboard,f=l.billboard,c=u.isShowing&&u.isAvailable(e)&&S.default.getValueOrDefault(d._show,e,!0);if(c&&(o=S.default.getValueOrUndefined(u._position,e,L),n=S.default.getValueOrUndefined(d._image,e),c=Object(s.default)(o)&&Object(s.default)(n)),c){S.default.isConstant(u._position)||(a._clusterDirty=!0),Object(s.default)(f)||((f=a.getBillboard(u)).id=u,f.image=void 0,l.billboard=f),f.show=c,Object(s.default)(f.image)&&l.textureValue===n||(f.image=n,l.textureValue=n),f.position=o,f.color=S.default.getValueOrDefault(d._color,e,P,j),f.eyeOffset=S.default.getValueOrDefault(d._eyeOffset,e,D,V),f.heightReference=S.default.getValueOrDefault(d._heightReference,e,I),f.pixelOffset=S.default.getValueOrDefault(d._pixelOffset,e,M,U),f.scale=S.default.getValueOrDefault(d._scale,e,1),f.rotation=S.default.getValueOrDefault(d._rotation,e,0),f.alignedAxis=S.default.getValueOrDefault(d._alignedAxis,e,F),f.horizontalOrigin=S.default.getValueOrDefault(d._horizontalOrigin,e,R),f.verticalOrigin=S.default.getValueOrDefault(d._verticalOrigin,e,N),f.width=S.default.getValueOrUndefined(d._width,e),f.height=S.default.getValueOrUndefined(d._height,e),f.scaleByDistance=S.default.getValueOrUndefined(d._scaleByDistance,e,z),f.translucencyByDistance=S.default.getValueOrUndefined(d._translucencyByDistance,e,B),f.pixelOffsetScaleByDistance=S.default.getValueOrUndefined(d._pixelOffsetScaleByDistance,e,H),f.sizeInMeters=S.default.getValueOrDefault(d._sizeInMeters,e,!1),f.distanceDisplayCondition=S.default.getValueOrUndefined(d._distanceDisplayCondition,e,G),f.disableDepthTestDistance=S.default.getValueOrUndefined(d._disableDepthTestDistance,e);var h=S.default.getValueOrUndefined(d._imageSubRegion,e,k);Object(s.default)(h)&&f.setImageSubRegion(f._imageId,h)}else X(l,u,a)}return!0},Y.prototype.getBoundingSphere=function(e,t){var a=this._items.get(e.id);if(!Object(s.default)(a)||!Object(s.default)(a.billboard))return A.default.FAILED;var i=a.billboard;if(i.heightReference===C.default.NONE)t.center=y.default.clone(i.position,t.center);else{if(!Object(s.default)(i._clampedPosition))return A.default.PENDING;t.center=y.default.clone(i._clampedPosition,t.center)}return t.radius=0,A.default.DONE},Y.prototype.isDestroyed=function(){return!1},Y.prototype.destroy=function(){this._entityCollection.collectionChanged.removeEventListener(Y.prototype._onCollectionChanged,this);for(var e=this._entityCollection.values,t=0;t<e.length;t++)this._cluster.removeBillboard(e[t]);return Object(u.default)(this)},Y.prototype._onCollectionChanged=function(e,t,a,i){var r,n,o=this._items,l=this._cluster;for(r=t.length-1;r>-1;r--)n=t[r],Object(s.default)(n._billboard)&&Object(s.default)(n._position)&&o.set(n.id,new W(n));for(r=i.length-1;r>-1;r--)n=i[r],Object(s.default)(n._billboard)&&Object(s.default)(n._position)?o.contains(n.id)||o.set(n.id,new W(n)):(X(o.get(n.id),n,l),o.remove(n.id));for(r=a.length-1;r>-1;r--)n=a[r],X(o.get(n.id),n,l),o.remove(n.id)};var Q=Y,q=a(211),Z=a(26),K=a(140),J=a(17),$=a(80),ee=a(318),te=a(216);function ae(e){e=Object(o.default)(e,o.default.EMPTY_OBJECT);var t=Object(o.default)(e.translucent,!0),a=Object(o.default)(e.closed,!1),i=Object(o.default)(e.materialSupport,ae.MaterialSupport.TEXTURED);this.material=Object(s.default)(e.material)?e.material:te.a.fromType(te.a.ColorType),this.translucent=t,this._vertexShaderSource=Object(o.default)(e.vertexShaderSource,i.vertexShaderSource),this._fragmentShaderSource=Object(o.default)(e.fragmentShaderSource,i.fragmentShaderSource),this._renderState=ee.a.getDefaultRenderState(t,a,e.renderState),this._closed=a,this._materialSupport=i,this._vertexFormat=i.vertexFormat,this._flat=Object(o.default)(e.flat,!1),this._faceForward=Object(o.default)(e.faceForward,!a)}Object(l.default)(ae.prototype,{vertexShaderSource:{get:function(){return this._vertexShaderSource}},fragmentShaderSource:{get:function(){return this._fragmentShaderSource}},renderState:{get:function(){return this._renderState}},closed:{get:function(){return this._closed}},materialSupport:{get:function(){return this._materialSupport}},vertexFormat:{get:function(){return this._vertexFormat}},flat:{get:function(){return this._flat}},faceForward:{get:function(){return this._faceForward}}}),ae.prototype.getFragmentShaderSource=ee.a.prototype.getFragmentShaderSource,ae.prototype.isTranslucent=ee.a.prototype.isTranslucent,ae.prototype.getRenderState=ee.a.prototype.getRenderState,ae.MaterialSupport={BASIC:Object(J.default)({vertexFormat:$.default.POSITION_AND_NORMAL,vertexShaderSource:"attribute vec3 position3DHigh;\nattribute vec3 position3DLow;\nattribute vec3 normal;\nattribute float batchId;\n\nvarying vec3 v_positionEC;\nvarying vec3 v_normalEC;\n\nvoid main()\n{\n    vec4 p = czm_computePosition();\n\n    v_positionEC = (czm_modelViewRelativeToEye * p).xyz;      // position in eye coordinates\n    v_normalEC = czm_normal * normal;                         // normal in eye coordinates\n\n    gl_Position = czm_modelViewProjectionRelativeToEye * p;\n}\n",fragmentShaderSource:"varying vec3 v_positionEC;\nvarying vec3 v_normalEC;\n\nvoid main()\n{\n    vec3 positionToEyeEC = -v_positionEC;\n\n    vec3 normalEC = normalize(v_normalEC);\n#ifdef FACE_FORWARD\n    normalEC = faceforward(normalEC, vec3(0.0, 0.0, 1.0), -normalEC);\n#endif\n\n    czm_materialInput materialInput;\n    materialInput.normalEC = normalEC;\n    materialInput.positionToEyeEC = positionToEyeEC;\n    czm_material material = czm_getMaterial(materialInput);\n\n#ifdef FLAT\n    gl_FragColor = vec4(material.diffuse + material.emission, material.alpha);\n#else\n    gl_FragColor = czm_phong(normalize(positionToEyeEC), material, czm_lightDirectionEC);\n#endif\n}\n"}),TEXTURED:Object(J.default)({vertexFormat:$.default.POSITION_NORMAL_AND_ST,vertexShaderSource:"attribute vec3 position3DHigh;\nattribute vec3 position3DLow;\nattribute vec3 normal;\nattribute vec2 st;\nattribute float batchId;\n\nvarying vec3 v_positionEC;\nvarying vec3 v_normalEC;\nvarying vec2 v_st;\n\nvoid main()\n{\n    vec4 p = czm_computePosition();\n\n    v_positionEC = (czm_modelViewRelativeToEye * p).xyz;      // position in eye coordinates\n    v_normalEC = czm_normal * normal;                         // normal in eye coordinates\n    v_st = st;\n\n    gl_Position = czm_modelViewProjectionRelativeToEye * p;\n}\n",fragmentShaderSource:"varying vec3 v_positionEC;\nvarying vec3 v_normalEC;\nvarying vec2 v_st;\n\nvoid main()\n{\n    vec3 positionToEyeEC = -v_positionEC;\n\n    vec3 normalEC = normalize(v_normalEC);\n#ifdef FACE_FORWARD\n    normalEC = faceforward(normalEC, vec3(0.0, 0.0, 1.0), -normalEC);\n#endif\n\n    czm_materialInput materialInput;\n    materialInput.normalEC = normalEC;\n    materialInput.positionToEyeEC = positionToEyeEC;\n    materialInput.st = v_st;\n    czm_material material = czm_getMaterial(materialInput);\n\n#ifdef FLAT\n    gl_FragColor = vec4(material.diffuse + material.emission, material.alpha);\n#else\n    gl_FragColor = czm_phong(normalize(positionToEyeEC), material, czm_lightDirectionEC);\n#endif\n}\n"}),ALL:Object(J.default)({vertexFormat:$.default.ALL,vertexShaderSource:"attribute vec3 position3DHigh;\nattribute vec3 position3DLow;\nattribute vec3 normal;\nattribute vec3 tangent;\nattribute vec3 bitangent;\nattribute vec2 st;\nattribute float batchId;\n\nvarying vec3 v_positionEC;\nvarying vec3 v_normalEC;\nvarying vec3 v_tangentEC;\nvarying vec3 v_bitangentEC;\nvarying vec2 v_st;\n\nvoid main()\n{\n    vec4 p = czm_computePosition();\n\n    v_positionEC = (czm_modelViewRelativeToEye * p).xyz;      // position in eye coordinates\n    v_normalEC = czm_normal * normal;                         // normal in eye coordinates\n    v_tangentEC = czm_normal * tangent;                       // tangent in eye coordinates\n    v_bitangentEC = czm_normal * bitangent;                   // bitangent in eye coordinates\n    v_st = st;\n\n    gl_Position = czm_modelViewProjectionRelativeToEye * p;\n}\n",fragmentShaderSource:"varying vec3 v_positionEC;\nvarying vec3 v_normalEC;\nvarying vec3 v_tangentEC;\nvarying vec3 v_bitangentEC;\nvarying vec2 v_st;\n\nvoid main()\n{\n    vec3 positionToEyeEC = -v_positionEC;\n    mat3 tangentToEyeMatrix = czm_tangentToEyeSpaceMatrix(v_normalEC, v_tangentEC, v_bitangentEC);\n\n    vec3 normalEC = normalize(v_normalEC);\n#ifdef FACE_FORWARD\n    normalEC = faceforward(normalEC, vec3(0.0, 0.0, 1.0), -normalEC);\n#endif\n\n    czm_materialInput materialInput;\n    materialInput.normalEC = normalEC;\n    materialInput.tangentToEyeMatrix = tangentToEyeMatrix;\n    materialInput.positionToEyeEC = positionToEyeEC;\n    materialInput.st = v_st;\n    czm_material material = czm_getMaterial(materialInput);\n\n#ifdef FLAT\n    gl_FragColor = vec4(material.diffuse + material.emission, material.alpha);\n#else\n    gl_FragColor = czm_phong(normalize(positionToEyeEC), material, czm_lightDirectionEC);\n#endif\n}\n"})};var ie=ae,re=a(75),ne=a(101),oe=a(363),se=a(334),le=a(70),ue=a(36);function de(e,t){e=Object(o.default)(e,0),t=Object(o.default)(t,Number.MAX_VALUE),this.value=new Float32Array([e,t])}Object(l.default)(de.prototype,{componentDatatype:{get:function(){return ue.a.FLOAT}},componentsPerAttribute:{get:function(){return 2}},normalize:{get:function(){return!1}}}),de.fromDistanceDisplayCondition=function(e){return new de(e.near,e.far)},de.toValue=function(e,t){return Object(s.default)(t)?(t[0]=e.near,t[1]=e.far,t):new Float32Array([e.near,e.far])};var fe=de,ce=a(65),he=a(87),me=a(83),pe=a(141),_e=a(94),ge=a(74),ve=a(116);function ye(){w.default.throwInstantiationError()}Object(l.default)(ye.prototype,{isConstant:{get:w.default.throwInstantiationError},definitionChanged:{get:w.default.throwInstantiationError}}),ye.prototype.getType=w.default.throwInstantiationError,ye.prototype.getValue=w.default.throwInstantiationError,ye.prototype.equals=w.default.throwInstantiationError,ye.getValue=function(e,t,a){var i;return Object(s.default)(t)&&(i=t.getType(e),Object(s.default)(i))?(Object(s.default)(a)&&a.type===i||(a=te.a.fromType(i)),t.getValue(e,a.uniforms),a):(Object(s.default)(a)&&a.type===te.a.ColorType||(a=te.a.fromType(te.a.ColorType)),b.default.clone(b.default.WHITE,a.uniforms.color),a)};var be=ye;function we(e,t,a){this._primitives=t,this._orderedGroundPrimitives=a,this._primitive=void 0,this._outlinePrimitive=void 0,this._geometryUpdater=e,this._options=e._options,this._entity=e._entity,this._material=void 0}we.prototype._isHidden=function(e,t,a){return!e.isShowing||!e.isAvailable(a)||!S.default.getValueOrDefault(t.show,a,!0)},we.prototype._setOptions=w.default.throwInstantiationError,we.prototype.update=function(e){var t=this._geometryUpdater,a=t._onTerrain,i=this._primitives,r=this._orderedGroundPrimitives;a?r.remove(this._primitive):(i.removeAndDestroy(this._primitive),i.removeAndDestroy(this._outlinePrimitive),this._outlinePrimitive=void 0),this._primitive=void 0;var n=this._entity,o=n[this._geometryUpdater._geometryPropertyName];if(this._setOptions(n,o,e),!this._isHidden(n,o,e)){var l=this._geometryUpdater.shadowsProperty.getValue(e),u=this._options;if(!Object(s.default)(o.fill)||o.fill.getValue(e)){var d,f=t.fillMaterialProperty,h=f instanceof ge.default,m=t._getIsClosed(u);if(h)d=new re.a({closed:m,flat:a&&!t._supportsMaterialsforEntitiesOnTerrain});else{var p=be.getValue(e,f,this._material);this._material=p,d=new ie({material:p,translucent:p.isTranslucent(),closed:m})}if(a)u.vertexFormat=re.a.VERTEX_FORMAT,this._primitive=r.add(new c.a({geometryInstances:this._geometryUpdater.createFillGeometryInstance(e),appearance:d,asynchronous:!1,shadows:l,classificationType:this._geometryUpdater.classificationTypeProperty.getValue(e)}),S.default.getValueOrUndefined(this._geometryUpdater.zIndex,e));else{u.vertexFormat=d.vertexFormat;var _=this._geometryUpdater.createFillGeometryInstance(e);h&&(d.translucent=255!==_.attributes.color.value[3]),this._primitive=i.add(new ve.a({geometryInstances:_,appearance:d,asynchronous:!1,shadows:l}))}}if(!a&&Object(s.default)(o.outline)&&o.outline.getValue(e)){var g=this._geometryUpdater.createOutlineGeometryInstance(e),v=S.default.getValueOrDefault(o.outlineWidth,e,1);this._outlinePrimitive=i.add(new ve.a({geometryInstances:g,appearance:new re.a({flat:!0,translucent:255!==g.attributes.color.value[3],renderState:{lineWidth:t._scene.clampLineWidth(v)}}),asynchronous:!1,shadows:l}))}}},we.prototype.getBoundingSphere=function(e){var t,a=this._entity,i=this._primitive,n=this._outlinePrimitive;return Object(s.default)(i)&&i.show&&i.ready&&(t=i.getGeometryInstanceAttributes(a),Object(s.default)(t)&&Object(s.default)(t.boundingSphere))?(r.default.clone(t.boundingSphere,e),A.default.DONE):Object(s.default)(n)&&n.show&&n.ready&&(t=n.getGeometryInstanceAttributes(a),Object(s.default)(t)&&Object(s.default)(t.boundingSphere))?(r.default.clone(t.boundingSphere,e),A.default.DONE):Object(s.default)(i)&&!i.ready||Object(s.default)(n)&&!n.ready?A.default.PENDING:A.default.FAILED},we.prototype.isDestroyed=function(){return!1},we.prototype.destroy=function(){var e=this._primitives,t=this._orderedGroundPrimitives;this._geometryUpdater._onTerrain?t.remove(this._primitive):e.removeAndDestroy(this._primitive),e.removeAndDestroy(this._outlinePrimitive),Object(u.default)(this)};var Oe=we,xe=a(185),Ce=a(179),Te=a(147),Ee=new ge.default(b.default.WHITE),Ae=new Ce.a(!0),Se=new Ce.a(!0),Pe=new Ce.a(!1),De=new Ce.a(b.default.BLACK),Ie=new Ce.a(ne.default.DISABLED),Me=new Ce.a(new O.a),Fe=new Ce.a(K.a.BOTH);function Re(e){var t=e.entity,a=e.geometryPropertyName;this._entity=t,this._scene=e.scene,this._fillEnabled=!1,this._isClosed=!1,this._onTerrain=!1,this._dynamic=!1,this._outlineEnabled=!1,this._geometryChanged=new Z.default,this._showProperty=void 0,this._materialProperty=void 0,this._showOutlineProperty=void 0,this._outlineColorProperty=void 0,this._outlineWidth=1,this._shadowsProperty=void 0,this._distanceDisplayConditionProperty=void 0,this._classificationTypeProperty=void 0,this._options=e.geometryOptions,this._geometryPropertyName=a,this._id=a+"-"+t.id,this._observedPropertyNames=e.observedPropertyNames,this._supportsMaterialsforEntitiesOnTerrain=Te.default.supportsMaterialsforEntitiesOnTerrain(e.scene)}Object(l.default)(Re.prototype,{id:{get:function(){return this._id}},entity:{get:function(){return this._entity}},fillEnabled:{get:function(){return this._fillEnabled}},hasConstantFill:{get:function(){return!this._fillEnabled||!Object(s.default)(this._entity.availability)&&S.default.isConstant(this._showProperty)&&S.default.isConstant(this._fillProperty)}},fillMaterialProperty:{get:function(){return this._materialProperty}},outlineEnabled:{get:function(){return this._outlineEnabled}},hasConstantOutline:{get:function(){return!this._outlineEnabled||!Object(s.default)(this._entity.availability)&&S.default.isConstant(this._showProperty)&&S.default.isConstant(this._showOutlineProperty)}},outlineColorProperty:{get:function(){return this._outlineColorProperty}},outlineWidth:{get:function(){return this._outlineWidth}},shadowsProperty:{get:function(){return this._shadowsProperty}},distanceDisplayConditionProperty:{get:function(){return this._distanceDisplayConditionProperty}},classificationTypeProperty:{get:function(){return this._classificationTypeProperty}},isDynamic:{get:function(){return this._dynamic}},isClosed:{get:function(){return this._isClosed}},onTerrain:{get:function(){return this._onTerrain}},geometryChanged:{get:function(){return this._geometryChanged}}}),Re.prototype.isOutlineVisible=function(e){var t=this._entity,a=this._outlineEnabled&&t.isAvailable(e)&&this._showProperty.getValue(e)&&this._showOutlineProperty.getValue(e);return Object(o.default)(a,!1)},Re.prototype.isFilled=function(e){var t=this._entity,a=this._fillEnabled&&t.isAvailable(e)&&this._showProperty.getValue(e)&&this._fillProperty.getValue(e);return Object(o.default)(a,!1)},Re.prototype.createFillGeometryInstance=w.default.throwInstantiationError,Re.prototype.createOutlineGeometryInstance=w.default.throwInstantiationError,Re.prototype.isDestroyed=function(){return!1},Re.prototype.destroy=function(){Object(u.default)(this)},Re.prototype._isHidden=function(e,t){var a=t.show;return Object(s.default)(a)&&a.isConstant&&!a.getValue(me.default.MINIMUM_VALUE)},Re.prototype._isOnTerrain=function(e,t){return!1},Re.prototype._getIsClosed=function(e){return!0},Re.prototype._isDynamic=w.default.throwInstantiationError,Re.prototype._setStaticOptions=w.default.throwInstantiationError,Re.prototype._onEntityPropertyChanged=function(e,t,a,i){if(-1!==this._observedPropertyNames.indexOf(t)){var r=this._entity[this._geometryPropertyName];if(Object(s.default)(r)){var n=r.fill,l=!Object(s.default)(n)||!n.isConstant||n.getValue(me.default.MINIMUM_VALUE),u=r.outline,d=Object(s.default)(u);if(d&&u.isConstant&&(d=u.getValue(me.default.MINIMUM_VALUE)),l||d){var f=r.show;if(this._isHidden(e,r))(this._fillEnabled||this._outlineEnabled)&&(this._fillEnabled=!1,this._outlineEnabled=!1,this._geometryChanged.raiseEvent(this));else{this._materialProperty=Object(o.default)(r.material,Ee),this._fillProperty=Object(o.default)(n,Se),this._showProperty=Object(o.default)(f,Ae),this._showOutlineProperty=Object(o.default)(r.outline,Pe),this._outlineColorProperty=d?Object(o.default)(r.outlineColor,De):void 0,this._shadowsProperty=Object(o.default)(r.shadows,Ie),this._distanceDisplayConditionProperty=Object(o.default)(r.distanceDisplayCondition,Me),this._classificationTypeProperty=Object(o.default)(r.classificationType,Fe),this._fillEnabled=l;var c=this._isOnTerrain(e,r)&&(this._supportsMaterialsforEntitiesOnTerrain||this._materialProperty instanceof ge.default);if(d&&c&&(Object(xe.a)(xe.a.geometryOutlines),d=!1),this._onTerrain=c,this._outlineEnabled=d,this._isDynamic(e,r))this._dynamic||(this._dynamic=!0,this._geometryChanged.raiseEvent(this));else{this._setStaticOptions(e,r),this._isClosed=this._getIsClosed(this._options);var h=r.outlineWidth;this._outlineWidth=Object(s.default)(h)?h.getValue(me.default.MINIMUM_VALUE):1,this._dynamic=!1,this._geometryChanged.raiseEvent(this)}}}else(this._fillEnabled||this._outlineEnabled)&&(this._fillEnabled=!1,this._outlineEnabled=!1,this._geometryChanged.raiseEvent(this))}else(this._fillEnabled||this._outlineEnabled)&&(this._fillEnabled=!1,this._outlineEnabled=!1,this._geometryChanged.raiseEvent(this))}},Re.prototype.createDynamicUpdater=function(e,t){return new this.constructor.DynamicGeometryUpdater(this,e,t)};var Ne=Re,Le=a(176),je=a(32),Ve=a(15),Ue=a(46),ze=new y.default,Be=new je.default;function He(e,t,a,i){this._scene=e,this._heightReference=a,this._extrudedHeightReference=i,this._positionProperty=t,this._position=new y.default,this._cartographicPosition=new je.default,this._normal=new y.default,this._definitionChanged=new Z.default,this._terrainHeight=0,this._removeCallbackFunc=void 0,this._removeEventListener=void 0,this._removeModeListener=void 0;var r=this;if(Object(s.default)(e.globe)&&(this._removeEventListener=e.terrainProviderChanged.addEventListener((function(){r._updateClamping()})),this._removeModeListener=e.morphComplete.addEventListener((function(){r._updateClamping()}))),t.isConstant){var n=t.getValue(me.default.MINIMUM_VALUE,ze);if(!Object(s.default)(n)||y.default.equals(n,y.default.ZERO)||!Object(s.default)(e.globe))return;this._position=y.default.clone(n,this._position),this._updateClamping(),this._normal=e.globe.ellipsoid.geodeticSurfaceNormal(n,this._normal)}}Object(l.default)(He.prototype,{isConstant:{get:function(){return!1}},definitionChanged:{get:function(){return this._definitionChanged}}}),He.prototype._updateClamping=function(){Object(s.default)(this._removeCallbackFunc)&&this._removeCallbackFunc();var e=this._scene,t=e.globe,a=this._position;if(Object(s.default)(t)&&!y.default.equals(a,y.default.ZERO)){var i=t.ellipsoid,r=t._surface,n=this,o=i.cartesianToCartographic(a,this._cartographicPosition),l=t.getHeight(o);Object(s.default)(l)?this._terrainHeight=l:this._terrainHeight=0,this._removeCallbackFunc=r.updateHeight(o,(function(t){if(e.mode===Ue.a.SCENE3D){var a=i.cartesianToCartographic(t,Be);n._terrainHeight=a.height}else n._terrainHeight=t.x;n.definitionChanged.raiseEvent()}))}else this._terrainHeight=0},He.prototype.getValue=function(e,t){var a=S.default.getValueOrDefault(this._heightReference,e,C.default.NONE),i=S.default.getValueOrDefault(this._extrudedHeightReference,e,C.default.NONE);if(a===C.default.NONE&&i!==C.default.RELATIVE_TO_GROUND)return this._position=y.default.clone(y.default.ZERO,this._position),y.default.clone(y.default.ZERO,t);if(this._positionProperty.isConstant)return y.default.multiplyByScalar(this._normal,this._terrainHeight,t);var r=this._scene,n=this._positionProperty.getValue(e,ze);if(!Object(s.default)(n)||y.default.equals(n,y.default.ZERO)||!Object(s.default)(r.globe))return y.default.clone(y.default.ZERO,t);if(y.default.equalsEpsilon(this._position,n,Ve.default.EPSILON10))return y.default.multiplyByScalar(this._normal,this._terrainHeight,t);this._position=y.default.clone(n,this._position),this._updateClamping();var o=r.globe.ellipsoid.geodeticSurfaceNormal(n,this._normal);return y.default.multiplyByScalar(o,this._terrainHeight,t)},He.prototype.isDestroyed=function(){return!1},He.prototype.destroy=function(){return Object(s.default)(this._removeEventListener)&&this._removeEventListener(),Object(s.default)(this._removeModeListener)&&this._removeModeListener(),Object(s.default)(this._removeCallbackFunc)&&this._removeCallbackFunc(),Object(u.default)(this)};var ke=He;var Ge=function(e,t,a,i){if(Ne.prototype._onEntityPropertyChanged.call(this,e,t,a,i),-1!==this._observedPropertyNames.indexOf(t)){var r=this._entity[this._geometryPropertyName];if(Object(s.default)(r)){Object(s.default)(this._terrainOffsetProperty)&&(this._terrainOffsetProperty.destroy(),this._terrainOffsetProperty=void 0);var n=r.heightReference;if(Object(s.default)(n)){var o=new Le.default(this._computeCenter.bind(this),!this._dynamic);this._terrainOffsetProperty=new ke(this._scene,o,n)}}}},We=y.default.ZERO,Ye=new y.default,Xe=new y.default,Qe=new b.default;function qe(e){this.id=e,this.vertexFormat=void 0,this.dimensions=void 0,this.offsetAttribute=void 0}function Ze(e,t){Ne.call(this,{entity:e,scene:t,geometryOptions:new qe(e),geometryPropertyName:"box",observedPropertyNames:["availability","position","orientation","box"]}),this._onEntityPropertyChanged(e,"box",e.box,void 0)}function Ke(e,t,a){Oe.call(this,e,t,a)}Object(s.default)(Object.create)&&(Ze.prototype=Object.create(Ne.prototype),Ze.prototype.constructor=Ze),Object(l.default)(Ze.prototype,{terrainOffsetProperty:{get:function(){return this._terrainOffsetProperty}}}),Ze.prototype.createFillGeometryInstance=function(e){var t,a=this._entity,i=a.isAvailable(e),r=new _e.a(i&&a.isShowing&&this._showProperty.getValue(e)&&this._fillProperty.getValue(e)),n=this._distanceDisplayConditionProperty.getValue(e),o={show:r,distanceDisplayCondition:fe.fromDistanceDisplayCondition(n),color:void 0,offset:void 0};this._materialProperty instanceof ge.default&&(Object(s.default)(this._materialProperty.color)&&(this._materialProperty.color.isConstant||i)&&(t=this._materialProperty.color.getValue(e,Qe)),Object(s.default)(t)||(t=b.default.WHITE),o.color=le.a.fromColor(t));return Object(s.default)(this._options.offsetAttribute)&&(o.offset=pe.a.fromCartesian3(S.default.getValueOrDefault(this._terrainOffsetProperty,e,We,Ye))),new ce.a({id:a,geometry:oe.a.fromDimensions(this._options),modelMatrix:a.computeModelMatrixForHeightReference(e,a.box.heightReference,.5*this._options.dimensions.z,this._scene.mapProjection.ellipsoid),attributes:o})},Ze.prototype.createOutlineGeometryInstance=function(e){var t=this._entity,a=t.isAvailable(e),i=S.default.getValueOrDefault(this._outlineColorProperty,e,b.default.BLACK,Qe),r=this._distanceDisplayConditionProperty.getValue(e),n={show:new _e.a(a&&t.isShowing&&this._showProperty.getValue(e)&&this._showOutlineProperty.getValue(e)),color:le.a.fromColor(i),distanceDisplayCondition:fe.fromDistanceDisplayCondition(r),offset:void 0};return Object(s.default)(this._options.offsetAttribute)&&(n.offset=pe.a.fromCartesian3(S.default.getValueOrDefault(this._terrainOffsetProperty,e,We,Ye))),new ce.a({id:t,geometry:se.a.fromDimensions(this._options),modelMatrix:t.computeModelMatrixForHeightReference(e,t.box.heightReference,.5*this._options.dimensions.z,this._scene.mapProjection.ellipsoid),attributes:n})},Ze.prototype._computeCenter=function(e,t){return S.default.getValueOrUndefined(this._entity.position,e,t)},Ze.prototype._isHidden=function(e,t){return!Object(s.default)(t.dimensions)||!Object(s.default)(e.position)||Ne.prototype._isHidden.call(this,e,t)},Ze.prototype._isDynamic=function(e,t){return!(e.position.isConstant&&S.default.isConstant(e.orientation)&&t.dimensions.isConstant&&S.default.isConstant(t.outlineWidth))},Ze.prototype._setStaticOptions=function(e,t){var a=S.default.getValueOrDefault(t.heightReference,me.default.MINIMUM_VALUE,C.default.NONE),i=this._options;i.vertexFormat=this._materialProperty instanceof ge.default?re.a.VERTEX_FORMAT:ie.MaterialSupport.TEXTURED.vertexFormat,i.dimensions=t.dimensions.getValue(me.default.MINIMUM_VALUE,i.dimensions),i.offsetAttribute=a!==C.default.NONE?he.a.ALL:void 0},Ze.prototype._onEntityPropertyChanged=Ge,Ze.DynamicGeometryUpdater=Ke,Object(s.default)(Object.create)&&(Ke.prototype=Object.create(Oe.prototype),Ke.prototype.constructor=Ke),Ke.prototype._isHidden=function(e,t,a){var i=S.default.getValueOrUndefined(e.position,a,Xe),r=this._options.dimensions;return!Object(s.default)(i)||!Object(s.default)(r)||Oe.prototype._isHidden.call(this,e,t,a)},Ke.prototype._setOptions=function(e,t,a){var i=S.default.getValueOrDefault(t.heightReference,a,C.default.NONE),r=this._options;r.dimensions=S.default.getValueOrUndefined(t.dimensions,a,r.dimensions),r.offsetAttribute=i!==C.default.NONE?he.a.ALL:void 0};var Je=Ze,$e=a(97),et=a(154),tt=a(196),at=a(45),it=a(238),rt=a(50),nt=a(206),ot=a(30),st=a(55),lt=a(64),ut=[new y.default,new y.default],dt=new y.default,ft=new y.default,ct=new y.default,ht=new y.default,mt=new y.default,pt=new y.default,_t=new y.default,gt=new y.default,vt=new y.default,yt=new y.default,bt=new y.default,wt={},Ot=new je.default;function xt(e,t,a,i){var r,n=e[0],o=e[1],s=y.default.angleBetween(n,o),l=Math.ceil(s/i),u=new Array(l);if(t===a){for(r=0;r<l;r++)u[r]=t;return u.push(a),u}var d=(a-t)/l;for(r=1;r<l;r++){var f=t+r*d;u[r]=f}return u[0]=t,u.push(a),u}var Ct=new y.default,Tt=new y.default;var Et=new y.default(-1,0,0),At=new ot.default,St=new ot.default,Pt=new at.default,Dt=at.default.IDENTITY.clone(),It=new y.default,Mt=new rt.a,Ft=new y.default;function Rt(e,t,a,i,r,n,o,s){var l=It,u=Mt;At=lt.default.eastNorthUpToFixedFrame(e,r,At),l=ot.default.multiplyByPointAsVector(At,Et,l);var d=function(e,t,a,i){var r=new nt.default(a,i),n=r.projectPointOntoPlane(y.default.add(a,e,Ct),Ct),o=r.projectPointOntoPlane(y.default.add(a,t,Tt),Tt),s=v.default.angleBetween(n,o);return o.x*n.y-o.y*n.x>=0?-s:s}(l=y.default.normalize(l,l),t,e,r);Pt=at.default.fromRotationZ(d,Pt),Ft.z=n,At=ot.default.multiplyTransformation(At,ot.default.fromRotationTranslation(Pt,Ft,St),At);var f=Dt;f[0]=o;for(var c=0;c<s;c++)for(var h=0;h<a.length;h+=3)u=y.default.fromArray(a,h,u),u=at.default.multiplyByVector(f,u,u),u=ot.default.multiplyByPoint(At,u,u),i.push(u.x,u.y,u.z);return i}var Nt=new y.default;function Lt(e,t,a,i,r,n,o){for(var s=0;s<e.length;s+=3){i=Rt(y.default.fromArray(e,s,Nt),t,a,i,r,n[s/3],o,1)}return i}function jt(e,t){for(var a=e.length,i=new Array(3*a),r=0,n=t.x+t.width/2,o=t.y+t.height/2,s=0;s<a;s++)i[r++]=e[s].x-n,i[r++]=0,i[r++]=e[s].y-o;return i}var Vt=new st.default,Ut=new y.default,zt=new at.default;function Bt(e,t,a,i,r,n,o,s,l,u){var d,f,c=y.default.angleBetween(y.default.subtract(t,e,yt),y.default.subtract(a,e,bt)),h=i===tt.a.BEVELED?0:Math.ceil(c/Ve.default.toRadians(5));if(d=r?at.default.fromQuaternion(st.default.fromAxisAngle(y.default.negate(e,yt),c/(h+1),Vt),zt):at.default.fromQuaternion(st.default.fromAxisAngle(e,c/(h+1),Vt),zt),t=y.default.clone(t,Ut),h>0)for(var m=u?2:1,p=0;p<h;p++)t=at.default.multiplyByVector(d,t,t),f=y.default.subtract(t,e,yt),f=y.default.normalize(f,f),r||(f=y.default.negate(f,f)),o=Rt(n.scaleToGeodeticSurface(t,bt),f,s,o,n,l,1,m);else f=y.default.subtract(t,e,yt),f=y.default.normalize(f,f),r||(f=y.default.negate(f,f)),o=Rt(n.scaleToGeodeticSurface(t,bt),f,s,o,n,l,1,1),a=y.default.clone(a,Ut),f=y.default.subtract(a,e,yt),f=y.default.normalize(f,f),r||(f=y.default.negate(f,f)),o=Rt(n.scaleToGeodeticSurface(a,bt),f,s,o,n,l,1,1);return o}wt.removeDuplicatesFromShape=function(e){for(var t=e.length,a=[],i=t-1,r=0;r<t;i=r++){var n=e[i],o=e[r];v.default.equals(n,o)||a.push(o)}return a},wt.angleIsGreaterThanPi=function(e,t,a,i){var r=new nt.default(a,i),n=r.projectPointOntoPlane(y.default.add(a,e,Ct),Ct),o=r.projectPointOntoPlane(y.default.add(a,t,Tt),Tt);return o.x*n.y-o.y*n.x>=0};var Ht=new y.default,kt=new y.default;wt.computePositions=function(e,t,a,i,r){var n=i._ellipsoid,o=function(e,t){for(var a=new Array(e.length),i=0;i<e.length;i++){var r=e[i];Ot=t.cartesianToCartographic(r,Ot),a[i]=Ot.height,e[i]=t.scaleToGeodeticSurface(r,r)}return a}(e,n),s=i._granularity,l=i._cornerType,u=r?function(e,t){var a=e.length,i=new Array(6*a),r=0,n=t.x+t.width/2,o=t.y+t.height/2,s=e[0];i[r++]=s.x-n,i[r++]=0,i[r++]=s.y-o;for(var l=1;l<a;l++){var u=(s=e[l]).x-n,d=s.y-o;i[r++]=u,i[r++]=0,i[r++]=d,i[r++]=u,i[r++]=0,i[r++]=d}return s=e[0],i[r++]=s.x-n,i[r++]=0,i[r++]=s.y-o,i}(t,a):jt(t,a),d=r?jt(t,a):void 0,f=a.height/2,c=a.width/2,h=e.length,m=[],p=r?[]:void 0,_=dt,g=ft,v=ct,b=ht,w=mt,O=pt,x=_t,C=gt,T=vt,E=e[0],A=e[1];b=n.geodeticSurfaceNormal(E,b),_=y.default.subtract(A,E,_),_=y.default.normalize(_,_),C=y.default.cross(b,_,C),C=y.default.normalize(C,C);var S,P=o[0],D=o[1];r&&(p=Rt(E,C,d,p,n,P+f,1,1)),T=y.default.clone(E,T),E=A,g=y.default.negate(_,g);for(var I=1;I<h-1;I++){var M=r?2:1;A=e[I+1],_=y.default.subtract(A,E,_),_=y.default.normalize(_,_),v=y.default.add(_,g,v),v=y.default.normalize(v,v),b=n.geodeticSurfaceNormal(E,b);var F=y.default.multiplyByScalar(b,y.default.dot(_,b),Ht);y.default.subtract(_,F,F),y.default.normalize(F,F);var R=y.default.multiplyByScalar(b,y.default.dot(g,b),kt);if(y.default.subtract(g,R,R),y.default.normalize(R,R),!Ve.default.equalsEpsilon(Math.abs(y.default.dot(F,R)),1,Ve.default.EPSILON7)){v=y.default.cross(v,b,v),v=y.default.cross(b,v,v),v=y.default.normalize(v,v);var N=1/Math.max(.25,y.default.magnitude(y.default.cross(v,g,yt))),L=wt.angleIsGreaterThanPi(_,g,E,n);L?(w=y.default.add(E,y.default.multiplyByScalar(v,N*c,v),w),O=y.default.add(w,y.default.multiplyByScalar(C,c,O),O),ut[0]=y.default.clone(T,ut[0]),ut[1]=y.default.clone(O,ut[1]),S=xt(ut,P+f,D+f,s),m=Lt(it.a.generateArc({positions:ut,granularity:s,ellipsoid:n}),C,u,m,n,S,1),C=y.default.cross(b,_,C),C=y.default.normalize(C,C),x=y.default.add(w,y.default.multiplyByScalar(C,c,x),x),l===tt.a.ROUNDED||l===tt.a.BEVELED?Bt(w,O,x,l,L,n,m,u,D+f,r):m=Rt(E,v=y.default.negate(v,v),u,m,n,D+f,N,M),T=y.default.clone(x,T)):(w=y.default.add(E,y.default.multiplyByScalar(v,N*c,v),w),O=y.default.add(w,y.default.multiplyByScalar(C,-c,O),O),ut[0]=y.default.clone(T,ut[0]),ut[1]=y.default.clone(O,ut[1]),S=xt(ut,P+f,D+f,s),m=Lt(it.a.generateArc({positions:ut,granularity:s,ellipsoid:n}),C,u,m,n,S,1),C=y.default.cross(b,_,C),C=y.default.normalize(C,C),x=y.default.add(w,y.default.multiplyByScalar(C,-c,x),x),l===tt.a.ROUNDED||l===tt.a.BEVELED?Bt(w,O,x,l,L,n,m,u,D+f,r):m=Rt(E,v,u,m,n,D+f,N,M),T=y.default.clone(x,T)),g=y.default.negate(_,g)}else m=Rt(T,C,u,m,n,P+f,1,1),T=E;P=D,D=o[I+1],E=A}ut[0]=y.default.clone(T,ut[0]),ut[1]=y.default.clone(E,ut[1]),S=xt(ut,P+f,D+f,s),m=Lt(it.a.generateArc({positions:ut,granularity:s,ellipsoid:n}),C,u,m,n,S,1),r&&(p=Rt(E,C,d,p,n,D+f,1,1)),h=m.length;var j=r?h+p.length:h,V=new Float64Array(j);return V.set(m),r&&V.set(p,h),V};var Gt=wt,Wt={},Yt=new y.default,Xt=new y.default,Qt=new y.default,qt=new y.default,Zt=[new y.default,new y.default],Kt=new y.default,Jt=new y.default,$t=new y.default,ea=new y.default,ta=new y.default,aa=new y.default,ia=new y.default,ra=new y.default,na=new y.default,oa=new y.default,sa=new st.default,la=new at.default;function ua(e,t,a,i,r){var n,o=y.default.angleBetween(y.default.subtract(t,e,Yt),y.default.subtract(a,e,Xt)),s=i===tt.a.BEVELED?1:Math.ceil(o/Ve.default.toRadians(5))+1,l=3*s,u=new Array(l);u[l-3]=a.x,u[l-2]=a.y,u[l-1]=a.z,n=r?at.default.fromQuaternion(st.default.fromAxisAngle(y.default.negate(e,Yt),o/s,sa),la):at.default.fromQuaternion(st.default.fromAxisAngle(e,o/s,sa),la);var d=0;t=y.default.clone(t,Yt);for(var f=0;f<s;f++)t=at.default.multiplyByVector(n,t,t),u[d++]=t.x,u[d++]=t.y,u[d++]=t.z;return u}function da(e,t,a,i){var r=Yt;return i?r=y.default.add(e,t,r):(t=y.default.negate(t,t),r=y.default.add(e,t,r)),[r.x,r.y,r.z,a.x,a.y,a.z]}function fa(e,t,a,i){for(var r=new Array(e.length),n=new Array(e.length),o=y.default.multiplyByScalar(t,a,Yt),s=y.default.negate(o,Xt),l=0,u=e.length-1,d=0;d<e.length;d+=3){var f=y.default.fromArray(e,d,Qt),c=y.default.add(f,s,qt);r[l++]=c.x,r[l++]=c.y,r[l++]=c.z;var h=y.default.add(f,o,qt);n[u--]=h.z,n[u--]=h.y,n[u--]=h.x}return i.push(r,n),i}Wt.addAttribute=function(e,t,a,i){var r=t.x,n=t.y,o=t.z;Object(s.default)(a)&&(e[a]=r,e[a+1]=n,e[a+2]=o),Object(s.default)(i)&&(e[i]=o,e[i-1]=n,e[i-2]=r)};var ca=new y.default,ha=new y.default;Wt.computePositions=function(e){var t=e.granularity,a=e.positions,i=e.ellipsoid,r=e.width/2,n=e.cornerType,o=e.saveAttributes,s=Kt,l=Jt,u=$t,d=ea,f=ta,c=aa,h=ia,m=ra,p=na,_=oa,g=[],v=o?[]:void 0,b=o?[]:void 0,w=a[0],O=a[1];l=y.default.normalize(y.default.subtract(O,w,l),l),s=i.geodeticSurfaceNormal(w,s),d=y.default.normalize(y.default.cross(s,l,d),d),o&&(v.push(d.x,d.y,d.z),b.push(s.x,s.y,s.z)),h=y.default.clone(w,h),w=O,u=y.default.negate(l,u);var x,C,T=[],E=a.length;for(x=1;x<E-1;x++){s=i.geodeticSurfaceNormal(w,s),O=a[x+1],l=y.default.normalize(y.default.subtract(O,w,l),l),f=y.default.normalize(y.default.add(l,u,f),f);var A=y.default.multiplyByScalar(s,y.default.dot(l,s),ca);y.default.subtract(l,A,A),y.default.normalize(A,A);var S=y.default.multiplyByScalar(s,y.default.dot(u,s),ha);if(y.default.subtract(u,S,S),y.default.normalize(S,S),!Ve.default.equalsEpsilon(Math.abs(y.default.dot(A,S)),1,Ve.default.EPSILON7)){f=y.default.cross(f,s,f),f=y.default.cross(s,f,f),f=y.default.normalize(f,f);var P=r/Math.max(.25,y.default.magnitude(y.default.cross(f,u,Yt))),D=Gt.angleIsGreaterThanPi(l,u,w,i);f=y.default.multiplyByScalar(f,P,f),D?(m=y.default.add(w,f,m),_=y.default.add(m,y.default.multiplyByScalar(d,r,_),_),p=y.default.add(m,y.default.multiplyByScalar(d,2*r,p),p),Zt[0]=y.default.clone(h,Zt[0]),Zt[1]=y.default.clone(_,Zt[1]),g=fa(it.a.generateArc({positions:Zt,granularity:t,ellipsoid:i}),d,r,g),o&&(v.push(d.x,d.y,d.z),b.push(s.x,s.y,s.z)),c=y.default.clone(p,c),d=y.default.normalize(y.default.cross(s,l,d),d),p=y.default.add(m,y.default.multiplyByScalar(d,2*r,p),p),h=y.default.add(m,y.default.multiplyByScalar(d,r,h),h),n===tt.a.ROUNDED||n===tt.a.BEVELED?T.push({leftPositions:ua(m,c,p,n,D)}):T.push({leftPositions:da(w,y.default.negate(f,f),p,D)})):(p=y.default.add(w,f,p),_=y.default.add(p,y.default.negate(y.default.multiplyByScalar(d,r,_),_),_),m=y.default.add(p,y.default.negate(y.default.multiplyByScalar(d,2*r,m),m),m),Zt[0]=y.default.clone(h,Zt[0]),Zt[1]=y.default.clone(_,Zt[1]),g=fa(it.a.generateArc({positions:Zt,granularity:t,ellipsoid:i}),d,r,g),o&&(v.push(d.x,d.y,d.z),b.push(s.x,s.y,s.z)),c=y.default.clone(m,c),d=y.default.normalize(y.default.cross(s,l,d),d),m=y.default.add(p,y.default.negate(y.default.multiplyByScalar(d,2*r,m),m),m),h=y.default.add(p,y.default.negate(y.default.multiplyByScalar(d,r,h),h),h),n===tt.a.ROUNDED||n===tt.a.BEVELED?T.push({rightPositions:ua(p,c,m,n,D)}):T.push({rightPositions:da(w,f,m,D)})),u=y.default.negate(l,u)}w=O}return s=i.geodeticSurfaceNormal(w,s),Zt[0]=y.default.clone(h,Zt[0]),Zt[1]=y.default.clone(w,Zt[1]),g=fa(it.a.generateArc({positions:Zt,granularity:t,ellipsoid:i}),d,r,g),o&&(v.push(d.x,d.y,d.z),b.push(s.x,s.y,s.z)),n===tt.a.ROUNDED&&(C=function(e){var t=Kt,a=Jt,i=$t,r=e[1];a=y.default.fromArray(e[1],r.length-3,a),i=y.default.fromArray(e[0],0,i);var n=ua(t=y.default.midpoint(a,i,t),a,i,tt.a.ROUNDED,!1),o=e.length-1,s=e[o-1];return r=e[o],a=y.default.fromArray(s,s.length-3,a),i=y.default.fromArray(r,0,i),[n,ua(t=y.default.midpoint(a,i,t),a,i,tt.a.ROUNDED,!1)]}(g)),{positions:g,corners:T,lefts:v,normals:b,endPositions:C}};var ma=Wt,pa=a(29),_a=a(53),ga=a(54),va=a(66),ya=a(51),ba=a(148),wa=a(47),Oa=a(31),xa=new y.default,Ca=new y.default,Ta=new y.default,Ea=new y.default,Aa=new y.default,Sa=new y.default,Pa=new y.default,Da=new y.default;function Ia(e,t){for(var a=0;a<e.length;a++)e[a]=t.scaleToGeodeticSurface(e[a],e[a]);return e}function Ma(e,t,a,i,r,n){var o=e.normals,s=e.tangents,l=e.bitangents,u=y.default.normalize(y.default.cross(a,t,Pa),Pa);n.normal&&ma.addAttribute(o,t,i,r),n.tangent&&ma.addAttribute(s,u,i,r),n.bitangent&&ma.addAttribute(l,a,i,r)}function Fa(e,t,a){var i,r,n,o=e.positions,l=e.corners,u=e.endPositions,d=e.lefts,f=e.normals,c=new va.a,h=0,m=0,p=0;for(r=0;r<o.length;r+=2)h+=n=o[r].length-3,p+=2*n,m+=o[r+1].length-3;for(h+=3,m+=3,r=0;r<l.length;r++){i=l[r];var _=l[r].leftPositions;Object(s.default)(_)?(h+=n=_.length,p+=n):(m+=n=l[r].rightPositions.length,p+=n)}var g,v=Object(s.default)(u);v&&(h+=g=u[0].length-3,m+=g,p+=6*(g/=3));var b,w,O,x,C,T,E=h+m,A=new Float64Array(E),S={normals:t.normal?new Float32Array(E):void 0,tangents:t.tangent?new Float32Array(E):void 0,bitangents:t.bitangent?new Float32Array(E):void 0},P=0,D=E-1,I=xa,M=Ca,F=g/2,R=ya.a.createTypedArray(E/3,p),N=0;if(v){T=Ta,C=Ea;var L=u[0];for(I=y.default.fromArray(f,0,I),M=y.default.fromArray(d,0,M),r=0;r<F;r++)T=y.default.fromArray(L,3*(F-1-r),T),C=y.default.fromArray(L,3*(F+r),C),ma.addAttribute(A,C,P),ma.addAttribute(A,T,void 0,D),Ma(S,I,M,P,D,t),x=(w=P/3)+1,O=(b=(D-2)/3)-1,R[N++]=b,R[N++]=w,R[N++]=O,R[N++]=O,R[N++]=w,R[N++]=x,P+=3,D-=3}var j,V,U=0,z=0,B=o[U++],H=o[U++];for(A.set(B,P),A.set(H,D-H.length+1),M=y.default.fromArray(d,z,M),n=H.length-3,r=0;r<n;r+=3)j=a.geodeticSurfaceNormal(y.default.fromArray(B,r,Pa),Pa),V=a.geodeticSurfaceNormal(y.default.fromArray(H,n-r,Da),Da),Ma(S,I=y.default.normalize(y.default.add(j,V,I),I),M,P,D,t),x=(w=P/3)+1,O=(b=(D-2)/3)-1,R[N++]=b,R[N++]=w,R[N++]=O,R[N++]=O,R[N++]=w,R[N++]=x,P+=3,D-=3;for(j=a.geodeticSurfaceNormal(y.default.fromArray(B,n,Pa),Pa),V=a.geodeticSurfaceNormal(y.default.fromArray(H,n,Da),Da),I=y.default.normalize(y.default.add(j,V,I),I),z+=3,r=0;r<l.length;r++){var k,G,W,Y=(i=l[r]).leftPositions,X=i.rightPositions,Q=Sa,q=Ta,Z=Ea;if(I=y.default.fromArray(f,z,I),Object(s.default)(Y)){for(Ma(S,I,M,void 0,D,t),D-=3,G=x,W=O,k=0;k<Y.length/3;k++)Q=y.default.fromArray(Y,3*k,Q),R[N++]=G,R[N++]=W-k-1,R[N++]=W-k,ma.addAttribute(A,Q,void 0,D),q=y.default.fromArray(A,3*(W-k-1),q),Z=y.default.fromArray(A,3*G,Z),Ma(S,I,M=y.default.normalize(y.default.subtract(q,Z,M),M),void 0,D,t),D-=3;Q=y.default.fromArray(A,3*G,Q),q=y.default.subtract(y.default.fromArray(A,3*W,q),Q,q),Z=y.default.subtract(y.default.fromArray(A,3*(W-k),Z),Q,Z),Ma(S,I,M=y.default.normalize(y.default.add(q,Z,M),M),P,void 0,t),P+=3}else{for(Ma(S,I,M,P,void 0,t),P+=3,G=O,W=x,k=0;k<X.length/3;k++)Q=y.default.fromArray(X,3*k,Q),R[N++]=G,R[N++]=W+k,R[N++]=W+k+1,ma.addAttribute(A,Q,P),q=y.default.fromArray(A,3*G,q),Z=y.default.fromArray(A,3*(W+k),Z),Ma(S,I,M=y.default.normalize(y.default.subtract(q,Z,M),M),P,void 0,t),P+=3;Q=y.default.fromArray(A,3*G,Q),q=y.default.subtract(y.default.fromArray(A,3*(W+k),q),Q,q),Z=y.default.subtract(y.default.fromArray(A,3*W,Z),Q,Z),Ma(S,I,M=y.default.normalize(y.default.negate(y.default.add(Z,q,M),M),M),void 0,D,t),D-=3}for(B=o[U++],H=o[U++],B.splice(0,3),H.splice(H.length-3,3),A.set(B,P),A.set(H,D-H.length+1),n=H.length-3,z+=3,M=y.default.fromArray(d,z,M),k=0;k<H.length;k+=3)j=a.geodeticSurfaceNormal(y.default.fromArray(B,k,Pa),Pa),V=a.geodeticSurfaceNormal(y.default.fromArray(H,n-k,Da),Da),Ma(S,I=y.default.normalize(y.default.add(j,V,I),I),M,P,D,t),w=(x=P/3)-1,b=(O=(D-2)/3)+1,R[N++]=b,R[N++]=w,R[N++]=O,R[N++]=O,R[N++]=w,R[N++]=x,P+=3,D-=3;P-=3,D+=3}if(Ma(S,I=y.default.fromArray(f,f.length-3,I),M,P,D,t),v){P+=3,D-=3,T=Ta,C=Ea;var K=u[1];for(r=0;r<F;r++)T=y.default.fromArray(K,3*(g-r-1),T),C=y.default.fromArray(K,3*r,C),ma.addAttribute(A,T,void 0,D),ma.addAttribute(A,C,P),Ma(S,I,M,P,D,t),w=(x=P/3)-1,b=(O=(D-2)/3)+1,R[N++]=b,R[N++]=w,R[N++]=O,R[N++]=O,R[N++]=w,R[N++]=x,P+=3,D-=3}if(c.position=new ga.a({componentDatatype:ue.a.DOUBLE,componentsPerAttribute:3,values:A}),t.st){var J,$,ee=new Float32Array(E/3*2),te=0;if(v){h/=3,m/=3;var ae,ie=Math.PI/(g+1);$=1/(h-g+1),J=1/(m-g+1);var re=g/2;for(r=re+1;r<g+1;r++)ae=Ve.default.PI_OVER_TWO+ie*r,ee[te++]=J*(1+Math.cos(ae)),ee[te++]=.5*(1+Math.sin(ae));for(r=1;r<m-g+1;r++)ee[te++]=r*J,ee[te++]=0;for(r=g;r>re;r--)ae=Ve.default.PI_OVER_TWO-r*ie,ee[te++]=1-J*(1+Math.cos(ae)),ee[te++]=.5*(1+Math.sin(ae));for(r=re;r>0;r--)ae=Ve.default.PI_OVER_TWO-ie*r,ee[te++]=1-$*(1+Math.cos(ae)),ee[te++]=.5*(1+Math.sin(ae));for(r=h-g;r>0;r--)ee[te++]=r*$,ee[te++]=1;for(r=1;r<re+1;r++)ae=Ve.default.PI_OVER_TWO+ie*r,ee[te++]=$*(1+Math.cos(ae)),ee[te++]=.5*(1+Math.sin(ae))}else{for($=1/((h/=3)-1),J=1/((m/=3)-1),r=0;r<m;r++)ee[te++]=r*J,ee[te++]=0;for(r=h;r>0;r--)ee[te++]=(r-1)*$,ee[te++]=1}c.st=new ga.a({componentDatatype:ue.a.FLOAT,componentsPerAttribute:2,values:ee})}return t.normal&&(c.normal=new ga.a({componentDatatype:ue.a.FLOAT,componentsPerAttribute:3,values:S.normals})),t.tangent&&(c.tangent=new ga.a({componentDatatype:ue.a.FLOAT,componentsPerAttribute:3,values:S.tangents})),t.bitangent&&(c.bitangent=new ga.a({componentDatatype:ue.a.FLOAT,componentsPerAttribute:3,values:S.bitangents})),{attributes:c,indices:R}}function Ra(e,t,a){a[t++]=e[0],a[t++]=e[1],a[t++]=e[2];for(var i=3;i<e.length;i+=3){var r=e[i],n=e[i+1],o=e[i+2];a[t++]=r,a[t++]=n,a[t++]=o,a[t++]=r,a[t++]=n,a[t++]=o}return a[t++]=e[0],a[t++]=e[1],a[t++]=e[2],a}function Na(e,t){var a=new $.default({position:t.position,normal:t.normal||t.bitangent||e.shadowVolume,tangent:t.tangent,bitangent:t.normal||t.bitangent,st:t.st}),i=e.ellipsoid,r=Fa(ma.computePositions(e),a,i),n=e.height,o=e.extrudedHeight,l=r.attributes,u=r.indices,d=l.position.values,f=d.length,c=new Float64Array(6*f),h=new Float64Array(f);h.set(d);var m,p=new Float64Array(4*f);p=Ra(d=ba.a.scaleToGeodeticHeight(d,n,i),0,p),p=Ra(h=ba.a.scaleToGeodeticHeight(h,o,i),2*f,p),c.set(d),c.set(h,f),c.set(p,2*f),l.position.values=c,l=function(e,t){if(!(t.normal||t.tangent||t.bitangent||t.st))return e;var a,i,r=e.position.values;(t.normal||t.bitangent)&&(a=e.normal.values,i=e.bitangent.values);var n,o=e.position.values.length/18,s=3*o,l=2*o,u=2*s;if(t.normal||t.bitangent||t.tangent){var d=t.normal?new Float32Array(6*s):void 0,f=t.tangent?new Float32Array(6*s):void 0,c=t.bitangent?new Float32Array(6*s):void 0,h=xa,m=Ca,p=Ta,_=Ea,g=Aa,v=Sa,b=u;for(n=0;n<s;n+=3){var w=b+u;h=y.default.fromArray(r,n,h),m=y.default.fromArray(r,n+s,m),p=y.default.fromArray(r,(n+3)%s,p),m=y.default.subtract(m,h,m),p=y.default.subtract(p,h,p),_=y.default.normalize(y.default.cross(m,p,_),_),t.normal&&(ma.addAttribute(d,_,w),ma.addAttribute(d,_,w+3),ma.addAttribute(d,_,b),ma.addAttribute(d,_,b+3)),(t.tangent||t.bitangent)&&(v=y.default.fromArray(a,n,v),t.bitangent&&(ma.addAttribute(c,v,w),ma.addAttribute(c,v,w+3),ma.addAttribute(c,v,b),ma.addAttribute(c,v,b+3)),t.tangent&&(g=y.default.normalize(y.default.cross(v,_,g),g),ma.addAttribute(f,g,w),ma.addAttribute(f,g,w+3),ma.addAttribute(f,g,b),ma.addAttribute(f,g,b+3))),b+=6}if(t.normal){for(d.set(a),n=0;n<s;n+=3)d[n+s]=-a[n],d[n+s+1]=-a[n+1],d[n+s+2]=-a[n+2];e.normal.values=d}else e.normal=void 0;if(t.bitangent?(c.set(i),c.set(i,s),e.bitangent.values=c):e.bitangent=void 0,t.tangent){var O=e.tangent.values;f.set(O),f.set(O,s),e.tangent.values=f}}if(t.st){var x=e.st.values,C=new Float32Array(6*l);C.set(x),C.set(x,l);for(var T=2*l,E=0;E<2;E++){for(C[T++]=x[0],C[T++]=x[1],n=2;n<l;n+=2){var A=x[n],S=x[n+1];C[T++]=A,C[T++]=S,C[T++]=A,C[T++]=S}C[T++]=x[0],C[T++]=x[1]}e.st.values=C}return e}(l,t);var _=f/3;if(e.shadowVolume){var g=l.normal.values;f=g.length;var v=new Float32Array(6*f);for(m=0;m<f;m++)g[m]=-g[m];v.set(g,f),v=Ra(g,4*f,v),l.extrudeDirection=new ga.a({componentDatatype:ue.a.FLOAT,componentsPerAttribute:3,values:v}),t.normal||(l.normal=void 0)}if(Object(s.default)(e.offsetAttribute)){var b=new Uint8Array(6*_);if(e.offsetAttribute===he.a.TOP)b=Object($e.a)(b,1,0,_),b=Object($e.a)(b,1,2*_,4*_);else{var w=e.offsetAttribute===he.a.NONE?0:1;b=Object($e.a)(b,w)}l.applyOffset=new ga.a({componentDatatype:ue.a.UNSIGNED_BYTE,componentsPerAttribute:1,values:b})}var O=u.length,x=_+_,C=ya.a.createTypedArray(c.length/3,2*O+3*x);C.set(u);var T,E,A,S,P=O;for(m=0;m<O;m+=3){var D=u[m],I=u[m+1],M=u[m+2];C[P++]=M+_,C[P++]=I+_,C[P++]=D+_}for(m=0;m<x;m+=2)A=(T=m+x)+1,S=(E=T+x)+1,C[P++]=T,C[P++]=E,C[P++]=A,C[P++]=A,C[P++]=E,C[P++]=S;return{attributes:l,indices:C}}var La=new y.default,ja=new y.default,Va=new je.default;function Ua(e,t,a,i,r,n){var o=y.default.subtract(t,e,La);y.default.normalize(o,o);var s=a.geodeticSurfaceNormal(e,ja),l=y.default.cross(o,s,La);y.default.multiplyByScalar(l,i,l);var u=r.latitude,d=r.longitude,f=n.latitude,c=n.longitude;y.default.add(e,l,ja),a.cartesianToCartographic(ja,Va);var h=Va.latitude,m=Va.longitude;u=Math.min(u,h),d=Math.min(d,m),f=Math.max(f,h),c=Math.max(c,m),y.default.subtract(e,l,ja),a.cartesianToCartographic(ja,Va),h=Va.latitude,m=Va.longitude,u=Math.min(u,h),d=Math.min(d,m),f=Math.max(f,h),c=Math.max(c,m),r.latitude=u,r.longitude=d,n.latitude=f,n.longitude=c}var za=new y.default,Ba=new y.default,Ha=new je.default,ka=new je.default;function Ga(e,t,a,i,r){e=Ia(e,t);var n=Object(et.a)(e,y.default.equalsEpsilon),o=n.length;if(o<2||a<=0)return new Oa.default;var l,u,d=.5*a;if(Ha.latitude=Number.POSITIVE_INFINITY,Ha.longitude=Number.POSITIVE_INFINITY,ka.latitude=Number.NEGATIVE_INFINITY,ka.longitude=Number.NEGATIVE_INFINITY,i===tt.a.ROUNDED){var f=n[0];y.default.subtract(f,n[1],za),y.default.normalize(za,za),y.default.multiplyByScalar(za,d,za),y.default.add(f,za,Ba),t.cartesianToCartographic(Ba,Va),l=Va.latitude,u=Va.longitude,Ha.latitude=Math.min(Ha.latitude,l),Ha.longitude=Math.min(Ha.longitude,u),ka.latitude=Math.max(ka.latitude,l),ka.longitude=Math.max(ka.longitude,u)}for(var c=0;c<o-1;++c)Ua(n[c],n[c+1],t,d,Ha,ka);var h=n[o-1];y.default.subtract(h,n[o-2],za),y.default.normalize(za,za),y.default.multiplyByScalar(za,d,za),y.default.add(h,za,Ba),Ua(h,Ba,t,d,Ha,ka),i===tt.a.ROUNDED&&(t.cartesianToCartographic(Ba,Va),l=Va.latitude,u=Va.longitude,Ha.latitude=Math.min(Ha.latitude,l),Ha.longitude=Math.min(Ha.longitude,u),ka.latitude=Math.max(ka.latitude,l),ka.longitude=Math.max(ka.longitude,u));var m=Object(s.default)(r)?r:new Oa.default;return m.north=ka.latitude,m.south=Ha.latitude,m.east=ka.longitude,m.west=Ha.longitude,m}function Wa(e){var t=(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).positions,a=e.width,i=Object(o.default)(e.height,0),r=Object(o.default)(e.extrudedHeight,i);this._positions=t,this._ellipsoid=pa.default.clone(Object(o.default)(e.ellipsoid,pa.default.WGS84)),this._vertexFormat=$.default.clone(Object(o.default)(e.vertexFormat,$.default.DEFAULT)),this._width=a,this._height=Math.max(i,r),this._extrudedHeight=Math.min(i,r),this._cornerType=Object(o.default)(e.cornerType,tt.a.ROUNDED),this._granularity=Object(o.default)(e.granularity,Ve.default.RADIANS_PER_DEGREE),this._shadowVolume=Object(o.default)(e.shadowVolume,!1),this._workerName="createCorridorGeometry",this._offsetAttribute=e.offsetAttribute,this._rectangle=void 0,this.packedLength=1+t.length*y.default.packedLength+pa.default.packedLength+$.default.packedLength+7}Wa.pack=function(e,t,a){a=Object(o.default)(a,0);var i=e._positions,r=i.length;t[a++]=r;for(var n=0;n<r;++n,a+=y.default.packedLength)y.default.pack(i[n],t,a);return pa.default.pack(e._ellipsoid,t,a),a+=pa.default.packedLength,$.default.pack(e._vertexFormat,t,a),a+=$.default.packedLength,t[a++]=e._width,t[a++]=e._height,t[a++]=e._extrudedHeight,t[a++]=e._cornerType,t[a++]=e._granularity,t[a++]=e._shadowVolume?1:0,t[a]=Object(o.default)(e._offsetAttribute,-1),t};var Ya=pa.default.clone(pa.default.UNIT_SPHERE),Xa=new $.default,Qa={positions:void 0,ellipsoid:Ya,vertexFormat:Xa,width:void 0,height:void 0,extrudedHeight:void 0,cornerType:void 0,granularity:void 0,shadowVolume:void 0,offsetAttribute:void 0};Wa.unpack=function(e,t,a){t=Object(o.default)(t,0);for(var i=e[t++],r=new Array(i),n=0;n<i;++n,t+=y.default.packedLength)r[n]=y.default.unpack(e,t);var l=pa.default.unpack(e,t,Ya);t+=pa.default.packedLength;var u=$.default.unpack(e,t,Xa);t+=$.default.packedLength;var d=e[t++],f=e[t++],c=e[t++],h=e[t++],m=e[t++],p=1===e[t++],_=e[t];return Object(s.default)(a)?(a._positions=r,a._ellipsoid=pa.default.clone(l,a._ellipsoid),a._vertexFormat=$.default.clone(u,a._vertexFormat),a._width=d,a._height=f,a._extrudedHeight=c,a._cornerType=h,a._granularity=m,a._shadowVolume=p,a._offsetAttribute=-1===_?void 0:_,a):(Qa.positions=r,Qa.width=d,Qa.height=f,Qa.extrudedHeight=c,Qa.cornerType=h,Qa.granularity=m,Qa.shadowVolume=p,Qa.offsetAttribute=-1===_?void 0:_,new Wa(Qa))},Wa.computeRectangle=function(e,t){var a=(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).positions,i=e.width;return Ga(a,Object(o.default)(e.ellipsoid,pa.default.WGS84),i,Object(o.default)(e.cornerType,tt.a.ROUNDED),t)},Wa.createGeometry=function(e){var t=e._positions,a=e._width,i=e._ellipsoid;t=Ia(t,i);var n=Object(et.a)(t,y.default.equalsEpsilon);if(!(n.length<2||a<=0)){var o,l=e._height,u=e._extrudedHeight,d=!Ve.default.equalsEpsilon(l,u,0,Ve.default.EPSILON2),f=e._vertexFormat,c={ellipsoid:i,positions:n,width:a,cornerType:e._cornerType,granularity:e._granularity,saveAttributes:!0};if(d)c.height=l,c.extrudedHeight=u,c.shadowVolume=e._shadowVolume,c.offsetAttribute=e._offsetAttribute,o=Na(c,f);else if((o=Fa(ma.computePositions(c),f,i)).attributes.position.values=ba.a.scaleToGeodeticHeight(o.attributes.position.values,l,i),Object(s.default)(e._offsetAttribute)){var h=e._offsetAttribute===he.a.NONE?0:1,m=o.attributes.position.values.length,p=new Uint8Array(m/3);Object($e.a)(p,h),o.attributes.applyOffset=new ga.a({componentDatatype:ue.a.UNSIGNED_BYTE,componentsPerAttribute:1,values:p})}var _=o.attributes,g=r.default.fromVertices(_.position.values,void 0,3);return f.position||(o.attributes.position.values=void 0),new _a.a({attributes:_,indices:o.indices,primitiveType:wa.a.TRIANGLES,boundingSphere:g,offsetAttribute:e._offsetAttribute})}},Wa.createShadowVolume=function(e,t,a){var i=e._granularity,r=e._ellipsoid,n=t(i,r),o=a(i,r);return new Wa({positions:e._positions,width:e._width,cornerType:e._cornerType,ellipsoid:r,granularity:i,extrudedHeight:n,height:o,vertexFormat:$.default.POSITION_ONLY,shadowVolume:!0})},Object(l.default)(Wa.prototype,{rectangle:{get:function(){return Object(s.default)(this._rectangle)||(this._rectangle=Ga(this._positions,this._ellipsoid,this._width,this._cornerType)),this._rectangle}},textureCoordinateRotationPoints:{get:function(){return[0,0,0,1,1,0]}}});var qa=Wa,Za=new y.default,Ka=new y.default,Ja=new y.default;function $a(e,t){var a,i,r,n=[],o=e.positions,l=e.corners,u=e.endPositions,d=new va.a,f=0,c=0,h=0;for(i=0;i<o.length;i+=2)f+=r=o[i].length-3,h+=r/3*4,c+=o[i+1].length-3;for(f+=3,c+=3,i=0;i<l.length;i++){a=l[i];var m=l[i].leftPositions;Object(s.default)(m)?(f+=r=m.length,h+=r/3*2):(c+=r=l[i].rightPositions.length,h+=r/3*2)}var p,_=Object(s.default)(u);_&&(f+=p=u[0].length-3,c+=p,h+=4*(p/=3));var g,v,b,w,O,x,C=f+c,T=new Float64Array(C),E=0,A=C-1,S=p/2,P=ya.a.createTypedArray(C/3,h+4),D=0;if(P[D++]=E/3,P[D++]=(A-2)/3,_){n.push(E/3),x=Za,O=Ka;var I=u[0];for(i=0;i<S;i++)x=y.default.fromArray(I,3*(S-1-i),x),O=y.default.fromArray(I,3*(S+i),O),ma.addAttribute(T,O,E),ma.addAttribute(T,x,void 0,A),w=(v=E/3)+1,b=(g=(A-2)/3)-1,P[D++]=g,P[D++]=b,P[D++]=v,P[D++]=w,E+=3,A-=3}var M=0,F=o[M++],R=o[M++];for(T.set(F,E),T.set(R,A-R.length+1),r=R.length-3,n.push(E/3,(A-2)/3),i=0;i<r;i+=3)w=(v=E/3)+1,b=(g=(A-2)/3)-1,P[D++]=g,P[D++]=b,P[D++]=v,P[D++]=w,E+=3,A-=3;for(i=0;i<l.length;i++){var N,L,j=(a=l[i]).leftPositions,V=a.rightPositions,U=Ja;if(Object(s.default)(j)){for(A-=3,L=b,n.push(w),N=0;N<j.length/3;N++)U=y.default.fromArray(j,3*N,U),P[D++]=L-N-1,P[D++]=L-N,ma.addAttribute(T,U,void 0,A),A-=3;n.push(L-Math.floor(j.length/6)),t===tt.a.BEVELED&&n.push((A-2)/3+1),E+=3}else{for(E+=3,L=w,n.push(b),N=0;N<V.length/3;N++)U=y.default.fromArray(V,3*N,U),P[D++]=L+N,P[D++]=L+N+1,ma.addAttribute(T,U,E),E+=3;n.push(L+Math.floor(V.length/6)),t===tt.a.BEVELED&&n.push(E/3-1),A-=3}for(F=o[M++],R=o[M++],F.splice(0,3),R.splice(R.length-3,3),T.set(F,E),T.set(R,A-R.length+1),r=R.length-3,N=0;N<R.length;N+=3)v=(w=E/3)-1,g=(b=(A-2)/3)+1,P[D++]=g,P[D++]=b,P[D++]=v,P[D++]=w,E+=3,A-=3;E-=3,A+=3,n.push(E/3,(A-2)/3)}if(_){E+=3,A-=3,x=Za,O=Ka;var z=u[1];for(i=0;i<S;i++)x=y.default.fromArray(z,3*(p-i-1),x),O=y.default.fromArray(z,3*i,O),ma.addAttribute(T,x,void 0,A),ma.addAttribute(T,O,E),v=(w=E/3)-1,g=(b=(A-2)/3)+1,P[D++]=g,P[D++]=b,P[D++]=v,P[D++]=w,E+=3,A-=3;n.push(E/3)}else n.push(E/3,(A-2)/3);return P[D++]=E/3,P[D++]=(A-2)/3,d.position=new ga.a({componentDatatype:ue.a.DOUBLE,componentsPerAttribute:3,values:T}),{attributes:d,indices:P,wallIndices:n}}function ei(e){var t=(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).positions,a=e.width,i=Object(o.default)(e.height,0),r=Object(o.default)(e.extrudedHeight,i);this._positions=t,this._ellipsoid=pa.default.clone(Object(o.default)(e.ellipsoid,pa.default.WGS84)),this._width=a,this._height=Math.max(i,r),this._extrudedHeight=Math.min(i,r),this._cornerType=Object(o.default)(e.cornerType,tt.a.ROUNDED),this._granularity=Object(o.default)(e.granularity,Ve.default.RADIANS_PER_DEGREE),this._offsetAttribute=e.offsetAttribute,this._workerName="createCorridorOutlineGeometry",this.packedLength=1+t.length*y.default.packedLength+pa.default.packedLength+6}ei.pack=function(e,t,a){a=Object(o.default)(a,0);var i=e._positions,r=i.length;t[a++]=r;for(var n=0;n<r;++n,a+=y.default.packedLength)y.default.pack(i[n],t,a);return pa.default.pack(e._ellipsoid,t,a),a+=pa.default.packedLength,t[a++]=e._width,t[a++]=e._height,t[a++]=e._extrudedHeight,t[a++]=e._cornerType,t[a++]=e._granularity,t[a]=Object(o.default)(e._offsetAttribute,-1),t};var ti=pa.default.clone(pa.default.UNIT_SPHERE),ai={positions:void 0,ellipsoid:ti,width:void 0,height:void 0,extrudedHeight:void 0,cornerType:void 0,granularity:void 0,offsetAttribute:void 0};ei.unpack=function(e,t,a){t=Object(o.default)(t,0);for(var i=e[t++],r=new Array(i),n=0;n<i;++n,t+=y.default.packedLength)r[n]=y.default.unpack(e,t);var l=pa.default.unpack(e,t,ti);t+=pa.default.packedLength;var u=e[t++],d=e[t++],f=e[t++],c=e[t++],h=e[t++],m=e[t];return Object(s.default)(a)?(a._positions=r,a._ellipsoid=pa.default.clone(l,a._ellipsoid),a._width=u,a._height=d,a._extrudedHeight=f,a._cornerType=c,a._granularity=h,a._offsetAttribute=-1===m?void 0:m,a):(ai.positions=r,ai.width=u,ai.height=d,ai.extrudedHeight=f,ai.cornerType=c,ai.granularity=h,ai.offsetAttribute=-1===m?void 0:m,new ei(ai))},ei.createGeometry=function(e){var t=e._positions,a=e._width,i=e._ellipsoid;t=function(e,t){for(var a=0;a<e.length;a++)e[a]=t.scaleToGeodeticSurface(e[a],e[a]);return e}(t,i);var n=Object(et.a)(t,y.default.equalsEpsilon);if(!(n.length<2||a<=0)){var o,l=e._height,u=e._extrudedHeight,d=!Ve.default.equalsEpsilon(l,u,0,Ve.default.EPSILON2),f={ellipsoid:i,positions:n,width:a,cornerType:e._cornerType,granularity:e._granularity,saveAttributes:!1};if(d)f.height=l,f.extrudedHeight=u,f.offsetAttribute=e._offsetAttribute,o=function(e){var t=e.ellipsoid,a=$a(ma.computePositions(e),e.cornerType),i=a.wallIndices,r=e.height,n=e.extrudedHeight,o=a.attributes,l=a.indices,u=o.position.values,d=u.length,f=new Float64Array(d);f.set(u);var c,h=new Float64Array(2*d);if(u=ba.a.scaleToGeodeticHeight(u,r,t),f=ba.a.scaleToGeodeticHeight(f,n,t),h.set(u),h.set(f,d),o.position.values=h,d/=3,Object(s.default)(e.offsetAttribute)){var m=new Uint8Array(2*d);if(e.offsetAttribute===he.a.TOP)m=Object($e.a)(m,1,0,d);else{var p=e.offsetAttribute===he.a.NONE?0:1;m=Object($e.a)(m,p)}o.applyOffset=new ga.a({componentDatatype:ue.a.UNSIGNED_BYTE,componentsPerAttribute:1,values:m})}var _=l.length,g=ya.a.createTypedArray(h.length/3,2*(_+i.length));g.set(l);var v,y,b=_;for(c=0;c<_;c+=2){var w=l[c],O=l[c+1];g[b++]=w+d,g[b++]=O+d}for(c=0;c<i.length;c++)y=(v=i[c])+d,g[b++]=v,g[b++]=y;return{attributes:o,indices:g}}(f);else if((o=$a(ma.computePositions(f),f.cornerType)).attributes.position.values=ba.a.scaleToGeodeticHeight(o.attributes.position.values,l,i),Object(s.default)(e._offsetAttribute)){var c=o.attributes.position.values.length,h=new Uint8Array(c/3),m=e._offsetAttribute===he.a.NONE?0:1;Object($e.a)(h,m),o.attributes.applyOffset=new ga.a({componentDatatype:ue.a.UNSIGNED_BYTE,componentsPerAttribute:1,values:h})}var p=o.attributes,_=r.default.fromVertices(p.position.values,void 0,3);return new _a.a({attributes:p,indices:o.indices,primitiveType:wa.a.LINES,boundingSphere:_,offsetAttribute:e._offsetAttribute})}};var ii=ei,ri=new Ce.a(0);function ni(e){Ne.call(this,e),this._zIndex=0,this._terrainOffsetProperty=void 0}Object(s.default)(Object.create)&&(ni.prototype=Object.create(Ne.prototype),ni.prototype.constructor=ni),Object(l.default)(ni.prototype,{zIndex:{get:function(){return this._zIndex}},terrainOffsetProperty:{get:function(){return this._terrainOffsetProperty}}}),ni.prototype._isOnTerrain=function(e,t){return this._fillEnabled&&!Object(s.default)(t.height)&&!Object(s.default)(t.extrudedHeight)&&c.a.isSupported(this._scene)},ni.prototype._getIsClosed=function(e){var t=e.height,a=e.extrudedHeight;return 0===t||Object(s.default)(a)&&a!==t},ni.prototype._computeCenter=w.default.throwInstantiationError,ni.prototype._onEntityPropertyChanged=function(e,t,a,i){if(Ne.prototype._onEntityPropertyChanged.call(this,e,t,a,i),-1!==this._observedPropertyNames.indexOf(t)){var r=this._entity[this._geometryPropertyName];if(Object(s.default)(r)){Object(s.default)(r.zIndex)&&(Object(s.default)(r.height)||Object(s.default)(r.extrudedHeight))&&Object(xe.a)(xe.a.geometryZIndex),this._zIndex=Object(o.default)(r.zIndex,ri),Object(s.default)(this._terrainOffsetProperty)&&(this._terrainOffsetProperty.destroy(),this._terrainOffsetProperty=void 0);var n=r.heightReference,l=r.extrudedHeightReference;if(Object(s.default)(n)||Object(s.default)(l)){var u=new Le.default(this._computeCenter.bind(this),!this._dynamic);this._terrainOffsetProperty=new ke(this._scene,u,n,l)}}}},ni.prototype.destroy=function(){Object(s.default)(this._terrainOffsetProperty)&&(this._terrainOffsetProperty.destroy(),this._terrainOffsetProperty=void 0),Ne.prototype.destroy.call(this)},ni.getGeometryHeight=function(e,t){if(Object(s.default)(e))return t!==C.default.CLAMP_TO_GROUND?e:0;t!==C.default.NONE&&Object(xe.a)(xe.a.geometryHeightReference)},ni.getGeometryExtrudedHeight=function(e,t){if(Object(s.default)(e))return t!==C.default.CLAMP_TO_GROUND?e:ni.CLAMP_TO_GROUND;t!==C.default.NONE&&Object(xe.a)(xe.a.geometryExtrudedHeightReference)},ni.CLAMP_TO_GROUND="clamp",ni.computeGeometryOffsetAttribute=function(e,t,a,i){Object(s.default)(e)&&Object(s.default)(t)||(t=C.default.NONE),Object(s.default)(a)&&Object(s.default)(i)||(i=C.default.NONE);var r=0;return t!==C.default.NONE&&r++,i===C.default.RELATIVE_TO_GROUND&&r++,2===r?he.a.ALL:1===r?he.a.TOP:void 0};var oi=ni,si=new b.default,li=y.default.ZERO,ui=new y.default,di=new Oa.default;function fi(e){this.id=e,this.vertexFormat=void 0,this.positions=void 0,this.width=void 0,this.cornerType=void 0,this.height=void 0,this.extrudedHeight=void 0,this.granularity=void 0,this.offsetAttribute=void 0}function ci(e,t){oi.call(this,{entity:e,scene:t,geometryOptions:new fi(e),geometryPropertyName:"corridor",observedPropertyNames:["availability","corridor"]}),this._onEntityPropertyChanged(e,"corridor",e.corridor,void 0)}function hi(e,t,a){Oe.call(this,e,t,a)}Object(s.default)(Object.create)&&(ci.prototype=Object.create(oi.prototype),ci.prototype.constructor=ci),ci.prototype.createFillGeometryInstance=function(e){var t,a=this._entity,i=a.isAvailable(e),r={show:new _e.a(i&&a.isShowing&&this._showProperty.getValue(e)&&this._fillProperty.getValue(e)),distanceDisplayCondition:fe.fromDistanceDisplayCondition(this._distanceDisplayConditionProperty.getValue(e)),offset:void 0,color:void 0};this._materialProperty instanceof ge.default&&(Object(s.default)(this._materialProperty.color)&&(this._materialProperty.color.isConstant||i)&&(t=this._materialProperty.color.getValue(e,si)),Object(s.default)(t)||(t=b.default.WHITE),r.color=le.a.fromColor(t));return Object(s.default)(this._options.offsetAttribute)&&(r.offset=pe.a.fromCartesian3(S.default.getValueOrDefault(this._terrainOffsetProperty,e,li,ui))),new ce.a({id:a,geometry:new qa(this._options),attributes:r})},ci.prototype.createOutlineGeometryInstance=function(e){var t=this._entity,a=t.isAvailable(e),i=S.default.getValueOrDefault(this._outlineColorProperty,e,b.default.BLACK,si),r={show:new _e.a(a&&t.isShowing&&this._showProperty.getValue(e)&&this._showOutlineProperty.getValue(e)),color:le.a.fromColor(i),distanceDisplayCondition:fe.fromDistanceDisplayCondition(this._distanceDisplayConditionProperty.getValue(e)),offset:void 0};return Object(s.default)(this._options.offsetAttribute)&&(r.offset=pe.a.fromCartesian3(S.default.getValueOrDefault(this._terrainOffsetProperty,e,li,ui))),new ce.a({id:t,geometry:new ii(this._options),attributes:r})},ci.prototype._computeCenter=function(e,t){var a=S.default.getValueOrUndefined(this._entity.corridor.positions,e);if(Object(s.default)(a)&&0!==a.length)return y.default.clone(a[Math.floor(a.length/2)],t)},ci.prototype._isHidden=function(e,t){return!Object(s.default)(t.positions)||!Object(s.default)(t.width)||Ne.prototype._isHidden.call(this,e,t)},ci.prototype._isDynamic=function(e,t){return!t.positions.isConstant||!S.default.isConstant(t.height)||!S.default.isConstant(t.extrudedHeight)||!S.default.isConstant(t.granularity)||!S.default.isConstant(t.width)||!S.default.isConstant(t.outlineWidth)||!S.default.isConstant(t.cornerType)||!S.default.isConstant(t.zIndex)||this._onTerrain&&!S.default.isConstant(this._materialProperty)},ci.prototype._setStaticOptions=function(e,t){var a=S.default.getValueOrUndefined(t.height,me.default.MINIMUM_VALUE),r=S.default.getValueOrDefault(t.heightReference,me.default.MINIMUM_VALUE,C.default.NONE),n=S.default.getValueOrUndefined(t.extrudedHeight,me.default.MINIMUM_VALUE),o=S.default.getValueOrDefault(t.extrudedHeightReference,me.default.MINIMUM_VALUE,C.default.NONE);Object(s.default)(n)&&!Object(s.default)(a)&&(a=0);var l=this._options;l.vertexFormat=this._materialProperty instanceof ge.default?re.a.VERTEX_FORMAT:ie.MaterialSupport.TEXTURED.vertexFormat,l.positions=t.positions.getValue(me.default.MINIMUM_VALUE,l.positions),l.width=t.width.getValue(me.default.MINIMUM_VALUE),l.granularity=S.default.getValueOrUndefined(t.granularity,me.default.MINIMUM_VALUE),l.cornerType=S.default.getValueOrUndefined(t.cornerType,me.default.MINIMUM_VALUE),l.offsetAttribute=oi.computeGeometryOffsetAttribute(a,r,n,o),l.height=oi.getGeometryHeight(a,r),(n=oi.getGeometryExtrudedHeight(n,o))===oi.CLAMP_TO_GROUND&&(n=i.a.getMinimumMaximumHeights(qa.computeRectangle(l,di)).minimumTerrainHeight),l.extrudedHeight=n},ci.DynamicGeometryUpdater=hi,Object(s.default)(Object.create)&&(hi.prototype=Object.create(Oe.prototype),hi.prototype.constructor=hi),hi.prototype._isHidden=function(e,t,a){var i=this._options;return!Object(s.default)(i.positions)||!Object(s.default)(i.width)||Oe.prototype._isHidden.call(this,e,t,a)},hi.prototype._setOptions=function(e,t,a){var r=this._options,n=S.default.getValueOrUndefined(t.height,a),o=S.default.getValueOrDefault(t.heightReference,a,C.default.NONE),l=S.default.getValueOrUndefined(t.extrudedHeight,a),u=S.default.getValueOrDefault(t.extrudedHeightReference,a,C.default.NONE);Object(s.default)(l)&&!Object(s.default)(n)&&(n=0),r.positions=S.default.getValueOrUndefined(t.positions,a),r.width=S.default.getValueOrUndefined(t.width,a),r.granularity=S.default.getValueOrUndefined(t.granularity,a),r.cornerType=S.default.getValueOrUndefined(t.cornerType,a),r.offsetAttribute=oi.computeGeometryOffsetAttribute(n,o,l,u),r.height=oi.getGeometryHeight(n,o),(l=oi.getGeometryExtrudedHeight(l,u))===oi.CLAMP_TO_GROUND&&(l=i.a.getMinimumMaximumHeights(qa.computeRectangle(r,di)).minimumTerrainHeight),r.extrudedHeight=l};var mi=ci,pi={computePositions:function(e,t,a,i,r){var n,o=.5*e,s=-o,l=i+i,u=new Float64Array(3*(r?2*l:l)),d=0,f=0,c=r?3*l:0,h=r?3*(l+i):3*i;for(n=0;n<i;n++){var m=n/i*Ve.default.TWO_PI,p=Math.cos(m),_=Math.sin(m),g=p*a,v=_*a,y=p*t,b=_*t;u[f+c]=g,u[f+c+1]=v,u[f+c+2]=s,u[f+h]=y,u[f+h+1]=b,u[f+h+2]=o,f+=3,r&&(u[d++]=g,u[d++]=v,u[d++]=s,u[d++]=y,u[d++]=b,u[d++]=o)}return u}},_i=pi,gi=new v.default,vi=new y.default,yi=new y.default,bi=new y.default,wi=new y.default;function Oi(e){var t=(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).length,a=e.topRadius,i=e.bottomRadius,r=Object(o.default)(e.vertexFormat,$.default.DEFAULT),n=Object(o.default)(e.slices,128);this._length=t,this._topRadius=a,this._bottomRadius=i,this._vertexFormat=$.default.clone(r),this._slices=n,this._offsetAttribute=e.offsetAttribute,this._workerName="createCylinderGeometry"}Oi.packedLength=$.default.packedLength+5,Oi.pack=function(e,t,a){return a=Object(o.default)(a,0),$.default.pack(e._vertexFormat,t,a),a+=$.default.packedLength,t[a++]=e._length,t[a++]=e._topRadius,t[a++]=e._bottomRadius,t[a++]=e._slices,t[a]=Object(o.default)(e._offsetAttribute,-1),t};var xi,Ci=new $.default,Ti={vertexFormat:Ci,length:void 0,topRadius:void 0,bottomRadius:void 0,slices:void 0,offsetAttribute:void 0};Oi.unpack=function(e,t,a){t=Object(o.default)(t,0);var i=$.default.unpack(e,t,Ci);t+=$.default.packedLength;var r=e[t++],n=e[t++],l=e[t++],u=e[t++],d=e[t];return Object(s.default)(a)?(a._vertexFormat=$.default.clone(i,a._vertexFormat),a._length=r,a._topRadius=n,a._bottomRadius=l,a._slices=u,a._offsetAttribute=-1===d?void 0:d,a):(Ti.length=r,Ti.topRadius=n,Ti.bottomRadius=l,Ti.slices=u,Ti.offsetAttribute=-1===d?void 0:d,new Oi(Ti))},Oi.createGeometry=function(e){var t=e._length,a=e._topRadius,i=e._bottomRadius,n=e._vertexFormat,o=e._slices;if(!(t<=0||a<0||i<0||0===a&&0===i)){var l,u=o+o,d=o+u,f=u+u,c=_i.computePositions(t,a,i,o,!0),h=n.st?new Float32Array(2*f):void 0,m=n.normal?new Float32Array(3*f):void 0,p=n.tangent?new Float32Array(3*f):void 0,_=n.bitangent?new Float32Array(3*f):void 0,g=n.normal||n.tangent||n.bitangent;if(g){var b=n.tangent||n.bitangent,w=0,O=0,x=0,C=Math.atan2(i-a,t),T=vi;T.z=Math.sin(C);var E=Math.cos(C),A=bi,S=yi;for(l=0;l<o;l++){var P=l/o*Ve.default.TWO_PI,D=E*Math.cos(P),I=E*Math.sin(P);g&&(T.x=D,T.y=I,b&&(A=y.default.normalize(y.default.cross(y.default.UNIT_Z,T,A),A)),n.normal&&(m[w++]=T.x,m[w++]=T.y,m[w++]=T.z,m[w++]=T.x,m[w++]=T.y,m[w++]=T.z),n.tangent&&(p[O++]=A.x,p[O++]=A.y,p[O++]=A.z,p[O++]=A.x,p[O++]=A.y,p[O++]=A.z),n.bitangent&&(S=y.default.normalize(y.default.cross(T,A,S),S),_[x++]=S.x,_[x++]=S.y,_[x++]=S.z,_[x++]=S.x,_[x++]=S.y,_[x++]=S.z))}for(l=0;l<o;l++)n.normal&&(m[w++]=0,m[w++]=0,m[w++]=-1),n.tangent&&(p[O++]=1,p[O++]=0,p[O++]=0),n.bitangent&&(_[x++]=0,_[x++]=-1,_[x++]=0);for(l=0;l<o;l++)n.normal&&(m[w++]=0,m[w++]=0,m[w++]=1),n.tangent&&(p[O++]=1,p[O++]=0,p[O++]=0),n.bitangent&&(_[x++]=0,_[x++]=1,_[x++]=0)}var M=12*o-12,F=ya.a.createTypedArray(f,M),R=0,N=0;for(l=0;l<o-1;l++)F[R++]=N,F[R++]=N+2,F[R++]=N+3,F[R++]=N,F[R++]=N+3,F[R++]=N+1,N+=2;for(F[R++]=u-2,F[R++]=0,F[R++]=1,F[R++]=u-2,F[R++]=1,F[R++]=u-1,l=1;l<o-1;l++)F[R++]=u+l+1,F[R++]=u+l,F[R++]=u;for(l=1;l<o-1;l++)F[R++]=d,F[R++]=d+l,F[R++]=d+l+1;var L=0;if(n.st){var j=Math.max(a,i);for(l=0;l<f;l++){var V=y.default.fromArray(c,3*l,wi);h[L++]=(V.x+j)/(2*j),h[L++]=(V.y+j)/(2*j)}}var U=new va.a;n.position&&(U.position=new ga.a({componentDatatype:ue.a.DOUBLE,componentsPerAttribute:3,values:c})),n.normal&&(U.normal=new ga.a({componentDatatype:ue.a.FLOAT,componentsPerAttribute:3,values:m})),n.tangent&&(U.tangent=new ga.a({componentDatatype:ue.a.FLOAT,componentsPerAttribute:3,values:p})),n.bitangent&&(U.bitangent=new ga.a({componentDatatype:ue.a.FLOAT,componentsPerAttribute:3,values:_})),n.st&&(U.st=new ga.a({componentDatatype:ue.a.FLOAT,componentsPerAttribute:2,values:h})),gi.x=.5*t,gi.y=Math.max(i,a);var z=new r.default(y.default.ZERO,v.default.magnitude(gi));if(Object(s.default)(e._offsetAttribute)){t=c.length;var B=new Uint8Array(t/3),H=e._offsetAttribute===he.a.NONE?0:1;Object($e.a)(B,H),U.applyOffset=new ga.a({componentDatatype:ue.a.UNSIGNED_BYTE,componentsPerAttribute:1,values:B})}return new _a.a({attributes:U,indices:F,primitiveType:wa.a.TRIANGLES,boundingSphere:z,offsetAttribute:e._offsetAttribute})}},Oi.getUnitCylinder=function(){return Object(s.default)(xi)||(xi=Oi.createGeometry(new Oi({topRadius:1,bottomRadius:1,length:1,vertexFormat:$.default.POSITION_ONLY}))),xi};var Ei=Oi,Ai=new v.default;function Si(e){var t=(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).length,a=e.topRadius,i=e.bottomRadius,r=Object(o.default)(e.slices,128),n=Math.max(Object(o.default)(e.numberOfVerticalLines,16),0);this._length=t,this._topRadius=a,this._bottomRadius=i,this._slices=r,this._numberOfVerticalLines=n,this._offsetAttribute=e.offsetAttribute,this._workerName="createCylinderOutlineGeometry"}Si.packedLength=6,Si.pack=function(e,t,a){return a=Object(o.default)(a,0),t[a++]=e._length,t[a++]=e._topRadius,t[a++]=e._bottomRadius,t[a++]=e._slices,t[a++]=e._numberOfVerticalLines,t[a]=Object(o.default)(e._offsetAttribute,-1),t};var Pi={length:void 0,topRadius:void 0,bottomRadius:void 0,slices:void 0,numberOfVerticalLines:void 0,offsetAttribute:void 0};Si.unpack=function(e,t,a){t=Object(o.default)(t,0);var i=e[t++],r=e[t++],n=e[t++],l=e[t++],u=e[t++],d=e[t];return Object(s.default)(a)?(a._length=i,a._topRadius=r,a._bottomRadius=n,a._slices=l,a._numberOfVerticalLines=u,a._offsetAttribute=-1===d?void 0:d,a):(Pi.length=i,Pi.topRadius=r,Pi.bottomRadius=n,Pi.slices=l,Pi.numberOfVerticalLines=u,Pi.offsetAttribute=-1===d?void 0:d,new Si(Pi))},Si.createGeometry=function(e){var t=e._length,a=e._topRadius,i=e._bottomRadius,n=e._slices,o=e._numberOfVerticalLines;if(!(t<=0||a<0||i<0||0===a&&0===i)){var l,u=2*n,d=_i.computePositions(t,a,i,n,!1),f=2*n;if(o>0){var c=Math.min(o,n);l=Math.round(n/c),f+=c}var h,m=ya.a.createTypedArray(u,2*f),p=0;for(h=0;h<n-1;h++)m[p++]=h,m[p++]=h+1,m[p++]=h+n,m[p++]=h+1+n;if(m[p++]=n-1,m[p++]=0,m[p++]=n+n-1,m[p++]=n,o>0)for(h=0;h<n;h+=l)m[p++]=h,m[p++]=h+n;var _=new va.a;_.position=new ga.a({componentDatatype:ue.a.DOUBLE,componentsPerAttribute:3,values:d}),Ai.x=.5*t,Ai.y=Math.max(i,a);var g=new r.default(y.default.ZERO,v.default.magnitude(Ai));if(Object(s.default)(e._offsetAttribute)){t=d.length;var b=new Uint8Array(t/3),w=e._offsetAttribute===he.a.NONE?0:1;Object($e.a)(b,w),_.applyOffset=new ga.a({componentDatatype:ue.a.UNSIGNED_BYTE,componentsPerAttribute:1,values:b})}return new _a.a({attributes:_,indices:m,primitiveType:wa.a.LINES,boundingSphere:g,offsetAttribute:e._offsetAttribute})}};var Di=Si,Ii=y.default.ZERO,Mi=new y.default,Fi=new y.default,Ri=new b.default;function Ni(e){this.id=e,this.vertexFormat=void 0,this.length=void 0,this.topRadius=void 0,this.bottomRadius=void 0,this.slices=void 0,this.numberOfVerticalLines=void 0,this.offsetAttribute=void 0}function Li(e,t){Ne.call(this,{entity:e,scene:t,geometryOptions:new Ni(e),geometryPropertyName:"cylinder",observedPropertyNames:["availability","position","orientation","cylinder"]}),this._onEntityPropertyChanged(e,"cylinder",e.cylinder,void 0)}function ji(e,t,a){Oe.call(this,e,t,a)}Object(s.default)(Object.create)&&(Li.prototype=Object.create(Ne.prototype),Li.prototype.constructor=Li),Object(l.default)(Li.prototype,{terrainOffsetProperty:{get:function(){return this._terrainOffsetProperty}}}),Li.prototype.createFillGeometryInstance=function(e){var t,a=this._entity,i=a.isAvailable(e),r=new _e.a(i&&a.isShowing&&this._showProperty.getValue(e)&&this._fillProperty.getValue(e)),n=this._distanceDisplayConditionProperty.getValue(e),o={show:r,distanceDisplayCondition:fe.fromDistanceDisplayCondition(n),color:void 0,offset:void 0};this._materialProperty instanceof ge.default&&(Object(s.default)(this._materialProperty.color)&&(this._materialProperty.color.isConstant||i)&&(t=this._materialProperty.color.getValue(e,Ri)),Object(s.default)(t)||(t=b.default.WHITE),o.color=le.a.fromColor(t));return Object(s.default)(this._options.offsetAttribute)&&(o.offset=pe.a.fromCartesian3(S.default.getValueOrDefault(this._terrainOffsetProperty,e,Ii,Mi))),new ce.a({id:a,geometry:new Ei(this._options),modelMatrix:a.computeModelMatrixForHeightReference(e,a.cylinder.heightReference,.5*this._options.length,this._scene.mapProjection.ellipsoid),attributes:o})},Li.prototype.createOutlineGeometryInstance=function(e){var t=this._entity,a=t.isAvailable(e),i=S.default.getValueOrDefault(this._outlineColorProperty,e,b.default.BLACK,Ri),r=this._distanceDisplayConditionProperty.getValue(e),n={show:new _e.a(a&&t.isShowing&&this._showProperty.getValue(e)&&this._showOutlineProperty.getValue(e)),color:le.a.fromColor(i),distanceDisplayCondition:fe.fromDistanceDisplayCondition(r),offset:void 0};return Object(s.default)(this._options.offsetAttribute)&&(n.offset=pe.a.fromCartesian3(S.default.getValueOrDefault(this._terrainOffsetProperty,e,Ii,Mi))),new ce.a({id:t,geometry:new Di(this._options),modelMatrix:t.computeModelMatrixForHeightReference(e,t.cylinder.heightReference,.5*this._options.length,this._scene.mapProjection.ellipsoid),attributes:n})},Li.prototype._computeCenter=function(e,t){return S.default.getValueOrUndefined(this._entity.position,e,t)},Li.prototype._isHidden=function(e,t){return!Object(s.default)(e.position)||!Object(s.default)(t.length)||!Object(s.default)(t.topRadius)||!Object(s.default)(t.bottomRadius)||Ne.prototype._isHidden.call(this,e,t)},Li.prototype._isDynamic=function(e,t){return!(e.position.isConstant&&S.default.isConstant(e.orientation)&&t.length.isConstant&&t.topRadius.isConstant&&t.bottomRadius.isConstant&&S.default.isConstant(t.slices)&&S.default.isConstant(t.outlineWidth)&&S.default.isConstant(t.numberOfVerticalLines))},Li.prototype._setStaticOptions=function(e,t){var a=S.default.getValueOrDefault(t.heightReference,me.default.MINIMUM_VALUE,C.default.NONE),i=this._options;i.vertexFormat=this._materialProperty instanceof ge.default?re.a.VERTEX_FORMAT:ie.MaterialSupport.TEXTURED.vertexFormat,i.length=t.length.getValue(me.default.MINIMUM_VALUE),i.topRadius=t.topRadius.getValue(me.default.MINIMUM_VALUE),i.bottomRadius=t.bottomRadius.getValue(me.default.MINIMUM_VALUE),i.slices=S.default.getValueOrUndefined(t.slices,me.default.MINIMUM_VALUE),i.numberOfVerticalLines=S.default.getValueOrUndefined(t.numberOfVerticalLines,me.default.MINIMUM_VALUE),i.offsetAttribute=a!==C.default.NONE?he.a.ALL:void 0},Li.prototype._onEntityPropertyChanged=Ge,Li.DynamicGeometryUpdater=ji,Object(s.default)(Object.create)&&(ji.prototype=Object.create(Oe.prototype),ji.prototype.constructor=ji),ji.prototype._isHidden=function(e,t,a){var i=this._options,r=S.default.getValueOrUndefined(e.position,a,Fi);return!Object(s.default)(r)||!Object(s.default)(i.length)||!Object(s.default)(i.topRadius)||!Object(s.default)(i.bottomRadius)||Oe.prototype._isHidden.call(this,e,t,a)},ji.prototype._setOptions=function(e,t,a){var i=S.default.getValueOrDefault(t.heightReference,a,C.default.NONE),r=this._options;r.length=S.default.getValueOrUndefined(t.length,a),r.topRadius=S.default.getValueOrUndefined(t.topRadius,a),r.bottomRadius=S.default.getValueOrUndefined(t.bottomRadius,a),r.slices=S.default.getValueOrUndefined(t.slices,a),r.numberOfVerticalLines=S.default.getValueOrUndefined(t.numberOfVerticalLines,a),r.offsetAttribute=i!==C.default.NONE?he.a.ALL:void 0};var Vi=Li;function Ui(e,t){this._primitives=e,this._orderedGroundPrimitives=t,this._dynamicUpdaters=new _.default}Ui.prototype.add=function(e,t){this._dynamicUpdaters.set(t.id,t.createDynamicUpdater(this._primitives,this._orderedGroundPrimitives))},Ui.prototype.remove=function(e){var t=e.id,a=this._dynamicUpdaters.get(t);Object(s.default)(a)&&(this._dynamicUpdaters.remove(t),a.destroy())},Ui.prototype.update=function(e){for(var t=this._dynamicUpdaters.values,a=0,i=t.length;a<i;a++)t[a].update(e);return!0},Ui.prototype.removeAllPrimitives=function(){for(var e=this._dynamicUpdaters.values,t=0,a=e.length;t<a;t++)e[t].destroy();this._dynamicUpdaters.removeAll()},Ui.prototype.getBoundingSphere=function(e,t){return e=this._dynamicUpdaters.get(e.id),Object(s.default)(e)&&Object(s.default)(e.getBoundingSphere)?e.getBoundingSphere(t):A.default.FAILED};var zi=Ui,Bi={},Hi=new y.default,ki=new y.default,Gi=new st.default,Wi=new at.default;function Yi(e,t,a,i,r,n,o,s,l,u){var d=e+t;y.default.multiplyByScalar(i,Math.cos(d),Hi),y.default.multiplyByScalar(a,Math.sin(d),ki),y.default.add(Hi,ki,Hi);var f=Math.cos(e);f*=f;var c=Math.sin(e);c*=c;var h=n/Math.sqrt(o*f+r*c)/s;return st.default.fromAxisAngle(Hi,h,Gi),at.default.fromQuaternion(Gi,Wi),at.default.multiplyByVector(Wi,l,u),y.default.normalize(u,u),y.default.multiplyByScalar(u,s,u),u}var Xi=new y.default,Qi=new y.default,qi=new y.default,Zi=new y.default;Bi.raisePositionsToHeight=function(e,t,a){for(var i=t.ellipsoid,r=t.height,n=t.extrudedHeight,o=a?e.length/3*2:e.length/3,s=new Float64Array(3*o),l=e.length,u=a?l:0,d=0;d<l;d+=3){var f=d+1,c=d+2,h=y.default.fromArray(e,d,Xi);i.scaleToGeodeticSurface(h,h);var m=y.default.clone(h,Qi),p=i.geodeticSurfaceNormal(h,Zi),_=y.default.multiplyByScalar(p,r,qi);y.default.add(h,_,h),a&&(y.default.multiplyByScalar(p,n,_),y.default.add(m,_,m),s[d+u]=m.x,s[f+u]=m.y,s[c+u]=m.z),s[d]=h.x,s[f]=h.y,s[c]=h.z}return s};var Ki=new y.default,Ji=new y.default,$i=new y.default;Bi.computeEllipsePositions=function(e,t,a){var i=e.semiMinorAxis,r=e.semiMajorAxis,n=e.rotation,o=e.center,s=8*e.granularity,l=i*i,u=r*r,d=r*i,f=y.default.magnitude(o),c=y.default.normalize(o,Ki),h=y.default.cross(y.default.UNIT_Z,o,Ji);h=y.default.normalize(h,h);var m=y.default.cross(c,h,$i),p=1+Math.ceil(Ve.default.PI_OVER_TWO/s),_=Ve.default.PI_OVER_TWO/(p-1),g=Ve.default.PI_OVER_TWO-p*_;g<0&&(p-=Math.ceil(Math.abs(g)/_));var v,b,w,O,x,C=t?new Array(3*(p*(p+2)*2)):void 0,T=0,E=Xi,A=Qi,S=4*p*3,P=S-1,D=0,I=a?new Array(S):void 0;for(E=Yi(g=Ve.default.PI_OVER_TWO,n,m,h,l,d,u,f,c,E),t&&(C[T++]=E.x,C[T++]=E.y,C[T++]=E.z),a&&(I[P--]=E.z,I[P--]=E.y,I[P--]=E.x),g=Ve.default.PI_OVER_TWO-_,v=1;v<p+1;++v){if(E=Yi(g,n,m,h,l,d,u,f,c,E),A=Yi(Math.PI-g,n,m,h,l,d,u,f,c,A),t){for(C[T++]=E.x,C[T++]=E.y,C[T++]=E.z,w=2*v+2,b=1;b<w-1;++b)O=b/(w-1),x=y.default.lerp(E,A,O,qi),C[T++]=x.x,C[T++]=x.y,C[T++]=x.z;C[T++]=A.x,C[T++]=A.y,C[T++]=A.z}a&&(I[P--]=E.z,I[P--]=E.y,I[P--]=E.x,I[D++]=A.x,I[D++]=A.y,I[D++]=A.z),g=Ve.default.PI_OVER_TWO-(v+1)*_}for(v=p;v>1;--v){if(E=Yi(-(g=Ve.default.PI_OVER_TWO-(v-1)*_),n,m,h,l,d,u,f,c,E),A=Yi(g+Math.PI,n,m,h,l,d,u,f,c,A),t){for(C[T++]=E.x,C[T++]=E.y,C[T++]=E.z,w=2*(v-1)+2,b=1;b<w-1;++b)O=b/(w-1),x=y.default.lerp(E,A,O,qi),C[T++]=x.x,C[T++]=x.y,C[T++]=x.z;C[T++]=A.x,C[T++]=A.y,C[T++]=A.z}a&&(I[P--]=E.z,I[P--]=E.y,I[P--]=E.x,I[D++]=A.x,I[D++]=A.y,I[D++]=A.z)}E=Yi(-(g=Ve.default.PI_OVER_TWO),n,m,h,l,d,u,f,c,E);var M={};return t&&(C[T++]=E.x,C[T++]=E.y,C[T++]=E.z,M.positions=C,M.numPts=p),a&&(I[P--]=E.z,I[P--]=E.y,I[P--]=E.x,M.outerPositions=I),M};var er=Bi,tr=a(106),ar=a(124),ir=new y.default,rr=new y.default,nr=new y.default,or=new y.default,sr=new v.default,lr=new at.default,ur=new at.default,dr=new st.default,fr=new y.default,cr=new y.default,hr=new y.default,mr=new je.default,pr=new y.default,_r=new v.default,gr=new v.default;function vr(e,t,a){var i=t.vertexFormat,r=t.center,n=t.semiMajorAxis,o=t.semiMinorAxis,l=t.ellipsoid,u=t.stRotation,d=a?e.length/3*2:e.length/3,f=t.shadowVolume,c=i.st?new Float32Array(2*d):void 0,h=i.normal?new Float32Array(3*d):void 0,m=i.tangent?new Float32Array(3*d):void 0,p=i.bitangent?new Float32Array(3*d):void 0,_=f?new Float32Array(3*d):void 0,g=0,b=fr,w=cr,O=hr,x=new tr.a(l),C=x.project(l.cartesianToCartographic(r,mr),pr),T=l.scaleToGeodeticSurface(r,ir);l.geodeticSurfaceNormal(T,T);var E=lr,A=ur;if(0!==u){var S=st.default.fromAxisAngle(T,u,dr);E=at.default.fromQuaternion(S,E),S=st.default.fromAxisAngle(T,-u,dr),A=at.default.fromQuaternion(S,A)}else E=at.default.clone(at.default.IDENTITY,E),A=at.default.clone(at.default.IDENTITY,A);for(var P=v.default.fromElements(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,_r),D=v.default.fromElements(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,gr),I=e.length,M=a?I:0,F=M/3*2,R=0;R<I;R+=3){var N=R+1,L=R+2,j=y.default.fromArray(e,R,ir);if(i.st){var V=at.default.multiplyByVector(E,j,rr),U=x.project(l.cartesianToCartographic(V,mr),nr);y.default.subtract(U,C,U),sr.x=(U.x+n)/(2*n),sr.y=(U.y+o)/(2*o),P.x=Math.min(sr.x,P.x),P.y=Math.min(sr.y,P.y),D.x=Math.max(sr.x,D.x),D.y=Math.max(sr.y,D.y),a&&(c[g+F]=sr.x,c[g+1+F]=sr.y),c[g++]=sr.x,c[g++]=sr.y}(i.normal||i.tangent||i.bitangent||f)&&(b=l.geodeticSurfaceNormal(j,b),f&&(_[R+M]=-b.x,_[N+M]=-b.y,_[L+M]=-b.z),(i.normal||i.tangent||i.bitangent)&&((i.tangent||i.bitangent)&&(w=y.default.normalize(y.default.cross(y.default.UNIT_Z,b,w),w),at.default.multiplyByVector(A,w,w)),i.normal&&(h[R]=b.x,h[N]=b.y,h[L]=b.z,a&&(h[R+M]=-b.x,h[N+M]=-b.y,h[L+M]=-b.z)),i.tangent&&(m[R]=w.x,m[N]=w.y,m[L]=w.z,a&&(m[R+M]=-w.x,m[N+M]=-w.y,m[L+M]=-w.z)),i.bitangent&&(O=y.default.normalize(y.default.cross(b,w,O),O),p[R]=O.x,p[N]=O.y,p[L]=O.z,a&&(p[R+M]=O.x,p[N+M]=O.y,p[L+M]=O.z))))}if(i.st){I=c.length;for(var z=0;z<I;z+=2)c[z]=(c[z]-P.x)/(D.x-P.x),c[z+1]=(c[z+1]-P.y)/(D.y-P.y)}var B=new va.a;if(i.position){var H=er.raisePositionsToHeight(e,t,a);B.position=new ga.a({componentDatatype:ue.a.DOUBLE,componentsPerAttribute:3,values:H})}if(i.st&&(B.st=new ga.a({componentDatatype:ue.a.FLOAT,componentsPerAttribute:2,values:c})),i.normal&&(B.normal=new ga.a({componentDatatype:ue.a.FLOAT,componentsPerAttribute:3,values:h})),i.tangent&&(B.tangent=new ga.a({componentDatatype:ue.a.FLOAT,componentsPerAttribute:3,values:m})),i.bitangent&&(B.bitangent=new ga.a({componentDatatype:ue.a.FLOAT,componentsPerAttribute:3,values:p})),f&&(B.extrudeDirection=new ga.a({componentDatatype:ue.a.FLOAT,componentsPerAttribute:3,values:_})),a&&Object(s.default)(t.offsetAttribute)){var k=new Uint8Array(d);if(t.offsetAttribute===he.a.TOP)k=Object($e.a)(k,1,0,d/2);else{var G=t.offsetAttribute===he.a.NONE?0:1;k=Object($e.a)(k,G)}B.applyOffset=new ga.a({componentDatatype:ue.a.UNSIGNED_BYTE,componentsPerAttribute:1,values:k})}return B}function yr(e){var t,a,i,r,n,o=new Array(e*(e+1)*12-6),s=0;for(t=0,i=1,r=0;r<3;r++)o[s++]=i++,o[s++]=t,o[s++]=i;for(r=2;r<e+1;++r){for(i=r*(r+1)-1,t=(r-1)*r-1,o[s++]=i++,o[s++]=t,o[s++]=i,a=2*r,n=0;n<a-1;++n)o[s++]=i,o[s++]=t++,o[s++]=t,o[s++]=i++,o[s++]=t,o[s++]=i;o[s++]=i++,o[s++]=t,o[s++]=i}for(a=2*e,++i,++t,r=0;r<a-1;++r)o[s++]=i,o[s++]=t++,o[s++]=t,o[s++]=i++,o[s++]=t,o[s++]=i;for(o[s++]=i,o[s++]=t++,o[s++]=t,o[s++]=i++,o[s++]=t++,o[s++]=t,++t,r=e-1;r>1;--r){for(o[s++]=t++,o[s++]=t,o[s++]=i,a=2*r,n=0;n<a-1;++n)o[s++]=i,o[s++]=t++,o[s++]=t,o[s++]=i++,o[s++]=t,o[s++]=i;o[s++]=t++,o[s++]=t++,o[s++]=i++}for(r=0;r<3;r++)o[s++]=t++,o[s++]=t,o[s++]=i;return o}var br=new y.default;var wr=new r.default,Or=new r.default;function xr(e){var t=e.center,a=e.ellipsoid,i=e.semiMajorAxis,n=y.default.multiplyByScalar(a.geodeticSurfaceNormal(t,ir),e.height,ir);wr.center=y.default.add(t,n,wr.center),wr.radius=i,n=y.default.multiplyByScalar(a.geodeticSurfaceNormal(t,n),e.extrudedHeight,n),Or.center=y.default.add(t,n,Or.center),Or.radius=i;var o=er.computeEllipsePositions(e,!0,!0),l=o.positions,u=o.numPts,d=o.outerPositions,f=r.default.union(wr,Or),c=vr(l,e,!0),h=yr(u),m=h.length;h.length=2*m;for(var p=l.length/3,_=0;_<m;_+=3)h[_+m]=h[_+2]+p,h[_+1+m]=h[_+1]+p,h[_+2+m]=h[_]+p;var g=ya.a.createTypedArray(2*p/3,h),b=new _a.a({attributes:c,indices:g,primitiveType:wa.a.TRIANGLES}),w=function(e,t){var a=t.vertexFormat,i=t.center,r=t.semiMajorAxis,n=t.semiMinorAxis,o=t.ellipsoid,l=t.height,u=t.extrudedHeight,d=t.stRotation,f=e.length/3*2,c=new Float64Array(3*f),h=a.st?new Float32Array(2*f):void 0,m=a.normal?new Float32Array(3*f):void 0,p=a.tangent?new Float32Array(3*f):void 0,_=a.bitangent?new Float32Array(3*f):void 0,g=t.shadowVolume,b=g?new Float32Array(3*f):void 0,w=0,O=fr,x=cr,C=hr,T=new tr.a(o),E=T.project(o.cartesianToCartographic(i,mr),pr),A=o.scaleToGeodeticSurface(i,ir);o.geodeticSurfaceNormal(A,A);for(var S=st.default.fromAxisAngle(A,d,dr),P=at.default.fromQuaternion(S,lr),D=v.default.fromElements(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,_r),I=v.default.fromElements(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,gr),M=e.length,F=M/3*2,R=0;R<M;R+=3){var N,L=R+1,j=R+2,V=y.default.fromArray(e,R,ir);if(a.st){var U=at.default.multiplyByVector(P,V,rr),z=T.project(o.cartesianToCartographic(U,mr),nr);y.default.subtract(z,E,z),sr.x=(z.x+r)/(2*r),sr.y=(z.y+n)/(2*n),D.x=Math.min(sr.x,D.x),D.y=Math.min(sr.y,D.y),I.x=Math.max(sr.x,I.x),I.y=Math.max(sr.y,I.y),h[w+F]=sr.x,h[w+1+F]=sr.y,h[w++]=sr.x,h[w++]=sr.y}V=o.scaleToGeodeticSurface(V,V),N=y.default.clone(V,rr),O=o.geodeticSurfaceNormal(V,O),g&&(b[R+M]=-O.x,b[L+M]=-O.y,b[j+M]=-O.z);var B=y.default.multiplyByScalar(O,l,or);if(V=y.default.add(V,B,V),B=y.default.multiplyByScalar(O,u,B),N=y.default.add(N,B,N),a.position&&(c[R+M]=N.x,c[L+M]=N.y,c[j+M]=N.z,c[R]=V.x,c[L]=V.y,c[j]=V.z),a.normal||a.tangent||a.bitangent){C=y.default.clone(O,C);var H=y.default.fromArray(e,(R+3)%M,or);y.default.subtract(H,V,H);var k=y.default.subtract(N,V,nr);O=y.default.normalize(y.default.cross(k,H,O),O),a.normal&&(m[R]=O.x,m[L]=O.y,m[j]=O.z,m[R+M]=O.x,m[L+M]=O.y,m[j+M]=O.z),a.tangent&&(x=y.default.normalize(y.default.cross(C,O,x),x),p[R]=x.x,p[L]=x.y,p[j]=x.z,p[R+M]=x.x,p[R+1+M]=x.y,p[R+2+M]=x.z),a.bitangent&&(_[R]=C.x,_[L]=C.y,_[j]=C.z,_[R+M]=C.x,_[L+M]=C.y,_[j+M]=C.z)}}if(a.st){M=h.length;for(var G=0;G<M;G+=2)h[G]=(h[G]-D.x)/(I.x-D.x),h[G+1]=(h[G+1]-D.y)/(I.y-D.y)}var W=new va.a;if(a.position&&(W.position=new ga.a({componentDatatype:ue.a.DOUBLE,componentsPerAttribute:3,values:c})),a.st&&(W.st=new ga.a({componentDatatype:ue.a.FLOAT,componentsPerAttribute:2,values:h})),a.normal&&(W.normal=new ga.a({componentDatatype:ue.a.FLOAT,componentsPerAttribute:3,values:m})),a.tangent&&(W.tangent=new ga.a({componentDatatype:ue.a.FLOAT,componentsPerAttribute:3,values:p})),a.bitangent&&(W.bitangent=new ga.a({componentDatatype:ue.a.FLOAT,componentsPerAttribute:3,values:_})),g&&(W.extrudeDirection=new ga.a({componentDatatype:ue.a.FLOAT,componentsPerAttribute:3,values:b})),Object(s.default)(t.offsetAttribute)){var Y=new Uint8Array(f);if(t.offsetAttribute===he.a.TOP)Y=Object($e.a)(Y,1,0,f/2);else{var X=t.offsetAttribute===he.a.NONE?0:1;Y=Object($e.a)(Y,X)}W.applyOffset=new ga.a({componentDatatype:ue.a.UNSIGNED_BYTE,componentsPerAttribute:1,values:Y})}return W}(d,e);h=function(e){for(var t=e.length/3,a=ya.a.createTypedArray(t,6*t),i=0,r=0;r<t;r++){var n=r,o=r+t,s=(n+1)%t,l=s+t;a[i++]=n,a[i++]=o,a[i++]=s,a[i++]=s,a[i++]=o,a[i++]=l}return a}(d);var O=ya.a.createTypedArray(2*d.length/3,h),x=new _a.a({attributes:w,indices:O,primitiveType:wa.a.TRIANGLES}),C=ar.a.combineInstances([new ce.a({geometry:b}),new ce.a({geometry:x})]);return{boundingSphere:f,attributes:C[0].attributes,indices:C[0].indices}}function Cr(e,t,a,i,r,n,o){for(var s=er.computeEllipsePositions({center:e,semiMajorAxis:t,semiMinorAxis:a,rotation:i,granularity:r},!1,!0).outerPositions,l=s.length/3,u=new Array(l),d=0;d<l;++d)u[d]=y.default.fromArray(s,3*d);var f=Oa.default.fromCartesianArray(u,n,o);return f.width>Ve.default.PI&&(f.north=f.north>0?Ve.default.PI_OVER_TWO-Ve.default.EPSILON7:f.north,f.south=f.south<0?Ve.default.EPSILON7-Ve.default.PI_OVER_TWO:f.south,f.east=Ve.default.PI,f.west=-Ve.default.PI),f}function Tr(e){var t=(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).center,a=Object(o.default)(e.ellipsoid,pa.default.WGS84),i=e.semiMajorAxis,r=e.semiMinorAxis,n=Object(o.default)(e.granularity,Ve.default.RADIANS_PER_DEGREE),s=Object(o.default)(e.vertexFormat,$.default.DEFAULT),l=Object(o.default)(e.height,0),u=Object(o.default)(e.extrudedHeight,l);this._center=y.default.clone(t),this._semiMajorAxis=i,this._semiMinorAxis=r,this._ellipsoid=pa.default.clone(a),this._rotation=Object(o.default)(e.rotation,0),this._stRotation=Object(o.default)(e.stRotation,0),this._height=Math.max(u,l),this._granularity=n,this._vertexFormat=$.default.clone(s),this._extrudedHeight=Math.min(u,l),this._shadowVolume=Object(o.default)(e.shadowVolume,!1),this._workerName="createEllipseGeometry",this._offsetAttribute=e.offsetAttribute,this._rectangle=void 0,this._textureCoordinateRotationPoints=void 0}Tr.packedLength=y.default.packedLength+pa.default.packedLength+$.default.packedLength+9,Tr.pack=function(e,t,a){return a=Object(o.default)(a,0),y.default.pack(e._center,t,a),a+=y.default.packedLength,pa.default.pack(e._ellipsoid,t,a),a+=pa.default.packedLength,$.default.pack(e._vertexFormat,t,a),a+=$.default.packedLength,t[a++]=e._semiMajorAxis,t[a++]=e._semiMinorAxis,t[a++]=e._rotation,t[a++]=e._stRotation,t[a++]=e._height,t[a++]=e._granularity,t[a++]=e._extrudedHeight,t[a++]=e._shadowVolume?1:0,t[a]=Object(o.default)(e._offsetAttribute,-1),t};var Er=new y.default,Ar=new pa.default,Sr=new $.default,Pr={center:Er,ellipsoid:Ar,vertexFormat:Sr,semiMajorAxis:void 0,semiMinorAxis:void 0,rotation:void 0,stRotation:void 0,height:void 0,granularity:void 0,extrudedHeight:void 0,shadowVolume:void 0,offsetAttribute:void 0};Tr.unpack=function(e,t,a){t=Object(o.default)(t,0);var i=y.default.unpack(e,t,Er);t+=y.default.packedLength;var r=pa.default.unpack(e,t,Ar);t+=pa.default.packedLength;var n=$.default.unpack(e,t,Sr);t+=$.default.packedLength;var l=e[t++],u=e[t++],d=e[t++],f=e[t++],c=e[t++],h=e[t++],m=e[t++],p=1===e[t++],_=e[t];return Object(s.default)(a)?(a._center=y.default.clone(i,a._center),a._ellipsoid=pa.default.clone(r,a._ellipsoid),a._vertexFormat=$.default.clone(n,a._vertexFormat),a._semiMajorAxis=l,a._semiMinorAxis=u,a._rotation=d,a._stRotation=f,a._height=c,a._granularity=h,a._extrudedHeight=m,a._shadowVolume=p,a._offsetAttribute=-1===_?void 0:_,a):(Pr.height=c,Pr.extrudedHeight=m,Pr.granularity=h,Pr.stRotation=f,Pr.rotation=d,Pr.semiMajorAxis=l,Pr.semiMinorAxis=u,Pr.shadowVolume=p,Pr.offsetAttribute=-1===_?void 0:_,new Tr(Pr))},Tr.computeRectangle=function(e,t){var a=(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).center,i=Object(o.default)(e.ellipsoid,pa.default.WGS84),r=e.semiMajorAxis,n=e.semiMinorAxis,s=Object(o.default)(e.granularity,Ve.default.RADIANS_PER_DEGREE);return Cr(a,r,n,Object(o.default)(e.rotation,0),s,i,t)},Tr.createGeometry=function(e){if(!(e._semiMajorAxis<=0||e._semiMinorAxis<=0)){var t=e._height,a=e._extrudedHeight,i=!Ve.default.equalsEpsilon(t,a,0,Ve.default.EPSILON2);e._center=e._ellipsoid.scaleToGeodeticSurface(e._center,e._center);var n,o={center:e._center,semiMajorAxis:e._semiMajorAxis,semiMinorAxis:e._semiMinorAxis,ellipsoid:e._ellipsoid,rotation:e._rotation,height:t,granularity:e._granularity,vertexFormat:e._vertexFormat,stRotation:e._stRotation};if(i)o.extrudedHeight=a,o.shadowVolume=e._shadowVolume,o.offsetAttribute=e._offsetAttribute,n=xr(o);else if(n=function(e){var t=e.center;br=y.default.multiplyByScalar(e.ellipsoid.geodeticSurfaceNormal(t,br),e.height,br),br=y.default.add(t,br,br);var a=new r.default(br,e.semiMajorAxis),i=er.computeEllipsePositions(e,!0,!1),n=i.positions,o=i.numPts,s=vr(n,e,!1),l=yr(o);return{boundingSphere:a,attributes:s,indices:l=ya.a.createTypedArray(n.length/3,l)}}(o),Object(s.default)(e._offsetAttribute)){var l=n.attributes.position.values.length,u=new Uint8Array(l/3),d=e._offsetAttribute===he.a.NONE?0:1;Object($e.a)(u,d),n.attributes.applyOffset=new ga.a({componentDatatype:ue.a.UNSIGNED_BYTE,componentsPerAttribute:1,values:u})}return new _a.a({attributes:n.attributes,indices:n.indices,primitiveType:wa.a.TRIANGLES,boundingSphere:n.boundingSphere,offsetAttribute:e._offsetAttribute})}},Tr.createShadowVolume=function(e,t,a){var i=e._granularity,r=e._ellipsoid,n=t(i,r),o=a(i,r);return new Tr({center:e._center,semiMajorAxis:e._semiMajorAxis,semiMinorAxis:e._semiMinorAxis,ellipsoid:r,rotation:e._rotation,stRotation:e._stRotation,granularity:i,extrudedHeight:n,height:o,vertexFormat:$.default.POSITION_ONLY,shadowVolume:!0})},Object(l.default)(Tr.prototype,{rectangle:{get:function(){return Object(s.default)(this._rectangle)||(this._rectangle=Cr(this._center,this._semiMajorAxis,this._semiMinorAxis,this._rotation,this._granularity,this._ellipsoid)),this._rectangle}},textureCoordinateRotationPoints:{get:function(){return Object(s.default)(this._textureCoordinateRotationPoints)||(this._textureCoordinateRotationPoints=function(e){var t=-e._stRotation;if(0===t)return[0,0,0,1,1,0];for(var a=er.computeEllipsePositions({center:e._center,semiMajorAxis:e._semiMajorAxis,semiMinorAxis:e._semiMinorAxis,rotation:e._rotation,granularity:e._granularity},!1,!0).outerPositions,i=a.length/3,r=new Array(i),n=0;n<i;++n)r[n]=y.default.fromArray(a,3*n);var o=e._ellipsoid,s=e.rectangle;return _a.a._textureCoordinateRotationPoints(r,t,o,s)}(this)),this._textureCoordinateRotationPoints}}});var Dr=Tr,Ir=new y.default,Mr=new y.default;var Fr=new r.default,Rr=new r.default;function Nr(e){var t=(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).center,a=Object(o.default)(e.ellipsoid,pa.default.WGS84),i=e.semiMajorAxis,r=e.semiMinorAxis,n=Object(o.default)(e.granularity,Ve.default.RADIANS_PER_DEGREE),s=Object(o.default)(e.height,0),l=Object(o.default)(e.extrudedHeight,s);this._center=y.default.clone(t),this._semiMajorAxis=i,this._semiMinorAxis=r,this._ellipsoid=pa.default.clone(a),this._rotation=Object(o.default)(e.rotation,0),this._height=Math.max(l,s),this._granularity=n,this._extrudedHeight=Math.min(l,s),this._numberOfVerticalLines=Math.max(Object(o.default)(e.numberOfVerticalLines,16),0),this._offsetAttribute=e.offsetAttribute,this._workerName="createEllipseOutlineGeometry"}Nr.packedLength=y.default.packedLength+pa.default.packedLength+8,Nr.pack=function(e,t,a){return a=Object(o.default)(a,0),y.default.pack(e._center,t,a),a+=y.default.packedLength,pa.default.pack(e._ellipsoid,t,a),a+=pa.default.packedLength,t[a++]=e._semiMajorAxis,t[a++]=e._semiMinorAxis,t[a++]=e._rotation,t[a++]=e._height,t[a++]=e._granularity,t[a++]=e._extrudedHeight,t[a++]=e._numberOfVerticalLines,t[a]=Object(o.default)(e._offsetAttribute,-1),t};var Lr=new y.default,jr=new pa.default,Vr={center:Lr,ellipsoid:jr,semiMajorAxis:void 0,semiMinorAxis:void 0,rotation:void 0,height:void 0,granularity:void 0,extrudedHeight:void 0,numberOfVerticalLines:void 0,offsetAttribute:void 0};Nr.unpack=function(e,t,a){t=Object(o.default)(t,0);var i=y.default.unpack(e,t,Lr);t+=y.default.packedLength;var r=pa.default.unpack(e,t,jr);t+=pa.default.packedLength;var n=e[t++],l=e[t++],u=e[t++],d=e[t++],f=e[t++],c=e[t++],h=e[t++],m=e[t];return Object(s.default)(a)?(a._center=y.default.clone(i,a._center),a._ellipsoid=pa.default.clone(r,a._ellipsoid),a._semiMajorAxis=n,a._semiMinorAxis=l,a._rotation=u,a._height=d,a._granularity=f,a._extrudedHeight=c,a._numberOfVerticalLines=h,a._offsetAttribute=-1===m?void 0:m,a):(Vr.height=d,Vr.extrudedHeight=c,Vr.granularity=f,Vr.rotation=u,Vr.semiMajorAxis=n,Vr.semiMinorAxis=l,Vr.numberOfVerticalLines=h,Vr.offsetAttribute=-1===m?void 0:m,new Nr(Vr))},Nr.createGeometry=function(e){if(!(e._semiMajorAxis<=0||e._semiMinorAxis<=0)){var t=e._height,a=e._extrudedHeight,i=!Ve.default.equalsEpsilon(t,a,0,Ve.default.EPSILON2);e._center=e._ellipsoid.scaleToGeodeticSurface(e._center,e._center);var n,l={center:e._center,semiMajorAxis:e._semiMajorAxis,semiMinorAxis:e._semiMinorAxis,ellipsoid:e._ellipsoid,rotation:e._rotation,height:t,granularity:e._granularity,numberOfVerticalLines:e._numberOfVerticalLines};if(i)l.extrudedHeight=a,l.offsetAttribute=e._offsetAttribute,n=function(e){var t=e.center,a=e.ellipsoid,i=e.semiMajorAxis,n=y.default.multiplyByScalar(a.geodeticSurfaceNormal(t,Ir),e.height,Ir);Fr.center=y.default.add(t,n,Fr.center),Fr.radius=i,n=y.default.multiplyByScalar(a.geodeticSurfaceNormal(t,n),e.extrudedHeight,n),Rr.center=y.default.add(t,n,Rr.center),Rr.radius=i;var l=er.computeEllipsePositions(e,!1,!0).outerPositions,u=new va.a({position:new ga.a({componentDatatype:ue.a.DOUBLE,componentsPerAttribute:3,values:er.raisePositionsToHeight(l,e,!0)})});l=u.position.values;var d=r.default.union(Fr,Rr),f=l.length/3;if(Object(s.default)(e.offsetAttribute)){var c=new Uint8Array(f);if(e.offsetAttribute===he.a.TOP)c=Object($e.a)(c,1,0,f/2);else{var h=e.offsetAttribute===he.a.NONE?0:1;c=Object($e.a)(c,h)}u.applyOffset=new ga.a({componentDatatype:ue.a.UNSIGNED_BYTE,componentsPerAttribute:1,values:c})}var m=Object(o.default)(e.numberOfVerticalLines,16);m=Ve.default.clamp(m,0,f/2);var p=ya.a.createTypedArray(f,2*f+2*m);f/=2;var _,g,v=0;for(_=0;_<f;++_)p[v++]=_,p[v++]=(_+1)%f,p[v++]=_+f,p[v++]=(_+1)%f+f;if(m>0){var b=Math.min(m,f);g=Math.round(f/b);var w=Math.min(g*m,f);for(_=0;_<w;_+=g)p[v++]=_,p[v++]=_+f}return{boundingSphere:d,attributes:u,indices:p}}(l);else if(n=function(e){var t=e.center;Mr=y.default.multiplyByScalar(e.ellipsoid.geodeticSurfaceNormal(t,Mr),e.height,Mr),Mr=y.default.add(t,Mr,Mr);for(var a=new r.default(Mr,e.semiMajorAxis),i=er.computeEllipsePositions(e,!1,!0).outerPositions,n=new va.a({position:new ga.a({componentDatatype:ue.a.DOUBLE,componentsPerAttribute:3,values:er.raisePositionsToHeight(i,e,!1)})}),o=i.length/3,s=ya.a.createTypedArray(o,2*o),l=0,u=0;u<o;++u)s[l++]=u,s[l++]=(u+1)%o;return{boundingSphere:a,attributes:n,indices:s}}(l),Object(s.default)(e._offsetAttribute)){var u=n.attributes.position.values.length,d=new Uint8Array(u/3),f=e._offsetAttribute===he.a.NONE?0:1;Object($e.a)(d,f),n.attributes.applyOffset=new ga.a({componentDatatype:ue.a.UNSIGNED_BYTE,componentsPerAttribute:1,values:d})}return new _a.a({attributes:n.attributes,indices:n.indices,primitiveType:wa.a.LINES,boundingSphere:n.boundingSphere,offsetAttribute:e._offsetAttribute})}};var Ur=Nr,zr=new b.default,Br=y.default.ZERO,Hr=new y.default,kr=new Oa.default;function Gr(e){this.id=e,this.vertexFormat=void 0,this.center=void 0,this.semiMajorAxis=void 0,this.semiMinorAxis=void 0,this.rotation=void 0,this.height=void 0,this.extrudedHeight=void 0,this.granularity=void 0,this.stRotation=void 0,this.numberOfVerticalLines=void 0,this.offsetAttribute=void 0}function Wr(e,t){oi.call(this,{entity:e,scene:t,geometryOptions:new Gr(e),geometryPropertyName:"ellipse",observedPropertyNames:["availability","position","ellipse"]}),this._onEntityPropertyChanged(e,"ellipse",e.ellipse,void 0)}function Yr(e,t,a){Oe.call(this,e,t,a)}Object(s.default)(Object.create)&&(Wr.prototype=Object.create(oi.prototype),Wr.prototype.constructor=Wr),Wr.prototype.createFillGeometryInstance=function(e){var t,a=this._entity,i=a.isAvailable(e),r={show:new _e.a(i&&a.isShowing&&this._showProperty.getValue(e)&&this._fillProperty.getValue(e)),distanceDisplayCondition:fe.fromDistanceDisplayCondition(this._distanceDisplayConditionProperty.getValue(e)),offset:void 0,color:void 0};this._materialProperty instanceof ge.default&&(Object(s.default)(this._materialProperty.color)&&(this._materialProperty.color.isConstant||i)&&(t=this._materialProperty.color.getValue(e,zr)),Object(s.default)(t)||(t=b.default.WHITE),r.color=le.a.fromColor(t));return Object(s.default)(this._options.offsetAttribute)&&(r.offset=pe.a.fromCartesian3(S.default.getValueOrDefault(this._terrainOffsetProperty,e,Br,Hr))),new ce.a({id:a,geometry:new Dr(this._options),attributes:r})},Wr.prototype.createOutlineGeometryInstance=function(e){var t=this._entity,a=t.isAvailable(e),i=S.default.getValueOrDefault(this._outlineColorProperty,e,b.default.BLACK,zr),r=this._distanceDisplayConditionProperty.getValue(e),n={show:new _e.a(a&&t.isShowing&&this._showProperty.getValue(e)&&this._showOutlineProperty.getValue(e)),color:le.a.fromColor(i),distanceDisplayCondition:fe.fromDistanceDisplayCondition(r),offset:void 0};return Object(s.default)(this._options.offsetAttribute)&&(n.offset=pe.a.fromCartesian3(S.default.getValueOrDefault(this._terrainOffsetProperty,e,Br,Hr))),new ce.a({id:t,geometry:new Ur(this._options),attributes:n})},Wr.prototype._computeCenter=function(e,t){return S.default.getValueOrUndefined(this._entity.position,e,t)},Wr.prototype._isHidden=function(e,t){var a=e.position;return!Object(s.default)(a)||!Object(s.default)(t.semiMajorAxis)||!Object(s.default)(t.semiMinorAxis)||Ne.prototype._isHidden.call(this,e,t)},Wr.prototype._isDynamic=function(e,t){return!e.position.isConstant||!t.semiMajorAxis.isConstant||!t.semiMinorAxis.isConstant||!S.default.isConstant(t.rotation)||!S.default.isConstant(t.height)||!S.default.isConstant(t.extrudedHeight)||!S.default.isConstant(t.granularity)||!S.default.isConstant(t.stRotation)||!S.default.isConstant(t.outlineWidth)||!S.default.isConstant(t.numberOfVerticalLines)||!S.default.isConstant(t.zIndex)||this._onTerrain&&!S.default.isConstant(this._materialProperty)},Wr.prototype._setStaticOptions=function(e,t){var a=S.default.getValueOrUndefined(t.height,me.default.MINIMUM_VALUE),r=S.default.getValueOrDefault(t.heightReference,me.default.MINIMUM_VALUE,C.default.NONE),n=S.default.getValueOrUndefined(t.extrudedHeight,me.default.MINIMUM_VALUE),o=S.default.getValueOrDefault(t.extrudedHeightReference,me.default.MINIMUM_VALUE,C.default.NONE);Object(s.default)(n)&&!Object(s.default)(a)&&(a=0);var l=this._options;l.vertexFormat=this._materialProperty instanceof ge.default?re.a.VERTEX_FORMAT:ie.MaterialSupport.TEXTURED.vertexFormat,l.center=e.position.getValue(me.default.MINIMUM_VALUE,l.center),l.semiMajorAxis=t.semiMajorAxis.getValue(me.default.MINIMUM_VALUE,l.semiMajorAxis),l.semiMinorAxis=t.semiMinorAxis.getValue(me.default.MINIMUM_VALUE,l.semiMinorAxis),l.rotation=S.default.getValueOrUndefined(t.rotation,me.default.MINIMUM_VALUE),l.granularity=S.default.getValueOrUndefined(t.granularity,me.default.MINIMUM_VALUE),l.stRotation=S.default.getValueOrUndefined(t.stRotation,me.default.MINIMUM_VALUE),l.numberOfVerticalLines=S.default.getValueOrUndefined(t.numberOfVerticalLines,me.default.MINIMUM_VALUE),l.offsetAttribute=oi.computeGeometryOffsetAttribute(a,r,n,o),l.height=oi.getGeometryHeight(a,r),(n=oi.getGeometryExtrudedHeight(n,o))===oi.CLAMP_TO_GROUND&&(n=i.a.getMinimumMaximumHeights(Dr.computeRectangle(l,kr)).minimumTerrainHeight),l.extrudedHeight=n},Wr.DynamicGeometryUpdater=Yr,Object(s.default)(Object.create)&&(Yr.prototype=Object.create(Oe.prototype),Yr.prototype.constructor=Yr),Yr.prototype._isHidden=function(e,t,a){var i=this._options;return!Object(s.default)(i.center)||!Object(s.default)(i.semiMajorAxis)||!Object(s.default)(i.semiMinorAxis)||Oe.prototype._isHidden.call(this,e,t,a)},Yr.prototype._setOptions=function(e,t,a){var r=this._options,n=S.default.getValueOrUndefined(t.height,a),o=S.default.getValueOrDefault(t.heightReference,a,C.default.NONE),l=S.default.getValueOrUndefined(t.extrudedHeight,a),u=S.default.getValueOrDefault(t.extrudedHeightReference,a,C.default.NONE);Object(s.default)(l)&&!Object(s.default)(n)&&(n=0),r.center=S.default.getValueOrUndefined(e.position,a,r.center),r.semiMajorAxis=S.default.getValueOrUndefined(t.semiMajorAxis,a),r.semiMinorAxis=S.default.getValueOrUndefined(t.semiMinorAxis,a),r.rotation=S.default.getValueOrUndefined(t.rotation,a),r.granularity=S.default.getValueOrUndefined(t.granularity,a),r.stRotation=S.default.getValueOrUndefined(t.stRotation,a),r.numberOfVerticalLines=S.default.getValueOrUndefined(t.numberOfVerticalLines,a),r.offsetAttribute=oi.computeGeometryOffsetAttribute(n,o,l,u),r.height=oi.getGeometryHeight(n,o),(l=oi.getGeometryExtrudedHeight(l,u))===oi.CLAMP_TO_GROUND&&(l=i.a.getMinimumMaximumHeights(Dr.computeRectangle(r,kr)).minimumTerrainHeight),r.extrudedHeight=l};var Xr=Wr,Qr=a(505),qr=a(635),Zr=new ge.default(b.default.WHITE),Kr=y.default.ZERO,Jr=new y.default,$r=new y.default,en=new y.default,tn=new b.default,an=new y.default(1,1,1);function rn(e){this.id=e,this.vertexFormat=void 0,this.radii=void 0,this.innerRadii=void 0,this.minimumClock=void 0,this.maximumClock=void 0,this.minimumCone=void 0,this.maximumCone=void 0,this.stackPartitions=void 0,this.slicePartitions=void 0,this.subdivisions=void 0,this.offsetAttribute=void 0}function nn(e,t){Ne.call(this,{entity:e,scene:t,geometryOptions:new rn(e),geometryPropertyName:"ellipsoid",observedPropertyNames:["availability","position","orientation","ellipsoid"]}),this._onEntityPropertyChanged(e,"ellipsoid",e.ellipsoid,void 0)}function on(e,t,a){Oe.call(this,e,t,a),this._scene=e._scene,this._modelMatrix=new ot.default,this._attributes=void 0,this._outlineAttributes=void 0,this._lastSceneMode=void 0,this._lastShow=void 0,this._lastOutlineShow=void 0,this._lastOutlineWidth=void 0,this._lastOutlineColor=void 0,this._lastOffset=new y.default,this._material={}}Object(s.default)(Object.create)&&(nn.prototype=Object.create(Ne.prototype),nn.prototype.constructor=nn),Object(l.default)(nn.prototype,{terrainOffsetProperty:{get:function(){return this._terrainOffsetProperty}}}),nn.prototype.createFillGeometryInstance=function(e,t,a){var i,r,n=this._entity,o=n.isAvailable(e),l=new _e.a(o&&n.isShowing&&this._showProperty.getValue(e)&&this._fillProperty.getValue(e)),u=this._distanceDisplayConditionProperty.getValue(e),d={show:l,distanceDisplayCondition:fe.fromDistanceDisplayCondition(u),color:void 0,offset:void 0};this._materialProperty instanceof ge.default&&(Object(s.default)(this._materialProperty.color)&&(this._materialProperty.color.isConstant||o)&&(r=this._materialProperty.color.getValue(e,tn)),Object(s.default)(r)||(r=b.default.WHITE),i=le.a.fromColor(r),d.color=i);return Object(s.default)(this._options.offsetAttribute)&&(d.offset=pe.a.fromCartesian3(S.default.getValueOrDefault(this._terrainOffsetProperty,e,Kr,Jr))),new ce.a({id:n,geometry:new Qr.a(this._options),modelMatrix:t?void 0:n.computeModelMatrixForHeightReference(e,n.ellipsoid.heightReference,.5*this._options.radii.z,this._scene.mapProjection.ellipsoid,a),attributes:d})},nn.prototype.createOutlineGeometryInstance=function(e,t,a){var i=this._entity,r=i.isAvailable(e),n=S.default.getValueOrDefault(this._outlineColorProperty,e,b.default.BLACK,tn),o=this._distanceDisplayConditionProperty.getValue(e),l={show:new _e.a(r&&i.isShowing&&this._showProperty.getValue(e)&&this._showOutlineProperty.getValue(e)),color:le.a.fromColor(n),distanceDisplayCondition:fe.fromDistanceDisplayCondition(o),offset:void 0};return Object(s.default)(this._options.offsetAttribute)&&(l.offset=pe.a.fromCartesian3(S.default.getValueOrDefault(this._terrainOffsetProperty,e,Kr,Jr))),new ce.a({id:i,geometry:new qr.a(this._options),modelMatrix:t?void 0:i.computeModelMatrixForHeightReference(e,i.ellipsoid.heightReference,.5*this._options.radii.z,this._scene.mapProjection.ellipsoid,a),attributes:l})},nn.prototype._computeCenter=function(e,t){return S.default.getValueOrUndefined(this._entity.position,e,t)},nn.prototype._isHidden=function(e,t){return!Object(s.default)(e.position)||!Object(s.default)(t.radii)||Ne.prototype._isHidden.call(this,e,t)},nn.prototype._isDynamic=function(e,t){return!(e.position.isConstant&&S.default.isConstant(e.orientation)&&t.radii.isConstant&&S.default.isConstant(t.innerRadii)&&S.default.isConstant(t.stackPartitions)&&S.default.isConstant(t.slicePartitions)&&S.default.isConstant(t.outlineWidth)&&S.default.isConstant(t.minimumClock)&&S.default.isConstant(t.maximumClock)&&S.default.isConstant(t.minimumCone)&&S.default.isConstant(t.maximumCone)&&S.default.isConstant(t.subdivisions))},nn.prototype._setStaticOptions=function(e,t){var a=S.default.getValueOrDefault(t.heightReference,me.default.MINIMUM_VALUE,C.default.NONE),i=this._options;i.vertexFormat=this._materialProperty instanceof ge.default?re.a.VERTEX_FORMAT:ie.MaterialSupport.TEXTURED.vertexFormat,i.radii=t.radii.getValue(me.default.MINIMUM_VALUE,i.radii),i.innerRadii=S.default.getValueOrUndefined(t.innerRadii,i.radii),i.minimumClock=S.default.getValueOrUndefined(t.minimumClock,me.default.MINIMUM_VALUE),i.maximumClock=S.default.getValueOrUndefined(t.maximumClock,me.default.MINIMUM_VALUE),i.minimumCone=S.default.getValueOrUndefined(t.minimumCone,me.default.MINIMUM_VALUE),i.maximumCone=S.default.getValueOrUndefined(t.maximumCone,me.default.MINIMUM_VALUE),i.stackPartitions=S.default.getValueOrUndefined(t.stackPartitions,me.default.MINIMUM_VALUE),i.slicePartitions=S.default.getValueOrUndefined(t.slicePartitions,me.default.MINIMUM_VALUE),i.subdivisions=S.default.getValueOrUndefined(t.subdivisions,me.default.MINIMUM_VALUE),i.offsetAttribute=a!==C.default.NONE?he.a.ALL:void 0},nn.prototype._onEntityPropertyChanged=Ge,nn.DynamicGeometryUpdater=on,Object(s.default)(Object.create)&&(on.prototype=Object.create(Oe.prototype),on.prototype.constructor=on),on.prototype.update=function(e){var t=this._entity,a=t.ellipsoid;if(!t.isShowing||!t.isAvailable(e)||!S.default.getValueOrDefault(a.show,e,!0))return Object(s.default)(this._primitive)&&(this._primitive.show=!1),void(Object(s.default)(this._outlinePrimitive)&&(this._outlinePrimitive.show=!1));var i=S.default.getValueOrUndefined(a.radii,e,$r),r=Object(s.default)(i)?t.computeModelMatrixForHeightReference(e,a.heightReference,.5*i.z,this._scene.mapProjection.ellipsoid,this._modelMatrix):void 0;if(!Object(s.default)(r)||!Object(s.default)(i))return Object(s.default)(this._primitive)&&(this._primitive.show=!1),void(Object(s.default)(this._outlinePrimitive)&&(this._outlinePrimitive.show=!1));var n=S.default.getValueOrDefault(a.fill,e,!0),l=S.default.getValueOrDefault(a.outline,e,!1),u=S.default.getValueOrClonedDefault(a.outlineColor,e,b.default.BLACK,tn),d=be.getValue(e,Object(o.default)(a.material,Zr),this._material),f=S.default.getValueOrUndefined(a.innerRadii,e,en),c=S.default.getValueOrUndefined(a.minimumClock,e),h=S.default.getValueOrUndefined(a.maximumClock,e),m=S.default.getValueOrUndefined(a.minimumCone,e),p=S.default.getValueOrUndefined(a.maximumCone,e),_=S.default.getValueOrUndefined(a.stackPartitions,e),g=S.default.getValueOrUndefined(a.slicePartitions,e),v=S.default.getValueOrUndefined(a.subdivisions,e),w=S.default.getValueOrDefault(a.outlineWidth,e,1),x=S.default.getValueOrDefault(a.heightReference,e,C.default.NONE),T=x!==C.default.NONE?he.a.ALL:void 0,E=this._scene.mode,A=E===Ue.a.SCENE3D&&x===C.default.NONE,P=this._options,D=this._geometryUpdater.shadowsProperty.getValue(e),I=this._geometryUpdater.distanceDisplayConditionProperty.getValue(e),M=S.default.getValueOrDefault(this._geometryUpdater.terrainOffsetProperty,e,Kr,Jr);if(!A||this._lastSceneMode!==E||!Object(s.default)(this._primitive)||P.stackPartitions!==_||P.slicePartitions!==g||Object(s.default)(f)&&!y.default.equals(P.innerRadii!==f)||P.minimumClock!==c||P.maximumClock!==h||P.minimumCone!==m||P.maximumCone!==p||P.subdivisions!==v||this._lastOutlineWidth!==w||P.offsetAttribute!==T){var F=this._primitives;if(F.removeAndDestroy(this._primitive),F.removeAndDestroy(this._outlinePrimitive),this._primitive=void 0,this._outlinePrimitive=void 0,this._lastSceneMode=E,this._lastOutlineWidth=w,P.stackPartitions=_,P.slicePartitions=g,P.subdivisions=v,P.offsetAttribute=T,P.radii=y.default.clone(A?an:i,P.radii),Object(s.default)(f))if(A){var R=y.default.magnitude(i);P.innerRadii=y.default.fromElements(f.x/R,f.y/R,f.z/R,P.innerRadii)}else P.innerRadii=y.default.clone(f,P.innerRadii);else P.innerRadii=void 0;P.minimumClock=c,P.maximumClock=h,P.minimumCone=m,P.maximumCone=p;var N=new ie({material:d,translucent:d.isTranslucent(),closed:!0});P.vertexFormat=N.vertexFormat;var L=this._geometryUpdater.createFillGeometryInstance(e,A,this._modelMatrix);this._primitive=F.add(new ve.a({geometryInstances:L,appearance:N,asynchronous:!1,shadows:D}));var j=this._geometryUpdater.createOutlineGeometryInstance(e,A,this._modelMatrix);this._outlinePrimitive=F.add(new ve.a({geometryInstances:j,appearance:new re.a({flat:!0,translucent:255!==j.attributes.color.value[3],renderState:{lineWidth:this._geometryUpdater._scene.clampLineWidth(w)}}),asynchronous:!1,shadows:D})),this._lastShow=n,this._lastOutlineShow=l,this._lastOutlineColor=b.default.clone(u,this._lastOutlineColor),this._lastDistanceDisplayCondition=I,this._lastOffset=y.default.clone(M,this._lastOffset)}else if(this._primitive.ready){var V=this._primitive,U=this._outlinePrimitive;V.show=!0,U.show=!0,V.appearance.material=d;var z=this._attributes;Object(s.default)(z)||(z=V.getGeometryInstanceAttributes(t),this._attributes=z),n!==this._lastShow&&(z.show=_e.a.toValue(n,z.show),this._lastShow=n);var B=this._outlineAttributes;Object(s.default)(B)||(B=U.getGeometryInstanceAttributes(t),this._outlineAttributes=B),l!==this._lastOutlineShow&&(B.show=_e.a.toValue(l,B.show),this._lastOutlineShow=l),b.default.equals(u,this._lastOutlineColor)||(B.color=le.a.toValue(u,B.color),b.default.clone(u,this._lastOutlineColor)),O.a.equals(I,this._lastDistanceDisplayCondition)||(z.distanceDisplayCondition=fe.toValue(I,z.distanceDisplayCondition),B.distanceDisplayCondition=fe.toValue(I,B.distanceDisplayCondition),O.a.clone(I,this._lastDistanceDisplayCondition)),y.default.equals(M,this._lastOffset)||(z.offset=pe.a.toValue(M,z.offset),B.offset=pe.a.toValue(M,z.offset),y.default.clone(M,this._lastOffset))}A&&(i.x=Math.max(i.x,.001),i.y=Math.max(i.y,.001),i.z=Math.max(i.z,.001),r=ot.default.multiplyByScale(r,i,r),this._primitive.modelMatrix=r,this._outlinePrimitive.modelMatrix=r)};var sn=nn;function ln(e){e=Object(o.default)(e,o.default.EMPTY_OBJECT);var t=Object(o.default)(e.vertexFormat,$.default.DEFAULT);this._vertexFormat=t,this._workerName="createPlaneGeometry"}ln.packedLength=$.default.packedLength,ln.pack=function(e,t,a){return a=Object(o.default)(a,0),$.default.pack(e._vertexFormat,t,a),t};var un=new $.default,dn={vertexFormat:un};ln.unpack=function(e,t,a){t=Object(o.default)(t,0);var i=$.default.unpack(e,t,un);return Object(s.default)(a)?(a._vertexFormat=$.default.clone(i,a._vertexFormat),a):new ln(dn)};var fn=new y.default(-.5,-.5,0),cn=new y.default(.5,.5,0);ln.createGeometry=function(e){var t,a,i=e._vertexFormat,n=new va.a;if(i.position){if((a=new Float64Array(12))[0]=fn.x,a[1]=fn.y,a[2]=0,a[3]=cn.x,a[4]=fn.y,a[5]=0,a[6]=cn.x,a[7]=cn.y,a[8]=0,a[9]=fn.x,a[10]=cn.y,a[11]=0,n.position=new ga.a({componentDatatype:ue.a.DOUBLE,componentsPerAttribute:3,values:a}),i.normal){var o=new Float32Array(12);o[0]=0,o[1]=0,o[2]=1,o[3]=0,o[4]=0,o[5]=1,o[6]=0,o[7]=0,o[8]=1,o[9]=0,o[10]=0,o[11]=1,n.normal=new ga.a({componentDatatype:ue.a.FLOAT,componentsPerAttribute:3,values:o})}if(i.st){var s=new Float32Array(8);s[0]=0,s[1]=0,s[2]=1,s[3]=0,s[4]=1,s[5]=1,s[6]=0,s[7]=1,n.st=new ga.a({componentDatatype:ue.a.FLOAT,componentsPerAttribute:2,values:s})}if(i.tangent){var l=new Float32Array(12);l[0]=1,l[1]=0,l[2]=0,l[3]=1,l[4]=0,l[5]=0,l[6]=1,l[7]=0,l[8]=0,l[9]=1,l[10]=0,l[11]=0,n.tangent=new ga.a({componentDatatype:ue.a.FLOAT,componentsPerAttribute:3,values:l})}if(i.bitangent){var u=new Float32Array(12);u[0]=0,u[1]=1,u[2]=0,u[3]=0,u[4]=1,u[5]=0,u[6]=0,u[7]=1,u[8]=0,u[9]=0,u[10]=1,u[11]=0,n.bitangent=new ga.a({componentDatatype:ue.a.FLOAT,componentsPerAttribute:3,values:u})}(t=new Uint16Array(6))[0]=0,t[1]=1,t[2]=2,t[3]=0,t[4]=2,t[5]=3}return new _a.a({attributes:n,indices:t,primitiveType:wa.a.TRIANGLES,boundingSphere:new r.default(y.default.ZERO,Math.sqrt(2))})};var hn=ln;function mn(){this._workerName="createPlaneOutlineGeometry"}mn.packedLength=0,mn.pack=function(e,t){return t},mn.unpack=function(e,t,a){return Object(s.default)(a)?a:new mn};var pn=new y.default(-.5,-.5,0),_n=new y.default(.5,.5,0);mn.createGeometry=function(){var e=new va.a,t=new Uint16Array(8),a=new Float64Array(12);return a[0]=pn.x,a[1]=pn.y,a[2]=pn.z,a[3]=_n.x,a[4]=pn.y,a[5]=pn.z,a[6]=_n.x,a[7]=_n.y,a[8]=pn.z,a[9]=pn.x,a[10]=_n.y,a[11]=pn.z,e.position=new ga.a({componentDatatype:ue.a.DOUBLE,componentsPerAttribute:3,values:a}),t[0]=0,t[1]=1,t[2]=1,t[3]=2,t[4]=2,t[5]=3,t[6]=3,t[7]=0,new _a.a({attributes:e,indices:t,primitiveType:wa.a.LINES,boundingSphere:new r.default(y.default.ZERO,Math.sqrt(2))})};var gn=mn,vn=new y.default,yn=new b.default;function bn(e){this.id=e,this.vertexFormat=void 0,this.plane=void 0,this.dimensions=void 0}function wn(e,t){Ne.call(this,{entity:e,scene:t,geometryOptions:new bn(e),geometryPropertyName:"plane",observedPropertyNames:["availability","position","orientation","plane"]}),this._onEntityPropertyChanged(e,"plane",e.plane,void 0)}function On(e,t,a){Oe.call(this,e,t,a)}Object(s.default)(Object.create)&&(wn.prototype=Object.create(Ne.prototype),wn.prototype.constructor=wn),wn.prototype.createFillGeometryInstance=function(e){var t,a,i=this._entity,r=i.isAvailable(e),n=new _e.a(r&&i.isShowing&&this._showProperty.getValue(e)&&this._fillProperty.getValue(e)),o=this._distanceDisplayConditionProperty.getValue(e),l=fe.fromDistanceDisplayCondition(o);this._materialProperty instanceof ge.default?(Object(s.default)(this._materialProperty.color)&&(this._materialProperty.color.isConstant||r)&&(a=this._materialProperty.color.getValue(e,yn)),Object(s.default)(a)||(a=b.default.WHITE),t={show:n,distanceDisplayCondition:l,color:le.a.fromColor(a)}):t={show:n,distanceDisplayCondition:l};var u=i.plane,d=this._options,f=i.computeModelMatrix(e),c=S.default.getValueOrDefault(u.plane,e,d.plane),h=S.default.getValueOrUndefined(u.dimensions,e,d.dimensions);return d.plane=c,d.dimensions=h,f=Dn(c,h,f,this._scene.mapProjection.ellipsoid,f),new ce.a({id:i,geometry:new hn(this._options),modelMatrix:f,attributes:t})},wn.prototype.createOutlineGeometryInstance=function(e){var t=this._entity,a=t.isAvailable(e),i=S.default.getValueOrDefault(this._outlineColorProperty,e,b.default.BLACK,yn),r=this._distanceDisplayConditionProperty.getValue(e),n=t.plane,o=this._options,s=t.computeModelMatrix(e),l=S.default.getValueOrDefault(n.plane,e,o.plane),u=S.default.getValueOrUndefined(n.dimensions,e,o.dimensions);return o.plane=l,o.dimensions=u,s=Dn(l,u,s,this._scene.mapProjection.ellipsoid,s),new ce.a({id:t,geometry:new gn,modelMatrix:s,attributes:{show:new _e.a(a&&t.isShowing&&this._showProperty.getValue(e)&&this._showOutlineProperty.getValue(e)),color:le.a.fromColor(i),distanceDisplayCondition:fe.fromDistanceDisplayCondition(r)}})},wn.prototype._isHidden=function(e,t){return!Object(s.default)(t.plane)||!Object(s.default)(t.dimensions)||!Object(s.default)(e.position)||Ne.prototype._isHidden.call(this,e,t)},wn.prototype._getIsClosed=function(e){return!1},wn.prototype._isDynamic=function(e,t){return!(e.position.isConstant&&S.default.isConstant(e.orientation)&&t.plane.isConstant&&t.dimensions.isConstant&&S.default.isConstant(t.outlineWidth))},wn.prototype._setStaticOptions=function(e,t){var a=this._materialProperty instanceof ge.default,i=this._options;i.vertexFormat=a?re.a.VERTEX_FORMAT:ie.MaterialSupport.TEXTURED.vertexFormat,i.plane=t.plane.getValue(me.default.MINIMUM_VALUE,i.plane),i.dimensions=t.dimensions.getValue(me.default.MINIMUM_VALUE,i.dimensions)},wn.DynamicGeometryUpdater=On,Object(s.default)(Object.create)&&(On.prototype=Object.create(Oe.prototype),On.prototype.constructor=On),On.prototype._isHidden=function(e,t,a){var i=this._options,r=S.default.getValueOrUndefined(e.position,a,vn);return!Object(s.default)(r)||!Object(s.default)(i.plane)||!Object(s.default)(i.dimensions)||Oe.prototype._isHidden.call(this,e,t,a)},On.prototype._setOptions=function(e,t,a){var i=this._options;i.plane=S.default.getValueOrDefault(t.plane,a,i.plane),i.dimensions=S.default.getValueOrUndefined(t.dimensions,a,i.dimensions)};var xn=new y.default,Cn=new y.default,Tn=new y.default,En=new y.default,An=new y.default,Sn=new st.default,Pn=new at.default;function Dn(e,t,a,i,r){var n=e.normal,o=e.distance,s=y.default.multiplyByScalar(n,-o,Tn);s=ot.default.multiplyByPoint(a,s,s);var l=ot.default.multiplyByPointAsVector(a,n,En);y.default.normalize(l,l);var u=i.geodeticSurfaceNormal(s,Cn);Ve.default.equalsEpsilon(Math.abs(y.default.dot(u,l)),1,Ve.default.EPSILON8)&&(u=y.default.clone(y.default.UNIT_Z,u),Ve.default.equalsEpsilon(Math.abs(y.default.dot(u,l)),1,Ve.default.EPSILON8)&&(u=y.default.clone(y.default.UNIT_X,u)));var d=y.default.cross(u,l,xn);u=y.default.cross(l,d,u),y.default.normalize(d,d),y.default.normalize(u,u);var f=Pn;at.default.setColumn(f,0,d,f),at.default.setColumn(f,1,u,f),at.default.setColumn(f,2,l,f);var c=st.default.fromRotationMatrix(f,Sn),h=v.default.clone(t,An);return h.z=1,ot.default.fromTranslationQuaternionRotationScale(s,c,h,r)}wn.createPrimitiveMatrix=Dn;var In=wn,Mn=a(153),Fn=a(120),Rn={},Nn=new y.default,Ln=new y.default,jn=new y.default,Vn=new y.default,Un=new Fn.a;function zn(e,t,a,i,r){var n=y.default.subtract(e,t,Nn),o=y.default.dot(a,n),s=y.default.dot(i,n);return v.default.fromElements(o,s,r)}Rn.validOutline=function(e){var t=Fn.a.fromPoints(e,Un).halfAxes,a=at.default.getColumn(t,0,Ln),i=at.default.getColumn(t,1,jn),r=at.default.getColumn(t,2,Vn),n=y.default.magnitude(a),o=y.default.magnitude(i),s=y.default.magnitude(r);return!(0===n&&(0===o||0===s)||0===o&&0===s)},Rn.computeProjectTo2DArguments=function(e,t,a,i){var r,n,o=Fn.a.fromPoints(e,Un),s=o.halfAxes,l=at.default.getColumn(s,0,Ln),u=at.default.getColumn(s,1,jn),d=at.default.getColumn(s,2,Vn),f=y.default.magnitude(l),c=y.default.magnitude(u),h=y.default.magnitude(d),m=Math.min(f,c,h);return(0!==f||0!==c&&0!==h)&&(0!==c||0!==h)&&(m!==c&&m!==h||(r=l),m===f?r=u:m===h&&(n=u),m!==f&&m!==c||(n=d),y.default.normalize(r,a),y.default.normalize(n,i),y.default.clone(o.center,t),!0)},Rn.createProjectPointsTo2DFunction=function(e,t,a){return function(i){for(var r=new Array(i.length),n=0;n<i.length;n++)r[n]=zn(i[n],e,t,a);return r}},Rn.createProjectPointTo2DFunction=function(e,t,a){return function(i,r){return zn(i,e,t,a,r)}};var Bn=Rn,Hn=a(274),kn=new y.default,Gn=new g.default,Wn=new v.default,Yn=new v.default,Xn=new y.default,Qn=new y.default,qn=new y.default,Zn=new y.default,Kn=new y.default,Jn=new y.default,$n=new st.default,eo=new at.default,to=new at.default,ao=new y.default;function io(e,t,a,i,r,n,o,s){var l=e.positions,u=ba.a.triangulate(e.positions2D,e.holes);u.length<3&&(u=[0,1,2]);var d=ya.a.createTypedArray(l.length,u.length);d.set(u);var f=eo;if(0!==i){var c=st.default.fromAxisAngle(n,i,$n);if(f=at.default.fromQuaternion(c,f),t.tangent||t.bitangent){c=st.default.fromAxisAngle(n,-i,$n);var h=at.default.fromQuaternion(c,to);o=y.default.normalize(at.default.multiplyByVector(h,o,o),o),t.bitangent&&(s=y.default.normalize(y.default.cross(n,o,s),s))}}else f=at.default.clone(at.default.IDENTITY,f);var m=Yn;t.st&&(m.x=a.x,m.y=a.y);for(var p=l.length,_=3*p,g=new Float64Array(_),b=t.normal?new Float32Array(_):void 0,w=t.tangent?new Float32Array(_):void 0,O=t.bitangent?new Float32Array(_):void 0,x=t.st?new Float32Array(2*p):void 0,C=0,T=0,E=0,A=0,S=0,P=0;P<p;P++){var D=l[P];if(g[C++]=D.x,g[C++]=D.y,g[C++]=D.z,t.st){var I=r(at.default.multiplyByVector(f,D,kn),Wn);v.default.subtract(I,m,I);var M=Ve.default.clamp(I.x/a.width,0,1),F=Ve.default.clamp(I.y/a.height,0,1);x[S++]=M,x[S++]=F}t.normal&&(b[T++]=n.x,b[T++]=n.y,b[T++]=n.z),t.tangent&&(w[A++]=o.x,w[A++]=o.y,w[A++]=o.z),t.bitangent&&(O[E++]=s.x,O[E++]=s.y,O[E++]=s.z)}var R=new va.a;return t.position&&(R.position=new ga.a({componentDatatype:ue.a.DOUBLE,componentsPerAttribute:3,values:g})),t.normal&&(R.normal=new ga.a({componentDatatype:ue.a.FLOAT,componentsPerAttribute:3,values:b})),t.tangent&&(R.tangent=new ga.a({componentDatatype:ue.a.FLOAT,componentsPerAttribute:3,values:w})),t.bitangent&&(R.bitangent=new ga.a({componentDatatype:ue.a.FLOAT,componentsPerAttribute:3,values:O})),t.st&&(R.st=new ga.a({componentDatatype:ue.a.FLOAT,componentsPerAttribute:2,values:x})),new _a.a({attributes:R,indices:d,primitiveType:wa.a.TRIANGLES})}function ro(e){var t=(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).polygonHierarchy,a=Object(o.default)(e.vertexFormat,$.default.DEFAULT);this._vertexFormat=$.default.clone(a),this._polygonHierarchy=t,this._stRotation=Object(o.default)(e.stRotation,0),this._ellipsoid=pa.default.clone(Object(o.default)(e.ellipsoid,pa.default.WGS84)),this._workerName="createCoplanarPolygonGeometry",this.packedLength=Hn.default.computeHierarchyPackedLength(t)+$.default.packedLength+pa.default.packedLength+2}ro.fromPositions=function(e){return new ro({polygonHierarchy:{positions:(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).positions},vertexFormat:e.vertexFormat,stRotation:e.stRotation,ellipsoid:e.ellipsoid})},ro.pack=function(e,t,a){return a=Object(o.default)(a,0),a=Hn.default.packPolygonHierarchy(e._polygonHierarchy,t,a),pa.default.pack(e._ellipsoid,t,a),a+=pa.default.packedLength,$.default.pack(e._vertexFormat,t,a),a+=$.default.packedLength,t[a++]=e._stRotation,t[a]=e.packedLength,t};var no=pa.default.clone(pa.default.UNIT_SPHERE),oo=new $.default,so={polygonHierarchy:{}};ro.unpack=function(e,t,a){t=Object(o.default)(t,0);var i=Hn.default.unpackPolygonHierarchy(e,t);t=i.startingIndex,delete i.startingIndex;var r=pa.default.unpack(e,t,no);t+=pa.default.packedLength;var n=$.default.unpack(e,t,oo);t+=$.default.packedLength;var l=e[t++],u=e[t];return Object(s.default)(a)||(a=new ro(so)),a._polygonHierarchy=i,a._ellipsoid=pa.default.clone(r,a._ellipsoid),a._vertexFormat=$.default.clone(n,a._vertexFormat),a._stRotation=l,a.packedLength=u,a},ro.createGeometry=function(e){var t=e._vertexFormat,a=e._polygonHierarchy,i=e._stRotation,n=a.positions;if(!((n=Object(et.a)(n,y.default.equalsEpsilon,!0)).length<3)){var o=Xn,s=Qn,l=qn,u=Kn,d=Jn;if(Bn.computeProjectTo2DArguments(n,Zn,u,d)){if(o=y.default.cross(u,d,o),o=y.default.normalize(o,o),!y.default.equalsEpsilon(Zn,y.default.ZERO,Ve.default.EPSILON6)){var f=e._ellipsoid.geodeticSurfaceNormal(Zn,ao);y.default.dot(o,f)<0&&(o=y.default.negate(o,o),u=y.default.negate(u,u))}var c=Bn.createProjectPointsTo2DFunction(Zn,u,d),h=Bn.createProjectPointTo2DFunction(Zn,u,d);t.tangent&&(s=y.default.clone(u,s)),t.bitangent&&(l=y.default.clone(d,l));var m=Hn.default.polygonsFromHierarchy(a,c,!1),p=m.hierarchy,_=m.polygons;if(0!==p.length){n=p[0].outerRing;for(var g=r.default.fromPoints(n),v=Hn.default.computeBoundingRectangle(o,h,n,i,Gn),b=[],w=0;w<_.length;w++){var O=new ce.a({geometry:io(_[w],t,v,i,h,o,s,l)});b.push(O)}var x=ar.a.combineInstances(b)[0];x.attributes.position.values=new Float64Array(x.attributes.position.values),x.indices=ya.a.createTypedArray(x.attributes.position.values.length/3,x.indices);var C=x.attributes;return t.position||delete C.position,new _a.a({attributes:C,indices:x.indices,primitiveType:x.primitiveType,boundingSphere:g})}}}};var lo=ro;function uo(e){for(var t=e.length,a=new Float64Array(3*t),i=ya.a.createTypedArray(t,2*t),r=0,n=0,o=0;o<t;o++){var s=e[o];a[r++]=s.x,a[r++]=s.y,a[r++]=s.z,i[n++]=o,i[n++]=(o+1)%t}var l=new va.a({position:new ga.a({componentDatatype:ue.a.DOUBLE,componentsPerAttribute:3,values:a})});return new _a.a({attributes:l,indices:i,primitiveType:wa.a.LINES})}function fo(e){var t=(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).polygonHierarchy;this._polygonHierarchy=t,this._workerName="createCoplanarPolygonOutlineGeometry",this.packedLength=Hn.default.computeHierarchyPackedLength(t)+1}fo.fromPositions=function(e){return new fo({polygonHierarchy:{positions:(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).positions}})},fo.pack=function(e,t,a){return a=Object(o.default)(a,0),t[a=Hn.default.packPolygonHierarchy(e._polygonHierarchy,t,a)]=e.packedLength,t};var co={polygonHierarchy:{}};fo.unpack=function(e,t,a){t=Object(o.default)(t,0);var i=Hn.default.unpackPolygonHierarchy(e,t);t=i.startingIndex,delete i.startingIndex;var r=e[t];return Object(s.default)(a)||(a=new fo(co)),a._polygonHierarchy=i,a.packedLength=r,a},fo.createGeometry=function(e){var t=e._polygonHierarchy,a=t.positions;if(!((a=Object(et.a)(a,y.default.equalsEpsilon,!0)).length<3)&&Bn.validOutline(a)){var i=Hn.default.polygonOutlinesFromHierarchy(t,!1);if(0!==i.length){for(var n=[],o=0;o<i.length;o++){var s=new ce.a({geometry:uo(i[o])});n.push(s)}var l=ar.a.combineInstances(n)[0],u=r.default.fromPoints(t.positions);return new _a.a({attributes:l.attributes,indices:l.indices,primitiveType:l.primitiveType,boundingSphere:u})}}};var ho=fo,mo=a(228),po=a(138),_o=new je.default,go=new je.default;function vo(e,t,a,i){var r=i.cartesianToCartographic(e,_o).height,n=i.cartesianToCartographic(t,go);n.height=r,i.cartographicToCartesian(n,t);var o=i.cartesianToCartographic(a,go);o.height=r-100,i.cartographicToCartesian(o,a)}var yo=new g.default,bo=new y.default,wo=new y.default,Oo=new y.default,xo=new y.default,Co=new y.default,To=new y.default,Eo=new y.default,Ao=new y.default,So=new y.default,Po=new v.default,Do=new v.default,Io=new y.default,Mo=new st.default,Fo=new at.default,Ro=new at.default;function No(e){var t=e.vertexFormat,a=e.geometry,i=e.shadowVolume,r=a.attributes.position.values,n=r.length,o=e.wall,l=e.top||o,u=e.bottom||o;if(t.st||t.normal||t.tangent||t.bitangent||i){var d=e.boundingRectangle,f=e.tangentPlane,c=e.ellipsoid,h=e.stRotation,m=e.perPositionHeight,p=Po;p.x=d.x,p.y=d.y;var _,g=t.st?new Float32Array(n/3*2):void 0;t.normal&&(_=m&&l&&!o?a.attributes.normal.values:new Float32Array(n));var b=t.tangent?new Float32Array(n):void 0,w=t.bitangent?new Float32Array(n):void 0,O=i?new Float32Array(n):void 0,x=0,C=0,T=wo,E=Oo,A=xo,S=!0,P=Fo,D=Ro;if(0!==h){var I=st.default.fromAxisAngle(f._plane.normal,h,Mo);P=at.default.fromQuaternion(I,P),I=st.default.fromAxisAngle(f._plane.normal,-h,Mo),D=at.default.fromQuaternion(I,D)}else P=at.default.clone(at.default.IDENTITY,P),D=at.default.clone(at.default.IDENTITY,D);var M=0,F=0;l&&u&&(M=n/2,F=n/3,n/=2);for(var R=0;R<n;R+=3){var N=y.default.fromArray(r,R,Io);if(t.st){var L=at.default.multiplyByVector(P,N,bo);L=c.scaleToGeodeticSurface(L,L);var j=f.projectPointOntoPlane(L,Do);v.default.subtract(j,p,j);var V=Ve.default.clamp(j.x/d.width,0,1),U=Ve.default.clamp(j.y/d.height,0,1);u&&(g[x+F]=V,g[x+1+F]=U),l&&(g[x]=V,g[x+1]=U),x+=2}if(t.normal||t.tangent||t.bitangent||i){var z=C+1,B=C+2;if(o){if(R+3<n){var H=y.default.fromArray(r,R+3,Co);if(S){var k=y.default.fromArray(r,R+n,To);m&&vo(N,H,k,c),y.default.subtract(H,N,H),y.default.subtract(k,N,k),T=y.default.normalize(y.default.cross(k,H,T),T),S=!1}y.default.equalsEpsilon(H,N,Ve.default.EPSILON10)&&(S=!0)}(t.tangent||t.bitangent)&&(A=c.geodeticSurfaceNormal(N,A),t.tangent&&(E=y.default.normalize(y.default.cross(A,T,E),E)))}else T=c.geodeticSurfaceNormal(N,T),(t.tangent||t.bitangent)&&(m&&(Eo=y.default.fromArray(_,C,Eo),Ao=y.default.cross(y.default.UNIT_Z,Eo,Ao),Ao=y.default.normalize(at.default.multiplyByVector(D,Ao,Ao),Ao),t.bitangent&&(So=y.default.normalize(y.default.cross(Eo,Ao,So),So))),E=y.default.cross(y.default.UNIT_Z,T,E),E=y.default.normalize(at.default.multiplyByVector(D,E,E),E),t.bitangent&&(A=y.default.normalize(y.default.cross(T,E,A),A)));t.normal&&(e.wall?(_[C+M]=T.x,_[z+M]=T.y,_[B+M]=T.z):u&&(_[C+M]=-T.x,_[z+M]=-T.y,_[B+M]=-T.z),(l&&!m||o)&&(_[C]=T.x,_[z]=T.y,_[B]=T.z)),i&&(o&&(T=c.geodeticSurfaceNormal(N,T)),O[C+M]=-T.x,O[z+M]=-T.y,O[B+M]=-T.z),t.tangent&&(e.wall?(b[C+M]=E.x,b[z+M]=E.y,b[B+M]=E.z):u&&(b[C+M]=-E.x,b[z+M]=-E.y,b[B+M]=-E.z),l&&(m?(b[C]=Ao.x,b[z]=Ao.y,b[B]=Ao.z):(b[C]=E.x,b[z]=E.y,b[B]=E.z))),t.bitangent&&(u&&(w[C+M]=A.x,w[z+M]=A.y,w[B+M]=A.z),l&&(m?(w[C]=So.x,w[z]=So.y,w[B]=So.z):(w[C]=A.x,w[z]=A.y,w[B]=A.z))),C+=3}}t.st&&(a.attributes.st=new ga.a({componentDatatype:ue.a.FLOAT,componentsPerAttribute:2,values:g})),t.normal&&(a.attributes.normal=new ga.a({componentDatatype:ue.a.FLOAT,componentsPerAttribute:3,values:_})),t.tangent&&(a.attributes.tangent=new ga.a({componentDatatype:ue.a.FLOAT,componentsPerAttribute:3,values:b})),t.bitangent&&(a.attributes.bitangent=new ga.a({componentDatatype:ue.a.FLOAT,componentsPerAttribute:3,values:w})),i&&(a.attributes.extrudeDirection=new ga.a({componentDatatype:ue.a.FLOAT,componentsPerAttribute:3,values:O}))}if(e.extrude&&Object(s.default)(e.offsetAttribute)){var G=r.length/3,W=new Uint8Array(G);if(e.offsetAttribute===he.a.TOP)l&&u||o?W=Object($e.a)(W,1,0,G/2):l&&(W=Object($e.a)(W,1));else{var Y=e.offsetAttribute===he.a.NONE?0:1;W=Object($e.a)(W,Y)}a.attributes.applyOffset=new ga.a({componentDatatype:ue.a.UNSIGNED_BYTE,componentsPerAttribute:1,values:W})}return a}var Lo=new je.default,jo=new je.default,Vo={westOverIDL:0,eastOverIDL:0},Uo=new mo.default;function zo(e,t,a,i,r){if(r=Object(o.default)(r,new Oa.default),!Object(s.default)(e)||e.length<3)return r.west=0,r.north=0,r.south=0,r.east=0,r;if(a===Mn.a.RHUMB)return Oa.default.fromCartesianArray(e,t,r);Uo.ellipsoid.equals(t)||(Uo=new mo.default(void 0,void 0,t)),r.west=Number.POSITIVE_INFINITY,r.east=Number.NEGATIVE_INFINITY,r.south=Number.POSITIVE_INFINITY,r.north=Number.NEGATIVE_INFINITY,Vo.westOverIDL=Number.POSITIVE_INFINITY,Vo.eastOverIDL=Number.NEGATIVE_INFINITY;for(var n,l=1/Ve.default.chordLength(i,t.maximumRadius),u=e.length,d=t.cartesianToCartographic(e[0],jo),f=Lo,c=1;c<u;c++)n=f,f=d,d=t.cartesianToCartographic(e[c],n),Uo.setEndPoints(f,d),Ho(Uo,l,r,Vo);return n=f,f=d,d=t.cartesianToCartographic(e[0],n),Uo.setEndPoints(f,d),Ho(Uo,l,r,Vo),r.east-r.west>Vo.eastOverIDL-Vo.westOverIDL&&(r.west=Vo.westOverIDL,r.east=Vo.eastOverIDL,r.east>Ve.default.PI&&(r.east=r.east-Ve.default.TWO_PI),r.west>Ve.default.PI&&(r.west=r.west-Ve.default.TWO_PI)),r}var Bo=new je.default;function Ho(e,t,a,i){for(var r=e.surfaceDistance,n=Math.ceil(r*t),o=n>0?r/(n-1):Number.POSITIVE_INFINITY,s=0,l=0;l<n;l++){var u=e.interpolateUsingSurfaceDistance(s,Bo);s+=o;var d=u.longitude,f=u.latitude;a.west=Math.min(a.west,d),a.east=Math.max(a.east,d),a.south=Math.min(a.south,f),a.north=Math.max(a.north,f);var c=d>=0?d:d+Ve.default.TWO_PI;i.westOverIDL=Math.min(i.westOverIDL,c),i.eastOverIDL=Math.max(i.eastOverIDL,c)}}var ko=[];function Go(e,t,a,i,r,n,o,s,l){var u,d={walls:[]};if(n||o){var f,c,h=Hn.default.createGeometryFromPositions(e,t,a,r,s,l),m=h.attributes.position.values,p=h.indices;if(n&&o){var _=m.concat(m);f=_.length/3,(c=ya.a.createTypedArray(f,2*p.length)).set(p);var g=p.length,v=f/2;for(u=0;u<g;u+=3){var y=c[u]+v,b=c[u+1]+v,w=c[u+2]+v;c[u+g]=w,c[u+1+g]=b,c[u+2+g]=y}if(h.attributes.position.values=_,r&&s.normal){var O=h.attributes.normal.values;h.attributes.normal.values=new Float32Array(_.length),h.attributes.normal.values.set(O)}h.indices=c}else if(o){for(f=m.length/3,c=ya.a.createTypedArray(f,p.length),u=0;u<p.length;u+=3)c[u]=p[u+2],c[u+1]=p[u+1],c[u+2]=p[u];h.indices=c}d.topAndBottom=new ce.a({geometry:h})}var x=i.outerRing,C=nt.default.fromPoints(x,e),T=C.projectPointsOntoPlane(x,ko),E=ba.a.computeWindingOrder2D(T);E===po.default.CLOCKWISE&&(x=x.slice().reverse());var A=Hn.default.computeWallGeometry(x,e,a,r,l);d.walls.push(new ce.a({geometry:A}));var S=i.holes;for(u=0;u<S.length;u++){var P=S[u];T=(C=nt.default.fromPoints(P,e)).projectPointsOntoPlane(P,ko),(E=ba.a.computeWindingOrder2D(T))===po.default.COUNTER_CLOCKWISE&&(P=P.slice().reverse()),A=Hn.default.computeWallGeometry(P,e,a,r,l),d.walls.push(new ce.a({geometry:A}))}return d}function Wo(e){var t=e.polygonHierarchy,a=Object(o.default)(e.vertexFormat,$.default.DEFAULT),i=Object(o.default)(e.ellipsoid,pa.default.WGS84),r=Object(o.default)(e.granularity,Ve.default.RADIANS_PER_DEGREE),n=Object(o.default)(e.stRotation,0),l=Object(o.default)(e.perPositionHeight,!1),u=l&&Object(s.default)(e.extrudedHeight),d=Object(o.default)(e.height,0),f=Object(o.default)(e.extrudedHeight,d);if(!u){var c=Math.max(d,f);f=Math.min(d,f),d=c}this._vertexFormat=$.default.clone(a),this._ellipsoid=pa.default.clone(i),this._granularity=r,this._stRotation=n,this._height=d,this._extrudedHeight=f,this._closeTop=Object(o.default)(e.closeTop,!0),this._closeBottom=Object(o.default)(e.closeBottom,!0),this._polygonHierarchy=t,this._perPositionHeight=l,this._perPositionHeightExtrude=u,this._shadowVolume=Object(o.default)(e.shadowVolume,!1),this._workerName="createPolygonGeometry",this._offsetAttribute=e.offsetAttribute,this._arcType=Object(o.default)(e.arcType,Mn.a.GEODESIC),this._rectangle=void 0,this._textureCoordinateRotationPoints=void 0,this.packedLength=Hn.default.computeHierarchyPackedLength(t)+pa.default.packedLength+$.default.packedLength+12}Wo.fromPositions=function(e){return new Wo({polygonHierarchy:{positions:(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).positions},height:e.height,extrudedHeight:e.extrudedHeight,vertexFormat:e.vertexFormat,stRotation:e.stRotation,ellipsoid:e.ellipsoid,granularity:e.granularity,perPositionHeight:e.perPositionHeight,closeTop:e.closeTop,closeBottom:e.closeBottom,offsetAttribute:e.offsetAttribute,arcType:e.arcType})},Wo.pack=function(e,t,a){return a=Object(o.default)(a,0),a=Hn.default.packPolygonHierarchy(e._polygonHierarchy,t,a),pa.default.pack(e._ellipsoid,t,a),a+=pa.default.packedLength,$.default.pack(e._vertexFormat,t,a),a+=$.default.packedLength,t[a++]=e._height,t[a++]=e._extrudedHeight,t[a++]=e._granularity,t[a++]=e._stRotation,t[a++]=e._perPositionHeightExtrude?1:0,t[a++]=e._perPositionHeight?1:0,t[a++]=e._closeTop?1:0,t[a++]=e._closeBottom?1:0,t[a++]=e._shadowVolume?1:0,t[a++]=Object(o.default)(e._offsetAttribute,-1),t[a++]=e._arcType,t[a]=e.packedLength,t};var Yo=pa.default.clone(pa.default.UNIT_SPHERE),Xo=new $.default,Qo={polygonHierarchy:{}};Wo.unpack=function(e,t,a){t=Object(o.default)(t,0);var i=Hn.default.unpackPolygonHierarchy(e,t);t=i.startingIndex,delete i.startingIndex;var r=pa.default.unpack(e,t,Yo);t+=pa.default.packedLength;var n=$.default.unpack(e,t,Xo);t+=$.default.packedLength;var l=e[t++],u=e[t++],d=e[t++],f=e[t++],c=1===e[t++],h=1===e[t++],m=1===e[t++],p=1===e[t++],_=1===e[t++],g=e[t++],v=e[t++],y=e[t];return Object(s.default)(a)||(a=new Wo(Qo)),a._polygonHierarchy=i,a._ellipsoid=pa.default.clone(r,a._ellipsoid),a._vertexFormat=$.default.clone(n,a._vertexFormat),a._height=l,a._extrudedHeight=u,a._granularity=d,a._stRotation=f,a._perPositionHeightExtrude=c,a._perPositionHeight=h,a._closeTop=m,a._closeBottom=p,a._shadowVolume=_,a._offsetAttribute=-1===g?void 0:g,a._arcType=v,a.packedLength=y,a},Wo.computeRectangle=function(e,t){var a=Object(o.default)(e.granularity,Ve.default.RADIANS_PER_DEGREE),i=Object(o.default)(e.arcType,Mn.a.GEODESIC),r=e.polygonHierarchy,n=Object(o.default)(e.ellipsoid,pa.default.WGS84);return zo(r.positions,n,i,a,t)},Wo.createGeometry=function(e){var t=e._vertexFormat,a=e._ellipsoid,i=e._granularity,n=e._stRotation,o=e._polygonHierarchy,l=e._perPositionHeight,u=e._closeTop,d=e._closeBottom,f=e._arcType,c=o.positions;if(!(c.length<3)){var h=nt.default.fromPoints(c,a),m=Hn.default.polygonsFromHierarchy(o,h.projectPointsOntoPlane.bind(h),!l,a),p=m.hierarchy,_=m.polygons;if(0!==p.length){c=p[0].outerRing;var g,v=Hn.default.computeBoundingRectangle(h.plane.normal,h.projectPointOntoPlane.bind(h),c,n,yo),y=[],b=e._height,w=e._extrudedHeight,O={perPositionHeight:l,vertexFormat:t,geometry:void 0,tangentPlane:h,boundingRectangle:v,ellipsoid:a,stRotation:n,bottom:!1,top:!0,wall:!1,extrude:!1,arcType:f};if(e._perPositionHeightExtrude||!Ve.default.equalsEpsilon(b,w,0,Ve.default.EPSILON2))for(O.extrude=!0,O.top=u,O.bottom=d,O.shadowVolume=e._shadowVolume,O.offsetAttribute=e._offsetAttribute,g=0;g<_.length;g++){var x,C=Go(a,_[g],i,p[g],l,u,d,t,f);u&&d?(x=C.topAndBottom,O.geometry=Hn.default.scaleToGeodeticHeightExtruded(x.geometry,b,w,a,l)):u?((x=C.topAndBottom).geometry.attributes.position.values=ba.a.scaleToGeodeticHeight(x.geometry.attributes.position.values,b,a,!l),O.geometry=x.geometry):d&&((x=C.topAndBottom).geometry.attributes.position.values=ba.a.scaleToGeodeticHeight(x.geometry.attributes.position.values,w,a,!0),O.geometry=x.geometry),(u||d)&&(O.wall=!1,x.geometry=No(O),y.push(x));var T=C.walls;O.wall=!0;for(var E=0;E<T.length;E++){var A=T[E];O.geometry=Hn.default.scaleToGeodeticHeightExtruded(A.geometry,b,w,a,l),A.geometry=No(O),y.push(A)}}else for(g=0;g<_.length;g++){var S=new ce.a({geometry:Hn.default.createGeometryFromPositions(a,_[g],i,l,t,f)});if(S.geometry.attributes.position.values=ba.a.scaleToGeodeticHeight(S.geometry.attributes.position.values,b,a,!l),O.geometry=S.geometry,S.geometry=No(O),Object(s.default)(e._offsetAttribute)){var P=S.geometry.attributes.position.values.length,D=new Uint8Array(P/3),I=e._offsetAttribute===he.a.NONE?0:1;Object($e.a)(D,I),S.geometry.attributes.applyOffset=new ga.a({componentDatatype:ue.a.UNSIGNED_BYTE,componentsPerAttribute:1,values:D})}y.push(S)}var M=ar.a.combineInstances(y)[0];M.attributes.position.values=new Float64Array(M.attributes.position.values),M.indices=ya.a.createTypedArray(M.attributes.position.values.length/3,M.indices);var F=M.attributes,R=r.default.fromVertices(F.position.values);return t.position||delete F.position,new _a.a({attributes:F,indices:M.indices,primitiveType:M.primitiveType,boundingSphere:R,offsetAttribute:e._offsetAttribute})}}},Wo.createShadowVolume=function(e,t,a){var i=e._granularity,r=e._ellipsoid,n=t(i,r),o=a(i,r);return new Wo({polygonHierarchy:e._polygonHierarchy,ellipsoid:r,stRotation:e._stRotation,granularity:i,perPositionHeight:!1,extrudedHeight:n,height:o,vertexFormat:$.default.POSITION_ONLY,shadowVolume:!0,arcType:e._arcType})},Object(l.default)(Wo.prototype,{rectangle:{get:function(){if(!Object(s.default)(this._rectangle)){var e=this._polygonHierarchy.positions;this._rectangle=zo(e,this._ellipsoid,this._arcType,this._granularity)}return this._rectangle}},textureCoordinateRotationPoints:{get:function(){return Object(s.default)(this._textureCoordinateRotationPoints)||(this._textureCoordinateRotationPoints=function(e){var t=-e._stRotation;if(0===t)return[0,0,0,1,1,0];var a=e._ellipsoid,i=e._polygonHierarchy.positions,r=e.rectangle;return _a.a._textureCoordinateRotationPoints(i,t,a,r)}(this)),this._textureCoordinateRotationPoints}}});var qo=Wo,Zo=[],Ko=[];function Jo(e,t,a,i,r){var n,o,s=nt.default.fromPoints(t,e).projectPointsOntoPlane(t,Zo);ba.a.computeWindingOrder2D(s)===po.default.CLOCKWISE&&(s.reverse(),t=t.slice().reverse());var l=t.length,u=0;if(i)for(n=new Float64Array(2*l*3),o=0;o<l;o++){var d=t[o],f=t[(o+1)%l];n[u++]=d.x,n[u++]=d.y,n[u++]=d.z,n[u++]=f.x,n[u++]=f.y,n[u++]=f.z}else{var c=0;if(r===Mn.a.GEODESIC)for(o=0;o<l;o++)c+=Hn.default.subdivideLineCount(t[o],t[(o+1)%l],a);else if(r===Mn.a.RHUMB)for(o=0;o<l;o++)c+=Hn.default.subdivideRhumbLineCount(e,t[o],t[(o+1)%l],a);for(n=new Float64Array(3*c),o=0;o<l;o++){var h;r===Mn.a.GEODESIC?h=Hn.default.subdivideLine(t[o],t[(o+1)%l],a,Ko):r===Mn.a.RHUMB&&(h=Hn.default.subdivideRhumbLine(e,t[o],t[(o+1)%l],a,Ko));for(var m=h.length,p=0;p<m;++p)n[u++]=h[p]}}var _=2*(l=n.length/3),g=ya.a.createTypedArray(l,_);for(u=0,o=0;o<l-1;o++)g[u++]=o,g[u++]=o+1;return g[u++]=l-1,g[u++]=0,new ce.a({geometry:new _a.a({attributes:new va.a({position:new ga.a({componentDatatype:ue.a.DOUBLE,componentsPerAttribute:3,values:n})}),indices:g,primitiveType:wa.a.LINES})})}function $o(e,t,a,i,r){var n,o,s=nt.default.fromPoints(t,e).projectPointsOntoPlane(t,Zo);ba.a.computeWindingOrder2D(s)===po.default.CLOCKWISE&&(s.reverse(),t=t.slice().reverse());var l=t.length,u=new Array(l),d=0;if(i)for(n=new Float64Array(2*l*3*2),o=0;o<l;++o){u[o]=d/3;var f=t[o],c=t[(o+1)%l];n[d++]=f.x,n[d++]=f.y,n[d++]=f.z,n[d++]=c.x,n[d++]=c.y,n[d++]=c.z}else{var h=0;if(r===Mn.a.GEODESIC)for(o=0;o<l;o++)h+=Hn.default.subdivideLineCount(t[o],t[(o+1)%l],a);else if(r===Mn.a.RHUMB)for(o=0;o<l;o++)h+=Hn.default.subdivideRhumbLineCount(e,t[o],t[(o+1)%l],a);for(n=new Float64Array(3*h*2),o=0;o<l;++o){var m;u[o]=d/3,r===Mn.a.GEODESIC?m=Hn.default.subdivideLine(t[o],t[(o+1)%l],a,Ko):r===Mn.a.RHUMB&&(m=Hn.default.subdivideRhumbLine(e,t[o],t[(o+1)%l],a,Ko));for(var p=m.length,_=0;_<p;++_)n[d++]=m[_]}}l=n.length/6;var g=u.length,v=2*(2*l+g),y=ya.a.createTypedArray(l+g,v);for(d=0,o=0;o<l;++o)y[d++]=o,y[d++]=(o+1)%l,y[d++]=o+l,y[d++]=(o+1)%l+l;for(o=0;o<g;o++){var b=u[o];y[d++]=b,y[d++]=b+l}return new ce.a({geometry:new _a.a({attributes:new va.a({position:new ga.a({componentDatatype:ue.a.DOUBLE,componentsPerAttribute:3,values:n})}),indices:y,primitiveType:wa.a.LINES})})}function es(e){var t=e.polygonHierarchy,a=Object(o.default)(e.ellipsoid,pa.default.WGS84),i=Object(o.default)(e.granularity,Ve.default.RADIANS_PER_DEGREE),r=Object(o.default)(e.perPositionHeight,!1),n=r&&Object(s.default)(e.extrudedHeight),l=Object(o.default)(e.arcType,Mn.a.GEODESIC),u=Object(o.default)(e.height,0),d=Object(o.default)(e.extrudedHeight,u);if(!n){var f=Math.max(u,d);d=Math.min(u,d),u=f}this._ellipsoid=pa.default.clone(a),this._granularity=i,this._height=u,this._extrudedHeight=d,this._arcType=l,this._polygonHierarchy=t,this._perPositionHeight=r,this._perPositionHeightExtrude=n,this._offsetAttribute=e.offsetAttribute,this._workerName="createPolygonOutlineGeometry",this.packedLength=Hn.default.computeHierarchyPackedLength(t)+pa.default.packedLength+8}es.pack=function(e,t,a){return a=Object(o.default)(a,0),a=Hn.default.packPolygonHierarchy(e._polygonHierarchy,t,a),pa.default.pack(e._ellipsoid,t,a),a+=pa.default.packedLength,t[a++]=e._height,t[a++]=e._extrudedHeight,t[a++]=e._granularity,t[a++]=e._perPositionHeightExtrude?1:0,t[a++]=e._perPositionHeight?1:0,t[a++]=e._arcType,t[a++]=Object(o.default)(e._offsetAttribute,-1),t[a]=e.packedLength,t};var ts=pa.default.clone(pa.default.UNIT_SPHERE),as={polygonHierarchy:{}};es.unpack=function(e,t,a){t=Object(o.default)(t,0);var i=Hn.default.unpackPolygonHierarchy(e,t);t=i.startingIndex,delete i.startingIndex;var r=pa.default.unpack(e,t,ts);t+=pa.default.packedLength;var n=e[t++],l=e[t++],u=e[t++],d=1===e[t++],f=1===e[t++],c=e[t++],h=e[t++],m=e[t];return Object(s.default)(a)||(a=new es(as)),a._polygonHierarchy=i,a._ellipsoid=pa.default.clone(r,a._ellipsoid),a._height=n,a._extrudedHeight=l,a._granularity=u,a._perPositionHeight=f,a._perPositionHeightExtrude=d,a._arcType=c,a._offsetAttribute=-1===h?void 0:h,a.packedLength=m,a},es.fromPositions=function(e){return new es({polygonHierarchy:{positions:(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).positions},height:e.height,extrudedHeight:e.extrudedHeight,ellipsoid:e.ellipsoid,granularity:e.granularity,perPositionHeight:e.perPositionHeight,arcType:e.arcType,offsetAttribute:e.offsetAttribute})},es.createGeometry=function(e){var t=e._ellipsoid,a=e._granularity,i=e._polygonHierarchy,n=e._perPositionHeight,o=e._arcType,l=Hn.default.polygonOutlinesFromHierarchy(i,!n,t);if(0!==l.length){var u,d,f,c=[],h=Ve.default.chordLength(a,t.maximumRadius),m=e._height,p=e._extrudedHeight;if(e._perPositionHeightExtrude||!Ve.default.equalsEpsilon(m,p,0,Ve.default.EPSILON2))for(f=0;f<l.length;f++){if((u=$o(t,l[f],h,n,o)).geometry=Hn.default.scaleToGeodeticHeightExtruded(u.geometry,m,p,t,n),Object(s.default)(e._offsetAttribute)){var _=u.geometry.attributes.position.values.length/3,g=new Uint8Array(_);e._offsetAttribute===he.a.TOP?g=Object($e.a)(g,1,0,_/2):(d=e._offsetAttribute===he.a.NONE?0:1,g=Object($e.a)(g,d)),u.geometry.attributes.applyOffset=new ga.a({componentDatatype:ue.a.UNSIGNED_BYTE,componentsPerAttribute:1,values:g})}c.push(u)}else for(f=0;f<l.length;f++){if((u=Jo(t,l[f],h,n,o)).geometry.attributes.position.values=ba.a.scaleToGeodeticHeight(u.geometry.attributes.position.values,m,t,!n),Object(s.default)(e._offsetAttribute)){var v=u.geometry.attributes.position.values.length,y=new Uint8Array(v/3);d=e._offsetAttribute===he.a.NONE?0:1,Object($e.a)(y,d),u.geometry.attributes.applyOffset=new ga.a({componentDatatype:ue.a.UNSIGNED_BYTE,componentsPerAttribute:1,values:y})}c.push(u)}var b=ar.a.combineInstances(c)[0],w=r.default.fromVertices(b.attributes.position.values);return new _a.a({attributes:b.attributes,indices:b.indices,primitiveType:b.primitiveType,boundingSphere:w,offsetAttribute:e._offsetAttribute})}};var is=es,rs=new b.default,ns=y.default.ZERO,os=new y.default,ss=new Oa.default,ls=[],us=new v.default;function ds(e){this.id=e,this.vertexFormat=void 0,this.polygonHierarchy=void 0,this.perPositionHeight=void 0,this.closeTop=void 0,this.closeBottom=void 0,this.height=void 0,this.extrudedHeight=void 0,this.granularity=void 0,this.stRotation=void 0,this.offsetAttribute=void 0,this.arcType=void 0}function fs(e,t){oi.call(this,{entity:e,scene:t,geometryOptions:new ds(e),geometryPropertyName:"polygon",observedPropertyNames:["availability","polygon"]}),this._onEntityPropertyChanged(e,"polygon",e.polygon,void 0)}function cs(e,t,a){Oe.call(this,e,t,a)}Object(s.default)(Object.create)&&(fs.prototype=Object.create(oi.prototype),fs.prototype.constructor=fs),fs.prototype.createFillGeometryInstance=function(e){var t,a,i=this._entity,r=i.isAvailable(e),n=this._options,o={show:new _e.a(r&&i.isShowing&&this._showProperty.getValue(e)&&this._fillProperty.getValue(e)),distanceDisplayCondition:fe.fromDistanceDisplayCondition(this._distanceDisplayConditionProperty.getValue(e)),offset:void 0,color:void 0};this._materialProperty instanceof ge.default&&(Object(s.default)(this._materialProperty.color)&&(this._materialProperty.color.isConstant||r)&&(t=this._materialProperty.color.getValue(e,rs)),Object(s.default)(t)||(t=b.default.WHITE),o.color=le.a.fromColor(t));return Object(s.default)(n.offsetAttribute)&&(o.offset=pe.a.fromCartesian3(S.default.getValueOrDefault(this._terrainOffsetProperty,e,ns,os))),a=n.perPositionHeight&&!Object(s.default)(n.extrudedHeight)?new lo(n):new qo(n),new ce.a({id:i,geometry:a,attributes:o})},fs.prototype.createOutlineGeometryInstance=function(e){var t,a=this._entity,i=a.isAvailable(e),r=this._options,n=S.default.getValueOrDefault(this._outlineColorProperty,e,b.default.BLACK,rs),o=this._distanceDisplayConditionProperty.getValue(e),l={show:new _e.a(i&&a.isShowing&&this._showProperty.getValue(e)&&this._showOutlineProperty.getValue(e)),color:le.a.fromColor(n),distanceDisplayCondition:fe.fromDistanceDisplayCondition(o),offset:void 0};return Object(s.default)(r.offsetAttribute)&&(l.offset=pe.a.fromCartesian3(S.default.getValueOrDefault(this._terrainOffsetProperty,e,ns,os))),t=r.perPositionHeight&&!Object(s.default)(r.extrudedHeight)?new ho(r):new is(r),new ce.a({id:a,geometry:t,attributes:l})},fs.prototype._computeCenter=function(e,t){var a=S.default.getValueOrUndefined(this._entity.polygon.hierarchy,e);if(Object(s.default)(a)){var i=a.positions;if(0!==i.length){for(var r=this._scene.mapProjection.ellipsoid,n=nt.default.fromPoints(i,r),o=n.projectPointsOntoPlane(i,ls),l=o.length,u=0,d=l-1,f=new v.default,c=0;c<l;d=c++){var h=o[c],m=o[d],p=h.x*m.y-m.x*h.y,_=v.default.add(h,m,us);_=v.default.multiplyByScalar(_,p,_),f=v.default.add(f,_,f),u+=p}var g=1/(3*u);return f=v.default.multiplyByScalar(f,g,f),n.projectPointOntoEllipsoid(f,t)}}},fs.prototype._isHidden=function(e,t){return!Object(s.default)(t.hierarchy)||Ne.prototype._isHidden.call(this,e,t)},fs.prototype._isOnTerrain=function(e,t){var a=oi.prototype._isOnTerrain.call(this,e,t),i=t.perPositionHeight,r=Object(s.default)(i)&&(!i.isConstant||i.getValue(me.default.MINIMUM_VALUE));return a&&!r},fs.prototype._isDynamic=function(e,t){return!t.hierarchy.isConstant||!S.default.isConstant(t.height)||!S.default.isConstant(t.extrudedHeight)||!S.default.isConstant(t.granularity)||!S.default.isConstant(t.stRotation)||!S.default.isConstant(t.outlineWidth)||!S.default.isConstant(t.perPositionHeight)||!S.default.isConstant(t.closeTop)||!S.default.isConstant(t.closeBottom)||!S.default.isConstant(t.zIndex)||!S.default.isConstant(t.arcType)||this._onTerrain&&!S.default.isConstant(this._materialProperty)},fs.prototype._setStaticOptions=function(e,t){var a=this._materialProperty instanceof ge.default,r=this._options;r.vertexFormat=a?re.a.VERTEX_FORMAT:ie.MaterialSupport.TEXTURED.vertexFormat;var n,o=t.hierarchy.getValue(me.default.MINIMUM_VALUE),l=S.default.getValueOrUndefined(t.height,me.default.MINIMUM_VALUE),u=S.default.getValueOrDefault(t.heightReference,me.default.MINIMUM_VALUE,C.default.NONE),d=S.default.getValueOrUndefined(t.extrudedHeight,me.default.MINIMUM_VALUE),f=S.default.getValueOrDefault(t.extrudedHeightReference,me.default.MINIMUM_VALUE,C.default.NONE),c=S.default.getValueOrDefault(t.perPositionHeight,me.default.MINIMUM_VALUE,!1);l=oi.getGeometryHeight(l,u),c?(Object(s.default)(l)&&(l=void 0,Object(xe.a)("Entity polygons cannot have both height and perPositionHeight.  height will be ignored")),u!==C.default.NONE&&c&&(l=void 0,Object(xe.a)("heightReference is not supported for entity polygons with perPositionHeight. heightReference will be ignored"))):(Object(s.default)(d)&&!Object(s.default)(l)&&(l=0),n=oi.computeGeometryOffsetAttribute(l,u,d,f)),r.polygonHierarchy=o,r.granularity=S.default.getValueOrUndefined(t.granularity,me.default.MINIMUM_VALUE),r.stRotation=S.default.getValueOrUndefined(t.stRotation,me.default.MINIMUM_VALUE),r.perPositionHeight=c,r.closeTop=S.default.getValueOrDefault(t.closeTop,me.default.MINIMUM_VALUE,!0),r.closeBottom=S.default.getValueOrDefault(t.closeBottom,me.default.MINIMUM_VALUE,!0),r.offsetAttribute=n,r.height=l,r.arcType=S.default.getValueOrDefault(t.arcType,me.default.MINIMUM_VALUE,Mn.a.GEODESIC),(d=oi.getGeometryExtrudedHeight(d,f))===oi.CLAMP_TO_GROUND&&(d=i.a.getMinimumMaximumHeights(qo.computeRectangle(r,ss)).minimumTerrainHeight),r.extrudedHeight=d},fs.prototype._getIsClosed=function(e){var t=e.height,a=e.extrudedHeight,i=Object(s.default)(a)&&a!==t;return!e.perPositionHeight&&(!i&&0===t||i&&e.closeTop&&e.closeBottom)},fs.DynamicGeometryUpdater=cs,Object(s.default)(Object.create)&&(cs.prototype=Object.create(Oe.prototype),cs.prototype.constructor=cs),cs.prototype._isHidden=function(e,t,a){return!Object(s.default)(this._options.polygonHierarchy)||Oe.prototype._isHidden.call(this,e,t,a)},cs.prototype._setOptions=function(e,t,a){var r=this._options;r.polygonHierarchy=S.default.getValueOrUndefined(t.hierarchy,a);var n,o=S.default.getValueOrUndefined(t.height,a),l=S.default.getValueOrDefault(t.heightReference,a,C.default.NONE),u=S.default.getValueOrDefault(t.extrudedHeightReference,a,C.default.NONE),d=S.default.getValueOrUndefined(t.extrudedHeight,a),f=S.default.getValueOrUndefined(t.perPositionHeight,a);o=oi.getGeometryHeight(o,u),f?(Object(s.default)(o)&&(o=void 0,Object(xe.a)("Entity polygons cannot have both height and perPositionHeight.  height will be ignored")),l!==C.default.NONE&&f&&(o=void 0,Object(xe.a)("heightReference is not supported for entity polygons with perPositionHeight. heightReference will be ignored"))):(Object(s.default)(d)&&!Object(s.default)(o)&&(o=0),n=oi.computeGeometryOffsetAttribute(o,l,d,u)),r.granularity=S.default.getValueOrUndefined(t.granularity,a),r.stRotation=S.default.getValueOrUndefined(t.stRotation,a),r.perPositionHeight=S.default.getValueOrUndefined(t.perPositionHeight,a),r.closeTop=S.default.getValueOrDefault(t.closeTop,a,!0),r.closeBottom=S.default.getValueOrDefault(t.closeBottom,a,!0),r.offsetAttribute=n,r.height=o,r.arcType=S.default.getValueOrDefault(t.arcType,a,Mn.a.GEODESIC),(d=oi.getGeometryExtrudedHeight(d,u))===oi.CLAMP_TO_GROUND&&(d=i.a.getMinimumMaximumHeights(qo.computeRectangle(r,ss)).minimumTerrainHeight),r.extrudedHeight=d};var hs=fs;function ms(e){var t=(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).polylinePositions,a=e.shapePositions;this._positions=t,this._shape=a,this._ellipsoid=pa.default.clone(Object(o.default)(e.ellipsoid,pa.default.WGS84)),this._cornerType=Object(o.default)(e.cornerType,tt.a.ROUNDED),this._vertexFormat=$.default.clone(Object(o.default)(e.vertexFormat,$.default.DEFAULT)),this._granularity=Object(o.default)(e.granularity,Ve.default.RADIANS_PER_DEGREE),this._workerName="createPolylineVolumeGeometry";var i=1+t.length*y.default.packedLength;i+=1+a.length*v.default.packedLength,this.packedLength=i+pa.default.packedLength+$.default.packedLength+2}ms.pack=function(e,t,a){var i;a=Object(o.default)(a,0);var r=e._positions,n=r.length;for(t[a++]=n,i=0;i<n;++i,a+=y.default.packedLength)y.default.pack(r[i],t,a);var s=e._shape;for(n=s.length,t[a++]=n,i=0;i<n;++i,a+=v.default.packedLength)v.default.pack(s[i],t,a);return pa.default.pack(e._ellipsoid,t,a),a+=pa.default.packedLength,$.default.pack(e._vertexFormat,t,a),a+=$.default.packedLength,t[a++]=e._cornerType,t[a]=e._granularity,t};var ps=pa.default.clone(pa.default.UNIT_SPHERE),_s=new $.default,gs={polylinePositions:void 0,shapePositions:void 0,ellipsoid:ps,vertexFormat:_s,cornerType:void 0,granularity:void 0};ms.unpack=function(e,t,a){var i;t=Object(o.default)(t,0);var r=e[t++],n=new Array(r);for(i=0;i<r;++i,t+=y.default.packedLength)n[i]=y.default.unpack(e,t);r=e[t++];var l=new Array(r);for(i=0;i<r;++i,t+=v.default.packedLength)l[i]=v.default.unpack(e,t);var u=pa.default.unpack(e,t,ps);t+=pa.default.packedLength;var d=$.default.unpack(e,t,_s);t+=$.default.packedLength;var f=e[t++],c=e[t];return Object(s.default)(a)?(a._positions=n,a._shape=l,a._ellipsoid=pa.default.clone(u,a._ellipsoid),a._vertexFormat=$.default.clone(d,a._vertexFormat),a._cornerType=f,a._granularity=c,a):(gs.polylinePositions=n,gs.shapePositions=l,gs.cornerType=f,gs.granularity=c,new ms(gs))};var vs=new g.default;ms.createGeometry=function(e){var t=e._positions,a=Object(et.a)(t,y.default.equalsEpsilon),i=e._shape;if(i=Gt.removeDuplicatesFromShape(i),!(a.length<2||i.length<3)){ba.a.computeWindingOrder2D(i)===po.default.CLOCKWISE&&i.reverse();var n=g.default.fromPoints(i,vs);return function(e,t,a,i){var n=new va.a;i.position&&(n.position=new ga.a({componentDatatype:ue.a.DOUBLE,componentsPerAttribute:3,values:e}));var o,s,l,u,d,f,c=t.length,h=e.length/3,m=(h-2*c)/(2*c),p=ba.a.triangulate(t),_=(m-1)*c*6+2*p.length,g=ya.a.createTypedArray(h,_),v=2*c,y=0;for(o=0;o<m-1;o++){for(s=0;s<c-1;s++)f=(l=2*s+o*c*2)+v,d=(u=l+1)+v,g[y++]=u,g[y++]=l,g[y++]=d,g[y++]=d,g[y++]=l,g[y++]=f;d=(u=(l=2*c-2+o*c*2)+1)+v,f=l+v,g[y++]=u,g[y++]=l,g[y++]=d,g[y++]=d,g[y++]=l,g[y++]=f}if(i.st||i.tangent||i.bitangent){var b,w,O=new Float32Array(2*h),x=1/(m-1),C=1/a.height,T=a.height/2,E=0;for(o=0;o<m;o++){for(b=o*x,w=C*(t[0].y+T),O[E++]=b,O[E++]=w,s=1;s<c;s++)w=C*(t[s].y+T),O[E++]=b,O[E++]=w,O[E++]=b,O[E++]=w;w=C*(t[0].y+T),O[E++]=b,O[E++]=w}for(s=0;s<c;s++)b=0,w=C*(t[s].y+T),O[E++]=b,O[E++]=w;for(s=0;s<c;s++)b=(m-1)*x,w=C*(t[s].y+T),O[E++]=b,O[E++]=w;n.st=new ga.a({componentDatatype:ue.a.FLOAT,componentsPerAttribute:2,values:new Float32Array(O)})}var A=h-2*c;for(o=0;o<p.length;o+=3){var S=p[o]+A,P=p[o+1]+A,D=p[o+2]+A;g[y++]=S,g[y++]=P,g[y++]=D,g[y++]=D+c,g[y++]=P+c,g[y++]=S+c}var I=new _a.a({attributes:n,indices:g,boundingSphere:r.default.fromVertices(e),primitiveType:wa.a.TRIANGLES});if(i.normal&&(I=ar.a.computeNormal(I)),i.tangent||i.bitangent){try{I=ar.a.computeTangentAndBitangent(I)}catch(e){Object(xe.a)("polyline-volume-tangent-bitangent","Unable to compute tangents and bitangents for polyline volume geometry")}i.tangent||(I.attributes.tangent=void 0),i.bitangent||(I.attributes.bitangent=void 0),i.st||(I.attributes.st=void 0)}return I}(Gt.computePositions(a,i,n,e,!0),i,n,e._vertexFormat)}};var ys=ms;function bs(e){var t=(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).polylinePositions,a=e.shapePositions;this._positions=t,this._shape=a,this._ellipsoid=pa.default.clone(Object(o.default)(e.ellipsoid,pa.default.WGS84)),this._cornerType=Object(o.default)(e.cornerType,tt.a.ROUNDED),this._granularity=Object(o.default)(e.granularity,Ve.default.RADIANS_PER_DEGREE),this._workerName="createPolylineVolumeOutlineGeometry";var i=1+t.length*y.default.packedLength;i+=1+a.length*v.default.packedLength,this.packedLength=i+pa.default.packedLength+2}bs.pack=function(e,t,a){var i;a=Object(o.default)(a,0);var r=e._positions,n=r.length;for(t[a++]=n,i=0;i<n;++i,a+=y.default.packedLength)y.default.pack(r[i],t,a);var s=e._shape;for(n=s.length,t[a++]=n,i=0;i<n;++i,a+=v.default.packedLength)v.default.pack(s[i],t,a);return pa.default.pack(e._ellipsoid,t,a),a+=pa.default.packedLength,t[a++]=e._cornerType,t[a]=e._granularity,t};var ws=pa.default.clone(pa.default.UNIT_SPHERE),Os={polylinePositions:void 0,shapePositions:void 0,ellipsoid:ws,height:void 0,cornerType:void 0,granularity:void 0};bs.unpack=function(e,t,a){var i;t=Object(o.default)(t,0);var r=e[t++],n=new Array(r);for(i=0;i<r;++i,t+=y.default.packedLength)n[i]=y.default.unpack(e,t);r=e[t++];var l=new Array(r);for(i=0;i<r;++i,t+=v.default.packedLength)l[i]=v.default.unpack(e,t);var u=pa.default.unpack(e,t,ws);t+=pa.default.packedLength;var d=e[t++],f=e[t];return Object(s.default)(a)?(a._positions=n,a._shape=l,a._ellipsoid=pa.default.clone(u,a._ellipsoid),a._cornerType=d,a._granularity=f,a):(Os.polylinePositions=n,Os.shapePositions=l,Os.cornerType=d,Os.granularity=f,new bs(Os))};var xs=new g.default;bs.createGeometry=function(e){var t=e._positions,a=Object(et.a)(t,y.default.equalsEpsilon),i=e._shape;if(i=Gt.removeDuplicatesFromShape(i),!(a.length<2||i.length<3)){ba.a.computeWindingOrder2D(i)===po.default.CLOCKWISE&&i.reverse();var n=g.default.fromPoints(i,xs);return function(e,t){var a=new va.a;a.position=new ga.a({componentDatatype:ue.a.DOUBLE,componentsPerAttribute:3,values:e});var i,n,o=t.length,s=a.position.values.length/3,l=e.length/3/o,u=ya.a.createTypedArray(s,2*o*(l+1)),d=0,f=(i=0)*o;for(n=0;n<o-1;n++)u[d++]=n+f,u[d++]=n+f+1;for(u[d++]=o-1+f,u[d++]=f,f=(i=l-1)*o,n=0;n<o-1;n++)u[d++]=n+f,u[d++]=n+f+1;for(u[d++]=o-1+f,u[d++]=f,i=0;i<l-1;i++){var c=o*i,h=c+o;for(n=0;n<o;n++)u[d++]=n+c,u[d++]=n+h}return new _a.a({attributes:a,indices:ya.a.createTypedArray(s,u),boundingSphere:r.default.fromVertices(e),primitiveType:wa.a.LINES})}(Gt.computePositions(a,i,n,e,!1),i)}};var Cs=bs,Ts=new b.default;function Es(e){this.id=e,this.vertexFormat=void 0,this.polylinePositions=void 0,this.shapePositions=void 0,this.cornerType=void 0,this.granularity=void 0}function As(e,t){Ne.call(this,{entity:e,scene:t,geometryOptions:new Es(e),geometryPropertyName:"polylineVolume",observedPropertyNames:["availability","polylineVolume"]}),this._onEntityPropertyChanged(e,"polylineVolume",e.polylineVolume,void 0)}function Ss(e,t,a){Oe.call(this,e,t,a)}Object(s.default)(Object.create)&&(As.prototype=Object.create(Ne.prototype),As.prototype.constructor=As),As.prototype.createFillGeometryInstance=function(e){var t,a,i=this._entity,r=i.isAvailable(e),n=new _e.a(r&&i.isShowing&&this._showProperty.getValue(e)&&this._fillProperty.getValue(e)),o=this._distanceDisplayConditionProperty.getValue(e),l=fe.fromDistanceDisplayCondition(o);this._materialProperty instanceof ge.default?(Object(s.default)(this._materialProperty.color)&&(this._materialProperty.color.isConstant||r)&&(a=this._materialProperty.color.getValue(e,Ts)),Object(s.default)(a)||(a=b.default.WHITE),t={show:n,distanceDisplayCondition:l,color:le.a.fromColor(a)}):t={show:n,distanceDisplayCondition:l};return new ce.a({id:i,geometry:new ys(this._options),attributes:t})},As.prototype.createOutlineGeometryInstance=function(e){var t=this._entity,a=t.isAvailable(e),i=S.default.getValueOrDefault(this._outlineColorProperty,e,b.default.BLACK,Ts),r=this._distanceDisplayConditionProperty.getValue(e);return new ce.a({id:t,geometry:new Cs(this._options),attributes:{show:new _e.a(a&&t.isShowing&&this._showProperty.getValue(e)&&this._showOutlineProperty.getValue(e)),color:le.a.fromColor(i),distanceDisplayCondition:fe.fromDistanceDisplayCondition(r)}})},As.prototype._isHidden=function(e,t){return!Object(s.default)(t.positions)||!Object(s.default)(t.shape)||Ne.prototype._isHidden.call(this,e,t)},As.prototype._isDynamic=function(e,t){return!(t.positions.isConstant&&t.shape.isConstant&&S.default.isConstant(t.granularity)&&S.default.isConstant(t.outlineWidth)&&S.default.isConstant(t.cornerType))},As.prototype._setStaticOptions=function(e,t){var a=t.granularity,i=t.cornerType,r=this._options,n=this._materialProperty instanceof ge.default;r.vertexFormat=n?re.a.VERTEX_FORMAT:ie.MaterialSupport.TEXTURED.vertexFormat,r.polylinePositions=t.positions.getValue(me.default.MINIMUM_VALUE,r.polylinePositions),r.shapePositions=t.shape.getValue(me.default.MINIMUM_VALUE,r.shape),r.granularity=Object(s.default)(a)?a.getValue(me.default.MINIMUM_VALUE):void 0,r.cornerType=Object(s.default)(i)?i.getValue(me.default.MINIMUM_VALUE):void 0},As.DynamicGeometryUpdater=Ss,Object(s.default)(Object.create)&&(Ss.prototype=Object.create(Oe.prototype),Ss.prototype.constructor=Ss),Ss.prototype._isHidden=function(e,t,a){var i=this._options;return!Object(s.default)(i.polylinePositions)||!Object(s.default)(i.shapePositions)||Oe.prototype._isHidden.call(this,e,t,a)},Ss.prototype._setOptions=function(e,t,a){var i=this._options;i.polylinePositions=S.default.getValueOrUndefined(t.positions,a,i.polylinePositions),i.shapePositions=S.default.getValueOrUndefined(t.shape,a),i.granularity=S.default.getValueOrUndefined(t.granularity,a),i.cornerType=S.default.getValueOrUndefined(t.cornerType,a)};var Ps=As,Ds=a(183),Is=a(634),Ms=new y.default,Fs=new y.default,Rs=new y.default,Ns=new y.default,Ls=new Oa.default,js=new v.default,Vs=new r.default,Us=new r.default;function zs(e,t){var a=new _a.a({attributes:new va.a,primitiveType:wa.a.TRIANGLES});return a.attributes.position=new ga.a({componentDatatype:ue.a.DOUBLE,componentsPerAttribute:3,values:t.positions}),e.normal&&(a.attributes.normal=new ga.a({componentDatatype:ue.a.FLOAT,componentsPerAttribute:3,values:t.normals})),e.tangent&&(a.attributes.tangent=new ga.a({componentDatatype:ue.a.FLOAT,componentsPerAttribute:3,values:t.tangents})),e.bitangent&&(a.attributes.bitangent=new ga.a({componentDatatype:ue.a.FLOAT,componentsPerAttribute:3,values:t.bitangents})),a}var Bs=new y.default,Hs=new y.default;function ks(e,t){var a=e._vertexFormat,i=e._ellipsoid,r=t.height,n=t.width,o=t.northCap,s=t.southCap,l=0,u=r,d=r,f=0;o&&(l=1,d-=1,f+=1),s&&(u-=1,d-=1,f+=1),f+=n*d;for(var c=a.position?new Float64Array(3*f):void 0,h=a.st?new Float32Array(2*f):void 0,m=0,p=0,_=Ms,g=js,v=Number.MAX_VALUE,b=Number.MAX_VALUE,w=-Number.MAX_VALUE,O=-Number.MAX_VALUE,x=l;x<u;++x)for(var C=0;C<n;++C)Is.a.computePosition(t,i,a.st,x,C,_,g),c[m++]=_.x,c[m++]=_.y,c[m++]=_.z,a.st&&(h[p++]=g.x,h[p++]=g.y,v=Math.min(v,g.x),b=Math.min(b,g.y),w=Math.max(w,g.x),O=Math.max(O,g.y));if(o&&(Is.a.computePosition(t,i,a.st,0,0,_,g),c[m++]=_.x,c[m++]=_.y,c[m++]=_.z,a.st&&(h[p++]=g.x,h[p++]=g.y,v=g.x,b=g.y,w=g.x,O=g.y)),s&&(Is.a.computePosition(t,i,a.st,r-1,0,_,g),c[m++]=_.x,c[m++]=_.y,c[m]=_.z,a.st&&(h[p++]=g.x,h[p]=g.y,v=Math.min(v,g.x),b=Math.min(b,g.y),w=Math.max(w,g.x),O=Math.max(O,g.y))),a.st&&(v<0||b<0||w>1||O>1))for(var T=0;T<h.length;T+=2)h[T]=(h[T]-v)/(w-v),h[T+1]=(h[T+1]-b)/(O-b);var E=function(e,t,a,i){var r=e.length,n=t.normal?new Float32Array(r):void 0,o=t.tangent?new Float32Array(r):void 0,s=t.bitangent?new Float32Array(r):void 0,l=0,u=Ns,d=Rs,f=Fs;if(t.normal||t.tangent||t.bitangent)for(var c=0;c<r;c+=3){var h=y.default.fromArray(e,c,Ms),m=l+1,p=l+2;f=a.geodeticSurfaceNormal(h,f),(t.tangent||t.bitangent)&&(y.default.cross(y.default.UNIT_Z,f,d),at.default.multiplyByVector(i,d,d),y.default.normalize(d,d),t.bitangent&&y.default.normalize(y.default.cross(f,d,u),u)),t.normal&&(n[l]=f.x,n[m]=f.y,n[p]=f.z),t.tangent&&(o[l]=d.x,o[m]=d.y,o[p]=d.z),t.bitangent&&(s[l]=u.x,s[m]=u.y,s[p]=u.z),l+=3}return zs(t,{positions:e,normals:n,tangents:o,bitangents:s})}(c,a,i,t.tangentRotationMatrix),A=6*(n-1)*(d-1);o&&(A+=3*(n-1)),s&&(A+=3*(n-1));var S,P=ya.a.createTypedArray(f,A),D=0,I=0;for(S=0;S<d-1;++S){for(var M=0;M<n-1;++M){var F=D,R=F+n,N=R+1,L=F+1;P[I++]=F,P[I++]=R,P[I++]=L,P[I++]=L,P[I++]=R,P[I++]=N,++D}++D}if(o||s){var j,V,U=f-1,z=f-1;if(o&&s&&(U=f-2),D=0,o)for(S=0;S<n-1;S++)V=(j=D)+1,P[I++]=U,P[I++]=j,P[I++]=V,++D;if(s)for(D=(d-1)*n,S=0;S<n-1;S++)V=(j=D)+1,P[I++]=j,P[I++]=z,P[I++]=V,++D}return E.indices=P,a.st&&(E.attributes.st=new ga.a({componentDatatype:ue.a.FLOAT,componentsPerAttribute:2,values:h})),E}function Gs(e,t,a,i,r){return e[t++]=i[a],e[t++]=i[a+1],e[t++]=i[a+2],e[t++]=r[a],e[t++]=r[a+1],e[t]=r[a+2],e}function Ws(e,t,a,i){return e[t++]=i[a],e[t++]=i[a+1],e[t++]=i[a],e[t]=i[a+1],e}var Ys=new $.default;function Xs(e,t){var a,i=e._shadowVolume,r=e._offsetAttribute,n=e._vertexFormat,o=e._extrudedHeight,l=e._surfaceHeight,u=e._ellipsoid,d=t.height,f=t.width;if(i){var c=$.default.clone(n,Ys);c.normal=!0,e._vertexFormat=c}var h=ks(e,t);i&&(e._vertexFormat=n);var m=ba.a.scaleToGeodeticHeight(h.attributes.position.values,l,u,!1),p=(m=new Float64Array(m)).length,_=2*p,g=new Float64Array(_);g.set(m);var v=ba.a.scaleToGeodeticHeight(h.attributes.position.values,o,u);g.set(v,p),h.attributes.position.values=g;var b,w,O,x=n.normal?new Float32Array(_):void 0,C=n.tangent?new Float32Array(_):void 0,T=n.bitangent?new Float32Array(_):void 0,E=n.st?new Float32Array(_/3*2):void 0;if(n.normal){for(w=h.attributes.normal.values,x.set(w),a=0;a<p;a++)w[a]=-w[a];x.set(w,p),h.attributes.normal.values=x}if(i){w=h.attributes.normal.values,n.normal||(h.attributes.normal=void 0);var A=new Float32Array(_);for(a=0;a<p;a++)w[a]=-w[a];A.set(w,p),h.attributes.extrudeDirection=new ga.a({componentDatatype:ue.a.FLOAT,componentsPerAttribute:3,values:A})}var S=Object(s.default)(r);if(S){var P=p/3*2,D=new Uint8Array(P);r===he.a.TOP?D=Object($e.a)(D,1,0,P/2):(O=r===he.a.NONE?0:1,D=Object($e.a)(D,O)),h.attributes.applyOffset=new ga.a({componentDatatype:ue.a.UNSIGNED_BYTE,componentsPerAttribute:1,values:D})}if(n.tangent){var I=h.attributes.tangent.values;for(C.set(I),a=0;a<p;a++)I[a]=-I[a];C.set(I,p),h.attributes.tangent.values=C}if(n.bitangent){var M=h.attributes.bitangent.values;T.set(M),T.set(M,p),h.attributes.bitangent.values=T}n.st&&(b=h.attributes.st.values,E.set(b),E.set(b,p/3*2),h.attributes.st.values=E);var F=h.indices,R=F.length,N=p/3,L=ya.a.createTypedArray(_/3,2*R);for(L.set(F),a=0;a<R;a+=3)L[a+R]=F[a+2]+N,L[a+1+R]=F[a+1]+N,L[a+2+R]=F[a]+N;h.indices=L;var j=t.northCap,V=t.southCap,U=d,z=2,B=0,H=4,k=4;j&&(z-=1,U-=1,B+=1,H-=2,k-=1),V&&(z-=1,U-=1,B+=1,H-=2,k-=1);var G=2*((B+=z*f+2*U-H)+k),W=new Float64Array(3*G),Y=i?new Float32Array(3*G):void 0,X=S?new Uint8Array(G):void 0,Q=n.st?new Float32Array(2*G):void 0,q=r===he.a.TOP;S&&!q&&(O=r===he.a.ALL?1:0,X=Object($e.a)(X,O));var Z,K=0,J=0,ee=0,te=0,ae=f*U;for(a=0;a<ae;a+=f)W=Gs(W,K,Z=3*a,m,v),K+=6,n.st&&(Q=Ws(Q,J,2*a,b),J+=4),i&&(ee+=3,Y[ee++]=w[Z],Y[ee++]=w[Z+1],Y[ee++]=w[Z+2]),q&&(X[te++]=1,te+=1);if(V){var ie=j?ae+1:ae;for(Z=3*ie,a=0;a<2;a++)W=Gs(W,K,Z,m,v),K+=6,n.st&&(Q=Ws(Q,J,2*ie,b),J+=4),i&&(ee+=3,Y[ee++]=w[Z],Y[ee++]=w[Z+1],Y[ee++]=w[Z+2]),q&&(X[te++]=1,te+=1)}else for(a=ae-f;a<ae;a++)W=Gs(W,K,Z=3*a,m,v),K+=6,n.st&&(Q=Ws(Q,J,2*a,b),J+=4),i&&(ee+=3,Y[ee++]=w[Z],Y[ee++]=w[Z+1],Y[ee++]=w[Z+2]),q&&(X[te++]=1,te+=1);for(a=ae-1;a>0;a-=f)W=Gs(W,K,Z=3*a,m,v),K+=6,n.st&&(Q=Ws(Q,J,2*a,b),J+=4),i&&(ee+=3,Y[ee++]=w[Z],Y[ee++]=w[Z+1],Y[ee++]=w[Z+2]),q&&(X[te++]=1,te+=1);if(j){var re=ae;for(Z=3*re,a=0;a<2;a++)W=Gs(W,K,Z,m,v),K+=6,n.st&&(Q=Ws(Q,J,2*re,b),J+=4),i&&(ee+=3,Y[ee++]=w[Z],Y[ee++]=w[Z+1],Y[ee++]=w[Z+2]),q&&(X[te++]=1,te+=1)}else for(a=f-1;a>=0;a--)W=Gs(W,K,Z=3*a,m,v),K+=6,n.st&&(Q=Ws(Q,J,2*a,b),J+=4),i&&(ee+=3,Y[ee++]=w[Z],Y[ee++]=w[Z+1],Y[ee++]=w[Z+2]),q&&(X[te++]=1,te+=1);var ne=function(e,t,a){var i=e.length,r=t.normal?new Float32Array(i):void 0,n=t.tangent?new Float32Array(i):void 0,o=t.bitangent?new Float32Array(i):void 0,s=0,l=0,u=0,d=!0,f=Ns,c=Rs,h=Fs;if(t.normal||t.tangent||t.bitangent)for(var m=0;m<i;m+=6){var p=y.default.fromArray(e,m,Ms),_=y.default.fromArray(e,(m+6)%i,Bs);if(d){var g=y.default.fromArray(e,(m+3)%i,Hs);y.default.subtract(_,p,_),y.default.subtract(g,p,g),h=y.default.normalize(y.default.cross(g,_,h),h),d=!1}y.default.equalsEpsilon(_,p,Ve.default.EPSILON10)&&(d=!0),(t.tangent||t.bitangent)&&(f=a.geodeticSurfaceNormal(p,f),t.tangent&&(c=y.default.normalize(y.default.cross(f,h,c),c))),t.normal&&(r[s++]=h.x,r[s++]=h.y,r[s++]=h.z,r[s++]=h.x,r[s++]=h.y,r[s++]=h.z),t.tangent&&(n[l++]=c.x,n[l++]=c.y,n[l++]=c.z,n[l++]=c.x,n[l++]=c.y,n[l++]=c.z),t.bitangent&&(o[u++]=f.x,o[u++]=f.y,o[u++]=f.z,o[u++]=f.x,o[u++]=f.y,o[u++]=f.z)}return zs(t,{positions:e,normals:r,tangents:n,bitangents:o})}(W,n,u);n.st&&(ne.attributes.st=new ga.a({componentDatatype:ue.a.FLOAT,componentsPerAttribute:2,values:Q})),i&&(ne.attributes.extrudeDirection=new ga.a({componentDatatype:ue.a.FLOAT,componentsPerAttribute:3,values:Y})),S&&(ne.attributes.applyOffset=new ga.a({componentDatatype:ue.a.UNSIGNED_BYTE,componentsPerAttribute:1,values:X}));var oe,se,le,de,fe=ya.a.createTypedArray(G,6*B);p=W.length/3;var me=0;for(a=0;a<p-1;a+=2){de=((oe=a)+2)%p;var pe=y.default.fromArray(W,3*oe,Bs),_e=y.default.fromArray(W,3*de,Hs);y.default.equalsEpsilon(pe,_e,Ve.default.EPSILON10)||(le=((se=(oe+1)%p)+2)%p,fe[me++]=oe,fe[me++]=se,fe[me++]=de,fe[me++]=de,fe[me++]=se,fe[me++]=le)}return ne.indices=fe,(ne=ar.a.combineInstances([new ce.a({geometry:h}),new ce.a({geometry:ne})]))[0]}var Qs=[new y.default,new y.default,new y.default,new y.default],qs=new je.default,Zs=new je.default;function Ks(e,t,a,i,r){if(0===a)return Oa.default.clone(e,r);var n=Is.a.computeOptions(e,t,a,0,Ls,qs),o=n.height,s=n.width,l=Qs;return Is.a.computePosition(n,i,!1,0,0,l[0]),Is.a.computePosition(n,i,!1,0,s-1,l[1]),Is.a.computePosition(n,i,!1,o-1,0,l[2]),Is.a.computePosition(n,i,!1,o-1,s-1,l[3]),Oa.default.fromCartesianArray(l,i,r)}function Js(e){var t=(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).rectangle,a=Object(o.default)(e.height,0),i=Object(o.default)(e.extrudedHeight,a);this._rectangle=Oa.default.clone(t),this._granularity=Object(o.default)(e.granularity,Ve.default.RADIANS_PER_DEGREE),this._ellipsoid=pa.default.clone(Object(o.default)(e.ellipsoid,pa.default.WGS84)),this._surfaceHeight=Math.max(a,i),this._rotation=Object(o.default)(e.rotation,0),this._stRotation=Object(o.default)(e.stRotation,0),this._vertexFormat=$.default.clone(Object(o.default)(e.vertexFormat,$.default.DEFAULT)),this._extrudedHeight=Math.min(a,i),this._shadowVolume=Object(o.default)(e.shadowVolume,!1),this._workerName="createRectangleGeometry",this._offsetAttribute=e.offsetAttribute,this._rotatedRectangle=void 0,this._textureCoordinateRotationPoints=void 0}Js.packedLength=Oa.default.packedLength+pa.default.packedLength+$.default.packedLength+7,Js.pack=function(e,t,a){return a=Object(o.default)(a,0),Oa.default.pack(e._rectangle,t,a),a+=Oa.default.packedLength,pa.default.pack(e._ellipsoid,t,a),a+=pa.default.packedLength,$.default.pack(e._vertexFormat,t,a),a+=$.default.packedLength,t[a++]=e._granularity,t[a++]=e._surfaceHeight,t[a++]=e._rotation,t[a++]=e._stRotation,t[a++]=e._extrudedHeight,t[a++]=e._shadowVolume?1:0,t[a]=Object(o.default)(e._offsetAttribute,-1),t};var $s=new Oa.default,el=pa.default.clone(pa.default.UNIT_SPHERE),tl={rectangle:$s,ellipsoid:el,vertexFormat:Ys,granularity:void 0,height:void 0,rotation:void 0,stRotation:void 0,extrudedHeight:void 0,shadowVolume:void 0,offsetAttribute:void 0};Js.unpack=function(e,t,a){t=Object(o.default)(t,0);var i=Oa.default.unpack(e,t,$s);t+=Oa.default.packedLength;var r=pa.default.unpack(e,t,el);t+=pa.default.packedLength;var n=$.default.unpack(e,t,Ys);t+=$.default.packedLength;var l=e[t++],u=e[t++],d=e[t++],f=e[t++],c=e[t++],h=1===e[t++],m=e[t];return Object(s.default)(a)?(a._rectangle=Oa.default.clone(i,a._rectangle),a._ellipsoid=pa.default.clone(r,a._ellipsoid),a._vertexFormat=$.default.clone(n,a._vertexFormat),a._granularity=l,a._surfaceHeight=u,a._rotation=d,a._stRotation=f,a._extrudedHeight=c,a._shadowVolume=h,a._offsetAttribute=-1===m?void 0:m,a):(tl.granularity=l,tl.height=u,tl.rotation=d,tl.stRotation=f,tl.extrudedHeight=c,tl.shadowVolume=h,tl.offsetAttribute=-1===m?void 0:m,new Js(tl))},Js.computeRectangle=function(e,t){var a=(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).rectangle,i=Object(o.default)(e.granularity,Ve.default.RADIANS_PER_DEGREE),r=Object(o.default)(e.ellipsoid,pa.default.WGS84);return Ks(a,i,Object(o.default)(e.rotation,0),r,t)};var al=new at.default,il=new st.default,rl=new je.default;Js.createGeometry=function(e){if(!Ve.default.equalsEpsilon(e._rectangle.north,e._rectangle.south,Ve.default.EPSILON10)&&!Ve.default.equalsEpsilon(e._rectangle.east,e._rectangle.west,Ve.default.EPSILON10)){var t=e._rectangle,a=e._ellipsoid,i=e._rotation,n=e._stRotation,o=e._vertexFormat,l=Is.a.computeOptions(t,e._granularity,i,n,Ls,qs,Zs),u=al;if(0!==n||0!==i){var d=Oa.default.center(t,rl),f=a.geodeticSurfaceNormalCartographic(d,Bs);st.default.fromAxisAngle(f,-n,il),at.default.fromQuaternion(il,u)}else at.default.clone(at.default.IDENTITY,u);var c,h,m=e._surfaceHeight,p=e._extrudedHeight,_=!Ve.default.equalsEpsilon(m,p,0,Ve.default.EPSILON2);if(l.lonScalar=1/e._rectangle.width,l.latScalar=1/e._rectangle.height,l.tangentRotationMatrix=u,t=e._rectangle,_){c=Xs(e,l);var g=r.default.fromRectangle3D(t,a,m,Us),v=r.default.fromRectangle3D(t,a,p,Vs);h=r.default.union(g,v)}else{if((c=ks(e,l)).attributes.position.values=ba.a.scaleToGeodeticHeight(c.attributes.position.values,m,a,!1),Object(s.default)(e._offsetAttribute)){var y=c.attributes.position.values.length,b=new Uint8Array(y/3),w=e._offsetAttribute===he.a.NONE?0:1;Object($e.a)(b,w),c.attributes.applyOffset=new ga.a({componentDatatype:ue.a.UNSIGNED_BYTE,componentsPerAttribute:1,values:b})}h=r.default.fromRectangle3D(t,a,m)}return o.position||delete c.attributes.position,new _a.a({attributes:c.attributes,indices:c.indices,primitiveType:c.primitiveType,boundingSphere:h,offsetAttribute:e._offsetAttribute})}},Js.createShadowVolume=function(e,t,a){var i=e._granularity,r=e._ellipsoid,n=t(i,r),o=a(i,r);return new Js({rectangle:e._rectangle,rotation:e._rotation,ellipsoid:r,stRotation:e._stRotation,granularity:i,extrudedHeight:o,height:n,vertexFormat:$.default.POSITION_ONLY,shadowVolume:!0})};var nl=new Oa.default,ol=[new v.default,new v.default,new v.default],sl=new Ds.a,ll=new je.default;Object(l.default)(Js.prototype,{rectangle:{get:function(){return Object(s.default)(this._rotatedRectangle)||(this._rotatedRectangle=Ks(this._rectangle,this._granularity,this._rotation,this._ellipsoid)),this._rotatedRectangle}},textureCoordinateRotationPoints:{get:function(){return Object(s.default)(this._textureCoordinateRotationPoints)||(this._textureCoordinateRotationPoints=function(e){if(0===e._stRotation)return[0,0,0,1,1,0];var t=Oa.default.clone(e._rectangle,nl),a=e._granularity,i=e._ellipsoid,r=Ks(t,a,e._rotation-e._stRotation,i,nl),n=ol;n[0].x=r.west,n[0].y=r.south,n[1].x=r.west,n[1].y=r.north,n[2].x=r.east,n[2].y=r.south;for(var o=e.rectangle,s=Ds.a.fromRotation(e._stRotation,sl),l=Oa.default.center(o,ll),u=0;u<3;++u){var d=n[u];d.x-=l.longitude,d.y-=l.latitude,Ds.a.multiplyByVector(s,d,d),d.x+=l.longitude,d.y+=l.latitude,d.x=(d.x-o.west)/o.width,d.y=(d.y-o.south)/o.height}var f=n[0],c=n[1],h=n[2],m=new Array(6);return v.default.pack(f,m),v.default.pack(c,m,2),v.default.pack(h,m,4),m}(this)),this._textureCoordinateRotationPoints}}});var ul=Js,dl=a(633),fl=new b.default,cl=y.default.ZERO,hl=new y.default,ml=new Oa.default,pl=new Oa.default,_l=new je.default;function gl(e){this.id=e,this.vertexFormat=void 0,this.rectangle=void 0,this.height=void 0,this.extrudedHeight=void 0,this.granularity=void 0,this.stRotation=void 0,this.rotation=void 0,this.offsetAttribute=void 0}function vl(e,t){oi.call(this,{entity:e,scene:t,geometryOptions:new gl(e),geometryPropertyName:"rectangle",observedPropertyNames:["availability","rectangle"]}),this._onEntityPropertyChanged(e,"rectangle",e.rectangle,void 0)}function yl(e,t,a){Oe.call(this,e,t,a)}Object(s.default)(Object.create)&&(vl.prototype=Object.create(oi.prototype),vl.prototype.constructor=vl),vl.prototype.createFillGeometryInstance=function(e){var t,a=this._entity,i=a.isAvailable(e),r={show:new _e.a(i&&a.isShowing&&this._showProperty.getValue(e)&&this._fillProperty.getValue(e)),distanceDisplayCondition:fe.fromDistanceDisplayCondition(this._distanceDisplayConditionProperty.getValue(e)),offset:void 0,color:void 0};this._materialProperty instanceof ge.default&&(Object(s.default)(this._materialProperty.color)&&(this._materialProperty.color.isConstant||i)&&(t=this._materialProperty.color.getValue(e,fl)),Object(s.default)(t)||(t=b.default.WHITE),r.color=le.a.fromColor(t));return Object(s.default)(this._options.offsetAttribute)&&(r.offset=pe.a.fromCartesian3(S.default.getValueOrDefault(this._terrainOffsetProperty,e,cl,hl))),new ce.a({id:a,geometry:new ul(this._options),attributes:r})},vl.prototype.createOutlineGeometryInstance=function(e){var t=this._entity,a=t.isAvailable(e),i=S.default.getValueOrDefault(this._outlineColorProperty,e,b.default.BLACK,fl),r=this._distanceDisplayConditionProperty.getValue(e),n={show:new _e.a(a&&t.isShowing&&this._showProperty.getValue(e)&&this._showOutlineProperty.getValue(e)),color:le.a.fromColor(i),distanceDisplayCondition:fe.fromDistanceDisplayCondition(r),offset:void 0};return Object(s.default)(this._options.offsetAttribute)&&(n.offset=pe.a.fromCartesian3(S.default.getValueOrDefault(this._terrainOffsetProperty,e,cl,hl))),new ce.a({id:t,geometry:new dl.a(this._options),attributes:n})},vl.prototype._computeCenter=function(e,t){var a=S.default.getValueOrUndefined(this._entity.rectangle.coordinates,e,pl);if(Object(s.default)(a)){var i=Oa.default.center(a,_l);return je.default.toCartesian(i,pa.default.WGS84,t)}},vl.prototype._isHidden=function(e,t){return!Object(s.default)(t.coordinates)||Ne.prototype._isHidden.call(this,e,t)},vl.prototype._isDynamic=function(e,t){return!t.coordinates.isConstant||!S.default.isConstant(t.height)||!S.default.isConstant(t.extrudedHeight)||!S.default.isConstant(t.granularity)||!S.default.isConstant(t.stRotation)||!S.default.isConstant(t.rotation)||!S.default.isConstant(t.outlineWidth)||!S.default.isConstant(t.zIndex)||this._onTerrain&&!S.default.isConstant(this._materialProperty)},vl.prototype._setStaticOptions=function(e,t){var a=this._materialProperty instanceof ge.default,r=S.default.getValueOrUndefined(t.height,me.default.MINIMUM_VALUE),n=S.default.getValueOrDefault(t.heightReference,me.default.MINIMUM_VALUE,C.default.NONE),o=S.default.getValueOrUndefined(t.extrudedHeight,me.default.MINIMUM_VALUE),l=S.default.getValueOrDefault(t.extrudedHeightReference,me.default.MINIMUM_VALUE,C.default.NONE);Object(s.default)(o)&&!Object(s.default)(r)&&(r=0);var u=this._options;u.vertexFormat=a?re.a.VERTEX_FORMAT:ie.MaterialSupport.TEXTURED.vertexFormat,u.rectangle=t.coordinates.getValue(me.default.MINIMUM_VALUE,u.rectangle),u.granularity=S.default.getValueOrUndefined(t.granularity,me.default.MINIMUM_VALUE),u.stRotation=S.default.getValueOrUndefined(t.stRotation,me.default.MINIMUM_VALUE),u.rotation=S.default.getValueOrUndefined(t.rotation,me.default.MINIMUM_VALUE),u.offsetAttribute=oi.computeGeometryOffsetAttribute(r,n,o,l),u.height=oi.getGeometryHeight(r,n),(o=oi.getGeometryExtrudedHeight(o,l))===oi.CLAMP_TO_GROUND&&(o=i.a.getMinimumMaximumHeights(ul.computeRectangle(u,ml)).minimumTerrainHeight),u.extrudedHeight=o},vl.DynamicGeometryUpdater=yl,Object(s.default)(Object.create)&&(yl.prototype=Object.create(Oe.prototype),yl.prototype.constructor=yl),yl.prototype._isHidden=function(e,t,a){return!Object(s.default)(this._options.rectangle)||Oe.prototype._isHidden.call(this,e,t,a)},yl.prototype._setOptions=function(e,t,a){var r=this._options,n=S.default.getValueOrUndefined(t.height,a),o=S.default.getValueOrDefault(t.heightReference,a,C.default.NONE),l=S.default.getValueOrUndefined(t.extrudedHeight,a),u=S.default.getValueOrDefault(t.extrudedHeightReference,a,C.default.NONE);Object(s.default)(l)&&!Object(s.default)(n)&&(n=0),r.rectangle=S.default.getValueOrUndefined(t.coordinates,a,r.rectangle),r.granularity=S.default.getValueOrUndefined(t.granularity,a),r.stRotation=S.default.getValueOrUndefined(t.stRotation,a),r.rotation=S.default.getValueOrUndefined(t.rotation,a),r.offsetAttribute=oi.computeGeometryOffsetAttribute(n,o,l,u),r.height=oi.getGeometryHeight(n,o),(l=oi.getGeometryExtrudedHeight(l,u))===oi.CLAMP_TO_GROUND&&(l=i.a.getMinimumMaximumHeights(ul.computeRectangle(r,ml)).minimumTerrainHeight),r.extrudedHeight=l};var bl=vl,wl=new b.default,Ol=new O.a,xl=new O.a,Cl=y.default.ZERO,Tl=new y.default;function El(e,t,a,i,r,n,o){var l;this.translucent=t,this.appearanceType=a,this.depthFailAppearanceType=i,this.depthFailMaterialProperty=r,this.depthFailMaterial=void 0,this.closed=n,this.shadows=o,this.primitives=e,this.createPrimitive=!1,this.waitingOnCreate=!1,this.primitive=void 0,this.oldPrimitive=void 0,this.geometry=new _.default,this.updaters=new _.default,this.updatersWithAttributes=new _.default,this.attributes=new _.default,this.subscriptions=new _.default,this.showsUpdated=new _.default,this.itemsToRemove=[],this.invalidated=!1,Object(s.default)(r)&&(l=r.definitionChanged.addEventListener(El.prototype.onMaterialChanged,this)),this.removeMaterialSubscription=l}function Al(e,t,a,i,r){this._solidItems=[],this._translucentItems=[],this._primitives=e,this._appearanceType=t,this._depthFailAppearanceType=a,this._closed=i,this._shadows=r}function Sl(e,t){for(var a=e.length-1;a>=0;a--){var i=e[a];if(i.remove(t))return 0===i.updaters.length&&(e.splice(a,1),i.destroy()),!0}return!1}function Pl(e,t,a){for(var i=!1,r=t.length,n=0;n<r;++n){var o=t[n],s=o.itemsToRemove,l=s.length;if(l>0)for(n=0;n<l;n++){var u=s[n];o.remove(u),e.add(a,u),i=!0}}return i}function Dl(e,t,a,i){var r,n=t.length;for(r=n-1;r>=0;r--){var o=t[r];if(o.invalidated){t.splice(r,1);for(var s=o.updaters.values,l=s.length,u=0;u<l;u++)e.add(a,s[u]);o.destroy()}}for(n=t.length,r=0;r<n;++r)i=t[r].update(a)&&i;return i}function Il(e,t,a){for(var i=e.length,r=0;r<i;r++){var n=e[r];if(n.contains(t))return n.getBoundingSphere(t,a)}return A.default.FAILED}function Ml(e){for(var t=e.length,a=0;a<t;a++)e[a].destroy();e.length=0}El.prototype.onMaterialChanged=function(){this.invalidated=!0},El.prototype.isMaterial=function(e){var t=this.depthFailMaterialProperty,a=e.depthFailMaterialProperty;return a===t||!!Object(s.default)(t)&&t.equals(a)},El.prototype.add=function(e,t){var a=e.id;if(this.createPrimitive=!0,this.geometry.set(a,t),this.updaters.set(a,e),e.hasConstantFill&&e.fillMaterialProperty.isConstant&&S.default.isConstant(e.distanceDisplayConditionProperty)&&S.default.isConstant(e.terrainOffsetProperty)){var i=this;this.subscriptions.set(a,e.entity.definitionChanged.addEventListener((function(t,a,r,n){"isShowing"===a&&i.showsUpdated.set(e.id,e)})))}else this.updatersWithAttributes.set(a,e)},El.prototype.remove=function(e){var t=e.id;if(this.createPrimitive=this.geometry.remove(t)||this.createPrimitive,this.updaters.remove(t)){this.updatersWithAttributes.remove(t);var a=this.subscriptions.get(t);return Object(s.default)(a)&&(a(),this.subscriptions.remove(t),this.showsUpdated.remove(t)),!0}return!1},El.prototype.update=function(e){var t,a=!0,i=0,r=this.primitive,n=this.primitives;if(this.createPrimitive){var o=this.geometry.values;if(o.length>0){var l;Object(s.default)(r)&&(Object(s.default)(this.oldPrimitive)?n.remove(r):this.oldPrimitive=r),Object(s.default)(this.depthFailAppearanceType)&&(Object(s.default)(this.depthFailMaterialProperty)&&(this.depthFailMaterial=be.getValue(e,this.depthFailMaterialProperty,this.depthFailMaterial)),l=new this.depthFailAppearanceType({material:this.depthFailMaterial,translucent:this.translucent,closed:this.closed})),r=new ve.a({show:!1,asynchronous:!0,geometryInstances:o.slice(),appearance:new this.appearanceType({translucent:this.translucent,closed:this.closed}),depthFailAppearance:l,shadows:this.shadows}),n.add(r),a=!1}else{Object(s.default)(r)&&(n.remove(r),r=void 0);var u=this.oldPrimitive;Object(s.default)(u)&&(n.remove(u),this.oldPrimitive=void 0)}this.attributes.removeAll(),this.primitive=r,this.createPrimitive=!1,this.waitingOnCreate=!0}else if(Object(s.default)(r)&&r.ready){r.show=!0,Object(s.default)(this.oldPrimitive)&&(n.remove(this.oldPrimitive),this.oldPrimitive=void 0),!Object(s.default)(this.depthFailAppearanceType)||this.depthFailMaterialProperty instanceof ge.default||(this.depthFailMaterial=be.getValue(e,this.depthFailMaterialProperty,this.depthFailMaterial),this.primitive.depthFailAppearance.material=this.depthFailMaterial);var d=this.updatersWithAttributes.values,f=d.length,c=this.waitingOnCreate;for(t=0;t<f;t++){var h=d[t],m=this.geometry.get(h.id),p=this.attributes.get(m.id.id);if(Object(s.default)(p)||(p=r.getGeometryInstanceAttributes(m.id),this.attributes.set(m.id.id,p)),!h.fillMaterialProperty.isConstant||c){var _=h.fillMaterialProperty.color,g=S.default.getValueOrDefault(_,e,b.default.WHITE,wl);b.default.equals(p._lastColor,g)||(p._lastColor=b.default.clone(g,p._lastColor),p.color=le.a.toValue(g,p.color),(this.translucent&&255===p.color[3]||!this.translucent&&255!==p.color[3])&&(this.itemsToRemove[i++]=h))}if(Object(s.default)(this.depthFailAppearanceType)&&h.depthFailMaterialProperty instanceof ge.default&&(!h.depthFailMaterialProperty.isConstant||c)){var v=h.depthFailMaterialProperty.color,w=S.default.getValueOrDefault(v,e,b.default.WHITE,wl);b.default.equals(p._lastDepthFailColor,w)||(p._lastDepthFailColor=b.default.clone(w,p._lastDepthFailColor),p.depthFailColor=le.a.toValue(w,p.depthFailColor))}var x=h.entity.isShowing&&(h.hasConstantFill||h.isFilled(e));x!==(1===p.show[0])&&(p.show=_e.a.toValue(x,p.show));var C=h.distanceDisplayConditionProperty;if(!S.default.isConstant(C)){var T=S.default.getValueOrDefault(C,e,xl,Ol);O.a.equals(T,p._lastDistanceDisplayCondition)||(p._lastDistanceDisplayCondition=O.a.clone(T,p._lastDistanceDisplayCondition),p.distanceDisplayCondition=fe.toValue(T,p.distanceDisplayCondition))}var E=h.terrainOffsetProperty;if(!S.default.isConstant(E)){var A=S.default.getValueOrDefault(E,e,Cl,Tl);y.default.equals(A,p._lastOffset)||(p._lastOffset=y.default.clone(A,p._lastOffset),p.offset=pe.a.toValue(A,p.offset))}}this.updateShows(r),this.waitingOnCreate=!1}else Object(s.default)(r)&&!r.ready&&(a=!1);return this.itemsToRemove.length=i,a},El.prototype.updateShows=function(e){for(var t=this.showsUpdated.values,a=t.length,i=0;i<a;i++){var r=t[i],n=this.geometry.get(r.id),o=this.attributes.get(n.id.id);Object(s.default)(o)||(o=e.getGeometryInstanceAttributes(n.id),this.attributes.set(n.id.id,o));var l=r.entity.isShowing;l!==(1===o.show[0])&&(o.show=_e.a.toValue(l,o.show),n.attributes.show.value[0]=o.show[0])}this.showsUpdated.removeAll()},El.prototype.contains=function(e){return this.updaters.contains(e.id)},El.prototype.getBoundingSphere=function(e,t){var a=this.primitive;if(!a.ready)return A.default.PENDING;var i=a.getGeometryInstanceAttributes(e.entity);return!Object(s.default)(i)||!Object(s.default)(i.boundingSphere)||Object(s.default)(i.show)&&0===i.show[0]?A.default.FAILED:(i.boundingSphere.clone(t),A.default.DONE)},El.prototype.destroy=function(){var e=this.primitive,t=this.primitives;Object(s.default)(e)&&t.remove(e);var a=this.oldPrimitive;Object(s.default)(a)&&t.remove(a),Object(s.default)(this.removeMaterialSubscription)&&this.removeMaterialSubscription()},Al.prototype.add=function(e,t){var a,i,r=t.createFillGeometryInstance(e);255===r.attributes.color.value[3]?(a=this._solidItems,i=!1):(a=this._translucentItems,i=!0);for(var n=a.length,o=0;o<n;o++){var s=a[o];if(s.isMaterial(t))return void s.add(t,r)}var l=new El(this._primitives,i,this._appearanceType,this._depthFailAppearanceType,t.depthFailMaterialProperty,this._closed,this._shadows);l.add(t,r),a.push(l)},Al.prototype.remove=function(e){Sl(this._solidItems,e)||Sl(this._translucentItems,e)},Al.prototype.update=function(e){var t=Dl(this,this._solidItems,e,!0);t=Dl(this,this._translucentItems,e,t)&&t;var a=Pl(this,this._solidItems,e),i=Pl(this,this._translucentItems,e);return(a||i)&&(t=Dl(this,this._solidItems,e,t)&&t,t=Dl(this,this._translucentItems,e,t)&&t),t},Al.prototype.getBoundingSphere=function(e,t){var a=Il(this._solidItems,e,t);return a===A.default.FAILED?Il(this._translucentItems,e,t):a},Al.prototype.removeAllPrimitives=function(){Ml(this._solidItems),Ml(this._translucentItems)};var Fl=Al,Rl=new O.a,Nl=new O.a,Ll=y.default.ZERO,jl=new y.default;function Vl(e,t,a,i,r,n,o){this.primitives=e,this.appearanceType=t,this.materialProperty=a,this.depthFailAppearanceType=i,this.depthFailMaterialProperty=r,this.closed=n,this.shadows=o,this.updaters=new _.default,this.createPrimitive=!0,this.primitive=void 0,this.oldPrimitive=void 0,this.geometry=new _.default,this.material=void 0,this.depthFailMaterial=void 0,this.updatersWithAttributes=new _.default,this.attributes=new _.default,this.invalidated=!1,this.removeMaterialSubscription=a.definitionChanged.addEventListener(Vl.prototype.onMaterialChanged,this),this.subscriptions=new _.default,this.showsUpdated=new _.default}Vl.prototype.onMaterialChanged=function(){this.invalidated=!0},Vl.prototype.isMaterial=function(e){var t=this.materialProperty,a=e.fillMaterialProperty,i=this.depthFailMaterialProperty,r=e.depthFailMaterialProperty;if(a===t&&r===i)return!0;var n=Object(s.default)(t)&&t.equals(a);return n=(!Object(s.default)(i)&&!Object(s.default)(r)||Object(s.default)(i)&&i.equals(r))&&n},Vl.prototype.add=function(e,t){var a=t.id;if(this.updaters.set(a,t),this.geometry.set(a,t.createFillGeometryInstance(e)),t.hasConstantFill&&t.fillMaterialProperty.isConstant&&S.default.isConstant(t.distanceDisplayConditionProperty)&&S.default.isConstant(t.terrainOffsetProperty)){var i=this;this.subscriptions.set(a,t.entity.definitionChanged.addEventListener((function(e,a,r,n){"isShowing"===a&&i.showsUpdated.set(t.id,t)})))}else this.updatersWithAttributes.set(a,t);this.createPrimitive=!0},Vl.prototype.remove=function(e){var t=e.id;if(this.createPrimitive=this.geometry.remove(t)||this.createPrimitive,this.updaters.remove(t)){this.updatersWithAttributes.remove(t);var a=this.subscriptions.get(t);return Object(s.default)(a)&&(a(),this.subscriptions.remove(t),this.showsUpdated.remove(t)),!0}return!1};var Ul=new b.default;function zl(e,t,a,i,r){this._items=[],this._primitives=e,this._appearanceType=t,this._depthFailAppearanceType=a,this._closed=i,this._shadows=r}Vl.prototype.update=function(e){var t,a=!0,i=this.primitive,r=this.primitives,n=this.geometry.values;if(this.createPrimitive){if(n.length>0){var o;Object(s.default)(i)&&(Object(s.default)(this.oldPrimitive)?r.remove(i):this.oldPrimitive=i),this.material=be.getValue(e,this.materialProperty,this.material),Object(s.default)(this.depthFailMaterialProperty)&&(this.depthFailMaterial=be.getValue(e,this.depthFailMaterialProperty,this.depthFailMaterial),o=new this.depthFailAppearanceType({material:this.depthFailMaterial,translucent:this.depthFailMaterial.isTranslucent(),closed:this.closed})),i=new ve.a({show:!1,asynchronous:!0,geometryInstances:n.slice(),appearance:new this.appearanceType({material:this.material,translucent:this.material.isTranslucent(),closed:this.closed}),depthFailAppearance:o,shadows:this.shadows}),r.add(i),a=!1}else{Object(s.default)(i)&&(r.remove(i),i=void 0);var l=this.oldPrimitive;Object(s.default)(l)&&(r.remove(l),this.oldPrimitive=void 0)}this.attributes.removeAll(),this.primitive=i,this.createPrimitive=!1}else if(Object(s.default)(i)&&i.ready){i.show=!0,Object(s.default)(this.oldPrimitive)&&(r.remove(this.oldPrimitive),this.oldPrimitive=void 0),this.material=be.getValue(e,this.materialProperty,this.material),this.primitive.appearance.material=this.material,!Object(s.default)(this.depthFailAppearanceType)||this.depthFailMaterialProperty instanceof ge.default||(this.depthFailMaterial=be.getValue(e,this.depthFailMaterialProperty,this.depthFailMaterial),this.primitive.depthFailAppearance.material=this.depthFailMaterial);var u=this.updatersWithAttributes.values,d=u.length;for(t=0;t<d;t++){var f=u[t],c=f.entity,h=this.geometry.get(f.id),m=this.attributes.get(h.id.id);if(Object(s.default)(m)||(m=i.getGeometryInstanceAttributes(h.id),this.attributes.set(h.id.id,m)),Object(s.default)(this.depthFailAppearanceType)&&this.depthFailMaterialProperty instanceof ge.default&&!f.depthFailMaterialProperty.isConstant){var p=f.depthFailMaterialProperty.color,_=S.default.getValueOrDefault(p,e,b.default.WHITE,Ul);b.default.equals(m._lastDepthFailColor,_)||(m._lastDepthFailColor=b.default.clone(_,m._lastDepthFailColor),m.depthFailColor=le.a.toValue(_,m.depthFailColor))}var g=c.isShowing&&(f.hasConstantFill||f.isFilled(e));g!==(1===m.show[0])&&(m.show=_e.a.toValue(g,m.show));var v=f.distanceDisplayConditionProperty;if(!S.default.isConstant(v)){var w=S.default.getValueOrDefault(v,e,Nl,Rl);O.a.equals(w,m._lastDistanceDisplayCondition)||(m._lastDistanceDisplayCondition=O.a.clone(w,m._lastDistanceDisplayCondition),m.distanceDisplayCondition=fe.toValue(w,m.distanceDisplayCondition))}var x=f.terrainOffsetProperty;if(!S.default.isConstant(x)){var C=S.default.getValueOrDefault(x,e,Ll,jl);y.default.equals(C,m._lastOffset)||(m._lastOffset=y.default.clone(C,m._lastOffset),m.offset=pe.a.toValue(C,m.offset))}}this.updateShows(i)}else Object(s.default)(i)&&!i.ready&&(a=!1);return a},Vl.prototype.updateShows=function(e){for(var t=this.showsUpdated.values,a=t.length,i=0;i<a;i++){var r=t[i],n=r.entity,o=this.geometry.get(r.id),l=this.attributes.get(o.id.id);Object(s.default)(l)||(l=e.getGeometryInstanceAttributes(o.id),this.attributes.set(o.id.id,l));var u=n.isShowing;u!==(1===l.show[0])&&(l.show=_e.a.toValue(u,l.show),o.attributes.show.value[0]=l.show[0])}this.showsUpdated.removeAll()},Vl.prototype.contains=function(e){return this.updaters.contains(e.id)},Vl.prototype.getBoundingSphere=function(e,t){var a=this.primitive;if(!a.ready)return A.default.PENDING;var i=a.getGeometryInstanceAttributes(e.entity);return!Object(s.default)(i)||!Object(s.default)(i.boundingSphere)||Object(s.default)(i.show)&&0===i.show[0]?A.default.FAILED:(i.boundingSphere.clone(t),A.default.DONE)},Vl.prototype.destroy=function(){var e=this.primitive,t=this.primitives;Object(s.default)(e)&&t.remove(e);var a=this.oldPrimitive;Object(s.default)(a)&&t.remove(a),this.removeMaterialSubscription()},zl.prototype.add=function(e,t){for(var a=this._items,i=a.length,r=0;r<i;r++){var n=a[r];if(n.isMaterial(t))return void n.add(e,t)}var o=new Vl(this._primitives,this._appearanceType,t.fillMaterialProperty,this._depthFailAppearanceType,t.depthFailMaterialProperty,this._closed,this._shadows);o.add(e,t),a.push(o)},zl.prototype.remove=function(e){for(var t=this._items,a=t.length-1;a>=0;a--){var i=t[a];if(i.remove(e)){0===i.updaters.length&&(t.splice(a,1),i.destroy());break}}},zl.prototype.update=function(e){var t,a=this._items;for(t=a.length-1;t>=0;t--){var i=a[t];if(i.invalidated){a.splice(t,1);for(var r=i.updaters.values,n=r.length,o=0;o<n;o++)this.add(e,r[o]);i.destroy()}}var s=!0;for(t=0;t<a.length;t++)s=a[t].update(e)&&s;return s},zl.prototype.getBoundingSphere=function(e,t){for(var a=this._items,i=a.length,r=0;r<i;r++){var n=a[r];if(n.contains(e))return n.getBoundingSphere(e,t)}return A.default.FAILED},zl.prototype.removeAllPrimitives=function(){for(var e=this._items,t=e.length,a=0;a<t;a++)e[a].destroy();this._items.length=0};var Bl=zl,Hl=new b.default,kl=new O.a,Gl=new O.a;function Wl(e,t,a,i,r){this.primitives=e,this.zIndex=r,this.classificationType=t,this.color=a,this.key=i,this.createPrimitive=!1,this.waitingOnCreate=!1,this.primitive=void 0,this.oldPrimitive=void 0,this.geometry=new _.default,this.updaters=new _.default,this.updatersWithAttributes=new _.default,this.attributes=new _.default,this.subscriptions=new _.default,this.showsUpdated=new _.default,this.itemsToRemove=[],this.isDirty=!1}Wl.prototype.add=function(e,t){var a=e.id;if(this.createPrimitive=!0,this.geometry.set(a,t),this.updaters.set(a,e),e.hasConstantFill&&e.fillMaterialProperty.isConstant&&S.default.isConstant(e.distanceDisplayConditionProperty)){var i=this;this.subscriptions.set(a,e.entity.definitionChanged.addEventListener((function(t,a,r,n){"isShowing"===a&&i.showsUpdated.set(e.id,e)})))}else this.updatersWithAttributes.set(a,e)},Wl.prototype.remove=function(e){var t=e.id;if(this.createPrimitive=this.geometry.remove(t)||this.createPrimitive,this.updaters.remove(t)){this.updatersWithAttributes.remove(t);var a=this.subscriptions.get(t);return Object(s.default)(a)&&(a(),this.subscriptions.remove(t),this.showsUpdated.remove(t)),!0}return!1};var Yl=new Array(4);function Xl(e,t){this._batches=new _.default,this._primitives=e,this._classificationType=t}Wl.prototype.update=function(e){var t,a=!0,i=0,r=this.primitive,n=this.primitives;if(this.createPrimitive){var o=this.geometry.values;if(o.length>0)Object(s.default)(r)&&(Object(s.default)(this.oldPrimitive)?n.remove(r):this.oldPrimitive=r),r=new c.a({show:!1,asynchronous:!0,geometryInstances:o.slice(),classificationType:this.classificationType}),n.add(r,this.zIndex),a=!1;else{Object(s.default)(r)&&(n.remove(r),r=void 0);var l=this.oldPrimitive;Object(s.default)(l)&&(n.remove(l),this.oldPrimitive=void 0)}this.attributes.removeAll(),this.primitive=r,this.createPrimitive=!1,this.waitingOnCreate=!0}else if(Object(s.default)(r)&&r.ready){r.show=!0,Object(s.default)(this.oldPrimitive)&&(n.remove(this.oldPrimitive),this.oldPrimitive=void 0);var u=this.updatersWithAttributes.values,d=u.length,f=this.waitingOnCreate;for(t=0;t<d;t++){var h=u[t],m=this.geometry.get(h.id),p=this.attributes.get(m.id.id);if(Object(s.default)(p)||(p=r.getGeometryInstanceAttributes(m.id),this.attributes.set(m.id.id,p)),!h.fillMaterialProperty.isConstant||f){var _=h.fillMaterialProperty.color,g=S.default.getValueOrDefault(_,e,b.default.WHITE,Hl);if(!b.default.equals(p._lastColor,g)){p._lastColor=b.default.clone(g,p._lastColor);var v=this.color,y=g.toBytes(Yl);v[0]===y[0]&&v[1]===y[1]&&v[2]===y[2]&&v[3]===y[3]||(this.itemsToRemove[i++]=h)}}var w=h.entity.isShowing&&(h.hasConstantFill||h.isFilled(e));w!==(1===p.show[0])&&(p.show=_e.a.toValue(w,p.show));var x=h.distanceDisplayConditionProperty;if(!S.default.isConstant(x)){var C=S.default.getValueOrDefault(x,e,Gl,kl);O.a.equals(C,p._lastDistanceDisplayCondition)||(p._lastDistanceDisplayCondition=O.a.clone(C,p._lastDistanceDisplayCondition),p.distanceDisplayCondition=fe.toValue(C,p.distanceDisplayCondition))}}this.updateShows(r),this.waitingOnCreate=!1}else Object(s.default)(r)&&!r.ready&&(a=!1);return this.itemsToRemove.length=i,a},Wl.prototype.updateShows=function(e){for(var t=this.showsUpdated.values,a=t.length,i=0;i<a;i++){var r=t[i],n=this.geometry.get(r.id),o=this.attributes.get(n.id.id);Object(s.default)(o)||(o=e.getGeometryInstanceAttributes(n.id),this.attributes.set(n.id.id,o));var l=r.entity.isShowing;l!==(1===o.show[0])&&(o.show=_e.a.toValue(l,o.show),n.attributes.show.value[0]=o.show[0])}this.showsUpdated.removeAll()},Wl.prototype.contains=function(e){return this.updaters.contains(e.id)},Wl.prototype.getBoundingSphere=function(e,t){var a=this.primitive;if(!a.ready)return A.default.PENDING;var i=a.getBoundingSphere(e.entity);return Object(s.default)(i)?(i.clone(t),A.default.DONE):A.default.FAILED},Wl.prototype.removeAllPrimitives=function(){var e=this.primitives,t=this.primitive;Object(s.default)(t)&&(e.remove(t),this.primitive=void 0,this.geometry.removeAll(),this.updaters.removeAll());var a=this.oldPrimitive;Object(s.default)(a)&&(e.remove(a),this.oldPrimitive=void 0)},Xl.prototype.add=function(e,t){var a,i=t.createFillGeometryInstance(e),r=this._batches,n=S.default.getValueOrDefault(t.zIndex,0),o=new Uint32Array(i.attributes.color.value.buffer)[0]+":"+n;return r.contains(o)?a=r.get(o):(a=new Wl(this._primitives,this._classificationType,i.attributes.color.value,o,n),r.set(o,a)),a.add(t,i),a},Xl.prototype.remove=function(e){for(var t=this._batches.values,a=t.length,i=0;i<a;++i)if(t[i].remove(e))return},Xl.prototype.update=function(e){var t,a,i=!0,r=this._batches,n=r.values,o=n.length;for(t=0;t<o;++t)i=n[t].update(e)&&i;for(t=0;t<o;++t)for(var s=n[t],l=s.itemsToRemove,u=l.length,d=0;d<u;d++){a=l[d],s.remove(a);var f=this.add(e,a);s.isDirty=!0,f.isDirty=!0}var c=n.slice(),h=c.length;for(t=0;t<h;++t){var m=c[t];m.isDirty&&(i=c[t].update(e)&&i,m.isDirty=!1),0===m.geometry.length&&r.remove(m.key)}return i},Xl.prototype.getBoundingSphere=function(e,t){for(var a=this._batches.values,i=a.length,r=0;r<i;++r){var n=a[r];if(n.contains(e))return n.getBoundingSphere(e,t)}return A.default.FAILED},Xl.prototype.removeAllPrimitives=function(){for(var e=this._batches.values,t=e.length,a=0;a<t;++a)e[a].removeAllPrimitives()};var Ql=Xl;function ql(e,t,a){var i=e[t];e[t]=e[a],e[a]=i}function Zl(e,t){return e<t?-1:e>t?1:0}var Kl=function(e,t,a,i,r){!function e(t,a,i,r,n){for(;r>i;){if(r-i>600){var o=r-i+1,s=a-i+1,l=Math.log(o),u=.5*Math.exp(2*l/3),d=.5*Math.sqrt(l*u*(o-u)/o)*(s-o/2<0?-1:1),f=Math.max(i,Math.floor(a-s*u/o+d)),c=Math.min(r,Math.floor(a+(o-s)*u/o+d));e(t,a,f,c,n)}var h=t[a],m=i,p=r;for(ql(t,i,a),n(t[r],h)>0&&ql(t,i,r);m<p;){for(ql(t,m,p),m++,p--;n(t[m],h)<0;)m++;for(;n(t[p],h)>0;)p--}0===n(t[i],h)?ql(t,i,p):(p++,ql(t,p,r)),p<=a&&(i=p+1),a<=p&&(r=p-1)}}(e,t,a||0,i||e.length-1,r||Zl)};function Jl(e,t){if(!(this instanceof Jl))return new Jl(e,t);this._maxEntries=Math.max(4,e||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),t&&this._initFormat(t),this.clear()}function $l(e,t,a){if(!a)return t.indexOf(e);for(var i=0;i<t.length;i++)if(a(e,t[i]))return i;return-1}function eu(e,t){tu(e,0,e.children.length,t,e)}function tu(e,t,a,i,r){r||(r=uu(null)),r.minX=1/0,r.minY=1/0,r.maxX=-1/0,r.maxY=-1/0;for(var n,o=t;o<a;o++)n=e.children[o],au(r,e.leaf?i(n):n);return r}function au(e,t){return e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY),e}function iu(e,t){return e.minX-t.minX}function ru(e,t){return e.minY-t.minY}function nu(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function ou(e){return e.maxX-e.minX+(e.maxY-e.minY)}function su(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function lu(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function uu(e){return{children:e,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function du(e,t,a,i,r){for(var n,o=[t,a];o.length;)(a=o.pop())-(t=o.pop())<=i||(n=t+Math.ceil((a-t)/i/2)*i,Kl(e,n,t,a,r),o.push(t,n,n,a))}Jl.prototype={all:function(){return this._all(this.data,[])},search:function(e){var t=this.data,a=[],i=this.toBBox;if(!lu(e,t))return a;for(var r,n,o,s,l=[];t;){for(r=0,n=t.children.length;r<n;r++)o=t.children[r],lu(e,s=t.leaf?i(o):o)&&(t.leaf?a.push(o):su(e,s)?this._all(o,a):l.push(o));t=l.pop()}return a},collides:function(e){var t=this.data,a=this.toBBox;if(!lu(e,t))return!1;for(var i,r,n,o,s=[];t;){for(i=0,r=t.children.length;i<r;i++)if(n=t.children[i],lu(e,o=t.leaf?a(n):n)){if(t.leaf||su(e,o))return!0;s.push(n)}t=s.pop()}return!1},load:function(e){if(!e||!e.length)return this;if(e.length<this._minEntries){for(var t=0,a=e.length;t<a;t++)this.insert(e[t]);return this}var i=this._build(e.slice(),0,e.length-1,0);if(this.data.children.length)if(this.data.height===i.height)this._splitRoot(this.data,i);else{if(this.data.height<i.height){var r=this.data;this.data=i,i=r}this._insert(i,this.data.height-i.height-1,!0)}else this.data=i;return this},insert:function(e){return e&&this._insert(e,this.data.height-1),this},clear:function(){return this.data=uu([]),this},remove:function(e,t){if(!e)return this;for(var a,i,r,n,o=this.data,s=this.toBBox(e),l=[],u=[];o||l.length;){if(o||(o=l.pop(),i=l[l.length-1],a=u.pop(),n=!0),o.leaf&&-1!==(r=$l(e,o.children,t)))return o.children.splice(r,1),l.push(o),this._condense(l),this;n||o.leaf||!su(o,s)?i?(a++,o=i.children[a],n=!1):o=null:(l.push(o),u.push(a),a=0,i=o,o=o.children[0])}return this},toBBox:function(e){return e},compareMinX:iu,compareMinY:ru,toJSON:function(){return this.data},fromJSON:function(e){return this.data=e,this},_all:function(e,t){for(var a=[];e;)e.leaf?t.push.apply(t,e.children):a.push.apply(a,e.children),e=a.pop();return t},_build:function(e,t,a,i){var r,n=a-t+1,o=this._maxEntries;if(n<=o)return eu(r=uu(e.slice(t,a+1)),this.toBBox),r;i||(i=Math.ceil(Math.log(n)/Math.log(o)),o=Math.ceil(n/Math.pow(o,i-1))),(r=uu([])).leaf=!1,r.height=i;var s,l,u,d,f=Math.ceil(n/o),c=f*Math.ceil(Math.sqrt(o));for(du(e,t,a,c,this.compareMinX),s=t;s<=a;s+=c)for(du(e,s,u=Math.min(s+c-1,a),f,this.compareMinY),l=s;l<=u;l+=f)d=Math.min(l+f-1,u),r.children.push(this._build(e,l,d,i-1));return eu(r,this.toBBox),r},_chooseSubtree:function(e,t,a,i){for(var r,n,o,s,l,u,d,f,c,h;i.push(t),!t.leaf&&i.length-1!==a;){for(d=f=1/0,r=0,n=t.children.length;r<n;r++)l=nu(o=t.children[r]),c=e,h=o,(u=(Math.max(h.maxX,c.maxX)-Math.min(h.minX,c.minX))*(Math.max(h.maxY,c.maxY)-Math.min(h.minY,c.minY))-l)<f?(f=u,d=l<d?l:d,s=o):u===f&&l<d&&(d=l,s=o);t=s||t.children[0]}return t},_insert:function(e,t,a){var i=this.toBBox,r=a?e:i(e),n=[],o=this._chooseSubtree(r,this.data,t,n);for(o.children.push(e),au(o,r);t>=0&&n[t].children.length>this._maxEntries;)this._split(n,t),t--;this._adjustParentBBoxes(r,n,t)},_split:function(e,t){var a=e[t],i=a.children.length,r=this._minEntries;this._chooseSplitAxis(a,r,i);var n=this._chooseSplitIndex(a,r,i),o=uu(a.children.splice(n,a.children.length-n));o.height=a.height,o.leaf=a.leaf,eu(a,this.toBBox),eu(o,this.toBBox),t?e[t-1].children.push(o):this._splitRoot(a,o)},_splitRoot:function(e,t){this.data=uu([e,t]),this.data.height=e.height+1,this.data.leaf=!1,eu(this.data,this.toBBox)},_chooseSplitIndex:function(e,t,a){var i,r,n,o,s,l,u,d,f,c,h,m,p,_;for(l=u=1/0,i=t;i<=a-t;i++)r=tu(e,0,i,this.toBBox),n=tu(e,i,a,this.toBBox),f=r,c=n,h=void 0,m=void 0,p=void 0,_=void 0,h=Math.max(f.minX,c.minX),m=Math.max(f.minY,c.minY),p=Math.min(f.maxX,c.maxX),_=Math.min(f.maxY,c.maxY),o=Math.max(0,p-h)*Math.max(0,_-m),s=nu(r)+nu(n),o<l?(l=o,d=i,u=s<u?s:u):o===l&&s<u&&(u=s,d=i);return d},_chooseSplitAxis:function(e,t,a){var i=e.leaf?this.compareMinX:iu,r=e.leaf?this.compareMinY:ru;this._allDistMargin(e,t,a,i)<this._allDistMargin(e,t,a,r)&&e.children.sort(i)},_allDistMargin:function(e,t,a,i){e.children.sort(i);var r,n,o=this.toBBox,s=tu(e,0,t,o),l=tu(e,a-t,a,o),u=ou(s)+ou(l);for(r=t;r<a-t;r++)n=e.children[r],au(s,e.leaf?o(n):n),u+=ou(s);for(r=a-t-1;r>=t;r--)n=e.children[r],au(l,e.leaf?o(n):n),u+=ou(l);return u},_adjustParentBBoxes:function(e,t,a){for(var i=a;i>=0;i--)au(t[i],e)},_condense:function(e){for(var t,a=e.length-1;a>=0;a--)0===e[a].children.length?a>0?(t=e[a-1].children).splice(t.indexOf(e[a]),1):this.clear():eu(e[a],this.toBBox)},_initFormat:function(e){var t=["return a"," - b",";"];this.compareMinX=new Function("a","b",t.join(e[0])),this.compareMinY=new Function("a","b",t.join(e[1])),this.toBBox=new Function("a","return {minX: a"+e[0]+", minY: a"+e[1]+", maxX: a"+e[2]+", maxY: a"+e[3]+"};")}};var fu=Jl;function cu(){this._tree=fu()}function hu(){this.minX=0,this.minY=0,this.maxX=0,this.maxY=0,this.id=""}function mu(e,t){return e.id===t.id}hu.fromRectangleAndId=function(e,t,a){return a.minX=t.west,a.minY=t.south,a.maxX=t.east,a.maxY=t.north,a.id=e,a},cu.prototype.insert=function(e,t){var a=hu.fromRectangleAndId(e,t,new hu);this._tree.insert(a)};var pu=new hu;cu.prototype.remove=function(e,t){var a=hu.fromRectangleAndId(e,t,pu);this._tree.remove(a,mu)};var _u=new hu;cu.prototype.collides=function(e){var t=hu.fromRectangleAndId("",e,_u);return this._tree.collides(t)};var gu=cu,vu=a(515),yu=new O.a,bu=new O.a;function wu(e,t,a,i,r,n){this.primitives=e,this.classificationType=t,this.appearanceType=a,this.materialProperty=i,this.updaters=new _.default,this.createPrimitive=!0,this.primitive=void 0,this.oldPrimitive=void 0,this.geometry=new _.default,this.material=void 0,this.updatersWithAttributes=new _.default,this.attributes=new _.default,this.invalidated=!1,this.removeMaterialSubscription=i.definitionChanged.addEventListener(wu.prototype.onMaterialChanged,this),this.subscriptions=new _.default,this.showsUpdated=new _.default,this.usingSphericalTextureCoordinates=r,this.zIndex=n,this.rectangleCollisionCheck=new gu}function Ou(e,t,a){this._items=[],this._primitives=e,this._classificationType=t,this._appearanceType=a}wu.prototype.onMaterialChanged=function(){this.invalidated=!0},wu.prototype.overlapping=function(e){return this.rectangleCollisionCheck.collides(e)},wu.prototype.isMaterial=function(e){var t=this.materialProperty,a=e.fillMaterialProperty;return a===t||a instanceof ge.default&&t instanceof ge.default||Object(s.default)(t)&&t.equals(a)},wu.prototype.add=function(e,t,a){var i=t.id;if(this.updaters.set(i,t),this.geometry.set(i,a),this.rectangleCollisionCheck.insert(i,a.geometry.rectangle),t.hasConstantFill&&t.fillMaterialProperty.isConstant&&S.default.isConstant(t.distanceDisplayConditionProperty)){var r=this;this.subscriptions.set(i,t.entity.definitionChanged.addEventListener((function(e,a,i,n){"isShowing"===a&&r.showsUpdated.set(t.id,t)})))}else this.updatersWithAttributes.set(i,t);this.createPrimitive=!0},wu.prototype.remove=function(e){var t=e.id,a=this.geometry.get(t);if(this.createPrimitive=this.geometry.remove(t)||this.createPrimitive,this.updaters.remove(t)){this.rectangleCollisionCheck.remove(t,a.geometry.rectangle),this.updatersWithAttributes.remove(t);var i=this.subscriptions.get(t);return Object(s.default)(i)&&(i(),this.subscriptions.remove(t)),!0}return!1},wu.prototype.update=function(e){var t,a=!0,i=this.primitive,r=this.primitives,n=this.geometry.values;if(this.createPrimitive){if(n.length>0)Object(s.default)(i)&&(Object(s.default)(this.oldPrimitive)?r.remove(i):this.oldPrimitive=i),this.material=be.getValue(e,this.materialProperty,this.material),i=new c.a({show:!1,asynchronous:!0,geometryInstances:n.slice(),appearance:new this.appearanceType({material:this.material}),classificationType:this.classificationType}),r.add(i,this.zIndex),a=!1;else{Object(s.default)(i)&&(r.remove(i),i=void 0);var o=this.oldPrimitive;Object(s.default)(o)&&(r.remove(o),this.oldPrimitive=void 0)}this.attributes.removeAll(),this.primitive=i,this.createPrimitive=!1}else if(Object(s.default)(i)&&i.ready){i.show=!0,Object(s.default)(this.oldPrimitive)&&(r.remove(this.oldPrimitive),this.oldPrimitive=void 0),this.material=be.getValue(e,this.materialProperty,this.material),this.primitive.appearance.material=this.material;var l=this.updatersWithAttributes.values,u=l.length;for(t=0;t<u;t++){var d=l[t],f=d.entity,h=this.geometry.get(d.id),m=this.attributes.get(h.id.id);Object(s.default)(m)||(m=i.getGeometryInstanceAttributes(h.id),this.attributes.set(h.id.id,m));var p=f.isShowing&&(d.hasConstantFill||d.isFilled(e));p!==(1===m.show[0])&&(m.show=_e.a.toValue(p,m.show));var _=d.distanceDisplayConditionProperty;if(!S.default.isConstant(_)){var g=S.default.getValueOrDefault(_,e,bu,yu);O.a.equals(g,m._lastDistanceDisplayCondition)||(m._lastDistanceDisplayCondition=O.a.clone(g,m._lastDistanceDisplayCondition),m.distanceDisplayCondition=fe.toValue(g,m.distanceDisplayCondition))}}this.updateShows(i)}else Object(s.default)(i)&&!i.ready&&(a=!1);return a},wu.prototype.updateShows=function(e){for(var t=this.showsUpdated.values,a=t.length,i=0;i<a;i++){var r=t[i],n=r.entity,o=this.geometry.get(r.id),l=this.attributes.get(o.id.id);Object(s.default)(l)||(l=e.getGeometryInstanceAttributes(o.id),this.attributes.set(o.id.id,l));var u=n.isShowing;u!==(1===l.show[0])&&(l.show=_e.a.toValue(u,l.show),o.attributes.show.value[0]=l.show[0])}this.showsUpdated.removeAll()},wu.prototype.contains=function(e){return this.updaters.contains(e.id)},wu.prototype.getBoundingSphere=function(e,t){var a=this.primitive;if(!a.ready)return A.default.PENDING;var i=a.getGeometryInstanceAttributes(e.entity);return!Object(s.default)(i)||!Object(s.default)(i.boundingSphere)||Object(s.default)(i.show)&&0===i.show[0]?A.default.FAILED:(i.boundingSphere.clone(t),A.default.DONE)},wu.prototype.destroy=function(){var e=this.primitive,t=this.primitives;Object(s.default)(e)&&t.remove(e);var a=this.oldPrimitive;Object(s.default)(a)&&t.remove(a),this.removeMaterialSubscription()},Ou.prototype.add=function(e,t){for(var a=this._items,i=a.length,r=t.createFillGeometryInstance(e),n=vu.a.shouldUseSphericalCoordinates(r.geometry.rectangle),o=S.default.getValueOrDefault(t.zIndex,0),s=0;s<i;++s){var l=a[s];if(l.isMaterial(t)&&l.usingSphericalTextureCoordinates===n&&l.zIndex===o&&!l.overlapping(r.geometry.rectangle))return void l.add(e,t,r)}var u=new wu(this._primitives,this._classificationType,this._appearanceType,t.fillMaterialProperty,n,o);u.add(e,t,r),a.push(u)},Ou.prototype.remove=function(e){for(var t=this._items,a=t.length-1;a>=0;a--){var i=t[a];if(i.remove(e)){0===i.updaters.length&&(t.splice(a,1),i.destroy());break}}},Ou.prototype.update=function(e){var t,a=this._items;for(t=a.length-1;t>=0;t--){var i=a[t];if(i.invalidated){a.splice(t,1);for(var r=i.updaters.values,n=r.length,o=0;o<n;o++)this.add(e,r[o]);i.destroy()}}var s=!0;for(t=0;t<a.length;t++)s=a[t].update(e)&&s;return s},Ou.prototype.getBoundingSphere=function(e,t){for(var a=this._items,i=a.length,r=0;r<i;r++){var n=a[r];if(n.contains(e))return n.getBoundingSphere(e,t)}return A.default.FAILED},Ou.prototype.removeAllPrimitives=function(){for(var e=this._items,t=e.length,a=0;a<t;a++)e[a].destroy();this._items.length=0};var xu=Ou,Cu=new b.default,Tu=new O.a,Eu=new O.a,Au=y.default.ZERO,Su=new y.default;function Pu(e,t,a,i){this.translucent=t,this.width=a,this.shadows=i,this.primitives=e,this.createPrimitive=!1,this.waitingOnCreate=!1,this.primitive=void 0,this.oldPrimitive=void 0,this.geometry=new _.default,this.updaters=new _.default,this.updatersWithAttributes=new _.default,this.attributes=new _.default,this.itemsToRemove=[],this.subscriptions=new _.default,this.showsUpdated=new _.default}function Du(e,t,a){this._primitives=e,this._scene=t,this._shadows=a,this._solidBatches=new _.default,this._translucentBatches=new _.default}Pu.prototype.add=function(e,t){var a=e.id;if(this.createPrimitive=!0,this.geometry.set(a,t),this.updaters.set(a,e),e.hasConstantOutline&&e.outlineColorProperty.isConstant&&S.default.isConstant(e.distanceDisplayConditionProperty)&&S.default.isConstant(e.terrainOffsetProperty)){var i=this;this.subscriptions.set(a,e.entity.definitionChanged.addEventListener((function(t,a,r,n){"isShowing"===a&&i.showsUpdated.set(e.id,e)})))}else this.updatersWithAttributes.set(a,e)},Pu.prototype.remove=function(e){var t=e.id;if(this.createPrimitive=this.geometry.remove(t)||this.createPrimitive,this.updaters.remove(t)){this.updatersWithAttributes.remove(t);var a=this.subscriptions.get(t);return Object(s.default)(a)&&(a(),this.subscriptions.remove(t),this.showsUpdated.remove(t)),!0}return!1},Pu.prototype.update=function(e){var t,a=!0,i=0,r=this.primitive,n=this.primitives;if(this.createPrimitive){var o=this.geometry.values;if(o.length>0)Object(s.default)(r)&&(Object(s.default)(this.oldPrimitive)?n.remove(r):this.oldPrimitive=r),r=new ve.a({show:!1,asynchronous:!0,geometryInstances:o.slice(),appearance:new re.a({flat:!0,translucent:this.translucent,renderState:{lineWidth:this.width}}),shadows:this.shadows}),n.add(r),a=!1;else{Object(s.default)(r)&&(n.remove(r),r=void 0);var l=this.oldPrimitive;Object(s.default)(l)&&(n.remove(l),this.oldPrimitive=void 0)}this.attributes.removeAll(),this.primitive=r,this.createPrimitive=!1,this.waitingOnCreate=!0}else if(Object(s.default)(r)&&r.ready){r.show=!0,Object(s.default)(this.oldPrimitive)&&(n.remove(this.oldPrimitive),this.oldPrimitive=void 0);var u=this.updatersWithAttributes.values,d=u.length,f=this.waitingOnCreate;for(t=0;t<d;t++){var c=u[t],h=this.geometry.get(c.id),m=this.attributes.get(h.id.id);if(Object(s.default)(m)||(m=r.getGeometryInstanceAttributes(h.id),this.attributes.set(h.id.id,m)),!c.outlineColorProperty.isConstant||f){var p=c.outlineColorProperty,_=S.default.getValueOrDefault(p,e,b.default.WHITE,Cu);b.default.equals(m._lastColor,_)||(m._lastColor=b.default.clone(_,m._lastColor),m.color=le.a.toValue(_,m.color),(this.translucent&&255===m.color[3]||!this.translucent&&255!==m.color[3])&&(this.itemsToRemove[i++]=c))}var g=c.entity.isShowing&&(c.hasConstantOutline||c.isOutlineVisible(e));g!==(1===m.show[0])&&(m.show=_e.a.toValue(g,m.show));var v=c.distanceDisplayConditionProperty;if(!S.default.isConstant(v)){var w=S.default.getValueOrDefault(v,e,Eu,Tu);O.a.equals(w,m._lastDistanceDisplayCondition)||(m._lastDistanceDisplayCondition=O.a.clone(w,m._lastDistanceDisplayCondition),m.distanceDisplayCondition=fe.toValue(w,m.distanceDisplayCondition))}var x=c.terrainOffsetProperty;if(!S.default.isConstant(x)){var C=S.default.getValueOrDefault(x,e,Au,Su);y.default.equals(C,m._lastOffset)||(m._lastOffset=y.default.clone(C,m._lastOffset),m.offset=pe.a.toValue(C,m.offset))}}this.updateShows(r),this.waitingOnCreate=!1}else Object(s.default)(r)&&!r.ready&&(a=!1);return this.itemsToRemove.length=i,a},Pu.prototype.updateShows=function(e){for(var t=this.showsUpdated.values,a=t.length,i=0;i<a;i++){var r=t[i],n=this.geometry.get(r.id),o=this.attributes.get(n.id.id);Object(s.default)(o)||(o=e.getGeometryInstanceAttributes(n.id),this.attributes.set(n.id.id,o));var l=r.entity.isShowing;l!==(1===o.show[0])&&(o.show=_e.a.toValue(l,o.show),n.attributes.show.value[0]=o.show[0])}this.showsUpdated.removeAll()},Pu.prototype.contains=function(e){return this.updaters.contains(e.id)},Pu.prototype.getBoundingSphere=function(e,t){var a=this.primitive;if(!a.ready)return A.default.PENDING;var i=a.getGeometryInstanceAttributes(e.entity);return!Object(s.default)(i)||!Object(s.default)(i.boundingSphere)||Object(s.default)(i.show)&&0===i.show[0]?A.default.FAILED:(i.boundingSphere.clone(t),A.default.DONE)},Pu.prototype.removeAllPrimitives=function(){var e=this.primitives,t=this.primitive;Object(s.default)(t)&&(e.remove(t),this.primitive=void 0,this.geometry.removeAll(),this.updaters.removeAll());var a=this.oldPrimitive;Object(s.default)(a)&&(e.remove(a),this.oldPrimitive=void 0)},Du.prototype.add=function(e,t){var a,i,r=t.createOutlineGeometryInstance(e),n=this._scene.clampLineWidth(t.outlineWidth);255===r.attributes.color.value[3]?(i=(a=this._solidBatches).get(n),Object(s.default)(i)||(i=new Pu(this._primitives,!1,n,this._shadows),a.set(n,i)),i.add(t,r)):(i=(a=this._translucentBatches).get(n),Object(s.default)(i)||(i=new Pu(this._primitives,!0,n,this._shadows),a.set(n,i)),i.add(t,r))},Du.prototype.remove=function(e){var t,a=this._solidBatches.values,i=a.length;for(t=0;t<i;t++)if(a[t].remove(e))return;var r=this._translucentBatches.values,n=r.length;for(t=0;t<n;t++)if(r[t].remove(e))return},Du.prototype.update=function(e){var t,a,i,r,n,o=this._solidBatches.values,s=o.length,l=this._translucentBatches.values,u=l.length,d=!0,f=!1;do{for(f=!1,a=0;a<s;a++){d=(r=o[a]).update(e);var c=(n=r.itemsToRemove).length;if(c>0)for(f=!0,t=0;t<c;t++)i=n[t],r.remove(i),this.add(e,i)}for(a=0;a<u;a++){d=(r=l[a]).update(e);var h=(n=r.itemsToRemove).length;if(h>0)for(f=!0,t=0;t<h;t++)i=n[t],r.remove(i),this.add(e,i)}}while(f);return d},Du.prototype.getBoundingSphere=function(e,t){var a,i=this._solidBatches.values,r=i.length;for(a=0;a<r;a++){var n=i[a];if(n.contains(e))return n.getBoundingSphere(e,t)}var o=this._translucentBatches.values,s=o.length;for(a=0;a<s;a++){var l=o[a];if(l.contains(e))return l.getBoundingSphere(e,t)}return A.default.FAILED},Du.prototype.removeAllPrimitives=function(){var e,t=this._solidBatches.values,a=t.length;for(e=0;e<a;e++)t[e].removeAllPrimitives();var i=this._translucentBatches.values,r=i.length;for(e=0;e<r;e++)i[e].removeAllPrimitives()};var Iu=Du,Mu={};function Fu(e,t){return Ve.default.equalsEpsilon(e.latitude,t.latitude,Ve.default.EPSILON14)&&Ve.default.equalsEpsilon(e.longitude,t.longitude,Ve.default.EPSILON14)}var Ru=new je.default,Nu=new je.default;var Lu=new Array(2),ju=new Array(2),Vu={positions:void 0,height:void 0,granularity:void 0,ellipsoid:void 0};Mu.computePositions=function(e,t,a,i,r,n){var o=function(e,t,a,i){var r=t.length;if(!(r<2)){var n=Object(s.default)(i),o=Object(s.default)(a),l=!0,u=new Array(r),d=new Array(r),f=new Array(r),c=t[0];u[0]=c;var h=e.cartesianToCartographic(c,Ru);o&&(h.height=a[0]),l=l&&h.height<=0,d[0]=h.height,f[0]=n?i[0]:0;for(var m=1,p=1;p<r;++p){var _=t[p],g=e.cartesianToCartographic(_,Nu);o&&(g.height=a[p]),l=l&&g.height<=0,Fu(h,g)?h.height<g.height&&(d[m-1]=g.height):(u[m]=_,d[m]=g.height,f[m]=n?i[p]:0,je.default.clone(g,h),++m)}if(!(l||m<2))return u.length=m,d.length=m,f.length=m,{positions:u,topHeights:d,bottomHeights:f}}}(e,t,a,i);if(Object(s.default)(o)){if(t=o.positions,a=o.topHeights,i=o.bottomHeights,t.length>=3){var l=nt.default.fromPoints(t,e).projectPointsOntoPlane(t);ba.a.computeWindingOrder2D(l)===po.default.CLOCKWISE&&(t.reverse(),a.reverse(),i.reverse())}var u,d,f=t.length,c=f-2,h=Ve.default.chordLength(r,e.maximumRadius),m=Vu;if(m.minDistance=h,m.ellipsoid=e,n){var p,_=0;for(p=0;p<f-1;p++)_+=it.a.numberOfPoints(t[p],t[p+1],h)+1;u=new Float64Array(3*_),d=new Float64Array(3*_);var g=Lu,v=ju;m.positions=g,m.height=v;var y=0;for(p=0;p<f-1;p++){g[0]=t[p],g[1]=t[p+1],v[0]=a[p],v[1]=a[p+1];var b=it.a.generateArc(m);u.set(b,y),v[0]=i[p],v[1]=i[p+1],d.set(it.a.generateArc(m),y),y+=b.length}}else m.positions=t,m.height=a,u=new Float64Array(it.a.generateArc(m)),m.height=i,d=new Float64Array(it.a.generateArc(m));return{bottomPositions:d,topPositions:u,numCorners:c}}};var Uu=Mu,zu=new y.default,Bu=new y.default,Hu=new y.default,ku=new y.default,Gu=new y.default,Wu=new y.default,Yu=new y.default,Xu=new y.default;function Qu(e){var t=(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).positions,a=e.maximumHeights,i=e.minimumHeights,r=Object(o.default)(e.vertexFormat,$.default.DEFAULT),n=Object(o.default)(e.granularity,Ve.default.RADIANS_PER_DEGREE),l=Object(o.default)(e.ellipsoid,pa.default.WGS84);this._positions=t,this._minimumHeights=i,this._maximumHeights=a,this._vertexFormat=$.default.clone(r),this._granularity=n,this._ellipsoid=pa.default.clone(l),this._workerName="createWallGeometry";var u=1+t.length*y.default.packedLength+2;Object(s.default)(i)&&(u+=i.length),Object(s.default)(a)&&(u+=a.length),this.packedLength=u+pa.default.packedLength+$.default.packedLength+1}Qu.pack=function(e,t,a){var i;a=Object(o.default)(a,0);var r=e._positions,n=r.length;for(t[a++]=n,i=0;i<n;++i,a+=y.default.packedLength)y.default.pack(r[i],t,a);var l=e._minimumHeights;if(n=Object(s.default)(l)?l.length:0,t[a++]=n,Object(s.default)(l))for(i=0;i<n;++i)t[a++]=l[i];var u=e._maximumHeights;if(n=Object(s.default)(u)?u.length:0,t[a++]=n,Object(s.default)(u))for(i=0;i<n;++i)t[a++]=u[i];return pa.default.pack(e._ellipsoid,t,a),a+=pa.default.packedLength,$.default.pack(e._vertexFormat,t,a),t[a+=$.default.packedLength]=e._granularity,t};var qu=pa.default.clone(pa.default.UNIT_SPHERE),Zu=new $.default,Ku={positions:void 0,minimumHeights:void 0,maximumHeights:void 0,ellipsoid:qu,vertexFormat:Zu,granularity:void 0};Qu.unpack=function(e,t,a){var i;t=Object(o.default)(t,0);var r,n,l=e[t++],u=new Array(l);for(i=0;i<l;++i,t+=y.default.packedLength)u[i]=y.default.unpack(e,t);if((l=e[t++])>0)for(r=new Array(l),i=0;i<l;++i)r[i]=e[t++];if((l=e[t++])>0)for(n=new Array(l),i=0;i<l;++i)n[i]=e[t++];var d=pa.default.unpack(e,t,qu);t+=pa.default.packedLength;var f=$.default.unpack(e,t,Zu),c=e[t+=$.default.packedLength];return Object(s.default)(a)?(a._positions=u,a._minimumHeights=r,a._maximumHeights=n,a._ellipsoid=pa.default.clone(d,a._ellipsoid),a._vertexFormat=$.default.clone(f,a._vertexFormat),a._granularity=c,a):(Ku.positions=u,Ku.minimumHeights=r,Ku.maximumHeights=n,Ku.granularity=c,new Qu(Ku))},Qu.fromConstantHeights=function(e){var t,a,i=(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).positions,r=e.minimumHeight,n=e.maximumHeight,l=Object(s.default)(r),u=Object(s.default)(n);if(l||u){var d=i.length;t=l?new Array(d):void 0,a=u?new Array(d):void 0;for(var f=0;f<d;++f)l&&(t[f]=r),u&&(a[f]=n)}return new Qu({positions:i,maximumHeights:a,minimumHeights:t,ellipsoid:e.ellipsoid,vertexFormat:e.vertexFormat})},Qu.createGeometry=function(e){var t=e._positions,a=e._minimumHeights,i=e._maximumHeights,n=e._vertexFormat,o=e._granularity,l=e._ellipsoid,u=Uu.computePositions(l,t,i,a,o,!0);if(Object(s.default)(u)){var d,f=u.bottomPositions,c=u.topPositions,h=u.numCorners,m=c.length,p=2*m,_=n.position?new Float64Array(p):void 0,g=n.normal?new Float32Array(p):void 0,v=n.tangent?new Float32Array(p):void 0,b=n.bitangent?new Float32Array(p):void 0,w=n.st?new Float32Array(p/3*2):void 0,O=0,x=0,C=0,T=0,E=0,A=Xu,S=Yu,P=Wu,D=!0,I=0,M=1/((m/=3)-t.length+1);for(d=0;d<m;++d){var F=3*d,R=y.default.fromArray(c,F,zu),N=y.default.fromArray(f,F,Bu);if(n.position&&(_[O++]=N.x,_[O++]=N.y,_[O++]=N.z,_[O++]=R.x,_[O++]=R.y,_[O++]=R.z),n.st&&(w[E++]=I,w[E++]=0,w[E++]=I,w[E++]=1),n.normal||n.tangent||n.bitangent){var L,j=y.default.clone(y.default.ZERO,Gu),V=l.scaleToGeodeticSurface(y.default.fromArray(c,F,Bu),Bu);if(d+1<m&&(L=l.scaleToGeodeticSurface(y.default.fromArray(c,F+3,Hu),Hu),j=y.default.fromArray(c,F+3,Gu)),D){var U=y.default.subtract(j,R,ku),z=y.default.subtract(V,R,zu);A=y.default.normalize(y.default.cross(z,U,A),A),D=!1}y.default.equalsEpsilon(L,V,Ve.default.EPSILON10)?D=!0:(I+=M,n.tangent&&(S=y.default.normalize(y.default.subtract(L,V,S),S)),n.bitangent&&(P=y.default.normalize(y.default.cross(A,S,P),P))),n.normal&&(g[x++]=A.x,g[x++]=A.y,g[x++]=A.z,g[x++]=A.x,g[x++]=A.y,g[x++]=A.z),n.tangent&&(v[T++]=S.x,v[T++]=S.y,v[T++]=S.z,v[T++]=S.x,v[T++]=S.y,v[T++]=S.z),n.bitangent&&(b[C++]=P.x,b[C++]=P.y,b[C++]=P.z,b[C++]=P.x,b[C++]=P.y,b[C++]=P.z)}}var B=new va.a;n.position&&(B.position=new ga.a({componentDatatype:ue.a.DOUBLE,componentsPerAttribute:3,values:_})),n.normal&&(B.normal=new ga.a({componentDatatype:ue.a.FLOAT,componentsPerAttribute:3,values:g})),n.tangent&&(B.tangent=new ga.a({componentDatatype:ue.a.FLOAT,componentsPerAttribute:3,values:v})),n.bitangent&&(B.bitangent=new ga.a({componentDatatype:ue.a.FLOAT,componentsPerAttribute:3,values:b})),n.st&&(B.st=new ga.a({componentDatatype:ue.a.FLOAT,componentsPerAttribute:2,values:w}));var H=p/3;p-=6*(h+1);var k=ya.a.createTypedArray(H,p),G=0;for(d=0;d<H-2;d+=2){var W=d,Y=d+2,X=y.default.fromArray(_,3*W,zu),Q=y.default.fromArray(_,3*Y,Bu);if(!y.default.equalsEpsilon(X,Q,Ve.default.EPSILON10)){var q=d+1,Z=d+3;k[G++]=q,k[G++]=W,k[G++]=Z,k[G++]=Z,k[G++]=W,k[G++]=Y}}return new _a.a({attributes:B,indices:k,primitiveType:wa.a.TRIANGLES,boundingSphere:new r.default.fromVertices(_)})}};var Ju=Qu,$u=new y.default,ed=new y.default;function td(e){var t=(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).positions,a=e.maximumHeights,i=e.minimumHeights,r=Object(o.default)(e.granularity,Ve.default.RADIANS_PER_DEGREE),n=Object(o.default)(e.ellipsoid,pa.default.WGS84);this._positions=t,this._minimumHeights=i,this._maximumHeights=a,this._granularity=r,this._ellipsoid=pa.default.clone(n),this._workerName="createWallOutlineGeometry";var l=1+t.length*y.default.packedLength+2;Object(s.default)(i)&&(l+=i.length),Object(s.default)(a)&&(l+=a.length),this.packedLength=l+pa.default.packedLength+1}td.pack=function(e,t,a){var i;a=Object(o.default)(a,0);var r=e._positions,n=r.length;for(t[a++]=n,i=0;i<n;++i,a+=y.default.packedLength)y.default.pack(r[i],t,a);var l=e._minimumHeights;if(n=Object(s.default)(l)?l.length:0,t[a++]=n,Object(s.default)(l))for(i=0;i<n;++i)t[a++]=l[i];var u=e._maximumHeights;if(n=Object(s.default)(u)?u.length:0,t[a++]=n,Object(s.default)(u))for(i=0;i<n;++i)t[a++]=u[i];return pa.default.pack(e._ellipsoid,t,a),t[a+=pa.default.packedLength]=e._granularity,t};var ad=pa.default.clone(pa.default.UNIT_SPHERE),id={positions:void 0,minimumHeights:void 0,maximumHeights:void 0,ellipsoid:ad,granularity:void 0};td.unpack=function(e,t,a){var i;t=Object(o.default)(t,0);var r,n,l=e[t++],u=new Array(l);for(i=0;i<l;++i,t+=y.default.packedLength)u[i]=y.default.unpack(e,t);if((l=e[t++])>0)for(r=new Array(l),i=0;i<l;++i)r[i]=e[t++];if((l=e[t++])>0)for(n=new Array(l),i=0;i<l;++i)n[i]=e[t++];var d=pa.default.unpack(e,t,ad),f=e[t+=pa.default.packedLength];return Object(s.default)(a)?(a._positions=u,a._minimumHeights=r,a._maximumHeights=n,a._ellipsoid=pa.default.clone(d,a._ellipsoid),a._granularity=f,a):(id.positions=u,id.minimumHeights=r,id.maximumHeights=n,id.granularity=f,new td(id))},td.fromConstantHeights=function(e){var t,a,i=(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).positions,r=e.minimumHeight,n=e.maximumHeight,l=Object(s.default)(r),u=Object(s.default)(n);if(l||u){var d=i.length;t=l?new Array(d):void 0,a=u?new Array(d):void 0;for(var f=0;f<d;++f)l&&(t[f]=r),u&&(a[f]=n)}return new td({positions:i,maximumHeights:a,minimumHeights:t,ellipsoid:e.ellipsoid})},td.createGeometry=function(e){var t=e._positions,a=e._minimumHeights,i=e._maximumHeights,n=e._granularity,o=e._ellipsoid,l=Uu.computePositions(o,t,i,a,n,!1);if(Object(s.default)(l)){var u,d=l.bottomPositions,f=l.topPositions,c=f.length,h=2*c,m=new Float64Array(h),p=0;for(c/=3,u=0;u<c;++u){var _=3*u,g=y.default.fromArray(f,_,$u),v=y.default.fromArray(d,_,ed);m[p++]=v.x,m[p++]=v.y,m[p++]=v.z,m[p++]=g.x,m[p++]=g.y,m[p++]=g.z}var b=new va.a({position:new ga.a({componentDatatype:ue.a.DOUBLE,componentsPerAttribute:3,values:m})}),w=h/3;h=2*w-4+w;var O=ya.a.createTypedArray(w,h),x=0;for(u=0;u<w-2;u+=2){var C=u,T=u+2,E=y.default.fromArray(m,3*C,$u),A=y.default.fromArray(m,3*T,ed);if(!y.default.equalsEpsilon(E,A,Ve.default.EPSILON10)){var S=u+1,P=u+3;O[x++]=S,O[x++]=C,O[x++]=S,O[x++]=P,O[x++]=C,O[x++]=T}}return O[x++]=w-2,O[x++]=w-1,new _a.a({attributes:b,indices:O,primitiveType:wa.a.LINES,boundingSphere:new r.default.fromVertices(m)})}};var rd=td,nd=new b.default;function od(e){this.id=e,this.vertexFormat=void 0,this.positions=void 0,this.minimumHeights=void 0,this.maximumHeights=void 0,this.granularity=void 0}function sd(e,t){Ne.call(this,{entity:e,scene:t,geometryOptions:new od(e),geometryPropertyName:"wall",observedPropertyNames:["availability","wall"]}),this._onEntityPropertyChanged(e,"wall",e.wall,void 0)}function ld(e,t,a){Oe.call(this,e,t,a)}Object(s.default)(Object.create)&&(sd.prototype=Object.create(Ne.prototype),sd.prototype.constructor=sd),sd.prototype.createFillGeometryInstance=function(e){var t,a,i=this._entity,r=i.isAvailable(e),n=new _e.a(r&&i.isShowing&&this._showProperty.getValue(e)&&this._fillProperty.getValue(e)),o=this._distanceDisplayConditionProperty.getValue(e),l=fe.fromDistanceDisplayCondition(o);this._materialProperty instanceof ge.default?(Object(s.default)(this._materialProperty.color)&&(this._materialProperty.color.isConstant||r)&&(a=this._materialProperty.color.getValue(e,nd)),Object(s.default)(a)||(a=b.default.WHITE),t={show:n,distanceDisplayCondition:l,color:le.a.fromColor(a)}):t={show:n,distanceDisplayCondition:l};return new ce.a({id:i,geometry:new Ju(this._options),attributes:t})},sd.prototype.createOutlineGeometryInstance=function(e){var t=this._entity,a=t.isAvailable(e),i=S.default.getValueOrDefault(this._outlineColorProperty,e,b.default.BLACK,nd),r=this._distanceDisplayConditionProperty.getValue(e);return new ce.a({id:t,geometry:new rd(this._options),attributes:{show:new _e.a(a&&t.isShowing&&this._showProperty.getValue(e)&&this._showOutlineProperty.getValue(e)),color:le.a.fromColor(i),distanceDisplayCondition:fe.fromDistanceDisplayCondition(r)}})},sd.prototype._isHidden=function(e,t){return!Object(s.default)(t.positions)||Ne.prototype._isHidden.call(this,e,t)},sd.prototype._getIsClosed=function(e){return!1},sd.prototype._isDynamic=function(e,t){return!(t.positions.isConstant&&S.default.isConstant(t.minimumHeights)&&S.default.isConstant(t.maximumHeights)&&S.default.isConstant(t.outlineWidth)&&S.default.isConstant(t.granularity))},sd.prototype._setStaticOptions=function(e,t){var a=t.minimumHeights,i=t.maximumHeights,r=t.granularity,n=this._materialProperty instanceof ge.default,o=this._options;o.vertexFormat=n?re.a.VERTEX_FORMAT:ie.MaterialSupport.TEXTURED.vertexFormat,o.positions=t.positions.getValue(me.default.MINIMUM_VALUE,o.positions),o.minimumHeights=Object(s.default)(a)?a.getValue(me.default.MINIMUM_VALUE,o.minimumHeights):void 0,o.maximumHeights=Object(s.default)(i)?i.getValue(me.default.MINIMUM_VALUE,o.maximumHeights):void 0,o.granularity=Object(s.default)(r)?r.getValue(me.default.MINIMUM_VALUE):void 0},sd.DynamicGeometryUpdater=ld,Object(s.default)(Object.create)&&(ld.prototype=Object.create(Oe.prototype),ld.prototype.constructor=ld),ld.prototype._isHidden=function(e,t,a){return!Object(s.default)(this._options.positions)||Oe.prototype._isHidden.call(this,e,t,a)},ld.prototype._setOptions=function(e,t,a){var i=this._options;i.positions=S.default.getValueOrUndefined(t.positions,a,i.positions),i.minimumHeights=S.default.getValueOrUndefined(t.minimumHeights,a,i.minimumHeights),i.maximumHeights=S.default.getValueOrUndefined(t.maximumHeights,a,i.maximumHeights),i.granularity=S.default.getValueOrUndefined(t.granularity,a)};var ud=[],dd=[Je,Vi,mi,Xr,sn,In,hs,Ps,bl,sd];function fd(e,t){this.entity=e,this.scene=t;var a=new Array(dd.length),i=new Z.default;function r(e){i.raiseEvent(e)}for(var n=new d.default,o=0;o<a.length;o++){var s=new dd[o](e,t);n.add(s.geometryChanged,r),a[o]=s}this.updaters=a,this.geometryChanged=i,this.eventHelper=n,this._removeEntitySubscription=e.definitionChanged.addEventListener(fd.prototype._onEntityPropertyChanged,this)}function cd(e,t,a,i){a=Object(o.default)(a,e.primitives),i=Object(o.default)(i,e.groundPrimitives),this._scene=e,this._primitives=a,this._groundPrimitives=i,this._entityCollection=void 0,this._addedObjects=new _.default,this._removedObjects=new _.default,this._changedObjects=new _.default;var r=ne.default.NUMBER_OF_SHADOW_MODES;this._outlineBatches=new Array(2*r),this._closedColorBatches=new Array(2*r),this._closedMaterialBatches=new Array(2*r),this._openColorBatches=new Array(2*r),this._openMaterialBatches=new Array(2*r);var n,s=Te.default.supportsMaterialsforEntitiesOnTerrain(e);for(this._supportsMaterialsforEntitiesOnTerrain=s,n=0;n<r;++n)this._outlineBatches[n]=new Iu(a,e,n,!1),this._outlineBatches[r+n]=new Iu(a,e,n,!0),this._closedColorBatches[n]=new Fl(a,re.a,void 0,!0,n,!0),this._closedColorBatches[r+n]=new Fl(a,re.a,void 0,!0,n,!1),this._closedMaterialBatches[n]=new Bl(a,ie,void 0,!0,n,!0),this._closedMaterialBatches[r+n]=new Bl(a,ie,void 0,!0,n,!1),this._openColorBatches[n]=new Fl(a,re.a,void 0,!1,n,!0),this._openColorBatches[r+n]=new Fl(a,re.a,void 0,!1,n,!1),this._openMaterialBatches[n]=new Bl(a,ie,void 0,!1,n,!0),this._openMaterialBatches[r+n]=new Bl(a,ie,void 0,!1,n,!1);var l=K.a.NUMBER_OF_CLASSIFICATION_TYPES,u=new Array(l),d=[];if(s)for(n=0;n<l;++n)d.push(new xu(i,n,ie)),u[n]=new xu(i,n,re.a);else for(n=0;n<l;++n)u[n]=new Ql(i,n);this._groundColorBatches=u,this._groundMaterialBatches=d,this._dynamicBatch=new zi(a,i),this._batches=this._outlineBatches.concat(this._closedColorBatches,this._closedMaterialBatches,this._openColorBatches,this._openMaterialBatches,this._groundColorBatches,this._groundMaterialBatches,this._dynamicBatch),this._subscriptions=new _.default,this._updaterSets=new _.default,this._entityCollection=t,t.collectionChanged.addEventListener(cd.prototype._onCollectionChanged,this),this._onCollectionChanged(t,t.values,ud)}fd.prototype._onEntityPropertyChanged=function(e,t,a,i){for(var r=this.updaters,n=0;n<r.length;n++)r[n]._onEntityPropertyChanged(e,t,a,i)},fd.prototype.forEach=function(e){for(var t=this.updaters,a=0;a<t.length;a++)e(t[a])},fd.prototype.destroy=function(){this.eventHelper.removeAll();for(var e=this.updaters,t=0;t<e.length;t++)e[t].destroy();this._removeEntitySubscription(),Object(u.default)(this)},cd.prototype.update=function(e){var t,a,i,r,n=this._addedObjects,o=n.values,s=this._removedObjects,l=s.values,u=this._changedObjects,d=u.values,f=this;for(t=d.length-1;t>-1;t--)i=(a=d[t]).id,(r=this._updaterSets.get(i)).entity===a?r.forEach((function(t){f._removeUpdater(t),f._insertUpdaterIntoBatch(e,t)})):(l.push(a),o.push(a));for(t=l.length-1;t>-1;t--)i=(a=l[t]).id,(r=this._updaterSets.get(i)).forEach(this._removeUpdater.bind(this)),r.destroy(),this._updaterSets.remove(i),this._subscriptions.get(i)(),this._subscriptions.remove(i);for(t=o.length-1;t>-1;t--)i=(a=o[t]).id,r=new fd(a,this._scene),this._updaterSets.set(i,r),r.forEach((function(t){f._insertUpdaterIntoBatch(e,t)})),this._subscriptions.set(i,r.geometryChanged.addEventListener(cd._onGeometryChanged,this));n.removeAll(),s.removeAll(),u.removeAll();var c=!0,h=this._batches,m=h.length;for(t=0;t<m;t++)c=h[t].update(e)&&c;return c};var hd=[],md=new r.default;cd.prototype.getBoundingSphere=function(e,t){for(var a=hd,i=md,n=0,o=A.default.DONE,s=this._batches,l=s.length,u=e.id,d=this._updaterSets.get(u).updaters,f=0;f<d.length;f++)for(var c=d[f],h=0;h<l;h++){if((o=s[h].getBoundingSphere(c,i))===A.default.PENDING)return A.default.PENDING;o===A.default.DONE&&(a[n]=r.default.clone(i,a[n]),n++)}return 0===n?A.default.FAILED:(a.length=n,r.default.fromBoundingSpheres(a,t),A.default.DONE)},cd.prototype.isDestroyed=function(){return!1},cd.prototype.destroy=function(){var e;this._entityCollection.collectionChanged.removeEventListener(cd.prototype._onCollectionChanged,this),this._addedObjects.removeAll(),this._removedObjects.removeAll();var t=this._batches,a=t.length;for(e=0;e<a;e++)t[e].removeAllPrimitives();var i=this._subscriptions.values;for(a=i.length,e=0;e<a;e++)i[e]();this._subscriptions.removeAll();var r=this._updaterSets.values;for(a=r.length,e=0;e<a;e++)r[e].destroy();return this._updaterSets.removeAll(),Object(u.default)(this)},cd.prototype._removeUpdater=function(e){for(var t=this._batches,a=t.length,i=0;i<a;i++)t[i].remove(e)},cd.prototype._insertUpdaterIntoBatch=function(e,t){if(t.isDynamic)this._dynamicBatch.add(e,t);else{var a;(t.outlineEnabled||t.fillEnabled)&&(a=t.shadowsProperty.getValue(e));var i=ne.default.NUMBER_OF_SHADOW_MODES;if(t.outlineEnabled&&(Object(s.default)(t.terrainOffsetProperty)?this._outlineBatches[i+a].add(e,t):this._outlineBatches[a].add(e,t)),t.fillEnabled)if(t.onTerrain){var r=t.classificationTypeProperty.getValue(e);t.fillMaterialProperty instanceof ge.default?this._groundColorBatches[r].add(e,t):this._groundMaterialBatches[r].add(e,t)}else t.isClosed?t.fillMaterialProperty instanceof ge.default?Object(s.default)(t.terrainOffsetProperty)?this._closedColorBatches[i+a].add(e,t):this._closedColorBatches[a].add(e,t):Object(s.default)(t.terrainOffsetProperty)?this._closedMaterialBatches[i+a].add(e,t):this._closedMaterialBatches[a].add(e,t):t.fillMaterialProperty instanceof ge.default?Object(s.default)(t.terrainOffsetProperty)?this._openColorBatches[i+a].add(e,t):this._openColorBatches[a].add(e,t):Object(s.default)(t.terrainOffsetProperty)?this._openMaterialBatches[i+a].add(e,t):this._openMaterialBatches[a].add(e,t)}},cd._onGeometryChanged=function(e){var t=this._removedObjects,a=this._changedObjects,i=e.entity,r=i.id;Object(s.default)(t.get(r))||Object(s.default)(a.get(r))||a.set(r,i)},cd.prototype._onCollectionChanged=function(e,t,a){var i,r,n,o=this._addedObjects,s=this._removedObjects,l=this._changedObjects;for(i=a.length-1;i>-1;i--)r=(n=a[i]).id,o.remove(r)||(s.set(r,n),l.remove(r));for(i=t.length-1;i>-1;i--)r=(n=t[i]).id,s.remove(r)?l.set(r,n):o.set(r,n)};var pd=cd,_d=a(232),gd=_d.a.FILL,vd=b.default.WHITE,yd=b.default.BLACK,bd=new b.default(.165,.165,.165,.8),wd=new v.default(7,5),Od=v.default.ZERO,xd=y.default.ZERO,Cd=C.default.NONE,Td=T.default.CENTER,Ed=E.default.CENTER,Ad=new y.default,Sd=new b.default,Pd=new b.default,Dd=new b.default,Id=new v.default,Md=new y.default,Fd=new v.default,Rd=new x.a,Nd=new x.a,Ld=new x.a,jd=new O.a;function Vd(e){this.entity=e,this.label=void 0,this.index=void 0}function Ud(e,t){t.collectionChanged.addEventListener(Ud.prototype._onCollectionChanged,this),this._cluster=e,this._entityCollection=t,this._items=new _.default,this._onCollectionChanged(t,t.values,[],[])}function zd(e,t,a){Object(s.default)(e)&&(e.label=void 0,a.removeLabel(t))}Ud.prototype.update=function(e){for(var t=this._items.values,a=this._cluster,i=0,r=t.length;i<r;i++){var n,o,l=t[i],u=l.entity,d=u._label,f=l.label,c=u.isShowing&&u.isAvailable(e)&&S.default.getValueOrDefault(d._show,e,!0);if(c&&(o=S.default.getValueOrUndefined(u._position,e,Ad),n=S.default.getValueOrUndefined(d._text,e),c=Object(s.default)(o)&&Object(s.default)(n)),c){S.default.isConstant(u._position)||(a._clusterDirty=!0);var h=!1,m=S.default.getValueOrDefault(d._heightReference,e,Cd);Object(s.default)(f)||((f=a.getLabel(u)).id=u,l.label=f,h=y.default.equals(f.position,o)&&f.heightReference===m),f.show=!0,f.position=o,f.text=n,f.scale=S.default.getValueOrDefault(d._scale,e,1),f.font=S.default.getValueOrDefault(d._font,e,"30px sans-serif"),f.style=S.default.getValueOrDefault(d._style,e,gd),f.fillColor=S.default.getValueOrDefault(d._fillColor,e,vd,Sd),f.outlineColor=S.default.getValueOrDefault(d._outlineColor,e,yd,Pd),f.outlineWidth=S.default.getValueOrDefault(d._outlineWidth,e,1),f.showBackground=S.default.getValueOrDefault(d._showBackground,e,!1),f.backgroundColor=S.default.getValueOrDefault(d._backgroundColor,e,bd,Dd),f.backgroundPadding=S.default.getValueOrDefault(d._backgroundPadding,e,wd,Id),f.pixelOffset=S.default.getValueOrDefault(d._pixelOffset,e,Od,Fd),f.eyeOffset=S.default.getValueOrDefault(d._eyeOffset,e,xd,Md),f.heightReference=m,f.horizontalOrigin=S.default.getValueOrDefault(d._horizontalOrigin,e,Td),f.verticalOrigin=S.default.getValueOrDefault(d._verticalOrigin,e,Ed),f.translucencyByDistance=S.default.getValueOrUndefined(d._translucencyByDistance,e,Rd),f.pixelOffsetScaleByDistance=S.default.getValueOrUndefined(d._pixelOffsetScaleByDistance,e,Nd),f.scaleByDistance=S.default.getValueOrUndefined(d._scaleByDistance,e,Ld),f.distanceDisplayCondition=S.default.getValueOrUndefined(d._distanceDisplayCondition,e,jd),f.disableDepthTestDistance=S.default.getValueOrUndefined(d._disableDepthTestDistance,e),h&&f._updateClamping()}else zd(l,u,a)}return!0},Ud.prototype.getBoundingSphere=function(e,t){var a=this._items.get(e.id);if(!Object(s.default)(a)||!Object(s.default)(a.label))return A.default.FAILED;var i=a.label;return t.center=y.default.clone(Object(o.default)(i._clampedPosition,i.position),t.center),t.radius=0,A.default.DONE},Ud.prototype.isDestroyed=function(){return!1},Ud.prototype.destroy=function(){this._entityCollection.collectionChanged.removeEventListener(Ud.prototype._onCollectionChanged,this);for(var e=this._entityCollection.values,t=0;t<e.length;t++)this._cluster.removeLabel(e[t]);return Object(u.default)(this)},Ud.prototype._onCollectionChanged=function(e,t,a,i){var r,n,o=this._items,l=this._cluster;for(r=t.length-1;r>-1;r--)n=t[r],Object(s.default)(n._label)&&Object(s.default)(n._position)&&o.set(n.id,new Vd(n));for(r=i.length-1;r>-1;r--)n=i[r],Object(s.default)(n._label)&&Object(s.default)(n._position)?o.contains(n.id)||o.set(n.id,new Vd(n)):(zd(o.get(n.id),n,l),o.remove(n.id));for(r=a.length-1;r>-1;r--)n=a[r],zd(o.get(n.id),n,l),o.remove(n.id)};var Bd=Ud,Hd=a(186),kd=a(41),Gd=a(439),Wd=a(283),Yd=a(441),Xd=ne.default.ENABLED,Qd=C.default.NONE,qd=b.default.RED,Zd=b.default.WHITE,Kd=Gd.a.HIGHLIGHT,Jd=new v.default(1,1),$d=Hd.default.Y,ef=new ot.default,tf=new ot.default;function af(e,t){t.collectionChanged.addEventListener(af.prototype._onCollectionChanged,this),this._scene=e,this._primitives=e.primitives,this._entityCollection=t,this._modelHash={},this._entitiesToVisualize=new _.default,this._onCollectionChanged(t,t.values,[],[])}function rf(e,t,a,i){var r=a[t.id];Object(s.default)(r)&&(i.removeAndDestroy(r.modelPrimitive),delete a[t.id])}function nf(e,t){var a=t[e.id];Object(s.default)(a)&&(a.nodeTransformationsScratch={},a.articulationsScratch={})}function of(e,t,a){e.readyPromise.otherwise((function(e){console.error(e),a[t.id].loadFail=!0}))}af.prototype.update=function(e){for(var t=this._entitiesToVisualize.values,a=this._modelHash,i=this._primitives,r=0,n=t.length;r<n;r++){var o,l,u=t[r],d=u._model,f=a[u.id],c=u.isShowing&&u.isAvailable(e)&&S.default.getValueOrDefault(d._show,e,!0);if(c&&(l=u.computeModelMatrix(e,ef),o=kd.default.createIfNeeded(S.default.getValueOrUndefined(d._uri,e)),c=Object(s.default)(l)&&Object(s.default)(o)),c){var h=Object(s.default)(f)?f.modelPrimitive:void 0;if(Object(s.default)(h)&&o.url===f.url||(Object(s.default)(h)&&(i.removeAndDestroy(h),delete a[u.id]),(h=Wd.default.fromGltf({url:o,incrementallyLoadTextures:S.default.getValueOrDefault(d._incrementallyLoadTextures,e,!0),scene:this._scene})).id=u,i.add(h),f={modelPrimitive:h,url:o.url,animationsRunning:!1,nodeTransformationsScratch:{},articulationsScratch:{},loadFail:!1},a[u.id]=f,of(h,u,a)),h.show=!0,h.scale=S.default.getValueOrDefault(d._scale,e,1),h.minimumPixelSize=S.default.getValueOrDefault(d._minimumPixelSize,e,0),h.maximumScale=S.default.getValueOrUndefined(d._maximumScale,e),h.modelMatrix=ot.default.clone(l,h.modelMatrix),h.shadows=S.default.getValueOrDefault(d._shadows,e,Xd),h.heightReference=S.default.getValueOrDefault(d._heightReference,e,Qd),h.distanceDisplayCondition=S.default.getValueOrUndefined(d._distanceDisplayCondition,e),h.silhouetteColor=S.default.getValueOrDefault(d._silhouetteColor,e,qd,h._silhouetteColor),h.silhouetteSize=S.default.getValueOrDefault(d._silhouetteSize,e,0),h.color=S.default.getValueOrDefault(d._color,e,Zd,h._color),h.colorBlendMode=S.default.getValueOrDefault(d._colorBlendMode,e,Kd),h.colorBlendAmount=S.default.getValueOrDefault(d._colorBlendAmount,e,.5),h.clippingPlanes=S.default.getValueOrUndefined(d._clippingPlanes,e),h.clampAnimations=S.default.getValueOrDefault(d._clampAnimations,e,!0),h.imageBasedLightingFactor=S.default.getValueOrDefault(d._imageBasedLightingFactor,e,Jd),h.lightColor=S.default.getValueOrUndefined(d._lightColor,e),h._upAxis=S.default.getValueOrDefault(d._upAxis,e,$d),h._forwardAxis=S.default.getValueOrUndefined(d._forwardAxis,e),h.ready){var m=S.default.getValueOrDefault(d._runAnimations,e,!0);f.animationsRunning!==m&&(m?h.activeAnimations.addAll({loop:Yd.a.REPEAT}):h.activeAnimations.removeAll(),f.animationsRunning=m);var p=S.default.getValueOrUndefined(d._nodeTransformations,e,f.nodeTransformationsScratch);if(Object(s.default)(p))for(var _=Object.keys(p),g=0,v=_.length;g<v;++g){var y=_[g],b=p[y];if(Object(s.default)(b)){var w=h.getNode(y);if(Object(s.default)(w)){var O=ot.default.fromTranslationRotationScale(b,tf);w.matrix=ot.default.multiply(w.originalMatrix,O,O)}}}var x=!1,C=S.default.getValueOrUndefined(d._articulations,e,f.articulationsScratch);if(Object(s.default)(C))for(var T=Object.keys(C),E=0,A=T.length;E<A;++E){var P=T[E],D=C[P];Object(s.default)(D)&&(x=!0,h.setArticulationStage(P,D))}x&&h.applyArticulations()}}else Object(s.default)(f)&&(f.modelPrimitive.show=!1)}return!0},af.prototype.isDestroyed=function(){return!1},af.prototype.destroy=function(){this._entityCollection.collectionChanged.removeEventListener(af.prototype._onCollectionChanged,this);for(var e=this._entitiesToVisualize.values,t=this._modelHash,a=this._primitives,i=e.length-1;i>-1;i--)rf(this,e[i],t,a);return Object(u.default)(this)},af.prototype.getBoundingSphere=function(e,t){var a=this._modelHash[e.id];if(!Object(s.default)(a)||a.loadFail)return A.default.FAILED;var i=a.modelPrimitive;if(!Object(s.default)(i)||!i.show)return A.default.FAILED;if(!i.ready)return A.default.PENDING;if(i.heightReference===C.default.NONE)r.default.transform(i.boundingSphere,i.modelMatrix,t);else{if(!Object(s.default)(i._clampedModelMatrix)||i._heightChanged)return A.default.PENDING;r.default.transform(i.boundingSphere,i._clampedModelMatrix,t)}return A.default.DONE},af.prototype._onCollectionChanged=function(e,t,a,i){var r,n,o=this._entitiesToVisualize,l=this._modelHash,u=this._primitives;for(r=t.length-1;r>-1;r--)n=t[r],Object(s.default)(n._model)&&Object(s.default)(n._position)&&o.set(n.id,n);for(r=i.length-1;r>-1;r--)n=i[r],Object(s.default)(n._model)&&Object(s.default)(n._position)?(nf(n,l),o.set(n.id,n)):(rf(this,n,l,u),o.remove(n.id));for(r=a.length-1;r>-1;r--)rf(this,n=a[r],l,u),o.remove(n.id)};var sf=af,lf=a(44),uf=a(142),df=a(105),ff=a(514),cf=a(361),hf=a(321),mf=a(362),pf=a(329),_f=a(504),gf=a(427),vf=new df.default,yf=new df.default,bf=new df.default;function wf(e){this.entity=e,this.polyline=void 0,this.index=void 0,this.updater=void 0}function Of(e,t,a,i,r,n,o,l){for(;e instanceof mf.a;)e=e.resolvedProperty;e instanceof pf.default?o=function(e,t,a,i,r,n,o,l,u){var d,f=l;d=e.getValueInReferenceFrame(t,n,u[f]),Object(s.default)(d)&&(u[f++]=d);for(var c,h,m,p=!Object(s.default)(r)||lf.default.lessThanOrEquals(r,t)||lf.default.greaterThanOrEquals(r,a),_=0,g=i.length,v=i[_],y=a,b=!1;_<g;){if(!p&&lf.default.greaterThanOrEquals(v,r)&&(d=e.getValueInReferenceFrame(r,n,u[f]),Object(s.default)(d)&&(u[f++]=d),p=!0),lf.default.greaterThan(v,t)&&lf.default.lessThan(v,y)&&!v.equals(r)&&(d=e.getValueInReferenceFrame(v,n,u[f]),Object(s.default)(d)&&(u[f++]=d)),_<g-1){if(o>0&&!b){var w=i[_+1],O=lf.default.secondsDifference(w,v);(b=O>o)&&(c=Math.ceil(O/o),h=0,m=O/Math.max(c,2),c=Math.max(c-1,1))}if(b&&h<c){v=lf.default.addSeconds(v,m,new lf.default),h++;continue}}b=!1,v=i[++_]}return d=e.getValueInReferenceFrame(a,n,u[f]),Object(s.default)(d)&&(u[f++]=d),f}(e,t,a,e._property._times,i,r,n,o,l):o=e instanceof cf.a?function(e,t,a,i,r,n,o,s){yf.start=t,yf.stop=a;for(var l=o,u=e.intervals,d=0;d<u.length;d++){var f=u.get(d);if(!df.default.intersect(f,yf,vf).isEmpty){var c=f.start,h=f.stop,m=t;lf.default.greaterThan(c,m)&&(m=c);var p=a;lf.default.lessThan(h,p)&&(p=h),l=Of(f.data,m,p,i,r,n,l,s)}}return l}(e,t,a,i,r,n,o,l):e instanceof gf.default?function(e,t,a,i,r,n,o,l){bf.start=t,bf.stop=a;for(var u=o,d=e.intervals,f=0;f<d.length;f++){var c=d.get(f);if(!df.default.intersect(c,bf,vf).isEmpty){var h=c.start;c.isStartIncluded||(h=c.isStopIncluded?c.stop:lf.default.addSeconds(c.start,lf.default.secondsDifference(c.stop,c.start)/2,new lf.default));var m=e.getValueInReferenceFrame(h,r,l[u]);Object(s.default)(m)&&(l[u]=m,u++)}}return u}(e,t,a,0,r,0,o,l):e instanceof hf.a||e instanceof _f.a&&S.default.isConstant(e)?function(e,t,a,i,r,n,o,l){var u=e.getValueInReferenceFrame(t,r,l[o]);return Object(s.default)(u)&&(l[o++]=u),o}(e,t,0,0,r,0,o,l):function(e,t,a,i,r,n,o,l){for(var u,d=0,f=o,c=t,h=Math.max(n,60),m=!Object(s.default)(i)||lf.default.lessThanOrEquals(i,t)||lf.default.greaterThanOrEquals(i,a);lf.default.lessThan(c,a);)!m&&lf.default.greaterThanOrEquals(c,i)&&(m=!0,u=e.getValueInReferenceFrame(i,r,l[f]),Object(s.default)(u)&&(l[f]=u,f++)),u=e.getValueInReferenceFrame(c,r,l[f]),Object(s.default)(u)&&(l[f]=u,f++),d++,c=lf.default.addSeconds(t,h*d,new lf.default);return u=e.getValueInReferenceFrame(a,r,l[f]),Object(s.default)(u)&&(l[f]=u,f++),f}(e,t,a,i,r,n,o,l);return o}function xf(e,t,a,i,r,n,o){Object(s.default)(o)||(o=[]);var l=Of(e,t,a,i,r,n,0,o);return o.length=l,o}var Cf=new at.default;function Tf(e,t){this._unusedIndexes=[],this._polylineCollection=new ff.a,this._scene=e,this._referenceFrame=t,e.primitives.add(this._polylineCollection)}function Ef(e,t){t.collectionChanged.addEventListener(Ef.prototype._onCollectionChanged,this),this._scene=e,this._updaters={},this._entityCollection=t,this._items=new _.default,this._onCollectionChanged(t,t.values,[],[])}Tf.prototype.update=function(e){if(this._referenceFrame===uf.a.INERTIAL){var t=lt.default.computeIcrfToFixedMatrix(e,Cf);Object(s.default)(t)||(t=lt.default.computeTemeToPseudoFixedMatrix(e,Cf)),ot.default.fromRotationTranslation(t,y.default.ZERO,this._polylineCollection.modelMatrix)}},Tf.prototype.updateObject=function(e,t){var a,i,r=t.entity,n=r._path,o=r._position,l=n._show,u=t.polyline,d=r.isShowing&&(!Object(s.default)(l)||l.getValue(e));if(d){var f=S.default.getValueOrUndefined(n._leadTime,e),c=S.default.getValueOrUndefined(n._trailTime,e),h=r._availability,m=Object(s.default)(h),p=Object(s.default)(f),_=Object(s.default)(c);if(d=m||p&&_){if(_&&(a=lf.default.addSeconds(e,-c,new lf.default)),p&&(i=lf.default.addSeconds(e,f,new lf.default)),m){var g=h.start,v=h.stop;_&&!lf.default.greaterThan(g,a)||(a=g),p&&!lf.default.lessThan(v,i)||(i=v)}d=lf.default.lessThan(a,i)}}if(d){if(!Object(s.default)(u)){var y=this._unusedIndexes;if(y.length>0){var b=y.pop();u=this._polylineCollection.get(b),t.index=b}else t.index=this._polylineCollection.length,u=this._polylineCollection.add();u.id=r,t.polyline=u}var w=S.default.getValueOrDefault(n._resolution,e,60);u.show=!0,u.positions=xf(o,a,i,e,this._referenceFrame,w,u.positions.slice()),u.material=be.getValue(e,n._material,u.material),u.width=S.default.getValueOrDefault(n._width,e,1),u.distanceDisplayCondition=S.default.getValueOrUndefined(n._distanceDisplayCondition,e,u.distanceDisplayCondition)}else Object(s.default)(u)&&(this._unusedIndexes.push(t.index),t.polyline=void 0,u.show=!1,t.index=void 0)},Tf.prototype.removeObject=function(e){var t=e.polyline;Object(s.default)(t)&&(this._unusedIndexes.push(e.index),e.polyline=void 0,t.show=!1,t.id=void 0,e.index=void 0)},Tf.prototype.destroy=function(){return this._scene.primitives.remove(this._polylineCollection),Object(u.default)(this)},Ef.prototype.update=function(e){var t=this._updaters;for(var a in t)t.hasOwnProperty(a)&&t[a].update(e);var i=this._items.values;if(0===i.length&&Object(s.default)(this._updaters)&&Object.keys(this._updaters).length>0){for(var r in t)t.hasOwnProperty(r)&&t[r].destroy();this._updaters={}}for(var n=0,o=i.length;n<o;n++){var l=i[n],u=l.entity._position,d=l.updater,f=uf.a.FIXED;this._scene.mode===Ue.a.SCENE3D&&(f=u.referenceFrame);var c=this._updaters[f];d===c&&Object(s.default)(c)?c.updateObject(e,l):(Object(s.default)(d)&&d.removeObject(l),Object(s.default)(c)||((c=new Tf(this._scene,f)).update(e),this._updaters[f]=c),l.updater=c,Object(s.default)(c)&&c.updateObject(e,l))}return!0},Ef.prototype.isDestroyed=function(){return!1},Ef.prototype.destroy=function(){this._entityCollection.collectionChanged.removeEventListener(Ef.prototype._onCollectionChanged,this);var e=this._updaters;for(var t in e)e.hasOwnProperty(t)&&e[t].destroy();return Object(u.default)(this)},Ef.prototype._onCollectionChanged=function(e,t,a,i){var r,n,o,l=this._items;for(r=t.length-1;r>-1;r--)n=t[r],Object(s.default)(n._path)&&Object(s.default)(n._position)&&l.set(n.id,new wf(n));for(r=i.length-1;r>-1;r--)n=i[r],Object(s.default)(n._path)&&Object(s.default)(n._position)?l.contains(n.id)||l.set(n.id,new wf(n)):(o=l.get(n.id),Object(s.default)(o)&&(Object(s.default)(o.updater)&&o.updater.removeObject(o),l.remove(n.id)));for(r=a.length-1;r>-1;r--)n=a[r],o=l.get(n.id),Object(s.default)(o)&&(Object(s.default)(o.updater)&&o.updater.removeObject(o),l.remove(n.id))},Ef._subSample=xf;var Af=Ef,Sf=a(632),Pf=b.default.WHITE,Df=b.default.BLACK,If=new b.default,Mf=new y.default,Ff=new b.default,Rf=new x.a,Nf=new x.a,Lf=new O.a;function jf(e){this.entity=e,this.pointPrimitive=void 0,this.billboard=void 0,this.color=void 0,this.outlineColor=void 0,this.pixelSize=void 0,this.outlineWidth=void 0}function Vf(e,t){t.collectionChanged.addEventListener(Vf.prototype._onCollectionChanged,this),this._cluster=e,this._entityCollection=t,this._items=new _.default,this._onCollectionChanged(t,t.values,[],[])}function Uf(e,t,a){if(Object(s.default)(e)){var i=e.pointPrimitive;if(Object(s.default)(i))return e.pointPrimitive=void 0,void a.removePoint(t);var r=e.billboard;Object(s.default)(r)&&(e.billboard=void 0,a.removeBillboard(t))}}Vf.prototype.update=function(e){for(var t=this._items.values,a=this._cluster,i=0,r=t.length;i<r;i++){var n,o=t[i],l=o.entity,u=l._point,d=o.pointPrimitive,f=o.billboard,c=S.default.getValueOrDefault(u._heightReference,e,C.default.NONE),h=l.isShowing&&l.isAvailable(e)&&S.default.getValueOrDefault(u._show,e,!0);if(h&&(n=S.default.getValueOrUndefined(l._position,e,Mf),h=Object(s.default)(n)),h){S.default.isConstant(l._position)||(a._clusterDirty=!0);var m=!1,p=!1;if(c===C.default.NONE||Object(s.default)(f)?c!==C.default.NONE||Object(s.default)(d)||(Object(s.default)(f)&&(Uf(o,l,a),f=void 0),(d=a.getPoint(l)).id=l,o.pointPrimitive=d):(Object(s.default)(d)&&(Uf(o,l,a),d=void 0),(f=a.getBillboard(l)).id=l,f.image=void 0,o.billboard=f,m=!0,p=y.default.equals(f.position,n)&&f.heightReference===c),Object(s.default)(d))d.show=!0,d.position=n,d.scaleByDistance=S.default.getValueOrUndefined(u._scaleByDistance,e,Rf),d.translucencyByDistance=S.default.getValueOrUndefined(u._translucencyByDistance,e,Nf),d.color=S.default.getValueOrDefault(u._color,e,Pf,If),d.outlineColor=S.default.getValueOrDefault(u._outlineColor,e,Df,Ff),d.outlineWidth=S.default.getValueOrDefault(u._outlineWidth,e,0),d.pixelSize=S.default.getValueOrDefault(u._pixelSize,e,1),d.distanceDisplayCondition=S.default.getValueOrUndefined(u._distanceDisplayCondition,e,Lf),d.disableDepthTestDistance=S.default.getValueOrDefault(u._disableDepthTestDistance,e,0);else if(Object(s.default)(f)){f.show=!0,f.position=n,f.scaleByDistance=S.default.getValueOrUndefined(u._scaleByDistance,e,Rf),f.translucencyByDistance=S.default.getValueOrUndefined(u._translucencyByDistance,e,Nf),f.distanceDisplayCondition=S.default.getValueOrUndefined(u._distanceDisplayCondition,e,Lf),f.disableDepthTestDistance=S.default.getValueOrDefault(u._disableDepthTestDistance,e,0),f.heightReference=c;var _=S.default.getValueOrDefault(u._color,e,Pf,If),g=S.default.getValueOrDefault(u._outlineColor,e,Df,Ff),v=Math.round(S.default.getValueOrDefault(u._outlineWidth,e,0)),w=Math.max(1,Math.round(S.default.getValueOrDefault(u._pixelSize,e,1)));if(v>0?(f.scale=1,m=m||v!==o.outlineWidth||w!==o.pixelSize||!b.default.equals(_,o.color)||!b.default.equals(g,o.outlineColor)):(f.scale=w/50,w=50,m=m||v!==o.outlineWidth||!b.default.equals(_,o.color)||!b.default.equals(g,o.outlineColor)),m){o.color=b.default.clone(_,o.color),o.outlineColor=b.default.clone(g,o.outlineColor),o.pixelSize=w,o.outlineWidth=v;var O=_.alpha,x=_.toCssColorString(),T=g.toCssColorString(),E=JSON.stringify([x,w,T,v]);f.setImage(E,Object(Sf.a)(O,x,T,v,w))}p&&f._updateClamping()}}else Uf(o,l,a)}return!0},Vf.prototype.getBoundingSphere=function(e,t){var a=this._items.get(e.id);if(!Object(s.default)(a)||!Object(s.default)(a.pointPrimitive)&&!Object(s.default)(a.billboard))return A.default.FAILED;if(Object(s.default)(a.pointPrimitive))t.center=y.default.clone(a.pointPrimitive.position,t.center);else{var i=a.billboard;if(!Object(s.default)(i._clampedPosition))return A.default.PENDING;t.center=y.default.clone(i._clampedPosition,t.center)}return t.radius=0,A.default.DONE},Vf.prototype.isDestroyed=function(){return!1},Vf.prototype.destroy=function(){this._entityCollection.collectionChanged.removeEventListener(Vf.prototype._onCollectionChanged,this);for(var e=this._entityCollection.values,t=0;t<e.length;t++)this._cluster.removePoint(e[t]);return Object(u.default)(this)},Vf.prototype._onCollectionChanged=function(e,t,a,i){var r,n,o=this._items,l=this._cluster;for(r=t.length-1;r>-1;r--)n=t[r],Object(s.default)(n._point)&&Object(s.default)(n._position)&&o.set(n.id,new jf(n));for(r=i.length-1;r>-1;r--)n=i[r],Object(s.default)(n._point)&&Object(s.default)(n._position)?o.contains(n.id)||o.set(n.id,new jf(n)):(Uf(o.get(n.id),n,l),o.remove(n.id));for(r=a.length-1;r>-1;r--)n=a[r],Uf(o.get(n.id),n,l),o.remove(n.id)};var zf=Vf,Bf=a(369),Hf=a(370),kf=a(568),Gf=a(402),Wf=[];function Yf(e,t,a,i,r){var n,o=Wf;o.length=r;var s=a.red,l=a.green,u=a.blue,d=a.alpha,f=i.red,c=i.green,h=i.blue,m=i.alpha;if(b.default.equals(a,i)){for(n=0;n<r;n++)o[n]=b.default.clone(a);return o}var p=(f-s)/r,_=(c-l)/r,g=(h-u)/r,v=(m-d)/r;for(n=0;n<r;n++)o[n]=new b.default(s+n*p,l+n*_,u+n*g,d+n*v);return o}function Xf(e){var t=(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).positions,a=e.colors,i=Object(o.default)(e.width,1),r=Object(o.default)(e.colorsPerVertex,!1);this._positions=t,this._colors=a,this._width=i,this._colorsPerVertex=r,this._vertexFormat=$.default.clone(Object(o.default)(e.vertexFormat,$.default.DEFAULT)),this._arcType=Object(o.default)(e.arcType,Mn.a.GEODESIC),this._granularity=Object(o.default)(e.granularity,Ve.default.RADIANS_PER_DEGREE),this._ellipsoid=pa.default.clone(Object(o.default)(e.ellipsoid,pa.default.WGS84)),this._workerName="createPolylineGeometry";var n=1+t.length*y.default.packedLength;n+=Object(s.default)(a)?1+a.length*b.default.packedLength:1,this.packedLength=n+pa.default.packedLength+$.default.packedLength+4}Xf.pack=function(e,t,a){var i;a=Object(o.default)(a,0);var r=e._positions,n=r.length;for(t[a++]=n,i=0;i<n;++i,a+=y.default.packedLength)y.default.pack(r[i],t,a);var l=e._colors;for(n=Object(s.default)(l)?l.length:0,t[a++]=n,i=0;i<n;++i,a+=b.default.packedLength)b.default.pack(l[i],t,a);return pa.default.pack(e._ellipsoid,t,a),a+=pa.default.packedLength,$.default.pack(e._vertexFormat,t,a),a+=$.default.packedLength,t[a++]=e._width,t[a++]=e._colorsPerVertex?1:0,t[a++]=e._arcType,t[a]=e._granularity,t};var Qf=pa.default.clone(pa.default.UNIT_SPHERE),qf=new $.default,Zf={positions:void 0,colors:void 0,ellipsoid:Qf,vertexFormat:qf,width:void 0,colorsPerVertex:void 0,arcType:void 0,granularity:void 0};Xf.unpack=function(e,t,a){var i;t=Object(o.default)(t,0);var r=e[t++],n=new Array(r);for(i=0;i<r;++i,t+=y.default.packedLength)n[i]=y.default.unpack(e,t);var l=(r=e[t++])>0?new Array(r):void 0;for(i=0;i<r;++i,t+=b.default.packedLength)l[i]=b.default.unpack(e,t);var u=pa.default.unpack(e,t,Qf);t+=pa.default.packedLength;var d=$.default.unpack(e,t,qf);t+=$.default.packedLength;var f=e[t++],c=1===e[t++],h=e[t++],m=e[t];return Object(s.default)(a)?(a._positions=n,a._colors=l,a._ellipsoid=pa.default.clone(u,a._ellipsoid),a._vertexFormat=$.default.clone(d,a._vertexFormat),a._width=f,a._colorsPerVertex=c,a._arcType=h,a._granularity=m,a):(Zf.positions=n,Zf.colors=l,Zf.width=f,Zf.colorsPerVertex=c,Zf.arcType=h,Zf.granularity=m,new Xf(Zf))};var Kf=new y.default,Jf=new y.default,$f=new y.default,ec=new y.default;Xf.createGeometry=function(e){var t,a,i,n=e._width,o=e._vertexFormat,l=e._colors,u=e._colorsPerVertex,d=e._arcType,f=e._granularity,c=e._ellipsoid,h=Object(et.a)(e._positions,y.default.equalsEpsilon),m=h.length;if(!(m<2||n<=0)){if(d===Mn.a.GEODESIC||d===Mn.a.RHUMB){var p,_;d===Mn.a.GEODESIC?(p=Ve.default.chordLength(f,c.maximumRadius),_=it.a.numberOfPoints):(p=f,_=it.a.numberOfPointsRhumbLine);var g=it.a.extractHeights(h,c);if(Object(s.default)(l)){var v=1;for(t=0;t<m-1;++t)v+=_(h[t],h[t+1],p);var w=new Array(v),O=0;for(t=0;t<m-1;++t){var x=h[t],C=h[t+1],T=l[t],E=_(x,C,p);if(u&&t<v){var A=Yf(0,0,T,l[t+1],E),S=A.length;for(a=0;a<S;++a)w[O++]=A[a]}else for(a=0;a<E;++a)w[O++]=b.default.clone(T)}w[O]=b.default.clone(l[l.length-1]),l=w,Wf.length=0}h=d===Mn.a.GEODESIC?it.a.generateCartesianArc({positions:h,minDistance:p,ellipsoid:c,height:g}):it.a.generateCartesianRhumbArc({positions:h,granularity:p,ellipsoid:c,height:g})}var P,D=4*(m=h.length)-4,I=new Float64Array(3*D),M=new Float64Array(3*D),F=new Float64Array(3*D),R=new Float32Array(2*D),N=o.st?new Float32Array(2*D):void 0,L=Object(s.default)(l)?new Uint8Array(4*D):void 0,j=0,V=0,U=0,z=0;for(a=0;a<m;++a){var B,H;0===a?(P=Kf,y.default.subtract(h[0],h[1],P),y.default.add(h[0],P,P)):P=h[a-1],y.default.clone(P,$f),y.default.clone(h[a],Jf),a===m-1?(P=Kf,y.default.subtract(h[m-1],h[m-2],P),y.default.add(h[m-1],P,P)):P=h[a+1],y.default.clone(P,ec),Object(s.default)(L)&&(B=0===a||u?l[a]:l[a-1],a!==m-1&&(H=l[a]));var k=a===m-1?2:4;for(i=0===a?2:0;i<k;++i){y.default.pack(Jf,I,j),y.default.pack($f,M,j),y.default.pack(ec,F,j),j+=3;var G=i-2<0?-1:1;if(R[V++]=i%2*2-1,R[V++]=G*n,o.st&&(N[U++]=a/(m-1),N[U++]=Math.max(R[V-2],0)),Object(s.default)(L)){var W=i<2?B:H;L[z++]=b.default.floatToByte(W.red),L[z++]=b.default.floatToByte(W.green),L[z++]=b.default.floatToByte(W.blue),L[z++]=b.default.floatToByte(W.alpha)}}}var Y=new va.a;Y.position=new ga.a({componentDatatype:ue.a.DOUBLE,componentsPerAttribute:3,values:I}),Y.prevPosition=new ga.a({componentDatatype:ue.a.DOUBLE,componentsPerAttribute:3,values:M}),Y.nextPosition=new ga.a({componentDatatype:ue.a.DOUBLE,componentsPerAttribute:3,values:F}),Y.expandAndWidth=new ga.a({componentDatatype:ue.a.FLOAT,componentsPerAttribute:2,values:R}),o.st&&(Y.st=new ga.a({componentDatatype:ue.a.FLOAT,componentsPerAttribute:2,values:N})),Object(s.default)(L)&&(Y.color=new ga.a({componentDatatype:ue.a.UNSIGNED_BYTE,componentsPerAttribute:4,values:L,normalize:!0}));var X=ya.a.createTypedArray(D,6*m-6),Q=0,q=0,Z=m-1;for(a=0;a<Z;++a)X[q++]=Q,X[q++]=Q+2,X[q++]=Q+1,X[q++]=Q+1,X[q++]=Q+2,X[q++]=Q+3,Q+=4;return new _a.a({attributes:Y,indices:X,primitiveType:wa.a.TRIANGLES,boundingSphere:r.default.fromPoints(h),geometryType:Gf.a.POLYLINES})}};var tc=Xf,ac=new Ce.a(0),ic={},rc=new b.default,nc=new ge.default(b.default.WHITE),oc=new Ce.a(!0),sc=new Ce.a(ne.default.DISABLED),lc=new Ce.a(new O.a),uc=new Ce.a(K.a.BOTH);function dc(){this.vertexFormat=void 0,this.positions=void 0,this.width=void 0,this.arcType=void 0,this.granularity=void 0}function fc(){this.positions=void 0,this.width=void 0,this.arcType=void 0,this.granularity=void 0}function cc(e,t){this._entity=e,this._scene=t,this._entitySubscription=e.definitionChanged.addEventListener(cc.prototype._onEntityPropertyChanged,this),this._fillEnabled=!1,this._dynamic=!1,this._geometryChanged=new Z.default,this._showProperty=void 0,this._materialProperty=void 0,this._shadowsProperty=void 0,this._distanceDisplayConditionProperty=void 0,this._classificationTypeProperty=void 0,this._depthFailMaterialProperty=void 0,this._geometryOptions=new dc,this._groundGeometryOptions=new fc,this._id="polyline-"+e.id,this._clampToGround=!1,this._supportsPolylinesOnTerrain=Te.default.supportsPolylinesOnTerrain(t),this._zIndex=0,this._onEntityPropertyChanged(e,"polyline",e.polyline,void 0)}Object(l.default)(cc.prototype,{id:{get:function(){return this._id}},entity:{get:function(){return this._entity}},fillEnabled:{get:function(){return this._fillEnabled}},hasConstantFill:{get:function(){return!this._fillEnabled||!Object(s.default)(this._entity.availability)&&S.default.isConstant(this._showProperty)}},fillMaterialProperty:{get:function(){return this._materialProperty}},depthFailMaterialProperty:{get:function(){return this._depthFailMaterialProperty}},outlineEnabled:{value:!1},hasConstantOutline:{value:!0},outlineColorProperty:{value:void 0},shadowsProperty:{get:function(){return this._shadowsProperty}},distanceDisplayConditionProperty:{get:function(){return this._distanceDisplayConditionProperty}},classificationTypeProperty:{get:function(){return this._classificationTypeProperty}},isDynamic:{get:function(){return this._dynamic}},isClosed:{value:!1},geometryChanged:{get:function(){return this._geometryChanged}},arcType:{get:function(){return this._arcType}},clampToGround:{get:function(){return this._clampToGround&&this._supportsPolylinesOnTerrain}},zIndex:{get:function(){return this._zIndex}}}),cc.prototype.isOutlineVisible=function(e){return!1},cc.prototype.isFilled=function(e){var t=this._entity,a=this._fillEnabled&&t.isAvailable(e)&&this._showProperty.getValue(e);return Object(o.default)(a,!1)},cc.prototype.createFillGeometryInstance=function(e){var t,a=this._entity,i=a.isAvailable(e),r=new _e.a(i&&a.isShowing&&this._showProperty.getValue(e)),n=this._distanceDisplayConditionProperty.getValue(e),o={show:r,distanceDisplayCondition:fe.fromDistanceDisplayCondition(n)};return this._materialProperty instanceof ge.default&&(Object(s.default)(this._materialProperty.color)&&(this._materialProperty.color.isConstant||i)&&(t=this._materialProperty.color.getValue(e,rc)),Object(s.default)(t)||(t=b.default.WHITE),o.color=le.a.fromColor(t)),this.clampToGround?new ce.a({id:a,geometry:new kf.a(this._groundGeometryOptions),attributes:o}):(Object(s.default)(this._depthFailMaterialProperty)&&this._depthFailMaterialProperty instanceof ge.default&&(Object(s.default)(this._depthFailMaterialProperty.color)&&(this._depthFailMaterialProperty.color.isConstant||i)&&(t=this._depthFailMaterialProperty.color.getValue(e,rc)),Object(s.default)(t)||(t=b.default.WHITE),o.depthFailColor=le.a.fromColor(t)),new ce.a({id:a,geometry:new tc(this._geometryOptions),attributes:o}))},cc.prototype.createOutlineGeometryInstance=function(e){},cc.prototype.isDestroyed=function(){return!1},cc.prototype.destroy=function(){this._entitySubscription(),Object(u.default)(this)},cc.prototype._onEntityPropertyChanged=function(e,t,a,i){if("availability"===t||"polyline"===t){var r=this._entity.polyline;if(Object(s.default)(r)){var n=r.positions,l=r.show;if(Object(s.default)(l)&&l.isConstant&&!l.getValue(me.default.MINIMUM_VALUE)||!Object(s.default)(n))this._fillEnabled&&(this._fillEnabled=!1,this._geometryChanged.raiseEvent(this));else{var u=r.zIndex,d=Object(o.default)(r.material,nc),f=d instanceof ge.default;this._materialProperty=d,this._depthFailMaterialProperty=r.depthFailMaterial,this._showProperty=Object(o.default)(l,oc),this._shadowsProperty=Object(o.default)(r.shadows,sc),this._distanceDisplayConditionProperty=Object(o.default)(r.distanceDisplayCondition,lc),this._classificationTypeProperty=Object(o.default)(r.classificationType,uc),this._fillEnabled=!0,this._zIndex=Object(o.default)(u,ac);var c=r.width,h=r.arcType,m=r.clampToGround,p=r.granularity;if(n.isConstant&&S.default.isConstant(c)&&S.default.isConstant(h)&&S.default.isConstant(p)&&S.default.isConstant(m)&&S.default.isConstant(u)){var _,g=this._geometryOptions,v=n.getValue(me.default.MINIMUM_VALUE,g.positions);if(!Object(s.default)(v)||v.length<2)return void(this._fillEnabled&&(this._fillEnabled=!1,this._geometryChanged.raiseEvent(this)));_=f&&(!Object(s.default)(this._depthFailMaterialProperty)||this._depthFailMaterialProperty instanceof ge.default)?Bf.a.VERTEX_FORMAT:Hf.a.VERTEX_FORMAT,g.vertexFormat=_,g.positions=v,g.width=Object(s.default)(c)?c.getValue(me.default.MINIMUM_VALUE):void 0,g.arcType=Object(s.default)(h)?h.getValue(me.default.MINIMUM_VALUE):void 0,g.granularity=Object(s.default)(p)?p.getValue(me.default.MINIMUM_VALUE):void 0;var y=this._groundGeometryOptions;y.positions=v,y.width=g.width,y.arcType=g.arcType,y.granularity=g.granularity,this._clampToGround=!!Object(s.default)(m)&&m.getValue(me.default.MINIMUM_VALUE),!this._clampToGround&&Object(s.default)(u)&&Object(xe.a)("Entity polylines must have clampToGround: true when using zIndex.  zIndex will be ignored."),this._dynamic=!1,this._geometryChanged.raiseEvent(this)}else this._dynamic||(this._dynamic=!0,this._geometryChanged.raiseEvent(this))}}else this._fillEnabled&&(this._fillEnabled=!1,this._geometryChanged.raiseEvent(this))}},cc.prototype.createDynamicUpdater=function(e,t){return new mc(e,t,this)};var hc={positions:void 0,granularity:void 0,height:void 0,ellipsoid:void 0};function mc(e,t,a){this._line=void 0,this._primitives=e,this._groundPrimitives=t,this._groundPolylinePrimitive=void 0,this._material=void 0,this._geometryUpdater=a,this._positions=[]}function pc(e){if(Object(s.default)(e._line))return e._line;var t=e._geometryUpdater._scene.id,a=ic[t],i=e._primitives;!Object(s.default)(a)||a.isDestroyed()?(a=new ff.a,ic[t]=a,i.add(a)):i.contains(a)||i.add(a);var r=a.add();return r.id=e._geometryUpdater._entity,e._line=r,r}mc.prototype.update=function(e){var t=this._geometryUpdater,a=t._entity,i=a.polyline,r=i.positions,n=S.default.getValueOrUndefined(r,e,this._positions);t._clampToGround=S.default.getValueOrDefault(i._clampToGround,e,!1),t._groundGeometryOptions.positions=n,t._groundGeometryOptions.width=S.default.getValueOrDefault(i._width,e,1),t._groundGeometryOptions.arcType=S.default.getValueOrDefault(i._arcType,e,Mn.a.GEODESIC),t._groundGeometryOptions.granularity=S.default.getValueOrDefault(i._granularity,e,9999);var o=this._groundPrimitives;if(Object(s.default)(this._groundPolylinePrimitive)&&(o.remove(this._groundPolylinePrimitive),this._groundPolylinePrimitive=void 0),t.clampToGround){if(!a.isShowing||!a.isAvailable(e)||!S.default.getValueOrDefault(i._show,e,!0))return;if(!Object(s.default)(n)||n.length<2)return;var l,u=t.fillMaterialProperty;if(u instanceof ge.default)l=new Bf.a;else{var d=be.getValue(e,u,this._material);l=new Hf.a({material:d,translucent:d.isTranslucent()}),this._material=d}return this._groundPolylinePrimitive=o.add(new f.a({geometryInstances:t.createFillGeometryInstance(e),appearance:l,classificationType:t.classificationTypeProperty.getValue(e),asynchronous:!1}),S.default.getValueOrUndefined(t.zIndex,e)),void(Object(s.default)(this._line)&&(this._line.show=!1))}var c=pc(this);if(a.isShowing&&a.isAvailable(e)&&S.default.getValueOrDefault(i._show,e,!0))if(!Object(s.default)(n)||n.length<2)c.show=!1;else{var h=Mn.a.GEODESIC;h=S.default.getValueOrDefault(i._arcType,e,h);var m=t._scene.globe;h!==Mn.a.NONE&&Object(s.default)(m)&&(hc.ellipsoid=m.ellipsoid,hc.positions=n,hc.granularity=S.default.getValueOrUndefined(i._granularity,e),hc.height=it.a.extractHeights(n,m.ellipsoid),n=h===Mn.a.GEODESIC?it.a.generateCartesianArc(hc):it.a.generateCartesianRhumbArc(hc)),c.show=!0,c.positions=n.slice(),c.material=be.getValue(e,t.fillMaterialProperty,c.material),c.width=S.default.getValueOrDefault(i._width,e,1),c.distanceDisplayCondition=S.default.getValueOrUndefined(i._distanceDisplayCondition,e,c.distanceDisplayCondition)}else c.show=!1},mc.prototype.getBoundingSphere=function(e){if(this._geometryUpdater.clampToGround){var t=this._groundPolylinePrimitive;if(Object(s.default)(t)&&t.show&&t.ready){var a=t.getGeometryInstanceAttributes(this._geometryUpdater._entity);if(Object(s.default)(a)&&Object(s.default)(a.boundingSphere))return r.default.clone(a.boundingSphere,e),A.default.DONE}return Object(s.default)(t)&&!t.ready?A.default.PENDING:A.default.DONE}var i=pc(this);return i.show&&i.positions.length>0?(r.default.fromPoints(i.positions,e),A.default.DONE):A.default.FAILED},mc.prototype.isDestroyed=function(){return!1},mc.prototype.destroy=function(){var e=this._geometryUpdater._scene.id,t=ic[e];Object(s.default)(t)&&(t.remove(this._line),0===t.length&&(this._primitives.removeAndDestroy(t),delete ic[e])),Object(s.default)(this._groundPolylinePrimitive)&&this._groundPrimitives.remove(this._groundPolylinePrimitive),Object(u.default)(this)};var _c=cc,gc=new b.default,vc=new O.a,yc=new O.a;function bc(e,t,a,i,r){var n;n=a instanceof ge.default?Bf.a:Hf.a,this.orderedGroundPrimitives=e,this.classificationType=t,this.appearanceType=n,this.materialProperty=a,this.updaters=new _.default,this.createPrimitive=!0,this.primitive=void 0,this.oldPrimitive=void 0,this.geometry=new _.default,this.material=void 0,this.updatersWithAttributes=new _.default,this.attributes=new _.default,this.invalidated=!1,this.removeMaterialSubscription=a.definitionChanged.addEventListener(bc.prototype.onMaterialChanged,this),this.subscriptions=new _.default,this.showsUpdated=new _.default,this.zIndex=i,this._asynchronous=r}function wc(e,t,a){this._items=[],this._orderedGroundPrimitives=e,this._classificationType=t,this._asynchronous=Object(o.default)(a,!0)}bc.prototype.onMaterialChanged=function(){this.invalidated=!0},bc.prototype.isMaterial=function(e){var t=this.materialProperty,a=e.fillMaterialProperty;return a===t||a instanceof ge.default&&t instanceof ge.default||Object(s.default)(t)&&t.equals(a)},bc.prototype.add=function(e,t,a){var i=t.id;if(this.updaters.set(i,t),this.geometry.set(i,a),t.hasConstantFill&&t.fillMaterialProperty.isConstant&&S.default.isConstant(t.distanceDisplayConditionProperty)){var r=this;this.subscriptions.set(i,t.entity.definitionChanged.addEventListener((function(e,a,i,n){"isShowing"===a&&r.showsUpdated.set(t.id,t)})))}else this.updatersWithAttributes.set(i,t);this.createPrimitive=!0},bc.prototype.remove=function(e){var t=e.id;if(this.createPrimitive=this.geometry.remove(t)||this.createPrimitive,this.updaters.remove(t)){this.updatersWithAttributes.remove(t);var a=this.subscriptions.get(t);return Object(s.default)(a)&&(a(),this.subscriptions.remove(t)),!0}return!1},bc.prototype.update=function(e){var t,a=!0,i=this.primitive,r=this.orderedGroundPrimitives,n=this.geometry.values;if(this.createPrimitive){if(n.length>0)Object(s.default)(i)&&(Object(s.default)(this.oldPrimitive)?r.remove(i):this.oldPrimitive=i),i=new f.a({show:!1,asynchronous:this._asynchronous,geometryInstances:n.slice(),appearance:new this.appearanceType,classificationType:this.classificationType}),this.appearanceType===Hf.a&&(this.material=be.getValue(e,this.materialProperty,this.material),i.appearance.material=this.material),r.add(i,this.zIndex),a=!1;else{Object(s.default)(i)&&(r.remove(i),i=void 0);var o=this.oldPrimitive;Object(s.default)(o)&&(r.remove(o),this.oldPrimitive=void 0)}this.attributes.removeAll(),this.primitive=i,this.createPrimitive=!1}else if(Object(s.default)(i)&&i.ready){i.show=!0,Object(s.default)(this.oldPrimitive)&&(r.remove(this.oldPrimitive),this.oldPrimitive=void 0),this.appearanceType===Hf.a&&(this.material=be.getValue(e,this.materialProperty,this.material),this.primitive.appearance.material=this.material);var l=this.updatersWithAttributes.values,u=l.length;for(t=0;t<u;t++){var d=l[t],c=d.entity,h=this.geometry.get(d.id),m=this.attributes.get(h.id.id);if(Object(s.default)(m)||(m=i.getGeometryInstanceAttributes(h.id),this.attributes.set(h.id.id,m)),!d.fillMaterialProperty.isConstant){var p=d.fillMaterialProperty.color,_=S.default.getValueOrDefault(p,e,b.default.WHITE,gc);b.default.equals(m._lastColor,_)||(m._lastColor=b.default.clone(_,m._lastColor),m.color=le.a.toValue(_,m.color))}var g=c.isShowing&&(d.hasConstantFill||d.isFilled(e));g!==(1===m.show[0])&&(m.show=_e.a.toValue(g,m.show));var v=d.distanceDisplayConditionProperty;if(!S.default.isConstant(v)){var y=S.default.getValueOrDefault(v,e,yc,vc);O.a.equals(y,m._lastDistanceDisplayCondition)||(m._lastDistanceDisplayCondition=O.a.clone(y,m._lastDistanceDisplayCondition),m.distanceDisplayCondition=fe.toValue(y,m.distanceDisplayCondition))}}this.updateShows(i)}else Object(s.default)(i)&&!i.ready&&(a=!1);return a},bc.prototype.updateShows=function(e){for(var t=this.showsUpdated.values,a=t.length,i=0;i<a;i++){var r=t[i],n=r.entity,o=this.geometry.get(r.id),l=this.attributes.get(o.id.id);Object(s.default)(l)||(l=e.getGeometryInstanceAttributes(o.id),this.attributes.set(o.id.id,l));var u=n.isShowing;u!==(1===l.show[0])&&(l.show=_e.a.toValue(u,l.show),o.attributes.show.value[0]=l.show[0])}this.showsUpdated.removeAll()},bc.prototype.contains=function(e){return this.updaters.contains(e.id)},bc.prototype.getBoundingSphere=function(e,t){var a=this.primitive;if(!a.ready)return A.default.PENDING;var i=a.getGeometryInstanceAttributes(e.entity);return!Object(s.default)(i)||!Object(s.default)(i.boundingSphere)||Object(s.default)(i.show)&&0===i.show[0]?A.default.FAILED:(i.boundingSphere.clone(t),A.default.DONE)},bc.prototype.destroy=function(){var e=this.primitive,t=this.orderedGroundPrimitives;Object(s.default)(e)&&t.remove(e);var a=this.oldPrimitive;Object(s.default)(a)&&t.remove(a),this.removeMaterialSubscription()},wc.prototype.add=function(e,t){for(var a=this._items,i=a.length,r=t.createFillGeometryInstance(e),n=S.default.getValueOrDefault(t.zIndex,0),o=0;o<i;++o){var s=a[o];if(s.isMaterial(t)&&s.zIndex===n)return void s.add(e,t,r)}var l=new bc(this._orderedGroundPrimitives,this._classificationType,t.fillMaterialProperty,n,this._asynchronous);l.add(e,t,r),a.push(l)},wc.prototype.remove=function(e){for(var t=this._items,a=t.length-1;a>=0;a--){var i=t[a];if(i.remove(e)){0===i.updaters.length&&(t.splice(a,1),i.destroy());break}}},wc.prototype.update=function(e){var t,a=this._items;for(t=a.length-1;t>=0;t--){var i=a[t];if(i.invalidated){a.splice(t,1);for(var r=i.updaters.values,n=r.length,o=0;o<n;o++)this.add(e,r[o]);i.destroy()}}var s=!0;for(t=0;t<a.length;t++)s=a[t].update(e)&&s;return s},wc.prototype.getBoundingSphere=function(e,t){for(var a=this._items,i=a.length,r=0;r<i;r++){var n=a[r];if(n.contains(e))return n.getBoundingSphere(e,t)}return A.default.FAILED},wc.prototype.removeAllPrimitives=function(){for(var e=this._items,t=e.length,a=0;a<t;a++)e[a].destroy();this._items.length=0};var Oc=wc,xc=[];function Cc(e,t){for(var a=e._batches,i=a.length,r=0;r<i;r++)a[r].remove(t)}function Tc(e,t,a){if(a.isDynamic)e._dynamicBatch.add(t,a);else if(a.clampToGround&&a.fillEnabled){var i=a.classificationTypeProperty.getValue(t);e._groundBatches[i].add(t,a)}else{var r;a.fillEnabled&&(r=a.shadowsProperty.getValue(t));var n,o=0;Object(s.default)(a.depthFailMaterialProperty)&&(o=a.depthFailMaterialProperty instanceof ge.default?1:2),Object(s.default)(r)&&(n=r+o*ne.default.NUMBER_OF_SHADOW_MODES),a.fillEnabled&&(a.fillMaterialProperty instanceof ge.default?e._colorBatches[n].add(t,a):e._materialBatches[n].add(t,a))}}function Ec(e,t,a,i){var r;i=Object(o.default)(i,e.groundPrimitives),a=Object(o.default)(a,e.primitives),this._scene=e,this._primitives=a,this._entityCollection=void 0,this._addedObjects=new _.default,this._removedObjects=new _.default,this._changedObjects=new _.default;var n=ne.default.NUMBER_OF_SHADOW_MODES;for(this._colorBatches=new Array(3*n),this._materialBatches=new Array(3*n),r=0;r<n;++r)this._colorBatches[r]=new Fl(a,Bf.a,void 0,!1,r),this._materialBatches[r]=new Bl(a,Hf.a,void 0,!1,r),this._colorBatches[r+n]=new Fl(a,Bf.a,Bf.a,!1,r),this._materialBatches[r+n]=new Bl(a,Hf.a,Bf.a,!1,r),this._colorBatches[r+2*n]=new Fl(a,Bf.a,Hf.a,!1,r),this._materialBatches[r+2*n]=new Bl(a,Hf.a,Hf.a,!1,r);this._dynamicBatch=new zi(a,i);var s=K.a.NUMBER_OF_CLASSIFICATION_TYPES;for(this._groundBatches=new Array(s),r=0;r<s;++r)this._groundBatches[r]=new Oc(i,r);this._batches=this._colorBatches.concat(this._materialBatches,this._dynamicBatch,this._groundBatches),this._subscriptions=new _.default,this._updaters=new _.default,this._entityCollection=t,t.collectionChanged.addEventListener(Ec.prototype._onCollectionChanged,this),this._onCollectionChanged(t,t.values,xc)}Ec.prototype.update=function(e){var t,a,i,r,n=this._addedObjects,o=n.values,s=this._removedObjects,l=s.values,u=this._changedObjects,d=u.values;for(t=d.length-1;t>-1;t--)i=(a=d[t]).id,(r=this._updaters.get(i)).entity===a?(Cc(this,r),Tc(this,e,r)):(l.push(a),o.push(a));for(t=l.length-1;t>-1;t--)i=(a=l[t]).id,Cc(this,r=this._updaters.get(i)),r.destroy(),this._updaters.remove(i),this._subscriptions.get(i)(),this._subscriptions.remove(i);for(t=o.length-1;t>-1;t--)i=(a=o[t]).id,r=new _c(a,this._scene),this._updaters.set(i,r),Tc(this,e,r),this._subscriptions.set(i,r.geometryChanged.addEventListener(Ec._onGeometryChanged,this));n.removeAll(),s.removeAll(),u.removeAll();var f=!0,c=this._batches,h=c.length;for(t=0;t<h;t++)f=c[t].update(e)&&f;return f};var Ac=[],Sc=new r.default;Ec.prototype.getBoundingSphere=function(e,t){for(var a=Ac,i=Sc,n=0,o=A.default.DONE,s=this._batches,l=s.length,u=this._updaters.get(e.id),d=0;d<l;d++){if((o=s[d].getBoundingSphere(u,i))===A.default.PENDING)return A.default.PENDING;o===A.default.DONE&&(a[n]=r.default.clone(i,a[n]),n++)}return 0===n?A.default.FAILED:(a.length=n,r.default.fromBoundingSpheres(a,t),A.default.DONE)},Ec.prototype.isDestroyed=function(){return!1},Ec.prototype.destroy=function(){var e;this._entityCollection.collectionChanged.removeEventListener(Ec.prototype._onCollectionChanged,this),this._addedObjects.removeAll(),this._removedObjects.removeAll();var t=this._batches,a=t.length;for(e=0;e<a;e++)t[e].removeAllPrimitives();var i=this._subscriptions.values;for(a=i.length,e=0;e<a;e++)i[e]();return this._subscriptions.removeAll(),Object(u.default)(this)},Ec._onGeometryChanged=function(e){var t=this._removedObjects,a=this._changedObjects,i=e.entity,r=i.id;Object(s.default)(t.get(r))||Object(s.default)(a.get(r))||a.set(r,i)},Ec.prototype._onCollectionChanged=function(e,t,a){var i,r,n,o=this._addedObjects,s=this._removedObjects,l=this._changedObjects;for(i=a.length-1;i>-1;i--)r=(n=a[i]).id,o.remove(r)||(s.set(r,n),l.remove(r));for(i=t.length-1;i>-1;i--)r=(n=t[i]).id,s.remove(r)?l.set(r,n):o.set(r,n)};var Pc=Ec;function Dc(e){this._displayID=Object(n.default)(),c.a.initializeTerrainHeights(),f.a.initializeTerrainHeights();var t=e.scene,a=e.dataSourceCollection;this._eventHelper=new d.default,this._eventHelper.add(a.dataSourceAdded,this._onDataSourceAdded,this),this._eventHelper.add(a.dataSourceRemoved,this._onDataSourceRemoved,this),this._eventHelper.add(a.dataSourceMoved,this._onDataSourceMoved,this),this._eventHelper.add(t.postRender,this._postRender,this),this._dataSourceCollection=a,this._scene=t,this._visualizersCallback=Object(o.default)(e.visualizersCallback,Dc.defaultVisualizersCallback);var i=!1,r=new h.a,s=new h.a;a.length>0&&(t.primitives.add(r),t.groundPrimitives.add(s),i=!0),this._primitives=r,this._groundPrimitives=s;for(var l=0,u=a.length;l<u;l++)this._onDataSourceAdded(a,a.get(l));var m,p,_=new q.default;if(this._onDataSourceAdded(void 0,_),this._defaultDataSource=_,!i){var g=this,v=function(){t.primitives.add(r),t.groundPrimitives.add(s),m(),p(),g._removeDefaultDataSourceListener=void 0,g._removeDataSourceCollectionListener=void 0};m=_.entities.collectionChanged.addEventListener(v),p=a.dataSourceAdded.addEventListener(v)}this._removeDefaultDataSourceListener=m,this._removeDataSourceCollectionListener=p,this._ready=!1}Dc.defaultVisualizersCallback=function(e,t,a){var i=a.entities;return[new Q(t,i),new pd(e,i,a._primitives,a._groundPrimitives),new Bd(t,i),new sf(e,i),new zf(t,i),new Af(e,i),new Pc(e,i,a._primitives,a._groundPrimitives)]},Object(l.default)(Dc.prototype,{scene:{get:function(){return this._scene}},dataSources:{get:function(){return this._dataSourceCollection}},defaultDataSource:{get:function(){return this._defaultDataSource}},ready:{get:function(){return this._ready}}}),Dc.prototype.isDestroyed=function(){return!1},Dc.prototype.destroy=function(){this._eventHelper.removeAll();for(var e=this._dataSourceCollection,t=0,a=e.length;t<a;++t)this._onDataSourceRemoved(this._dataSourceCollection,e.get(t));return this._onDataSourceRemoved(void 0,this._defaultDataSource),Object(s.default)(this._removeDefaultDataSourceListener)?(this._removeDefaultDataSourceListener(),this._removeDataSourceCollectionListener()):(this._scene.primitives.remove(this._primitives),this._scene.groundPrimitives.remove(this._groundPrimitives)),Object(u.default)(this)},Dc.prototype.update=function(e){if(!i.a.initialized)return this._ready=!1,!1;var t,a,r,n,o=!0,l=this._dataSourceCollection,u=l.length;for(t=0;t<u;t++){var d=l.get(t);for(Object(s.default)(d.update)&&(o=d.update(e)&&o),n=(r=d._visualizersByDisplayID[this._displayID]).length,a=0;a<n;a++)o=r[a].update(e)&&o}for(n=(r=this._defaultDataSource._visualizersByDisplayID[this._displayID]).length,a=0;a<n;a++)o=r[a].update(e)&&o;return this._ready=o,o},Dc.prototype._postRender=function(){for(var e=this._scene.frameState,t=this._dataSourceCollection,a=t.length,i=0;i<a;i++){var r=t.get(i),n=r.credit;Object(s.default)(n)&&e.creditDisplay.addCredit(n);var o=r._resourceCredits;if(Object(s.default)(o))for(var l=o.length,u=0;u<l;u++)e.creditDisplay.addCredit(o[u])}};var Ic=[],Mc=new r.default;Dc.prototype.getBoundingSphere=function(e,t,a){if(!this._ready)return A.default.PENDING;var i,n,o=this._defaultDataSource;if(!o.entities.contains(e)){o=void 0;var l=this._dataSourceCollection;for(n=l.length,i=0;i<n;i++){var u=l.get(i);if(u.entities.contains(e)){o=u;break}}}if(!Object(s.default)(o))return A.default.FAILED;var d=Ic,f=Mc,c=0,h=A.default.DONE,m=o._visualizers,p=m.length;for(i=0;i<p;i++){var _=m[i];if(Object(s.default)(_.getBoundingSphere)){if(h=m[i].getBoundingSphere(e,f),!t&&h===A.default.PENDING)return A.default.PENDING;h===A.default.DONE&&(d[c]=r.default.clone(f,d[c]),c++)}}return 0===c?A.default.FAILED:(d.length=c,r.default.fromBoundingSpheres(d,a),A.default.DONE)},Dc.prototype._onDataSourceAdded=function(e,t){var a=this._scene,i=this._primitives,r=this._groundPrimitives,n=i.add(new h.a),o=r.add(new p);t._primitives=n,t._groundPrimitives=o;var s=t.clustering;s._initialize(a),n.add(s);var l=this._visualizersCallback(a,s,t);t._visualizersByDisplayID=t._visualizersByDisplayID||{},t._visualizersByDisplayID[this._displayID]=l,t._visualizers=t._visualizers||[],t._visualizers=t._visualizers.concat(l)},Dc.prototype._onDataSourceRemoved=function(e,t){var a=this._primitives,i=this._groundPrimitives,r=t._primitives,n=t._groundPrimitives,o=t.clustering;r.remove(o);var l=t._visualizersByDisplayID[this._displayID];if(Object(s.default)(l)){for(var u=l.length,d=0;d<u;d++){var f=l[d];f.destroy();var c=t._visualizers.indexOf(f);t._visualizers.splice(c,1)}delete t._visualizersByDisplayID[this._displayID],a.remove(r),i.remove(n)}},Dc.prototype._onDataSourceMoved=function(e,t,a){var i=this._primitives,r=this._groundPrimitives,n=e._primitives,o=e._groundPrimitives;t===a+1?(i.raise(n),r.raise(o)):t===a-1?(i.lower(n),r.lower(o)):0===t?(i.lowerToBottom(n),r.lowerToBottom(o),i.raise(n),r.raise(o)):(i.raiseToTop(n),r.raiseToTop(o))};t.default=Dc},94:function(e,t,a){"use strict";var i=a(36),r=a(9),n=a(8),o=a(10);a(11);function s(e){e=Object(r.default)(e,!0),this.value=s.toValue(e)}Object(o.default)(s.prototype,{componentDatatype:{get:function(){return i.a.UNSIGNED_BYTE}},componentsPerAttribute:{get:function(){return 1}},normalize:{get:function(){return!1}}}),s.toValue=function(e,t){return Object(n.default)(t)?(t[0]=e,t):new Uint8Array([e])},t.a=s}}]);
//# sourceMappingURL=4.TerriaMap.js.map