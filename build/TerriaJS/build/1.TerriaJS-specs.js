(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{1621:function(e,t,a){"use strict";var i=a(8);t.a=Object(i.default)({ROUNDED:0,MITERED:1,BEVELED:2})},1622:function(e,t,a){"use strict";var i=a(0),r=a(7),n=(a(11),a(23)),o=a(304),s=a(156),l=a(58);function u(){this._eventHelper=new o.default,this._definitionChanged=new n.default,this._intervals=new s.default,this._intervals.changedEvent.addEventListener(u.prototype._intervalsChanged,this)}Object(r.default)(u.prototype,{isConstant:{get:function(){return this._intervals.isEmpty}},definitionChanged:{get:function(){return this._definitionChanged}},intervals:{get:function(){return this._intervals}}}),u.prototype.getValue=function(e,t){var a=this._intervals.findDataForIntervalContainingDate(e);if(Object(i.default)(a))return a.getValue(e,t)},u.prototype.equals=function(e){return this===e||e instanceof u&&this._intervals.equals(e._intervals,l.default.equals)},u.prototype._intervalsChanged=function(){!function(e,t,a,r){function n(){a.raiseEvent(e)}var o=[];t.removeAll();for(var s=r.length,l=0;l<s;l++){var u=r.get(l);Object(i.default)(u.data)&&-1===o.indexOf(u.data)&&t.add(u.data.definitionChanged,n)}}(this,this._eventHelper,this._definitionChanged,this._intervals),this._definitionChanged.raiseEvent(this)},t.a=u},1623:function(e,t,a){"use strict";var i=a(8),r=a(3),n={HIGHLIGHT:0,REPLACE:1,MIX:2,getColorBlend:function(e,t){return e===n.HIGHLIGHT?0:e===n.REPLACE?1:e===n.MIX?r.default.clamp(t,r.default.EPSILON4,1):void 0}};t.a=Object(i.default)(n)},1624:function(e,t,a){"use strict";var i=a(2),r=a(0),n=a(7),o=(a(11),a(23)),s=a(169),l=a(1622),u=a(58);function d(e){this._referenceFrame=Object(i.default)(e,s.a.FIXED),this._definitionChanged=new o.default,this._composite=new l.a,this._composite.definitionChanged.addEventListener(d.prototype._raiseDefinitionChanged,this)}Object(n.default)(d.prototype,{isConstant:{get:function(){return this._composite.isConstant}},definitionChanged:{get:function(){return this._definitionChanged}},intervals:{get:function(){return this._composite.intervals}},referenceFrame:{get:function(){return this._referenceFrame},set:function(e){this._referenceFrame=e}}}),d.prototype.getValue=function(e,t){return this.getValueInReferenceFrame(e,s.a.FIXED,t)},d.prototype.getValueInReferenceFrame=function(e,t,a){var i=this._composite._intervals.findDataForIntervalContainingDate(e);if(Object(r.default)(i))return i.getValueInReferenceFrame(e,t,a)},d.prototype.equals=function(e){return this===e||e instanceof d&&this._referenceFrame===e._referenceFrame&&this._composite.equals(e._composite,u.default.equals)},d.prototype._raiseDefinitionChanged=function(){this._definitionChanged.raiseEvent(this)},t.a=d},1625:function(e,t,a){"use strict";var i=a(0),r=a(7),n=(a(11),a(23)),o=a(58);function s(e){var t=e._targetProperty;if(!Object(i.default)(t)){var a=e._targetEntity;if(!Object(i.default)(a)){if(a=e._targetCollection.getById(e._targetId),!Object(i.default)(a))return void(e._targetEntity=e._targetProperty=void 0);a.definitionChanged.addEventListener(l.prototype._onTargetEntityDefinitionChanged,e),e._targetEntity=a}var r=e._targetPropertyNames;t=e._targetEntity;for(var n=0,o=r.length;n<o&&Object(i.default)(t);++n)t=t[r[n]];e._targetProperty=t}return t}function l(e,t,a){this._targetCollection=e,this._targetId=t,this._targetPropertyNames=a,this._targetProperty=void 0,this._targetEntity=void 0,this._definitionChanged=new n.default,e.collectionChanged.addEventListener(l.prototype._onCollectionChanged,this)}Object(r.default)(l.prototype,{isConstant:{get:function(){return o.default.isConstant(s(this))}},definitionChanged:{get:function(){return this._definitionChanged}},referenceFrame:{get:function(){var e=s(this);return Object(i.default)(e)?e.referenceFrame:void 0}},targetId:{get:function(){return this._targetId}},targetCollection:{get:function(){return this._targetCollection}},targetPropertyNames:{get:function(){return this._targetPropertyNames}},resolvedProperty:{get:function(){return s(this)}}}),l.fromString=function(e,t){for(var a,i=[],r=!0,n=!1,o="",s=0;s<t.length;++s){var u=t.charAt(s);n?(o+=u,n=!1):"\\"===u?n=!0:r&&"#"===u?(a=o,r=!1,o=""):r||"."!==u?o+=u:(i.push(o),o="")}return i.push(o),new l(e,a,i)},l.prototype.getValue=function(e,t){var a=s(this);return Object(i.default)(a)?a.getValue(e,t):void 0},l.prototype.getValueInReferenceFrame=function(e,t,a){var r=s(this);return Object(i.default)(r)?r.getValueInReferenceFrame(e,t,a):void 0},l.prototype.getType=function(e){var t=s(this);return Object(i.default)(t)?t.getType(e):void 0},l.prototype.equals=function(e){if(this===e)return!0;var t=this._targetPropertyNames,a=e._targetPropertyNames;if(this._targetCollection!==e._targetCollection||this._targetId!==e._targetId||t.length!==a.length)return!1;for(var i=this._targetPropertyNames.length,r=0;r<i;r++)if(t[r]!==a[r])return!1;return!0},l.prototype._onTargetEntityDefinitionChanged=function(e,t,a,r){Object(i.default)(this._targetProperty)&&this._targetPropertyNames[0]===t&&(this._targetProperty=void 0,this._definitionChanged.raiseEvent(this))},l.prototype._onCollectionChanged=function(e,t,a){var r=this._targetEntity;Object(i.default)(r)&&-1!==a.indexOf(r)?(r.definitionChanged.removeEventListener(l.prototype._onTargetEntityDefinitionChanged,this),this._targetEntity=this._targetProperty=void 0):Object(i.default)(r)||(r=s(this),Object(i.default)(r)&&this._definitionChanged.raiseEvent(this))},t.a=l},1626:function(e,t,a){"use strict";var i=a(0),r=a(7),n=(a(11),a(25)),o=a(23),s=a(169),l=a(58);function u(e){this._definitionChanged=new o.default,this._value=void 0,this._removeSubscription=void 0,this.setValue(e)}Object(r.default)(u.prototype,{isConstant:{get:function(){return l.default.isConstant(this._value)}},definitionChanged:{get:function(){return this._definitionChanged}},referenceFrame:{get:function(){return Object(i.default)(this._value)?this._value.referenceFrame:s.a.FIXED}}}),u.prototype.getValue=function(e,t){return this.getValueInReferenceFrame(e,s.a.FIXED,t)},u.prototype.setValue=function(e){this._value!==e&&(this._value=e,Object(i.default)(this._removeSubscription)&&(this._removeSubscription(),this._removeSubscription=void 0),Object(i.default)(e)&&(this._removeSubscription=e.definitionChanged.addEventListener(this._raiseDefinitionChanged,this)),this._definitionChanged.raiseEvent(this))},u.prototype.getValueInReferenceFrame=function(e,t,a){if(Object(i.default)(this._value))return a=this._value.getValueInReferenceFrame(e,t,a),Object(i.default)(a)?n.default.WGS84.scaleToGeodeticSurface(a,a):void 0},u.prototype.equals=function(e){return this===e||e instanceof u&&this._value===e._value},u.prototype._raiseDefinitionChanged=function(){this._definitionChanged.raiseEvent(this)},t.a=u},720:function(e,t,a){"use strict";a.r(t);var i=a(152),r=a(21),n=(a(31),a(85)),o=a(2),s=a(0),l=a(7),u=a(24),d=a(304),f=a(518),c=a(515),h=a(335);function p(){this._length=0,this._collections={},this._collectionsArray=[],this.show=!0}Object(l.default)(p.prototype,{length:{get:function(){return this._length}}}),p.prototype.add=function(e,t){t=Object(o.default)(t,0);var a=this._collections[t];if(!Object(s.default)(a)){(a=new h.a({destroyPrimitives:!1}))._zIndex=t,this._collections[t]=a;for(var i=this._collectionsArray,r=0;r<i.length&&i[r]._zIndex<t;)r++;i.splice(r,0,a)}return a.add(e),this._length++,e._zIndex=t,e},p.prototype.set=function(e,t){return t===e._zIndex?e:(this.remove(e,!0),this.add(e,t),e)},p.prototype.remove=function(e,t){if(this.contains(e)){var a,i=e._zIndex,r=this._collections[i];return(a=t?r.remove(e):r.removeAndDestroy(e))&&this._length--,0===r.length&&(this._collectionsArray.splice(this._collectionsArray.indexOf(r),1),this._collections[i]=void 0,r.destroy()),a}return!1},p.prototype.removeAll=function(){for(var e=this._collectionsArray,t=0;t<e.length;t++){var a=e[t];a.destroyPrimitives=!0,a.destroy()}this._collections={},this._collectionsArray=[],this._length=0},p.prototype.contains=function(e){if(!Object(s.default)(e))return!1;var t=this._collections[e._zIndex];return Object(s.default)(t)&&t.contains(e)},p.prototype.update=function(e){if(this.show)for(var t=this._collectionsArray,a=0;a<t.length;a++)t[a].update(e)},p.prototype.isDestroyed=function(){return!1},p.prototype.destroy=function(){return this.removeAll(),Object(u.default)(this)};var m=p,v=a(165),g=a(33),_=a(6),y=a(1),b=a(13),O=a(11),w=a(149),x=a(84),A=a(119),j=a(144),E=a(87),C=a(512),P=a(58),T=b.default.WHITE,D=y.default.ZERO,I=A.default.NONE,S=_.default.ZERO,M=y.default.ZERO,R=j.default.CENTER,L=E.default.CENTER,V=new y.default,N=new b.default,F=new y.default,B=new _.default,U=new x.a,H=new x.a,k=new x.a,z=new g.default,G=new w.a;function q(e){this.entity=e,this.billboard=void 0,this.textureValue=void 0}function W(e,t){t.collectionChanged.addEventListener(W.prototype._onCollectionChanged,this),this._cluster=e,this._entityCollection=t,this._items=new v.default,this._onCollectionChanged(t,t.values,[],[])}function Y(e,t,a){Object(s.default)(e)&&(e.billboard=void 0,a.removeBillboard(t))}W.prototype.update=function(e){for(var t=this._items.values,a=this._cluster,i=0,r=t.length;i<r;i++){var n,o,l=t[i],u=l.entity,d=u._billboard,f=l.billboard,c=u.isShowing&&u.isAvailable(e)&&P.default.getValueOrDefault(d._show,e,!0);if(c&&(o=P.default.getValueOrUndefined(u._position,e,V),n=P.default.getValueOrUndefined(d._image,e),c=Object(s.default)(o)&&Object(s.default)(n)),c){P.default.isConstant(u._position)||(a._clusterDirty=!0),Object(s.default)(f)||((f=a.getBillboard(u)).id=u,f.image=void 0,l.billboard=f),f.show=c,Object(s.default)(f.image)&&l.textureValue===n||(f.image=n,l.textureValue=n),f.position=o,f.color=P.default.getValueOrDefault(d._color,e,T,N),f.eyeOffset=P.default.getValueOrDefault(d._eyeOffset,e,D,F),f.heightReference=P.default.getValueOrDefault(d._heightReference,e,I),f.pixelOffset=P.default.getValueOrDefault(d._pixelOffset,e,S,B),f.scale=P.default.getValueOrDefault(d._scale,e,1),f.rotation=P.default.getValueOrDefault(d._rotation,e,0),f.alignedAxis=P.default.getValueOrDefault(d._alignedAxis,e,M),f.horizontalOrigin=P.default.getValueOrDefault(d._horizontalOrigin,e,R),f.verticalOrigin=P.default.getValueOrDefault(d._verticalOrigin,e,L),f.width=P.default.getValueOrUndefined(d._width,e),f.height=P.default.getValueOrUndefined(d._height,e),f.scaleByDistance=P.default.getValueOrUndefined(d._scaleByDistance,e,U),f.translucencyByDistance=P.default.getValueOrUndefined(d._translucencyByDistance,e,H),f.pixelOffsetScaleByDistance=P.default.getValueOrUndefined(d._pixelOffsetScaleByDistance,e,k),f.sizeInMeters=P.default.getValueOrDefault(d._sizeInMeters,e,!1),f.distanceDisplayCondition=P.default.getValueOrUndefined(d._distanceDisplayCondition,e,G),f.disableDepthTestDistance=P.default.getValueOrUndefined(d._disableDepthTestDistance,e);var h=P.default.getValueOrUndefined(d._imageSubRegion,e,z);Object(s.default)(h)&&f.setImageSubRegion(f._imageId,h)}else Y(l,u,a)}return!0},W.prototype.getBoundingSphere=function(e,t){var a=this._items.get(e.id);if(!Object(s.default)(a)||!Object(s.default)(a.billboard))return C.default.FAILED;var i=a.billboard;if(i.heightReference===A.default.NONE)t.center=y.default.clone(i.position,t.center);else{if(!Object(s.default)(i._clampedPosition))return C.default.PENDING;t.center=y.default.clone(i._clampedPosition,t.center)}return t.radius=0,C.default.DONE},W.prototype.isDestroyed=function(){return!1},W.prototype.destroy=function(){this._entityCollection.collectionChanged.removeEventListener(W.prototype._onCollectionChanged,this);for(var e=this._entityCollection.values,t=0;t<e.length;t++)this._cluster.removeBillboard(e[t]);return Object(u.default)(this)},W.prototype._onCollectionChanged=function(e,t,a,i){var r,n,o=this._items,l=this._cluster;for(r=t.length-1;r>-1;r--)n=t[r],Object(s.default)(n._billboard)&&Object(s.default)(n._position)&&o.set(n.id,new q(n));for(r=i.length-1;r>-1;r--)n=i[r],Object(s.default)(n._billboard)&&Object(s.default)(n._position)?o.contains(n.id)||o.set(n.id,new q(n)):(Y(o.get(n.id),n,l),o.remove(n.id));for(r=a.length-1;r>-1;r--)n=a[r],Y(o.get(n.id),n,l),o.remove(n.id)};var K=W,X=a(242),Z=a(23),J=a(177),Q=a(8),$=a(67),ee=a(154),te=a(212);function ae(e){e=Object(o.default)(e,o.default.EMPTY_OBJECT);var t=Object(o.default)(e.translucent,!0),a=Object(o.default)(e.closed,!1),i=Object(o.default)(e.materialSupport,ae.MaterialSupport.TEXTURED);this.material=Object(s.default)(e.material)?e.material:te.a.fromType(te.a.ColorType),this.translucent=t,this._vertexShaderSource=Object(o.default)(e.vertexShaderSource,i.vertexShaderSource),this._fragmentShaderSource=Object(o.default)(e.fragmentShaderSource,i.fragmentShaderSource),this._renderState=ee.a.getDefaultRenderState(t,a,e.renderState),this._closed=a,this._materialSupport=i,this._vertexFormat=i.vertexFormat,this._flat=Object(o.default)(e.flat,!1),this._faceForward=Object(o.default)(e.faceForward,!a)}Object(l.default)(ae.prototype,{vertexShaderSource:{get:function(){return this._vertexShaderSource}},fragmentShaderSource:{get:function(){return this._fragmentShaderSource}},renderState:{get:function(){return this._renderState}},closed:{get:function(){return this._closed}},materialSupport:{get:function(){return this._materialSupport}},vertexFormat:{get:function(){return this._vertexFormat}},flat:{get:function(){return this._flat}},faceForward:{get:function(){return this._faceForward}}}),ae.prototype.getFragmentShaderSource=ee.a.prototype.getFragmentShaderSource,ae.prototype.isTranslucent=ee.a.prototype.isTranslucent,ae.prototype.getRenderState=ee.a.prototype.getRenderState,ae.MaterialSupport={BASIC:Object(Q.default)({vertexFormat:$.default.POSITION_AND_NORMAL,vertexShaderSource:"attribute vec3 position3DHigh;\nattribute vec3 position3DLow;\nattribute vec3 normal;\nattribute float batchId;\n\nvarying vec3 v_positionEC;\nvarying vec3 v_normalEC;\n\nvoid main()\n{\n    vec4 p = czm_computePosition();\n\n    v_positionEC = (czm_modelViewRelativeToEye * p).xyz;      // position in eye coordinates\n    v_normalEC = czm_normal * normal;                         // normal in eye coordinates\n\n    gl_Position = czm_modelViewProjectionRelativeToEye * p;\n}\n",fragmentShaderSource:"varying vec3 v_positionEC;\nvarying vec3 v_normalEC;\n\nvoid main()\n{\n    vec3 positionToEyeEC = -v_positionEC;\n\n    vec3 normalEC = normalize(v_normalEC);\n#ifdef FACE_FORWARD\n    normalEC = faceforward(normalEC, vec3(0.0, 0.0, 1.0), -normalEC);\n#endif\n\n    czm_materialInput materialInput;\n    materialInput.normalEC = normalEC;\n    materialInput.positionToEyeEC = positionToEyeEC;\n    czm_material material = czm_getMaterial(materialInput);\n\n#ifdef FLAT\n    gl_FragColor = vec4(material.diffuse + material.emission, material.alpha);\n#else\n    gl_FragColor = czm_phong(normalize(positionToEyeEC), material, czm_lightDirectionEC);\n#endif\n}\n"}),TEXTURED:Object(Q.default)({vertexFormat:$.default.POSITION_NORMAL_AND_ST,vertexShaderSource:"attribute vec3 position3DHigh;\nattribute vec3 position3DLow;\nattribute vec3 normal;\nattribute vec2 st;\nattribute float batchId;\n\nvarying vec3 v_positionEC;\nvarying vec3 v_normalEC;\nvarying vec2 v_st;\n\nvoid main()\n{\n    vec4 p = czm_computePosition();\n\n    v_positionEC = (czm_modelViewRelativeToEye * p).xyz;      // position in eye coordinates\n    v_normalEC = czm_normal * normal;                         // normal in eye coordinates\n    v_st = st;\n\n    gl_Position = czm_modelViewProjectionRelativeToEye * p;\n}\n",fragmentShaderSource:"varying vec3 v_positionEC;\nvarying vec3 v_normalEC;\nvarying vec2 v_st;\n\nvoid main()\n{\n    vec3 positionToEyeEC = -v_positionEC;\n\n    vec3 normalEC = normalize(v_normalEC);\n#ifdef FACE_FORWARD\n    normalEC = faceforward(normalEC, vec3(0.0, 0.0, 1.0), -normalEC);\n#endif\n\n    czm_materialInput materialInput;\n    materialInput.normalEC = normalEC;\n    materialInput.positionToEyeEC = positionToEyeEC;\n    materialInput.st = v_st;\n    czm_material material = czm_getMaterial(materialInput);\n\n#ifdef FLAT\n    gl_FragColor = vec4(material.diffuse + material.emission, material.alpha);\n#else\n    gl_FragColor = czm_phong(normalize(positionToEyeEC), material, czm_lightDirectionEC);\n#endif\n}\n"}),ALL:Object(Q.default)({vertexFormat:$.default.ALL,vertexShaderSource:"attribute vec3 position3DHigh;\nattribute vec3 position3DLow;\nattribute vec3 normal;\nattribute vec3 tangent;\nattribute vec3 bitangent;\nattribute vec2 st;\nattribute float batchId;\n\nvarying vec3 v_positionEC;\nvarying vec3 v_normalEC;\nvarying vec3 v_tangentEC;\nvarying vec3 v_bitangentEC;\nvarying vec2 v_st;\n\nvoid main()\n{\n    vec4 p = czm_computePosition();\n\n    v_positionEC = (czm_modelViewRelativeToEye * p).xyz;      // position in eye coordinates\n    v_normalEC = czm_normal * normal;                         // normal in eye coordinates\n    v_tangentEC = czm_normal * tangent;                       // tangent in eye coordinates\n    v_bitangentEC = czm_normal * bitangent;                   // bitangent in eye coordinates\n    v_st = st;\n\n    gl_Position = czm_modelViewProjectionRelativeToEye * p;\n}\n",fragmentShaderSource:"varying vec3 v_positionEC;\nvarying vec3 v_normalEC;\nvarying vec3 v_tangentEC;\nvarying vec3 v_bitangentEC;\nvarying vec2 v_st;\n\nvoid main()\n{\n    vec3 positionToEyeEC = -v_positionEC;\n    mat3 tangentToEyeMatrix = czm_tangentToEyeSpaceMatrix(v_normalEC, v_tangentEC, v_bitangentEC);\n\n    vec3 normalEC = normalize(v_normalEC);\n#ifdef FACE_FORWARD\n    normalEC = faceforward(normalEC, vec3(0.0, 0.0, 1.0), -normalEC);\n#endif\n\n    czm_materialInput materialInput;\n    materialInput.normalEC = normalEC;\n    materialInput.tangentToEyeMatrix = tangentToEyeMatrix;\n    materialInput.positionToEyeEC = positionToEyeEC;\n    materialInput.st = v_st;\n    czm_material material = czm_getMaterial(materialInput);\n\n#ifdef FLAT\n    gl_FragColor = vec4(material.diffuse + material.emission, material.alpha);\n#else\n    gl_FragColor = czm_phong(normalize(positionToEyeEC), material, czm_lightDirectionEC);\n#endif\n}\n"})};var ie=ae,re=a(116),ne=a(176),oe=a(214),se=a(399),le=a(139),ue=a(22);function de(e,t){e=Object(o.default)(e,0),t=Object(o.default)(t,Number.MAX_VALUE),this.value=new Float32Array([e,t])}Object(l.default)(de.prototype,{componentDatatype:{get:function(){return ue.a.FLOAT}},componentsPerAttribute:{get:function(){return 2}},normalize:{get:function(){return!1}}}),de.fromDistanceDisplayCondition=function(e){return new de(e.near,e.far)},de.toValue=function(e,t){return Object(s.default)(t)?(t[0]=e.near,t[1]=e.far,t):new Float32Array([e.near,e.far])};var fe=de,ce=a(120),he=a(148),pe=a(155),me=a(513),ve=a(412),ge=a(216),_e=a(100);function ye(){O.default.throwInstantiationError()}Object(l.default)(ye.prototype,{isConstant:{get:O.default.throwInstantiationError},definitionChanged:{get:O.default.throwInstantiationError}}),ye.prototype.getType=O.default.throwInstantiationError,ye.prototype.getValue=O.default.throwInstantiationError,ye.prototype.equals=O.default.throwInstantiationError,ye.getValue=function(e,t,a){var i;return Object(s.default)(t)&&(i=t.getType(e),Object(s.default)(i))?(Object(s.default)(a)&&a.type===i||(a=te.a.fromType(i)),t.getValue(e,a.uniforms),a):(Object(s.default)(a)&&a.type===te.a.ColorType||(a=te.a.fromType(te.a.ColorType)),b.default.clone(b.default.WHITE,a.uniforms.color),a)};var be=ye;function Oe(e,t,a){this._primitives=t,this._orderedGroundPrimitives=a,this._primitive=void 0,this._outlinePrimitive=void 0,this._geometryUpdater=e,this._options=e._options,this._entity=e._entity,this._material=void 0}Oe.prototype._isHidden=function(e,t,a){return!e.isShowing||!e.isAvailable(a)||!P.default.getValueOrDefault(t.show,a,!0)},Oe.prototype._setOptions=O.default.throwInstantiationError,Oe.prototype.update=function(e){var t=this._geometryUpdater,a=t._onTerrain,i=this._primitives,r=this._orderedGroundPrimitives;a?r.remove(this._primitive):(i.removeAndDestroy(this._primitive),i.removeAndDestroy(this._outlinePrimitive),this._outlinePrimitive=void 0),this._primitive=void 0;var n=this._entity,o=n[this._geometryUpdater._geometryPropertyName];if(this._setOptions(n,o,e),!this._isHidden(n,o,e)){var l=this._geometryUpdater.shadowsProperty.getValue(e),u=this._options;if(!Object(s.default)(o.fill)||o.fill.getValue(e)){var d,f=t.fillMaterialProperty,h=f instanceof ge.default,p=t._getIsClosed(u);if(h)d=new re.a({closed:p,flat:a&&!t._supportsMaterialsforEntitiesOnTerrain});else{var m=be.getValue(e,f,this._material);this._material=m,d=new ie({material:m,translucent:m.isTranslucent(),closed:p})}if(a)u.vertexFormat=re.a.VERTEX_FORMAT,this._primitive=r.add(new c.a({geometryInstances:this._geometryUpdater.createFillGeometryInstance(e),appearance:d,asynchronous:!1,shadows:l,classificationType:this._geometryUpdater.classificationTypeProperty.getValue(e)}),P.default.getValueOrUndefined(this._geometryUpdater.zIndex,e));else{u.vertexFormat=d.vertexFormat;var v=this._geometryUpdater.createFillGeometryInstance(e);h&&(d.translucent=255!==v.attributes.color.value[3]),this._primitive=i.add(new _e.a({geometryInstances:v,appearance:d,asynchronous:!1,shadows:l}))}}if(!a&&Object(s.default)(o.outline)&&o.outline.getValue(e)){var g=this._geometryUpdater.createOutlineGeometryInstance(e),_=P.default.getValueOrDefault(o.outlineWidth,e,1);this._outlinePrimitive=i.add(new _e.a({geometryInstances:g,appearance:new re.a({flat:!0,translucent:255!==g.attributes.color.value[3],renderState:{lineWidth:t._scene.clampLineWidth(_)}}),asynchronous:!1,shadows:l}))}}},Oe.prototype.getBoundingSphere=function(e){var t,a=this._entity,i=this._primitive,n=this._outlinePrimitive;return Object(s.default)(i)&&i.show&&i.ready&&(t=i.getGeometryInstanceAttributes(a),Object(s.default)(t)&&Object(s.default)(t.boundingSphere))?(r.default.clone(t.boundingSphere,e),C.default.DONE):Object(s.default)(n)&&n.show&&n.ready&&(t=n.getGeometryInstanceAttributes(a),Object(s.default)(t)&&Object(s.default)(t.boundingSphere))?(r.default.clone(t.boundingSphere,e),C.default.DONE):Object(s.default)(i)&&!i.ready||Object(s.default)(n)&&!n.ready?C.default.PENDING:C.default.FAILED},Oe.prototype.isDestroyed=function(){return!1},Oe.prototype.destroy=function(){var e=this._primitives,t=this._orderedGroundPrimitives;this._geometryUpdater._onTerrain?t.remove(this._primitive):e.removeAndDestroy(this._primitive),e.removeAndDestroy(this._outlinePrimitive),Object(u.default)(this)};var we=Oe,xe=a(514),Ae=a(129),je=a(150),Ee=new ge.default(b.default.WHITE),Ce=new Ae.a(!0),Pe=new Ae.a(!0),Te=new Ae.a(!1),De=new Ae.a(b.default.BLACK),Ie=new Ae.a(ne.a.DISABLED),Se=new Ae.a(new w.a),Me=new Ae.a(J.a.BOTH);function Re(e){var t=e.entity,a=e.geometryPropertyName;this._entity=t,this._scene=e.scene,this._fillEnabled=!1,this._isClosed=!1,this._onTerrain=!1,this._dynamic=!1,this._outlineEnabled=!1,this._geometryChanged=new Z.default,this._showProperty=void 0,this._materialProperty=void 0,this._showOutlineProperty=void 0,this._outlineColorProperty=void 0,this._outlineWidth=1,this._shadowsProperty=void 0,this._distanceDisplayConditionProperty=void 0,this._classificationTypeProperty=void 0,this._options=e.geometryOptions,this._geometryPropertyName=a,this._id=a+"-"+t.id,this._observedPropertyNames=e.observedPropertyNames,this._supportsMaterialsforEntitiesOnTerrain=je.default.supportsMaterialsforEntitiesOnTerrain(e.scene)}Object(l.default)(Re.prototype,{id:{get:function(){return this._id}},entity:{get:function(){return this._entity}},fillEnabled:{get:function(){return this._fillEnabled}},hasConstantFill:{get:function(){return!this._fillEnabled||!Object(s.default)(this._entity.availability)&&P.default.isConstant(this._showProperty)&&P.default.isConstant(this._fillProperty)}},fillMaterialProperty:{get:function(){return this._materialProperty}},outlineEnabled:{get:function(){return this._outlineEnabled}},hasConstantOutline:{get:function(){return!this._outlineEnabled||!Object(s.default)(this._entity.availability)&&P.default.isConstant(this._showProperty)&&P.default.isConstant(this._showOutlineProperty)}},outlineColorProperty:{get:function(){return this._outlineColorProperty}},outlineWidth:{get:function(){return this._outlineWidth}},shadowsProperty:{get:function(){return this._shadowsProperty}},distanceDisplayConditionProperty:{get:function(){return this._distanceDisplayConditionProperty}},classificationTypeProperty:{get:function(){return this._classificationTypeProperty}},isDynamic:{get:function(){return this._dynamic}},isClosed:{get:function(){return this._isClosed}},onTerrain:{get:function(){return this._onTerrain}},geometryChanged:{get:function(){return this._geometryChanged}}}),Re.prototype.isOutlineVisible=function(e){var t=this._entity,a=this._outlineEnabled&&t.isAvailable(e)&&this._showProperty.getValue(e)&&this._showOutlineProperty.getValue(e);return Object(o.default)(a,!1)},Re.prototype.isFilled=function(e){var t=this._entity,a=this._fillEnabled&&t.isAvailable(e)&&this._showProperty.getValue(e)&&this._fillProperty.getValue(e);return Object(o.default)(a,!1)},Re.prototype.createFillGeometryInstance=O.default.throwInstantiationError,Re.prototype.createOutlineGeometryInstance=O.default.throwInstantiationError,Re.prototype.isDestroyed=function(){return!1},Re.prototype.destroy=function(){Object(u.default)(this)},Re.prototype._isHidden=function(e,t){var a=t.show;return Object(s.default)(a)&&a.isConstant&&!a.getValue(pe.default.MINIMUM_VALUE)},Re.prototype._isOnTerrain=function(e,t){return!1},Re.prototype._getIsClosed=function(e){return!0},Re.prototype._isDynamic=O.default.throwInstantiationError,Re.prototype._setStaticOptions=O.default.throwInstantiationError,Re.prototype._onEntityPropertyChanged=function(e,t,a,i){if(-1!==this._observedPropertyNames.indexOf(t)){var r=this._entity[this._geometryPropertyName];if(Object(s.default)(r)){var n=r.fill,l=!Object(s.default)(n)||!n.isConstant||n.getValue(pe.default.MINIMUM_VALUE),u=r.outline,d=Object(s.default)(u);if(d&&u.isConstant&&(d=u.getValue(pe.default.MINIMUM_VALUE)),l||d){var f=r.show;if(this._isHidden(e,r))(this._fillEnabled||this._outlineEnabled)&&(this._fillEnabled=!1,this._outlineEnabled=!1,this._geometryChanged.raiseEvent(this));else{this._materialProperty=Object(o.default)(r.material,Ee),this._fillProperty=Object(o.default)(n,Pe),this._showProperty=Object(o.default)(f,Ce),this._showOutlineProperty=Object(o.default)(r.outline,Te),this._outlineColorProperty=d?Object(o.default)(r.outlineColor,De):void 0,this._shadowsProperty=Object(o.default)(r.shadows,Ie),this._distanceDisplayConditionProperty=Object(o.default)(r.distanceDisplayCondition,Se),this._classificationTypeProperty=Object(o.default)(r.classificationType,Me),this._fillEnabled=l;var c=this._isOnTerrain(e,r)&&(this._supportsMaterialsforEntitiesOnTerrain||this._materialProperty instanceof ge.default);if(d&&c&&(Object(xe.a)(xe.a.geometryOutlines),d=!1),this._onTerrain=c,this._outlineEnabled=d,this._isDynamic(e,r))this._dynamic||(this._dynamic=!0,this._geometryChanged.raiseEvent(this));else{this._setStaticOptions(e,r),this._isClosed=this._getIsClosed(this._options);var h=r.outlineWidth;this._outlineWidth=Object(s.default)(h)?h.getValue(pe.default.MINIMUM_VALUE):1,this._dynamic=!1,this._geometryChanged.raiseEvent(this)}}}else(this._fillEnabled||this._outlineEnabled)&&(this._fillEnabled=!1,this._outlineEnabled=!1,this._geometryChanged.raiseEvent(this))}else(this._fillEnabled||this._outlineEnabled)&&(this._fillEnabled=!1,this._outlineEnabled=!1,this._geometryChanged.raiseEvent(this))}},Re.prototype.createDynamicUpdater=function(e,t){return new this.constructor.DynamicGeometryUpdater(this,e,t)};var Le=Re,Ve=a(267),Ne=a(17),Fe=a(3),Be=a(14),Ue=new y.default,He=new Ne.default;function ke(e,t,a,i){this._scene=e,this._heightReference=a,this._extrudedHeightReference=i,this._positionProperty=t,this._position=new y.default,this._cartographicPosition=new Ne.default,this._normal=new y.default,this._definitionChanged=new Z.default,this._terrainHeight=0,this._removeCallbackFunc=void 0,this._removeEventListener=void 0,this._removeModeListener=void 0;var r=this;if(Object(s.default)(e.globe)&&(this._removeEventListener=e.terrainProviderChanged.addEventListener((function(){r._updateClamping()})),this._removeModeListener=e.morphComplete.addEventListener((function(){r._updateClamping()}))),t.isConstant){var n=t.getValue(pe.default.MINIMUM_VALUE,Ue);if(!Object(s.default)(n)||y.default.equals(n,y.default.ZERO)||!Object(s.default)(e.globe))return;this._position=y.default.clone(n,this._position),this._updateClamping(),this._normal=e.globe.ellipsoid.geodeticSurfaceNormal(n,this._normal)}}Object(l.default)(ke.prototype,{isConstant:{get:function(){return!1}},definitionChanged:{get:function(){return this._definitionChanged}}}),ke.prototype._updateClamping=function(){Object(s.default)(this._removeCallbackFunc)&&this._removeCallbackFunc();var e=this._scene,t=e.globe,a=this._position;if(Object(s.default)(t)&&!y.default.equals(a,y.default.ZERO)){var i=t.ellipsoid,r=t._surface,n=this,o=i.cartesianToCartographic(a,this._cartographicPosition),l=t.getHeight(o);Object(s.default)(l)?this._terrainHeight=l:this._terrainHeight=0,this._removeCallbackFunc=r.updateHeight(o,(function(t){if(e.mode===Be.a.SCENE3D){var a=i.cartesianToCartographic(t,He);n._terrainHeight=a.height}else n._terrainHeight=t.x;n.definitionChanged.raiseEvent()}))}else this._terrainHeight=0},ke.prototype.getValue=function(e,t){var a=P.default.getValueOrDefault(this._heightReference,e,A.default.NONE),i=P.default.getValueOrDefault(this._extrudedHeightReference,e,A.default.NONE);if(a===A.default.NONE&&i!==A.default.RELATIVE_TO_GROUND)return this._position=y.default.clone(y.default.ZERO,this._position),y.default.clone(y.default.ZERO,t);if(this._positionProperty.isConstant)return y.default.multiplyByScalar(this._normal,this._terrainHeight,t);var r=this._scene,n=this._positionProperty.getValue(e,Ue);if(!Object(s.default)(n)||y.default.equals(n,y.default.ZERO)||!Object(s.default)(r.globe))return y.default.clone(y.default.ZERO,t);if(y.default.equalsEpsilon(this._position,n,Fe.default.EPSILON10))return y.default.multiplyByScalar(this._normal,this._terrainHeight,t);this._position=y.default.clone(n,this._position),this._updateClamping();var o=r.globe.ellipsoid.geodeticSurfaceNormal(n,this._normal);return y.default.multiplyByScalar(o,this._terrainHeight,t)},ke.prototype.isDestroyed=function(){return!1},ke.prototype.destroy=function(){return Object(s.default)(this._removeEventListener)&&this._removeEventListener(),Object(s.default)(this._removeModeListener)&&this._removeModeListener(),Object(s.default)(this._removeCallbackFunc)&&this._removeCallbackFunc(),Object(u.default)(this)};var ze=ke;var Ge=function(e,t,a,i){if(Le.prototype._onEntityPropertyChanged.call(this,e,t,a,i),-1!==this._observedPropertyNames.indexOf(t)){var r=this._entity[this._geometryPropertyName];if(Object(s.default)(r)){Object(s.default)(this._terrainOffsetProperty)&&(this._terrainOffsetProperty.destroy(),this._terrainOffsetProperty=void 0);var n=r.heightReference;if(Object(s.default)(n)){var o=new Ve.default(this._computeCenter.bind(this),!this._dynamic);this._terrainOffsetProperty=new ze(this._scene,o,n)}}}},qe=y.default.ZERO,We=new y.default,Ye=new y.default,Ke=new b.default;function Xe(e){this.id=e,this.vertexFormat=void 0,this.dimensions=void 0,this.offsetAttribute=void 0}function Ze(e,t){Le.call(this,{entity:e,scene:t,geometryOptions:new Xe(e),geometryPropertyName:"box",observedPropertyNames:["availability","position","orientation","box"]}),this._onEntityPropertyChanged(e,"box",e.box,void 0)}function Je(e,t,a){we.call(this,e,t,a)}Object(s.default)(Object.create)&&(Ze.prototype=Object.create(Le.prototype),Ze.prototype.constructor=Ze),Object(l.default)(Ze.prototype,{terrainOffsetProperty:{get:function(){return this._terrainOffsetProperty}}}),Ze.prototype.createFillGeometryInstance=function(e){var t,a=this._entity,i=a.isAvailable(e),r=new ve.a(i&&a.isShowing&&this._showProperty.getValue(e)&&this._fillProperty.getValue(e)),n=this._distanceDisplayConditionProperty.getValue(e),o={show:r,distanceDisplayCondition:fe.fromDistanceDisplayCondition(n),color:void 0,offset:void 0};this._materialProperty instanceof ge.default&&(Object(s.default)(this._materialProperty.color)&&(this._materialProperty.color.isConstant||i)&&(t=this._materialProperty.color.getValue(e,Ke)),Object(s.default)(t)||(t=b.default.WHITE),o.color=le.a.fromColor(t));return Object(s.default)(this._options.offsetAttribute)&&(o.offset=me.a.fromCartesian3(P.default.getValueOrDefault(this._terrainOffsetProperty,e,qe,We))),new ce.a({id:a,geometry:oe.a.fromDimensions(this._options),modelMatrix:a.computeModelMatrixForHeightReference(e,a.box.heightReference,.5*this._options.dimensions.z,this._scene.mapProjection.ellipsoid),attributes:o})},Ze.prototype.createOutlineGeometryInstance=function(e){var t=this._entity,a=t.isAvailable(e),i=P.default.getValueOrDefault(this._outlineColorProperty,e,b.default.BLACK,Ke),r=this._distanceDisplayConditionProperty.getValue(e),n={show:new ve.a(a&&t.isShowing&&this._showProperty.getValue(e)&&this._showOutlineProperty.getValue(e)),color:le.a.fromColor(i),distanceDisplayCondition:fe.fromDistanceDisplayCondition(r),offset:void 0};return Object(s.default)(this._options.offsetAttribute)&&(n.offset=me.a.fromCartesian3(P.default.getValueOrDefault(this._terrainOffsetProperty,e,qe,We))),new ce.a({id:t,geometry:se.a.fromDimensions(this._options),modelMatrix:t.computeModelMatrixForHeightReference(e,t.box.heightReference,.5*this._options.dimensions.z,this._scene.mapProjection.ellipsoid),attributes:n})},Ze.prototype._computeCenter=function(e,t){return P.default.getValueOrUndefined(this._entity.position,e,t)},Ze.prototype._isHidden=function(e,t){return!Object(s.default)(t.dimensions)||!Object(s.default)(e.position)||Le.prototype._isHidden.call(this,e,t)},Ze.prototype._isDynamic=function(e,t){return!(e.position.isConstant&&P.default.isConstant(e.orientation)&&t.dimensions.isConstant&&P.default.isConstant(t.outlineWidth))},Ze.prototype._setStaticOptions=function(e,t){var a=P.default.getValueOrDefault(t.heightReference,pe.default.MINIMUM_VALUE,A.default.NONE),i=this._options;i.vertexFormat=this._materialProperty instanceof ge.default?re.a.VERTEX_FORMAT:ie.MaterialSupport.TEXTURED.vertexFormat,i.dimensions=t.dimensions.getValue(pe.default.MINIMUM_VALUE,i.dimensions),i.offsetAttribute=a!==A.default.NONE?he.a.ALL:void 0},Ze.prototype._onEntityPropertyChanged=Ge,Ze.DynamicGeometryUpdater=Je,Object(s.default)(Object.create)&&(Je.prototype=Object.create(we.prototype),Je.prototype.constructor=Je),Je.prototype._isHidden=function(e,t,a){var i=P.default.getValueOrUndefined(e.position,a,Ye),r=this._options.dimensions;return!Object(s.default)(i)||!Object(s.default)(r)||we.prototype._isHidden.call(this,e,t,a)},Je.prototype._setOptions=function(e,t,a){var i=P.default.getValueOrDefault(t.heightReference,a,A.default.NONE),r=this._options;r.dimensions=P.default.getValueOrUndefined(t.dimensions,a,r.dimensions),r.offsetAttribute=i!==A.default.NONE?he.a.ALL:void 0};var Qe=Ze,$e=a(157),et=a(239),tt=a(1621),at=a(16),it=a(25),rt=a(270),nt=a(205),ot=a(90),st=a(94),lt=a(4),ut=a(80),dt={numberOfPoints:function(e,t,a){var i=y.default.distance(e,t);return Math.ceil(i/a)},numberOfPointsRhumbLine:function(e,t,a){var i=Math.pow(e.longitude-t.longitude,2)+Math.pow(e.latitude-t.latitude,2);return Math.ceil(Math.sqrt(i/(a*a)))}},ft=new Ne.default;dt.extractHeights=function(e,t){for(var a=e.length,i=new Array(a),r=0;r<a;r++){var n=e[r];i[r]=t.cartesianToCartographic(n,ft).height}return i};var ct=new lt.default,ht=new y.default,pt=new y.default,mt=new ut.a(y.default.UNIT_X,0),vt=new y.default,gt=new ut.a(y.default.UNIT_X,0),_t=new y.default,yt=new y.default,bt=[];function Ot(e,t,a){var i,r=bt;if(r.length=e,t===a){for(i=0;i<e;i++)r[i]=t;return r}var n=(a-t)/e;for(i=0;i<e;i++){var o=t+i*n;r[i]=o}return r}var wt=new Ne.default,xt=new Ne.default,At=new y.default,jt=new y.default,Et=new y.default,Ct=new rt.default,Pt=new nt.a;function Tt(e,t,a,i,r,n,o,s){var l=i.scaleToGeodeticSurface(e,jt),u=i.scaleToGeodeticSurface(t,Et),d=dt.numberOfPoints(e,t,a),f=i.cartesianToCartographic(l,wt),c=i.cartesianToCartographic(u,xt),h=Ot(d,r,n);Ct.setEndPoints(f,c);var p=Ct.surfaceDistance/d,m=s;f.height=r;var v=i.cartographicToCartesian(f,At);y.default.pack(v,o,m),m+=3;for(var g=1;g<d;g++){var _=Ct.interpolateUsingSurfaceDistance(g*p,xt);_.height=h[g],v=i.cartographicToCartesian(_,At),y.default.pack(v,o,m),m+=3}return m}function Dt(e,t,a,i,r,n,o,s){var l=i.scaleToGeodeticSurface(e,jt),u=i.scaleToGeodeticSurface(t,Et),d=i.cartesianToCartographic(l,wt),f=i.cartesianToCartographic(u,xt),c=dt.numberOfPointsRhumbLine(d,f,a),h=Ot(c,r,n);Pt.ellipsoid.equals(i)||(Pt=new nt.a(void 0,void 0,i)),Pt.setEndPoints(d,f);var p=Pt.surfaceDistance/c,m=s;d.height=r;var v=i.cartographicToCartesian(d,At);y.default.pack(v,o,m),m+=3;for(var g=1;g<c;g++){var _=Pt.interpolateUsingSurfaceDistance(g*p,xt);_.height=h[g],v=i.cartographicToCartesian(_,At),y.default.pack(v,o,m),m+=3}return m}dt.wrapLongitude=function(e,t){var a=[],i=[];if(Object(s.default)(e)&&e.length>0){t=Object(o.default)(t,lt.default.IDENTITY);var r=lt.default.inverseTransformation(t,ct),n=lt.default.multiplyByPoint(r,y.default.ZERO,ht),l=y.default.normalize(lt.default.multiplyByPointAsVector(r,y.default.UNIT_Y,pt),pt),u=ut.a.fromPointNormal(n,l,mt),d=y.default.normalize(lt.default.multiplyByPointAsVector(r,y.default.UNIT_X,vt),vt),f=ut.a.fromPointNormal(n,d,gt),c=1;a.push(y.default.clone(e[0]));for(var h=a[0],p=e.length,m=1;m<p;++m){var v=e[m];if(ut.a.getPointDistance(f,h)<0||ut.a.getPointDistance(f,v)<0){var g=ot.default.lineSegmentPlane(h,v,u,_t);if(Object(s.default)(g)){var _=y.default.multiplyByScalar(l,5e-9,yt);ut.a.getPointDistance(u,h)<0&&y.default.negate(_,_),a.push(y.default.add(g,_,new y.default)),i.push(c+1),y.default.negate(_,_),a.push(y.default.add(g,_,new y.default)),c=1}}a.push(y.default.clone(e[m])),c++,h=v}i.push(c)}return{positions:a,lengths:i}},dt.generateArc=function(e){Object(s.default)(e)||(e={});var t=e.positions,a=t.length,i=Object(o.default)(e.ellipsoid,it.default.WGS84),r=Object(o.default)(e.height,0),n=Object(st.default)(r);if(a<1)return[];if(1===a){var l=i.scaleToGeodeticSurface(t[0],jt);if(0!==(r=n?r[0]:r)){var u=i.geodeticSurfaceNormal(l,At);y.default.multiplyByScalar(u,r,u),y.default.add(l,u,l)}return[l.x,l.y,l.z]}var d=e.minDistance;if(!Object(s.default)(d)){var f=Object(o.default)(e.granularity,Fe.default.RADIANS_PER_DEGREE);d=Fe.default.chordLength(f,i.maximumRadius)}var c,h=0;for(c=0;c<a-1;c++)h+=dt.numberOfPoints(t[c],t[c+1],d);var p=3*(h+1),m=new Array(p),v=0;for(c=0;c<a-1;c++){v=Tt(t[c],t[c+1],d,i,n?r[c]:r,n?r[c+1]:r,m,v)}bt.length=0;var g=t[a-1],_=i.cartesianToCartographic(g,wt);_.height=n?r[a-1]:r;var b=i.cartographicToCartesian(_,At);return y.default.pack(b,m,p-3),m};var It=new Ne.default,St=new Ne.default;dt.generateRhumbArc=function(e){Object(s.default)(e)||(e={});var t=e.positions,a=t.length,i=Object(o.default)(e.ellipsoid,it.default.WGS84),r=Object(o.default)(e.height,0),n=Object(st.default)(r);if(a<1)return[];if(1===a){var l=i.scaleToGeodeticSurface(t[0],jt);if(0!==(r=n?r[0]:r)){var u=i.geodeticSurfaceNormal(l,At);y.default.multiplyByScalar(u,r,u),y.default.add(l,u,l)}return[l.x,l.y,l.z]}var d,f,c=Object(o.default)(e.granularity,Fe.default.RADIANS_PER_DEGREE),h=0,p=i.cartesianToCartographic(t[0],It);for(d=0;d<a-1;d++)f=i.cartesianToCartographic(t[d+1],St),h+=dt.numberOfPointsRhumbLine(p,f,c),p=Ne.default.clone(f,It);var m=3*(h+1),v=new Array(m),g=0;for(d=0;d<a-1;d++){g=Dt(t[d],t[d+1],c,i,n?r[d]:r,n?r[d+1]:r,v,g)}bt.length=0;var _=t[a-1],b=i.cartesianToCartographic(_,wt);b.height=n?r[a-1]:r;var O=i.cartographicToCartesian(b,At);return y.default.pack(O,v,m-3),v},dt.generateCartesianArc=function(e){for(var t=dt.generateArc(e),a=t.length/3,i=new Array(a),r=0;r<a;r++)i[r]=y.default.unpack(t,3*r);return i},dt.generateCartesianRhumbArc=function(e){for(var t=dt.generateRhumbArc(e),a=t.length/3,i=new Array(a),r=0;r<a;r++)i[r]=y.default.unpack(t,3*r);return i};var Mt=dt,Rt=a(20),Lt=a(413),Vt=a(40),Nt=a(57),Ft=[new y.default,new y.default],Bt=new y.default,Ut=new y.default,Ht=new y.default,kt=new y.default,zt=new y.default,Gt=new y.default,qt=new y.default,Wt=new y.default,Yt=new y.default,Kt=new y.default,Xt=new y.default,Zt={},Jt=new Ne.default;function Qt(e,t,a,i){var r,n=e[0],o=e[1],s=y.default.angleBetween(n,o),l=Math.ceil(s/i),u=new Array(l);if(t===a){for(r=0;r<l;r++)u[r]=t;return u.push(a),u}var d=(a-t)/l;for(r=1;r<l;r++){var f=t+r*d;u[r]=f}return u[0]=t,u.push(a),u}var $t=new y.default,ea=new y.default;var ta=new y.default(-1,0,0),aa=new lt.default,ia=new lt.default,ra=new at.default,na=at.default.IDENTITY.clone(),oa=new y.default,sa=new Rt.a,la=new y.default;function ua(e,t,a,i,r,n,o,s){var l=oa,u=sa;aa=Nt.default.eastNorthUpToFixedFrame(e,r,aa),l=lt.default.multiplyByPointAsVector(aa,ta,l);var d=function(e,t,a,i){var r=new Lt.default(a,i),n=r.projectPointOntoPlane(y.default.add(a,e,$t),$t),o=r.projectPointOntoPlane(y.default.add(a,t,ea),ea),s=_.default.angleBetween(n,o);return o.x*n.y-o.y*n.x>=0?-s:s}(l=y.default.normalize(l,l),t,e,r);ra=at.default.fromRotationZ(d,ra),la.z=n,aa=lt.default.multiplyTransformation(aa,lt.default.fromRotationTranslation(ra,la,ia),aa);var f=na;f[0]=o;for(var c=0;c<s;c++)for(var h=0;h<a.length;h+=3)u=y.default.fromArray(a,h,u),u=at.default.multiplyByVector(f,u,u),u=lt.default.multiplyByPoint(aa,u,u),i.push(u.x,u.y,u.z);return i}var da=new y.default;function fa(e,t,a,i,r,n,o){for(var s=0;s<e.length;s+=3){i=ua(y.default.fromArray(e,s,da),t,a,i,r,n[s/3],o,1)}return i}function ca(e,t){for(var a=e.length,i=new Array(3*a),r=0,n=t.x+t.width/2,o=t.y+t.height/2,s=0;s<a;s++)i[r++]=e[s].x-n,i[r++]=0,i[r++]=e[s].y-o;return i}var ha=new Vt.default,pa=new y.default,ma=new at.default;function va(e,t,a,i,r,n,o,s,l,u){var d,f,c=y.default.angleBetween(y.default.subtract(t,e,Kt),y.default.subtract(a,e,Xt)),h=i===tt.a.BEVELED?0:Math.ceil(c/Fe.default.toRadians(5));if(d=r?at.default.fromQuaternion(Vt.default.fromAxisAngle(y.default.negate(e,Kt),c/(h+1),ha),ma):at.default.fromQuaternion(Vt.default.fromAxisAngle(e,c/(h+1),ha),ma),t=y.default.clone(t,pa),h>0)for(var p=u?2:1,m=0;m<h;m++)t=at.default.multiplyByVector(d,t,t),f=y.default.subtract(t,e,Kt),f=y.default.normalize(f,f),r||(f=y.default.negate(f,f)),o=ua(n.scaleToGeodeticSurface(t,Xt),f,s,o,n,l,1,p);else f=y.default.subtract(t,e,Kt),f=y.default.normalize(f,f),r||(f=y.default.negate(f,f)),o=ua(n.scaleToGeodeticSurface(t,Xt),f,s,o,n,l,1,1),a=y.default.clone(a,pa),f=y.default.subtract(a,e,Kt),f=y.default.normalize(f,f),r||(f=y.default.negate(f,f)),o=ua(n.scaleToGeodeticSurface(a,Xt),f,s,o,n,l,1,1);return o}Zt.removeDuplicatesFromShape=function(e){for(var t=e.length,a=[],i=t-1,r=0;r<t;i=r++){var n=e[i],o=e[r];_.default.equals(n,o)||a.push(o)}return a},Zt.angleIsGreaterThanPi=function(e,t,a,i){var r=new Lt.default(a,i),n=r.projectPointOntoPlane(y.default.add(a,e,$t),$t),o=r.projectPointOntoPlane(y.default.add(a,t,ea),ea);return o.x*n.y-o.y*n.x>=0};var ga=new y.default,_a=new y.default;Zt.computePositions=function(e,t,a,i,r){var n=i._ellipsoid,o=function(e,t){for(var a=new Array(e.length),i=0;i<e.length;i++){var r=e[i];Jt=t.cartesianToCartographic(r,Jt),a[i]=Jt.height,e[i]=t.scaleToGeodeticSurface(r,r)}return a}(e,n),s=i._granularity,l=i._cornerType,u=r?function(e,t){var a=e.length,i=new Array(6*a),r=0,n=t.x+t.width/2,o=t.y+t.height/2,s=e[0];i[r++]=s.x-n,i[r++]=0,i[r++]=s.y-o;for(var l=1;l<a;l++){var u=(s=e[l]).x-n,d=s.y-o;i[r++]=u,i[r++]=0,i[r++]=d,i[r++]=u,i[r++]=0,i[r++]=d}return s=e[0],i[r++]=s.x-n,i[r++]=0,i[r++]=s.y-o,i}(t,a):ca(t,a),d=r?ca(t,a):void 0,f=a.height/2,c=a.width/2,h=e.length,p=[],m=r?[]:void 0,v=Bt,g=Ut,_=Ht,b=kt,O=zt,w=Gt,x=qt,A=Wt,j=Yt,E=e[0],C=e[1];b=n.geodeticSurfaceNormal(E,b),v=y.default.subtract(C,E,v),v=y.default.normalize(v,v),A=y.default.cross(b,v,A),A=y.default.normalize(A,A);var P,T=o[0],D=o[1];r&&(m=ua(E,A,d,m,n,T+f,1,1)),j=y.default.clone(E,j),E=C,g=y.default.negate(v,g);for(var I=1;I<h-1;I++){var S=r?2:1;C=e[I+1],v=y.default.subtract(C,E,v),v=y.default.normalize(v,v),_=y.default.add(v,g,_),_=y.default.normalize(_,_),b=n.geodeticSurfaceNormal(E,b);var M=y.default.multiplyByScalar(b,y.default.dot(v,b),ga);y.default.subtract(v,M,M),y.default.normalize(M,M);var R=y.default.multiplyByScalar(b,y.default.dot(g,b),_a);if(y.default.subtract(g,R,R),y.default.normalize(R,R),!Fe.default.equalsEpsilon(Math.abs(y.default.dot(M,R)),1,Fe.default.EPSILON7)){_=y.default.cross(_,b,_),_=y.default.cross(b,_,_),_=y.default.normalize(_,_);var L=1/Math.max(.25,y.default.magnitude(y.default.cross(_,g,Kt))),V=Zt.angleIsGreaterThanPi(v,g,E,n);V?(O=y.default.add(E,y.default.multiplyByScalar(_,L*c,_),O),w=y.default.add(O,y.default.multiplyByScalar(A,c,w),w),Ft[0]=y.default.clone(j,Ft[0]),Ft[1]=y.default.clone(w,Ft[1]),P=Qt(Ft,T+f,D+f,s),p=fa(Mt.generateArc({positions:Ft,granularity:s,ellipsoid:n}),A,u,p,n,P,1),A=y.default.cross(b,v,A),A=y.default.normalize(A,A),x=y.default.add(O,y.default.multiplyByScalar(A,c,x),x),l===tt.a.ROUNDED||l===tt.a.BEVELED?va(O,w,x,l,V,n,p,u,D+f,r):p=ua(E,_=y.default.negate(_,_),u,p,n,D+f,L,S),j=y.default.clone(x,j)):(O=y.default.add(E,y.default.multiplyByScalar(_,L*c,_),O),w=y.default.add(O,y.default.multiplyByScalar(A,-c,w),w),Ft[0]=y.default.clone(j,Ft[0]),Ft[1]=y.default.clone(w,Ft[1]),P=Qt(Ft,T+f,D+f,s),p=fa(Mt.generateArc({positions:Ft,granularity:s,ellipsoid:n}),A,u,p,n,P,1),A=y.default.cross(b,v,A),A=y.default.normalize(A,A),x=y.default.add(O,y.default.multiplyByScalar(A,-c,x),x),l===tt.a.ROUNDED||l===tt.a.BEVELED?va(O,w,x,l,V,n,p,u,D+f,r):p=ua(E,_,u,p,n,D+f,L,S),j=y.default.clone(x,j)),g=y.default.negate(v,g)}else p=ua(j,A,u,p,n,T+f,1,1),j=E;T=D,D=o[I+1],E=C}Ft[0]=y.default.clone(j,Ft[0]),Ft[1]=y.default.clone(E,Ft[1]),P=Qt(Ft,T+f,D+f,s),p=fa(Mt.generateArc({positions:Ft,granularity:s,ellipsoid:n}),A,u,p,n,P,1),r&&(m=ua(E,A,d,m,n,D+f,1,1)),h=p.length;var N=r?h+m.length:h,F=new Float64Array(N);return F.set(p),r&&F.set(m,h),F};var ya=Zt,ba={},Oa=new y.default,wa=new y.default,xa=new y.default,Aa=new y.default,ja=[new y.default,new y.default],Ea=new y.default,Ca=new y.default,Pa=new y.default,Ta=new y.default,Da=new y.default,Ia=new y.default,Sa=new y.default,Ma=new y.default,Ra=new y.default,La=new y.default,Va=new Vt.default,Na=new at.default;function Fa(e,t,a,i,r){var n,o=y.default.angleBetween(y.default.subtract(t,e,Oa),y.default.subtract(a,e,wa)),s=i===tt.a.BEVELED?1:Math.ceil(o/Fe.default.toRadians(5))+1,l=3*s,u=new Array(l);u[l-3]=a.x,u[l-2]=a.y,u[l-1]=a.z,n=r?at.default.fromQuaternion(Vt.default.fromAxisAngle(y.default.negate(e,Oa),o/s,Va),Na):at.default.fromQuaternion(Vt.default.fromAxisAngle(e,o/s,Va),Na);var d=0;t=y.default.clone(t,Oa);for(var f=0;f<s;f++)t=at.default.multiplyByVector(n,t,t),u[d++]=t.x,u[d++]=t.y,u[d++]=t.z;return u}function Ba(e,t,a,i){var r=Oa;return i?r=y.default.add(e,t,r):(t=y.default.negate(t,t),r=y.default.add(e,t,r)),[r.x,r.y,r.z,a.x,a.y,a.z]}function Ua(e,t,a,i){for(var r=new Array(e.length),n=new Array(e.length),o=y.default.multiplyByScalar(t,a,Oa),s=y.default.negate(o,wa),l=0,u=e.length-1,d=0;d<e.length;d+=3){var f=y.default.fromArray(e,d,xa),c=y.default.add(f,s,Aa);r[l++]=c.x,r[l++]=c.y,r[l++]=c.z;var h=y.default.add(f,o,Aa);n[u--]=h.z,n[u--]=h.y,n[u--]=h.x}return i.push(r,n),i}ba.addAttribute=function(e,t,a,i){var r=t.x,n=t.y,o=t.z;Object(s.default)(a)&&(e[a]=r,e[a+1]=n,e[a+2]=o),Object(s.default)(i)&&(e[i]=o,e[i-1]=n,e[i-2]=r)};var Ha=new y.default,ka=new y.default;ba.computePositions=function(e){var t=e.granularity,a=e.positions,i=e.ellipsoid,r=e.width/2,n=e.cornerType,o=e.saveAttributes,s=Ea,l=Ca,u=Pa,d=Ta,f=Da,c=Ia,h=Sa,p=Ma,m=Ra,v=La,g=[],_=o?[]:void 0,b=o?[]:void 0,O=a[0],w=a[1];l=y.default.normalize(y.default.subtract(w,O,l),l),s=i.geodeticSurfaceNormal(O,s),d=y.default.normalize(y.default.cross(s,l,d),d),o&&(_.push(d.x,d.y,d.z),b.push(s.x,s.y,s.z)),h=y.default.clone(O,h),O=w,u=y.default.negate(l,u);var x,A,j=[],E=a.length;for(x=1;x<E-1;x++){s=i.geodeticSurfaceNormal(O,s),w=a[x+1],l=y.default.normalize(y.default.subtract(w,O,l),l),f=y.default.normalize(y.default.add(l,u,f),f);var C=y.default.multiplyByScalar(s,y.default.dot(l,s),Ha);y.default.subtract(l,C,C),y.default.normalize(C,C);var P=y.default.multiplyByScalar(s,y.default.dot(u,s),ka);if(y.default.subtract(u,P,P),y.default.normalize(P,P),!Fe.default.equalsEpsilon(Math.abs(y.default.dot(C,P)),1,Fe.default.EPSILON7)){f=y.default.cross(f,s,f),f=y.default.cross(s,f,f),f=y.default.normalize(f,f);var T=r/Math.max(.25,y.default.magnitude(y.default.cross(f,u,Oa))),D=ya.angleIsGreaterThanPi(l,u,O,i);f=y.default.multiplyByScalar(f,T,f),D?(p=y.default.add(O,f,p),v=y.default.add(p,y.default.multiplyByScalar(d,r,v),v),m=y.default.add(p,y.default.multiplyByScalar(d,2*r,m),m),ja[0]=y.default.clone(h,ja[0]),ja[1]=y.default.clone(v,ja[1]),g=Ua(Mt.generateArc({positions:ja,granularity:t,ellipsoid:i}),d,r,g),o&&(_.push(d.x,d.y,d.z),b.push(s.x,s.y,s.z)),c=y.default.clone(m,c),d=y.default.normalize(y.default.cross(s,l,d),d),m=y.default.add(p,y.default.multiplyByScalar(d,2*r,m),m),h=y.default.add(p,y.default.multiplyByScalar(d,r,h),h),n===tt.a.ROUNDED||n===tt.a.BEVELED?j.push({leftPositions:Fa(p,c,m,n,D)}):j.push({leftPositions:Ba(O,y.default.negate(f,f),m,D)})):(m=y.default.add(O,f,m),v=y.default.add(m,y.default.negate(y.default.multiplyByScalar(d,r,v),v),v),p=y.default.add(m,y.default.negate(y.default.multiplyByScalar(d,2*r,p),p),p),ja[0]=y.default.clone(h,ja[0]),ja[1]=y.default.clone(v,ja[1]),g=Ua(Mt.generateArc({positions:ja,granularity:t,ellipsoid:i}),d,r,g),o&&(_.push(d.x,d.y,d.z),b.push(s.x,s.y,s.z)),c=y.default.clone(p,c),d=y.default.normalize(y.default.cross(s,l,d),d),p=y.default.add(m,y.default.negate(y.default.multiplyByScalar(d,2*r,p),p),p),h=y.default.add(m,y.default.negate(y.default.multiplyByScalar(d,r,h),h),h),n===tt.a.ROUNDED||n===tt.a.BEVELED?j.push({rightPositions:Fa(m,c,p,n,D)}):j.push({rightPositions:Ba(O,f,p,D)})),u=y.default.negate(l,u)}O=w}return s=i.geodeticSurfaceNormal(O,s),ja[0]=y.default.clone(h,ja[0]),ja[1]=y.default.clone(O,ja[1]),g=Ua(Mt.generateArc({positions:ja,granularity:t,ellipsoid:i}),d,r,g),o&&(_.push(d.x,d.y,d.z),b.push(s.x,s.y,s.z)),n===tt.a.ROUNDED&&(A=function(e){var t=Ea,a=Ca,i=Pa,r=e[1];a=y.default.fromArray(e[1],r.length-3,a),i=y.default.fromArray(e[0],0,i);var n=Fa(t=y.default.midpoint(a,i,t),a,i,tt.a.ROUNDED,!1),o=e.length-1,s=e[o-1];return r=e[o],a=y.default.fromArray(s,s.length-3,a),i=y.default.fromArray(r,0,i),[n,Fa(t=y.default.midpoint(a,i,t),a,i,tt.a.ROUNDED,!1)]}(g)),{positions:g,corners:j,lefts:_,normals:b,endPositions:A}};var za=ba,Ga=a(59),qa=a(46),Wa=a(124),Ya=a(56),Ka=a(194),Xa=a(49),Za=a(19),Ja=new y.default,Qa=new y.default,$a=new y.default,ei=new y.default,ti=new y.default,ai=new y.default,ii=new y.default,ri=new y.default;function ni(e,t){for(var a=0;a<e.length;a++)e[a]=t.scaleToGeodeticSurface(e[a],e[a]);return e}function oi(e,t,a,i,r,n){var o=e.normals,s=e.tangents,l=e.bitangents,u=y.default.normalize(y.default.cross(a,t,ii),ii);n.normal&&za.addAttribute(o,t,i,r),n.tangent&&za.addAttribute(s,u,i,r),n.bitangent&&za.addAttribute(l,a,i,r)}function si(e,t,a){var i,r,n,o=e.positions,l=e.corners,u=e.endPositions,d=e.lefts,f=e.normals,c=new Wa.a,h=0,p=0,m=0;for(r=0;r<o.length;r+=2)h+=n=o[r].length-3,m+=2*n,p+=o[r+1].length-3;for(h+=3,p+=3,r=0;r<l.length;r++){i=l[r];var v=l[r].leftPositions;Object(s.default)(v)?(h+=n=v.length,m+=n):(p+=n=l[r].rightPositions.length,m+=n)}var g,_=Object(s.default)(u);_&&(h+=g=u[0].length-3,p+=g,m+=6*(g/=3));var b,O,w,x,A,j,E=h+p,C=new Float64Array(E),P={normals:t.normal?new Float32Array(E):void 0,tangents:t.tangent?new Float32Array(E):void 0,bitangents:t.bitangent?new Float32Array(E):void 0},T=0,D=E-1,I=Ja,S=Qa,M=g/2,R=Ya.a.createTypedArray(E/3,m),L=0;if(_){j=$a,A=ei;var V=u[0];for(I=y.default.fromArray(f,0,I),S=y.default.fromArray(d,0,S),r=0;r<M;r++)j=y.default.fromArray(V,3*(M-1-r),j),A=y.default.fromArray(V,3*(M+r),A),za.addAttribute(C,A,T),za.addAttribute(C,j,void 0,D),oi(P,I,S,T,D,t),x=(O=T/3)+1,w=(b=(D-2)/3)-1,R[L++]=b,R[L++]=O,R[L++]=w,R[L++]=w,R[L++]=O,R[L++]=x,T+=3,D-=3}var N,F,B=0,U=0,H=o[B++],k=o[B++];for(C.set(H,T),C.set(k,D-k.length+1),S=y.default.fromArray(d,U,S),n=k.length-3,r=0;r<n;r+=3)N=a.geodeticSurfaceNormal(y.default.fromArray(H,r,ii),ii),F=a.geodeticSurfaceNormal(y.default.fromArray(k,n-r,ri),ri),oi(P,I=y.default.normalize(y.default.add(N,F,I),I),S,T,D,t),x=(O=T/3)+1,w=(b=(D-2)/3)-1,R[L++]=b,R[L++]=O,R[L++]=w,R[L++]=w,R[L++]=O,R[L++]=x,T+=3,D-=3;for(N=a.geodeticSurfaceNormal(y.default.fromArray(H,n,ii),ii),F=a.geodeticSurfaceNormal(y.default.fromArray(k,n,ri),ri),I=y.default.normalize(y.default.add(N,F,I),I),U+=3,r=0;r<l.length;r++){var z,G,q,W=(i=l[r]).leftPositions,Y=i.rightPositions,K=ai,X=$a,Z=ei;if(I=y.default.fromArray(f,U,I),Object(s.default)(W)){for(oi(P,I,S,void 0,D,t),D-=3,G=x,q=w,z=0;z<W.length/3;z++)K=y.default.fromArray(W,3*z,K),R[L++]=G,R[L++]=q-z-1,R[L++]=q-z,za.addAttribute(C,K,void 0,D),X=y.default.fromArray(C,3*(q-z-1),X),Z=y.default.fromArray(C,3*G,Z),oi(P,I,S=y.default.normalize(y.default.subtract(X,Z,S),S),void 0,D,t),D-=3;K=y.default.fromArray(C,3*G,K),X=y.default.subtract(y.default.fromArray(C,3*q,X),K,X),Z=y.default.subtract(y.default.fromArray(C,3*(q-z),Z),K,Z),oi(P,I,S=y.default.normalize(y.default.add(X,Z,S),S),T,void 0,t),T+=3}else{for(oi(P,I,S,T,void 0,t),T+=3,G=w,q=x,z=0;z<Y.length/3;z++)K=y.default.fromArray(Y,3*z,K),R[L++]=G,R[L++]=q+z,R[L++]=q+z+1,za.addAttribute(C,K,T),X=y.default.fromArray(C,3*G,X),Z=y.default.fromArray(C,3*(q+z),Z),oi(P,I,S=y.default.normalize(y.default.subtract(X,Z,S),S),T,void 0,t),T+=3;K=y.default.fromArray(C,3*G,K),X=y.default.subtract(y.default.fromArray(C,3*(q+z),X),K,X),Z=y.default.subtract(y.default.fromArray(C,3*q,Z),K,Z),oi(P,I,S=y.default.normalize(y.default.negate(y.default.add(Z,X,S),S),S),void 0,D,t),D-=3}for(H=o[B++],k=o[B++],H.splice(0,3),k.splice(k.length-3,3),C.set(H,T),C.set(k,D-k.length+1),n=k.length-3,U+=3,S=y.default.fromArray(d,U,S),z=0;z<k.length;z+=3)N=a.geodeticSurfaceNormal(y.default.fromArray(H,z,ii),ii),F=a.geodeticSurfaceNormal(y.default.fromArray(k,n-z,ri),ri),oi(P,I=y.default.normalize(y.default.add(N,F,I),I),S,T,D,t),O=(x=T/3)-1,b=(w=(D-2)/3)+1,R[L++]=b,R[L++]=O,R[L++]=w,R[L++]=w,R[L++]=O,R[L++]=x,T+=3,D-=3;T-=3,D+=3}if(oi(P,I=y.default.fromArray(f,f.length-3,I),S,T,D,t),_){T+=3,D-=3,j=$a,A=ei;var J=u[1];for(r=0;r<M;r++)j=y.default.fromArray(J,3*(g-r-1),j),A=y.default.fromArray(J,3*r,A),za.addAttribute(C,j,void 0,D),za.addAttribute(C,A,T),oi(P,I,S,T,D,t),O=(x=T/3)-1,b=(w=(D-2)/3)+1,R[L++]=b,R[L++]=O,R[L++]=w,R[L++]=w,R[L++]=O,R[L++]=x,T+=3,D-=3}if(c.position=new qa.a({componentDatatype:ue.a.DOUBLE,componentsPerAttribute:3,values:C}),t.st){var Q,$,ee=new Float32Array(E/3*2),te=0;if(_){h/=3,p/=3;var ae,ie=Math.PI/(g+1);$=1/(h-g+1),Q=1/(p-g+1);var re=g/2;for(r=re+1;r<g+1;r++)ae=Fe.default.PI_OVER_TWO+ie*r,ee[te++]=Q*(1+Math.cos(ae)),ee[te++]=.5*(1+Math.sin(ae));for(r=1;r<p-g+1;r++)ee[te++]=r*Q,ee[te++]=0;for(r=g;r>re;r--)ae=Fe.default.PI_OVER_TWO-r*ie,ee[te++]=1-Q*(1+Math.cos(ae)),ee[te++]=.5*(1+Math.sin(ae));for(r=re;r>0;r--)ae=Fe.default.PI_OVER_TWO-ie*r,ee[te++]=1-$*(1+Math.cos(ae)),ee[te++]=.5*(1+Math.sin(ae));for(r=h-g;r>0;r--)ee[te++]=r*$,ee[te++]=1;for(r=1;r<re+1;r++)ae=Fe.default.PI_OVER_TWO+ie*r,ee[te++]=$*(1+Math.cos(ae)),ee[te++]=.5*(1+Math.sin(ae))}else{for($=1/((h/=3)-1),Q=1/((p/=3)-1),r=0;r<p;r++)ee[te++]=r*Q,ee[te++]=0;for(r=h;r>0;r--)ee[te++]=(r-1)*$,ee[te++]=1}c.st=new qa.a({componentDatatype:ue.a.FLOAT,componentsPerAttribute:2,values:ee})}return t.normal&&(c.normal=new qa.a({componentDatatype:ue.a.FLOAT,componentsPerAttribute:3,values:P.normals})),t.tangent&&(c.tangent=new qa.a({componentDatatype:ue.a.FLOAT,componentsPerAttribute:3,values:P.tangents})),t.bitangent&&(c.bitangent=new qa.a({componentDatatype:ue.a.FLOAT,componentsPerAttribute:3,values:P.bitangents})),{attributes:c,indices:R}}function li(e,t,a){a[t++]=e[0],a[t++]=e[1],a[t++]=e[2];for(var i=3;i<e.length;i+=3){var r=e[i],n=e[i+1],o=e[i+2];a[t++]=r,a[t++]=n,a[t++]=o,a[t++]=r,a[t++]=n,a[t++]=o}return a[t++]=e[0],a[t++]=e[1],a[t++]=e[2],a}function ui(e,t){var a=new $.default({position:t.position,normal:t.normal||t.bitangent||e.shadowVolume,tangent:t.tangent,bitangent:t.normal||t.bitangent,st:t.st}),i=e.ellipsoid,r=si(za.computePositions(e),a,i),n=e.height,o=e.extrudedHeight,l=r.attributes,u=r.indices,d=l.position.values,f=d.length,c=new Float64Array(6*f),h=new Float64Array(f);h.set(d);var p,m=new Float64Array(4*f);m=li(d=Ka.a.scaleToGeodeticHeight(d,n,i),0,m),m=li(h=Ka.a.scaleToGeodeticHeight(h,o,i),2*f,m),c.set(d),c.set(h,f),c.set(m,2*f),l.position.values=c,l=function(e,t){if(!(t.normal||t.tangent||t.bitangent||t.st))return e;var a,i,r=e.position.values;(t.normal||t.bitangent)&&(a=e.normal.values,i=e.bitangent.values);var n,o=e.position.values.length/18,s=3*o,l=2*o,u=2*s;if(t.normal||t.bitangent||t.tangent){var d=t.normal?new Float32Array(6*s):void 0,f=t.tangent?new Float32Array(6*s):void 0,c=t.bitangent?new Float32Array(6*s):void 0,h=Ja,p=Qa,m=$a,v=ei,g=ti,_=ai,b=u;for(n=0;n<s;n+=3){var O=b+u;h=y.default.fromArray(r,n,h),p=y.default.fromArray(r,n+s,p),m=y.default.fromArray(r,(n+3)%s,m),p=y.default.subtract(p,h,p),m=y.default.subtract(m,h,m),v=y.default.normalize(y.default.cross(p,m,v),v),t.normal&&(za.addAttribute(d,v,O),za.addAttribute(d,v,O+3),za.addAttribute(d,v,b),za.addAttribute(d,v,b+3)),(t.tangent||t.bitangent)&&(_=y.default.fromArray(a,n,_),t.bitangent&&(za.addAttribute(c,_,O),za.addAttribute(c,_,O+3),za.addAttribute(c,_,b),za.addAttribute(c,_,b+3)),t.tangent&&(g=y.default.normalize(y.default.cross(_,v,g),g),za.addAttribute(f,g,O),za.addAttribute(f,g,O+3),za.addAttribute(f,g,b),za.addAttribute(f,g,b+3))),b+=6}if(t.normal){for(d.set(a),n=0;n<s;n+=3)d[n+s]=-a[n],d[n+s+1]=-a[n+1],d[n+s+2]=-a[n+2];e.normal.values=d}else e.normal=void 0;if(t.bitangent?(c.set(i),c.set(i,s),e.bitangent.values=c):e.bitangent=void 0,t.tangent){var w=e.tangent.values;f.set(w),f.set(w,s),e.tangent.values=f}}if(t.st){var x=e.st.values,A=new Float32Array(6*l);A.set(x),A.set(x,l);for(var j=2*l,E=0;E<2;E++){for(A[j++]=x[0],A[j++]=x[1],n=2;n<l;n+=2){var C=x[n],P=x[n+1];A[j++]=C,A[j++]=P,A[j++]=C,A[j++]=P}A[j++]=x[0],A[j++]=x[1]}e.st.values=A}return e}(l,t);var v=f/3;if(e.shadowVolume){var g=l.normal.values;f=g.length;var _=new Float32Array(6*f);for(p=0;p<f;p++)g[p]=-g[p];_.set(g,f),_=li(g,4*f,_),l.extrudeDirection=new qa.a({componentDatatype:ue.a.FLOAT,componentsPerAttribute:3,values:_}),t.normal||(l.normal=void 0)}if(Object(s.default)(e.offsetAttribute)){var b=new Uint8Array(6*v);if(e.offsetAttribute===he.a.TOP)b=Object($e.a)(b,1,0,v),b=Object($e.a)(b,1,2*v,4*v);else{var O=e.offsetAttribute===he.a.NONE?0:1;b=Object($e.a)(b,O)}l.applyOffset=new qa.a({componentDatatype:ue.a.UNSIGNED_BYTE,componentsPerAttribute:1,values:b})}var w=u.length,x=v+v,A=Ya.a.createTypedArray(c.length/3,2*w+3*x);A.set(u);var j,E,C,P,T=w;for(p=0;p<w;p+=3){var D=u[p],I=u[p+1],S=u[p+2];A[T++]=S+v,A[T++]=I+v,A[T++]=D+v}for(p=0;p<x;p+=2)C=(j=p+x)+1,P=(E=j+x)+1,A[T++]=j,A[T++]=E,A[T++]=C,A[T++]=C,A[T++]=E,A[T++]=P;return{attributes:l,indices:A}}var di=new y.default,fi=new y.default,ci=new Ne.default;function hi(e,t,a,i,r,n){var o=y.default.subtract(t,e,di);y.default.normalize(o,o);var s=a.geodeticSurfaceNormal(e,fi),l=y.default.cross(o,s,di);y.default.multiplyByScalar(l,i,l);var u=r.latitude,d=r.longitude,f=n.latitude,c=n.longitude;y.default.add(e,l,fi),a.cartesianToCartographic(fi,ci);var h=ci.latitude,p=ci.longitude;u=Math.min(u,h),d=Math.min(d,p),f=Math.max(f,h),c=Math.max(c,p),y.default.subtract(e,l,fi),a.cartesianToCartographic(fi,ci),h=ci.latitude,p=ci.longitude,u=Math.min(u,h),d=Math.min(d,p),f=Math.max(f,h),c=Math.max(c,p),r.latitude=u,r.longitude=d,n.latitude=f,n.longitude=c}var pi=new y.default,mi=new y.default,vi=new Ne.default,gi=new Ne.default;function _i(e,t,a,i,r){e=ni(e,t);var n=Object(et.a)(e,y.default.equalsEpsilon),o=n.length;if(o<2||a<=0)return new Za.default;var l,u,d=.5*a;if(vi.latitude=Number.POSITIVE_INFINITY,vi.longitude=Number.POSITIVE_INFINITY,gi.latitude=Number.NEGATIVE_INFINITY,gi.longitude=Number.NEGATIVE_INFINITY,i===tt.a.ROUNDED){var f=n[0];y.default.subtract(f,n[1],pi),y.default.normalize(pi,pi),y.default.multiplyByScalar(pi,d,pi),y.default.add(f,pi,mi),t.cartesianToCartographic(mi,ci),l=ci.latitude,u=ci.longitude,vi.latitude=Math.min(vi.latitude,l),vi.longitude=Math.min(vi.longitude,u),gi.latitude=Math.max(gi.latitude,l),gi.longitude=Math.max(gi.longitude,u)}for(var c=0;c<o-1;++c)hi(n[c],n[c+1],t,d,vi,gi);var h=n[o-1];y.default.subtract(h,n[o-2],pi),y.default.normalize(pi,pi),y.default.multiplyByScalar(pi,d,pi),y.default.add(h,pi,mi),hi(h,mi,t,d,vi,gi),i===tt.a.ROUNDED&&(t.cartesianToCartographic(mi,ci),l=ci.latitude,u=ci.longitude,vi.latitude=Math.min(vi.latitude,l),vi.longitude=Math.min(vi.longitude,u),gi.latitude=Math.max(gi.latitude,l),gi.longitude=Math.max(gi.longitude,u));var p=Object(s.default)(r)?r:new Za.default;return p.north=gi.latitude,p.south=vi.latitude,p.east=gi.longitude,p.west=vi.longitude,p}function yi(e){var t=(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).positions,a=e.width,i=Object(o.default)(e.height,0),r=Object(o.default)(e.extrudedHeight,i);this._positions=t,this._ellipsoid=it.default.clone(Object(o.default)(e.ellipsoid,it.default.WGS84)),this._vertexFormat=$.default.clone(Object(o.default)(e.vertexFormat,$.default.DEFAULT)),this._width=a,this._height=Math.max(i,r),this._extrudedHeight=Math.min(i,r),this._cornerType=Object(o.default)(e.cornerType,tt.a.ROUNDED),this._granularity=Object(o.default)(e.granularity,Fe.default.RADIANS_PER_DEGREE),this._shadowVolume=Object(o.default)(e.shadowVolume,!1),this._workerName="createCorridorGeometry",this._offsetAttribute=e.offsetAttribute,this._rectangle=void 0,this.packedLength=1+t.length*y.default.packedLength+it.default.packedLength+$.default.packedLength+7}yi.pack=function(e,t,a){a=Object(o.default)(a,0);var i=e._positions,r=i.length;t[a++]=r;for(var n=0;n<r;++n,a+=y.default.packedLength)y.default.pack(i[n],t,a);return it.default.pack(e._ellipsoid,t,a),a+=it.default.packedLength,$.default.pack(e._vertexFormat,t,a),a+=$.default.packedLength,t[a++]=e._width,t[a++]=e._height,t[a++]=e._extrudedHeight,t[a++]=e._cornerType,t[a++]=e._granularity,t[a++]=e._shadowVolume?1:0,t[a]=Object(o.default)(e._offsetAttribute,-1),t};var bi=it.default.clone(it.default.UNIT_SPHERE),Oi=new $.default,wi={positions:void 0,ellipsoid:bi,vertexFormat:Oi,width:void 0,height:void 0,extrudedHeight:void 0,cornerType:void 0,granularity:void 0,shadowVolume:void 0,offsetAttribute:void 0};yi.unpack=function(e,t,a){t=Object(o.default)(t,0);for(var i=e[t++],r=new Array(i),n=0;n<i;++n,t+=y.default.packedLength)r[n]=y.default.unpack(e,t);var l=it.default.unpack(e,t,bi);t+=it.default.packedLength;var u=$.default.unpack(e,t,Oi);t+=$.default.packedLength;var d=e[t++],f=e[t++],c=e[t++],h=e[t++],p=e[t++],m=1===e[t++],v=e[t];return Object(s.default)(a)?(a._positions=r,a._ellipsoid=it.default.clone(l,a._ellipsoid),a._vertexFormat=$.default.clone(u,a._vertexFormat),a._width=d,a._height=f,a._extrudedHeight=c,a._cornerType=h,a._granularity=p,a._shadowVolume=m,a._offsetAttribute=-1===v?void 0:v,a):(wi.positions=r,wi.width=d,wi.height=f,wi.extrudedHeight=c,wi.cornerType=h,wi.granularity=p,wi.shadowVolume=m,wi.offsetAttribute=-1===v?void 0:v,new yi(wi))},yi.computeRectangle=function(e,t){var a=(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).positions,i=e.width;return _i(a,Object(o.default)(e.ellipsoid,it.default.WGS84),i,Object(o.default)(e.cornerType,tt.a.ROUNDED),t)},yi.createGeometry=function(e){var t=e._positions,a=e._width,i=e._ellipsoid;t=ni(t,i);var n=Object(et.a)(t,y.default.equalsEpsilon);if(!(n.length<2||a<=0)){var o,l=e._height,u=e._extrudedHeight,d=!Fe.default.equalsEpsilon(l,u,0,Fe.default.EPSILON2),f=e._vertexFormat,c={ellipsoid:i,positions:n,width:a,cornerType:e._cornerType,granularity:e._granularity,saveAttributes:!0};if(d)c.height=l,c.extrudedHeight=u,c.shadowVolume=e._shadowVolume,c.offsetAttribute=e._offsetAttribute,o=ui(c,f);else if((o=si(za.computePositions(c),f,i)).attributes.position.values=Ka.a.scaleToGeodeticHeight(o.attributes.position.values,l,i),Object(s.default)(e._offsetAttribute)){var h=e._offsetAttribute===he.a.NONE?0:1,p=o.attributes.position.values.length,m=new Uint8Array(p/3);Object($e.a)(m,h),o.attributes.applyOffset=new qa.a({componentDatatype:ue.a.UNSIGNED_BYTE,componentsPerAttribute:1,values:m})}var v=o.attributes,g=r.default.fromVertices(v.position.values,void 0,3);return f.position||(o.attributes.position.values=void 0),new Ga.a({attributes:v,indices:o.indices,primitiveType:Xa.a.TRIANGLES,boundingSphere:g,offsetAttribute:e._offsetAttribute})}},yi.createShadowVolume=function(e,t,a){var i=e._granularity,r=e._ellipsoid,n=t(i,r),o=a(i,r);return new yi({positions:e._positions,width:e._width,cornerType:e._cornerType,ellipsoid:r,granularity:i,extrudedHeight:n,height:o,vertexFormat:$.default.POSITION_ONLY,shadowVolume:!0})},Object(l.default)(yi.prototype,{rectangle:{get:function(){return Object(s.default)(this._rectangle)||(this._rectangle=_i(this._positions,this._ellipsoid,this._width,this._cornerType)),this._rectangle}},textureCoordinateRotationPoints:{get:function(){return[0,0,0,1,1,0]}}});var xi=yi,Ai=new y.default,ji=new y.default,Ei=new y.default;function Ci(e,t){var a,i,r,n=[],o=e.positions,l=e.corners,u=e.endPositions,d=new Wa.a,f=0,c=0,h=0;for(i=0;i<o.length;i+=2)f+=r=o[i].length-3,h+=r/3*4,c+=o[i+1].length-3;for(f+=3,c+=3,i=0;i<l.length;i++){a=l[i];var p=l[i].leftPositions;Object(s.default)(p)?(f+=r=p.length,h+=r/3*2):(c+=r=l[i].rightPositions.length,h+=r/3*2)}var m,v=Object(s.default)(u);v&&(f+=m=u[0].length-3,c+=m,h+=4*(m/=3));var g,_,b,O,w,x,A=f+c,j=new Float64Array(A),E=0,C=A-1,P=m/2,T=Ya.a.createTypedArray(A/3,h+4),D=0;if(T[D++]=E/3,T[D++]=(C-2)/3,v){n.push(E/3),x=Ai,w=ji;var I=u[0];for(i=0;i<P;i++)x=y.default.fromArray(I,3*(P-1-i),x),w=y.default.fromArray(I,3*(P+i),w),za.addAttribute(j,w,E),za.addAttribute(j,x,void 0,C),O=(_=E/3)+1,b=(g=(C-2)/3)-1,T[D++]=g,T[D++]=b,T[D++]=_,T[D++]=O,E+=3,C-=3}var S=0,M=o[S++],R=o[S++];for(j.set(M,E),j.set(R,C-R.length+1),r=R.length-3,n.push(E/3,(C-2)/3),i=0;i<r;i+=3)O=(_=E/3)+1,b=(g=(C-2)/3)-1,T[D++]=g,T[D++]=b,T[D++]=_,T[D++]=O,E+=3,C-=3;for(i=0;i<l.length;i++){var L,V,N=(a=l[i]).leftPositions,F=a.rightPositions,B=Ei;if(Object(s.default)(N)){for(C-=3,V=b,n.push(O),L=0;L<N.length/3;L++)B=y.default.fromArray(N,3*L,B),T[D++]=V-L-1,T[D++]=V-L,za.addAttribute(j,B,void 0,C),C-=3;n.push(V-Math.floor(N.length/6)),t===tt.a.BEVELED&&n.push((C-2)/3+1),E+=3}else{for(E+=3,V=O,n.push(b),L=0;L<F.length/3;L++)B=y.default.fromArray(F,3*L,B),T[D++]=V+L,T[D++]=V+L+1,za.addAttribute(j,B,E),E+=3;n.push(V+Math.floor(F.length/6)),t===tt.a.BEVELED&&n.push(E/3-1),C-=3}for(M=o[S++],R=o[S++],M.splice(0,3),R.splice(R.length-3,3),j.set(M,E),j.set(R,C-R.length+1),r=R.length-3,L=0;L<R.length;L+=3)_=(O=E/3)-1,g=(b=(C-2)/3)+1,T[D++]=g,T[D++]=b,T[D++]=_,T[D++]=O,E+=3,C-=3;E-=3,C+=3,n.push(E/3,(C-2)/3)}if(v){E+=3,C-=3,x=Ai,w=ji;var U=u[1];for(i=0;i<P;i++)x=y.default.fromArray(U,3*(m-i-1),x),w=y.default.fromArray(U,3*i,w),za.addAttribute(j,x,void 0,C),za.addAttribute(j,w,E),_=(O=E/3)-1,g=(b=(C-2)/3)+1,T[D++]=g,T[D++]=b,T[D++]=_,T[D++]=O,E+=3,C-=3;n.push(E/3)}else n.push(E/3,(C-2)/3);return T[D++]=E/3,T[D++]=(C-2)/3,d.position=new qa.a({componentDatatype:ue.a.DOUBLE,componentsPerAttribute:3,values:j}),{attributes:d,indices:T,wallIndices:n}}function Pi(e){var t=(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).positions,a=e.width,i=Object(o.default)(e.height,0),r=Object(o.default)(e.extrudedHeight,i);this._positions=t,this._ellipsoid=it.default.clone(Object(o.default)(e.ellipsoid,it.default.WGS84)),this._width=a,this._height=Math.max(i,r),this._extrudedHeight=Math.min(i,r),this._cornerType=Object(o.default)(e.cornerType,tt.a.ROUNDED),this._granularity=Object(o.default)(e.granularity,Fe.default.RADIANS_PER_DEGREE),this._offsetAttribute=e.offsetAttribute,this._workerName="createCorridorOutlineGeometry",this.packedLength=1+t.length*y.default.packedLength+it.default.packedLength+6}Pi.pack=function(e,t,a){a=Object(o.default)(a,0);var i=e._positions,r=i.length;t[a++]=r;for(var n=0;n<r;++n,a+=y.default.packedLength)y.default.pack(i[n],t,a);return it.default.pack(e._ellipsoid,t,a),a+=it.default.packedLength,t[a++]=e._width,t[a++]=e._height,t[a++]=e._extrudedHeight,t[a++]=e._cornerType,t[a++]=e._granularity,t[a]=Object(o.default)(e._offsetAttribute,-1),t};var Ti=it.default.clone(it.default.UNIT_SPHERE),Di={positions:void 0,ellipsoid:Ti,width:void 0,height:void 0,extrudedHeight:void 0,cornerType:void 0,granularity:void 0,offsetAttribute:void 0};Pi.unpack=function(e,t,a){t=Object(o.default)(t,0);for(var i=e[t++],r=new Array(i),n=0;n<i;++n,t+=y.default.packedLength)r[n]=y.default.unpack(e,t);var l=it.default.unpack(e,t,Ti);t+=it.default.packedLength;var u=e[t++],d=e[t++],f=e[t++],c=e[t++],h=e[t++],p=e[t];return Object(s.default)(a)?(a._positions=r,a._ellipsoid=it.default.clone(l,a._ellipsoid),a._width=u,a._height=d,a._extrudedHeight=f,a._cornerType=c,a._granularity=h,a._offsetAttribute=-1===p?void 0:p,a):(Di.positions=r,Di.width=u,Di.height=d,Di.extrudedHeight=f,Di.cornerType=c,Di.granularity=h,Di.offsetAttribute=-1===p?void 0:p,new Pi(Di))},Pi.createGeometry=function(e){var t=e._positions,a=e._width,i=e._ellipsoid;t=function(e,t){for(var a=0;a<e.length;a++)e[a]=t.scaleToGeodeticSurface(e[a],e[a]);return e}(t,i);var n=Object(et.a)(t,y.default.equalsEpsilon);if(!(n.length<2||a<=0)){var o,l=e._height,u=e._extrudedHeight,d=!Fe.default.equalsEpsilon(l,u,0,Fe.default.EPSILON2),f={ellipsoid:i,positions:n,width:a,cornerType:e._cornerType,granularity:e._granularity,saveAttributes:!1};if(d)f.height=l,f.extrudedHeight=u,f.offsetAttribute=e._offsetAttribute,o=function(e){var t=e.ellipsoid,a=Ci(za.computePositions(e),e.cornerType),i=a.wallIndices,r=e.height,n=e.extrudedHeight,o=a.attributes,l=a.indices,u=o.position.values,d=u.length,f=new Float64Array(d);f.set(u);var c,h=new Float64Array(2*d);if(u=Ka.a.scaleToGeodeticHeight(u,r,t),f=Ka.a.scaleToGeodeticHeight(f,n,t),h.set(u),h.set(f,d),o.position.values=h,d/=3,Object(s.default)(e.offsetAttribute)){var p=new Uint8Array(2*d);if(e.offsetAttribute===he.a.TOP)p=Object($e.a)(p,1,0,d);else{var m=e.offsetAttribute===he.a.NONE?0:1;p=Object($e.a)(p,m)}o.applyOffset=new qa.a({componentDatatype:ue.a.UNSIGNED_BYTE,componentsPerAttribute:1,values:p})}var v=l.length,g=Ya.a.createTypedArray(h.length/3,2*(v+i.length));g.set(l);var _,y,b=v;for(c=0;c<v;c+=2){var O=l[c],w=l[c+1];g[b++]=O+d,g[b++]=w+d}for(c=0;c<i.length;c++)y=(_=i[c])+d,g[b++]=_,g[b++]=y;return{attributes:o,indices:g}}(f);else if((o=Ci(za.computePositions(f),f.cornerType)).attributes.position.values=Ka.a.scaleToGeodeticHeight(o.attributes.position.values,l,i),Object(s.default)(e._offsetAttribute)){var c=o.attributes.position.values.length,h=new Uint8Array(c/3),p=e._offsetAttribute===he.a.NONE?0:1;Object($e.a)(h,p),o.attributes.applyOffset=new qa.a({componentDatatype:ue.a.UNSIGNED_BYTE,componentsPerAttribute:1,values:h})}var m=o.attributes,v=r.default.fromVertices(m.position.values,void 0,3);return new Ga.a({attributes:m,indices:o.indices,primitiveType:Xa.a.LINES,boundingSphere:v,offsetAttribute:e._offsetAttribute})}};var Ii=Pi,Si=new Ae.a(0);function Mi(e){Le.call(this,e),this._zIndex=0,this._terrainOffsetProperty=void 0}Object(s.default)(Object.create)&&(Mi.prototype=Object.create(Le.prototype),Mi.prototype.constructor=Mi),Object(l.default)(Mi.prototype,{zIndex:{get:function(){return this._zIndex}},terrainOffsetProperty:{get:function(){return this._terrainOffsetProperty}}}),Mi.prototype._isOnTerrain=function(e,t){return this._fillEnabled&&!Object(s.default)(t.height)&&!Object(s.default)(t.extrudedHeight)&&c.a.isSupported(this._scene)},Mi.prototype._getIsClosed=function(e){var t=e.height,a=e.extrudedHeight;return 0===t||Object(s.default)(a)&&a!==t},Mi.prototype._computeCenter=O.default.throwInstantiationError,Mi.prototype._onEntityPropertyChanged=function(e,t,a,i){if(Le.prototype._onEntityPropertyChanged.call(this,e,t,a,i),-1!==this._observedPropertyNames.indexOf(t)){var r=this._entity[this._geometryPropertyName];if(Object(s.default)(r)){Object(s.default)(r.zIndex)&&(Object(s.default)(r.height)||Object(s.default)(r.extrudedHeight))&&Object(xe.a)(xe.a.geometryZIndex),this._zIndex=Object(o.default)(r.zIndex,Si),Object(s.default)(this._terrainOffsetProperty)&&(this._terrainOffsetProperty.destroy(),this._terrainOffsetProperty=void 0);var n=r.heightReference,l=r.extrudedHeightReference;if(Object(s.default)(n)||Object(s.default)(l)){var u=new Ve.default(this._computeCenter.bind(this),!this._dynamic);this._terrainOffsetProperty=new ze(this._scene,u,n,l)}}}},Mi.prototype.destroy=function(){Object(s.default)(this._terrainOffsetProperty)&&(this._terrainOffsetProperty.destroy(),this._terrainOffsetProperty=void 0),Le.prototype.destroy.call(this)},Mi.getGeometryHeight=function(e,t){if(Object(s.default)(e))return t!==A.default.CLAMP_TO_GROUND?e:0;t!==A.default.NONE&&Object(xe.a)(xe.a.geometryHeightReference)},Mi.getGeometryExtrudedHeight=function(e,t){if(Object(s.default)(e))return t!==A.default.CLAMP_TO_GROUND?e:Mi.CLAMP_TO_GROUND;t!==A.default.NONE&&Object(xe.a)(xe.a.geometryExtrudedHeightReference)},Mi.CLAMP_TO_GROUND="clamp",Mi.computeGeometryOffsetAttribute=function(e,t,a,i){Object(s.default)(e)&&Object(s.default)(t)||(t=A.default.NONE),Object(s.default)(a)&&Object(s.default)(i)||(i=A.default.NONE);var r=0;return t!==A.default.NONE&&r++,i===A.default.RELATIVE_TO_GROUND&&r++,2===r?he.a.ALL:1===r?he.a.TOP:void 0};var Ri=Mi,Li=new b.default,Vi=y.default.ZERO,Ni=new y.default,Fi=new Za.default;function Bi(e){this.id=e,this.vertexFormat=void 0,this.positions=void 0,this.width=void 0,this.cornerType=void 0,this.height=void 0,this.extrudedHeight=void 0,this.granularity=void 0,this.offsetAttribute=void 0}function Ui(e,t){Ri.call(this,{entity:e,scene:t,geometryOptions:new Bi(e),geometryPropertyName:"corridor",observedPropertyNames:["availability","corridor"]}),this._onEntityPropertyChanged(e,"corridor",e.corridor,void 0)}function Hi(e,t,a){we.call(this,e,t,a)}Object(s.default)(Object.create)&&(Ui.prototype=Object.create(Ri.prototype),Ui.prototype.constructor=Ui),Ui.prototype.createFillGeometryInstance=function(e){var t,a=this._entity,i=a.isAvailable(e),r={show:new ve.a(i&&a.isShowing&&this._showProperty.getValue(e)&&this._fillProperty.getValue(e)),distanceDisplayCondition:fe.fromDistanceDisplayCondition(this._distanceDisplayConditionProperty.getValue(e)),offset:void 0,color:void 0};this._materialProperty instanceof ge.default&&(Object(s.default)(this._materialProperty.color)&&(this._materialProperty.color.isConstant||i)&&(t=this._materialProperty.color.getValue(e,Li)),Object(s.default)(t)||(t=b.default.WHITE),r.color=le.a.fromColor(t));return Object(s.default)(this._options.offsetAttribute)&&(r.offset=me.a.fromCartesian3(P.default.getValueOrDefault(this._terrainOffsetProperty,e,Vi,Ni))),new ce.a({id:a,geometry:new xi(this._options),attributes:r})},Ui.prototype.createOutlineGeometryInstance=function(e){var t=this._entity,a=t.isAvailable(e),i=P.default.getValueOrDefault(this._outlineColorProperty,e,b.default.BLACK,Li),r={show:new ve.a(a&&t.isShowing&&this._showProperty.getValue(e)&&this._showOutlineProperty.getValue(e)),color:le.a.fromColor(i),distanceDisplayCondition:fe.fromDistanceDisplayCondition(this._distanceDisplayConditionProperty.getValue(e)),offset:void 0};return Object(s.default)(this._options.offsetAttribute)&&(r.offset=me.a.fromCartesian3(P.default.getValueOrDefault(this._terrainOffsetProperty,e,Vi,Ni))),new ce.a({id:t,geometry:new Ii(this._options),attributes:r})},Ui.prototype._computeCenter=function(e,t){var a=P.default.getValueOrUndefined(this._entity.corridor.positions,e);if(Object(s.default)(a)&&0!==a.length)return y.default.clone(a[Math.floor(a.length/2)],t)},Ui.prototype._isHidden=function(e,t){return!Object(s.default)(t.positions)||!Object(s.default)(t.width)||Le.prototype._isHidden.call(this,e,t)},Ui.prototype._isDynamic=function(e,t){return!t.positions.isConstant||!P.default.isConstant(t.height)||!P.default.isConstant(t.extrudedHeight)||!P.default.isConstant(t.granularity)||!P.default.isConstant(t.width)||!P.default.isConstant(t.outlineWidth)||!P.default.isConstant(t.cornerType)||!P.default.isConstant(t.zIndex)||this._onTerrain&&!P.default.isConstant(this._materialProperty)},Ui.prototype._setStaticOptions=function(e,t){var a=P.default.getValueOrUndefined(t.height,pe.default.MINIMUM_VALUE),r=P.default.getValueOrDefault(t.heightReference,pe.default.MINIMUM_VALUE,A.default.NONE),n=P.default.getValueOrUndefined(t.extrudedHeight,pe.default.MINIMUM_VALUE),o=P.default.getValueOrDefault(t.extrudedHeightReference,pe.default.MINIMUM_VALUE,A.default.NONE);Object(s.default)(n)&&!Object(s.default)(a)&&(a=0);var l=this._options;l.vertexFormat=this._materialProperty instanceof ge.default?re.a.VERTEX_FORMAT:ie.MaterialSupport.TEXTURED.vertexFormat,l.positions=t.positions.getValue(pe.default.MINIMUM_VALUE,l.positions),l.width=t.width.getValue(pe.default.MINIMUM_VALUE),l.granularity=P.default.getValueOrUndefined(t.granularity,pe.default.MINIMUM_VALUE),l.cornerType=P.default.getValueOrUndefined(t.cornerType,pe.default.MINIMUM_VALUE),l.offsetAttribute=Ri.computeGeometryOffsetAttribute(a,r,n,o),l.height=Ri.getGeometryHeight(a,r),(n=Ri.getGeometryExtrudedHeight(n,o))===Ri.CLAMP_TO_GROUND&&(n=i.a.getMinimumMaximumHeights(xi.computeRectangle(l,Fi)).minimumTerrainHeight),l.extrudedHeight=n},Ui.DynamicGeometryUpdater=Hi,Object(s.default)(Object.create)&&(Hi.prototype=Object.create(we.prototype),Hi.prototype.constructor=Hi),Hi.prototype._isHidden=function(e,t,a){var i=this._options;return!Object(s.default)(i.positions)||!Object(s.default)(i.width)||we.prototype._isHidden.call(this,e,t,a)},Hi.prototype._setOptions=function(e,t,a){var r=this._options,n=P.default.getValueOrUndefined(t.height,a),o=P.default.getValueOrDefault(t.heightReference,a,A.default.NONE),l=P.default.getValueOrUndefined(t.extrudedHeight,a),u=P.default.getValueOrDefault(t.extrudedHeightReference,a,A.default.NONE);Object(s.default)(l)&&!Object(s.default)(n)&&(n=0),r.positions=P.default.getValueOrUndefined(t.positions,a),r.width=P.default.getValueOrUndefined(t.width,a),r.granularity=P.default.getValueOrUndefined(t.granularity,a),r.cornerType=P.default.getValueOrUndefined(t.cornerType,a),r.offsetAttribute=Ri.computeGeometryOffsetAttribute(n,o,l,u),r.height=Ri.getGeometryHeight(n,o),(l=Ri.getGeometryExtrudedHeight(l,u))===Ri.CLAMP_TO_GROUND&&(l=i.a.getMinimumMaximumHeights(xi.computeRectangle(r,Fi)).minimumTerrainHeight),r.extrudedHeight=l};var ki=Ui,zi={computePositions:function(e,t,a,i,r){var n,o=.5*e,s=-o,l=i+i,u=new Float64Array(3*(r?2*l:l)),d=0,f=0,c=r?3*l:0,h=r?3*(l+i):3*i;for(n=0;n<i;n++){var p=n/i*Fe.default.TWO_PI,m=Math.cos(p),v=Math.sin(p),g=m*a,_=v*a,y=m*t,b=v*t;u[f+c]=g,u[f+c+1]=_,u[f+c+2]=s,u[f+h]=y,u[f+h+1]=b,u[f+h+2]=o,f+=3,r&&(u[d++]=g,u[d++]=_,u[d++]=s,u[d++]=y,u[d++]=b,u[d++]=o)}return u}},Gi=zi,qi=new _.default,Wi=new y.default,Yi=new y.default,Ki=new y.default,Xi=new y.default;function Zi(e){var t=(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).length,a=e.topRadius,i=e.bottomRadius,r=Object(o.default)(e.vertexFormat,$.default.DEFAULT),n=Object(o.default)(e.slices,128);this._length=t,this._topRadius=a,this._bottomRadius=i,this._vertexFormat=$.default.clone(r),this._slices=n,this._offsetAttribute=e.offsetAttribute,this._workerName="createCylinderGeometry"}Zi.packedLength=$.default.packedLength+5,Zi.pack=function(e,t,a){return a=Object(o.default)(a,0),$.default.pack(e._vertexFormat,t,a),a+=$.default.packedLength,t[a++]=e._length,t[a++]=e._topRadius,t[a++]=e._bottomRadius,t[a++]=e._slices,t[a]=Object(o.default)(e._offsetAttribute,-1),t};var Ji,Qi=new $.default,$i={vertexFormat:Qi,length:void 0,topRadius:void 0,bottomRadius:void 0,slices:void 0,offsetAttribute:void 0};Zi.unpack=function(e,t,a){t=Object(o.default)(t,0);var i=$.default.unpack(e,t,Qi);t+=$.default.packedLength;var r=e[t++],n=e[t++],l=e[t++],u=e[t++],d=e[t];return Object(s.default)(a)?(a._vertexFormat=$.default.clone(i,a._vertexFormat),a._length=r,a._topRadius=n,a._bottomRadius=l,a._slices=u,a._offsetAttribute=-1===d?void 0:d,a):($i.length=r,$i.topRadius=n,$i.bottomRadius=l,$i.slices=u,$i.offsetAttribute=-1===d?void 0:d,new Zi($i))},Zi.createGeometry=function(e){var t=e._length,a=e._topRadius,i=e._bottomRadius,n=e._vertexFormat,o=e._slices;if(!(t<=0||a<0||i<0||0===a&&0===i)){var l,u=o+o,d=o+u,f=u+u,c=Gi.computePositions(t,a,i,o,!0),h=n.st?new Float32Array(2*f):void 0,p=n.normal?new Float32Array(3*f):void 0,m=n.tangent?new Float32Array(3*f):void 0,v=n.bitangent?new Float32Array(3*f):void 0,g=n.normal||n.tangent||n.bitangent;if(g){var b=n.tangent||n.bitangent,O=0,w=0,x=0,A=Math.atan2(i-a,t),j=Wi;j.z=Math.sin(A);var E=Math.cos(A),C=Ki,P=Yi;for(l=0;l<o;l++){var T=l/o*Fe.default.TWO_PI,D=E*Math.cos(T),I=E*Math.sin(T);g&&(j.x=D,j.y=I,b&&(C=y.default.normalize(y.default.cross(y.default.UNIT_Z,j,C),C)),n.normal&&(p[O++]=j.x,p[O++]=j.y,p[O++]=j.z,p[O++]=j.x,p[O++]=j.y,p[O++]=j.z),n.tangent&&(m[w++]=C.x,m[w++]=C.y,m[w++]=C.z,m[w++]=C.x,m[w++]=C.y,m[w++]=C.z),n.bitangent&&(P=y.default.normalize(y.default.cross(j,C,P),P),v[x++]=P.x,v[x++]=P.y,v[x++]=P.z,v[x++]=P.x,v[x++]=P.y,v[x++]=P.z))}for(l=0;l<o;l++)n.normal&&(p[O++]=0,p[O++]=0,p[O++]=-1),n.tangent&&(m[w++]=1,m[w++]=0,m[w++]=0),n.bitangent&&(v[x++]=0,v[x++]=-1,v[x++]=0);for(l=0;l<o;l++)n.normal&&(p[O++]=0,p[O++]=0,p[O++]=1),n.tangent&&(m[w++]=1,m[w++]=0,m[w++]=0),n.bitangent&&(v[x++]=0,v[x++]=1,v[x++]=0)}var S=12*o-12,M=Ya.a.createTypedArray(f,S),R=0,L=0;for(l=0;l<o-1;l++)M[R++]=L,M[R++]=L+2,M[R++]=L+3,M[R++]=L,M[R++]=L+3,M[R++]=L+1,L+=2;for(M[R++]=u-2,M[R++]=0,M[R++]=1,M[R++]=u-2,M[R++]=1,M[R++]=u-1,l=1;l<o-1;l++)M[R++]=u+l+1,M[R++]=u+l,M[R++]=u;for(l=1;l<o-1;l++)M[R++]=d,M[R++]=d+l,M[R++]=d+l+1;var V=0;if(n.st){var N=Math.max(a,i);for(l=0;l<f;l++){var F=y.default.fromArray(c,3*l,Xi);h[V++]=(F.x+N)/(2*N),h[V++]=(F.y+N)/(2*N)}}var B=new Wa.a;n.position&&(B.position=new qa.a({componentDatatype:ue.a.DOUBLE,componentsPerAttribute:3,values:c})),n.normal&&(B.normal=new qa.a({componentDatatype:ue.a.FLOAT,componentsPerAttribute:3,values:p})),n.tangent&&(B.tangent=new qa.a({componentDatatype:ue.a.FLOAT,componentsPerAttribute:3,values:m})),n.bitangent&&(B.bitangent=new qa.a({componentDatatype:ue.a.FLOAT,componentsPerAttribute:3,values:v})),n.st&&(B.st=new qa.a({componentDatatype:ue.a.FLOAT,componentsPerAttribute:2,values:h})),qi.x=.5*t,qi.y=Math.max(i,a);var U=new r.default(y.default.ZERO,_.default.magnitude(qi));if(Object(s.default)(e._offsetAttribute)){t=c.length;var H=new Uint8Array(t/3),k=e._offsetAttribute===he.a.NONE?0:1;Object($e.a)(H,k),B.applyOffset=new qa.a({componentDatatype:ue.a.UNSIGNED_BYTE,componentsPerAttribute:1,values:H})}return new Ga.a({attributes:B,indices:M,primitiveType:Xa.a.TRIANGLES,boundingSphere:U,offsetAttribute:e._offsetAttribute})}},Zi.getUnitCylinder=function(){return Object(s.default)(Ji)||(Ji=Zi.createGeometry(new Zi({topRadius:1,bottomRadius:1,length:1,vertexFormat:$.default.POSITION_ONLY}))),Ji};var er=Zi,tr=new _.default;function ar(e){var t=(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).length,a=e.topRadius,i=e.bottomRadius,r=Object(o.default)(e.slices,128),n=Math.max(Object(o.default)(e.numberOfVerticalLines,16),0);this._length=t,this._topRadius=a,this._bottomRadius=i,this._slices=r,this._numberOfVerticalLines=n,this._offsetAttribute=e.offsetAttribute,this._workerName="createCylinderOutlineGeometry"}ar.packedLength=6,ar.pack=function(e,t,a){return a=Object(o.default)(a,0),t[a++]=e._length,t[a++]=e._topRadius,t[a++]=e._bottomRadius,t[a++]=e._slices,t[a++]=e._numberOfVerticalLines,t[a]=Object(o.default)(e._offsetAttribute,-1),t};var ir={length:void 0,topRadius:void 0,bottomRadius:void 0,slices:void 0,numberOfVerticalLines:void 0,offsetAttribute:void 0};ar.unpack=function(e,t,a){t=Object(o.default)(t,0);var i=e[t++],r=e[t++],n=e[t++],l=e[t++],u=e[t++],d=e[t];return Object(s.default)(a)?(a._length=i,a._topRadius=r,a._bottomRadius=n,a._slices=l,a._numberOfVerticalLines=u,a._offsetAttribute=-1===d?void 0:d,a):(ir.length=i,ir.topRadius=r,ir.bottomRadius=n,ir.slices=l,ir.numberOfVerticalLines=u,ir.offsetAttribute=-1===d?void 0:d,new ar(ir))},ar.createGeometry=function(e){var t=e._length,a=e._topRadius,i=e._bottomRadius,n=e._slices,o=e._numberOfVerticalLines;if(!(t<=0||a<0||i<0||0===a&&0===i)){var l,u=2*n,d=Gi.computePositions(t,a,i,n,!1),f=2*n;if(o>0){var c=Math.min(o,n);l=Math.round(n/c),f+=c}var h,p=Ya.a.createTypedArray(u,2*f),m=0;for(h=0;h<n-1;h++)p[m++]=h,p[m++]=h+1,p[m++]=h+n,p[m++]=h+1+n;if(p[m++]=n-1,p[m++]=0,p[m++]=n+n-1,p[m++]=n,o>0)for(h=0;h<n;h+=l)p[m++]=h,p[m++]=h+n;var v=new Wa.a;v.position=new qa.a({componentDatatype:ue.a.DOUBLE,componentsPerAttribute:3,values:d}),tr.x=.5*t,tr.y=Math.max(i,a);var g=new r.default(y.default.ZERO,_.default.magnitude(tr));if(Object(s.default)(e._offsetAttribute)){t=d.length;var b=new Uint8Array(t/3),O=e._offsetAttribute===he.a.NONE?0:1;Object($e.a)(b,O),v.applyOffset=new qa.a({componentDatatype:ue.a.UNSIGNED_BYTE,componentsPerAttribute:1,values:b})}return new Ga.a({attributes:v,indices:p,primitiveType:Xa.a.LINES,boundingSphere:g,offsetAttribute:e._offsetAttribute})}};var rr=ar,nr=y.default.ZERO,or=new y.default,sr=new y.default,lr=new b.default;function ur(e){this.id=e,this.vertexFormat=void 0,this.length=void 0,this.topRadius=void 0,this.bottomRadius=void 0,this.slices=void 0,this.numberOfVerticalLines=void 0,this.offsetAttribute=void 0}function dr(e,t){Le.call(this,{entity:e,scene:t,geometryOptions:new ur(e),geometryPropertyName:"cylinder",observedPropertyNames:["availability","position","orientation","cylinder"]}),this._onEntityPropertyChanged(e,"cylinder",e.cylinder,void 0)}function fr(e,t,a){we.call(this,e,t,a)}Object(s.default)(Object.create)&&(dr.prototype=Object.create(Le.prototype),dr.prototype.constructor=dr),Object(l.default)(dr.prototype,{terrainOffsetProperty:{get:function(){return this._terrainOffsetProperty}}}),dr.prototype.createFillGeometryInstance=function(e){var t,a=this._entity,i=a.isAvailable(e),r=new ve.a(i&&a.isShowing&&this._showProperty.getValue(e)&&this._fillProperty.getValue(e)),n=this._distanceDisplayConditionProperty.getValue(e),o={show:r,distanceDisplayCondition:fe.fromDistanceDisplayCondition(n),color:void 0,offset:void 0};this._materialProperty instanceof ge.default&&(Object(s.default)(this._materialProperty.color)&&(this._materialProperty.color.isConstant||i)&&(t=this._materialProperty.color.getValue(e,lr)),Object(s.default)(t)||(t=b.default.WHITE),o.color=le.a.fromColor(t));return Object(s.default)(this._options.offsetAttribute)&&(o.offset=me.a.fromCartesian3(P.default.getValueOrDefault(this._terrainOffsetProperty,e,nr,or))),new ce.a({id:a,geometry:new er(this._options),modelMatrix:a.computeModelMatrixForHeightReference(e,a.cylinder.heightReference,.5*this._options.length,this._scene.mapProjection.ellipsoid),attributes:o})},dr.prototype.createOutlineGeometryInstance=function(e){var t=this._entity,a=t.isAvailable(e),i=P.default.getValueOrDefault(this._outlineColorProperty,e,b.default.BLACK,lr),r=this._distanceDisplayConditionProperty.getValue(e),n={show:new ve.a(a&&t.isShowing&&this._showProperty.getValue(e)&&this._showOutlineProperty.getValue(e)),color:le.a.fromColor(i),distanceDisplayCondition:fe.fromDistanceDisplayCondition(r),offset:void 0};return Object(s.default)(this._options.offsetAttribute)&&(n.offset=me.a.fromCartesian3(P.default.getValueOrDefault(this._terrainOffsetProperty,e,nr,or))),new ce.a({id:t,geometry:new rr(this._options),modelMatrix:t.computeModelMatrixForHeightReference(e,t.cylinder.heightReference,.5*this._options.length,this._scene.mapProjection.ellipsoid),attributes:n})},dr.prototype._computeCenter=function(e,t){return P.default.getValueOrUndefined(this._entity.position,e,t)},dr.prototype._isHidden=function(e,t){return!Object(s.default)(e.position)||!Object(s.default)(t.length)||!Object(s.default)(t.topRadius)||!Object(s.default)(t.bottomRadius)||Le.prototype._isHidden.call(this,e,t)},dr.prototype._isDynamic=function(e,t){return!(e.position.isConstant&&P.default.isConstant(e.orientation)&&t.length.isConstant&&t.topRadius.isConstant&&t.bottomRadius.isConstant&&P.default.isConstant(t.slices)&&P.default.isConstant(t.outlineWidth)&&P.default.isConstant(t.numberOfVerticalLines))},dr.prototype._setStaticOptions=function(e,t){var a=P.default.getValueOrDefault(t.heightReference,pe.default.MINIMUM_VALUE,A.default.NONE),i=this._options;i.vertexFormat=this._materialProperty instanceof ge.default?re.a.VERTEX_FORMAT:ie.MaterialSupport.TEXTURED.vertexFormat,i.length=t.length.getValue(pe.default.MINIMUM_VALUE),i.topRadius=t.topRadius.getValue(pe.default.MINIMUM_VALUE),i.bottomRadius=t.bottomRadius.getValue(pe.default.MINIMUM_VALUE),i.slices=P.default.getValueOrUndefined(t.slices,pe.default.MINIMUM_VALUE),i.numberOfVerticalLines=P.default.getValueOrUndefined(t.numberOfVerticalLines,pe.default.MINIMUM_VALUE),i.offsetAttribute=a!==A.default.NONE?he.a.ALL:void 0},dr.prototype._onEntityPropertyChanged=Ge,dr.DynamicGeometryUpdater=fr,Object(s.default)(Object.create)&&(fr.prototype=Object.create(we.prototype),fr.prototype.constructor=fr),fr.prototype._isHidden=function(e,t,a){var i=this._options,r=P.default.getValueOrUndefined(e.position,a,sr);return!Object(s.default)(r)||!Object(s.default)(i.length)||!Object(s.default)(i.topRadius)||!Object(s.default)(i.bottomRadius)||we.prototype._isHidden.call(this,e,t,a)},fr.prototype._setOptions=function(e,t,a){var i=P.default.getValueOrDefault(t.heightReference,a,A.default.NONE),r=this._options;r.length=P.default.getValueOrUndefined(t.length,a),r.topRadius=P.default.getValueOrUndefined(t.topRadius,a),r.bottomRadius=P.default.getValueOrUndefined(t.bottomRadius,a),r.slices=P.default.getValueOrUndefined(t.slices,a),r.numberOfVerticalLines=P.default.getValueOrUndefined(t.numberOfVerticalLines,a),r.offsetAttribute=i!==A.default.NONE?he.a.ALL:void 0};var cr=dr;function hr(e,t){this._primitives=e,this._orderedGroundPrimitives=t,this._dynamicUpdaters=new v.default}hr.prototype.add=function(e,t){this._dynamicUpdaters.set(t.id,t.createDynamicUpdater(this._primitives,this._orderedGroundPrimitives))},hr.prototype.remove=function(e){var t=e.id,a=this._dynamicUpdaters.get(t);Object(s.default)(a)&&(this._dynamicUpdaters.remove(t),a.destroy())},hr.prototype.update=function(e){for(var t=this._dynamicUpdaters.values,a=0,i=t.length;a<i;a++)t[a].update(e);return!0},hr.prototype.removeAllPrimitives=function(){for(var e=this._dynamicUpdaters.values,t=0,a=e.length;t<a;t++)e[t].destroy();this._dynamicUpdaters.removeAll()},hr.prototype.getBoundingSphere=function(e,t){return e=this._dynamicUpdaters.get(e.id),Object(s.default)(e)&&Object(s.default)(e.getBoundingSphere)?e.getBoundingSphere(t):C.default.FAILED};var pr=hr,mr={},vr=new y.default,gr=new y.default,_r=new Vt.default,yr=new at.default;function br(e,t,a,i,r,n,o,s,l,u){var d=e+t;y.default.multiplyByScalar(i,Math.cos(d),vr),y.default.multiplyByScalar(a,Math.sin(d),gr),y.default.add(vr,gr,vr);var f=Math.cos(e);f*=f;var c=Math.sin(e);c*=c;var h=n/Math.sqrt(o*f+r*c)/s;return Vt.default.fromAxisAngle(vr,h,_r),at.default.fromQuaternion(_r,yr),at.default.multiplyByVector(yr,l,u),y.default.normalize(u,u),y.default.multiplyByScalar(u,s,u),u}var Or=new y.default,wr=new y.default,xr=new y.default,Ar=new y.default;mr.raisePositionsToHeight=function(e,t,a){for(var i=t.ellipsoid,r=t.height,n=t.extrudedHeight,o=a?e.length/3*2:e.length/3,s=new Float64Array(3*o),l=e.length,u=a?l:0,d=0;d<l;d+=3){var f=d+1,c=d+2,h=y.default.fromArray(e,d,Or);i.scaleToGeodeticSurface(h,h);var p=y.default.clone(h,wr),m=i.geodeticSurfaceNormal(h,Ar),v=y.default.multiplyByScalar(m,r,xr);y.default.add(h,v,h),a&&(y.default.multiplyByScalar(m,n,v),y.default.add(p,v,p),s[d+u]=p.x,s[f+u]=p.y,s[c+u]=p.z),s[d]=h.x,s[f]=h.y,s[c]=h.z}return s};var jr=new y.default,Er=new y.default,Cr=new y.default;mr.computeEllipsePositions=function(e,t,a){var i=e.semiMinorAxis,r=e.semiMajorAxis,n=e.rotation,o=e.center,s=8*e.granularity,l=i*i,u=r*r,d=r*i,f=y.default.magnitude(o),c=y.default.normalize(o,jr),h=y.default.cross(y.default.UNIT_Z,o,Er);h=y.default.normalize(h,h);var p=y.default.cross(c,h,Cr),m=1+Math.ceil(Fe.default.PI_OVER_TWO/s),v=Fe.default.PI_OVER_TWO/(m-1),g=Fe.default.PI_OVER_TWO-m*v;g<0&&(m-=Math.ceil(Math.abs(g)/v));var _,b,O,w,x,A=t?new Array(3*(m*(m+2)*2)):void 0,j=0,E=Or,C=wr,P=4*m*3,T=P-1,D=0,I=a?new Array(P):void 0;for(E=br(g=Fe.default.PI_OVER_TWO,n,p,h,l,d,u,f,c,E),t&&(A[j++]=E.x,A[j++]=E.y,A[j++]=E.z),a&&(I[T--]=E.z,I[T--]=E.y,I[T--]=E.x),g=Fe.default.PI_OVER_TWO-v,_=1;_<m+1;++_){if(E=br(g,n,p,h,l,d,u,f,c,E),C=br(Math.PI-g,n,p,h,l,d,u,f,c,C),t){for(A[j++]=E.x,A[j++]=E.y,A[j++]=E.z,O=2*_+2,b=1;b<O-1;++b)w=b/(O-1),x=y.default.lerp(E,C,w,xr),A[j++]=x.x,A[j++]=x.y,A[j++]=x.z;A[j++]=C.x,A[j++]=C.y,A[j++]=C.z}a&&(I[T--]=E.z,I[T--]=E.y,I[T--]=E.x,I[D++]=C.x,I[D++]=C.y,I[D++]=C.z),g=Fe.default.PI_OVER_TWO-(_+1)*v}for(_=m;_>1;--_){if(E=br(-(g=Fe.default.PI_OVER_TWO-(_-1)*v),n,p,h,l,d,u,f,c,E),C=br(g+Math.PI,n,p,h,l,d,u,f,c,C),t){for(A[j++]=E.x,A[j++]=E.y,A[j++]=E.z,O=2*(_-1)+2,b=1;b<O-1;++b)w=b/(O-1),x=y.default.lerp(E,C,w,xr),A[j++]=x.x,A[j++]=x.y,A[j++]=x.z;A[j++]=C.x,A[j++]=C.y,A[j++]=C.z}a&&(I[T--]=E.z,I[T--]=E.y,I[T--]=E.x,I[D++]=C.x,I[D++]=C.y,I[D++]=C.z)}E=br(-(g=Fe.default.PI_OVER_TWO),n,p,h,l,d,u,f,c,E);var S={};return t&&(A[j++]=E.x,A[j++]=E.y,A[j++]=E.z,S.positions=A,S.numPts=m),a&&(I[T--]=E.z,I[T--]=E.y,I[T--]=E.x,S.outerPositions=I),S};var Pr=mr,Tr=a(95),Dr=a(104),Ir=new y.default,Sr=new y.default,Mr=new y.default,Rr=new y.default,Lr=new _.default,Vr=new at.default,Nr=new at.default,Fr=new Vt.default,Br=new y.default,Ur=new y.default,Hr=new y.default,kr=new Ne.default,zr=new y.default,Gr=new _.default,qr=new _.default;function Wr(e,t,a){var i=t.vertexFormat,r=t.center,n=t.semiMajorAxis,o=t.semiMinorAxis,l=t.ellipsoid,u=t.stRotation,d=a?e.length/3*2:e.length/3,f=t.shadowVolume,c=i.st?new Float32Array(2*d):void 0,h=i.normal?new Float32Array(3*d):void 0,p=i.tangent?new Float32Array(3*d):void 0,m=i.bitangent?new Float32Array(3*d):void 0,v=f?new Float32Array(3*d):void 0,g=0,b=Br,O=Ur,w=Hr,x=new Tr.a(l),A=x.project(l.cartesianToCartographic(r,kr),zr),j=l.scaleToGeodeticSurface(r,Ir);l.geodeticSurfaceNormal(j,j);var E=Vr,C=Nr;if(0!==u){var P=Vt.default.fromAxisAngle(j,u,Fr);E=at.default.fromQuaternion(P,E),P=Vt.default.fromAxisAngle(j,-u,Fr),C=at.default.fromQuaternion(P,C)}else E=at.default.clone(at.default.IDENTITY,E),C=at.default.clone(at.default.IDENTITY,C);for(var T=_.default.fromElements(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Gr),D=_.default.fromElements(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,qr),I=e.length,S=a?I:0,M=S/3*2,R=0;R<I;R+=3){var L=R+1,V=R+2,N=y.default.fromArray(e,R,Ir);if(i.st){var F=at.default.multiplyByVector(E,N,Sr),B=x.project(l.cartesianToCartographic(F,kr),Mr);y.default.subtract(B,A,B),Lr.x=(B.x+n)/(2*n),Lr.y=(B.y+o)/(2*o),T.x=Math.min(Lr.x,T.x),T.y=Math.min(Lr.y,T.y),D.x=Math.max(Lr.x,D.x),D.y=Math.max(Lr.y,D.y),a&&(c[g+M]=Lr.x,c[g+1+M]=Lr.y),c[g++]=Lr.x,c[g++]=Lr.y}(i.normal||i.tangent||i.bitangent||f)&&(b=l.geodeticSurfaceNormal(N,b),f&&(v[R+S]=-b.x,v[L+S]=-b.y,v[V+S]=-b.z),(i.normal||i.tangent||i.bitangent)&&((i.tangent||i.bitangent)&&(O=y.default.normalize(y.default.cross(y.default.UNIT_Z,b,O),O),at.default.multiplyByVector(C,O,O)),i.normal&&(h[R]=b.x,h[L]=b.y,h[V]=b.z,a&&(h[R+S]=-b.x,h[L+S]=-b.y,h[V+S]=-b.z)),i.tangent&&(p[R]=O.x,p[L]=O.y,p[V]=O.z,a&&(p[R+S]=-O.x,p[L+S]=-O.y,p[V+S]=-O.z)),i.bitangent&&(w=y.default.normalize(y.default.cross(b,O,w),w),m[R]=w.x,m[L]=w.y,m[V]=w.z,a&&(m[R+S]=w.x,m[L+S]=w.y,m[V+S]=w.z))))}if(i.st){I=c.length;for(var U=0;U<I;U+=2)c[U]=(c[U]-T.x)/(D.x-T.x),c[U+1]=(c[U+1]-T.y)/(D.y-T.y)}var H=new Wa.a;if(i.position){var k=Pr.raisePositionsToHeight(e,t,a);H.position=new qa.a({componentDatatype:ue.a.DOUBLE,componentsPerAttribute:3,values:k})}if(i.st&&(H.st=new qa.a({componentDatatype:ue.a.FLOAT,componentsPerAttribute:2,values:c})),i.normal&&(H.normal=new qa.a({componentDatatype:ue.a.FLOAT,componentsPerAttribute:3,values:h})),i.tangent&&(H.tangent=new qa.a({componentDatatype:ue.a.FLOAT,componentsPerAttribute:3,values:p})),i.bitangent&&(H.bitangent=new qa.a({componentDatatype:ue.a.FLOAT,componentsPerAttribute:3,values:m})),f&&(H.extrudeDirection=new qa.a({componentDatatype:ue.a.FLOAT,componentsPerAttribute:3,values:v})),a&&Object(s.default)(t.offsetAttribute)){var z=new Uint8Array(d);if(t.offsetAttribute===he.a.TOP)z=Object($e.a)(z,1,0,d/2);else{var G=t.offsetAttribute===he.a.NONE?0:1;z=Object($e.a)(z,G)}H.applyOffset=new qa.a({componentDatatype:ue.a.UNSIGNED_BYTE,componentsPerAttribute:1,values:z})}return H}function Yr(e){var t,a,i,r,n,o=new Array(e*(e+1)*12-6),s=0;for(t=0,i=1,r=0;r<3;r++)o[s++]=i++,o[s++]=t,o[s++]=i;for(r=2;r<e+1;++r){for(i=r*(r+1)-1,t=(r-1)*r-1,o[s++]=i++,o[s++]=t,o[s++]=i,a=2*r,n=0;n<a-1;++n)o[s++]=i,o[s++]=t++,o[s++]=t,o[s++]=i++,o[s++]=t,o[s++]=i;o[s++]=i++,o[s++]=t,o[s++]=i}for(a=2*e,++i,++t,r=0;r<a-1;++r)o[s++]=i,o[s++]=t++,o[s++]=t,o[s++]=i++,o[s++]=t,o[s++]=i;for(o[s++]=i,o[s++]=t++,o[s++]=t,o[s++]=i++,o[s++]=t++,o[s++]=t,++t,r=e-1;r>1;--r){for(o[s++]=t++,o[s++]=t,o[s++]=i,a=2*r,n=0;n<a-1;++n)o[s++]=i,o[s++]=t++,o[s++]=t,o[s++]=i++,o[s++]=t,o[s++]=i;o[s++]=t++,o[s++]=t++,o[s++]=i++}for(r=0;r<3;r++)o[s++]=t++,o[s++]=t,o[s++]=i;return o}var Kr=new y.default;var Xr=new r.default,Zr=new r.default;function Jr(e){var t=e.center,a=e.ellipsoid,i=e.semiMajorAxis,n=y.default.multiplyByScalar(a.geodeticSurfaceNormal(t,Ir),e.height,Ir);Xr.center=y.default.add(t,n,Xr.center),Xr.radius=i,n=y.default.multiplyByScalar(a.geodeticSurfaceNormal(t,n),e.extrudedHeight,n),Zr.center=y.default.add(t,n,Zr.center),Zr.radius=i;var o=Pr.computeEllipsePositions(e,!0,!0),l=o.positions,u=o.numPts,d=o.outerPositions,f=r.default.union(Xr,Zr),c=Wr(l,e,!0),h=Yr(u),p=h.length;h.length=2*p;for(var m=l.length/3,v=0;v<p;v+=3)h[v+p]=h[v+2]+m,h[v+1+p]=h[v+1]+m,h[v+2+p]=h[v]+m;var g=Ya.a.createTypedArray(2*m/3,h),b=new Ga.a({attributes:c,indices:g,primitiveType:Xa.a.TRIANGLES}),O=function(e,t){var a=t.vertexFormat,i=t.center,r=t.semiMajorAxis,n=t.semiMinorAxis,o=t.ellipsoid,l=t.height,u=t.extrudedHeight,d=t.stRotation,f=e.length/3*2,c=new Float64Array(3*f),h=a.st?new Float32Array(2*f):void 0,p=a.normal?new Float32Array(3*f):void 0,m=a.tangent?new Float32Array(3*f):void 0,v=a.bitangent?new Float32Array(3*f):void 0,g=t.shadowVolume,b=g?new Float32Array(3*f):void 0,O=0,w=Br,x=Ur,A=Hr,j=new Tr.a(o),E=j.project(o.cartesianToCartographic(i,kr),zr),C=o.scaleToGeodeticSurface(i,Ir);o.geodeticSurfaceNormal(C,C);for(var P=Vt.default.fromAxisAngle(C,d,Fr),T=at.default.fromQuaternion(P,Vr),D=_.default.fromElements(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Gr),I=_.default.fromElements(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,qr),S=e.length,M=S/3*2,R=0;R<S;R+=3){var L,V=R+1,N=R+2,F=y.default.fromArray(e,R,Ir);if(a.st){var B=at.default.multiplyByVector(T,F,Sr),U=j.project(o.cartesianToCartographic(B,kr),Mr);y.default.subtract(U,E,U),Lr.x=(U.x+r)/(2*r),Lr.y=(U.y+n)/(2*n),D.x=Math.min(Lr.x,D.x),D.y=Math.min(Lr.y,D.y),I.x=Math.max(Lr.x,I.x),I.y=Math.max(Lr.y,I.y),h[O+M]=Lr.x,h[O+1+M]=Lr.y,h[O++]=Lr.x,h[O++]=Lr.y}F=o.scaleToGeodeticSurface(F,F),L=y.default.clone(F,Sr),w=o.geodeticSurfaceNormal(F,w),g&&(b[R+S]=-w.x,b[V+S]=-w.y,b[N+S]=-w.z);var H=y.default.multiplyByScalar(w,l,Rr);if(F=y.default.add(F,H,F),H=y.default.multiplyByScalar(w,u,H),L=y.default.add(L,H,L),a.position&&(c[R+S]=L.x,c[V+S]=L.y,c[N+S]=L.z,c[R]=F.x,c[V]=F.y,c[N]=F.z),a.normal||a.tangent||a.bitangent){A=y.default.clone(w,A);var k=y.default.fromArray(e,(R+3)%S,Rr);y.default.subtract(k,F,k);var z=y.default.subtract(L,F,Mr);w=y.default.normalize(y.default.cross(z,k,w),w),a.normal&&(p[R]=w.x,p[V]=w.y,p[N]=w.z,p[R+S]=w.x,p[V+S]=w.y,p[N+S]=w.z),a.tangent&&(x=y.default.normalize(y.default.cross(A,w,x),x),m[R]=x.x,m[V]=x.y,m[N]=x.z,m[R+S]=x.x,m[R+1+S]=x.y,m[R+2+S]=x.z),a.bitangent&&(v[R]=A.x,v[V]=A.y,v[N]=A.z,v[R+S]=A.x,v[V+S]=A.y,v[N+S]=A.z)}}if(a.st){S=h.length;for(var G=0;G<S;G+=2)h[G]=(h[G]-D.x)/(I.x-D.x),h[G+1]=(h[G+1]-D.y)/(I.y-D.y)}var q=new Wa.a;if(a.position&&(q.position=new qa.a({componentDatatype:ue.a.DOUBLE,componentsPerAttribute:3,values:c})),a.st&&(q.st=new qa.a({componentDatatype:ue.a.FLOAT,componentsPerAttribute:2,values:h})),a.normal&&(q.normal=new qa.a({componentDatatype:ue.a.FLOAT,componentsPerAttribute:3,values:p})),a.tangent&&(q.tangent=new qa.a({componentDatatype:ue.a.FLOAT,componentsPerAttribute:3,values:m})),a.bitangent&&(q.bitangent=new qa.a({componentDatatype:ue.a.FLOAT,componentsPerAttribute:3,values:v})),g&&(q.extrudeDirection=new qa.a({componentDatatype:ue.a.FLOAT,componentsPerAttribute:3,values:b})),Object(s.default)(t.offsetAttribute)){var W=new Uint8Array(f);if(t.offsetAttribute===he.a.TOP)W=Object($e.a)(W,1,0,f/2);else{var Y=t.offsetAttribute===he.a.NONE?0:1;W=Object($e.a)(W,Y)}q.applyOffset=new qa.a({componentDatatype:ue.a.UNSIGNED_BYTE,componentsPerAttribute:1,values:W})}return q}(d,e);h=function(e){for(var t=e.length/3,a=Ya.a.createTypedArray(t,6*t),i=0,r=0;r<t;r++){var n=r,o=r+t,s=(n+1)%t,l=s+t;a[i++]=n,a[i++]=o,a[i++]=s,a[i++]=s,a[i++]=o,a[i++]=l}return a}(d);var w=Ya.a.createTypedArray(2*d.length/3,h),x=new Ga.a({attributes:O,indices:w,primitiveType:Xa.a.TRIANGLES}),A=Dr.a.combineInstances([new ce.a({geometry:b}),new ce.a({geometry:x})]);return{boundingSphere:f,attributes:A[0].attributes,indices:A[0].indices}}function Qr(e,t,a,i,r,n,o){for(var s=Pr.computeEllipsePositions({center:e,semiMajorAxis:t,semiMinorAxis:a,rotation:i,granularity:r},!1,!0).outerPositions,l=s.length/3,u=new Array(l),d=0;d<l;++d)u[d]=y.default.fromArray(s,3*d);var f=Za.default.fromCartesianArray(u,n,o);return f.width>Fe.default.PI&&(f.north=f.north>0?Fe.default.PI_OVER_TWO-Fe.default.EPSILON7:f.north,f.south=f.south<0?Fe.default.EPSILON7-Fe.default.PI_OVER_TWO:f.south,f.east=Fe.default.PI,f.west=-Fe.default.PI),f}function $r(e){var t=(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).center,a=Object(o.default)(e.ellipsoid,it.default.WGS84),i=e.semiMajorAxis,r=e.semiMinorAxis,n=Object(o.default)(e.granularity,Fe.default.RADIANS_PER_DEGREE),s=Object(o.default)(e.vertexFormat,$.default.DEFAULT),l=Object(o.default)(e.height,0),u=Object(o.default)(e.extrudedHeight,l);this._center=y.default.clone(t),this._semiMajorAxis=i,this._semiMinorAxis=r,this._ellipsoid=it.default.clone(a),this._rotation=Object(o.default)(e.rotation,0),this._stRotation=Object(o.default)(e.stRotation,0),this._height=Math.max(u,l),this._granularity=n,this._vertexFormat=$.default.clone(s),this._extrudedHeight=Math.min(u,l),this._shadowVolume=Object(o.default)(e.shadowVolume,!1),this._workerName="createEllipseGeometry",this._offsetAttribute=e.offsetAttribute,this._rectangle=void 0,this._textureCoordinateRotationPoints=void 0}$r.packedLength=y.default.packedLength+it.default.packedLength+$.default.packedLength+9,$r.pack=function(e,t,a){return a=Object(o.default)(a,0),y.default.pack(e._center,t,a),a+=y.default.packedLength,it.default.pack(e._ellipsoid,t,a),a+=it.default.packedLength,$.default.pack(e._vertexFormat,t,a),a+=$.default.packedLength,t[a++]=e._semiMajorAxis,t[a++]=e._semiMinorAxis,t[a++]=e._rotation,t[a++]=e._stRotation,t[a++]=e._height,t[a++]=e._granularity,t[a++]=e._extrudedHeight,t[a++]=e._shadowVolume?1:0,t[a]=Object(o.default)(e._offsetAttribute,-1),t};var en=new y.default,tn=new it.default,an=new $.default,rn={center:en,ellipsoid:tn,vertexFormat:an,semiMajorAxis:void 0,semiMinorAxis:void 0,rotation:void 0,stRotation:void 0,height:void 0,granularity:void 0,extrudedHeight:void 0,shadowVolume:void 0,offsetAttribute:void 0};$r.unpack=function(e,t,a){t=Object(o.default)(t,0);var i=y.default.unpack(e,t,en);t+=y.default.packedLength;var r=it.default.unpack(e,t,tn);t+=it.default.packedLength;var n=$.default.unpack(e,t,an);t+=$.default.packedLength;var l=e[t++],u=e[t++],d=e[t++],f=e[t++],c=e[t++],h=e[t++],p=e[t++],m=1===e[t++],v=e[t];return Object(s.default)(a)?(a._center=y.default.clone(i,a._center),a._ellipsoid=it.default.clone(r,a._ellipsoid),a._vertexFormat=$.default.clone(n,a._vertexFormat),a._semiMajorAxis=l,a._semiMinorAxis=u,a._rotation=d,a._stRotation=f,a._height=c,a._granularity=h,a._extrudedHeight=p,a._shadowVolume=m,a._offsetAttribute=-1===v?void 0:v,a):(rn.height=c,rn.extrudedHeight=p,rn.granularity=h,rn.stRotation=f,rn.rotation=d,rn.semiMajorAxis=l,rn.semiMinorAxis=u,rn.shadowVolume=m,rn.offsetAttribute=-1===v?void 0:v,new $r(rn))},$r.computeRectangle=function(e,t){var a=(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).center,i=Object(o.default)(e.ellipsoid,it.default.WGS84),r=e.semiMajorAxis,n=e.semiMinorAxis,s=Object(o.default)(e.granularity,Fe.default.RADIANS_PER_DEGREE);return Qr(a,r,n,Object(o.default)(e.rotation,0),s,i,t)},$r.createGeometry=function(e){if(!(e._semiMajorAxis<=0||e._semiMinorAxis<=0)){var t=e._height,a=e._extrudedHeight,i=!Fe.default.equalsEpsilon(t,a,0,Fe.default.EPSILON2);e._center=e._ellipsoid.scaleToGeodeticSurface(e._center,e._center);var n,o={center:e._center,semiMajorAxis:e._semiMajorAxis,semiMinorAxis:e._semiMinorAxis,ellipsoid:e._ellipsoid,rotation:e._rotation,height:t,granularity:e._granularity,vertexFormat:e._vertexFormat,stRotation:e._stRotation};if(i)o.extrudedHeight=a,o.shadowVolume=e._shadowVolume,o.offsetAttribute=e._offsetAttribute,n=Jr(o);else if(n=function(e){var t=e.center;Kr=y.default.multiplyByScalar(e.ellipsoid.geodeticSurfaceNormal(t,Kr),e.height,Kr),Kr=y.default.add(t,Kr,Kr);var a=new r.default(Kr,e.semiMajorAxis),i=Pr.computeEllipsePositions(e,!0,!1),n=i.positions,o=i.numPts,s=Wr(n,e,!1),l=Yr(o);return{boundingSphere:a,attributes:s,indices:l=Ya.a.createTypedArray(n.length/3,l)}}(o),Object(s.default)(e._offsetAttribute)){var l=n.attributes.position.values.length,u=new Uint8Array(l/3),d=e._offsetAttribute===he.a.NONE?0:1;Object($e.a)(u,d),n.attributes.applyOffset=new qa.a({componentDatatype:ue.a.UNSIGNED_BYTE,componentsPerAttribute:1,values:u})}return new Ga.a({attributes:n.attributes,indices:n.indices,primitiveType:Xa.a.TRIANGLES,boundingSphere:n.boundingSphere,offsetAttribute:e._offsetAttribute})}},$r.createShadowVolume=function(e,t,a){var i=e._granularity,r=e._ellipsoid,n=t(i,r),o=a(i,r);return new $r({center:e._center,semiMajorAxis:e._semiMajorAxis,semiMinorAxis:e._semiMinorAxis,ellipsoid:r,rotation:e._rotation,stRotation:e._stRotation,granularity:i,extrudedHeight:n,height:o,vertexFormat:$.default.POSITION_ONLY,shadowVolume:!0})},Object(l.default)($r.prototype,{rectangle:{get:function(){return Object(s.default)(this._rectangle)||(this._rectangle=Qr(this._center,this._semiMajorAxis,this._semiMinorAxis,this._rotation,this._granularity,this._ellipsoid)),this._rectangle}},textureCoordinateRotationPoints:{get:function(){return Object(s.default)(this._textureCoordinateRotationPoints)||(this._textureCoordinateRotationPoints=function(e){var t=-e._stRotation;if(0===t)return[0,0,0,1,1,0];for(var a=Pr.computeEllipsePositions({center:e._center,semiMajorAxis:e._semiMajorAxis,semiMinorAxis:e._semiMinorAxis,rotation:e._rotation,granularity:e._granularity},!1,!0).outerPositions,i=a.length/3,r=new Array(i),n=0;n<i;++n)r[n]=y.default.fromArray(a,3*n);var o=e._ellipsoid,s=e.rectangle;return Ga.a._textureCoordinateRotationPoints(r,t,o,s)}(this)),this._textureCoordinateRotationPoints}}});var nn=$r,on=new y.default,sn=new y.default;var ln=new r.default,un=new r.default;function dn(e){var t=(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).center,a=Object(o.default)(e.ellipsoid,it.default.WGS84),i=e.semiMajorAxis,r=e.semiMinorAxis,n=Object(o.default)(e.granularity,Fe.default.RADIANS_PER_DEGREE),s=Object(o.default)(e.height,0),l=Object(o.default)(e.extrudedHeight,s);this._center=y.default.clone(t),this._semiMajorAxis=i,this._semiMinorAxis=r,this._ellipsoid=it.default.clone(a),this._rotation=Object(o.default)(e.rotation,0),this._height=Math.max(l,s),this._granularity=n,this._extrudedHeight=Math.min(l,s),this._numberOfVerticalLines=Math.max(Object(o.default)(e.numberOfVerticalLines,16),0),this._offsetAttribute=e.offsetAttribute,this._workerName="createEllipseOutlineGeometry"}dn.packedLength=y.default.packedLength+it.default.packedLength+8,dn.pack=function(e,t,a){return a=Object(o.default)(a,0),y.default.pack(e._center,t,a),a+=y.default.packedLength,it.default.pack(e._ellipsoid,t,a),a+=it.default.packedLength,t[a++]=e._semiMajorAxis,t[a++]=e._semiMinorAxis,t[a++]=e._rotation,t[a++]=e._height,t[a++]=e._granularity,t[a++]=e._extrudedHeight,t[a++]=e._numberOfVerticalLines,t[a]=Object(o.default)(e._offsetAttribute,-1),t};var fn=new y.default,cn=new it.default,hn={center:fn,ellipsoid:cn,semiMajorAxis:void 0,semiMinorAxis:void 0,rotation:void 0,height:void 0,granularity:void 0,extrudedHeight:void 0,numberOfVerticalLines:void 0,offsetAttribute:void 0};dn.unpack=function(e,t,a){t=Object(o.default)(t,0);var i=y.default.unpack(e,t,fn);t+=y.default.packedLength;var r=it.default.unpack(e,t,cn);t+=it.default.packedLength;var n=e[t++],l=e[t++],u=e[t++],d=e[t++],f=e[t++],c=e[t++],h=e[t++],p=e[t];return Object(s.default)(a)?(a._center=y.default.clone(i,a._center),a._ellipsoid=it.default.clone(r,a._ellipsoid),a._semiMajorAxis=n,a._semiMinorAxis=l,a._rotation=u,a._height=d,a._granularity=f,a._extrudedHeight=c,a._numberOfVerticalLines=h,a._offsetAttribute=-1===p?void 0:p,a):(hn.height=d,hn.extrudedHeight=c,hn.granularity=f,hn.rotation=u,hn.semiMajorAxis=n,hn.semiMinorAxis=l,hn.numberOfVerticalLines=h,hn.offsetAttribute=-1===p?void 0:p,new dn(hn))},dn.createGeometry=function(e){if(!(e._semiMajorAxis<=0||e._semiMinorAxis<=0)){var t=e._height,a=e._extrudedHeight,i=!Fe.default.equalsEpsilon(t,a,0,Fe.default.EPSILON2);e._center=e._ellipsoid.scaleToGeodeticSurface(e._center,e._center);var n,l={center:e._center,semiMajorAxis:e._semiMajorAxis,semiMinorAxis:e._semiMinorAxis,ellipsoid:e._ellipsoid,rotation:e._rotation,height:t,granularity:e._granularity,numberOfVerticalLines:e._numberOfVerticalLines};if(i)l.extrudedHeight=a,l.offsetAttribute=e._offsetAttribute,n=function(e){var t=e.center,a=e.ellipsoid,i=e.semiMajorAxis,n=y.default.multiplyByScalar(a.geodeticSurfaceNormal(t,on),e.height,on);ln.center=y.default.add(t,n,ln.center),ln.radius=i,n=y.default.multiplyByScalar(a.geodeticSurfaceNormal(t,n),e.extrudedHeight,n),un.center=y.default.add(t,n,un.center),un.radius=i;var l=Pr.computeEllipsePositions(e,!1,!0).outerPositions,u=new Wa.a({position:new qa.a({componentDatatype:ue.a.DOUBLE,componentsPerAttribute:3,values:Pr.raisePositionsToHeight(l,e,!0)})});l=u.position.values;var d=r.default.union(ln,un),f=l.length/3;if(Object(s.default)(e.offsetAttribute)){var c=new Uint8Array(f);if(e.offsetAttribute===he.a.TOP)c=Object($e.a)(c,1,0,f/2);else{var h=e.offsetAttribute===he.a.NONE?0:1;c=Object($e.a)(c,h)}u.applyOffset=new qa.a({componentDatatype:ue.a.UNSIGNED_BYTE,componentsPerAttribute:1,values:c})}var p=Object(o.default)(e.numberOfVerticalLines,16);p=Fe.default.clamp(p,0,f/2);var m=Ya.a.createTypedArray(f,2*f+2*p);f/=2;var v,g,_=0;for(v=0;v<f;++v)m[_++]=v,m[_++]=(v+1)%f,m[_++]=v+f,m[_++]=(v+1)%f+f;if(p>0){var b=Math.min(p,f);g=Math.round(f/b);var O=Math.min(g*p,f);for(v=0;v<O;v+=g)m[_++]=v,m[_++]=v+f}return{boundingSphere:d,attributes:u,indices:m}}(l);else if(n=function(e){var t=e.center;sn=y.default.multiplyByScalar(e.ellipsoid.geodeticSurfaceNormal(t,sn),e.height,sn),sn=y.default.add(t,sn,sn);for(var a=new r.default(sn,e.semiMajorAxis),i=Pr.computeEllipsePositions(e,!1,!0).outerPositions,n=new Wa.a({position:new qa.a({componentDatatype:ue.a.DOUBLE,componentsPerAttribute:3,values:Pr.raisePositionsToHeight(i,e,!1)})}),o=i.length/3,s=Ya.a.createTypedArray(o,2*o),l=0,u=0;u<o;++u)s[l++]=u,s[l++]=(u+1)%o;return{boundingSphere:a,attributes:n,indices:s}}(l),Object(s.default)(e._offsetAttribute)){var u=n.attributes.position.values.length,d=new Uint8Array(u/3),f=e._offsetAttribute===he.a.NONE?0:1;Object($e.a)(d,f),n.attributes.applyOffset=new qa.a({componentDatatype:ue.a.UNSIGNED_BYTE,componentsPerAttribute:1,values:d})}return new Ga.a({attributes:n.attributes,indices:n.indices,primitiveType:Xa.a.LINES,boundingSphere:n.boundingSphere,offsetAttribute:e._offsetAttribute})}};var pn=dn,mn=new b.default,vn=y.default.ZERO,gn=new y.default,_n=new Za.default;function yn(e){this.id=e,this.vertexFormat=void 0,this.center=void 0,this.semiMajorAxis=void 0,this.semiMinorAxis=void 0,this.rotation=void 0,this.height=void 0,this.extrudedHeight=void 0,this.granularity=void 0,this.stRotation=void 0,this.numberOfVerticalLines=void 0,this.offsetAttribute=void 0}function bn(e,t){Ri.call(this,{entity:e,scene:t,geometryOptions:new yn(e),geometryPropertyName:"ellipse",observedPropertyNames:["availability","position","ellipse"]}),this._onEntityPropertyChanged(e,"ellipse",e.ellipse,void 0)}function On(e,t,a){we.call(this,e,t,a)}Object(s.default)(Object.create)&&(bn.prototype=Object.create(Ri.prototype),bn.prototype.constructor=bn),bn.prototype.createFillGeometryInstance=function(e){var t,a=this._entity,i=a.isAvailable(e),r={show:new ve.a(i&&a.isShowing&&this._showProperty.getValue(e)&&this._fillProperty.getValue(e)),distanceDisplayCondition:fe.fromDistanceDisplayCondition(this._distanceDisplayConditionProperty.getValue(e)),offset:void 0,color:void 0};this._materialProperty instanceof ge.default&&(Object(s.default)(this._materialProperty.color)&&(this._materialProperty.color.isConstant||i)&&(t=this._materialProperty.color.getValue(e,mn)),Object(s.default)(t)||(t=b.default.WHITE),r.color=le.a.fromColor(t));return Object(s.default)(this._options.offsetAttribute)&&(r.offset=me.a.fromCartesian3(P.default.getValueOrDefault(this._terrainOffsetProperty,e,vn,gn))),new ce.a({id:a,geometry:new nn(this._options),attributes:r})},bn.prototype.createOutlineGeometryInstance=function(e){var t=this._entity,a=t.isAvailable(e),i=P.default.getValueOrDefault(this._outlineColorProperty,e,b.default.BLACK,mn),r=this._distanceDisplayConditionProperty.getValue(e),n={show:new ve.a(a&&t.isShowing&&this._showProperty.getValue(e)&&this._showOutlineProperty.getValue(e)),color:le.a.fromColor(i),distanceDisplayCondition:fe.fromDistanceDisplayCondition(r),offset:void 0};return Object(s.default)(this._options.offsetAttribute)&&(n.offset=me.a.fromCartesian3(P.default.getValueOrDefault(this._terrainOffsetProperty,e,vn,gn))),new ce.a({id:t,geometry:new pn(this._options),attributes:n})},bn.prototype._computeCenter=function(e,t){return P.default.getValueOrUndefined(this._entity.position,e,t)},bn.prototype._isHidden=function(e,t){var a=e.position;return!Object(s.default)(a)||!Object(s.default)(t.semiMajorAxis)||!Object(s.default)(t.semiMinorAxis)||Le.prototype._isHidden.call(this,e,t)},bn.prototype._isDynamic=function(e,t){return!e.position.isConstant||!t.semiMajorAxis.isConstant||!t.semiMinorAxis.isConstant||!P.default.isConstant(t.rotation)||!P.default.isConstant(t.height)||!P.default.isConstant(t.extrudedHeight)||!P.default.isConstant(t.granularity)||!P.default.isConstant(t.stRotation)||!P.default.isConstant(t.outlineWidth)||!P.default.isConstant(t.numberOfVerticalLines)||!P.default.isConstant(t.zIndex)||this._onTerrain&&!P.default.isConstant(this._materialProperty)},bn.prototype._setStaticOptions=function(e,t){var a=P.default.getValueOrUndefined(t.height,pe.default.MINIMUM_VALUE),r=P.default.getValueOrDefault(t.heightReference,pe.default.MINIMUM_VALUE,A.default.NONE),n=P.default.getValueOrUndefined(t.extrudedHeight,pe.default.MINIMUM_VALUE),o=P.default.getValueOrDefault(t.extrudedHeightReference,pe.default.MINIMUM_VALUE,A.default.NONE);Object(s.default)(n)&&!Object(s.default)(a)&&(a=0);var l=this._options;l.vertexFormat=this._materialProperty instanceof ge.default?re.a.VERTEX_FORMAT:ie.MaterialSupport.TEXTURED.vertexFormat,l.center=e.position.getValue(pe.default.MINIMUM_VALUE,l.center),l.semiMajorAxis=t.semiMajorAxis.getValue(pe.default.MINIMUM_VALUE,l.semiMajorAxis),l.semiMinorAxis=t.semiMinorAxis.getValue(pe.default.MINIMUM_VALUE,l.semiMinorAxis),l.rotation=P.default.getValueOrUndefined(t.rotation,pe.default.MINIMUM_VALUE),l.granularity=P.default.getValueOrUndefined(t.granularity,pe.default.MINIMUM_VALUE),l.stRotation=P.default.getValueOrUndefined(t.stRotation,pe.default.MINIMUM_VALUE),l.numberOfVerticalLines=P.default.getValueOrUndefined(t.numberOfVerticalLines,pe.default.MINIMUM_VALUE),l.offsetAttribute=Ri.computeGeometryOffsetAttribute(a,r,n,o),l.height=Ri.getGeometryHeight(a,r),(n=Ri.getGeometryExtrudedHeight(n,o))===Ri.CLAMP_TO_GROUND&&(n=i.a.getMinimumMaximumHeights(nn.computeRectangle(l,_n)).minimumTerrainHeight),l.extrudedHeight=n},bn.DynamicGeometryUpdater=On,Object(s.default)(Object.create)&&(On.prototype=Object.create(we.prototype),On.prototype.constructor=On),On.prototype._isHidden=function(e,t,a){var i=this._options;return!Object(s.default)(i.center)||!Object(s.default)(i.semiMajorAxis)||!Object(s.default)(i.semiMinorAxis)||we.prototype._isHidden.call(this,e,t,a)},On.prototype._setOptions=function(e,t,a){var r=this._options,n=P.default.getValueOrUndefined(t.height,a),o=P.default.getValueOrDefault(t.heightReference,a,A.default.NONE),l=P.default.getValueOrUndefined(t.extrudedHeight,a),u=P.default.getValueOrDefault(t.extrudedHeightReference,a,A.default.NONE);Object(s.default)(l)&&!Object(s.default)(n)&&(n=0),r.center=P.default.getValueOrUndefined(e.position,a,r.center),r.semiMajorAxis=P.default.getValueOrUndefined(t.semiMajorAxis,a),r.semiMinorAxis=P.default.getValueOrUndefined(t.semiMinorAxis,a),r.rotation=P.default.getValueOrUndefined(t.rotation,a),r.granularity=P.default.getValueOrUndefined(t.granularity,a),r.stRotation=P.default.getValueOrUndefined(t.stRotation,a),r.numberOfVerticalLines=P.default.getValueOrUndefined(t.numberOfVerticalLines,a),r.offsetAttribute=Ri.computeGeometryOffsetAttribute(n,o,l,u),r.height=Ri.getGeometryHeight(n,o),(l=Ri.getGeometryExtrudedHeight(l,u))===Ri.CLAMP_TO_GROUND&&(l=i.a.getMinimumMaximumHeights(nn.computeRectangle(r,_n)).minimumTerrainHeight),r.extrudedHeight=l};var wn=bn,xn=a(296),An=a(237),jn=new ge.default(b.default.WHITE),En=y.default.ZERO,Cn=new y.default,Pn=new y.default,Tn=new y.default,Dn=new b.default,In=new y.default(1,1,1);function Sn(e){this.id=e,this.vertexFormat=void 0,this.radii=void 0,this.innerRadii=void 0,this.minimumClock=void 0,this.maximumClock=void 0,this.minimumCone=void 0,this.maximumCone=void 0,this.stackPartitions=void 0,this.slicePartitions=void 0,this.subdivisions=void 0,this.offsetAttribute=void 0}function Mn(e,t){Le.call(this,{entity:e,scene:t,geometryOptions:new Sn(e),geometryPropertyName:"ellipsoid",observedPropertyNames:["availability","position","orientation","ellipsoid"]}),this._onEntityPropertyChanged(e,"ellipsoid",e.ellipsoid,void 0)}function Rn(e,t,a){we.call(this,e,t,a),this._scene=e._scene,this._modelMatrix=new lt.default,this._attributes=void 0,this._outlineAttributes=void 0,this._lastSceneMode=void 0,this._lastShow=void 0,this._lastOutlineShow=void 0,this._lastOutlineWidth=void 0,this._lastOutlineColor=void 0,this._lastOffset=new y.default,this._material={}}Object(s.default)(Object.create)&&(Mn.prototype=Object.create(Le.prototype),Mn.prototype.constructor=Mn),Object(l.default)(Mn.prototype,{terrainOffsetProperty:{get:function(){return this._terrainOffsetProperty}}}),Mn.prototype.createFillGeometryInstance=function(e,t,a){var i,r,n=this._entity,o=n.isAvailable(e),l=new ve.a(o&&n.isShowing&&this._showProperty.getValue(e)&&this._fillProperty.getValue(e)),u=this._distanceDisplayConditionProperty.getValue(e),d={show:l,distanceDisplayCondition:fe.fromDistanceDisplayCondition(u),color:void 0,offset:void 0};this._materialProperty instanceof ge.default&&(Object(s.default)(this._materialProperty.color)&&(this._materialProperty.color.isConstant||o)&&(r=this._materialProperty.color.getValue(e,Dn)),Object(s.default)(r)||(r=b.default.WHITE),i=le.a.fromColor(r),d.color=i);return Object(s.default)(this._options.offsetAttribute)&&(d.offset=me.a.fromCartesian3(P.default.getValueOrDefault(this._terrainOffsetProperty,e,En,Cn))),new ce.a({id:n,geometry:new xn.a(this._options),modelMatrix:t?void 0:n.computeModelMatrixForHeightReference(e,n.ellipsoid.heightReference,.5*this._options.radii.z,this._scene.mapProjection.ellipsoid,a),attributes:d})},Mn.prototype.createOutlineGeometryInstance=function(e,t,a){var i=this._entity,r=i.isAvailable(e),n=P.default.getValueOrDefault(this._outlineColorProperty,e,b.default.BLACK,Dn),o=this._distanceDisplayConditionProperty.getValue(e),l={show:new ve.a(r&&i.isShowing&&this._showProperty.getValue(e)&&this._showOutlineProperty.getValue(e)),color:le.a.fromColor(n),distanceDisplayCondition:fe.fromDistanceDisplayCondition(o),offset:void 0};return Object(s.default)(this._options.offsetAttribute)&&(l.offset=me.a.fromCartesian3(P.default.getValueOrDefault(this._terrainOffsetProperty,e,En,Cn))),new ce.a({id:i,geometry:new An.a(this._options),modelMatrix:t?void 0:i.computeModelMatrixForHeightReference(e,i.ellipsoid.heightReference,.5*this._options.radii.z,this._scene.mapProjection.ellipsoid,a),attributes:l})},Mn.prototype._computeCenter=function(e,t){return P.default.getValueOrUndefined(this._entity.position,e,t)},Mn.prototype._isHidden=function(e,t){return!Object(s.default)(e.position)||!Object(s.default)(t.radii)||Le.prototype._isHidden.call(this,e,t)},Mn.prototype._isDynamic=function(e,t){return!(e.position.isConstant&&P.default.isConstant(e.orientation)&&t.radii.isConstant&&P.default.isConstant(t.innerRadii)&&P.default.isConstant(t.stackPartitions)&&P.default.isConstant(t.slicePartitions)&&P.default.isConstant(t.outlineWidth)&&P.default.isConstant(t.minimumClock)&&P.default.isConstant(t.maximumClock)&&P.default.isConstant(t.minimumCone)&&P.default.isConstant(t.maximumCone)&&P.default.isConstant(t.subdivisions))},Mn.prototype._setStaticOptions=function(e,t){var a=P.default.getValueOrDefault(t.heightReference,pe.default.MINIMUM_VALUE,A.default.NONE),i=this._options;i.vertexFormat=this._materialProperty instanceof ge.default?re.a.VERTEX_FORMAT:ie.MaterialSupport.TEXTURED.vertexFormat,i.radii=t.radii.getValue(pe.default.MINIMUM_VALUE,i.radii),i.innerRadii=P.default.getValueOrUndefined(t.innerRadii,i.radii),i.minimumClock=P.default.getValueOrUndefined(t.minimumClock,pe.default.MINIMUM_VALUE),i.maximumClock=P.default.getValueOrUndefined(t.maximumClock,pe.default.MINIMUM_VALUE),i.minimumCone=P.default.getValueOrUndefined(t.minimumCone,pe.default.MINIMUM_VALUE),i.maximumCone=P.default.getValueOrUndefined(t.maximumCone,pe.default.MINIMUM_VALUE),i.stackPartitions=P.default.getValueOrUndefined(t.stackPartitions,pe.default.MINIMUM_VALUE),i.slicePartitions=P.default.getValueOrUndefined(t.slicePartitions,pe.default.MINIMUM_VALUE),i.subdivisions=P.default.getValueOrUndefined(t.subdivisions,pe.default.MINIMUM_VALUE),i.offsetAttribute=a!==A.default.NONE?he.a.ALL:void 0},Mn.prototype._onEntityPropertyChanged=Ge,Mn.DynamicGeometryUpdater=Rn,Object(s.default)(Object.create)&&(Rn.prototype=Object.create(we.prototype),Rn.prototype.constructor=Rn),Rn.prototype.update=function(e){var t=this._entity,a=t.ellipsoid;if(!t.isShowing||!t.isAvailable(e)||!P.default.getValueOrDefault(a.show,e,!0))return Object(s.default)(this._primitive)&&(this._primitive.show=!1),void(Object(s.default)(this._outlinePrimitive)&&(this._outlinePrimitive.show=!1));var i=P.default.getValueOrUndefined(a.radii,e,Pn),r=Object(s.default)(i)?t.computeModelMatrixForHeightReference(e,a.heightReference,.5*i.z,this._scene.mapProjection.ellipsoid,this._modelMatrix):void 0;if(!Object(s.default)(r)||!Object(s.default)(i))return Object(s.default)(this._primitive)&&(this._primitive.show=!1),void(Object(s.default)(this._outlinePrimitive)&&(this._outlinePrimitive.show=!1));var n=P.default.getValueOrDefault(a.fill,e,!0),l=P.default.getValueOrDefault(a.outline,e,!1),u=P.default.getValueOrClonedDefault(a.outlineColor,e,b.default.BLACK,Dn),d=be.getValue(e,Object(o.default)(a.material,jn),this._material),f=P.default.getValueOrUndefined(a.innerRadii,e,Tn),c=P.default.getValueOrUndefined(a.minimumClock,e),h=P.default.getValueOrUndefined(a.maximumClock,e),p=P.default.getValueOrUndefined(a.minimumCone,e),m=P.default.getValueOrUndefined(a.maximumCone,e),v=P.default.getValueOrUndefined(a.stackPartitions,e),g=P.default.getValueOrUndefined(a.slicePartitions,e),_=P.default.getValueOrUndefined(a.subdivisions,e),O=P.default.getValueOrDefault(a.outlineWidth,e,1),x=P.default.getValueOrDefault(a.heightReference,e,A.default.NONE),j=x!==A.default.NONE?he.a.ALL:void 0,E=this._scene.mode,C=E===Be.a.SCENE3D&&x===A.default.NONE,T=this._options,D=this._geometryUpdater.shadowsProperty.getValue(e),I=this._geometryUpdater.distanceDisplayConditionProperty.getValue(e),S=P.default.getValueOrDefault(this._geometryUpdater.terrainOffsetProperty,e,En,Cn);if(!C||this._lastSceneMode!==E||!Object(s.default)(this._primitive)||T.stackPartitions!==v||T.slicePartitions!==g||Object(s.default)(f)&&!y.default.equals(T.innerRadii!==f)||T.minimumClock!==c||T.maximumClock!==h||T.minimumCone!==p||T.maximumCone!==m||T.subdivisions!==_||this._lastOutlineWidth!==O||T.offsetAttribute!==j){var M=this._primitives;if(M.removeAndDestroy(this._primitive),M.removeAndDestroy(this._outlinePrimitive),this._primitive=void 0,this._outlinePrimitive=void 0,this._lastSceneMode=E,this._lastOutlineWidth=O,T.stackPartitions=v,T.slicePartitions=g,T.subdivisions=_,T.offsetAttribute=j,T.radii=y.default.clone(C?In:i,T.radii),Object(s.default)(f))if(C){var R=y.default.magnitude(i);T.innerRadii=y.default.fromElements(f.x/R,f.y/R,f.z/R,T.innerRadii)}else T.innerRadii=y.default.clone(f,T.innerRadii);else T.innerRadii=void 0;T.minimumClock=c,T.maximumClock=h,T.minimumCone=p,T.maximumCone=m;var L=new ie({material:d,translucent:d.isTranslucent(),closed:!0});T.vertexFormat=L.vertexFormat;var V=this._geometryUpdater.createFillGeometryInstance(e,C,this._modelMatrix);this._primitive=M.add(new _e.a({geometryInstances:V,appearance:L,asynchronous:!1,shadows:D}));var N=this._geometryUpdater.createOutlineGeometryInstance(e,C,this._modelMatrix);this._outlinePrimitive=M.add(new _e.a({geometryInstances:N,appearance:new re.a({flat:!0,translucent:255!==N.attributes.color.value[3],renderState:{lineWidth:this._geometryUpdater._scene.clampLineWidth(O)}}),asynchronous:!1,shadows:D})),this._lastShow=n,this._lastOutlineShow=l,this._lastOutlineColor=b.default.clone(u,this._lastOutlineColor),this._lastDistanceDisplayCondition=I,this._lastOffset=y.default.clone(S,this._lastOffset)}else if(this._primitive.ready){var F=this._primitive,B=this._outlinePrimitive;F.show=!0,B.show=!0,F.appearance.material=d;var U=this._attributes;Object(s.default)(U)||(U=F.getGeometryInstanceAttributes(t),this._attributes=U),n!==this._lastShow&&(U.show=ve.a.toValue(n,U.show),this._lastShow=n);var H=this._outlineAttributes;Object(s.default)(H)||(H=B.getGeometryInstanceAttributes(t),this._outlineAttributes=H),l!==this._lastOutlineShow&&(H.show=ve.a.toValue(l,H.show),this._lastOutlineShow=l),b.default.equals(u,this._lastOutlineColor)||(H.color=le.a.toValue(u,H.color),b.default.clone(u,this._lastOutlineColor)),w.a.equals(I,this._lastDistanceDisplayCondition)||(U.distanceDisplayCondition=fe.toValue(I,U.distanceDisplayCondition),H.distanceDisplayCondition=fe.toValue(I,H.distanceDisplayCondition),w.a.clone(I,this._lastDistanceDisplayCondition)),y.default.equals(S,this._lastOffset)||(U.offset=me.a.toValue(S,U.offset),H.offset=me.a.toValue(S,U.offset),y.default.clone(S,this._lastOffset))}C&&(i.x=Math.max(i.x,.001),i.y=Math.max(i.y,.001),i.z=Math.max(i.z,.001),r=lt.default.multiplyByScale(r,i,r),this._primitive.modelMatrix=r,this._outlinePrimitive.modelMatrix=r)};var Ln=Mn;function Vn(e){e=Object(o.default)(e,o.default.EMPTY_OBJECT);var t=Object(o.default)(e.vertexFormat,$.default.DEFAULT);this._vertexFormat=t,this._workerName="createPlaneGeometry"}Vn.packedLength=$.default.packedLength,Vn.pack=function(e,t,a){return a=Object(o.default)(a,0),$.default.pack(e._vertexFormat,t,a),t};var Nn=new $.default,Fn={vertexFormat:Nn};Vn.unpack=function(e,t,a){t=Object(o.default)(t,0);var i=$.default.unpack(e,t,Nn);return Object(s.default)(a)?(a._vertexFormat=$.default.clone(i,a._vertexFormat),a):new Vn(Fn)};var Bn=new y.default(-.5,-.5,0),Un=new y.default(.5,.5,0);Vn.createGeometry=function(e){var t,a,i=e._vertexFormat,n=new Wa.a;if(i.position){if((a=new Float64Array(12))[0]=Bn.x,a[1]=Bn.y,a[2]=0,a[3]=Un.x,a[4]=Bn.y,a[5]=0,a[6]=Un.x,a[7]=Un.y,a[8]=0,a[9]=Bn.x,a[10]=Un.y,a[11]=0,n.position=new qa.a({componentDatatype:ue.a.DOUBLE,componentsPerAttribute:3,values:a}),i.normal){var o=new Float32Array(12);o[0]=0,o[1]=0,o[2]=1,o[3]=0,o[4]=0,o[5]=1,o[6]=0,o[7]=0,o[8]=1,o[9]=0,o[10]=0,o[11]=1,n.normal=new qa.a({componentDatatype:ue.a.FLOAT,componentsPerAttribute:3,values:o})}if(i.st){var s=new Float32Array(8);s[0]=0,s[1]=0,s[2]=1,s[3]=0,s[4]=1,s[5]=1,s[6]=0,s[7]=1,n.st=new qa.a({componentDatatype:ue.a.FLOAT,componentsPerAttribute:2,values:s})}if(i.tangent){var l=new Float32Array(12);l[0]=1,l[1]=0,l[2]=0,l[3]=1,l[4]=0,l[5]=0,l[6]=1,l[7]=0,l[8]=0,l[9]=1,l[10]=0,l[11]=0,n.tangent=new qa.a({componentDatatype:ue.a.FLOAT,componentsPerAttribute:3,values:l})}if(i.bitangent){var u=new Float32Array(12);u[0]=0,u[1]=1,u[2]=0,u[3]=0,u[4]=1,u[5]=0,u[6]=0,u[7]=1,u[8]=0,u[9]=0,u[10]=1,u[11]=0,n.bitangent=new qa.a({componentDatatype:ue.a.FLOAT,componentsPerAttribute:3,values:u})}(t=new Uint16Array(6))[0]=0,t[1]=1,t[2]=2,t[3]=0,t[4]=2,t[5]=3}return new Ga.a({attributes:n,indices:t,primitiveType:Xa.a.TRIANGLES,boundingSphere:new r.default(y.default.ZERO,Math.sqrt(2))})};var Hn=Vn;function kn(){this._workerName="createPlaneOutlineGeometry"}kn.packedLength=0,kn.pack=function(e,t){return t},kn.unpack=function(e,t,a){return Object(s.default)(a)?a:new kn};var zn=new y.default(-.5,-.5,0),Gn=new y.default(.5,.5,0);kn.createGeometry=function(){var e=new Wa.a,t=new Uint16Array(8),a=new Float64Array(12);return a[0]=zn.x,a[1]=zn.y,a[2]=zn.z,a[3]=Gn.x,a[4]=zn.y,a[5]=zn.z,a[6]=Gn.x,a[7]=Gn.y,a[8]=zn.z,a[9]=zn.x,a[10]=Gn.y,a[11]=zn.z,e.position=new qa.a({componentDatatype:ue.a.DOUBLE,componentsPerAttribute:3,values:a}),t[0]=0,t[1]=1,t[2]=1,t[3]=2,t[4]=2,t[5]=3,t[6]=3,t[7]=0,new Ga.a({attributes:e,indices:t,primitiveType:Xa.a.LINES,boundingSphere:new r.default(y.default.ZERO,Math.sqrt(2))})};var qn=kn,Wn=new y.default,Yn=new b.default;function Kn(e){this.id=e,this.vertexFormat=void 0,this.plane=void 0,this.dimensions=void 0}function Xn(e,t){Le.call(this,{entity:e,scene:t,geometryOptions:new Kn(e),geometryPropertyName:"plane",observedPropertyNames:["availability","position","orientation","plane"]}),this._onEntityPropertyChanged(e,"plane",e.plane,void 0)}function Zn(e,t,a){we.call(this,e,t,a)}Object(s.default)(Object.create)&&(Xn.prototype=Object.create(Le.prototype),Xn.prototype.constructor=Xn),Xn.prototype.createFillGeometryInstance=function(e){var t,a,i=this._entity,r=i.isAvailable(e),n=new ve.a(r&&i.isShowing&&this._showProperty.getValue(e)&&this._fillProperty.getValue(e)),o=this._distanceDisplayConditionProperty.getValue(e),l=fe.fromDistanceDisplayCondition(o);this._materialProperty instanceof ge.default?(Object(s.default)(this._materialProperty.color)&&(this._materialProperty.color.isConstant||r)&&(a=this._materialProperty.color.getValue(e,Yn)),Object(s.default)(a)||(a=b.default.WHITE),t={show:n,distanceDisplayCondition:l,color:le.a.fromColor(a)}):t={show:n,distanceDisplayCondition:l};var u=i.plane,d=this._options,f=i.computeModelMatrix(e),c=P.default.getValueOrDefault(u.plane,e,d.plane),h=P.default.getValueOrUndefined(u.dimensions,e,d.dimensions);return d.plane=c,d.dimensions=h,f=ro(c,h,f,this._scene.mapProjection.ellipsoid,f),new ce.a({id:i,geometry:new Hn(this._options),modelMatrix:f,attributes:t})},Xn.prototype.createOutlineGeometryInstance=function(e){var t=this._entity,a=t.isAvailable(e),i=P.default.getValueOrDefault(this._outlineColorProperty,e,b.default.BLACK,Yn),r=this._distanceDisplayConditionProperty.getValue(e),n=t.plane,o=this._options,s=t.computeModelMatrix(e),l=P.default.getValueOrDefault(n.plane,e,o.plane),u=P.default.getValueOrUndefined(n.dimensions,e,o.dimensions);return o.plane=l,o.dimensions=u,s=ro(l,u,s,this._scene.mapProjection.ellipsoid,s),new ce.a({id:t,geometry:new qn,modelMatrix:s,attributes:{show:new ve.a(a&&t.isShowing&&this._showProperty.getValue(e)&&this._showOutlineProperty.getValue(e)),color:le.a.fromColor(i),distanceDisplayCondition:fe.fromDistanceDisplayCondition(r)}})},Xn.prototype._isHidden=function(e,t){return!Object(s.default)(t.plane)||!Object(s.default)(t.dimensions)||!Object(s.default)(e.position)||Le.prototype._isHidden.call(this,e,t)},Xn.prototype._getIsClosed=function(e){return!1},Xn.prototype._isDynamic=function(e,t){return!(e.position.isConstant&&P.default.isConstant(e.orientation)&&t.plane.isConstant&&t.dimensions.isConstant&&P.default.isConstant(t.outlineWidth))},Xn.prototype._setStaticOptions=function(e,t){var a=this._materialProperty instanceof ge.default,i=this._options;i.vertexFormat=a?re.a.VERTEX_FORMAT:ie.MaterialSupport.TEXTURED.vertexFormat,i.plane=t.plane.getValue(pe.default.MINIMUM_VALUE,i.plane),i.dimensions=t.dimensions.getValue(pe.default.MINIMUM_VALUE,i.dimensions)},Xn.DynamicGeometryUpdater=Zn,Object(s.default)(Object.create)&&(Zn.prototype=Object.create(we.prototype),Zn.prototype.constructor=Zn),Zn.prototype._isHidden=function(e,t,a){var i=this._options,r=P.default.getValueOrUndefined(e.position,a,Wn);return!Object(s.default)(r)||!Object(s.default)(i.plane)||!Object(s.default)(i.dimensions)||we.prototype._isHidden.call(this,e,t,a)},Zn.prototype._setOptions=function(e,t,a){var i=this._options;i.plane=P.default.getValueOrDefault(t.plane,a,i.plane),i.dimensions=P.default.getValueOrUndefined(t.dimensions,a,i.dimensions)};var Jn=new y.default,Qn=new y.default,$n=new y.default,eo=new y.default,to=new y.default,ao=new Vt.default,io=new at.default;function ro(e,t,a,i,r){var n=e.normal,o=e.distance,s=y.default.multiplyByScalar(n,-o,$n);s=lt.default.multiplyByPoint(a,s,s);var l=lt.default.multiplyByPointAsVector(a,n,eo);y.default.normalize(l,l);var u=i.geodeticSurfaceNormal(s,Qn);Fe.default.equalsEpsilon(Math.abs(y.default.dot(u,l)),1,Fe.default.EPSILON8)&&(u=y.default.clone(y.default.UNIT_Z,u),Fe.default.equalsEpsilon(Math.abs(y.default.dot(u,l)),1,Fe.default.EPSILON8)&&(u=y.default.clone(y.default.UNIT_X,u)));var d=y.default.cross(u,l,Jn);u=y.default.cross(l,d,u),y.default.normalize(d,d),y.default.normalize(u,u);var f=io;at.default.setColumn(f,0,d,f),at.default.setColumn(f,1,u,f),at.default.setColumn(f,2,l,f);var c=Vt.default.fromRotationMatrix(f,ao),h=_.default.clone(t,to);return h.z=1,lt.default.fromTranslationQuaternionRotationScale(s,c,h,r)}Xn.createPrimitiveMatrix=ro;var no=Xn,oo=a(133),so=a(125),lo={},uo=new y.default,fo=new y.default,co=new y.default,ho=new y.default,po=new so.a;function mo(e,t,a,i,r){var n=y.default.subtract(e,t,uo),o=y.default.dot(a,n),s=y.default.dot(i,n);return _.default.fromElements(o,s,r)}lo.validOutline=function(e){var t=so.a.fromPoints(e,po).halfAxes,a=at.default.getColumn(t,0,fo),i=at.default.getColumn(t,1,co),r=at.default.getColumn(t,2,ho),n=y.default.magnitude(a),o=y.default.magnitude(i),s=y.default.magnitude(r);return!(0===n&&(0===o||0===s)||0===o&&0===s)},lo.computeProjectTo2DArguments=function(e,t,a,i){var r,n,o=so.a.fromPoints(e,po),s=o.halfAxes,l=at.default.getColumn(s,0,fo),u=at.default.getColumn(s,1,co),d=at.default.getColumn(s,2,ho),f=y.default.magnitude(l),c=y.default.magnitude(u),h=y.default.magnitude(d),p=Math.min(f,c,h);return(0!==f||0!==c&&0!==h)&&(0!==c||0!==h)&&(p!==c&&p!==h||(r=l),p===f?r=u:p===h&&(n=u),p!==f&&p!==c||(n=d),y.default.normalize(r,a),y.default.normalize(n,i),y.default.clone(o.center,t),!0)},lo.createProjectPointsTo2DFunction=function(e,t,a){return function(i){for(var r=new Array(i.length),n=0;n<i.length;n++)r[n]=mo(i[n],e,t,a);return r}},lo.createProjectPointTo2DFunction=function(e,t,a){return function(i,r){return mo(i,e,t,a,r)}};var vo=lo,go=a(715),_o=new y.default,yo=new g.default,bo=new _.default,Oo=new _.default,wo=new y.default,xo=new y.default,Ao=new y.default,jo=new y.default,Eo=new y.default,Co=new y.default,Po=new Vt.default,To=new at.default,Do=new at.default,Io=new y.default;function So(e,t,a,i,r,n,o,s){var l=e.positions,u=Ka.a.triangulate(e.positions2D,e.holes);u.length<3&&(u=[0,1,2]);var d=Ya.a.createTypedArray(l.length,u.length);d.set(u);var f=To;if(0!==i){var c=Vt.default.fromAxisAngle(n,i,Po);if(f=at.default.fromQuaternion(c,f),t.tangent||t.bitangent){c=Vt.default.fromAxisAngle(n,-i,Po);var h=at.default.fromQuaternion(c,Do);o=y.default.normalize(at.default.multiplyByVector(h,o,o),o),t.bitangent&&(s=y.default.normalize(y.default.cross(n,o,s),s))}}else f=at.default.clone(at.default.IDENTITY,f);var p=Oo;t.st&&(p.x=a.x,p.y=a.y);for(var m=l.length,v=3*m,g=new Float64Array(v),b=t.normal?new Float32Array(v):void 0,O=t.tangent?new Float32Array(v):void 0,w=t.bitangent?new Float32Array(v):void 0,x=t.st?new Float32Array(2*m):void 0,A=0,j=0,E=0,C=0,P=0,T=0;T<m;T++){var D=l[T];if(g[A++]=D.x,g[A++]=D.y,g[A++]=D.z,t.st){var I=r(at.default.multiplyByVector(f,D,_o),bo);_.default.subtract(I,p,I);var S=Fe.default.clamp(I.x/a.width,0,1),M=Fe.default.clamp(I.y/a.height,0,1);x[P++]=S,x[P++]=M}t.normal&&(b[j++]=n.x,b[j++]=n.y,b[j++]=n.z),t.tangent&&(O[C++]=o.x,O[C++]=o.y,O[C++]=o.z),t.bitangent&&(w[E++]=s.x,w[E++]=s.y,w[E++]=s.z)}var R=new Wa.a;return t.position&&(R.position=new qa.a({componentDatatype:ue.a.DOUBLE,componentsPerAttribute:3,values:g})),t.normal&&(R.normal=new qa.a({componentDatatype:ue.a.FLOAT,componentsPerAttribute:3,values:b})),t.tangent&&(R.tangent=new qa.a({componentDatatype:ue.a.FLOAT,componentsPerAttribute:3,values:O})),t.bitangent&&(R.bitangent=new qa.a({componentDatatype:ue.a.FLOAT,componentsPerAttribute:3,values:w})),t.st&&(R.st=new qa.a({componentDatatype:ue.a.FLOAT,componentsPerAttribute:2,values:x})),new Ga.a({attributes:R,indices:d,primitiveType:Xa.a.TRIANGLES})}function Mo(e){var t=(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).polygonHierarchy,a=Object(o.default)(e.vertexFormat,$.default.DEFAULT);this._vertexFormat=$.default.clone(a),this._polygonHierarchy=t,this._stRotation=Object(o.default)(e.stRotation,0),this._ellipsoid=it.default.clone(Object(o.default)(e.ellipsoid,it.default.WGS84)),this._workerName="createCoplanarPolygonGeometry",this.packedLength=go.default.computeHierarchyPackedLength(t)+$.default.packedLength+it.default.packedLength+2}Mo.fromPositions=function(e){return new Mo({polygonHierarchy:{positions:(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).positions},vertexFormat:e.vertexFormat,stRotation:e.stRotation,ellipsoid:e.ellipsoid})},Mo.pack=function(e,t,a){return a=Object(o.default)(a,0),a=go.default.packPolygonHierarchy(e._polygonHierarchy,t,a),it.default.pack(e._ellipsoid,t,a),a+=it.default.packedLength,$.default.pack(e._vertexFormat,t,a),a+=$.default.packedLength,t[a++]=e._stRotation,t[a]=e.packedLength,t};var Ro=it.default.clone(it.default.UNIT_SPHERE),Lo=new $.default,Vo={polygonHierarchy:{}};Mo.unpack=function(e,t,a){t=Object(o.default)(t,0);var i=go.default.unpackPolygonHierarchy(e,t);t=i.startingIndex,delete i.startingIndex;var r=it.default.unpack(e,t,Ro);t+=it.default.packedLength;var n=$.default.unpack(e,t,Lo);t+=$.default.packedLength;var l=e[t++],u=e[t];return Object(s.default)(a)||(a=new Mo(Vo)),a._polygonHierarchy=i,a._ellipsoid=it.default.clone(r,a._ellipsoid),a._vertexFormat=$.default.clone(n,a._vertexFormat),a._stRotation=l,a.packedLength=u,a},Mo.createGeometry=function(e){var t=e._vertexFormat,a=e._polygonHierarchy,i=e._stRotation,n=a.positions;if(!((n=Object(et.a)(n,y.default.equalsEpsilon,!0)).length<3)){var o=wo,s=xo,l=Ao,u=Eo,d=Co;if(vo.computeProjectTo2DArguments(n,jo,u,d)){if(o=y.default.cross(u,d,o),o=y.default.normalize(o,o),!y.default.equalsEpsilon(jo,y.default.ZERO,Fe.default.EPSILON6)){var f=e._ellipsoid.geodeticSurfaceNormal(jo,Io);y.default.dot(o,f)<0&&(o=y.default.negate(o,o),u=y.default.negate(u,u))}var c=vo.createProjectPointsTo2DFunction(jo,u,d),h=vo.createProjectPointTo2DFunction(jo,u,d);t.tangent&&(s=y.default.clone(u,s)),t.bitangent&&(l=y.default.clone(d,l));var p=go.default.polygonsFromHierarchy(a,c,!1),m=p.hierarchy,v=p.polygons;if(0!==m.length){n=m[0].outerRing;for(var g=r.default.fromPoints(n),_=go.default.computeBoundingRectangle(o,h,n,i,yo),b=[],O=0;O<v.length;O++){var w=new ce.a({geometry:So(v[O],t,_,i,h,o,s,l)});b.push(w)}var x=Dr.a.combineInstances(b)[0];x.attributes.position.values=new Float64Array(x.attributes.position.values),x.indices=Ya.a.createTypedArray(x.attributes.position.values.length/3,x.indices);var A=x.attributes;return t.position||delete A.position,new Ga.a({attributes:A,indices:x.indices,primitiveType:x.primitiveType,boundingSphere:g})}}}};var No=Mo;function Fo(e){for(var t=e.length,a=new Float64Array(3*t),i=Ya.a.createTypedArray(t,2*t),r=0,n=0,o=0;o<t;o++){var s=e[o];a[r++]=s.x,a[r++]=s.y,a[r++]=s.z,i[n++]=o,i[n++]=(o+1)%t}var l=new Wa.a({position:new qa.a({componentDatatype:ue.a.DOUBLE,componentsPerAttribute:3,values:a})});return new Ga.a({attributes:l,indices:i,primitiveType:Xa.a.LINES})}function Bo(e){var t=(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).polygonHierarchy;this._polygonHierarchy=t,this._workerName="createCoplanarPolygonOutlineGeometry",this.packedLength=go.default.computeHierarchyPackedLength(t)+1}Bo.fromPositions=function(e){return new Bo({polygonHierarchy:{positions:(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).positions}})},Bo.pack=function(e,t,a){return a=Object(o.default)(a,0),t[a=go.default.packPolygonHierarchy(e._polygonHierarchy,t,a)]=e.packedLength,t};var Uo={polygonHierarchy:{}};Bo.unpack=function(e,t,a){t=Object(o.default)(t,0);var i=go.default.unpackPolygonHierarchy(e,t);t=i.startingIndex,delete i.startingIndex;var r=e[t];return Object(s.default)(a)||(a=new Bo(Uo)),a._polygonHierarchy=i,a.packedLength=r,a},Bo.createGeometry=function(e){var t=e._polygonHierarchy,a=t.positions;if(!((a=Object(et.a)(a,y.default.equalsEpsilon,!0)).length<3)&&vo.validOutline(a)){var i=go.default.polygonOutlinesFromHierarchy(t,!1);if(0!==i.length){for(var n=[],o=0;o<i.length;o++){var s=new ce.a({geometry:Fo(i[o])});n.push(s)}var l=Dr.a.combineInstances(n)[0],u=r.default.fromPoints(t.positions);return new Ga.a({attributes:l.attributes,indices:l.indices,primitiveType:l.primitiveType,boundingSphere:u})}}};var Ho=Bo,ko=a(186),zo=new Ne.default,Go=new Ne.default;function qo(e,t,a,i){var r=i.cartesianToCartographic(e,zo).height,n=i.cartesianToCartographic(t,Go);n.height=r,i.cartographicToCartesian(n,t);var o=i.cartesianToCartographic(a,Go);o.height=r-100,i.cartographicToCartesian(o,a)}var Wo=new g.default,Yo=new y.default,Ko=new y.default,Xo=new y.default,Zo=new y.default,Jo=new y.default,Qo=new y.default,$o=new y.default,es=new y.default,ts=new y.default,as=new _.default,is=new _.default,rs=new y.default,ns=new Vt.default,os=new at.default,ss=new at.default;function ls(e){var t=e.vertexFormat,a=e.geometry,i=e.shadowVolume,r=a.attributes.position.values,n=r.length,o=e.wall,l=e.top||o,u=e.bottom||o;if(t.st||t.normal||t.tangent||t.bitangent||i){var d=e.boundingRectangle,f=e.tangentPlane,c=e.ellipsoid,h=e.stRotation,p=e.perPositionHeight,m=as;m.x=d.x,m.y=d.y;var v,g=t.st?new Float32Array(n/3*2):void 0;t.normal&&(v=p&&l&&!o?a.attributes.normal.values:new Float32Array(n));var b=t.tangent?new Float32Array(n):void 0,O=t.bitangent?new Float32Array(n):void 0,w=i?new Float32Array(n):void 0,x=0,A=0,j=Ko,E=Xo,C=Zo,P=!0,T=os,D=ss;if(0!==h){var I=Vt.default.fromAxisAngle(f._plane.normal,h,ns);T=at.default.fromQuaternion(I,T),I=Vt.default.fromAxisAngle(f._plane.normal,-h,ns),D=at.default.fromQuaternion(I,D)}else T=at.default.clone(at.default.IDENTITY,T),D=at.default.clone(at.default.IDENTITY,D);var S=0,M=0;l&&u&&(S=n/2,M=n/3,n/=2);for(var R=0;R<n;R+=3){var L=y.default.fromArray(r,R,rs);if(t.st){var V=at.default.multiplyByVector(T,L,Yo);V=c.scaleToGeodeticSurface(V,V);var N=f.projectPointOntoPlane(V,is);_.default.subtract(N,m,N);var F=Fe.default.clamp(N.x/d.width,0,1),B=Fe.default.clamp(N.y/d.height,0,1);u&&(g[x+M]=F,g[x+1+M]=B),l&&(g[x]=F,g[x+1]=B),x+=2}if(t.normal||t.tangent||t.bitangent||i){var U=A+1,H=A+2;if(o){if(R+3<n){var k=y.default.fromArray(r,R+3,Jo);if(P){var z=y.default.fromArray(r,R+n,Qo);p&&qo(L,k,z,c),y.default.subtract(k,L,k),y.default.subtract(z,L,z),j=y.default.normalize(y.default.cross(z,k,j),j),P=!1}y.default.equalsEpsilon(k,L,Fe.default.EPSILON10)&&(P=!0)}(t.tangent||t.bitangent)&&(C=c.geodeticSurfaceNormal(L,C),t.tangent&&(E=y.default.normalize(y.default.cross(C,j,E),E)))}else j=c.geodeticSurfaceNormal(L,j),(t.tangent||t.bitangent)&&(p&&($o=y.default.fromArray(v,A,$o),es=y.default.cross(y.default.UNIT_Z,$o,es),es=y.default.normalize(at.default.multiplyByVector(D,es,es),es),t.bitangent&&(ts=y.default.normalize(y.default.cross($o,es,ts),ts))),E=y.default.cross(y.default.UNIT_Z,j,E),E=y.default.normalize(at.default.multiplyByVector(D,E,E),E),t.bitangent&&(C=y.default.normalize(y.default.cross(j,E,C),C)));t.normal&&(e.wall?(v[A+S]=j.x,v[U+S]=j.y,v[H+S]=j.z):u&&(v[A+S]=-j.x,v[U+S]=-j.y,v[H+S]=-j.z),(l&&!p||o)&&(v[A]=j.x,v[U]=j.y,v[H]=j.z)),i&&(o&&(j=c.geodeticSurfaceNormal(L,j)),w[A+S]=-j.x,w[U+S]=-j.y,w[H+S]=-j.z),t.tangent&&(e.wall?(b[A+S]=E.x,b[U+S]=E.y,b[H+S]=E.z):u&&(b[A+S]=-E.x,b[U+S]=-E.y,b[H+S]=-E.z),l&&(p?(b[A]=es.x,b[U]=es.y,b[H]=es.z):(b[A]=E.x,b[U]=E.y,b[H]=E.z))),t.bitangent&&(u&&(O[A+S]=C.x,O[U+S]=C.y,O[H+S]=C.z),l&&(p?(O[A]=ts.x,O[U]=ts.y,O[H]=ts.z):(O[A]=C.x,O[U]=C.y,O[H]=C.z))),A+=3}}t.st&&(a.attributes.st=new qa.a({componentDatatype:ue.a.FLOAT,componentsPerAttribute:2,values:g})),t.normal&&(a.attributes.normal=new qa.a({componentDatatype:ue.a.FLOAT,componentsPerAttribute:3,values:v})),t.tangent&&(a.attributes.tangent=new qa.a({componentDatatype:ue.a.FLOAT,componentsPerAttribute:3,values:b})),t.bitangent&&(a.attributes.bitangent=new qa.a({componentDatatype:ue.a.FLOAT,componentsPerAttribute:3,values:O})),i&&(a.attributes.extrudeDirection=new qa.a({componentDatatype:ue.a.FLOAT,componentsPerAttribute:3,values:w}))}if(e.extrude&&Object(s.default)(e.offsetAttribute)){var G=r.length/3,q=new Uint8Array(G);if(e.offsetAttribute===he.a.TOP)l&&u||o?q=Object($e.a)(q,1,0,G/2):l&&(q=Object($e.a)(q,1));else{var W=e.offsetAttribute===he.a.NONE?0:1;q=Object($e.a)(q,W)}a.attributes.applyOffset=new qa.a({componentDatatype:ue.a.UNSIGNED_BYTE,componentsPerAttribute:1,values:q})}return a}var us=new Ne.default,ds=new Ne.default,fs={westOverIDL:0,eastOverIDL:0},cs=new rt.default;function hs(e,t,a,i,r){if(r=Object(o.default)(r,new Za.default),!Object(s.default)(e)||e.length<3)return r.west=0,r.north=0,r.south=0,r.east=0,r;if(a===oo.a.RHUMB)return Za.default.fromCartesianArray(e,t,r);cs.ellipsoid.equals(t)||(cs=new rt.default(void 0,void 0,t)),r.west=Number.POSITIVE_INFINITY,r.east=Number.NEGATIVE_INFINITY,r.south=Number.POSITIVE_INFINITY,r.north=Number.NEGATIVE_INFINITY,fs.westOverIDL=Number.POSITIVE_INFINITY,fs.eastOverIDL=Number.NEGATIVE_INFINITY;for(var n,l=1/Fe.default.chordLength(i,t.maximumRadius),u=e.length,d=t.cartesianToCartographic(e[0],ds),f=us,c=1;c<u;c++)n=f,f=d,d=t.cartesianToCartographic(e[c],n),cs.setEndPoints(f,d),ms(cs,l,r,fs);return n=f,f=d,d=t.cartesianToCartographic(e[0],n),cs.setEndPoints(f,d),ms(cs,l,r,fs),r.east-r.west>fs.eastOverIDL-fs.westOverIDL&&(r.west=fs.westOverIDL,r.east=fs.eastOverIDL,r.east>Fe.default.PI&&(r.east=r.east-Fe.default.TWO_PI),r.west>Fe.default.PI&&(r.west=r.west-Fe.default.TWO_PI)),r}var ps=new Ne.default;function ms(e,t,a,i){for(var r=e.surfaceDistance,n=Math.ceil(r*t),o=n>0?r/(n-1):Number.POSITIVE_INFINITY,s=0,l=0;l<n;l++){var u=e.interpolateUsingSurfaceDistance(s,ps);s+=o;var d=u.longitude,f=u.latitude;a.west=Math.min(a.west,d),a.east=Math.max(a.east,d),a.south=Math.min(a.south,f),a.north=Math.max(a.north,f);var c=d>=0?d:d+Fe.default.TWO_PI;i.westOverIDL=Math.min(i.westOverIDL,c),i.eastOverIDL=Math.max(i.eastOverIDL,c)}}var vs=[];function gs(e,t,a,i,r,n,o,s,l){var u,d={walls:[]};if(n||o){var f,c,h=go.default.createGeometryFromPositions(e,t,a,r,s,l),p=h.attributes.position.values,m=h.indices;if(n&&o){var v=p.concat(p);f=v.length/3,(c=Ya.a.createTypedArray(f,2*m.length)).set(m);var g=m.length,_=f/2;for(u=0;u<g;u+=3){var y=c[u]+_,b=c[u+1]+_,O=c[u+2]+_;c[u+g]=O,c[u+1+g]=b,c[u+2+g]=y}if(h.attributes.position.values=v,r&&s.normal){var w=h.attributes.normal.values;h.attributes.normal.values=new Float32Array(v.length),h.attributes.normal.values.set(w)}h.indices=c}else if(o){for(f=p.length/3,c=Ya.a.createTypedArray(f,m.length),u=0;u<m.length;u+=3)c[u]=m[u+2],c[u+1]=m[u+1],c[u+2]=m[u];h.indices=c}d.topAndBottom=new ce.a({geometry:h})}var x=i.outerRing,A=Lt.default.fromPoints(x,e),j=A.projectPointsOntoPlane(x,vs),E=Ka.a.computeWindingOrder2D(j);E===ko.default.CLOCKWISE&&(x=x.slice().reverse());var C=go.default.computeWallGeometry(x,e,a,r,l);d.walls.push(new ce.a({geometry:C}));var P=i.holes;for(u=0;u<P.length;u++){var T=P[u];j=(A=Lt.default.fromPoints(T,e)).projectPointsOntoPlane(T,vs),(E=Ka.a.computeWindingOrder2D(j))===ko.default.COUNTER_CLOCKWISE&&(T=T.slice().reverse()),C=go.default.computeWallGeometry(T,e,a,r,l),d.walls.push(new ce.a({geometry:C}))}return d}function _s(e){var t=e.polygonHierarchy,a=Object(o.default)(e.vertexFormat,$.default.DEFAULT),i=Object(o.default)(e.ellipsoid,it.default.WGS84),r=Object(o.default)(e.granularity,Fe.default.RADIANS_PER_DEGREE),n=Object(o.default)(e.stRotation,0),l=Object(o.default)(e.perPositionHeight,!1),u=l&&Object(s.default)(e.extrudedHeight),d=Object(o.default)(e.height,0),f=Object(o.default)(e.extrudedHeight,d);if(!u){var c=Math.max(d,f);f=Math.min(d,f),d=c}this._vertexFormat=$.default.clone(a),this._ellipsoid=it.default.clone(i),this._granularity=r,this._stRotation=n,this._height=d,this._extrudedHeight=f,this._closeTop=Object(o.default)(e.closeTop,!0),this._closeBottom=Object(o.default)(e.closeBottom,!0),this._polygonHierarchy=t,this._perPositionHeight=l,this._perPositionHeightExtrude=u,this._shadowVolume=Object(o.default)(e.shadowVolume,!1),this._workerName="createPolygonGeometry",this._offsetAttribute=e.offsetAttribute,this._arcType=Object(o.default)(e.arcType,oo.a.GEODESIC),this._rectangle=void 0,this._textureCoordinateRotationPoints=void 0,this.packedLength=go.default.computeHierarchyPackedLength(t)+it.default.packedLength+$.default.packedLength+12}_s.fromPositions=function(e){return new _s({polygonHierarchy:{positions:(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).positions},height:e.height,extrudedHeight:e.extrudedHeight,vertexFormat:e.vertexFormat,stRotation:e.stRotation,ellipsoid:e.ellipsoid,granularity:e.granularity,perPositionHeight:e.perPositionHeight,closeTop:e.closeTop,closeBottom:e.closeBottom,offsetAttribute:e.offsetAttribute,arcType:e.arcType})},_s.pack=function(e,t,a){return a=Object(o.default)(a,0),a=go.default.packPolygonHierarchy(e._polygonHierarchy,t,a),it.default.pack(e._ellipsoid,t,a),a+=it.default.packedLength,$.default.pack(e._vertexFormat,t,a),a+=$.default.packedLength,t[a++]=e._height,t[a++]=e._extrudedHeight,t[a++]=e._granularity,t[a++]=e._stRotation,t[a++]=e._perPositionHeightExtrude?1:0,t[a++]=e._perPositionHeight?1:0,t[a++]=e._closeTop?1:0,t[a++]=e._closeBottom?1:0,t[a++]=e._shadowVolume?1:0,t[a++]=Object(o.default)(e._offsetAttribute,-1),t[a++]=e._arcType,t[a]=e.packedLength,t};var ys=it.default.clone(it.default.UNIT_SPHERE),bs=new $.default,Os={polygonHierarchy:{}};_s.unpack=function(e,t,a){t=Object(o.default)(t,0);var i=go.default.unpackPolygonHierarchy(e,t);t=i.startingIndex,delete i.startingIndex;var r=it.default.unpack(e,t,ys);t+=it.default.packedLength;var n=$.default.unpack(e,t,bs);t+=$.default.packedLength;var l=e[t++],u=e[t++],d=e[t++],f=e[t++],c=1===e[t++],h=1===e[t++],p=1===e[t++],m=1===e[t++],v=1===e[t++],g=e[t++],_=e[t++],y=e[t];return Object(s.default)(a)||(a=new _s(Os)),a._polygonHierarchy=i,a._ellipsoid=it.default.clone(r,a._ellipsoid),a._vertexFormat=$.default.clone(n,a._vertexFormat),a._height=l,a._extrudedHeight=u,a._granularity=d,a._stRotation=f,a._perPositionHeightExtrude=c,a._perPositionHeight=h,a._closeTop=p,a._closeBottom=m,a._shadowVolume=v,a._offsetAttribute=-1===g?void 0:g,a._arcType=_,a.packedLength=y,a},_s.computeRectangle=function(e,t){var a=Object(o.default)(e.granularity,Fe.default.RADIANS_PER_DEGREE),i=Object(o.default)(e.arcType,oo.a.GEODESIC),r=e.polygonHierarchy,n=Object(o.default)(e.ellipsoid,it.default.WGS84);return hs(r.positions,n,i,a,t)},_s.createGeometry=function(e){var t=e._vertexFormat,a=e._ellipsoid,i=e._granularity,n=e._stRotation,o=e._polygonHierarchy,l=e._perPositionHeight,u=e._closeTop,d=e._closeBottom,f=e._arcType,c=o.positions;if(!(c.length<3)){var h=Lt.default.fromPoints(c,a),p=go.default.polygonsFromHierarchy(o,h.projectPointsOntoPlane.bind(h),!l,a),m=p.hierarchy,v=p.polygons;if(0!==m.length){c=m[0].outerRing;var g,_=go.default.computeBoundingRectangle(h.plane.normal,h.projectPointOntoPlane.bind(h),c,n,Wo),y=[],b=e._height,O=e._extrudedHeight,w={perPositionHeight:l,vertexFormat:t,geometry:void 0,tangentPlane:h,boundingRectangle:_,ellipsoid:a,stRotation:n,bottom:!1,top:!0,wall:!1,extrude:!1,arcType:f};if(e._perPositionHeightExtrude||!Fe.default.equalsEpsilon(b,O,0,Fe.default.EPSILON2))for(w.extrude=!0,w.top=u,w.bottom=d,w.shadowVolume=e._shadowVolume,w.offsetAttribute=e._offsetAttribute,g=0;g<v.length;g++){var x,A=gs(a,v[g],i,m[g],l,u,d,t,f);u&&d?(x=A.topAndBottom,w.geometry=go.default.scaleToGeodeticHeightExtruded(x.geometry,b,O,a,l)):u?((x=A.topAndBottom).geometry.attributes.position.values=Ka.a.scaleToGeodeticHeight(x.geometry.attributes.position.values,b,a,!l),w.geometry=x.geometry):d&&((x=A.topAndBottom).geometry.attributes.position.values=Ka.a.scaleToGeodeticHeight(x.geometry.attributes.position.values,O,a,!0),w.geometry=x.geometry),(u||d)&&(w.wall=!1,x.geometry=ls(w),y.push(x));var j=A.walls;w.wall=!0;for(var E=0;E<j.length;E++){var C=j[E];w.geometry=go.default.scaleToGeodeticHeightExtruded(C.geometry,b,O,a,l),C.geometry=ls(w),y.push(C)}}else for(g=0;g<v.length;g++){var P=new ce.a({geometry:go.default.createGeometryFromPositions(a,v[g],i,l,t,f)});if(P.geometry.attributes.position.values=Ka.a.scaleToGeodeticHeight(P.geometry.attributes.position.values,b,a,!l),w.geometry=P.geometry,P.geometry=ls(w),Object(s.default)(e._offsetAttribute)){var T=P.geometry.attributes.position.values.length,D=new Uint8Array(T/3),I=e._offsetAttribute===he.a.NONE?0:1;Object($e.a)(D,I),P.geometry.attributes.applyOffset=new qa.a({componentDatatype:ue.a.UNSIGNED_BYTE,componentsPerAttribute:1,values:D})}y.push(P)}var S=Dr.a.combineInstances(y)[0];S.attributes.position.values=new Float64Array(S.attributes.position.values),S.indices=Ya.a.createTypedArray(S.attributes.position.values.length/3,S.indices);var M=S.attributes,R=r.default.fromVertices(M.position.values);return t.position||delete M.position,new Ga.a({attributes:M,indices:S.indices,primitiveType:S.primitiveType,boundingSphere:R,offsetAttribute:e._offsetAttribute})}}},_s.createShadowVolume=function(e,t,a){var i=e._granularity,r=e._ellipsoid,n=t(i,r),o=a(i,r);return new _s({polygonHierarchy:e._polygonHierarchy,ellipsoid:r,stRotation:e._stRotation,granularity:i,perPositionHeight:!1,extrudedHeight:n,height:o,vertexFormat:$.default.POSITION_ONLY,shadowVolume:!0,arcType:e._arcType})},Object(l.default)(_s.prototype,{rectangle:{get:function(){if(!Object(s.default)(this._rectangle)){var e=this._polygonHierarchy.positions;this._rectangle=hs(e,this._ellipsoid,this._arcType,this._granularity)}return this._rectangle}},textureCoordinateRotationPoints:{get:function(){return Object(s.default)(this._textureCoordinateRotationPoints)||(this._textureCoordinateRotationPoints=function(e){var t=-e._stRotation;if(0===t)return[0,0,0,1,1,0];var a=e._ellipsoid,i=e._polygonHierarchy.positions,r=e.rectangle;return Ga.a._textureCoordinateRotationPoints(i,t,a,r)}(this)),this._textureCoordinateRotationPoints}}});var ws=_s,xs=[],As=[];function js(e,t,a,i,r){var n,o,s=Lt.default.fromPoints(t,e).projectPointsOntoPlane(t,xs);Ka.a.computeWindingOrder2D(s)===ko.default.CLOCKWISE&&(s.reverse(),t=t.slice().reverse());var l=t.length,u=0;if(i)for(n=new Float64Array(2*l*3),o=0;o<l;o++){var d=t[o],f=t[(o+1)%l];n[u++]=d.x,n[u++]=d.y,n[u++]=d.z,n[u++]=f.x,n[u++]=f.y,n[u++]=f.z}else{var c=0;if(r===oo.a.GEODESIC)for(o=0;o<l;o++)c+=go.default.subdivideLineCount(t[o],t[(o+1)%l],a);else if(r===oo.a.RHUMB)for(o=0;o<l;o++)c+=go.default.subdivideRhumbLineCount(e,t[o],t[(o+1)%l],a);for(n=new Float64Array(3*c),o=0;o<l;o++){var h;r===oo.a.GEODESIC?h=go.default.subdivideLine(t[o],t[(o+1)%l],a,As):r===oo.a.RHUMB&&(h=go.default.subdivideRhumbLine(e,t[o],t[(o+1)%l],a,As));for(var p=h.length,m=0;m<p;++m)n[u++]=h[m]}}var v=2*(l=n.length/3),g=Ya.a.createTypedArray(l,v);for(u=0,o=0;o<l-1;o++)g[u++]=o,g[u++]=o+1;return g[u++]=l-1,g[u++]=0,new ce.a({geometry:new Ga.a({attributes:new Wa.a({position:new qa.a({componentDatatype:ue.a.DOUBLE,componentsPerAttribute:3,values:n})}),indices:g,primitiveType:Xa.a.LINES})})}function Es(e,t,a,i,r){var n,o,s=Lt.default.fromPoints(t,e).projectPointsOntoPlane(t,xs);Ka.a.computeWindingOrder2D(s)===ko.default.CLOCKWISE&&(s.reverse(),t=t.slice().reverse());var l=t.length,u=new Array(l),d=0;if(i)for(n=new Float64Array(2*l*3*2),o=0;o<l;++o){u[o]=d/3;var f=t[o],c=t[(o+1)%l];n[d++]=f.x,n[d++]=f.y,n[d++]=f.z,n[d++]=c.x,n[d++]=c.y,n[d++]=c.z}else{var h=0;if(r===oo.a.GEODESIC)for(o=0;o<l;o++)h+=go.default.subdivideLineCount(t[o],t[(o+1)%l],a);else if(r===oo.a.RHUMB)for(o=0;o<l;o++)h+=go.default.subdivideRhumbLineCount(e,t[o],t[(o+1)%l],a);for(n=new Float64Array(3*h*2),o=0;o<l;++o){var p;u[o]=d/3,r===oo.a.GEODESIC?p=go.default.subdivideLine(t[o],t[(o+1)%l],a,As):r===oo.a.RHUMB&&(p=go.default.subdivideRhumbLine(e,t[o],t[(o+1)%l],a,As));for(var m=p.length,v=0;v<m;++v)n[d++]=p[v]}}l=n.length/6;var g=u.length,_=2*(2*l+g),y=Ya.a.createTypedArray(l+g,_);for(d=0,o=0;o<l;++o)y[d++]=o,y[d++]=(o+1)%l,y[d++]=o+l,y[d++]=(o+1)%l+l;for(o=0;o<g;o++){var b=u[o];y[d++]=b,y[d++]=b+l}return new ce.a({geometry:new Ga.a({attributes:new Wa.a({position:new qa.a({componentDatatype:ue.a.DOUBLE,componentsPerAttribute:3,values:n})}),indices:y,primitiveType:Xa.a.LINES})})}function Cs(e){var t=e.polygonHierarchy,a=Object(o.default)(e.ellipsoid,it.default.WGS84),i=Object(o.default)(e.granularity,Fe.default.RADIANS_PER_DEGREE),r=Object(o.default)(e.perPositionHeight,!1),n=r&&Object(s.default)(e.extrudedHeight),l=Object(o.default)(e.arcType,oo.a.GEODESIC),u=Object(o.default)(e.height,0),d=Object(o.default)(e.extrudedHeight,u);if(!n){var f=Math.max(u,d);d=Math.min(u,d),u=f}this._ellipsoid=it.default.clone(a),this._granularity=i,this._height=u,this._extrudedHeight=d,this._arcType=l,this._polygonHierarchy=t,this._perPositionHeight=r,this._perPositionHeightExtrude=n,this._offsetAttribute=e.offsetAttribute,this._workerName="createPolygonOutlineGeometry",this.packedLength=go.default.computeHierarchyPackedLength(t)+it.default.packedLength+8}Cs.pack=function(e,t,a){return a=Object(o.default)(a,0),a=go.default.packPolygonHierarchy(e._polygonHierarchy,t,a),it.default.pack(e._ellipsoid,t,a),a+=it.default.packedLength,t[a++]=e._height,t[a++]=e._extrudedHeight,t[a++]=e._granularity,t[a++]=e._perPositionHeightExtrude?1:0,t[a++]=e._perPositionHeight?1:0,t[a++]=e._arcType,t[a++]=Object(o.default)(e._offsetAttribute,-1),t[a]=e.packedLength,t};var Ps=it.default.clone(it.default.UNIT_SPHERE),Ts={polygonHierarchy:{}};Cs.unpack=function(e,t,a){t=Object(o.default)(t,0);var i=go.default.unpackPolygonHierarchy(e,t);t=i.startingIndex,delete i.startingIndex;var r=it.default.unpack(e,t,Ps);t+=it.default.packedLength;var n=e[t++],l=e[t++],u=e[t++],d=1===e[t++],f=1===e[t++],c=e[t++],h=e[t++],p=e[t];return Object(s.default)(a)||(a=new Cs(Ts)),a._polygonHierarchy=i,a._ellipsoid=it.default.clone(r,a._ellipsoid),a._height=n,a._extrudedHeight=l,a._granularity=u,a._perPositionHeight=f,a._perPositionHeightExtrude=d,a._arcType=c,a._offsetAttribute=-1===h?void 0:h,a.packedLength=p,a},Cs.fromPositions=function(e){return new Cs({polygonHierarchy:{positions:(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).positions},height:e.height,extrudedHeight:e.extrudedHeight,ellipsoid:e.ellipsoid,granularity:e.granularity,perPositionHeight:e.perPositionHeight,arcType:e.arcType,offsetAttribute:e.offsetAttribute})},Cs.createGeometry=function(e){var t=e._ellipsoid,a=e._granularity,i=e._polygonHierarchy,n=e._perPositionHeight,o=e._arcType,l=go.default.polygonOutlinesFromHierarchy(i,!n,t);if(0!==l.length){var u,d,f,c=[],h=Fe.default.chordLength(a,t.maximumRadius),p=e._height,m=e._extrudedHeight;if(e._perPositionHeightExtrude||!Fe.default.equalsEpsilon(p,m,0,Fe.default.EPSILON2))for(f=0;f<l.length;f++){if((u=Es(t,l[f],h,n,o)).geometry=go.default.scaleToGeodeticHeightExtruded(u.geometry,p,m,t,n),Object(s.default)(e._offsetAttribute)){var v=u.geometry.attributes.position.values.length/3,g=new Uint8Array(v);e._offsetAttribute===he.a.TOP?g=Object($e.a)(g,1,0,v/2):(d=e._offsetAttribute===he.a.NONE?0:1,g=Object($e.a)(g,d)),u.geometry.attributes.applyOffset=new qa.a({componentDatatype:ue.a.UNSIGNED_BYTE,componentsPerAttribute:1,values:g})}c.push(u)}else for(f=0;f<l.length;f++){if((u=js(t,l[f],h,n,o)).geometry.attributes.position.values=Ka.a.scaleToGeodeticHeight(u.geometry.attributes.position.values,p,t,!n),Object(s.default)(e._offsetAttribute)){var _=u.geometry.attributes.position.values.length,y=new Uint8Array(_/3);d=e._offsetAttribute===he.a.NONE?0:1,Object($e.a)(y,d),u.geometry.attributes.applyOffset=new qa.a({componentDatatype:ue.a.UNSIGNED_BYTE,componentsPerAttribute:1,values:y})}c.push(u)}var b=Dr.a.combineInstances(c)[0],O=r.default.fromVertices(b.attributes.position.values);return new Ga.a({attributes:b.attributes,indices:b.indices,primitiveType:b.primitiveType,boundingSphere:O,offsetAttribute:e._offsetAttribute})}};var Ds=Cs,Is=new b.default,Ss=y.default.ZERO,Ms=new y.default,Rs=new Za.default,Ls=[],Vs=new _.default;function Ns(e){this.id=e,this.vertexFormat=void 0,this.polygonHierarchy=void 0,this.perPositionHeight=void 0,this.closeTop=void 0,this.closeBottom=void 0,this.height=void 0,this.extrudedHeight=void 0,this.granularity=void 0,this.stRotation=void 0,this.offsetAttribute=void 0,this.arcType=void 0}function Fs(e,t){Ri.call(this,{entity:e,scene:t,geometryOptions:new Ns(e),geometryPropertyName:"polygon",observedPropertyNames:["availability","polygon"]}),this._onEntityPropertyChanged(e,"polygon",e.polygon,void 0)}function Bs(e,t,a){we.call(this,e,t,a)}Object(s.default)(Object.create)&&(Fs.prototype=Object.create(Ri.prototype),Fs.prototype.constructor=Fs),Fs.prototype.createFillGeometryInstance=function(e){var t,a,i=this._entity,r=i.isAvailable(e),n=this._options,o={show:new ve.a(r&&i.isShowing&&this._showProperty.getValue(e)&&this._fillProperty.getValue(e)),distanceDisplayCondition:fe.fromDistanceDisplayCondition(this._distanceDisplayConditionProperty.getValue(e)),offset:void 0,color:void 0};this._materialProperty instanceof ge.default&&(Object(s.default)(this._materialProperty.color)&&(this._materialProperty.color.isConstant||r)&&(t=this._materialProperty.color.getValue(e,Is)),Object(s.default)(t)||(t=b.default.WHITE),o.color=le.a.fromColor(t));return Object(s.default)(n.offsetAttribute)&&(o.offset=me.a.fromCartesian3(P.default.getValueOrDefault(this._terrainOffsetProperty,e,Ss,Ms))),a=n.perPositionHeight&&!Object(s.default)(n.extrudedHeight)?new No(n):new ws(n),new ce.a({id:i,geometry:a,attributes:o})},Fs.prototype.createOutlineGeometryInstance=function(e){var t,a=this._entity,i=a.isAvailable(e),r=this._options,n=P.default.getValueOrDefault(this._outlineColorProperty,e,b.default.BLACK,Is),o=this._distanceDisplayConditionProperty.getValue(e),l={show:new ve.a(i&&a.isShowing&&this._showProperty.getValue(e)&&this._showOutlineProperty.getValue(e)),color:le.a.fromColor(n),distanceDisplayCondition:fe.fromDistanceDisplayCondition(o),offset:void 0};return Object(s.default)(r.offsetAttribute)&&(l.offset=me.a.fromCartesian3(P.default.getValueOrDefault(this._terrainOffsetProperty,e,Ss,Ms))),t=r.perPositionHeight&&!Object(s.default)(r.extrudedHeight)?new Ho(r):new Ds(r),new ce.a({id:a,geometry:t,attributes:l})},Fs.prototype._computeCenter=function(e,t){var a=P.default.getValueOrUndefined(this._entity.polygon.hierarchy,e);if(Object(s.default)(a)){var i=a.positions;if(0!==i.length){for(var r=this._scene.mapProjection.ellipsoid,n=Lt.default.fromPoints(i,r),o=n.projectPointsOntoPlane(i,Ls),l=o.length,u=0,d=l-1,f=new _.default,c=0;c<l;d=c++){var h=o[c],p=o[d],m=h.x*p.y-p.x*h.y,v=_.default.add(h,p,Vs);v=_.default.multiplyByScalar(v,m,v),f=_.default.add(f,v,f),u+=m}var g=1/(3*u);return f=_.default.multiplyByScalar(f,g,f),n.projectPointOntoEllipsoid(f,t)}}},Fs.prototype._isHidden=function(e,t){return!Object(s.default)(t.hierarchy)||Le.prototype._isHidden.call(this,e,t)},Fs.prototype._isOnTerrain=function(e,t){var a=Ri.prototype._isOnTerrain.call(this,e,t),i=t.perPositionHeight,r=Object(s.default)(i)&&(!i.isConstant||i.getValue(pe.default.MINIMUM_VALUE));return a&&!r},Fs.prototype._isDynamic=function(e,t){return!t.hierarchy.isConstant||!P.default.isConstant(t.height)||!P.default.isConstant(t.extrudedHeight)||!P.default.isConstant(t.granularity)||!P.default.isConstant(t.stRotation)||!P.default.isConstant(t.outlineWidth)||!P.default.isConstant(t.perPositionHeight)||!P.default.isConstant(t.closeTop)||!P.default.isConstant(t.closeBottom)||!P.default.isConstant(t.zIndex)||!P.default.isConstant(t.arcType)||this._onTerrain&&!P.default.isConstant(this._materialProperty)},Fs.prototype._setStaticOptions=function(e,t){var a=this._materialProperty instanceof ge.default,r=this._options;r.vertexFormat=a?re.a.VERTEX_FORMAT:ie.MaterialSupport.TEXTURED.vertexFormat;var n,o=t.hierarchy.getValue(pe.default.MINIMUM_VALUE),l=P.default.getValueOrUndefined(t.height,pe.default.MINIMUM_VALUE),u=P.default.getValueOrDefault(t.heightReference,pe.default.MINIMUM_VALUE,A.default.NONE),d=P.default.getValueOrUndefined(t.extrudedHeight,pe.default.MINIMUM_VALUE),f=P.default.getValueOrDefault(t.extrudedHeightReference,pe.default.MINIMUM_VALUE,A.default.NONE),c=P.default.getValueOrDefault(t.perPositionHeight,pe.default.MINIMUM_VALUE,!1);l=Ri.getGeometryHeight(l,u),c?(Object(s.default)(l)&&(l=void 0,Object(xe.a)("Entity polygons cannot have both height and perPositionHeight.  height will be ignored")),u!==A.default.NONE&&c&&(l=void 0,Object(xe.a)("heightReference is not supported for entity polygons with perPositionHeight. heightReference will be ignored"))):(Object(s.default)(d)&&!Object(s.default)(l)&&(l=0),n=Ri.computeGeometryOffsetAttribute(l,u,d,f)),r.polygonHierarchy=o,r.granularity=P.default.getValueOrUndefined(t.granularity,pe.default.MINIMUM_VALUE),r.stRotation=P.default.getValueOrUndefined(t.stRotation,pe.default.MINIMUM_VALUE),r.perPositionHeight=c,r.closeTop=P.default.getValueOrDefault(t.closeTop,pe.default.MINIMUM_VALUE,!0),r.closeBottom=P.default.getValueOrDefault(t.closeBottom,pe.default.MINIMUM_VALUE,!0),r.offsetAttribute=n,r.height=l,r.arcType=P.default.getValueOrDefault(t.arcType,pe.default.MINIMUM_VALUE,oo.a.GEODESIC),(d=Ri.getGeometryExtrudedHeight(d,f))===Ri.CLAMP_TO_GROUND&&(d=i.a.getMinimumMaximumHeights(ws.computeRectangle(r,Rs)).minimumTerrainHeight),r.extrudedHeight=d},Fs.prototype._getIsClosed=function(e){var t=e.height,a=e.extrudedHeight,i=Object(s.default)(a)&&a!==t;return!e.perPositionHeight&&(!i&&0===t||i&&e.closeTop&&e.closeBottom)},Fs.DynamicGeometryUpdater=Bs,Object(s.default)(Object.create)&&(Bs.prototype=Object.create(we.prototype),Bs.prototype.constructor=Bs),Bs.prototype._isHidden=function(e,t,a){return!Object(s.default)(this._options.polygonHierarchy)||we.prototype._isHidden.call(this,e,t,a)},Bs.prototype._setOptions=function(e,t,a){var r=this._options;r.polygonHierarchy=P.default.getValueOrUndefined(t.hierarchy,a);var n,o=P.default.getValueOrUndefined(t.height,a),l=P.default.getValueOrDefault(t.heightReference,a,A.default.NONE),u=P.default.getValueOrDefault(t.extrudedHeightReference,a,A.default.NONE),d=P.default.getValueOrUndefined(t.extrudedHeight,a),f=P.default.getValueOrUndefined(t.perPositionHeight,a);o=Ri.getGeometryHeight(o,u),f?(Object(s.default)(o)&&(o=void 0,Object(xe.a)("Entity polygons cannot have both height and perPositionHeight.  height will be ignored")),l!==A.default.NONE&&f&&(o=void 0,Object(xe.a)("heightReference is not supported for entity polygons with perPositionHeight. heightReference will be ignored"))):(Object(s.default)(d)&&!Object(s.default)(o)&&(o=0),n=Ri.computeGeometryOffsetAttribute(o,l,d,u)),r.granularity=P.default.getValueOrUndefined(t.granularity,a),r.stRotation=P.default.getValueOrUndefined(t.stRotation,a),r.perPositionHeight=P.default.getValueOrUndefined(t.perPositionHeight,a),r.closeTop=P.default.getValueOrDefault(t.closeTop,a,!0),r.closeBottom=P.default.getValueOrDefault(t.closeBottom,a,!0),r.offsetAttribute=n,r.height=o,r.arcType=P.default.getValueOrDefault(t.arcType,a,oo.a.GEODESIC),(d=Ri.getGeometryExtrudedHeight(d,u))===Ri.CLAMP_TO_GROUND&&(d=i.a.getMinimumMaximumHeights(ws.computeRectangle(r,Rs)).minimumTerrainHeight),r.extrudedHeight=d};var Us=Fs;function Hs(e){var t=(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).polylinePositions,a=e.shapePositions;this._positions=t,this._shape=a,this._ellipsoid=it.default.clone(Object(o.default)(e.ellipsoid,it.default.WGS84)),this._cornerType=Object(o.default)(e.cornerType,tt.a.ROUNDED),this._vertexFormat=$.default.clone(Object(o.default)(e.vertexFormat,$.default.DEFAULT)),this._granularity=Object(o.default)(e.granularity,Fe.default.RADIANS_PER_DEGREE),this._workerName="createPolylineVolumeGeometry";var i=1+t.length*y.default.packedLength;i+=1+a.length*_.default.packedLength,this.packedLength=i+it.default.packedLength+$.default.packedLength+2}Hs.pack=function(e,t,a){var i;a=Object(o.default)(a,0);var r=e._positions,n=r.length;for(t[a++]=n,i=0;i<n;++i,a+=y.default.packedLength)y.default.pack(r[i],t,a);var s=e._shape;for(n=s.length,t[a++]=n,i=0;i<n;++i,a+=_.default.packedLength)_.default.pack(s[i],t,a);return it.default.pack(e._ellipsoid,t,a),a+=it.default.packedLength,$.default.pack(e._vertexFormat,t,a),a+=$.default.packedLength,t[a++]=e._cornerType,t[a]=e._granularity,t};var ks=it.default.clone(it.default.UNIT_SPHERE),zs=new $.default,Gs={polylinePositions:void 0,shapePositions:void 0,ellipsoid:ks,vertexFormat:zs,cornerType:void 0,granularity:void 0};Hs.unpack=function(e,t,a){var i;t=Object(o.default)(t,0);var r=e[t++],n=new Array(r);for(i=0;i<r;++i,t+=y.default.packedLength)n[i]=y.default.unpack(e,t);r=e[t++];var l=new Array(r);for(i=0;i<r;++i,t+=_.default.packedLength)l[i]=_.default.unpack(e,t);var u=it.default.unpack(e,t,ks);t+=it.default.packedLength;var d=$.default.unpack(e,t,zs);t+=$.default.packedLength;var f=e[t++],c=e[t];return Object(s.default)(a)?(a._positions=n,a._shape=l,a._ellipsoid=it.default.clone(u,a._ellipsoid),a._vertexFormat=$.default.clone(d,a._vertexFormat),a._cornerType=f,a._granularity=c,a):(Gs.polylinePositions=n,Gs.shapePositions=l,Gs.cornerType=f,Gs.granularity=c,new Hs(Gs))};var qs=new g.default;Hs.createGeometry=function(e){var t=e._positions,a=Object(et.a)(t,y.default.equalsEpsilon),i=e._shape;if(i=ya.removeDuplicatesFromShape(i),!(a.length<2||i.length<3)){Ka.a.computeWindingOrder2D(i)===ko.default.CLOCKWISE&&i.reverse();var n=g.default.fromPoints(i,qs);return function(e,t,a,i){var n=new Wa.a;i.position&&(n.position=new qa.a({componentDatatype:ue.a.DOUBLE,componentsPerAttribute:3,values:e}));var o,s,l,u,d,f,c=t.length,h=e.length/3,p=(h-2*c)/(2*c),m=Ka.a.triangulate(t),v=(p-1)*c*6+2*m.length,g=Ya.a.createTypedArray(h,v),_=2*c,y=0;for(o=0;o<p-1;o++){for(s=0;s<c-1;s++)f=(l=2*s+o*c*2)+_,d=(u=l+1)+_,g[y++]=u,g[y++]=l,g[y++]=d,g[y++]=d,g[y++]=l,g[y++]=f;d=(u=(l=2*c-2+o*c*2)+1)+_,f=l+_,g[y++]=u,g[y++]=l,g[y++]=d,g[y++]=d,g[y++]=l,g[y++]=f}if(i.st||i.tangent||i.bitangent){var b,O,w=new Float32Array(2*h),x=1/(p-1),A=1/a.height,j=a.height/2,E=0;for(o=0;o<p;o++){for(b=o*x,O=A*(t[0].y+j),w[E++]=b,w[E++]=O,s=1;s<c;s++)O=A*(t[s].y+j),w[E++]=b,w[E++]=O,w[E++]=b,w[E++]=O;O=A*(t[0].y+j),w[E++]=b,w[E++]=O}for(s=0;s<c;s++)b=0,O=A*(t[s].y+j),w[E++]=b,w[E++]=O;for(s=0;s<c;s++)b=(p-1)*x,O=A*(t[s].y+j),w[E++]=b,w[E++]=O;n.st=new qa.a({componentDatatype:ue.a.FLOAT,componentsPerAttribute:2,values:new Float32Array(w)})}var C=h-2*c;for(o=0;o<m.length;o+=3){var P=m[o]+C,T=m[o+1]+C,D=m[o+2]+C;g[y++]=P,g[y++]=T,g[y++]=D,g[y++]=D+c,g[y++]=T+c,g[y++]=P+c}var I=new Ga.a({attributes:n,indices:g,boundingSphere:r.default.fromVertices(e),primitiveType:Xa.a.TRIANGLES});if(i.normal&&(I=Dr.a.computeNormal(I)),i.tangent||i.bitangent){try{I=Dr.a.computeTangentAndBitangent(I)}catch(e){Object(xe.a)("polyline-volume-tangent-bitangent","Unable to compute tangents and bitangents for polyline volume geometry")}i.tangent||(I.attributes.tangent=void 0),i.bitangent||(I.attributes.bitangent=void 0),i.st||(I.attributes.st=void 0)}return I}(ya.computePositions(a,i,n,e,!0),i,n,e._vertexFormat)}};var Ws=Hs;function Ys(e){var t=(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).polylinePositions,a=e.shapePositions;this._positions=t,this._shape=a,this._ellipsoid=it.default.clone(Object(o.default)(e.ellipsoid,it.default.WGS84)),this._cornerType=Object(o.default)(e.cornerType,tt.a.ROUNDED),this._granularity=Object(o.default)(e.granularity,Fe.default.RADIANS_PER_DEGREE),this._workerName="createPolylineVolumeOutlineGeometry";var i=1+t.length*y.default.packedLength;i+=1+a.length*_.default.packedLength,this.packedLength=i+it.default.packedLength+2}Ys.pack=function(e,t,a){var i;a=Object(o.default)(a,0);var r=e._positions,n=r.length;for(t[a++]=n,i=0;i<n;++i,a+=y.default.packedLength)y.default.pack(r[i],t,a);var s=e._shape;for(n=s.length,t[a++]=n,i=0;i<n;++i,a+=_.default.packedLength)_.default.pack(s[i],t,a);return it.default.pack(e._ellipsoid,t,a),a+=it.default.packedLength,t[a++]=e._cornerType,t[a]=e._granularity,t};var Ks=it.default.clone(it.default.UNIT_SPHERE),Xs={polylinePositions:void 0,shapePositions:void 0,ellipsoid:Ks,height:void 0,cornerType:void 0,granularity:void 0};Ys.unpack=function(e,t,a){var i;t=Object(o.default)(t,0);var r=e[t++],n=new Array(r);for(i=0;i<r;++i,t+=y.default.packedLength)n[i]=y.default.unpack(e,t);r=e[t++];var l=new Array(r);for(i=0;i<r;++i,t+=_.default.packedLength)l[i]=_.default.unpack(e,t);var u=it.default.unpack(e,t,Ks);t+=it.default.packedLength;var d=e[t++],f=e[t];return Object(s.default)(a)?(a._positions=n,a._shape=l,a._ellipsoid=it.default.clone(u,a._ellipsoid),a._cornerType=d,a._granularity=f,a):(Xs.polylinePositions=n,Xs.shapePositions=l,Xs.cornerType=d,Xs.granularity=f,new Ys(Xs))};var Zs=new g.default;Ys.createGeometry=function(e){var t=e._positions,a=Object(et.a)(t,y.default.equalsEpsilon),i=e._shape;if(i=ya.removeDuplicatesFromShape(i),!(a.length<2||i.length<3)){Ka.a.computeWindingOrder2D(i)===ko.default.CLOCKWISE&&i.reverse();var n=g.default.fromPoints(i,Zs);return function(e,t){var a=new Wa.a;a.position=new qa.a({componentDatatype:ue.a.DOUBLE,componentsPerAttribute:3,values:e});var i,n,o=t.length,s=a.position.values.length/3,l=e.length/3/o,u=Ya.a.createTypedArray(s,2*o*(l+1)),d=0,f=(i=0)*o;for(n=0;n<o-1;n++)u[d++]=n+f,u[d++]=n+f+1;for(u[d++]=o-1+f,u[d++]=f,f=(i=l-1)*o,n=0;n<o-1;n++)u[d++]=n+f,u[d++]=n+f+1;for(u[d++]=o-1+f,u[d++]=f,i=0;i<l-1;i++){var c=o*i,h=c+o;for(n=0;n<o;n++)u[d++]=n+c,u[d++]=n+h}return new Ga.a({attributes:a,indices:Ya.a.createTypedArray(s,u),boundingSphere:r.default.fromVertices(e),primitiveType:Xa.a.LINES})}(ya.computePositions(a,i,n,e,!1),i)}};var Js=Ys,Qs=new b.default;function $s(e){this.id=e,this.vertexFormat=void 0,this.polylinePositions=void 0,this.shapePositions=void 0,this.cornerType=void 0,this.granularity=void 0}function el(e,t){Le.call(this,{entity:e,scene:t,geometryOptions:new $s(e),geometryPropertyName:"polylineVolume",observedPropertyNames:["availability","polylineVolume"]}),this._onEntityPropertyChanged(e,"polylineVolume",e.polylineVolume,void 0)}function tl(e,t,a){we.call(this,e,t,a)}Object(s.default)(Object.create)&&(el.prototype=Object.create(Le.prototype),el.prototype.constructor=el),el.prototype.createFillGeometryInstance=function(e){var t,a,i=this._entity,r=i.isAvailable(e),n=new ve.a(r&&i.isShowing&&this._showProperty.getValue(e)&&this._fillProperty.getValue(e)),o=this._distanceDisplayConditionProperty.getValue(e),l=fe.fromDistanceDisplayCondition(o);this._materialProperty instanceof ge.default?(Object(s.default)(this._materialProperty.color)&&(this._materialProperty.color.isConstant||r)&&(a=this._materialProperty.color.getValue(e,Qs)),Object(s.default)(a)||(a=b.default.WHITE),t={show:n,distanceDisplayCondition:l,color:le.a.fromColor(a)}):t={show:n,distanceDisplayCondition:l};return new ce.a({id:i,geometry:new Ws(this._options),attributes:t})},el.prototype.createOutlineGeometryInstance=function(e){var t=this._entity,a=t.isAvailable(e),i=P.default.getValueOrDefault(this._outlineColorProperty,e,b.default.BLACK,Qs),r=this._distanceDisplayConditionProperty.getValue(e);return new ce.a({id:t,geometry:new Js(this._options),attributes:{show:new ve.a(a&&t.isShowing&&this._showProperty.getValue(e)&&this._showOutlineProperty.getValue(e)),color:le.a.fromColor(i),distanceDisplayCondition:fe.fromDistanceDisplayCondition(r)}})},el.prototype._isHidden=function(e,t){return!Object(s.default)(t.positions)||!Object(s.default)(t.shape)||Le.prototype._isHidden.call(this,e,t)},el.prototype._isDynamic=function(e,t){return!(t.positions.isConstant&&t.shape.isConstant&&P.default.isConstant(t.granularity)&&P.default.isConstant(t.outlineWidth)&&P.default.isConstant(t.cornerType))},el.prototype._setStaticOptions=function(e,t){var a=t.granularity,i=t.cornerType,r=this._options,n=this._materialProperty instanceof ge.default;r.vertexFormat=n?re.a.VERTEX_FORMAT:ie.MaterialSupport.TEXTURED.vertexFormat,r.polylinePositions=t.positions.getValue(pe.default.MINIMUM_VALUE,r.polylinePositions),r.shapePositions=t.shape.getValue(pe.default.MINIMUM_VALUE,r.shape),r.granularity=Object(s.default)(a)?a.getValue(pe.default.MINIMUM_VALUE):void 0,r.cornerType=Object(s.default)(i)?i.getValue(pe.default.MINIMUM_VALUE):void 0},el.DynamicGeometryUpdater=tl,Object(s.default)(Object.create)&&(tl.prototype=Object.create(we.prototype),tl.prototype.constructor=tl),tl.prototype._isHidden=function(e,t,a){var i=this._options;return!Object(s.default)(i.polylinePositions)||!Object(s.default)(i.shapePositions)||we.prototype._isHidden.call(this,e,t,a)},tl.prototype._setOptions=function(e,t,a){var i=this._options;i.polylinePositions=P.default.getValueOrUndefined(t.positions,a,i.polylinePositions),i.shapePositions=P.default.getValueOrUndefined(t.shape,a),i.granularity=P.default.getValueOrUndefined(t.granularity,a),i.cornerType=P.default.getValueOrUndefined(t.cornerType,a)};var al=el,il=a(134),rl=a(265),nl=new y.default,ol=new y.default,sl=new y.default,ll=new y.default,ul=new Za.default,dl=new _.default,fl=new r.default,cl=new r.default;function hl(e,t){var a=new Ga.a({attributes:new Wa.a,primitiveType:Xa.a.TRIANGLES});return a.attributes.position=new qa.a({componentDatatype:ue.a.DOUBLE,componentsPerAttribute:3,values:t.positions}),e.normal&&(a.attributes.normal=new qa.a({componentDatatype:ue.a.FLOAT,componentsPerAttribute:3,values:t.normals})),e.tangent&&(a.attributes.tangent=new qa.a({componentDatatype:ue.a.FLOAT,componentsPerAttribute:3,values:t.tangents})),e.bitangent&&(a.attributes.bitangent=new qa.a({componentDatatype:ue.a.FLOAT,componentsPerAttribute:3,values:t.bitangents})),a}var pl=new y.default,ml=new y.default;function vl(e,t){var a=e._vertexFormat,i=e._ellipsoid,r=t.height,n=t.width,o=t.northCap,s=t.southCap,l=0,u=r,d=r,f=0;o&&(l=1,d-=1,f+=1),s&&(u-=1,d-=1,f+=1),f+=n*d;for(var c=a.position?new Float64Array(3*f):void 0,h=a.st?new Float32Array(2*f):void 0,p=0,m=0,v=nl,g=dl,_=Number.MAX_VALUE,b=Number.MAX_VALUE,O=-Number.MAX_VALUE,w=-Number.MAX_VALUE,x=l;x<u;++x)for(var A=0;A<n;++A)rl.a.computePosition(t,i,a.st,x,A,v,g),c[p++]=v.x,c[p++]=v.y,c[p++]=v.z,a.st&&(h[m++]=g.x,h[m++]=g.y,_=Math.min(_,g.x),b=Math.min(b,g.y),O=Math.max(O,g.x),w=Math.max(w,g.y));if(o&&(rl.a.computePosition(t,i,a.st,0,0,v,g),c[p++]=v.x,c[p++]=v.y,c[p++]=v.z,a.st&&(h[m++]=g.x,h[m++]=g.y,_=g.x,b=g.y,O=g.x,w=g.y)),s&&(rl.a.computePosition(t,i,a.st,r-1,0,v,g),c[p++]=v.x,c[p++]=v.y,c[p]=v.z,a.st&&(h[m++]=g.x,h[m]=g.y,_=Math.min(_,g.x),b=Math.min(b,g.y),O=Math.max(O,g.x),w=Math.max(w,g.y))),a.st&&(_<0||b<0||O>1||w>1))for(var j=0;j<h.length;j+=2)h[j]=(h[j]-_)/(O-_),h[j+1]=(h[j+1]-b)/(w-b);var E=function(e,t,a,i){var r=e.length,n=t.normal?new Float32Array(r):void 0,o=t.tangent?new Float32Array(r):void 0,s=t.bitangent?new Float32Array(r):void 0,l=0,u=ll,d=sl,f=ol;if(t.normal||t.tangent||t.bitangent)for(var c=0;c<r;c+=3){var h=y.default.fromArray(e,c,nl),p=l+1,m=l+2;f=a.geodeticSurfaceNormal(h,f),(t.tangent||t.bitangent)&&(y.default.cross(y.default.UNIT_Z,f,d),at.default.multiplyByVector(i,d,d),y.default.normalize(d,d),t.bitangent&&y.default.normalize(y.default.cross(f,d,u),u)),t.normal&&(n[l]=f.x,n[p]=f.y,n[m]=f.z),t.tangent&&(o[l]=d.x,o[p]=d.y,o[m]=d.z),t.bitangent&&(s[l]=u.x,s[p]=u.y,s[m]=u.z),l+=3}return hl(t,{positions:e,normals:n,tangents:o,bitangents:s})}(c,a,i,t.tangentRotationMatrix),C=6*(n-1)*(d-1);o&&(C+=3*(n-1)),s&&(C+=3*(n-1));var P,T=Ya.a.createTypedArray(f,C),D=0,I=0;for(P=0;P<d-1;++P){for(var S=0;S<n-1;++S){var M=D,R=M+n,L=R+1,V=M+1;T[I++]=M,T[I++]=R,T[I++]=V,T[I++]=V,T[I++]=R,T[I++]=L,++D}++D}if(o||s){var N,F,B=f-1,U=f-1;if(o&&s&&(B=f-2),D=0,o)for(P=0;P<n-1;P++)F=(N=D)+1,T[I++]=B,T[I++]=N,T[I++]=F,++D;if(s)for(D=(d-1)*n,P=0;P<n-1;P++)F=(N=D)+1,T[I++]=N,T[I++]=U,T[I++]=F,++D}return E.indices=T,a.st&&(E.attributes.st=new qa.a({componentDatatype:ue.a.FLOAT,componentsPerAttribute:2,values:h})),E}function gl(e,t,a,i,r){return e[t++]=i[a],e[t++]=i[a+1],e[t++]=i[a+2],e[t++]=r[a],e[t++]=r[a+1],e[t]=r[a+2],e}function _l(e,t,a,i){return e[t++]=i[a],e[t++]=i[a+1],e[t++]=i[a],e[t]=i[a+1],e}var yl=new $.default;function bl(e,t){var a,i=e._shadowVolume,r=e._offsetAttribute,n=e._vertexFormat,o=e._extrudedHeight,l=e._surfaceHeight,u=e._ellipsoid,d=t.height,f=t.width;if(i){var c=$.default.clone(n,yl);c.normal=!0,e._vertexFormat=c}var h=vl(e,t);i&&(e._vertexFormat=n);var p=Ka.a.scaleToGeodeticHeight(h.attributes.position.values,l,u,!1),m=(p=new Float64Array(p)).length,v=2*m,g=new Float64Array(v);g.set(p);var _=Ka.a.scaleToGeodeticHeight(h.attributes.position.values,o,u);g.set(_,m),h.attributes.position.values=g;var b,O,w,x=n.normal?new Float32Array(v):void 0,A=n.tangent?new Float32Array(v):void 0,j=n.bitangent?new Float32Array(v):void 0,E=n.st?new Float32Array(v/3*2):void 0;if(n.normal){for(O=h.attributes.normal.values,x.set(O),a=0;a<m;a++)O[a]=-O[a];x.set(O,m),h.attributes.normal.values=x}if(i){O=h.attributes.normal.values,n.normal||(h.attributes.normal=void 0);var C=new Float32Array(v);for(a=0;a<m;a++)O[a]=-O[a];C.set(O,m),h.attributes.extrudeDirection=new qa.a({componentDatatype:ue.a.FLOAT,componentsPerAttribute:3,values:C})}var P=Object(s.default)(r);if(P){var T=m/3*2,D=new Uint8Array(T);r===he.a.TOP?D=Object($e.a)(D,1,0,T/2):(w=r===he.a.NONE?0:1,D=Object($e.a)(D,w)),h.attributes.applyOffset=new qa.a({componentDatatype:ue.a.UNSIGNED_BYTE,componentsPerAttribute:1,values:D})}if(n.tangent){var I=h.attributes.tangent.values;for(A.set(I),a=0;a<m;a++)I[a]=-I[a];A.set(I,m),h.attributes.tangent.values=A}if(n.bitangent){var S=h.attributes.bitangent.values;j.set(S),j.set(S,m),h.attributes.bitangent.values=j}n.st&&(b=h.attributes.st.values,E.set(b),E.set(b,m/3*2),h.attributes.st.values=E);var M=h.indices,R=M.length,L=m/3,V=Ya.a.createTypedArray(v/3,2*R);for(V.set(M),a=0;a<R;a+=3)V[a+R]=M[a+2]+L,V[a+1+R]=M[a+1]+L,V[a+2+R]=M[a]+L;h.indices=V;var N=t.northCap,F=t.southCap,B=d,U=2,H=0,k=4,z=4;N&&(U-=1,B-=1,H+=1,k-=2,z-=1),F&&(U-=1,B-=1,H+=1,k-=2,z-=1);var G=2*((H+=U*f+2*B-k)+z),q=new Float64Array(3*G),W=i?new Float32Array(3*G):void 0,Y=P?new Uint8Array(G):void 0,K=n.st?new Float32Array(2*G):void 0,X=r===he.a.TOP;P&&!X&&(w=r===he.a.ALL?1:0,Y=Object($e.a)(Y,w));var Z,J=0,Q=0,ee=0,te=0,ae=f*B;for(a=0;a<ae;a+=f)q=gl(q,J,Z=3*a,p,_),J+=6,n.st&&(K=_l(K,Q,2*a,b),Q+=4),i&&(ee+=3,W[ee++]=O[Z],W[ee++]=O[Z+1],W[ee++]=O[Z+2]),X&&(Y[te++]=1,te+=1);if(F){var ie=N?ae+1:ae;for(Z=3*ie,a=0;a<2;a++)q=gl(q,J,Z,p,_),J+=6,n.st&&(K=_l(K,Q,2*ie,b),Q+=4),i&&(ee+=3,W[ee++]=O[Z],W[ee++]=O[Z+1],W[ee++]=O[Z+2]),X&&(Y[te++]=1,te+=1)}else for(a=ae-f;a<ae;a++)q=gl(q,J,Z=3*a,p,_),J+=6,n.st&&(K=_l(K,Q,2*a,b),Q+=4),i&&(ee+=3,W[ee++]=O[Z],W[ee++]=O[Z+1],W[ee++]=O[Z+2]),X&&(Y[te++]=1,te+=1);for(a=ae-1;a>0;a-=f)q=gl(q,J,Z=3*a,p,_),J+=6,n.st&&(K=_l(K,Q,2*a,b),Q+=4),i&&(ee+=3,W[ee++]=O[Z],W[ee++]=O[Z+1],W[ee++]=O[Z+2]),X&&(Y[te++]=1,te+=1);if(N){var re=ae;for(Z=3*re,a=0;a<2;a++)q=gl(q,J,Z,p,_),J+=6,n.st&&(K=_l(K,Q,2*re,b),Q+=4),i&&(ee+=3,W[ee++]=O[Z],W[ee++]=O[Z+1],W[ee++]=O[Z+2]),X&&(Y[te++]=1,te+=1)}else for(a=f-1;a>=0;a--)q=gl(q,J,Z=3*a,p,_),J+=6,n.st&&(K=_l(K,Q,2*a,b),Q+=4),i&&(ee+=3,W[ee++]=O[Z],W[ee++]=O[Z+1],W[ee++]=O[Z+2]),X&&(Y[te++]=1,te+=1);var ne=function(e,t,a){var i=e.length,r=t.normal?new Float32Array(i):void 0,n=t.tangent?new Float32Array(i):void 0,o=t.bitangent?new Float32Array(i):void 0,s=0,l=0,u=0,d=!0,f=ll,c=sl,h=ol;if(t.normal||t.tangent||t.bitangent)for(var p=0;p<i;p+=6){var m=y.default.fromArray(e,p,nl),v=y.default.fromArray(e,(p+6)%i,pl);if(d){var g=y.default.fromArray(e,(p+3)%i,ml);y.default.subtract(v,m,v),y.default.subtract(g,m,g),h=y.default.normalize(y.default.cross(g,v,h),h),d=!1}y.default.equalsEpsilon(v,m,Fe.default.EPSILON10)&&(d=!0),(t.tangent||t.bitangent)&&(f=a.geodeticSurfaceNormal(m,f),t.tangent&&(c=y.default.normalize(y.default.cross(f,h,c),c))),t.normal&&(r[s++]=h.x,r[s++]=h.y,r[s++]=h.z,r[s++]=h.x,r[s++]=h.y,r[s++]=h.z),t.tangent&&(n[l++]=c.x,n[l++]=c.y,n[l++]=c.z,n[l++]=c.x,n[l++]=c.y,n[l++]=c.z),t.bitangent&&(o[u++]=f.x,o[u++]=f.y,o[u++]=f.z,o[u++]=f.x,o[u++]=f.y,o[u++]=f.z)}return hl(t,{positions:e,normals:r,tangents:n,bitangents:o})}(q,n,u);n.st&&(ne.attributes.st=new qa.a({componentDatatype:ue.a.FLOAT,componentsPerAttribute:2,values:K})),i&&(ne.attributes.extrudeDirection=new qa.a({componentDatatype:ue.a.FLOAT,componentsPerAttribute:3,values:W})),P&&(ne.attributes.applyOffset=new qa.a({componentDatatype:ue.a.UNSIGNED_BYTE,componentsPerAttribute:1,values:Y}));var oe,se,le,de,fe=Ya.a.createTypedArray(G,6*H);m=q.length/3;var pe=0;for(a=0;a<m-1;a+=2){de=((oe=a)+2)%m;var me=y.default.fromArray(q,3*oe,pl),ve=y.default.fromArray(q,3*de,ml);y.default.equalsEpsilon(me,ve,Fe.default.EPSILON10)||(le=((se=(oe+1)%m)+2)%m,fe[pe++]=oe,fe[pe++]=se,fe[pe++]=de,fe[pe++]=de,fe[pe++]=se,fe[pe++]=le)}return ne.indices=fe,(ne=Dr.a.combineInstances([new ce.a({geometry:h}),new ce.a({geometry:ne})]))[0]}var Ol=[new y.default,new y.default,new y.default,new y.default],wl=new Ne.default,xl=new Ne.default;function Al(e,t,a,i,r){if(0===a)return Za.default.clone(e,r);var n=rl.a.computeOptions(e,t,a,0,ul,wl),o=n.height,s=n.width,l=Ol;return rl.a.computePosition(n,i,!1,0,0,l[0]),rl.a.computePosition(n,i,!1,0,s-1,l[1]),rl.a.computePosition(n,i,!1,o-1,0,l[2]),rl.a.computePosition(n,i,!1,o-1,s-1,l[3]),Za.default.fromCartesianArray(l,i,r)}function jl(e){var t=(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).rectangle,a=Object(o.default)(e.height,0),i=Object(o.default)(e.extrudedHeight,a);this._rectangle=Za.default.clone(t),this._granularity=Object(o.default)(e.granularity,Fe.default.RADIANS_PER_DEGREE),this._ellipsoid=it.default.clone(Object(o.default)(e.ellipsoid,it.default.WGS84)),this._surfaceHeight=Math.max(a,i),this._rotation=Object(o.default)(e.rotation,0),this._stRotation=Object(o.default)(e.stRotation,0),this._vertexFormat=$.default.clone(Object(o.default)(e.vertexFormat,$.default.DEFAULT)),this._extrudedHeight=Math.min(a,i),this._shadowVolume=Object(o.default)(e.shadowVolume,!1),this._workerName="createRectangleGeometry",this._offsetAttribute=e.offsetAttribute,this._rotatedRectangle=void 0,this._textureCoordinateRotationPoints=void 0}jl.packedLength=Za.default.packedLength+it.default.packedLength+$.default.packedLength+7,jl.pack=function(e,t,a){return a=Object(o.default)(a,0),Za.default.pack(e._rectangle,t,a),a+=Za.default.packedLength,it.default.pack(e._ellipsoid,t,a),a+=it.default.packedLength,$.default.pack(e._vertexFormat,t,a),a+=$.default.packedLength,t[a++]=e._granularity,t[a++]=e._surfaceHeight,t[a++]=e._rotation,t[a++]=e._stRotation,t[a++]=e._extrudedHeight,t[a++]=e._shadowVolume?1:0,t[a]=Object(o.default)(e._offsetAttribute,-1),t};var El=new Za.default,Cl=it.default.clone(it.default.UNIT_SPHERE),Pl={rectangle:El,ellipsoid:Cl,vertexFormat:yl,granularity:void 0,height:void 0,rotation:void 0,stRotation:void 0,extrudedHeight:void 0,shadowVolume:void 0,offsetAttribute:void 0};jl.unpack=function(e,t,a){t=Object(o.default)(t,0);var i=Za.default.unpack(e,t,El);t+=Za.default.packedLength;var r=it.default.unpack(e,t,Cl);t+=it.default.packedLength;var n=$.default.unpack(e,t,yl);t+=$.default.packedLength;var l=e[t++],u=e[t++],d=e[t++],f=e[t++],c=e[t++],h=1===e[t++],p=e[t];return Object(s.default)(a)?(a._rectangle=Za.default.clone(i,a._rectangle),a._ellipsoid=it.default.clone(r,a._ellipsoid),a._vertexFormat=$.default.clone(n,a._vertexFormat),a._granularity=l,a._surfaceHeight=u,a._rotation=d,a._stRotation=f,a._extrudedHeight=c,a._shadowVolume=h,a._offsetAttribute=-1===p?void 0:p,a):(Pl.granularity=l,Pl.height=u,Pl.rotation=d,Pl.stRotation=f,Pl.extrudedHeight=c,Pl.shadowVolume=h,Pl.offsetAttribute=-1===p?void 0:p,new jl(Pl))},jl.computeRectangle=function(e,t){var a=(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).rectangle,i=Object(o.default)(e.granularity,Fe.default.RADIANS_PER_DEGREE),r=Object(o.default)(e.ellipsoid,it.default.WGS84);return Al(a,i,Object(o.default)(e.rotation,0),r,t)};var Tl=new at.default,Dl=new Vt.default,Il=new Ne.default;jl.createGeometry=function(e){if(!Fe.default.equalsEpsilon(e._rectangle.north,e._rectangle.south,Fe.default.EPSILON10)&&!Fe.default.equalsEpsilon(e._rectangle.east,e._rectangle.west,Fe.default.EPSILON10)){var t=e._rectangle,a=e._ellipsoid,i=e._rotation,n=e._stRotation,o=e._vertexFormat,l=rl.a.computeOptions(t,e._granularity,i,n,ul,wl,xl),u=Tl;if(0!==n||0!==i){var d=Za.default.center(t,Il),f=a.geodeticSurfaceNormalCartographic(d,pl);Vt.default.fromAxisAngle(f,-n,Dl),at.default.fromQuaternion(Dl,u)}else at.default.clone(at.default.IDENTITY,u);var c,h,p=e._surfaceHeight,m=e._extrudedHeight,v=!Fe.default.equalsEpsilon(p,m,0,Fe.default.EPSILON2);if(l.lonScalar=1/e._rectangle.width,l.latScalar=1/e._rectangle.height,l.tangentRotationMatrix=u,t=e._rectangle,v){c=bl(e,l);var g=r.default.fromRectangle3D(t,a,p,cl),_=r.default.fromRectangle3D(t,a,m,fl);h=r.default.union(g,_)}else{if((c=vl(e,l)).attributes.position.values=Ka.a.scaleToGeodeticHeight(c.attributes.position.values,p,a,!1),Object(s.default)(e._offsetAttribute)){var y=c.attributes.position.values.length,b=new Uint8Array(y/3),O=e._offsetAttribute===he.a.NONE?0:1;Object($e.a)(b,O),c.attributes.applyOffset=new qa.a({componentDatatype:ue.a.UNSIGNED_BYTE,componentsPerAttribute:1,values:b})}h=r.default.fromRectangle3D(t,a,p)}return o.position||delete c.attributes.position,new Ga.a({attributes:c.attributes,indices:c.indices,primitiveType:c.primitiveType,boundingSphere:h,offsetAttribute:e._offsetAttribute})}},jl.createShadowVolume=function(e,t,a){var i=e._granularity,r=e._ellipsoid,n=t(i,r),o=a(i,r);return new jl({rectangle:e._rectangle,rotation:e._rotation,ellipsoid:r,stRotation:e._stRotation,granularity:i,extrudedHeight:o,height:n,vertexFormat:$.default.POSITION_ONLY,shadowVolume:!0})};var Sl=new Za.default,Ml=[new _.default,new _.default,new _.default],Rl=new il.a,Ll=new Ne.default;Object(l.default)(jl.prototype,{rectangle:{get:function(){return Object(s.default)(this._rotatedRectangle)||(this._rotatedRectangle=Al(this._rectangle,this._granularity,this._rotation,this._ellipsoid)),this._rotatedRectangle}},textureCoordinateRotationPoints:{get:function(){return Object(s.default)(this._textureCoordinateRotationPoints)||(this._textureCoordinateRotationPoints=function(e){if(0===e._stRotation)return[0,0,0,1,1,0];var t=Za.default.clone(e._rectangle,Sl),a=e._granularity,i=e._ellipsoid,r=Al(t,a,e._rotation-e._stRotation,i,Sl),n=Ml;n[0].x=r.west,n[0].y=r.south,n[1].x=r.west,n[1].y=r.north,n[2].x=r.east,n[2].y=r.south;for(var o=e.rectangle,s=il.a.fromRotation(e._stRotation,Rl),l=Za.default.center(o,Ll),u=0;u<3;++u){var d=n[u];d.x-=l.longitude,d.y-=l.latitude,il.a.multiplyByVector(s,d,d),d.x+=l.longitude,d.y+=l.latitude,d.x=(d.x-o.west)/o.width,d.y=(d.y-o.south)/o.height}var f=n[0],c=n[1],h=n[2],p=new Array(6);return _.default.pack(f,p),_.default.pack(c,p,2),_.default.pack(h,p,4),p}(this)),this._textureCoordinateRotationPoints}}});var Vl=jl,Nl=a(609),Fl=new b.default,Bl=y.default.ZERO,Ul=new y.default,Hl=new Za.default,kl=new Za.default,zl=new Ne.default;function Gl(e){this.id=e,this.vertexFormat=void 0,this.rectangle=void 0,this.height=void 0,this.extrudedHeight=void 0,this.granularity=void 0,this.stRotation=void 0,this.rotation=void 0,this.offsetAttribute=void 0}function ql(e,t){Ri.call(this,{entity:e,scene:t,geometryOptions:new Gl(e),geometryPropertyName:"rectangle",observedPropertyNames:["availability","rectangle"]}),this._onEntityPropertyChanged(e,"rectangle",e.rectangle,void 0)}function Wl(e,t,a){we.call(this,e,t,a)}Object(s.default)(Object.create)&&(ql.prototype=Object.create(Ri.prototype),ql.prototype.constructor=ql),ql.prototype.createFillGeometryInstance=function(e){var t,a=this._entity,i=a.isAvailable(e),r={show:new ve.a(i&&a.isShowing&&this._showProperty.getValue(e)&&this._fillProperty.getValue(e)),distanceDisplayCondition:fe.fromDistanceDisplayCondition(this._distanceDisplayConditionProperty.getValue(e)),offset:void 0,color:void 0};this._materialProperty instanceof ge.default&&(Object(s.default)(this._materialProperty.color)&&(this._materialProperty.color.isConstant||i)&&(t=this._materialProperty.color.getValue(e,Fl)),Object(s.default)(t)||(t=b.default.WHITE),r.color=le.a.fromColor(t));return Object(s.default)(this._options.offsetAttribute)&&(r.offset=me.a.fromCartesian3(P.default.getValueOrDefault(this._terrainOffsetProperty,e,Bl,Ul))),new ce.a({id:a,geometry:new Vl(this._options),attributes:r})},ql.prototype.createOutlineGeometryInstance=function(e){var t=this._entity,a=t.isAvailable(e),i=P.default.getValueOrDefault(this._outlineColorProperty,e,b.default.BLACK,Fl),r=this._distanceDisplayConditionProperty.getValue(e),n={show:new ve.a(a&&t.isShowing&&this._showProperty.getValue(e)&&this._showOutlineProperty.getValue(e)),color:le.a.fromColor(i),distanceDisplayCondition:fe.fromDistanceDisplayCondition(r),offset:void 0};return Object(s.default)(this._options.offsetAttribute)&&(n.offset=me.a.fromCartesian3(P.default.getValueOrDefault(this._terrainOffsetProperty,e,Bl,Ul))),new ce.a({id:t,geometry:new Nl.a(this._options),attributes:n})},ql.prototype._computeCenter=function(e,t){var a=P.default.getValueOrUndefined(this._entity.rectangle.coordinates,e,kl);if(Object(s.default)(a)){var i=Za.default.center(a,zl);return Ne.default.toCartesian(i,it.default.WGS84,t)}},ql.prototype._isHidden=function(e,t){return!Object(s.default)(t.coordinates)||Le.prototype._isHidden.call(this,e,t)},ql.prototype._isDynamic=function(e,t){return!t.coordinates.isConstant||!P.default.isConstant(t.height)||!P.default.isConstant(t.extrudedHeight)||!P.default.isConstant(t.granularity)||!P.default.isConstant(t.stRotation)||!P.default.isConstant(t.rotation)||!P.default.isConstant(t.outlineWidth)||!P.default.isConstant(t.zIndex)||this._onTerrain&&!P.default.isConstant(this._materialProperty)},ql.prototype._setStaticOptions=function(e,t){var a=this._materialProperty instanceof ge.default,r=P.default.getValueOrUndefined(t.height,pe.default.MINIMUM_VALUE),n=P.default.getValueOrDefault(t.heightReference,pe.default.MINIMUM_VALUE,A.default.NONE),o=P.default.getValueOrUndefined(t.extrudedHeight,pe.default.MINIMUM_VALUE),l=P.default.getValueOrDefault(t.extrudedHeightReference,pe.default.MINIMUM_VALUE,A.default.NONE);Object(s.default)(o)&&!Object(s.default)(r)&&(r=0);var u=this._options;u.vertexFormat=a?re.a.VERTEX_FORMAT:ie.MaterialSupport.TEXTURED.vertexFormat,u.rectangle=t.coordinates.getValue(pe.default.MINIMUM_VALUE,u.rectangle),u.granularity=P.default.getValueOrUndefined(t.granularity,pe.default.MINIMUM_VALUE),u.stRotation=P.default.getValueOrUndefined(t.stRotation,pe.default.MINIMUM_VALUE),u.rotation=P.default.getValueOrUndefined(t.rotation,pe.default.MINIMUM_VALUE),u.offsetAttribute=Ri.computeGeometryOffsetAttribute(r,n,o,l),u.height=Ri.getGeometryHeight(r,n),(o=Ri.getGeometryExtrudedHeight(o,l))===Ri.CLAMP_TO_GROUND&&(o=i.a.getMinimumMaximumHeights(Vl.computeRectangle(u,Hl)).minimumTerrainHeight),u.extrudedHeight=o},ql.DynamicGeometryUpdater=Wl,Object(s.default)(Object.create)&&(Wl.prototype=Object.create(we.prototype),Wl.prototype.constructor=Wl),Wl.prototype._isHidden=function(e,t,a){return!Object(s.default)(this._options.rectangle)||we.prototype._isHidden.call(this,e,t,a)},Wl.prototype._setOptions=function(e,t,a){var r=this._options,n=P.default.getValueOrUndefined(t.height,a),o=P.default.getValueOrDefault(t.heightReference,a,A.default.NONE),l=P.default.getValueOrUndefined(t.extrudedHeight,a),u=P.default.getValueOrDefault(t.extrudedHeightReference,a,A.default.NONE);Object(s.default)(l)&&!Object(s.default)(n)&&(n=0),r.rectangle=P.default.getValueOrUndefined(t.coordinates,a,r.rectangle),r.granularity=P.default.getValueOrUndefined(t.granularity,a),r.stRotation=P.default.getValueOrUndefined(t.stRotation,a),r.rotation=P.default.getValueOrUndefined(t.rotation,a),r.offsetAttribute=Ri.computeGeometryOffsetAttribute(n,o,l,u),r.height=Ri.getGeometryHeight(n,o),(l=Ri.getGeometryExtrudedHeight(l,u))===Ri.CLAMP_TO_GROUND&&(l=i.a.getMinimumMaximumHeights(Vl.computeRectangle(r,Hl)).minimumTerrainHeight),r.extrudedHeight=l};var Yl=ql,Kl=new b.default,Xl=new w.a,Zl=new w.a,Jl=y.default.ZERO,Ql=new y.default;function $l(e,t,a,i,r,n,o){var l;this.translucent=t,this.appearanceType=a,this.depthFailAppearanceType=i,this.depthFailMaterialProperty=r,this.depthFailMaterial=void 0,this.closed=n,this.shadows=o,this.primitives=e,this.createPrimitive=!1,this.waitingOnCreate=!1,this.primitive=void 0,this.oldPrimitive=void 0,this.geometry=new v.default,this.updaters=new v.default,this.updatersWithAttributes=new v.default,this.attributes=new v.default,this.subscriptions=new v.default,this.showsUpdated=new v.default,this.itemsToRemove=[],this.invalidated=!1,Object(s.default)(r)&&(l=r.definitionChanged.addEventListener($l.prototype.onMaterialChanged,this)),this.removeMaterialSubscription=l}function eu(e,t,a,i,r){this._solidItems=[],this._translucentItems=[],this._primitives=e,this._appearanceType=t,this._depthFailAppearanceType=a,this._closed=i,this._shadows=r}function tu(e,t){for(var a=e.length-1;a>=0;a--){var i=e[a];if(i.remove(t))return 0===i.updaters.length&&(e.splice(a,1),i.destroy()),!0}return!1}function au(e,t,a){for(var i=!1,r=t.length,n=0;n<r;++n){var o=t[n],s=o.itemsToRemove,l=s.length;if(l>0)for(n=0;n<l;n++){var u=s[n];o.remove(u),e.add(a,u),i=!0}}return i}function iu(e,t,a,i){var r,n=t.length;for(r=n-1;r>=0;r--){var o=t[r];if(o.invalidated){t.splice(r,1);for(var s=o.updaters.values,l=s.length,u=0;u<l;u++)e.add(a,s[u]);o.destroy()}}for(n=t.length,r=0;r<n;++r)i=t[r].update(a)&&i;return i}function ru(e,t,a){for(var i=e.length,r=0;r<i;r++){var n=e[r];if(n.contains(t))return n.getBoundingSphere(t,a)}return C.default.FAILED}function nu(e){for(var t=e.length,a=0;a<t;a++)e[a].destroy();e.length=0}$l.prototype.onMaterialChanged=function(){this.invalidated=!0},$l.prototype.isMaterial=function(e){var t=this.depthFailMaterialProperty,a=e.depthFailMaterialProperty;return a===t||!!Object(s.default)(t)&&t.equals(a)},$l.prototype.add=function(e,t){var a=e.id;if(this.createPrimitive=!0,this.geometry.set(a,t),this.updaters.set(a,e),e.hasConstantFill&&e.fillMaterialProperty.isConstant&&P.default.isConstant(e.distanceDisplayConditionProperty)&&P.default.isConstant(e.terrainOffsetProperty)){var i=this;this.subscriptions.set(a,e.entity.definitionChanged.addEventListener((function(t,a,r,n){"isShowing"===a&&i.showsUpdated.set(e.id,e)})))}else this.updatersWithAttributes.set(a,e)},$l.prototype.remove=function(e){var t=e.id;if(this.createPrimitive=this.geometry.remove(t)||this.createPrimitive,this.updaters.remove(t)){this.updatersWithAttributes.remove(t);var a=this.subscriptions.get(t);return Object(s.default)(a)&&(a(),this.subscriptions.remove(t),this.showsUpdated.remove(t)),!0}return!1},$l.prototype.update=function(e){var t,a=!0,i=0,r=this.primitive,n=this.primitives;if(this.createPrimitive){var o=this.geometry.values;if(o.length>0){var l;Object(s.default)(r)&&(Object(s.default)(this.oldPrimitive)?n.remove(r):this.oldPrimitive=r),Object(s.default)(this.depthFailAppearanceType)&&(Object(s.default)(this.depthFailMaterialProperty)&&(this.depthFailMaterial=be.getValue(e,this.depthFailMaterialProperty,this.depthFailMaterial)),l=new this.depthFailAppearanceType({material:this.depthFailMaterial,translucent:this.translucent,closed:this.closed})),r=new _e.a({show:!1,asynchronous:!0,geometryInstances:o.slice(),appearance:new this.appearanceType({translucent:this.translucent,closed:this.closed}),depthFailAppearance:l,shadows:this.shadows}),n.add(r),a=!1}else{Object(s.default)(r)&&(n.remove(r),r=void 0);var u=this.oldPrimitive;Object(s.default)(u)&&(n.remove(u),this.oldPrimitive=void 0)}this.attributes.removeAll(),this.primitive=r,this.createPrimitive=!1,this.waitingOnCreate=!0}else if(Object(s.default)(r)&&r.ready){r.show=!0,Object(s.default)(this.oldPrimitive)&&(n.remove(this.oldPrimitive),this.oldPrimitive=void 0),!Object(s.default)(this.depthFailAppearanceType)||this.depthFailMaterialProperty instanceof ge.default||(this.depthFailMaterial=be.getValue(e,this.depthFailMaterialProperty,this.depthFailMaterial),this.primitive.depthFailAppearance.material=this.depthFailMaterial);var d=this.updatersWithAttributes.values,f=d.length,c=this.waitingOnCreate;for(t=0;t<f;t++){var h=d[t],p=this.geometry.get(h.id),m=this.attributes.get(p.id.id);if(Object(s.default)(m)||(m=r.getGeometryInstanceAttributes(p.id),this.attributes.set(p.id.id,m)),!h.fillMaterialProperty.isConstant||c){var v=h.fillMaterialProperty.color,g=P.default.getValueOrDefault(v,e,b.default.WHITE,Kl);b.default.equals(m._lastColor,g)||(m._lastColor=b.default.clone(g,m._lastColor),m.color=le.a.toValue(g,m.color),(this.translucent&&255===m.color[3]||!this.translucent&&255!==m.color[3])&&(this.itemsToRemove[i++]=h))}if(Object(s.default)(this.depthFailAppearanceType)&&h.depthFailMaterialProperty instanceof ge.default&&(!h.depthFailMaterialProperty.isConstant||c)){var _=h.depthFailMaterialProperty.color,O=P.default.getValueOrDefault(_,e,b.default.WHITE,Kl);b.default.equals(m._lastDepthFailColor,O)||(m._lastDepthFailColor=b.default.clone(O,m._lastDepthFailColor),m.depthFailColor=le.a.toValue(O,m.depthFailColor))}var x=h.entity.isShowing&&(h.hasConstantFill||h.isFilled(e));x!==(1===m.show[0])&&(m.show=ve.a.toValue(x,m.show));var A=h.distanceDisplayConditionProperty;if(!P.default.isConstant(A)){var j=P.default.getValueOrDefault(A,e,Zl,Xl);w.a.equals(j,m._lastDistanceDisplayCondition)||(m._lastDistanceDisplayCondition=w.a.clone(j,m._lastDistanceDisplayCondition),m.distanceDisplayCondition=fe.toValue(j,m.distanceDisplayCondition))}var E=h.terrainOffsetProperty;if(!P.default.isConstant(E)){var C=P.default.getValueOrDefault(E,e,Jl,Ql);y.default.equals(C,m._lastOffset)||(m._lastOffset=y.default.clone(C,m._lastOffset),m.offset=me.a.toValue(C,m.offset))}}this.updateShows(r),this.waitingOnCreate=!1}else Object(s.default)(r)&&!r.ready&&(a=!1);return this.itemsToRemove.length=i,a},$l.prototype.updateShows=function(e){for(var t=this.showsUpdated.values,a=t.length,i=0;i<a;i++){var r=t[i],n=this.geometry.get(r.id),o=this.attributes.get(n.id.id);Object(s.default)(o)||(o=e.getGeometryInstanceAttributes(n.id),this.attributes.set(n.id.id,o));var l=r.entity.isShowing;l!==(1===o.show[0])&&(o.show=ve.a.toValue(l,o.show),n.attributes.show.value[0]=o.show[0])}this.showsUpdated.removeAll()},$l.prototype.contains=function(e){return this.updaters.contains(e.id)},$l.prototype.getBoundingSphere=function(e,t){var a=this.primitive;if(!a.ready)return C.default.PENDING;var i=a.getGeometryInstanceAttributes(e.entity);return!Object(s.default)(i)||!Object(s.default)(i.boundingSphere)||Object(s.default)(i.show)&&0===i.show[0]?C.default.FAILED:(i.boundingSphere.clone(t),C.default.DONE)},$l.prototype.destroy=function(){var e=this.primitive,t=this.primitives;Object(s.default)(e)&&t.remove(e);var a=this.oldPrimitive;Object(s.default)(a)&&t.remove(a),Object(s.default)(this.removeMaterialSubscription)&&this.removeMaterialSubscription()},eu.prototype.add=function(e,t){var a,i,r=t.createFillGeometryInstance(e);255===r.attributes.color.value[3]?(a=this._solidItems,i=!1):(a=this._translucentItems,i=!0);for(var n=a.length,o=0;o<n;o++){var s=a[o];if(s.isMaterial(t))return void s.add(t,r)}var l=new $l(this._primitives,i,this._appearanceType,this._depthFailAppearanceType,t.depthFailMaterialProperty,this._closed,this._shadows);l.add(t,r),a.push(l)},eu.prototype.remove=function(e){tu(this._solidItems,e)||tu(this._translucentItems,e)},eu.prototype.update=function(e){var t=iu(this,this._solidItems,e,!0);t=iu(this,this._translucentItems,e,t)&&t;var a=au(this,this._solidItems,e),i=au(this,this._translucentItems,e);return(a||i)&&(t=iu(this,this._solidItems,e,t)&&t,t=iu(this,this._translucentItems,e,t)&&t),t},eu.prototype.getBoundingSphere=function(e,t){var a=ru(this._solidItems,e,t);return a===C.default.FAILED?ru(this._translucentItems,e,t):a},eu.prototype.removeAllPrimitives=function(){nu(this._solidItems),nu(this._translucentItems)};var ou=eu,su=new w.a,lu=new w.a,uu=y.default.ZERO,du=new y.default;function fu(e,t,a,i,r,n,o){this.primitives=e,this.appearanceType=t,this.materialProperty=a,this.depthFailAppearanceType=i,this.depthFailMaterialProperty=r,this.closed=n,this.shadows=o,this.updaters=new v.default,this.createPrimitive=!0,this.primitive=void 0,this.oldPrimitive=void 0,this.geometry=new v.default,this.material=void 0,this.depthFailMaterial=void 0,this.updatersWithAttributes=new v.default,this.attributes=new v.default,this.invalidated=!1,this.removeMaterialSubscription=a.definitionChanged.addEventListener(fu.prototype.onMaterialChanged,this),this.subscriptions=new v.default,this.showsUpdated=new v.default}fu.prototype.onMaterialChanged=function(){this.invalidated=!0},fu.prototype.isMaterial=function(e){var t=this.materialProperty,a=e.fillMaterialProperty,i=this.depthFailMaterialProperty,r=e.depthFailMaterialProperty;if(a===t&&r===i)return!0;var n=Object(s.default)(t)&&t.equals(a);return n=(!Object(s.default)(i)&&!Object(s.default)(r)||Object(s.default)(i)&&i.equals(r))&&n},fu.prototype.add=function(e,t){var a=t.id;if(this.updaters.set(a,t),this.geometry.set(a,t.createFillGeometryInstance(e)),t.hasConstantFill&&t.fillMaterialProperty.isConstant&&P.default.isConstant(t.distanceDisplayConditionProperty)&&P.default.isConstant(t.terrainOffsetProperty)){var i=this;this.subscriptions.set(a,t.entity.definitionChanged.addEventListener((function(e,a,r,n){"isShowing"===a&&i.showsUpdated.set(t.id,t)})))}else this.updatersWithAttributes.set(a,t);this.createPrimitive=!0},fu.prototype.remove=function(e){var t=e.id;if(this.createPrimitive=this.geometry.remove(t)||this.createPrimitive,this.updaters.remove(t)){this.updatersWithAttributes.remove(t);var a=this.subscriptions.get(t);return Object(s.default)(a)&&(a(),this.subscriptions.remove(t),this.showsUpdated.remove(t)),!0}return!1};var cu=new b.default;function hu(e,t,a,i,r){this._items=[],this._primitives=e,this._appearanceType=t,this._depthFailAppearanceType=a,this._closed=i,this._shadows=r}fu.prototype.update=function(e){var t,a=!0,i=this.primitive,r=this.primitives,n=this.geometry.values;if(this.createPrimitive){if(n.length>0){var o;Object(s.default)(i)&&(Object(s.default)(this.oldPrimitive)?r.remove(i):this.oldPrimitive=i),this.material=be.getValue(e,this.materialProperty,this.material),Object(s.default)(this.depthFailMaterialProperty)&&(this.depthFailMaterial=be.getValue(e,this.depthFailMaterialProperty,this.depthFailMaterial),o=new this.depthFailAppearanceType({material:this.depthFailMaterial,translucent:this.depthFailMaterial.isTranslucent(),closed:this.closed})),i=new _e.a({show:!1,asynchronous:!0,geometryInstances:n.slice(),appearance:new this.appearanceType({material:this.material,translucent:this.material.isTranslucent(),closed:this.closed}),depthFailAppearance:o,shadows:this.shadows}),r.add(i),a=!1}else{Object(s.default)(i)&&(r.remove(i),i=void 0);var l=this.oldPrimitive;Object(s.default)(l)&&(r.remove(l),this.oldPrimitive=void 0)}this.attributes.removeAll(),this.primitive=i,this.createPrimitive=!1}else if(Object(s.default)(i)&&i.ready){i.show=!0,Object(s.default)(this.oldPrimitive)&&(r.remove(this.oldPrimitive),this.oldPrimitive=void 0),this.material=be.getValue(e,this.materialProperty,this.material),this.primitive.appearance.material=this.material,!Object(s.default)(this.depthFailAppearanceType)||this.depthFailMaterialProperty instanceof ge.default||(this.depthFailMaterial=be.getValue(e,this.depthFailMaterialProperty,this.depthFailMaterial),this.primitive.depthFailAppearance.material=this.depthFailMaterial);var u=this.updatersWithAttributes.values,d=u.length;for(t=0;t<d;t++){var f=u[t],c=f.entity,h=this.geometry.get(f.id),p=this.attributes.get(h.id.id);if(Object(s.default)(p)||(p=i.getGeometryInstanceAttributes(h.id),this.attributes.set(h.id.id,p)),Object(s.default)(this.depthFailAppearanceType)&&this.depthFailMaterialProperty instanceof ge.default&&!f.depthFailMaterialProperty.isConstant){var m=f.depthFailMaterialProperty.color,v=P.default.getValueOrDefault(m,e,b.default.WHITE,cu);b.default.equals(p._lastDepthFailColor,v)||(p._lastDepthFailColor=b.default.clone(v,p._lastDepthFailColor),p.depthFailColor=le.a.toValue(v,p.depthFailColor))}var g=c.isShowing&&(f.hasConstantFill||f.isFilled(e));g!==(1===p.show[0])&&(p.show=ve.a.toValue(g,p.show));var _=f.distanceDisplayConditionProperty;if(!P.default.isConstant(_)){var O=P.default.getValueOrDefault(_,e,lu,su);w.a.equals(O,p._lastDistanceDisplayCondition)||(p._lastDistanceDisplayCondition=w.a.clone(O,p._lastDistanceDisplayCondition),p.distanceDisplayCondition=fe.toValue(O,p.distanceDisplayCondition))}var x=f.terrainOffsetProperty;if(!P.default.isConstant(x)){var A=P.default.getValueOrDefault(x,e,uu,du);y.default.equals(A,p._lastOffset)||(p._lastOffset=y.default.clone(A,p._lastOffset),p.offset=me.a.toValue(A,p.offset))}}this.updateShows(i)}else Object(s.default)(i)&&!i.ready&&(a=!1);return a},fu.prototype.updateShows=function(e){for(var t=this.showsUpdated.values,a=t.length,i=0;i<a;i++){var r=t[i],n=r.entity,o=this.geometry.get(r.id),l=this.attributes.get(o.id.id);Object(s.default)(l)||(l=e.getGeometryInstanceAttributes(o.id),this.attributes.set(o.id.id,l));var u=n.isShowing;u!==(1===l.show[0])&&(l.show=ve.a.toValue(u,l.show),o.attributes.show.value[0]=l.show[0])}this.showsUpdated.removeAll()},fu.prototype.contains=function(e){return this.updaters.contains(e.id)},fu.prototype.getBoundingSphere=function(e,t){var a=this.primitive;if(!a.ready)return C.default.PENDING;var i=a.getGeometryInstanceAttributes(e.entity);return!Object(s.default)(i)||!Object(s.default)(i.boundingSphere)||Object(s.default)(i.show)&&0===i.show[0]?C.default.FAILED:(i.boundingSphere.clone(t),C.default.DONE)},fu.prototype.destroy=function(){var e=this.primitive,t=this.primitives;Object(s.default)(e)&&t.remove(e);var a=this.oldPrimitive;Object(s.default)(a)&&t.remove(a),this.removeMaterialSubscription()},hu.prototype.add=function(e,t){for(var a=this._items,i=a.length,r=0;r<i;r++){var n=a[r];if(n.isMaterial(t))return void n.add(e,t)}var o=new fu(this._primitives,this._appearanceType,t.fillMaterialProperty,this._depthFailAppearanceType,t.depthFailMaterialProperty,this._closed,this._shadows);o.add(e,t),a.push(o)},hu.prototype.remove=function(e){for(var t=this._items,a=t.length-1;a>=0;a--){var i=t[a];if(i.remove(e)){0===i.updaters.length&&(t.splice(a,1),i.destroy());break}}},hu.prototype.update=function(e){var t,a=this._items;for(t=a.length-1;t>=0;t--){var i=a[t];if(i.invalidated){a.splice(t,1);for(var r=i.updaters.values,n=r.length,o=0;o<n;o++)this.add(e,r[o]);i.destroy()}}var s=!0;for(t=0;t<a.length;t++)s=a[t].update(e)&&s;return s},hu.prototype.getBoundingSphere=function(e,t){for(var a=this._items,i=a.length,r=0;r<i;r++){var n=a[r];if(n.contains(e))return n.getBoundingSphere(e,t)}return C.default.FAILED},hu.prototype.removeAllPrimitives=function(){for(var e=this._items,t=e.length,a=0;a<t;a++)e[a].destroy();this._items.length=0};var pu=hu,mu=new b.default,vu=new w.a,gu=new w.a;function _u(e,t,a,i,r){this.primitives=e,this.zIndex=r,this.classificationType=t,this.color=a,this.key=i,this.createPrimitive=!1,this.waitingOnCreate=!1,this.primitive=void 0,this.oldPrimitive=void 0,this.geometry=new v.default,this.updaters=new v.default,this.updatersWithAttributes=new v.default,this.attributes=new v.default,this.subscriptions=new v.default,this.showsUpdated=new v.default,this.itemsToRemove=[],this.isDirty=!1}_u.prototype.add=function(e,t){var a=e.id;if(this.createPrimitive=!0,this.geometry.set(a,t),this.updaters.set(a,e),e.hasConstantFill&&e.fillMaterialProperty.isConstant&&P.default.isConstant(e.distanceDisplayConditionProperty)){var i=this;this.subscriptions.set(a,e.entity.definitionChanged.addEventListener((function(t,a,r,n){"isShowing"===a&&i.showsUpdated.set(e.id,e)})))}else this.updatersWithAttributes.set(a,e)},_u.prototype.remove=function(e){var t=e.id;if(this.createPrimitive=this.geometry.remove(t)||this.createPrimitive,this.updaters.remove(t)){this.updatersWithAttributes.remove(t);var a=this.subscriptions.get(t);return Object(s.default)(a)&&(a(),this.subscriptions.remove(t),this.showsUpdated.remove(t)),!0}return!1};var yu=new Array(4);function bu(e,t){this._batches=new v.default,this._primitives=e,this._classificationType=t}_u.prototype.update=function(e){var t,a=!0,i=0,r=this.primitive,n=this.primitives;if(this.createPrimitive){var o=this.geometry.values;if(o.length>0)Object(s.default)(r)&&(Object(s.default)(this.oldPrimitive)?n.remove(r):this.oldPrimitive=r),r=new c.a({show:!1,asynchronous:!0,geometryInstances:o.slice(),classificationType:this.classificationType}),n.add(r,this.zIndex),a=!1;else{Object(s.default)(r)&&(n.remove(r),r=void 0);var l=this.oldPrimitive;Object(s.default)(l)&&(n.remove(l),this.oldPrimitive=void 0)}this.attributes.removeAll(),this.primitive=r,this.createPrimitive=!1,this.waitingOnCreate=!0}else if(Object(s.default)(r)&&r.ready){r.show=!0,Object(s.default)(this.oldPrimitive)&&(n.remove(this.oldPrimitive),this.oldPrimitive=void 0);var u=this.updatersWithAttributes.values,d=u.length,f=this.waitingOnCreate;for(t=0;t<d;t++){var h=u[t],p=this.geometry.get(h.id),m=this.attributes.get(p.id.id);if(Object(s.default)(m)||(m=r.getGeometryInstanceAttributes(p.id),this.attributes.set(p.id.id,m)),!h.fillMaterialProperty.isConstant||f){var v=h.fillMaterialProperty.color,g=P.default.getValueOrDefault(v,e,b.default.WHITE,mu);if(!b.default.equals(m._lastColor,g)){m._lastColor=b.default.clone(g,m._lastColor);var _=this.color,y=g.toBytes(yu);_[0]===y[0]&&_[1]===y[1]&&_[2]===y[2]&&_[3]===y[3]||(this.itemsToRemove[i++]=h)}}var O=h.entity.isShowing&&(h.hasConstantFill||h.isFilled(e));O!==(1===m.show[0])&&(m.show=ve.a.toValue(O,m.show));var x=h.distanceDisplayConditionProperty;if(!P.default.isConstant(x)){var A=P.default.getValueOrDefault(x,e,gu,vu);w.a.equals(A,m._lastDistanceDisplayCondition)||(m._lastDistanceDisplayCondition=w.a.clone(A,m._lastDistanceDisplayCondition),m.distanceDisplayCondition=fe.toValue(A,m.distanceDisplayCondition))}}this.updateShows(r),this.waitingOnCreate=!1}else Object(s.default)(r)&&!r.ready&&(a=!1);return this.itemsToRemove.length=i,a},_u.prototype.updateShows=function(e){for(var t=this.showsUpdated.values,a=t.length,i=0;i<a;i++){var r=t[i],n=this.geometry.get(r.id),o=this.attributes.get(n.id.id);Object(s.default)(o)||(o=e.getGeometryInstanceAttributes(n.id),this.attributes.set(n.id.id,o));var l=r.entity.isShowing;l!==(1===o.show[0])&&(o.show=ve.a.toValue(l,o.show),n.attributes.show.value[0]=o.show[0])}this.showsUpdated.removeAll()},_u.prototype.contains=function(e){return this.updaters.contains(e.id)},_u.prototype.getBoundingSphere=function(e,t){var a=this.primitive;if(!a.ready)return C.default.PENDING;var i=a.getBoundingSphere(e.entity);return Object(s.default)(i)?(i.clone(t),C.default.DONE):C.default.FAILED},_u.prototype.removeAllPrimitives=function(){var e=this.primitives,t=this.primitive;Object(s.default)(t)&&(e.remove(t),this.primitive=void 0,this.geometry.removeAll(),this.updaters.removeAll());var a=this.oldPrimitive;Object(s.default)(a)&&(e.remove(a),this.oldPrimitive=void 0)},bu.prototype.add=function(e,t){var a,i=t.createFillGeometryInstance(e),r=this._batches,n=P.default.getValueOrDefault(t.zIndex,0),o=new Uint32Array(i.attributes.color.value.buffer)[0]+":"+n;return r.contains(o)?a=r.get(o):(a=new _u(this._primitives,this._classificationType,i.attributes.color.value,o,n),r.set(o,a)),a.add(t,i),a},bu.prototype.remove=function(e){for(var t=this._batches.values,a=t.length,i=0;i<a;++i)if(t[i].remove(e))return},bu.prototype.update=function(e){var t,a,i=!0,r=this._batches,n=r.values,o=n.length;for(t=0;t<o;++t)i=n[t].update(e)&&i;for(t=0;t<o;++t)for(var s=n[t],l=s.itemsToRemove,u=l.length,d=0;d<u;d++){a=l[d],s.remove(a);var f=this.add(e,a);s.isDirty=!0,f.isDirty=!0}var c=n.slice(),h=c.length;for(t=0;t<h;++t){var p=c[t];p.isDirty&&(i=c[t].update(e)&&i,p.isDirty=!1),0===p.geometry.length&&r.remove(p.key)}return i},bu.prototype.getBoundingSphere=function(e,t){for(var a=this._batches.values,i=a.length,r=0;r<i;++r){var n=a[r];if(n.contains(e))return n.getBoundingSphere(e,t)}return C.default.FAILED},bu.prototype.removeAllPrimitives=function(){for(var e=this._batches.values,t=e.length,a=0;a<t;++a)e[a].removeAllPrimitives()};var Ou=bu;function wu(e,t,a){var i=e[t];e[t]=e[a],e[a]=i}function xu(e,t){return e<t?-1:e>t?1:0}var Au=function(e,t,a,i,r){!function e(t,a,i,r,n){for(;r>i;){if(r-i>600){var o=r-i+1,s=a-i+1,l=Math.log(o),u=.5*Math.exp(2*l/3),d=.5*Math.sqrt(l*u*(o-u)/o)*(s-o/2<0?-1:1),f=Math.max(i,Math.floor(a-s*u/o+d)),c=Math.min(r,Math.floor(a+(o-s)*u/o+d));e(t,a,f,c,n)}var h=t[a],p=i,m=r;for(wu(t,i,a),n(t[r],h)>0&&wu(t,i,r);p<m;){for(wu(t,p,m),p++,m--;n(t[p],h)<0;)p++;for(;n(t[m],h)>0;)m--}0===n(t[i],h)?wu(t,i,m):(m++,wu(t,m,r)),m<=a&&(i=m+1),a<=m&&(r=m-1)}}(e,t,a||0,i||e.length-1,r||xu)};function ju(e,t){if(!(this instanceof ju))return new ju(e,t);this._maxEntries=Math.max(4,e||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),t&&this._initFormat(t),this.clear()}function Eu(e,t,a){if(!a)return t.indexOf(e);for(var i=0;i<t.length;i++)if(a(e,t[i]))return i;return-1}function Cu(e,t){Pu(e,0,e.children.length,t,e)}function Pu(e,t,a,i,r){r||(r=Vu(null)),r.minX=1/0,r.minY=1/0,r.maxX=-1/0,r.maxY=-1/0;for(var n,o=t;o<a;o++)n=e.children[o],Tu(r,e.leaf?i(n):n);return r}function Tu(e,t){return e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY),e}function Du(e,t){return e.minX-t.minX}function Iu(e,t){return e.minY-t.minY}function Su(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function Mu(e){return e.maxX-e.minX+(e.maxY-e.minY)}function Ru(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function Lu(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function Vu(e){return{children:e,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function Nu(e,t,a,i,r){for(var n,o=[t,a];o.length;)(a=o.pop())-(t=o.pop())<=i||(n=t+Math.ceil((a-t)/i/2)*i,Au(e,n,t,a,r),o.push(t,n,n,a))}ju.prototype={all:function(){return this._all(this.data,[])},search:function(e){var t=this.data,a=[],i=this.toBBox;if(!Lu(e,t))return a;for(var r,n,o,s,l=[];t;){for(r=0,n=t.children.length;r<n;r++)o=t.children[r],Lu(e,s=t.leaf?i(o):o)&&(t.leaf?a.push(o):Ru(e,s)?this._all(o,a):l.push(o));t=l.pop()}return a},collides:function(e){var t=this.data,a=this.toBBox;if(!Lu(e,t))return!1;for(var i,r,n,o,s=[];t;){for(i=0,r=t.children.length;i<r;i++)if(n=t.children[i],Lu(e,o=t.leaf?a(n):n)){if(t.leaf||Ru(e,o))return!0;s.push(n)}t=s.pop()}return!1},load:function(e){if(!e||!e.length)return this;if(e.length<this._minEntries){for(var t=0,a=e.length;t<a;t++)this.insert(e[t]);return this}var i=this._build(e.slice(),0,e.length-1,0);if(this.data.children.length)if(this.data.height===i.height)this._splitRoot(this.data,i);else{if(this.data.height<i.height){var r=this.data;this.data=i,i=r}this._insert(i,this.data.height-i.height-1,!0)}else this.data=i;return this},insert:function(e){return e&&this._insert(e,this.data.height-1),this},clear:function(){return this.data=Vu([]),this},remove:function(e,t){if(!e)return this;for(var a,i,r,n,o=this.data,s=this.toBBox(e),l=[],u=[];o||l.length;){if(o||(o=l.pop(),i=l[l.length-1],a=u.pop(),n=!0),o.leaf&&-1!==(r=Eu(e,o.children,t)))return o.children.splice(r,1),l.push(o),this._condense(l),this;n||o.leaf||!Ru(o,s)?i?(a++,o=i.children[a],n=!1):o=null:(l.push(o),u.push(a),a=0,i=o,o=o.children[0])}return this},toBBox:function(e){return e},compareMinX:Du,compareMinY:Iu,toJSON:function(){return this.data},fromJSON:function(e){return this.data=e,this},_all:function(e,t){for(var a=[];e;)e.leaf?t.push.apply(t,e.children):a.push.apply(a,e.children),e=a.pop();return t},_build:function(e,t,a,i){var r,n=a-t+1,o=this._maxEntries;if(n<=o)return Cu(r=Vu(e.slice(t,a+1)),this.toBBox),r;i||(i=Math.ceil(Math.log(n)/Math.log(o)),o=Math.ceil(n/Math.pow(o,i-1))),(r=Vu([])).leaf=!1,r.height=i;var s,l,u,d,f=Math.ceil(n/o),c=f*Math.ceil(Math.sqrt(o));for(Nu(e,t,a,c,this.compareMinX),s=t;s<=a;s+=c)for(Nu(e,s,u=Math.min(s+c-1,a),f,this.compareMinY),l=s;l<=u;l+=f)d=Math.min(l+f-1,u),r.children.push(this._build(e,l,d,i-1));return Cu(r,this.toBBox),r},_chooseSubtree:function(e,t,a,i){for(var r,n,o,s,l,u,d,f,c,h;i.push(t),!t.leaf&&i.length-1!==a;){for(d=f=1/0,r=0,n=t.children.length;r<n;r++)l=Su(o=t.children[r]),c=e,h=o,(u=(Math.max(h.maxX,c.maxX)-Math.min(h.minX,c.minX))*(Math.max(h.maxY,c.maxY)-Math.min(h.minY,c.minY))-l)<f?(f=u,d=l<d?l:d,s=o):u===f&&l<d&&(d=l,s=o);t=s||t.children[0]}return t},_insert:function(e,t,a){var i=this.toBBox,r=a?e:i(e),n=[],o=this._chooseSubtree(r,this.data,t,n);for(o.children.push(e),Tu(o,r);t>=0&&n[t].children.length>this._maxEntries;)this._split(n,t),t--;this._adjustParentBBoxes(r,n,t)},_split:function(e,t){var a=e[t],i=a.children.length,r=this._minEntries;this._chooseSplitAxis(a,r,i);var n=this._chooseSplitIndex(a,r,i),o=Vu(a.children.splice(n,a.children.length-n));o.height=a.height,o.leaf=a.leaf,Cu(a,this.toBBox),Cu(o,this.toBBox),t?e[t-1].children.push(o):this._splitRoot(a,o)},_splitRoot:function(e,t){this.data=Vu([e,t]),this.data.height=e.height+1,this.data.leaf=!1,Cu(this.data,this.toBBox)},_chooseSplitIndex:function(e,t,a){var i,r,n,o,s,l,u,d,f,c,h,p,m,v;for(l=u=1/0,i=t;i<=a-t;i++)r=Pu(e,0,i,this.toBBox),n=Pu(e,i,a,this.toBBox),f=r,c=n,h=void 0,p=void 0,m=void 0,v=void 0,h=Math.max(f.minX,c.minX),p=Math.max(f.minY,c.minY),m=Math.min(f.maxX,c.maxX),v=Math.min(f.maxY,c.maxY),o=Math.max(0,m-h)*Math.max(0,v-p),s=Su(r)+Su(n),o<l?(l=o,d=i,u=s<u?s:u):o===l&&s<u&&(u=s,d=i);return d},_chooseSplitAxis:function(e,t,a){var i=e.leaf?this.compareMinX:Du,r=e.leaf?this.compareMinY:Iu;this._allDistMargin(e,t,a,i)<this._allDistMargin(e,t,a,r)&&e.children.sort(i)},_allDistMargin:function(e,t,a,i){e.children.sort(i);var r,n,o=this.toBBox,s=Pu(e,0,t,o),l=Pu(e,a-t,a,o),u=Mu(s)+Mu(l);for(r=t;r<a-t;r++)n=e.children[r],Tu(s,e.leaf?o(n):n),u+=Mu(s);for(r=a-t-1;r>=t;r--)n=e.children[r],Tu(l,e.leaf?o(n):n),u+=Mu(l);return u},_adjustParentBBoxes:function(e,t,a){for(var i=a;i>=0;i--)Tu(t[i],e)},_condense:function(e){for(var t,a=e.length-1;a>=0;a--)0===e[a].children.length?a>0?(t=e[a-1].children).splice(t.indexOf(e[a]),1):this.clear():Cu(e[a],this.toBBox)},_initFormat:function(e){var t=["return a"," - b",";"];this.compareMinX=new Function("a","b",t.join(e[0])),this.compareMinY=new Function("a","b",t.join(e[1])),this.toBBox=new Function("a","return {minX: a"+e[0]+", minY: a"+e[1]+", maxX: a"+e[2]+", maxY: a"+e[3]+"};")}};var Fu=ju;function Bu(){this._tree=Fu()}function Uu(){this.minX=0,this.minY=0,this.maxX=0,this.maxY=0,this.id=""}function Hu(e,t){return e.id===t.id}Uu.fromRectangleAndId=function(e,t,a){return a.minX=t.west,a.minY=t.south,a.maxX=t.east,a.maxY=t.north,a.id=e,a},Bu.prototype.insert=function(e,t){var a=Uu.fromRectangleAndId(e,t,new Uu);this._tree.insert(a)};var ku=new Uu;Bu.prototype.remove=function(e,t){var a=Uu.fromRectangleAndId(e,t,ku);this._tree.remove(a,Hu)};var zu=new Uu;Bu.prototype.collides=function(e){var t=Uu.fromRectangleAndId("",e,zu);return this._tree.collides(t)};var Gu=Bu,qu=a(235),Wu=new w.a,Yu=new w.a;function Ku(e,t,a,i,r,n){this.primitives=e,this.classificationType=t,this.appearanceType=a,this.materialProperty=i,this.updaters=new v.default,this.createPrimitive=!0,this.primitive=void 0,this.oldPrimitive=void 0,this.geometry=new v.default,this.material=void 0,this.updatersWithAttributes=new v.default,this.attributes=new v.default,this.invalidated=!1,this.removeMaterialSubscription=i.definitionChanged.addEventListener(Ku.prototype.onMaterialChanged,this),this.subscriptions=new v.default,this.showsUpdated=new v.default,this.usingSphericalTextureCoordinates=r,this.zIndex=n,this.rectangleCollisionCheck=new Gu}function Xu(e,t,a){this._items=[],this._primitives=e,this._classificationType=t,this._appearanceType=a}Ku.prototype.onMaterialChanged=function(){this.invalidated=!0},Ku.prototype.overlapping=function(e){return this.rectangleCollisionCheck.collides(e)},Ku.prototype.isMaterial=function(e){var t=this.materialProperty,a=e.fillMaterialProperty;return a===t||a instanceof ge.default&&t instanceof ge.default||Object(s.default)(t)&&t.equals(a)},Ku.prototype.add=function(e,t,a){var i=t.id;if(this.updaters.set(i,t),this.geometry.set(i,a),this.rectangleCollisionCheck.insert(i,a.geometry.rectangle),t.hasConstantFill&&t.fillMaterialProperty.isConstant&&P.default.isConstant(t.distanceDisplayConditionProperty)){var r=this;this.subscriptions.set(i,t.entity.definitionChanged.addEventListener((function(e,a,i,n){"isShowing"===a&&r.showsUpdated.set(t.id,t)})))}else this.updatersWithAttributes.set(i,t);this.createPrimitive=!0},Ku.prototype.remove=function(e){var t=e.id,a=this.geometry.get(t);if(this.createPrimitive=this.geometry.remove(t)||this.createPrimitive,this.updaters.remove(t)){this.rectangleCollisionCheck.remove(t,a.geometry.rectangle),this.updatersWithAttributes.remove(t);var i=this.subscriptions.get(t);return Object(s.default)(i)&&(i(),this.subscriptions.remove(t)),!0}return!1},Ku.prototype.update=function(e){var t,a=!0,i=this.primitive,r=this.primitives,n=this.geometry.values;if(this.createPrimitive){if(n.length>0)Object(s.default)(i)&&(Object(s.default)(this.oldPrimitive)?r.remove(i):this.oldPrimitive=i),this.material=be.getValue(e,this.materialProperty,this.material),i=new c.a({show:!1,asynchronous:!0,geometryInstances:n.slice(),appearance:new this.appearanceType({material:this.material}),classificationType:this.classificationType}),r.add(i,this.zIndex),a=!1;else{Object(s.default)(i)&&(r.remove(i),i=void 0);var o=this.oldPrimitive;Object(s.default)(o)&&(r.remove(o),this.oldPrimitive=void 0)}this.attributes.removeAll(),this.primitive=i,this.createPrimitive=!1}else if(Object(s.default)(i)&&i.ready){i.show=!0,Object(s.default)(this.oldPrimitive)&&(r.remove(this.oldPrimitive),this.oldPrimitive=void 0),this.material=be.getValue(e,this.materialProperty,this.material),this.primitive.appearance.material=this.material;var l=this.updatersWithAttributes.values,u=l.length;for(t=0;t<u;t++){var d=l[t],f=d.entity,h=this.geometry.get(d.id),p=this.attributes.get(h.id.id);Object(s.default)(p)||(p=i.getGeometryInstanceAttributes(h.id),this.attributes.set(h.id.id,p));var m=f.isShowing&&(d.hasConstantFill||d.isFilled(e));m!==(1===p.show[0])&&(p.show=ve.a.toValue(m,p.show));var v=d.distanceDisplayConditionProperty;if(!P.default.isConstant(v)){var g=P.default.getValueOrDefault(v,e,Yu,Wu);w.a.equals(g,p._lastDistanceDisplayCondition)||(p._lastDistanceDisplayCondition=w.a.clone(g,p._lastDistanceDisplayCondition),p.distanceDisplayCondition=fe.toValue(g,p.distanceDisplayCondition))}}this.updateShows(i)}else Object(s.default)(i)&&!i.ready&&(a=!1);return a},Ku.prototype.updateShows=function(e){for(var t=this.showsUpdated.values,a=t.length,i=0;i<a;i++){var r=t[i],n=r.entity,o=this.geometry.get(r.id),l=this.attributes.get(o.id.id);Object(s.default)(l)||(l=e.getGeometryInstanceAttributes(o.id),this.attributes.set(o.id.id,l));var u=n.isShowing;u!==(1===l.show[0])&&(l.show=ve.a.toValue(u,l.show),o.attributes.show.value[0]=l.show[0])}this.showsUpdated.removeAll()},Ku.prototype.contains=function(e){return this.updaters.contains(e.id)},Ku.prototype.getBoundingSphere=function(e,t){var a=this.primitive;if(!a.ready)return C.default.PENDING;var i=a.getGeometryInstanceAttributes(e.entity);return!Object(s.default)(i)||!Object(s.default)(i.boundingSphere)||Object(s.default)(i.show)&&0===i.show[0]?C.default.FAILED:(i.boundingSphere.clone(t),C.default.DONE)},Ku.prototype.destroy=function(){var e=this.primitive,t=this.primitives;Object(s.default)(e)&&t.remove(e);var a=this.oldPrimitive;Object(s.default)(a)&&t.remove(a),this.removeMaterialSubscription()},Xu.prototype.add=function(e,t){for(var a=this._items,i=a.length,r=t.createFillGeometryInstance(e),n=qu.a.shouldUseSphericalCoordinates(r.geometry.rectangle),o=P.default.getValueOrDefault(t.zIndex,0),s=0;s<i;++s){var l=a[s];if(l.isMaterial(t)&&l.usingSphericalTextureCoordinates===n&&l.zIndex===o&&!l.overlapping(r.geometry.rectangle))return void l.add(e,t,r)}var u=new Ku(this._primitives,this._classificationType,this._appearanceType,t.fillMaterialProperty,n,o);u.add(e,t,r),a.push(u)},Xu.prototype.remove=function(e){for(var t=this._items,a=t.length-1;a>=0;a--){var i=t[a];if(i.remove(e)){0===i.updaters.length&&(t.splice(a,1),i.destroy());break}}},Xu.prototype.update=function(e){var t,a=this._items;for(t=a.length-1;t>=0;t--){var i=a[t];if(i.invalidated){a.splice(t,1);for(var r=i.updaters.values,n=r.length,o=0;o<n;o++)this.add(e,r[o]);i.destroy()}}var s=!0;for(t=0;t<a.length;t++)s=a[t].update(e)&&s;return s},Xu.prototype.getBoundingSphere=function(e,t){for(var a=this._items,i=a.length,r=0;r<i;r++){var n=a[r];if(n.contains(e))return n.getBoundingSphere(e,t)}return C.default.FAILED},Xu.prototype.removeAllPrimitives=function(){for(var e=this._items,t=e.length,a=0;a<t;a++)e[a].destroy();this._items.length=0};var Zu=Xu,Ju=new b.default,Qu=new w.a,$u=new w.a,ed=y.default.ZERO,td=new y.default;function ad(e,t,a,i){this.translucent=t,this.width=a,this.shadows=i,this.primitives=e,this.createPrimitive=!1,this.waitingOnCreate=!1,this.primitive=void 0,this.oldPrimitive=void 0,this.geometry=new v.default,this.updaters=new v.default,this.updatersWithAttributes=new v.default,this.attributes=new v.default,this.itemsToRemove=[],this.subscriptions=new v.default,this.showsUpdated=new v.default}function id(e,t,a){this._primitives=e,this._scene=t,this._shadows=a,this._solidBatches=new v.default,this._translucentBatches=new v.default}ad.prototype.add=function(e,t){var a=e.id;if(this.createPrimitive=!0,this.geometry.set(a,t),this.updaters.set(a,e),e.hasConstantOutline&&e.outlineColorProperty.isConstant&&P.default.isConstant(e.distanceDisplayConditionProperty)&&P.default.isConstant(e.terrainOffsetProperty)){var i=this;this.subscriptions.set(a,e.entity.definitionChanged.addEventListener((function(t,a,r,n){"isShowing"===a&&i.showsUpdated.set(e.id,e)})))}else this.updatersWithAttributes.set(a,e)},ad.prototype.remove=function(e){var t=e.id;if(this.createPrimitive=this.geometry.remove(t)||this.createPrimitive,this.updaters.remove(t)){this.updatersWithAttributes.remove(t);var a=this.subscriptions.get(t);return Object(s.default)(a)&&(a(),this.subscriptions.remove(t),this.showsUpdated.remove(t)),!0}return!1},ad.prototype.update=function(e){var t,a=!0,i=0,r=this.primitive,n=this.primitives;if(this.createPrimitive){var o=this.geometry.values;if(o.length>0)Object(s.default)(r)&&(Object(s.default)(this.oldPrimitive)?n.remove(r):this.oldPrimitive=r),r=new _e.a({show:!1,asynchronous:!0,geometryInstances:o.slice(),appearance:new re.a({flat:!0,translucent:this.translucent,renderState:{lineWidth:this.width}}),shadows:this.shadows}),n.add(r),a=!1;else{Object(s.default)(r)&&(n.remove(r),r=void 0);var l=this.oldPrimitive;Object(s.default)(l)&&(n.remove(l),this.oldPrimitive=void 0)}this.attributes.removeAll(),this.primitive=r,this.createPrimitive=!1,this.waitingOnCreate=!0}else if(Object(s.default)(r)&&r.ready){r.show=!0,Object(s.default)(this.oldPrimitive)&&(n.remove(this.oldPrimitive),this.oldPrimitive=void 0);var u=this.updatersWithAttributes.values,d=u.length,f=this.waitingOnCreate;for(t=0;t<d;t++){var c=u[t],h=this.geometry.get(c.id),p=this.attributes.get(h.id.id);if(Object(s.default)(p)||(p=r.getGeometryInstanceAttributes(h.id),this.attributes.set(h.id.id,p)),!c.outlineColorProperty.isConstant||f){var m=c.outlineColorProperty,v=P.default.getValueOrDefault(m,e,b.default.WHITE,Ju);b.default.equals(p._lastColor,v)||(p._lastColor=b.default.clone(v,p._lastColor),p.color=le.a.toValue(v,p.color),(this.translucent&&255===p.color[3]||!this.translucent&&255!==p.color[3])&&(this.itemsToRemove[i++]=c))}var g=c.entity.isShowing&&(c.hasConstantOutline||c.isOutlineVisible(e));g!==(1===p.show[0])&&(p.show=ve.a.toValue(g,p.show));var _=c.distanceDisplayConditionProperty;if(!P.default.isConstant(_)){var O=P.default.getValueOrDefault(_,e,$u,Qu);w.a.equals(O,p._lastDistanceDisplayCondition)||(p._lastDistanceDisplayCondition=w.a.clone(O,p._lastDistanceDisplayCondition),p.distanceDisplayCondition=fe.toValue(O,p.distanceDisplayCondition))}var x=c.terrainOffsetProperty;if(!P.default.isConstant(x)){var A=P.default.getValueOrDefault(x,e,ed,td);y.default.equals(A,p._lastOffset)||(p._lastOffset=y.default.clone(A,p._lastOffset),p.offset=me.a.toValue(A,p.offset))}}this.updateShows(r),this.waitingOnCreate=!1}else Object(s.default)(r)&&!r.ready&&(a=!1);return this.itemsToRemove.length=i,a},ad.prototype.updateShows=function(e){for(var t=this.showsUpdated.values,a=t.length,i=0;i<a;i++){var r=t[i],n=this.geometry.get(r.id),o=this.attributes.get(n.id.id);Object(s.default)(o)||(o=e.getGeometryInstanceAttributes(n.id),this.attributes.set(n.id.id,o));var l=r.entity.isShowing;l!==(1===o.show[0])&&(o.show=ve.a.toValue(l,o.show),n.attributes.show.value[0]=o.show[0])}this.showsUpdated.removeAll()},ad.prototype.contains=function(e){return this.updaters.contains(e.id)},ad.prototype.getBoundingSphere=function(e,t){var a=this.primitive;if(!a.ready)return C.default.PENDING;var i=a.getGeometryInstanceAttributes(e.entity);return!Object(s.default)(i)||!Object(s.default)(i.boundingSphere)||Object(s.default)(i.show)&&0===i.show[0]?C.default.FAILED:(i.boundingSphere.clone(t),C.default.DONE)},ad.prototype.removeAllPrimitives=function(){var e=this.primitives,t=this.primitive;Object(s.default)(t)&&(e.remove(t),this.primitive=void 0,this.geometry.removeAll(),this.updaters.removeAll());var a=this.oldPrimitive;Object(s.default)(a)&&(e.remove(a),this.oldPrimitive=void 0)},id.prototype.add=function(e,t){var a,i,r=t.createOutlineGeometryInstance(e),n=this._scene.clampLineWidth(t.outlineWidth);255===r.attributes.color.value[3]?(i=(a=this._solidBatches).get(n),Object(s.default)(i)||(i=new ad(this._primitives,!1,n,this._shadows),a.set(n,i)),i.add(t,r)):(i=(a=this._translucentBatches).get(n),Object(s.default)(i)||(i=new ad(this._primitives,!0,n,this._shadows),a.set(n,i)),i.add(t,r))},id.prototype.remove=function(e){var t,a=this._solidBatches.values,i=a.length;for(t=0;t<i;t++)if(a[t].remove(e))return;var r=this._translucentBatches.values,n=r.length;for(t=0;t<n;t++)if(r[t].remove(e))return},id.prototype.update=function(e){var t,a,i,r,n,o=this._solidBatches.values,s=o.length,l=this._translucentBatches.values,u=l.length,d=!0,f=!1;do{for(f=!1,a=0;a<s;a++){d=(r=o[a]).update(e);var c=(n=r.itemsToRemove).length;if(c>0)for(f=!0,t=0;t<c;t++)i=n[t],r.remove(i),this.add(e,i)}for(a=0;a<u;a++){d=(r=l[a]).update(e);var h=(n=r.itemsToRemove).length;if(h>0)for(f=!0,t=0;t<h;t++)i=n[t],r.remove(i),this.add(e,i)}}while(f);return d},id.prototype.getBoundingSphere=function(e,t){var a,i=this._solidBatches.values,r=i.length;for(a=0;a<r;a++){var n=i[a];if(n.contains(e))return n.getBoundingSphere(e,t)}var o=this._translucentBatches.values,s=o.length;for(a=0;a<s;a++){var l=o[a];if(l.contains(e))return l.getBoundingSphere(e,t)}return C.default.FAILED},id.prototype.removeAllPrimitives=function(){var e,t=this._solidBatches.values,a=t.length;for(e=0;e<a;e++)t[e].removeAllPrimitives();var i=this._translucentBatches.values,r=i.length;for(e=0;e<r;e++)i[e].removeAllPrimitives()};var rd=id,nd={};function od(e,t){return Fe.default.equalsEpsilon(e.latitude,t.latitude,Fe.default.EPSILON14)&&Fe.default.equalsEpsilon(e.longitude,t.longitude,Fe.default.EPSILON14)}var sd=new Ne.default,ld=new Ne.default;var ud=new Array(2),dd=new Array(2),fd={positions:void 0,height:void 0,granularity:void 0,ellipsoid:void 0};nd.computePositions=function(e,t,a,i,r,n){var o=function(e,t,a,i){var r=t.length;if(!(r<2)){var n=Object(s.default)(i),o=Object(s.default)(a),l=!0,u=new Array(r),d=new Array(r),f=new Array(r),c=t[0];u[0]=c;var h=e.cartesianToCartographic(c,sd);o&&(h.height=a[0]),l=l&&h.height<=0,d[0]=h.height,f[0]=n?i[0]:0;for(var p=1,m=1;m<r;++m){var v=t[m],g=e.cartesianToCartographic(v,ld);o&&(g.height=a[m]),l=l&&g.height<=0,od(h,g)?h.height<g.height&&(d[p-1]=g.height):(u[p]=v,d[p]=g.height,f[p]=n?i[m]:0,Ne.default.clone(g,h),++p)}if(!(l||p<2))return u.length=p,d.length=p,f.length=p,{positions:u,topHeights:d,bottomHeights:f}}}(e,t,a,i);if(Object(s.default)(o)){if(t=o.positions,a=o.topHeights,i=o.bottomHeights,t.length>=3){var l=Lt.default.fromPoints(t,e).projectPointsOntoPlane(t);Ka.a.computeWindingOrder2D(l)===ko.default.CLOCKWISE&&(t.reverse(),a.reverse(),i.reverse())}var u,d,f=t.length,c=f-2,h=Fe.default.chordLength(r,e.maximumRadius),p=fd;if(p.minDistance=h,p.ellipsoid=e,n){var m,v=0;for(m=0;m<f-1;m++)v+=Mt.numberOfPoints(t[m],t[m+1],h)+1;u=new Float64Array(3*v),d=new Float64Array(3*v);var g=ud,_=dd;p.positions=g,p.height=_;var y=0;for(m=0;m<f-1;m++){g[0]=t[m],g[1]=t[m+1],_[0]=a[m],_[1]=a[m+1];var b=Mt.generateArc(p);u.set(b,y),_[0]=i[m],_[1]=i[m+1],d.set(Mt.generateArc(p),y),y+=b.length}}else p.positions=t,p.height=a,u=new Float64Array(Mt.generateArc(p)),p.height=i,d=new Float64Array(Mt.generateArc(p));return{bottomPositions:d,topPositions:u,numCorners:c}}};var cd=nd,hd=new y.default,pd=new y.default,md=new y.default,vd=new y.default,gd=new y.default,_d=new y.default,yd=new y.default,bd=new y.default;function Od(e){var t=(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).positions,a=e.maximumHeights,i=e.minimumHeights,r=Object(o.default)(e.vertexFormat,$.default.DEFAULT),n=Object(o.default)(e.granularity,Fe.default.RADIANS_PER_DEGREE),l=Object(o.default)(e.ellipsoid,it.default.WGS84);this._positions=t,this._minimumHeights=i,this._maximumHeights=a,this._vertexFormat=$.default.clone(r),this._granularity=n,this._ellipsoid=it.default.clone(l),this._workerName="createWallGeometry";var u=1+t.length*y.default.packedLength+2;Object(s.default)(i)&&(u+=i.length),Object(s.default)(a)&&(u+=a.length),this.packedLength=u+it.default.packedLength+$.default.packedLength+1}Od.pack=function(e,t,a){var i;a=Object(o.default)(a,0);var r=e._positions,n=r.length;for(t[a++]=n,i=0;i<n;++i,a+=y.default.packedLength)y.default.pack(r[i],t,a);var l=e._minimumHeights;if(n=Object(s.default)(l)?l.length:0,t[a++]=n,Object(s.default)(l))for(i=0;i<n;++i)t[a++]=l[i];var u=e._maximumHeights;if(n=Object(s.default)(u)?u.length:0,t[a++]=n,Object(s.default)(u))for(i=0;i<n;++i)t[a++]=u[i];return it.default.pack(e._ellipsoid,t,a),a+=it.default.packedLength,$.default.pack(e._vertexFormat,t,a),t[a+=$.default.packedLength]=e._granularity,t};var wd=it.default.clone(it.default.UNIT_SPHERE),xd=new $.default,Ad={positions:void 0,minimumHeights:void 0,maximumHeights:void 0,ellipsoid:wd,vertexFormat:xd,granularity:void 0};Od.unpack=function(e,t,a){var i;t=Object(o.default)(t,0);var r,n,l=e[t++],u=new Array(l);for(i=0;i<l;++i,t+=y.default.packedLength)u[i]=y.default.unpack(e,t);if((l=e[t++])>0)for(r=new Array(l),i=0;i<l;++i)r[i]=e[t++];if((l=e[t++])>0)for(n=new Array(l),i=0;i<l;++i)n[i]=e[t++];var d=it.default.unpack(e,t,wd);t+=it.default.packedLength;var f=$.default.unpack(e,t,xd),c=e[t+=$.default.packedLength];return Object(s.default)(a)?(a._positions=u,a._minimumHeights=r,a._maximumHeights=n,a._ellipsoid=it.default.clone(d,a._ellipsoid),a._vertexFormat=$.default.clone(f,a._vertexFormat),a._granularity=c,a):(Ad.positions=u,Ad.minimumHeights=r,Ad.maximumHeights=n,Ad.granularity=c,new Od(Ad))},Od.fromConstantHeights=function(e){var t,a,i=(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).positions,r=e.minimumHeight,n=e.maximumHeight,l=Object(s.default)(r),u=Object(s.default)(n);if(l||u){var d=i.length;t=l?new Array(d):void 0,a=u?new Array(d):void 0;for(var f=0;f<d;++f)l&&(t[f]=r),u&&(a[f]=n)}return new Od({positions:i,maximumHeights:a,minimumHeights:t,ellipsoid:e.ellipsoid,vertexFormat:e.vertexFormat})},Od.createGeometry=function(e){var t=e._positions,a=e._minimumHeights,i=e._maximumHeights,n=e._vertexFormat,o=e._granularity,l=e._ellipsoid,u=cd.computePositions(l,t,i,a,o,!0);if(Object(s.default)(u)){var d,f=u.bottomPositions,c=u.topPositions,h=u.numCorners,p=c.length,m=2*p,v=n.position?new Float64Array(m):void 0,g=n.normal?new Float32Array(m):void 0,_=n.tangent?new Float32Array(m):void 0,b=n.bitangent?new Float32Array(m):void 0,O=n.st?new Float32Array(m/3*2):void 0,w=0,x=0,A=0,j=0,E=0,C=bd,P=yd,T=_d,D=!0,I=0,S=1/((p/=3)-t.length+1);for(d=0;d<p;++d){var M=3*d,R=y.default.fromArray(c,M,hd),L=y.default.fromArray(f,M,pd);if(n.position&&(v[w++]=L.x,v[w++]=L.y,v[w++]=L.z,v[w++]=R.x,v[w++]=R.y,v[w++]=R.z),n.st&&(O[E++]=I,O[E++]=0,O[E++]=I,O[E++]=1),n.normal||n.tangent||n.bitangent){var V,N=y.default.clone(y.default.ZERO,gd),F=l.scaleToGeodeticSurface(y.default.fromArray(c,M,pd),pd);if(d+1<p&&(V=l.scaleToGeodeticSurface(y.default.fromArray(c,M+3,md),md),N=y.default.fromArray(c,M+3,gd)),D){var B=y.default.subtract(N,R,vd),U=y.default.subtract(F,R,hd);C=y.default.normalize(y.default.cross(U,B,C),C),D=!1}y.default.equalsEpsilon(V,F,Fe.default.EPSILON10)?D=!0:(I+=S,n.tangent&&(P=y.default.normalize(y.default.subtract(V,F,P),P)),n.bitangent&&(T=y.default.normalize(y.default.cross(C,P,T),T))),n.normal&&(g[x++]=C.x,g[x++]=C.y,g[x++]=C.z,g[x++]=C.x,g[x++]=C.y,g[x++]=C.z),n.tangent&&(_[j++]=P.x,_[j++]=P.y,_[j++]=P.z,_[j++]=P.x,_[j++]=P.y,_[j++]=P.z),n.bitangent&&(b[A++]=T.x,b[A++]=T.y,b[A++]=T.z,b[A++]=T.x,b[A++]=T.y,b[A++]=T.z)}}var H=new Wa.a;n.position&&(H.position=new qa.a({componentDatatype:ue.a.DOUBLE,componentsPerAttribute:3,values:v})),n.normal&&(H.normal=new qa.a({componentDatatype:ue.a.FLOAT,componentsPerAttribute:3,values:g})),n.tangent&&(H.tangent=new qa.a({componentDatatype:ue.a.FLOAT,componentsPerAttribute:3,values:_})),n.bitangent&&(H.bitangent=new qa.a({componentDatatype:ue.a.FLOAT,componentsPerAttribute:3,values:b})),n.st&&(H.st=new qa.a({componentDatatype:ue.a.FLOAT,componentsPerAttribute:2,values:O}));var k=m/3;m-=6*(h+1);var z=Ya.a.createTypedArray(k,m),G=0;for(d=0;d<k-2;d+=2){var q=d,W=d+2,Y=y.default.fromArray(v,3*q,hd),K=y.default.fromArray(v,3*W,pd);if(!y.default.equalsEpsilon(Y,K,Fe.default.EPSILON10)){var X=d+1,Z=d+3;z[G++]=X,z[G++]=q,z[G++]=Z,z[G++]=Z,z[G++]=q,z[G++]=W}}return new Ga.a({attributes:H,indices:z,primitiveType:Xa.a.TRIANGLES,boundingSphere:new r.default.fromVertices(v)})}};var jd=Od,Ed=new y.default,Cd=new y.default;function Pd(e){var t=(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).positions,a=e.maximumHeights,i=e.minimumHeights,r=Object(o.default)(e.granularity,Fe.default.RADIANS_PER_DEGREE),n=Object(o.default)(e.ellipsoid,it.default.WGS84);this._positions=t,this._minimumHeights=i,this._maximumHeights=a,this._granularity=r,this._ellipsoid=it.default.clone(n),this._workerName="createWallOutlineGeometry";var l=1+t.length*y.default.packedLength+2;Object(s.default)(i)&&(l+=i.length),Object(s.default)(a)&&(l+=a.length),this.packedLength=l+it.default.packedLength+1}Pd.pack=function(e,t,a){var i;a=Object(o.default)(a,0);var r=e._positions,n=r.length;for(t[a++]=n,i=0;i<n;++i,a+=y.default.packedLength)y.default.pack(r[i],t,a);var l=e._minimumHeights;if(n=Object(s.default)(l)?l.length:0,t[a++]=n,Object(s.default)(l))for(i=0;i<n;++i)t[a++]=l[i];var u=e._maximumHeights;if(n=Object(s.default)(u)?u.length:0,t[a++]=n,Object(s.default)(u))for(i=0;i<n;++i)t[a++]=u[i];return it.default.pack(e._ellipsoid,t,a),t[a+=it.default.packedLength]=e._granularity,t};var Td=it.default.clone(it.default.UNIT_SPHERE),Dd={positions:void 0,minimumHeights:void 0,maximumHeights:void 0,ellipsoid:Td,granularity:void 0};Pd.unpack=function(e,t,a){var i;t=Object(o.default)(t,0);var r,n,l=e[t++],u=new Array(l);for(i=0;i<l;++i,t+=y.default.packedLength)u[i]=y.default.unpack(e,t);if((l=e[t++])>0)for(r=new Array(l),i=0;i<l;++i)r[i]=e[t++];if((l=e[t++])>0)for(n=new Array(l),i=0;i<l;++i)n[i]=e[t++];var d=it.default.unpack(e,t,Td),f=e[t+=it.default.packedLength];return Object(s.default)(a)?(a._positions=u,a._minimumHeights=r,a._maximumHeights=n,a._ellipsoid=it.default.clone(d,a._ellipsoid),a._granularity=f,a):(Dd.positions=u,Dd.minimumHeights=r,Dd.maximumHeights=n,Dd.granularity=f,new Pd(Dd))},Pd.fromConstantHeights=function(e){var t,a,i=(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).positions,r=e.minimumHeight,n=e.maximumHeight,l=Object(s.default)(r),u=Object(s.default)(n);if(l||u){var d=i.length;t=l?new Array(d):void 0,a=u?new Array(d):void 0;for(var f=0;f<d;++f)l&&(t[f]=r),u&&(a[f]=n)}return new Pd({positions:i,maximumHeights:a,minimumHeights:t,ellipsoid:e.ellipsoid})},Pd.createGeometry=function(e){var t=e._positions,a=e._minimumHeights,i=e._maximumHeights,n=e._granularity,o=e._ellipsoid,l=cd.computePositions(o,t,i,a,n,!1);if(Object(s.default)(l)){var u,d=l.bottomPositions,f=l.topPositions,c=f.length,h=2*c,p=new Float64Array(h),m=0;for(c/=3,u=0;u<c;++u){var v=3*u,g=y.default.fromArray(f,v,Ed),_=y.default.fromArray(d,v,Cd);p[m++]=_.x,p[m++]=_.y,p[m++]=_.z,p[m++]=g.x,p[m++]=g.y,p[m++]=g.z}var b=new Wa.a({position:new qa.a({componentDatatype:ue.a.DOUBLE,componentsPerAttribute:3,values:p})}),O=h/3;h=2*O-4+O;var w=Ya.a.createTypedArray(O,h),x=0;for(u=0;u<O-2;u+=2){var A=u,j=u+2,E=y.default.fromArray(p,3*A,Ed),C=y.default.fromArray(p,3*j,Cd);if(!y.default.equalsEpsilon(E,C,Fe.default.EPSILON10)){var P=u+1,T=u+3;w[x++]=P,w[x++]=A,w[x++]=P,w[x++]=T,w[x++]=A,w[x++]=j}}return w[x++]=O-2,w[x++]=O-1,new Ga.a({attributes:b,indices:w,primitiveType:Xa.a.LINES,boundingSphere:new r.default.fromVertices(p)})}};var Id=Pd,Sd=new b.default;function Md(e){this.id=e,this.vertexFormat=void 0,this.positions=void 0,this.minimumHeights=void 0,this.maximumHeights=void 0,this.granularity=void 0}function Rd(e,t){Le.call(this,{entity:e,scene:t,geometryOptions:new Md(e),geometryPropertyName:"wall",observedPropertyNames:["availability","wall"]}),this._onEntityPropertyChanged(e,"wall",e.wall,void 0)}function Ld(e,t,a){we.call(this,e,t,a)}Object(s.default)(Object.create)&&(Rd.prototype=Object.create(Le.prototype),Rd.prototype.constructor=Rd),Rd.prototype.createFillGeometryInstance=function(e){var t,a,i=this._entity,r=i.isAvailable(e),n=new ve.a(r&&i.isShowing&&this._showProperty.getValue(e)&&this._fillProperty.getValue(e)),o=this._distanceDisplayConditionProperty.getValue(e),l=fe.fromDistanceDisplayCondition(o);this._materialProperty instanceof ge.default?(Object(s.default)(this._materialProperty.color)&&(this._materialProperty.color.isConstant||r)&&(a=this._materialProperty.color.getValue(e,Sd)),Object(s.default)(a)||(a=b.default.WHITE),t={show:n,distanceDisplayCondition:l,color:le.a.fromColor(a)}):t={show:n,distanceDisplayCondition:l};return new ce.a({id:i,geometry:new jd(this._options),attributes:t})},Rd.prototype.createOutlineGeometryInstance=function(e){var t=this._entity,a=t.isAvailable(e),i=P.default.getValueOrDefault(this._outlineColorProperty,e,b.default.BLACK,Sd),r=this._distanceDisplayConditionProperty.getValue(e);return new ce.a({id:t,geometry:new Id(this._options),attributes:{show:new ve.a(a&&t.isShowing&&this._showProperty.getValue(e)&&this._showOutlineProperty.getValue(e)),color:le.a.fromColor(i),distanceDisplayCondition:fe.fromDistanceDisplayCondition(r)}})},Rd.prototype._isHidden=function(e,t){return!Object(s.default)(t.positions)||Le.prototype._isHidden.call(this,e,t)},Rd.prototype._getIsClosed=function(e){return!1},Rd.prototype._isDynamic=function(e,t){return!(t.positions.isConstant&&P.default.isConstant(t.minimumHeights)&&P.default.isConstant(t.maximumHeights)&&P.default.isConstant(t.outlineWidth)&&P.default.isConstant(t.granularity))},Rd.prototype._setStaticOptions=function(e,t){var a=t.minimumHeights,i=t.maximumHeights,r=t.granularity,n=this._materialProperty instanceof ge.default,o=this._options;o.vertexFormat=n?re.a.VERTEX_FORMAT:ie.MaterialSupport.TEXTURED.vertexFormat,o.positions=t.positions.getValue(pe.default.MINIMUM_VALUE,o.positions),o.minimumHeights=Object(s.default)(a)?a.getValue(pe.default.MINIMUM_VALUE,o.minimumHeights):void 0,o.maximumHeights=Object(s.default)(i)?i.getValue(pe.default.MINIMUM_VALUE,o.maximumHeights):void 0,o.granularity=Object(s.default)(r)?r.getValue(pe.default.MINIMUM_VALUE):void 0},Rd.DynamicGeometryUpdater=Ld,Object(s.default)(Object.create)&&(Ld.prototype=Object.create(we.prototype),Ld.prototype.constructor=Ld),Ld.prototype._isHidden=function(e,t,a){return!Object(s.default)(this._options.positions)||we.prototype._isHidden.call(this,e,t,a)},Ld.prototype._setOptions=function(e,t,a){var i=this._options;i.positions=P.default.getValueOrUndefined(t.positions,a,i.positions),i.minimumHeights=P.default.getValueOrUndefined(t.minimumHeights,a,i.minimumHeights),i.maximumHeights=P.default.getValueOrUndefined(t.maximumHeights,a,i.maximumHeights),i.granularity=P.default.getValueOrUndefined(t.granularity,a)};var Vd=[],Nd=[Qe,cr,ki,wn,Ln,no,Us,al,Yl,Rd];function Fd(e,t){this.entity=e,this.scene=t;var a=new Array(Nd.length),i=new Z.default;function r(e){i.raiseEvent(e)}for(var n=new d.default,o=0;o<a.length;o++){var s=new Nd[o](e,t);n.add(s.geometryChanged,r),a[o]=s}this.updaters=a,this.geometryChanged=i,this.eventHelper=n,this._removeEntitySubscription=e.definitionChanged.addEventListener(Fd.prototype._onEntityPropertyChanged,this)}function Bd(e,t,a,i){a=Object(o.default)(a,e.primitives),i=Object(o.default)(i,e.groundPrimitives),this._scene=e,this._primitives=a,this._groundPrimitives=i,this._entityCollection=void 0,this._addedObjects=new v.default,this._removedObjects=new v.default,this._changedObjects=new v.default;var r=ne.a.NUMBER_OF_SHADOW_MODES;this._outlineBatches=new Array(2*r),this._closedColorBatches=new Array(2*r),this._closedMaterialBatches=new Array(2*r),this._openColorBatches=new Array(2*r),this._openMaterialBatches=new Array(2*r);var n,s=je.default.supportsMaterialsforEntitiesOnTerrain(e);for(this._supportsMaterialsforEntitiesOnTerrain=s,n=0;n<r;++n)this._outlineBatches[n]=new rd(a,e,n,!1),this._outlineBatches[r+n]=new rd(a,e,n,!0),this._closedColorBatches[n]=new ou(a,re.a,void 0,!0,n,!0),this._closedColorBatches[r+n]=new ou(a,re.a,void 0,!0,n,!1),this._closedMaterialBatches[n]=new pu(a,ie,void 0,!0,n,!0),this._closedMaterialBatches[r+n]=new pu(a,ie,void 0,!0,n,!1),this._openColorBatches[n]=new ou(a,re.a,void 0,!1,n,!0),this._openColorBatches[r+n]=new ou(a,re.a,void 0,!1,n,!1),this._openMaterialBatches[n]=new pu(a,ie,void 0,!1,n,!0),this._openMaterialBatches[r+n]=new pu(a,ie,void 0,!1,n,!1);var l=J.a.NUMBER_OF_CLASSIFICATION_TYPES,u=new Array(l),d=[];if(s)for(n=0;n<l;++n)d.push(new Zu(i,n,ie)),u[n]=new Zu(i,n,re.a);else for(n=0;n<l;++n)u[n]=new Ou(i,n);this._groundColorBatches=u,this._groundMaterialBatches=d,this._dynamicBatch=new pr(a,i),this._batches=this._outlineBatches.concat(this._closedColorBatches,this._closedMaterialBatches,this._openColorBatches,this._openMaterialBatches,this._groundColorBatches,this._groundMaterialBatches,this._dynamicBatch),this._subscriptions=new v.default,this._updaterSets=new v.default,this._entityCollection=t,t.collectionChanged.addEventListener(Bd.prototype._onCollectionChanged,this),this._onCollectionChanged(t,t.values,Vd)}Fd.prototype._onEntityPropertyChanged=function(e,t,a,i){for(var r=this.updaters,n=0;n<r.length;n++)r[n]._onEntityPropertyChanged(e,t,a,i)},Fd.prototype.forEach=function(e){for(var t=this.updaters,a=0;a<t.length;a++)e(t[a])},Fd.prototype.destroy=function(){this.eventHelper.removeAll();for(var e=this.updaters,t=0;t<e.length;t++)e[t].destroy();this._removeEntitySubscription(),Object(u.default)(this)},Bd.prototype.update=function(e){var t,a,i,r,n=this._addedObjects,o=n.values,s=this._removedObjects,l=s.values,u=this._changedObjects,d=u.values,f=this;for(t=d.length-1;t>-1;t--)i=(a=d[t]).id,(r=this._updaterSets.get(i)).entity===a?r.forEach((function(t){f._removeUpdater(t),f._insertUpdaterIntoBatch(e,t)})):(l.push(a),o.push(a));for(t=l.length-1;t>-1;t--)i=(a=l[t]).id,(r=this._updaterSets.get(i)).forEach(this._removeUpdater.bind(this)),r.destroy(),this._updaterSets.remove(i),this._subscriptions.get(i)(),this._subscriptions.remove(i);for(t=o.length-1;t>-1;t--)i=(a=o[t]).id,r=new Fd(a,this._scene),this._updaterSets.set(i,r),r.forEach((function(t){f._insertUpdaterIntoBatch(e,t)})),this._subscriptions.set(i,r.geometryChanged.addEventListener(Bd._onGeometryChanged,this));n.removeAll(),s.removeAll(),u.removeAll();var c=!0,h=this._batches,p=h.length;for(t=0;t<p;t++)c=h[t].update(e)&&c;return c};var Ud=[],Hd=new r.default;Bd.prototype.getBoundingSphere=function(e,t){for(var a=Ud,i=Hd,n=0,o=C.default.DONE,s=this._batches,l=s.length,u=e.id,d=this._updaterSets.get(u).updaters,f=0;f<d.length;f++)for(var c=d[f],h=0;h<l;h++){if((o=s[h].getBoundingSphere(c,i))===C.default.PENDING)return C.default.PENDING;o===C.default.DONE&&(a[n]=r.default.clone(i,a[n]),n++)}return 0===n?C.default.FAILED:(a.length=n,r.default.fromBoundingSpheres(a,t),C.default.DONE)},Bd.prototype.isDestroyed=function(){return!1},Bd.prototype.destroy=function(){var e;this._entityCollection.collectionChanged.removeEventListener(Bd.prototype._onCollectionChanged,this),this._addedObjects.removeAll(),this._removedObjects.removeAll();var t=this._batches,a=t.length;for(e=0;e<a;e++)t[e].removeAllPrimitives();var i=this._subscriptions.values;for(a=i.length,e=0;e<a;e++)i[e]();this._subscriptions.removeAll();var r=this._updaterSets.values;for(a=r.length,e=0;e<a;e++)r[e].destroy();return this._updaterSets.removeAll(),Object(u.default)(this)},Bd.prototype._removeUpdater=function(e){for(var t=this._batches,a=t.length,i=0;i<a;i++)t[i].remove(e)},Bd.prototype._insertUpdaterIntoBatch=function(e,t){if(t.isDynamic)this._dynamicBatch.add(e,t);else{var a;(t.outlineEnabled||t.fillEnabled)&&(a=t.shadowsProperty.getValue(e));var i=ne.a.NUMBER_OF_SHADOW_MODES;if(t.outlineEnabled&&(Object(s.default)(t.terrainOffsetProperty)?this._outlineBatches[i+a].add(e,t):this._outlineBatches[a].add(e,t)),t.fillEnabled)if(t.onTerrain){var r=t.classificationTypeProperty.getValue(e);t.fillMaterialProperty instanceof ge.default?this._groundColorBatches[r].add(e,t):this._groundMaterialBatches[r].add(e,t)}else t.isClosed?t.fillMaterialProperty instanceof ge.default?Object(s.default)(t.terrainOffsetProperty)?this._closedColorBatches[i+a].add(e,t):this._closedColorBatches[a].add(e,t):Object(s.default)(t.terrainOffsetProperty)?this._closedMaterialBatches[i+a].add(e,t):this._closedMaterialBatches[a].add(e,t):t.fillMaterialProperty instanceof ge.default?Object(s.default)(t.terrainOffsetProperty)?this._openColorBatches[i+a].add(e,t):this._openColorBatches[a].add(e,t):Object(s.default)(t.terrainOffsetProperty)?this._openMaterialBatches[i+a].add(e,t):this._openMaterialBatches[a].add(e,t)}},Bd._onGeometryChanged=function(e){var t=this._removedObjects,a=this._changedObjects,i=e.entity,r=i.id;Object(s.default)(t.get(r))||Object(s.default)(a.get(r))||a.set(r,i)},Bd.prototype._onCollectionChanged=function(e,t,a){var i,r,n,o=this._addedObjects,s=this._removedObjects,l=this._changedObjects;for(i=a.length-1;i>-1;i--)r=(n=a[i]).id,o.remove(r)||(s.set(r,n),l.remove(r));for(i=t.length-1;i>-1;i--)r=(n=t[i]).id,s.remove(r)?l.set(r,n):o.set(r,n)};var kd=Bd,zd=a(191),Gd=zd.a.FILL,qd=b.default.WHITE,Wd=b.default.BLACK,Yd=new b.default(.165,.165,.165,.8),Kd=new _.default(7,5),Xd=_.default.ZERO,Zd=y.default.ZERO,Jd=A.default.NONE,Qd=j.default.CENTER,$d=E.default.CENTER,ef=new y.default,tf=new b.default,af=new b.default,rf=new b.default,nf=new _.default,of=new y.default,sf=new _.default,lf=new x.a,uf=new x.a,df=new x.a,ff=new w.a;function cf(e){this.entity=e,this.label=void 0,this.index=void 0}function hf(e,t){t.collectionChanged.addEventListener(hf.prototype._onCollectionChanged,this),this._cluster=e,this._entityCollection=t,this._items=new v.default,this._onCollectionChanged(t,t.values,[],[])}function pf(e,t,a){Object(s.default)(e)&&(e.label=void 0,a.removeLabel(t))}hf.prototype.update=function(e){for(var t=this._items.values,a=this._cluster,i=0,r=t.length;i<r;i++){var n,o,l=t[i],u=l.entity,d=u._label,f=l.label,c=u.isShowing&&u.isAvailable(e)&&P.default.getValueOrDefault(d._show,e,!0);if(c&&(o=P.default.getValueOrUndefined(u._position,e,ef),n=P.default.getValueOrUndefined(d._text,e),c=Object(s.default)(o)&&Object(s.default)(n)),c){P.default.isConstant(u._position)||(a._clusterDirty=!0);var h=!1,p=P.default.getValueOrDefault(d._heightReference,e,Jd);Object(s.default)(f)||((f=a.getLabel(u)).id=u,l.label=f,h=y.default.equals(f.position,o)&&f.heightReference===p),f.show=!0,f.position=o,f.text=n,f.scale=P.default.getValueOrDefault(d._scale,e,1),f.font=P.default.getValueOrDefault(d._font,e,"30px sans-serif"),f.style=P.default.getValueOrDefault(d._style,e,Gd),f.fillColor=P.default.getValueOrDefault(d._fillColor,e,qd,tf),f.outlineColor=P.default.getValueOrDefault(d._outlineColor,e,Wd,af),f.outlineWidth=P.default.getValueOrDefault(d._outlineWidth,e,1),f.showBackground=P.default.getValueOrDefault(d._showBackground,e,!1),f.backgroundColor=P.default.getValueOrDefault(d._backgroundColor,e,Yd,rf),f.backgroundPadding=P.default.getValueOrDefault(d._backgroundPadding,e,Kd,nf),f.pixelOffset=P.default.getValueOrDefault(d._pixelOffset,e,Xd,sf),f.eyeOffset=P.default.getValueOrDefault(d._eyeOffset,e,Zd,of),f.heightReference=p,f.horizontalOrigin=P.default.getValueOrDefault(d._horizontalOrigin,e,Qd),f.verticalOrigin=P.default.getValueOrDefault(d._verticalOrigin,e,$d),f.translucencyByDistance=P.default.getValueOrUndefined(d._translucencyByDistance,e,lf),f.pixelOffsetScaleByDistance=P.default.getValueOrUndefined(d._pixelOffsetScaleByDistance,e,uf),f.scaleByDistance=P.default.getValueOrUndefined(d._scaleByDistance,e,df),f.distanceDisplayCondition=P.default.getValueOrUndefined(d._distanceDisplayCondition,e,ff),f.disableDepthTestDistance=P.default.getValueOrUndefined(d._disableDepthTestDistance,e),h&&f._updateClamping()}else pf(l,u,a)}return!0},hf.prototype.getBoundingSphere=function(e,t){var a=this._items.get(e.id);if(!Object(s.default)(a)||!Object(s.default)(a.label))return C.default.FAILED;var i=a.label;return t.center=y.default.clone(Object(o.default)(i._clampedPosition,i.position),t.center),t.radius=0,C.default.DONE},hf.prototype.isDestroyed=function(){return!1},hf.prototype.destroy=function(){this._entityCollection.collectionChanged.removeEventListener(hf.prototype._onCollectionChanged,this);for(var e=this._entityCollection.values,t=0;t<e.length;t++)this._cluster.removeLabel(e[t]);return Object(u.default)(this)},hf.prototype._onCollectionChanged=function(e,t,a,i){var r,n,o=this._items,l=this._cluster;for(r=t.length-1;r>-1;r--)n=t[r],Object(s.default)(n._label)&&Object(s.default)(n._position)&&o.set(n.id,new cf(n));for(r=i.length-1;r>-1;r--)n=i[r],Object(s.default)(n._label)&&Object(s.default)(n._position)?o.contains(n.id)||o.set(n.id,new cf(n)):(pf(o.get(n.id),n,l),o.remove(n.id));for(r=a.length-1;r>-1;r--)n=a[r],pf(o.get(n.id),n,l),o.remove(n.id)};var mf=hf,vf={X:0,Y:1,Z:2,Y_UP_TO_Z_UP:lt.default.fromRotationTranslation(at.default.fromRotationX(Fe.default.PI_OVER_TWO)),Z_UP_TO_Y_UP:lt.default.fromRotationTranslation(at.default.fromRotationX(-Fe.default.PI_OVER_TWO)),X_UP_TO_Z_UP:lt.default.fromRotationTranslation(at.default.fromRotationY(-Fe.default.PI_OVER_TWO)),Z_UP_TO_X_UP:lt.default.fromRotationTranslation(at.default.fromRotationY(Fe.default.PI_OVER_TWO)),X_UP_TO_Y_UP:lt.default.fromRotationTranslation(at.default.fromRotationZ(Fe.default.PI_OVER_TWO)),Y_UP_TO_X_UP:lt.default.fromRotationTranslation(at.default.fromRotationZ(-Fe.default.PI_OVER_TWO)),fromName:function(e){return vf[e]}},gf=Object(Q.default)(vf),_f=a(29),yf=a(1623),bf=a(51),Of=a(61),wf=a(71),xf=a(77),Af=a(283),jf=a(517);var Ef=function(e,t){return t=Object(o.default)(t,0),Object(jf.a)(e,t,Math.min(4,e.length))},Cf=a(387),Pf=a(18);var Tf=function(e){var t,a=e.uint8Array,i=e.format,r=e.request,n=Object(o.default)(e.flipY,!1),l=new Blob([a],{type:i});return _f.default.supportsImageBitmapOptions().then((function(e){return e?Object(Pf.default)(_f.default.createImageBitmapFromBlob(l,{flipY:n,premultiplyAlpha:!1})):(t=window.URL.createObjectURL(l),new _f.default({url:t,request:r}).fetchImage({flipY:n}))})).then((function(e){return Object(s.default)(t)&&window.URL.revokeObjectURL(t),e})).otherwise((function(e){return Object(s.default)(t)&&window.URL.revokeObjectURL(t),Pf.default.reject(e)}))},Df=a(285),If=a(27),Sf=a(10),Mf=a(109),Rf=a(45),Lf=a(47),Vf=a(30),Nf=a(37),Ff=a(66),Bf=a(62),Uf=a(32),Hf=a(41),kf=a(54),zf=a(52),Gf=a(112);var qf=function(e,t,a){if(a=Object(o.default)(a,!1)){var i=e.indexOf(t);if(i>-1)return i}return e.push(t),e.length-1};var Wf=function(e,t){return Object(s.default)(e.extensionsUsed)&&e.extensionsUsed.indexOf(t)>=0};function Yf(){}Yf.objectLegacy=function(e,t){if(Object(s.default)(e))for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var i=t(e[a],a);if(Object(s.default)(i))return i}},Yf.object=function(e,t){if(Object(s.default)(e))for(var a=e.length,i=0;i<a;i++){var r=t(e[i],i);if(Object(s.default)(r))return r}},Yf.topLevel=function(e,t,a){var i=e[t];return Object(s.default)(i)&&!Object(st.default)(i)?Yf.objectLegacy(i,a):Yf.object(i,a)},Yf.accessor=function(e,t){return Yf.topLevel(e,"accessors",t)},Yf.accessorWithSemantic=function(e,t,a){var i={};return Yf.mesh(e,(function(e){return Yf.meshPrimitive(e,(function(e){var r=Yf.meshPrimitiveAttribute(e,(function(e,r){if(0===r.indexOf(t)&&!Object(s.default)(i[e])){i[e]=!0;var n=a(e);if(Object(s.default)(n))return n}}));return Object(s.default)(r)?r:Yf.meshPrimitiveTarget(e,(function(e){return Yf.meshPrimitiveTargetAttribute(e,(function(e,r){if(0===r.indexOf(t)&&!Object(s.default)(i[e])){i[e]=!0;var n=a(e);if(Object(s.default)(n))return n}}))}))}))}))},Yf.accessorContainingVertexAttributeData=function(e,t){var a={};return Yf.mesh(e,(function(e){return Yf.meshPrimitive(e,(function(e){var i=Yf.meshPrimitiveAttribute(e,(function(e){if(!Object(s.default)(a[e])){a[e]=!0;var i=t(e);if(Object(s.default)(i))return i}}));return Object(s.default)(i)?i:Yf.meshPrimitiveTarget(e,(function(e){return Yf.meshPrimitiveTargetAttribute(e,(function(e){if(!Object(s.default)(a[e])){a[e]=!0;var i=t(e);if(Object(s.default)(i))return i}}))}))}))}))},Yf.accessorContainingIndexData=function(e,t){var a={};return Yf.mesh(e,(function(e){return Yf.meshPrimitive(e,(function(e){var i=e.indices;if(Object(s.default)(i)&&!Object(s.default)(a[i])){a[i]=!0;var r=t(i);if(Object(s.default)(r))return r}}))}))},Yf.animation=function(e,t){return Yf.topLevel(e,"animations",t)},Yf.animationChannel=function(e,t){var a=e.channels;return Yf.object(a,t)},Yf.animationSampler=function(e,t){var a=e.samplers;return Yf.object(a,t)},Yf.buffer=function(e,t){return Yf.topLevel(e,"buffers",t)},Yf.bufferView=function(e,t){return Yf.topLevel(e,"bufferViews",t)},Yf.camera=function(e,t){return Yf.topLevel(e,"cameras",t)},Yf.image=function(e,t){return Yf.topLevel(e,"images",t)},Yf.compressedImage=function(e,t){if(Object(s.default)(e.extras)){var a=e.extras.compressedImage3DTiles;for(var i in a)if(Object.prototype.hasOwnProperty.call(a,i)){var r=t(a[i],i);if(Object(s.default)(r))return r}}},Yf.material=function(e,t){return Yf.topLevel(e,"materials",t)},Yf.materialValue=function(e,t){var a=e.values;for(var i in Object(s.default)(e.extensions)&&Object(s.default)(e.extensions.KHR_techniques_webgl)&&(a=e.extensions.KHR_techniques_webgl.values),a)if(Object.prototype.hasOwnProperty.call(a,i)){var r=t(a[i],i);if(Object(s.default)(r))return r}},Yf.mesh=function(e,t){return Yf.topLevel(e,"meshes",t)},Yf.meshPrimitive=function(e,t){var a=e.primitives;if(Object(s.default)(a))for(var i=a.length,r=0;r<i;r++){var n=t(a[r],r);if(Object(s.default)(n))return n}},Yf.meshPrimitiveAttribute=function(e,t){var a=e.attributes;for(var i in a)if(Object.prototype.hasOwnProperty.call(a,i)){var r=t(a[i],i);if(Object(s.default)(r))return r}},Yf.meshPrimitiveTarget=function(e,t){var a=e.targets;if(Object(s.default)(a))for(var i=a.length,r=0;r<i;++r){var n=t(a[r],r);if(Object(s.default)(n))return n}},Yf.meshPrimitiveTargetAttribute=function(e,t){for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var i=t(e[a],a);if(Object(s.default)(i))return i}},Yf.node=function(e,t){return Yf.topLevel(e,"nodes",t)},Yf.nodeInTree=function(e,t,a){var i=e.nodes;if(Object(s.default)(i))for(var r=t.length,n=0;n<r;n++){var o=t[n],l=i[o];if(Object(s.default)(l)){var u=a(l,o);if(Object(s.default)(u))return u;var d=l.children;if(Object(s.default)(d)&&(u=Yf.nodeInTree(e,d,a),Object(s.default)(u)))return u}}},Yf.nodeInScene=function(e,t,a){var i=t.nodes;if(Object(s.default)(i))return Yf.nodeInTree(e,i,a)},Yf.program=function(e,t){return Wf(e,"KHR_techniques_webgl")?Yf.object(e.extensions.KHR_techniques_webgl.programs,t):Yf.topLevel(e,"programs",t)},Yf.sampler=function(e,t){return Yf.topLevel(e,"samplers",t)},Yf.scene=function(e,t){return Yf.topLevel(e,"scenes",t)},Yf.shader=function(e,t){return Wf(e,"KHR_techniques_webgl")?Yf.object(e.extensions.KHR_techniques_webgl.shaders,t):Yf.topLevel(e,"shaders",t)},Yf.skin=function(e,t){return Yf.topLevel(e,"skins",t)},Yf.skinJoint=function(e,t){var a=e.joints;if(Object(s.default)(a))for(var i=a.length,r=0;r<i;r++){var n=t(a[r]);if(Object(s.default)(n))return n}},Yf.techniqueAttribute=function(e,t){var a=e.attributes;for(var i in a)if(Object.prototype.hasOwnProperty.call(a,i)){var r=t(a[i],i);if(Object(s.default)(r))return r}},Yf.techniqueUniform=function(e,t){var a=e.uniforms;for(var i in a)if(Object.prototype.hasOwnProperty.call(a,i)){var r=t(a[i],i);if(Object(s.default)(r))return r}},Yf.techniqueParameter=function(e,t){var a=e.parameters;for(var i in a)if(Object.prototype.hasOwnProperty.call(a,i)){var r=t(a[i],i);if(Object(s.default)(r))return r}},Yf.technique=function(e,t){return Wf(e,"KHR_techniques_webgl")?Yf.object(e.extensions.KHR_techniques_webgl.techniques,t):Yf.topLevel(e,"techniques",t)},Yf.texture=function(e,t){return Yf.topLevel(e,"textures",t)};var Kf=Yf;var Xf=function(e){switch(e){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}};var Zf=function(e,t){var a=t.bufferView;if(Object(s.default)(a)){var i=e.bufferViews[a];if(Object(s.default)(i.byteStride)&&i.byteStride>0)return i.byteStride}return ue.a.getSizeInBytes(t.componentType)*Xf(t.type)};function Jf(e){Object(s.default)(e)&&(e.texCoord=Object(o.default)(e.texCoord,0))}var Qf=function(e){Kf.accessor(e,(function(e){Object(s.default)(e.bufferView)&&(e.byteOffset=Object(o.default)(e.byteOffset,0))})),Kf.bufferView(e,(function(e){Object(s.default)(e.buffer)&&(e.byteOffset=Object(o.default)(e.byteOffset,0))})),Kf.mesh(e,(function(t){Kf.meshPrimitive(t,(function(t){if(t.mode=Object(o.default)(t.mode,Sf.a.TRIANGLES),!Object(s.default)(t.material)){Object(s.default)(e.materials)||(e.materials=[]);t.material=qf(e.materials,{name:"default"})}}))})),Kf.accessorContainingVertexAttributeData(e,(function(t){var a=e.accessors[t],i=a.bufferView;if(a.normalized=Object(o.default)(a.normalized,!1),Object(s.default)(i)){var r=e.bufferViews[i];r.byteStride=Zf(e,a),r.target=Sf.a.ARRAY_BUFFER}})),Kf.accessorContainingIndexData(e,(function(t){var a=e.accessors[t].bufferView;Object(s.default)(a)&&(e.bufferViews[a].target=Sf.a.ELEMENT_ARRAY_BUFFER)})),Kf.material(e,(function(e){var t=Object(o.default)(e.extensions,o.default.EMPTY_OBJECT),a=t.KHR_materials_common;if(Object(s.default)(a)){var i=a.technique,r=Object(s.default)(a.values)?a.values:{};return a.values=r,r.ambient=Object(s.default)(r.ambient)?r.ambient:[0,0,0,1],r.emission=Object(s.default)(r.emission)?r.emission:[0,0,0,1],r.transparency=Object(o.default)(r.transparency,1),r.transparent=Object(o.default)(r.transparent,!1),r.doubleSided=Object(o.default)(r.doubleSided,!1),void("CONSTANT"!==i&&(r.diffuse=Object(s.default)(r.diffuse)?r.diffuse:[0,0,0,1],"LAMBERT"!==i&&(r.specular=Object(s.default)(r.specular)?r.specular:[0,0,0,1],r.shininess=Object(o.default)(r.shininess,0))))}e.emissiveFactor=Object(o.default)(e.emissiveFactor,[0,0,0]),e.alphaMode=Object(o.default)(e.alphaMode,"OPAQUE"),e.doubleSided=Object(o.default)(e.doubleSided,!1),"MASK"===e.alphaMode&&(e.alphaCutoff=Object(o.default)(e.alphaCutoff,.5));var n=t.KHR_techniques_webgl;Object(s.default)(n)&&Kf.materialValue(e,(function(e){Object(s.default)(e.index)&&Jf(e)})),Jf(e.emissiveTexture),Jf(e.normalTexture),Jf(e.occlusionTexture);var l=e.pbrMetallicRoughness;Object(s.default)(l)&&(l.baseColorFactor=Object(o.default)(l.baseColorFactor,[1,1,1,1]),l.metallicFactor=Object(o.default)(l.metallicFactor,1),l.roughnessFactor=Object(o.default)(l.roughnessFactor,1),Jf(l.baseColorTexture),Jf(l.metallicRoughnessTexture));var u=t.pbrSpecularGlossiness;Object(s.default)(u)&&(u.diffuseFactor=Object(o.default)(u.diffuseFactor,[1,1,1,1]),u.specularFactor=Object(o.default)(u.specularFactor,[1,1,1]),u.glossinessFactor=Object(o.default)(u.glossinessFactor,1),Jf(u.specularGlossinessTexture))})),Kf.animation(e,(function(e){Kf.animationSampler(e,(function(e){e.interpolation=Object(o.default)(e.interpolation,"LINEAR")}))}));var t=function(e){var t={};return Kf.animation(e,(function(e){Kf.animationChannel(e,(function(e){var a=e.target,i=a.node,r=a.path;"translation"!==r&&"rotation"!==r&&"scale"!==r||(t[i]=!0)}))})),t}(e);return Kf.node(e,(function(e,a){Object(s.default)(t[a])||Object(s.default)(e.translation)||Object(s.default)(e.rotation)||Object(s.default)(e.scale)?(e.translation=Object(o.default)(e.translation,[0,0,0]),e.rotation=Object(o.default)(e.rotation,[0,0,0,1]),e.scale=Object(o.default)(e.scale,[1,1,1])):e.matrix=Object(o.default)(e.matrix,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])})),Kf.sampler(e,(function(e){e.wrapS=Object(o.default)(e.wrapS,Sf.a.REPEAT),e.wrapT=Object(o.default)(e.wrapT,Sf.a.REPEAT)})),Object(s.default)(e.scenes)&&!Object(s.default)(e.scene)&&(e.scene=0),e};function $f(e){e.extras=Object(s.default)(e.extras)?e.extras:{},e.extras._pipeline=Object(s.default)(e.extras._pipeline)?e.extras._pipeline:{}}var ec=function(e){return Kf.shader(e,(function(e){$f(e)})),Kf.buffer(e,(function(e){$f(e)})),Kf.image(e,(function(e){$f(e),Kf.compressedImage(e,(function(e){$f(e)}))})),$f(e),e};var tc=function(e,t){var a=e.extensionsRequired;if(Object(s.default)(a)){var i=a.indexOf(t);i>=0&&a.splice(i,1),0===a.length&&delete e.extensionsRequired}};var ac=function(e,t){var a=e.extensionsUsed;if(Object(s.default)(a)){var i=a.indexOf(t);i>=0&&a.splice(i,1),tc(e,t),0===a.length&&delete e.extensionsUsed}},ic=a(35);function rc(e,t,a){for(var i=new DataView(e.buffer),r=new Array(a),n=0;n<a;++n)r[n]=i.getUint32(e.byteOffset+t+4*n,!0);return r}var nc=function(e){if("glTF"!==Ef(e))throw new ic.default("File is not valid binary glTF");var t=rc(e,0,5),a=t[1];if(1!==a&&2!==a)throw new ic.default("Binary glTF version is not 1 or 2");return 1===a?function(e,t){var a=t[2],i=t[3];if(0!==t[4])throw new ic.default("Binary glTF scene format is not JSON");var r=20+i,n=Object(jf.a)(e,20,i),l=JSON.parse(n);ec(l);var u=e.subarray(r,a),d=l.buffers;if(Object(s.default)(d)&&Object.keys(d).length>0){var f=Object(o.default)(d.binary_glTF,d.KHR_binary_glTF);Object(s.default)(f)&&(f.extras._pipeline.source=u)}return ac(l,"KHR_binary_glTF"),l}(e,t):function(e,t){var a,i,r=t[2],n=12;for(;n<r;){var o=rc(e,n,2),l=o[0],u=o[1];n+=8;var d=e.subarray(n,n+l);if(n+=l,1313821514===u){var f=Object(jf.a)(d);a=JSON.parse(f),ec(a)}else 5130562===u&&(i=d)}if(Object(s.default)(a)&&Object(s.default)(i)){var c=a.buffers;if(Object(s.default)(c)&&c.length>0)c[0].extras._pipeline.source=i}return a}(e,t)};var oc=function(e,t){var a=e.extensionsUsed;Object(s.default)(a)||(a=[],e.extensionsUsed=a),qf(a,t,!0)};var sc=function(e){switch(e){case ue.a.BYTE:return function(e,t,a,i,r){for(var n=0;n<a;++n)r[n]=e.getInt8(t+n*i)};case ue.a.UNSIGNED_BYTE:return function(e,t,a,i,r){for(var n=0;n<a;++n)r[n]=e.getUint8(t+n*i)};case ue.a.SHORT:return function(e,t,a,i,r){for(var n=0;n<a;++n)r[n]=e.getInt16(t+n*i,!0)};case ue.a.UNSIGNED_SHORT:return function(e,t,a,i,r){for(var n=0;n<a;++n)r[n]=e.getUint16(t+n*i,!0)};case ue.a.INT:return function(e,t,a,i,r){for(var n=0;n<a;++n)r[n]=e.getInt32(t+n*i,!0)};case ue.a.UNSIGNED_INT:return function(e,t,a,i,r){for(var n=0;n<a;++n)r[n]=e.getUint32(t+n*i,!0)};case ue.a.FLOAT:return function(e,t,a,i,r){for(var n=0;n<a;++n)r[n]=e.getFloat32(t+n*i,!0)};case ue.a.DOUBLE:return function(e,t,a,i,r){for(var n=0;n<a;++n)r[n]=e.getFloat64(t+n*i,!0)}}};var lc=function(e,t){var a=e.bufferViews,i=e.buffers,r=t.bufferView,n=Xf(t.type);if(!Object(s.default)(t.bufferView))return{min:Object($e.a)(new Array(n),0),max:Object($e.a)(new Array(n),0)};for(var o=Object($e.a)(new Array(n),Number.POSITIVE_INFINITY),l=Object($e.a)(new Array(n),Number.NEGATIVE_INFINITY),u=a[r],d=i[u.buffer].extras._pipeline.source,f=t.count,c=Zf(e,t),h=t.byteOffset+u.byteOffset+d.byteOffset,p=t.componentType,m=ue.a.getSizeInBytes(p),v=new DataView(d.buffer),g=new Array(n),_=sc(p),y=0;y<f;y++){_(v,h,n,m,g);for(var b=0;b<n;b++){var O=g[b];o[b]=Math.min(o[b],O),l[b]=Math.max(l[b],O)}h+=c}return{min:o,max:l}},uc=[Sf.a.FUNC_ADD,Sf.a.FUNC_ADD],dc=[Sf.a.ONE,Sf.a.ZERO,Sf.a.ONE,Sf.a.ZERO];function fc(e,t){var a=e.enable;return!!Object(s.default)(a)&&a.indexOf(t)>-1}var cc=[Sf.a.ZERO,Sf.a.ONE,Sf.a.SRC_COLOR,Sf.a.ONE_MINUS_SRC_COLOR,Sf.a.SRC_ALPHA,Sf.a.ONE_MINUS_SRC_ALPHA,Sf.a.DST_ALPHA,Sf.a.ONE_MINUS_DST_ALPHA,Sf.a.DST_COLOR,Sf.a.ONE_MINUS_DST_COLOR];function hc(e,t){if(!Object(s.default)(e))return t;for(var a=0;a<4;a++)if(-1===cc.indexOf(e[a]))return t;return e}var pc=function(e){var t={},a={},i=e.techniques;return Object(s.default)(i)?(Kf.technique(e,(function(e,i){var r=e.states;if(Object(s.default)(r)){var n=a[i]={};if(fc(r,Sf.a.BLEND)){n.alphaMode="BLEND";var l=r.functions;Object(s.default)(l)&&(Object(s.default)(l.blendEquationSeparate)||Object(s.default)(l.blendFuncSeparate))&&(t[i]={blendEquation:Object(o.default)(l.blendEquationSeparate,uc),blendFactors:hc(l.blendFuncSeparate,dc)})}fc(r,Sf.a.CULL_FACE)||(n.doubleSided=!0),delete e.states}})),Object.keys(t).length>0&&(Object(s.default)(e.extensions)||(e.extensions={}),oc(e,"KHR_blend")),Kf.material(e,(function(e){if(Object(s.default)(e.technique)){var i=a[e.technique];Kf.objectLegacy(i,(function(t,a){e[a]=t}));var r=t[e.technique];Object(s.default)(r)&&(Object(s.default)(e.extensions)||(e.extensions={}),e.extensions.KHR_blend=r)}})),e):e};var mc=function(e,t){var a=e.extensionsRequired;Object(s.default)(a)||(a=[],e.extensionsRequired=a),qf(a,t,!0),oc(e,t)};var vc=function(e){var t=e.techniques,a={},i={};if(Object(s.default)(t)){var r={programs:[],shaders:[],techniques:[]},n=e.glExtensionsUsed;delete e.glExtensionsUsed,Kf.technique(e,(function(t,o){var s,l={name:t.name,program:void 0,attributes:{},uniforms:{}};Kf.techniqueAttribute(t,(function(e,a){s=t.parameters[e],l.attributes[a]={semantic:s.semantic}})),Kf.techniqueUniform(t,(function(e,i){s=t.parameters[e],l.uniforms[i]={count:s.count,node:s.node,type:s.type,semantic:s.semantic,value:s.value},a[e]=i}));var u=e.programs[t.program],d={name:u.name,fragmentShader:void 0,vertexShader:void 0,glExtensions:n},f=e.shaders[u.fragmentShader];d.fragmentShader=qf(r.shaders,f,!0);var c=e.shaders[u.vertexShader];d.vertexShader=qf(r.shaders,c,!0),l.program=qf(r.programs,d),i[o]=qf(r.techniques,l)})),r.techniques.length>0&&(Object(s.default)(e.extensions)||(e.extensions={}),e.extensions.KHR_techniques_webgl=r,oc(e,"KHR_techniques_webgl"),mc(e,"KHR_techniques_webgl"))}return Kf.material(e,(function(e){if(Object(s.default)(e.technique)){var t={technique:i[e.technique]};Kf.objectLegacy(e.values,(function(e,i){Object(s.default)(t.values)||(t.values={});var r=a[i];t.values[r]=e})),Object(s.default)(e.extensions)||(e.extensions={}),e.extensions.KHR_techniques_webgl=t}delete e.technique,delete e.values})),delete e.techniques,delete e.programs,delete e.shaders,e},gc=["mesh","node","material","accessor","bufferView","buffer"];var _c={accessor:"accessors",buffer:"buffers",bufferView:"bufferViews",node:"nodes",material:"materials",mesh:"meshes"};function yc(){}function bc(){}yc.accessor=function(e,t){e.accessors.splice(t,1),Kf.mesh(e,(function(e){Kf.meshPrimitive(e,(function(e){Kf.meshPrimitiveAttribute(e,(function(a,i){a>t&&e.attributes[i]--})),Kf.meshPrimitiveTarget(e,(function(e){Kf.meshPrimitiveTargetAttribute(e,(function(a,i){a>t&&e[i]--}))}));var a=e.indices;Object(s.default)(a)&&a>t&&e.indices--}))})),Kf.skin(e,(function(e){Object(s.default)(e.inverseBindMatrices)&&e.inverseBindMatrices>t&&e.inverseBindMatrices--})),Kf.animation(e,(function(e){Kf.animationSampler(e,(function(e){Object(s.default)(e.input)&&e.input>t&&e.input--,Object(s.default)(e.output)&&e.output>t&&e.output--}))}))},yc.buffer=function(e,t){e.buffers.splice(t,1),Kf.bufferView(e,(function(e){Object(s.default)(e.buffer)&&e.buffer>t&&e.buffer--}))},yc.bufferView=function(e,t){e.bufferViews.splice(t,1),Kf.accessor(e,(function(e){Object(s.default)(e.bufferView)&&e.bufferView>t&&e.bufferView--})),Kf.shader(e,(function(e){Object(s.default)(e.bufferView)&&e.bufferView>t&&e.bufferView--})),Kf.image(e,(function(e){Object(s.default)(e.bufferView)&&e.bufferView>t&&e.bufferView--,Kf.compressedImage(e,(function(e){var a=e.bufferView;Object(s.default)(a)&&a>t&&e.bufferView--}))})),Wf(e,"KHR_draco_mesh_compression")&&Kf.mesh(e,(function(e){Kf.meshPrimitive(e,(function(e){Object(s.default)(e.extensions)&&Object(s.default)(e.extensions.KHR_draco_mesh_compression)&&e.extensions.KHR_draco_mesh_compression.bufferView>t&&e.extensions.KHR_draco_mesh_compression.bufferView--}))}))},yc.mesh=function(e,t){e.meshes.splice(t,1),Kf.node(e,(function(e){Object(s.default)(e.mesh)&&(e.mesh>t?e.mesh--:e.mesh===t&&delete e.mesh)}))},yc.node=function(e,t){e.nodes.splice(t,1),Kf.skin(e,(function(e){Object(s.default)(e.skeleton)&&e.skeleton>t&&e.skeleton--,e.joints=e.joints.map((function(e){return e>t?e-1:e}))})),Kf.animation(e,(function(e){Kf.animationChannel(e,(function(e){Object(s.default)(e.target)&&Object(s.default)(e.target.node)&&e.target.node>t&&e.target.node--}))})),Kf.technique(e,(function(e){Kf.techniqueUniform(e,(function(e){Object(s.default)(e.node)&&e.node>t&&e.node--}))})),Kf.node(e,(function(e){Object(s.default)(e.children)&&(e.children=e.children.filter((function(e){return e!==t})).map((function(e){return e>t?e-1:e})))})),Kf.scene(e,(function(e){e.nodes=e.nodes.filter((function(e){return e!==t})).map((function(e){return e>t?e-1:e}))}))},yc.material=function(e,t){e.materials.splice(t,1),Kf.mesh(e,(function(e){Kf.meshPrimitive(e,(function(e){Object(s.default)(e.material)&&e.material>t&&e.material--}))}))},bc.accessor=function(e){var t={};return Kf.mesh(e,(function(e){Kf.meshPrimitive(e,(function(e){Kf.meshPrimitiveAttribute(e,(function(e){t[e]=!0})),Kf.meshPrimitiveTarget(e,(function(e){Kf.meshPrimitiveTargetAttribute(e,(function(e){t[e]=!0}))}));var a=e.indices;Object(s.default)(a)&&(t[a]=!0)}))})),Kf.skin(e,(function(e){Object(s.default)(e.inverseBindMatrices)&&(t[e.inverseBindMatrices]=!0)})),Kf.animation(e,(function(e){Kf.animationSampler(e,(function(e){Object(s.default)(e.input)&&(t[e.input]=!0),Object(s.default)(e.output)&&(t[e.output]=!0)}))})),t},bc.buffer=function(e){var t={};return Kf.bufferView(e,(function(e){Object(s.default)(e.buffer)&&(t[e.buffer]=!0)})),t},bc.bufferView=function(e){var t={};return Kf.accessor(e,(function(e){Object(s.default)(e.bufferView)&&(t[e.bufferView]=!0)})),Kf.shader(e,(function(e){Object(s.default)(e.bufferView)&&(t[e.bufferView]=!0)})),Kf.image(e,(function(e){Object(s.default)(e.bufferView)&&(t[e.bufferView]=!0),Kf.compressedImage(e,(function(e){Object(s.default)(e.bufferView)&&(t[e.bufferView]=!0)}))})),Wf(e,"KHR_draco_mesh_compression")&&Kf.mesh(e,(function(e){Kf.meshPrimitive(e,(function(e){Object(s.default)(e.extensions)&&Object(s.default)(e.extensions.KHR_draco_mesh_compression)&&(t[e.extensions.KHR_draco_mesh_compression.bufferView]=!0)}))})),t},bc.mesh=function(e){var t={};return Kf.node(e,(function(a){if(Object(s.default)(a.mesh&&Object(s.default)(e.meshes))){var i=e.meshes[a.mesh];Object(s.default)(i)&&Object(s.default)(i.primitives)&&i.primitives.length>0&&(t[a.mesh]=!0)}})),t},bc.node=function(e){var t={};return Kf.node(e,(function(a,i){(function e(t,a){return!(Object(s.default)(a.mesh)||Object(s.default)(a.camera)||Object(s.default)(a.skin)||Object(s.default)(a.weights)||Object(s.default)(a.extras)||Object(s.default)(a.extensions)&&0!==a.extensions.length)&&(!Object(s.default)(a.children)||0===a.children.filter((function(a){return!e(t,t.nodes[a])})).length)})(e,a)||(t[i]=!0)})),Kf.skin(e,(function(e){Object(s.default)(e.skeleton)&&(t[e.skeleton]=!0),Kf.skinJoint(e,(function(e){t[e]=!0}))})),Kf.animation(e,(function(e){Kf.animationChannel(e,(function(e){Object(s.default)(e.target)&&Object(s.default)(e.target.node)&&(t[e.target.node]=!0)}))})),Kf.technique(e,(function(e){Kf.techniqueUniform(e,(function(e){Object(s.default)(e.node)&&(t[e.node]=!0)}))})),t},bc.material=function(e){var t={};return Kf.mesh(e,(function(e){Kf.meshPrimitive(e,(function(e){Object(s.default)(e.material)&&(t[e.material]=!0)}))})),t};var Oc=function(e,t){return t=Object(o.default)(t,gc),gc.forEach((function(a){t.indexOf(a)>-1&&function(e,t){var a=e[_c[t]];if(Object(s.default)(a))for(var i=0,r=bc[t](e),n=a.length,o=0;o<n;++o)r[o]||(yc[t](e,o-i),i++)}(e,a)})),e};var wc=function(e,t){var a={byteLength:t.length,extras:{_pipeline:{source:t}}},i={buffer:qf(e.buffers,a),byteOffset:0,byteLength:t.length};return qf(e.bufferViews,i)};var xc=function(e,t){var a=Zf(e,t),i=ue.a.getSizeInBytes(t.componentType),r=Xf(t.type),n=t.count,o=new Array(r*n);if(!Object(s.default)(t.bufferView))return Object($e.a)(o,0),o;for(var l=e.bufferViews[t.bufferView],u=e.buffers[l.buffer].extras._pipeline.source,d=t.byteOffset+l.byteOffset+u.byteOffset,f=new DataView(u.buffer),c=new Array(r),h=sc(t.componentType),p=0;p<n;++p){h(f,d,r,i,c);for(var m=0;m<r;++m)o[p*r+m]=c[m];d+=a}return o};function Ac(e,t,a){var i=ue.a.createTypedArray(a,xc(e,t)),r=new Uint8Array(i.buffer);t.bufferView=wc(e,r),t.componentType=a,t.byteOffset=0}var jc=function(e){var t;return Kf.accessorWithSemantic(e,"JOINTS_0",(function(a){var i=e.accessors[a];(t=i.componentType)===Sf.a.BYTE?Ac(e,i,ue.a.UNSIGNED_BYTE):t!==Sf.a.UNSIGNED_BYTE&&t!==Sf.a.UNSIGNED_SHORT&&Ac(e,i,ue.a.UNSIGNED_SHORT)})),Kf.accessorWithSemantic(e,"WEIGHTS_0",(function(a){var i=e.accessors[a];(t=i.componentType)===Sf.a.BYTE?Ac(e,i,ue.a.UNSIGNED_BYTE):t===Sf.a.SHORT&&Ac(e,i,ue.a.UNSIGNED_SHORT)})),e},Ec={.8:function(e){Object(s.default)(e.asset)||(e.asset={});var t=e.asset;if(t.version="1.0","string"==typeof t.profile){var a=t.profile.split(" ");t.profile={api:a[0],version:a[1]}}else t.profile={};Object(s.default)(e.version)&&delete e.version;Cc(e),Pc(e),Tc(e),Dc(e),Ic(e),Object(s.default)(e.allExtensions)&&(e.extensionsUsed=e.allExtensions,delete e.allExtensions);if(Object(s.default)(e.lights)){var i=Object(o.default)(e.extensions,{});e.extensions=i;var r=Object(o.default)(i.KHR_materials_common,{});i.KHR_materials_common=r,r.lights=e.lights,delete e.lights,oc(e,"KHR_materials_common")}},"1.0":function(e){e.asset=Object(o.default)(e.asset,{}),e.asset.version="2.0",Cc(e),function(e){var t=e.animations;for(var a in t)if(Object.prototype.hasOwnProperty.call(t,a)){var i=t[a],r=i.parameters;if(Object(s.default)(r)){var n=i.samplers;for(var o in n)if(Object.prototype.hasOwnProperty.call(n,o)){var l=n[o];l.input=r[l.input],l.output=r[l.output]}delete i.parameters}}}(e),function(e){Kf.node(e,(function(t,a){Nc(t)&&function e(t,a){Kf.scene(t,(function(e){var t=e.nodes;if(Object(s.default)(t))for(var i=t.length;i>=0;--i)if(t[i]===a)return void t.splice(i,1)})),Kf.node(t,(function(i,r){if(Object(s.default)(i.children)){var n=i.children.indexOf(a);n>-1&&(i.children.splice(n,1),Nc(i)&&e(t,r))}})),delete t.nodes[a]}(e,a)}))}(e),function(e){var t,a,i={accessors:{},animations:{},buffers:{},bufferViews:{},cameras:{},images:{},materials:{},meshes:{},nodes:{},programs:{},samplers:{},scenes:{},shaders:{},skins:{},textures:{},techniques:{}},r={},n=e.nodes;for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(a=n[o].jointName,Object(s.default)(a)&&(r[a]=o));for(var l in e)if(Object.prototype.hasOwnProperty.call(e,l)&&Object(s.default)(i[l])){var u={},d=e[l];e[l]=Sc(d,u),i[l]=u}for(a in r)Object.prototype.hasOwnProperty.call(r,a)&&(r[a]=i.nodes[r[a]]);Object(s.default)(e.scene)&&(e.scene=i.scenes[e.scene]);Kf.bufferView(e,(function(e){Object(s.default)(e.buffer)&&(e.buffer=i.buffers[e.buffer])})),Kf.accessor(e,(function(e){Object(s.default)(e.bufferView)&&(e.bufferView=i.bufferViews[e.bufferView])})),Kf.shader(e,(function(e){var t=e.extensions;if(Object(s.default)(t)){var a=t.KHR_binary_glTF;Object(s.default)(a)&&(e.bufferView=i.bufferViews[a.bufferView],delete t.KHR_binary_glTF),0===Object.keys(t).length&&delete e.extensions}})),Kf.program(e,(function(e){Object(s.default)(e.vertexShader)&&(e.vertexShader=i.shaders[e.vertexShader]),Object(s.default)(e.fragmentShader)&&(e.fragmentShader=i.shaders[e.fragmentShader])})),Kf.technique(e,(function(e){Object(s.default)(e.program)&&(e.program=i.programs[e.program]),Kf.techniqueParameter(e,(function(e){Object(s.default)(e.node)&&(e.node=i.nodes[e.node]);var t=e.value;"string"==typeof t&&(e.value={index:i.textures[t]})}))})),Kf.mesh(e,(function(e){Kf.meshPrimitive(e,(function(e){Object(s.default)(e.indices)&&(e.indices=i.accessors[e.indices]),Kf.meshPrimitiveAttribute(e,(function(t,a){e.attributes[a]=i.accessors[t]})),Object(s.default)(e.material)&&(e.material=i.materials[e.material])}))})),Kf.node(e,(function(a){var r=a.children;if(Object(s.default)(r)){var n=r.length;for(t=0;t<n;++t)r[t]=i.nodes[r[t]]}if(Object(s.default)(a.meshes)){var o=a.meshes,l=o.length;if(l>0)for(a.mesh=i.meshes[o[0]],t=1;t<l;++t){var u={mesh:i.meshes[o[t]]},d=qf(e.nodes,u);Object(s.default)(r)||(r=[],a.children=r),r.push(d)}delete a.meshes}if(Object(s.default)(a.camera)&&(a.camera=i.cameras[a.camera]),Object(s.default)(a.skin)&&(a.skin=i.skins[a.skin]),Object(s.default)(a.skeletons)){var f=a.skeletons;if(f.length>0&&Object(s.default)(a.skin))e.skins[a.skin].skeleton=i.nodes[f[0]];delete a.skeletons}Object(s.default)(a.jointName)&&delete a.jointName})),Kf.skin(e,(function(e){Object(s.default)(e.inverseBindMatrices)&&(e.inverseBindMatrices=i.accessors[e.inverseBindMatrices]);var a=e.jointNames;if(Object(s.default)(a)){var n=[],o=a.length;for(t=0;t<o;++t)n[t]=r[a[t]];e.joints=n,delete e.jointNames}})),Kf.scene(e,(function(e){var a=e.nodes;if(Object(s.default)(a)){var r=a.length;for(t=0;t<r;++t)a[t]=i.nodes[a[t]]}})),Kf.animation(e,(function(e){var t={};e.samplers=Sc(e.samplers,t),Kf.animationSampler(e,(function(e){e.input=i.accessors[e.input],e.output=i.accessors[e.output]})),Kf.animationChannel(e,(function(e){e.sampler=t[e.sampler];var a=e.target;Object(s.default)(a)&&(a.node=i.nodes[a.id],delete a.id)}))})),Kf.material(e,(function(e){Object(s.default)(e.technique)&&(e.technique=i.techniques[e.technique]),Kf.materialValue(e,(function(t,a){"string"==typeof t&&(e.values[a]={index:i.textures[t]})}));var t=e.extensions;if(Object(s.default)(t)){var a=t.KHR_materials_common;Object(s.default)(a)&&Kf.materialValue(a,(function(e,t){"string"==typeof e&&(a.values[t]={index:i.textures[e]})}))}})),Kf.image(e,(function(e){var t=e.extensions;if(Object(s.default)(t)){var a=t.KHR_binary_glTF;Object(s.default)(a)&&(e.bufferView=i.bufferViews[a.bufferView],e.mimeType=a.mimeType,delete t.KHR_binary_glTF),0===Object.keys(t).length&&delete e.extensions}Kf.compressedImage(e,(function(e){var a=e.extensions;if(Object(s.default)(a)){var r=a.KHR_binary_glTF;Object(s.default)(r)&&(e.bufferView=i.bufferViews[r.bufferView],e.mimeType=r.mimeType,delete a.KHR_binary_glTF),0===Object.keys(t).length&&delete e.extensions}}))})),Kf.texture(e,(function(e){Object(s.default)(e.sampler)&&(e.sampler=i.samplers[e.sampler]),Object(s.default)(e.source)&&(e.source=i.images[e.source])}))}(e),function(e){Kf.animation(e,(function(e){Kf.animationSampler(e,(function(e){delete e.name}))}))}(e),function(e){var t=e.asset;delete t.profile,delete t.premultipliedAlpha}(e),function(e){var t=e.extensionsUsed;if(e.extensionsRequired=Object(o.default)(e.extensionsRequired,[]),Object(s.default)(t))for(var a=t.length,i=0;i<a;++i){var r=t[i];Object(s.default)(Mc[r])&&e.extensionsRequired.push(r)}}(e),function(e){Kf.buffer(e,(function(e){Object(s.default)(e.byteLength)||(e.byteLength=e.extras._pipeline.source.length)})),Kf.accessor(e,(function(t){var a=t.bufferView;if(Object(s.default)(a)){var i=e.bufferViews[a],r=Vc(e,t),n=t.byteOffset+t.count*r;i.byteLength=Math.max(Object(o.default)(i.byteLength,0),n)}}))}(e),function(e){var t,a,i,r=e.bufferViews,n={};Kf.accessorContainingVertexAttributeData(e,(function(t){var a=e.accessors[t];Object(s.default)(a.bufferView)&&(n[a.bufferView]=!0)}));var l={};for(var u in Kf.accessor(e,(function(e){Object(s.default)(e.bufferView)&&(l[e.bufferView]=Object(o.default)(l[e.bufferView],[]),l[e.bufferView].push(e))})),l)if(Object.prototype.hasOwnProperty.call(l,u)){i=r[u];var d=l[u];d.sort((function(e,t){return e.byteOffset-t.byteOffset}));var f=0,c=0,h=d.length;for(t=0;t<h;++t){var p=d[t],m=Vc(e,p),v=p.byteOffset,g=p.count*m;delete p.byteStride;var _=t<h-1,y=_?Vc(e,d[t+1]):void 0;if(m!==y){var b=Object(bf.default)(i,!0);n[u]&&(b.byteStride=m),b.byteOffset+=f,b.byteLength=v+g-f;var O=qf(r,b);for(a=c;a<=t;++a)(p=d[a]).bufferView=O,p.byteOffset=p.byteOffset-f;f=_?d[t+1].byteOffset:void 0,c=t+1}}}Oc(e,["accessor","bufferView","buffer"])}(e),function(e){Kf.accessorWithSemantic(e,"POSITION",(function(t){var a=e.accessors[t];if(!Object(s.default)(a.min)||!Object(s.default)(a.max)){var i=lc(e,a);a.min=i.min,a.max=i.max}}))}(e),function(e){Kf.animation(e,(function(t){Kf.animationSampler(t,(function(t){var a=e.accessors[t.input];if(!Object(s.default)(a.min)||!Object(s.default)(a.max)){var i=lc(e,a);a.min=i.min,a.max=i.max}}))}))}(e),function(e){Kf.buffer(e,(function(e){delete e.type}))}(e),function(e){Kf.texture(e,(function(e){delete e.format,delete e.internalFormat,delete e.target,delete e.type}))}(e),function(e){Kf.mesh(e,(function(e){Kf.meshPrimitive(e,(function(e){Kf.meshPrimitiveAttribute(e,(function(t,a){"TEXCOORD"===a?e.attributes.TEXCOORD_0=t:"COLOR"===a&&(e.attributes.COLOR_0=t)})),delete e.attributes.TEXCOORD,delete e.attributes.COLOR}))})),Kf.technique(e,(function(e){Kf.techniqueParameter(e,(function(e){var t=e.semantic;Object(s.default)(t)&&("TEXCOORD"===t?e.semantic="TEXCOORD_0":"COLOR"===t&&(e.semantic="COLOR_0"))}))}))}(e),function(e){var t={};Kf.mesh(e,(function(e){Kf.meshPrimitive(e,(function(e){for(var a in Kf.meshPrimitiveAttribute(e,(function(e,a){if("_"!==a.charAt(0)){var i,r=a.search(/_[0-9]+/g),n=a,o="_0";r>=0&&(n=a.substring(0,r),o=a.substring(r));var l=Lc[n];Object(s.default)(l)?(i=l+o,t[a]=i):Object(s.default)(Rc[n])||(i="_"+a,t[a]=i)}})),t)if(Object.prototype.hasOwnProperty.call(t,a)){var i=t[a],r=e.attributes[a];Object(s.default)(r)&&(delete e.attributes[a],e.attributes[i]=r)}}))})),Kf.technique(e,(function(e){Kf.techniqueParameter(e,(function(e){var a=t[e.semantic];Object(s.default)(a)&&(e.semantic=a)}))}))}(e),jc(e),function(e){Kf.camera(e,(function(e){var t=e.perspective;if(Object(s.default)(t)){var a=t.aspectRatio;Object(s.default)(a)&&0===a&&delete t.aspectRatio;var i=t.yfov;Object(s.default)(i)&&0===i&&(t.yfov=1)}}))}(e),pc(e),vc(e),function(e){for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t)){var a=e[t];Object(st.default)(a)&&0===a.length&&delete e[t]}Kf.node(e,(function(e){Object(s.default)(e.children)&&0===e.children.length&&delete e.children}))}(e)},"2.0":void 0};function Cc(e){var t=e.materials;for(var a in t)if(Object.prototype.hasOwnProperty.call(t,a)){var i=t[a],r=i.instanceTechnique;Object(s.default)(r)&&(i.technique=r.technique,i.values=r.values,delete i.instanceTechnique)}}function Pc(e){var t=e.meshes;for(var a in t)if(Object.prototype.hasOwnProperty.call(t,a)){var i=t[a].primitives;if(Object(s.default)(i))for(var r=i.length,n=0;n<r;++n){var l=i[n],u=Object(o.default)(l.primitive,Sf.a.TRIANGLES);l.mode=Object(o.default)(l.mode,u),delete l.primitive}}}function Tc(e){var t=e.nodes,a=new y.default,i=new Vt.default;for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r)){var n=t[r];if(Object(s.default)(n.rotation)){var o=n.rotation;y.default.fromArray(o,0,a),Vt.default.fromAxisAngle(a,o[3],i),n.rotation=[i.x,i.y,i.z,i.w]}var l=n.instanceSkin;Object(s.default)(l)&&(n.skeletons=l.skeletons,n.skin=l.skin,n.meshes=l.meshes,delete n.instanceSkin)}}function Dc(e){var t=e.animations,a=e.accessors,i=e.bufferViews,r=e.buffers,n={},o=new y.default,l=new Vt.default;for(var u in t)if(Object.prototype.hasOwnProperty.call(t,u)){var d=t[u],f=d.channels,c=d.parameters,h=d.samplers;if(Object(s.default)(f))for(var p=f.length,m=0;m<p;++m){var v=f[m];if("rotation"===v.target.path){var g=c[h[v.sampler].output];if(Object(s.default)(n[g]))continue;n[g]=!0;for(var _=a[g],b=i[_.bufferView],O=r[b.buffer].extras._pipeline.source,w=O.byteOffset+b.byteOffset+_.byteOffset,x=_.componentType,A=_.count,j=Xf(_.type),E=_.count*j,C=ue.a.createArrayBufferView(x,O.buffer,w,E),P=0;P<A;P++){var T=P*j;y.default.unpack(C,T,o);var D=C[T+3];Vt.default.fromAxisAngle(o,D,l),Vt.default.pack(l,C,T)}}}}}function Ic(e){var t=e.techniques;for(var a in t)if(Object.prototype.hasOwnProperty.call(t,a)){var i=t[a],r=i.passes;if(Object(s.default)(r)){var n=Object(o.default)(i.pass,"defaultPass");if(Object.prototype.hasOwnProperty.call(r,n)){var l=r[n],u=l.instanceProgram;i.attributes=Object(o.default)(i.attributes,u.attributes),i.program=Object(o.default)(i.program,u.program),i.uniforms=Object(o.default)(i.uniforms,u.uniforms),i.states=Object(o.default)(i.states,l.states)}delete i.passes,delete i.pass}}}function Sc(e,t){var a=[];for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){var r=e[i];t[i]=a.length,a.push(r),Object(s.default)(r.name)||(r.name=i)}return a}var Mc={CESIUM_RTC:!0,KHR_materials_common:!0,WEB3D_quantized_attributes:!0};var Rc={POSITION:!0,NORMAL:!0,TANGENT:!0},Lc={COLOR:"COLOR",JOINT:"JOINTS",JOINTS:"JOINTS",TEXCOORD:"TEXCOORD",WEIGHT:"WEIGHTS",WEIGHTS:"WEIGHTS"};function Vc(e,t){return Object(s.default)(t.byteStride)&&0!==t.byteStride?t.byteStride:Zf(e,t)}function Nc(e){return(!Object(s.default)(e.children)||0===e.children.length)&&(!Object(s.default)(e.meshes)||0===e.meshes.length)&&!Object(s.default)(e.camera)&&!Object(s.default)(e.skin)&&!Object(s.default)(e.skeletons)&&!Object(s.default)(e.jointName)&&(!Object(s.default)(e.translation)||y.default.fromArray(e.translation).equals(y.default.ZERO))&&(!Object(s.default)(e.scale)||y.default.fromArray(e.scale).equals(new y.default(1,1,1)))&&(!Object(s.default)(e.rotation)||Rt.a.fromArray(e.rotation).equals(new Rt.a(0,0,0,1)))&&(!Object(s.default)(e.matrix)||lt.default.fromColumnMajorArray(e.matrix).equals(lt.default.IDENTITY))&&!Object(s.default)(e.extensions)&&!Object(s.default)(e.extras)}var Fc=function(e,t){var a=(t=Object(o.default)(t,o.default.EMPTY_OBJECT)).targetVersion,i=e.version;e.asset=Object(o.default)(e.asset,{version:"1.0"}),e.asset.version=Object(o.default)(e.asset.version,"1.0"),i=Object(o.default)(i,e.asset.version).toString(),Object.prototype.hasOwnProperty.call(Ec,i)||(Object(s.default)(i)&&(i=i.substring(0,3)),Object.prototype.hasOwnProperty.call(Ec,i)||(i="1.0"));for(var r=Ec[i];Object(s.default)(r)&&i!==a;)r(e,t),i=e.asset.version,r=Ec[i];return e},Bc=a(101),Uc=a(342),Hc=a(611),kc=a(170);function zc(){}function Gc(e,t){var a="runtime."+Object.keys(e.createdBufferViews).length,i=e.buffers,r=Object.keys(i).length;return i[r]=t,e.createdBufferViews[a]={buffer:r,byteOffset:0,byteLength:t.byteLength},a}function qc(e,t,a){var i=t._loadResources,r=Gc(i,e);return i.vertexBuffersToCreate.enqueue(r),r}function Wc(e,t,a,i){if(zc._taskProcessorReady){var r=a.primitivesToDecode.peek();if(Object(s.default)(r)){var n=e.scheduleTask(r,[r.array.buffer]);if(Object(s.default)(n))return a.activeDecodingTasks++,a.primitivesToDecode.dequeue(),n.then((function(e){a.activeDecodingTasks--;var i=function(e,t,a){var i=e.typedArray,r=t._loadResources,n=Gc(r,i);return r.indexBuffersToCreate.enqueue({id:n,componentType:ue.a.fromTypedArray(i)}),{bufferViewId:n,numberOfIndices:e.numberOfIndices}}(e.indexArray,t),n={},o=e.attributeData;for(var s in o)if(o.hasOwnProperty(s)){var l=o[s],u=qc(l.array,t),d=l.data;d.bufferView=u,n[s]=d}t._decodedData[r.mesh+".primitive."+r.primitive]={bufferView:i.bufferViewId,numberOfIndices:i.numberOfIndices,attributes:n}}))}}}zc._maxDecodingConcurrency=Math.max(xf.default.hardwareConcurrency-1,1),zc._decoderTaskProcessor=void 0,zc._taskProcessorReady=!1,zc._getDecoderTaskProcessor=function(){if(!Object(s.default)(zc._decoderTaskProcessor)){var e=new kc.default("decodeDraco",zc._maxDecodingConcurrency);e.initWebAssemblyModule({modulePath:"ThirdParty/Workers/draco_wasm_wrapper.js",wasmBinaryFile:"ThirdParty/draco_decoder.wasm",fallbackModulePath:"ThirdParty/Workers/draco_decoder.js"}).then((function(){zc._taskProcessorReady=!0})),zc._decoderTaskProcessor=e}return zc._decoderTaskProcessor},zc.hasExtension=function(e){return Object(s.default)(e.extensionsRequired.KHR_draco_mesh_compression)||Object(s.default)(e.extensionsUsed.KHR_draco_mesh_compression)},zc._decodedModelResourceCache=void 0,zc.parse=function(e,t){if(zc.hasExtension(e)){var a=e._loadResources,i=e.cacheKey;if(Object(s.default)(i)){Object(s.default)(zc._decodedModelResourceCache)||(Object(s.default)(t.cache.modelDecodingCache)||(t.cache.modelDecodingCache={}),zc._decodedModelResourceCache=t.cache.modelDecodingCache);var r=zc._decodedModelResourceCache[i];if(Object(s.default)(r))return r.count++,void(a.pendingDecodingCache=!0)}var n=e._dequantizeInShader,o=e.gltf;Kf.mesh(o,(function(e,t){Kf.meshPrimitive(e,(function(e,i){if(Object(s.default)(e.extensions)){var r=e.extensions.KHR_draco_mesh_compression;if(Object(s.default)(r)){var l=o.bufferViews[r.bufferView],u=Object(Hc.a)(o.buffers[l.buffer].extras._pipeline.source,l.byteOffset,l.byteOffset+l.byteLength);a.primitivesToDecode.enqueue({mesh:t,primitive:i,array:u,bufferView:l,compressedAttributes:r.attributes,dequantizeInShader:n})}}}))}))}},zc.decodeModel=function(e,t){if(!zc.hasExtension(e))return Pf.default.resolve();var a=e._loadResources,i=e.cacheKey;if(Object(s.default)(i)&&Object(s.default)(zc._decodedModelResourceCache)){var r=zc._decodedModelResourceCache[i];if(Object(s.default)(r)&&a.pendingDecodingCache)return Object(Pf.default)(r.ready,(function(){e._decodedData=r.data,a.pendingDecodingCache=!1}));zc._decodedModelResourceCache[i]={ready:!1,count:1,data:void 0}}if(0===a.primitivesToDecode.length)return Pf.default.resolve();for(var n=zc._getDecoderTaskProcessor(),o=[],l=Wc(n,e,a);Object(s.default)(l);)o.push(l),l=Wc(n,e,a);return Pf.default.all(o)},zc.decodePointCloud=function(e){var t=zc._getDecoderTaskProcessor();if(zc._taskProcessorReady)return t.scheduleTask(e,[e.buffer.buffer])},zc.cacheDataForModel=function(e){var t=e.cacheKey;if(Object(s.default)(t)&&Object(s.default)(zc._decodedModelResourceCache)){var a=zc._decodedModelResourceCache[t];Object(s.default)(a)&&(a.ready=!0,a.data=e._decodedData)}},zc.destroyCachedDataForModel=function(e){var t=e.cacheKey;if(Object(s.default)(t)&&Object(s.default)(zc._decodedModelResourceCache)){var a=zc._decodedModelResourceCache[t];Object(s.default)(a)&&0==--a.count&&delete zc._decodedModelResourceCache[t]}};var Yc=zc;var Kc=function(e,t,a){return"    float clipDistance = clip(gl_FragCoord, "+e+", "+t+"); \n    vec4 clippingPlanesEdgeColor = vec4(1.0); \n    clippingPlanesEdgeColor.rgb = "+a+".rgb; \n    float clippingPlanesEdgeWidth = "+a+".a; \n    if (clipDistance > 0.0 && clipDistance < clippingPlanesEdgeWidth) \n    { \n        gl_FragColor = clippingPlanesEdgeColor;\n    } \n"},Xc=a(608),Zc=a(238);function Jc(){this.times=void 0,this.points=void 0,O.default.throwInstantiationError()}Jc.prototype.evaluate=O.default.throwInstantiationError,Jc.prototype.findTimeInterval=function(e,t){var a,i=this.times,r=i.length;if(e>=i[t=Object(o.default)(t,0)]){if(t+1<r&&e<i[t+1])return t;if(t+2<r&&e<i[t+2])return t+1}else if(t-1>=0&&e>=i[t-1])return t-1;if(e>i[t])for(a=t;a<r-1&&!(e>=i[a]&&e<i[a+1]);++a);else for(a=t-1;a>=0&&!(e>=i[a]&&e<i[a+1]);--a);return a===r-1&&(a=r-2),a},Jc.prototype.wrapTime=function(e){var t=this.times,a=t[t.length-1],i=t[0],r=a-i;return e<i&&(e+=(Math.floor((i-e)/r)+1)*r),e>a&&(e-=(Math.floor((e-a)/r)+1)*r),e},Jc.prototype.clampTime=function(e){var t=this.times;return Fe.default.clamp(e,t[0],t[t.length-1])};var Qc=Jc;function $c(e){var t=(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).points,a=e.times;this._times=a,this._points=t,this._lastTimeIndex=0}Object(l.default)($c.prototype,{times:{get:function(){return this._times}},points:{get:function(){return this._points}}}),$c.prototype.findTimeInterval=Qc.prototype.findTimeInterval,$c.prototype.wrapTime=Qc.prototype.wrapTime,$c.prototype.clampTime=Qc.prototype.clampTime,$c.prototype.evaluate=function(e,t){var a=this.points,i=this.times,r=this._lastTimeIndex=this.findTimeInterval(e,this._lastTimeIndex),n=(e-i[r])/(i[r+1]-i[r]);return Object(s.default)(t)||(t=new y.default),y.default.lerp(a[r],a[r+1],n,t)};var eh=$c;function th(e){var t=(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).points,a=e.times;this._times=a,this._points=t,this._evaluateFunction=function(e){var t=e.points,a=e.times;return function(i,r){Object(s.default)(r)||(r=new Vt.default);var n=e._lastTimeIndex=e.findTimeInterval(i,e._lastTimeIndex),o=(i-a[n])/(a[n+1]-a[n]),l=t[n],u=t[n+1];return Vt.default.fastSlerp(l,u,o,r)}}(this),this._lastTimeIndex=0}Object(l.default)(th.prototype,{times:{get:function(){return this._times}},points:{get:function(){return this._points}}}),th.prototype.findTimeInterval=Qc.prototype.findTimeInterval,th.prototype.wrapTime=Qc.prototype.wrapTime,th.prototype.clampTime=Qc.prototype.clampTime,th.prototype.evaluate=function(e,t){return this._evaluateFunction(e,t)};var ah=th;function ih(e){var t=(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).weights,a=e.times;this._times=a,this._weights=t,this._count=t.length/a.length,this._lastTimeIndex=0}Object(l.default)(ih.prototype,{times:{get:function(){return this._times}},weights:{get:function(){return this._weights}}}),ih.prototype.findTimeInterval=Qc.prototype.findTimeInterval,ih.prototype.wrapTime=Qc.prototype.wrapTime,ih.prototype.clampTime=Qc.prototype.clampTime,ih.prototype.evaluate=function(e,t){var a=this.weights,i=this.times,r=this._lastTimeIndex=this.findTimeInterval(e,this._lastTimeIndex),n=(e-i[r])/(i[r+1]-i[r]);Object(s.default)(t)||(t=new Array(this._count));for(var o=0;o<this._count;o++){var l=r*this._count+o;t[o]=a[l]*(1-n)+a[l+this._count]*n}return t};var rh=ih,nh=Object(Q.default)({SCALAR:"SCALAR",VEC2:"VEC2",VEC3:"VEC3",VEC4:"VEC4",MAT2:"MAT2",MAT3:"MAT3",MAT4:"MAT4"});function oh(){}var sh=/^data\:/i;function lh(e,t){var a=e.gltf,i=a.buffers,r=a.bufferViews[t.bufferView],n=i[r.buffer],o=r.byteOffset+t.byteOffset,s=t.count*Xf(t.type),l=sh.test(n.uri)?"":n.uri;return e.cacheKey+"//"+l+"/"+o+"/"+s}var uh={};oh.getAnimationParameterValues=function(e,t){var a=lh(e,t),i=uh[a];if(!Object(s.default)(i)){var r=e.gltf,n=r.buffers,l=r.bufferViews[t.bufferView],u=n[l.buffer].extras._pipeline.source,d=t.componentType,f=t.type,c=Xf(f),h=t.count,p=Zf(r,t);i=new Array(h);for(var m=Object(o.default)(t.byteOffset,0),v=l.byteOffset+m,g=0;g<h;g++){var _=ue.a.createArrayBufferView(d,u.buffer,u.byteOffset+v,c);"SCALAR"===f?i[g]=_[0]:"VEC3"===f?i[g]=y.default.fromArray(_):"VEC4"===f&&(i[g]=Vt.default.unpack(_)),v+=p}Object(s.default)(e.cacheKey)&&(uh[a]=i)}return i};var dh={};function fh(e){this._value=e}fh.prototype.evaluate=function(e,t){return this._value},fh.prototype.wrapTime=function(e){return 0},fh.prototype.clampTime=function(e){return 0},oh.getAnimationSpline=function(e,t,a,i,r,n,o,l){var u=function(e,t,a){return e.cacheKey+"//"+t+"/"+a}(e,t,i),d=dh[u];if(!Object(s.default)(d)){var f=n,c=l;1===f.length&&1===c.length?d=new fh(c[0]):"LINEAR"===r.interpolation&&("translation"===o||"scale"===o?d=new eh({times:f,points:c}):"rotation"===o?d=new ah({times:f,points:c}):"weights"===o&&(d=new rh({times:f,weights:c}))),Object(s.default)(e.cacheKey)&&(dh[u]=d)}return d};var ch={};oh.getSkinInverseBindMatrices=function(e,t){var a=lh(e,t),i=ch[a];if(!Object(s.default)(i)){var r=e.gltf,n=r.buffers,o=r.bufferViews[t.bufferView],l=n[o.buffer].extras._pipeline.source,u=t.componentType,d=t.type,f=t.count,c=Zf(r,t),h=o.byteOffset+t.byteOffset,p=Xf(d);if(i=new Array(f),u===Sf.a.FLOAT&&d===nh.MAT4)for(var m=0;m<f;++m){var v=ue.a.createArrayBufferView(u,l.buffer,l.byteOffset+h,p);i[m]=lt.default.fromArray(v),h+=c}ch[a]=i}return i};var hh=oh,ph=a(15),mh=Object(Q.default)({NONE:0,REPEAT:1,MIRRORED_REPEAT:2}),vh=Object(Q.default)({STOPPED:0,ANIMATING:1});function gh(e,t,a){this._name=a.name,this._startTime=ph.default.clone(e.startTime),this._delay=Object(o.default)(e.delay,0),this._stopTime=e.stopTime,this.removeOnStop=Object(o.default)(e.removeOnStop,!1),this._multiplier=Object(o.default)(e.multiplier,1),this._reverse=Object(o.default)(e.reverse,!1),this._loop=Object(o.default)(e.loop,mh.NONE),this.start=new Z.default,this.update=new Z.default,this.stop=new Z.default,this._state=vh.STOPPED,this._runtimeAnimation=a,this._computedStartTime=void 0,this._duration=void 0;var i=this;this._raiseStartEvent=function(){i.start.raiseEvent(t,i)},this._updateEventTime=0,this._raiseUpdateEvent=function(){i.update.raiseEvent(t,i,i._updateEventTime)},this._raiseStopEvent=function(){i.stop.raiseEvent(t,i)}}Object(l.default)(gh.prototype,{name:{get:function(){return this._name}},startTime:{get:function(){return this._startTime}},delay:{get:function(){return this._delay}},stopTime:{get:function(){return this._stopTime}},multiplier:{get:function(){return this._multiplier}},reverse:{get:function(){return this._reverse}},loop:{get:function(){return this._loop}}});var _h=gh;function yh(e){this.animationAdded=new Z.default,this.animationRemoved=new Z.default,this._model=e,this._scheduledAnimations=[],this._previousTime=void 0}function bh(e,t,a){var i=e._model,r=i._runtime.animations[t],n=new _h(a,i,r);return e._scheduledAnimations.push(n),e.animationAdded.raiseEvent(i,n),n}function Oh(e,t){for(var a=e.channelEvaluators,i=a.length,r=0;r<i;++r)a[r](t)}Object(l.default)(yh.prototype,{length:{get:function(){return this._scheduledAnimations.length}}}),yh.prototype.add=function(e){e=Object(o.default)(e,o.default.EMPTY_OBJECT);var t,a=this._model._runtime.animations;if(Object(s.default)(e.index))return bh(this,e.index,e);for(var i=a.length,r=0;r<i;++r)if(a[r].name===e.name){t=r;break}return bh(this,t,e)},yh.prototype.addAll=function(e){e=Object(o.default)(e,o.default.EMPTY_OBJECT);for(var t=[],a=this._model._runtime.animations.length,i=0;i<a;++i)t.push(bh(this,i,e));return t},yh.prototype.remove=function(e){if(Object(s.default)(e)){var t=this._scheduledAnimations,a=t.indexOf(e);if(-1!==a)return t.splice(a,1),this.animationRemoved.raiseEvent(this._model,e),!0}return!1},yh.prototype.removeAll=function(){var e=this._model,t=this._scheduledAnimations,a=t.length;this._scheduledAnimations=[];for(var i=0;i<a;++i)this.animationRemoved.raiseEvent(e,t[i])},yh.prototype.contains=function(e){return!!Object(s.default)(e)&&-1!==this._scheduledAnimations.indexOf(e)},yh.prototype.get=function(e){return this._scheduledAnimations[e]};var wh=[];function xh(e,t,a){return function(){e.animationRemoved.raiseEvent(t,a)}}yh.prototype.update=function(e){var t=this._scheduledAnimations,a=t.length;if(0===a)return this._previousTime=void 0,!1;if(ph.default.equals(e.time,this._previousTime))return!1;this._previousTime=ph.default.clone(e.time,this._previousTime);for(var i=!1,r=e.time,n=this._model,l=0;l<a;++l){var u=t[l],d=u._runtimeAnimation;Object(s.default)(u._computedStartTime)||(u._computedStartTime=ph.default.addSeconds(Object(o.default)(u.startTime,r),u.delay,new ph.default)),Object(s.default)(u._duration)||(u._duration=d.stopTime*(1/u.multiplier));var f=u._computedStartTime,c=u._duration,h=u.stopTime,p=0!==c?ph.default.secondsDifference(r,f)/c:0,m=p>=0,v=u.loop===mh.REPEAT||u.loop===mh.MIRRORED_REPEAT;if((m||v&&!Object(s.default)(u.startTime))&&(p<=1||v)&&(!Object(s.default)(h)||ph.default.lessThanOrEquals(r,h))){if(u._state===vh.STOPPED&&(u._state=vh.ANIMATING,u.start.numberOfListeners>0&&e.afterRender.push(u._raiseStartEvent)),u.loop===mh.REPEAT)p-=Math.floor(p);else if(u.loop===mh.MIRRORED_REPEAT){var g=Math.floor(p),_=p-g;p=g%2==1?1-_:_}u.reverse&&(p=1-p);var y=p*c*u.multiplier;Oh(d,y=Fe.default.clamp(y,d.startTime,d.stopTime)),u.update.numberOfListeners>0&&(u._updateEventTime=y,e.afterRender.push(u._raiseUpdateEvent)),i=!0}else m&&u._state===vh.ANIMATING&&(u._state=vh.STOPPED,u.stop.numberOfListeners>0&&e.afterRender.push(u._raiseStopEvent),u.removeOnStop&&wh.push(u))}a=wh.length;for(var b=0;b<a;++b){var O=wh[b];t.splice(t.indexOf(O),1),e.afterRender.push(xh(this,n,O))}return wh.length=0,i};var Ah=yh,jh=a(339);function Eh(){this.initialized=!1,this.resourcesParsed=!1,this.vertexBuffersToCreate=new jh.a,this.indexBuffersToCreate=new jh.a,this.buffers={},this.pendingBufferLoads=0,this.programsToCreate=new jh.a,this.shaders={},this.pendingShaderLoads=0,this.texturesToCreate=new jh.a,this.pendingTextureLoads=0,this.texturesToCreateFromBufferView=new jh.a,this.pendingBufferViewToImage=0,this.createSamplers=!0,this.createSkins=!0,this.createRuntimeAnimations=!0,this.createVertexArrays=!0,this.createRenderStates=!0,this.createUniformMaps=!0,this.createRuntimeNodes=!0,this.createdBufferViews={},this.primitivesToDecode=new jh.a,this.activeDecodingTasks=0,this.pendingDecodingCache=!1,this.skinnedNodesIds=[]}Eh.prototype.getBuffer=function(e){return t=this.buffers[e.buffer],a=e.byteOffset,i=e.byteLength,t.subarray(a,a+i);var t,a,i},Eh.prototype.finishedPendingBufferLoads=function(){return 0===this.pendingBufferLoads},Eh.prototype.finishedBuffersCreation=function(){return 0===this.pendingBufferLoads&&0===this.vertexBuffersToCreate.length&&0===this.indexBuffersToCreate.length},Eh.prototype.finishedProgramCreation=function(){return 0===this.pendingShaderLoads&&0===this.programsToCreate.length},Eh.prototype.finishedTextureCreation=function(){var e=0===this.pendingTextureLoads,t=0===this.texturesToCreate.length&&0===this.texturesToCreateFromBufferView.length;return e&&t},Eh.prototype.finishedEverythingButTextureCreation=function(){var e=0===this.pendingBufferLoads&&0===this.pendingShaderLoads,t=0===this.vertexBuffersToCreate.length&&0===this.indexBuffersToCreate.length&&0===this.programsToCreate.length&&0===this.pendingBufferViewToImage;return this.finishedDecoding()&&e&&t},Eh.prototype.finishedDecoding=function(){return 0===this.primitivesToDecode.length&&0===this.activeDecodingTasks&&!this.pendingDecodingCache},Eh.prototype.finished=function(){return this.finishedDecoding()&&this.finishedTextureCreation()&&this.finishedEverythingButTextureCreation()};var Ch=Eh;function Ph(e,t,a){this._name=t.name,this._id=a,this._uniformMap=e._uniformMaps[a],this._technique=void 0,this._program=void 0,this._values=void 0}Object(l.default)(Ph.prototype,{name:{get:function(){return this._name}},id:{get:function(){return this._id}}}),Ph.prototype.setValue=function(e,t){var a="u_"+e,i=this._uniformMap.values[a];i.value=i.clone(t,i.value)},Ph.prototype.getValue=function(e){var t="u_"+e,a=this._uniformMap.values[t];if(Object(s.default)(a))return a.value};var Th=Ph;function Dh(e,t,a){for(var i=[],r=e.primitives,n=r.length,o=0;o<n;++o){var s=r[o];i[o]=t[s.material]}this._name=e.name,this._materials=i,this._id=a}Object(l.default)(Dh.prototype,{name:{get:function(){return this._name}},id:{get:function(){return this._id}},materials:{get:function(){return this._materials}}});var Ih=Dh;function Sh(e,t,a,i,r){this._model=e,this._runtimeNode=a,this._name=t.name,this._id=i,this.useMatrix=!1,this._show=!0,this._matrix=lt.default.clone(r),this._originalMatrix=lt.default.clone(r)}Object(l.default)(Sh.prototype,{name:{get:function(){return this._name}},id:{get:function(){return this._id}},show:{get:function(){return this._show},set:function(e){this._show!==e&&(this._show=e,this._model._perNodeShowDirty=!0)}},matrix:{get:function(){return this._matrix},set:function(e){this._matrix=lt.default.clone(e,this._matrix),this.useMatrix=!0;var t=this._model;t._cesiumAnimationsDirty=!0,this._runtimeNode.dirtyNumber=t._maxDirtyNumber}},originalMatrix:{get:function(){return this._originalMatrix}}}),Sh.prototype.setMatrix=function(e){lt.default.clone(e,this._matrix)};var Mh=Sh,Rh={updateForwardAxis:function(e){var t=e.gltf.extras.sourceVersion;(Object(s.default)(t)&&"2.0"!==t||"2.0"!==Rh.getAssetVersion(e.gltf))&&(e._gltfForwardAxis=gf.X)},getAssetVersion:function(e){return Object(s.default)(e.asset)&&Object(s.default)(e.asset.version)?e.asset.version:"1.0"},splitIncompatibleMaterials:function(e){var t=e.accessors,a=e.materials,i={};return Kf.mesh(e,(function(e){Kf.meshPrimitive(e,(function(e){var r,n,o=e.material,l=a[o],u=e.attributes.JOINTS_0;if(Object(s.default)(u)){var d=t[u];r=d.componentType,n=d.type}var f=Object(s.default)(u),c=Object(s.default)(e.attributes.COLOR_0),h=Object(s.default)(e.targets),p=Object(s.default)(e.attributes.NORMAL),m=Object(s.default)(e.attributes.TANGENT),v=Object(s.default)(e.attributes.TEXCOORD_0),g=i[o];if(Object(s.default)(g)){if(g.skinning.skinned!==f||g.skinning.type!==n||g.hasVertexColors!==c||g.hasMorphTargets!==h||g.hasNormals!==p||g.hasTangents!==m||g.hasTexCoords!==v){var _=Object(bf.default)(l,!0);o=qf(a,_),e.material=o,i[o]={skinning:{skinned:f,componentType:r,type:n},hasVertexColors:c,hasMorphTargets:h,hasNormals:p,hasTangents:m,hasTexCoords:v}}}else i[o]={skinning:{skinned:f,componentType:r,type:n},hasVertexColors:c,hasMorphTargets:h,hasNormals:p,hasTangents:m,hasTexCoords:v}}))})),i},getShaderVariable:function(e){return"SCALAR"===e?"float":e.toLowerCase()},ModelState:{NEEDS_LOAD:0,LOADING:1,LOADED:2,FAILED:3},getFailedLoadFunction:function(e,t,a){return function(i){e._state=Rh.ModelState.FAILED;var r="Failed to load "+t+": "+a;Object(s.default)(i)&&(r+="\n"+i.message),e._readyPromise.reject(new ic.default(r))}},parseBuffers:function(e,t){var a=e._loadResources;Kf.buffer(e.gltf,(function(i,r){if(Object(s.default)(i.extras._pipeline.source))a.buffers[r]=i.extras._pipeline.source;else if(Object(s.default)(t)){var n=e._resource.getDerivedResource({url:i.uri});++a.pendingBufferLoads,n.fetchArrayBuffer().then(t(e,r)).otherwise(Rh.getFailedLoadFunction(e,"buffer",n.url))}}))}},Lh=new y.default,Vh=new y.default;function Nh(e,t){return Kf.techniqueAttribute(e,(function(e,a){if(e.semantic===t)return a}))}function Fh(e,t,a,i){return Wf(e,"KHR_techniques_webgl")?function(e,t){if(!(e.semantic!==a||i&&Object(s.default)(e.node)))return t}:function(e,r){var n=t.parameters[e];if(!(n.semantic!==a||i&&Object(s.default)(n.node)))return r}}Rh.computeBoundingSphere=function(e){for(var t=e.gltf,a=t.nodes,i=t.meshes,n=t.scenes[t.scene].nodes,o=n.length,l=[],u=new y.default(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),d=new y.default(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),f=0;f<o;++f){var c=a[n[f]];for(c._transformToRoot=Rh.getTransform(c),l.push(c);l.length>0;){var h=(c=l.pop())._transformToRoot,p=c.mesh;if(Object(s.default)(p))for(var m=i[p].primitives,v=m.length,g=0;g<v;++g){var _=m[g].attributes.POSITION;if(Object(s.default)(_)){var b=Rh.getAccessorMinMax(t,_),O=y.default.fromArray(b.min,0,Lh),w=y.default.fromArray(b.max,0,Vh);Object(s.default)(u)&&Object(s.default)(d)&&(lt.default.multiplyByPoint(h,O,O),lt.default.multiplyByPoint(h,w,w),y.default.minimumByComponent(u,O,u),y.default.maximumByComponent(d,w,d))}}var x=c.children;if(Object(s.default)(x))for(var A=x.length,j=0;j<A;++j){var E=a[x[j]];E._transformToRoot=Rh.getTransform(E),lt.default.multiplyTransformation(h,E._transformToRoot,E._transformToRoot),l.push(E)}delete c._transformToRoot}}var C=r.default.fromCornerPoints(u,d);return e._forwardAxis===gf.Z&&r.default.transformWithoutScale(C,gf.Z_UP_TO_X_UP,C),e._upAxis===gf.Y?r.default.transformWithoutScale(C,gf.Y_UP_TO_Z_UP,C):e._upAxis===gf.X&&r.default.transformWithoutScale(C,gf.X_UP_TO_Z_UP,C),C},Rh.ensureSemanticExistence=function(e){return Kf.mesh(e,(function(t){Kf.meshPrimitive(t,(function(t){!function(e,t){var a=e.accessors,i=e.materials,r=e.extensions.KHR_techniques_webgl,n=r.techniques,o=r.programs,l=r.shaders,u=t.targets,d=t.attributes;for(var f in u)if(u.hasOwnProperty(f)){var c=u[f];for(var h in c)"extras"!==h&&(d[h+"_"+f]=c[h])}var p=n[i[t.material].extensions.KHR_techniques_webgl.technique],m=l[o[p.program].vertexShader];for(var v in d)if(d.hasOwnProperty(v)&&!Object(s.default)(Nh(p,v))){var g=a[d[v]],_=v.toLowerCase();"_"===_.charAt(0)&&(_=_.slice(1));var y="a_"+_;p.attributes[y]={semantic:v,type:g.componentType};var b=m.extras._pipeline,O=b.source;O="attribute "+Rh.getShaderVariable(g.type)+" "+y+";\n"+O,b.source=O}}(e,t)}))})),e},Rh.createAttributeLocations=function(e,t){var a={},i=!1,r=1;if(Kf.techniqueAttribute(e,(function(e,t){/pos/i.test(t)&&!i?(a[t]=0,i=!0):a[t]=r++})),Object(s.default)(t))for(var n in t)t.hasOwnProperty(n)&&(a[n]=r++);return a},Rh.getAccessorMinMax=function(e,t){var a=e.accessors[t],i=a.extensions,r=a.min,n=a.max;if(Object(s.default)(i)){var o=i.WEB3D_quantized_attributes;Object(s.default)(o)&&(r=o.decodedMin,n=o.decodedMax)}return{min:r,max:n}},Rh.getAttributeOrUniformBySemantic=function(e,t,a,i){return Kf.technique(e,(function(r){if(!Object(s.default)(a)||r.program===a){var n=Kf.techniqueAttribute(r,Fh(e,r,t,i));return Object(s.default)(n)?n:Kf.techniqueUniform(r,Fh(e,r,t,i))}}))},Rh.getDiffuseAttributeOrUniform=function(e,t){var a=Rh.getAttributeOrUniformBySemantic(e,"COLOR_0",t);return Object(s.default)(a)||(a=Rh.getAttributeOrUniformBySemantic(e,"_3DTILESDIFFUSE",t)),a};var Bh=new y.default,Uh=new Vt.default,Hh=new y.default;function kh(e,t,a){t+="(?!\\w)",t=new RegExp(t,"g");var i=e.search(t);return e.replace(t,(function(e,t){return i===t?e:a}))}function zh(e,t){var a=e.accessors[t].extensions;if(Object(s.default)(a))return a.WEB3D_quantized_attributes}function Gh(e,t,a){var i=t.material,r=e.materials[i];if(Wf(e,"KHR_techniques_webgl")&&Object(s.default)(r.extensions)&&Object(s.default)(r.extensions.KHR_techniques_webgl)){var n=r.extensions.KHR_techniques_webgl.technique,o=e.extensions.KHR_techniques_webgl.techniques[n];return Kf.techniqueAttribute(o,(function(e,t){if(e.semantic===a)return t}))}}function qh(e){var t={value:e,clone:function(e,t){return e},func:function(){return t.value}};return t}function Wh(e){var t={value:_.default.fromArray(e),clone:_.default.clone,func:function(){return t.value}};return t}function Yh(e){var t={value:y.default.fromArray(e),clone:y.default.clone,func:function(){return t.value}};return t}function Kh(e){var t={value:Rt.a.fromArray(e),clone:Rt.a.clone,func:function(){return t.value}};return t}function Xh(e){var t={value:il.a.fromColumnMajorArray(e),clone:il.a.clone,func:function(){return t.value}};return t}function Zh(e){var t={value:at.default.fromColumnMajorArray(e),clone:at.default.clone,func:function(){return t.value}};return t}function Jh(e){var t={value:lt.default.fromColumnMajorArray(e),clone:lt.default.clone,func:function(){return t.value}};return t}function Qh(e,t,a){this._value=void 0,this._textureId=e.index,this._textures=t,this._defaultTexture=a}Rh.getTransform=function(e,t){return Object(s.default)(e.matrix)?lt.default.fromColumnMajorArray(e.matrix,t):lt.default.fromTranslationQuaternionRotationScale(y.default.fromArray(e.translation,0,Bh),Vt.default.unpack(e.rotation,0,Uh),y.default.fromArray(e.scale,0,Hh),t)},Rh.getUsedExtensions=function(e){var t=e.extensionsUsed,a={};if(Object(s.default)(t))for(var i=t.length,r=0;r<i;r++){a[t[r]]=!0}return a},Rh.getRequiredExtensions=function(e){var t=e.extensionsRequired,a={};if(Object(s.default)(t))for(var i=t.length,r=0;r<i;r++){a[t[r]]=!0}return a},Rh.supportedExtensions={AGI_articulations:!0,CESIUM_RTC:!0,EXT_texture_webp:!0,KHR_blend:!0,KHR_binary_glTF:!0,KHR_draco_mesh_compression:!0,KHR_materials_common:!0,KHR_techniques_webgl:!0,KHR_materials_unlit:!0,KHR_materials_pbrSpecularGlossiness:!0,KHR_texture_transform:!0,WEB3D_quantized_attributes:!0},Rh.checkSupportedExtensions=function(e,t){for(var a in e)if(e.hasOwnProperty(a)){if(!Rh.supportedExtensions[a])throw new ic.default("Unsupported glTF Extension: "+a);if("EXT_texture_webp"===a&&!1===t)throw new ic.default("Loaded model requires WebP but browser does not support it.")}},Rh.checkSupportedGlExtensions=function(e,t){if(Object(s.default)(e))for(var a=e.length,i=0;i<a;i++){var r=e[i];if("OES_element_index_uint"!==r)throw new ic.default("Unsupported WebGL Extension: "+r);if(!t.elementIndexUint)throw new ic.default("OES_element_index_uint WebGL extension is not enabled.")}},Rh.modifyShaderForDracoQuantizedAttributes=function(e,t,a,i){var r={};for(var n in i)if(i.hasOwnProperty(n)){var o=i[n],l=o.quantization;if(!Object(s.default)(l))continue;var u=Gh(e,t,n);"_"===n.charAt(0)&&(n=n.substring(1));var d="gltf_u_dec_"+n.toLowerCase();if(!Object(s.default)(r[d])){var f,c="gltf_decoded_"+n,h=u.replace("a_","gltf_a_dec_"),p=o.componentsPerAttribute;a=kh(a,u,h),a=(f=l.octEncoded?"vec3":p>1?"vec"+p:"float")+" "+h+";\n"+a;var m=3===p&&"COLOR_0"===n;m&&(a=kh(a,h,"vec4("+h+", 1.0)"));var v="";if(l.octEncoded){var g=d+"_rangeConstant";a="uniform float "+g+";\n"+a,v="\nvoid main() {\n    "+h+" = czm_octDecode("+u+".xy, "+g+").zxy;\n    "+c+"();\n}\n"}else{var _=d+"_normConstant",y=d+"_min";a="uniform float "+_+";\nuniform "+f+" "+y+";\n"+a,v="\nvoid main() {\n    "+h+" = "+y+" + "+u+(m?".xyz":"")+" * "+_+";\n    "+c+"();\n}\n"}a=Uf.a.replaceMain(a,c),a+=v}}return{shader:a}},Rh.modifyShaderForQuantizedAttributes=function(e,t,a){var i={},r=t.attributes;for(var n in r)if(r.hasOwnProperty(n)){var o=Gh(e,t,n),l=t.attributes[n];"_"===n.charAt(0)&&(n=n.substring(1));var u="gltf_u_dec_"+n.toLowerCase(),d=u+"_scale",f=u+"_translate";if(!Object(s.default)(i[u])&&!Object(s.default)(i[d])){var c=zh(e,l);if(Object(s.default)(c)){var h,p=c.decodeMatrix,m="gltf_decoded_"+n,v=o.replace("a_","gltf_a_dec_"),g=Math.floor(Math.sqrt(p.length));a=(h=g>2?"vec"+(g-1):"float")+" "+v+";\n"+(a=kh(a,o,v));var _="";5===g?(a="uniform vec4 "+f+";\n"+(a="uniform mat4 "+d+";\n"+a),_="\nvoid main() {\n    "+v+" = "+d+" * "+o+" + "+f+";\n    "+m+"();\n}\n",i[d]={mat:4},i[f]={vec:4}):(a="uniform mat"+g+" "+u+";\n"+a,_="\nvoid main() {\n    "+v+" = "+h+"("+u+" * vec"+g+"("+o+",1.0));\n    "+m+"();\n}\n",i[u]={mat:g}),a=Uf.a.replaceMain(a,m),a+=_}}}return{shader:a,uniforms:i}},Rh.toClipCoordinatesGLSL=function(e,t){var a=Rh.getAttributeOrUniformBySemantic(e,"POSITION"),i=a.replace("a_","gltf_a_dec_");-1!==t.indexOf(i)&&(a=i);var r=Rh.getAttributeOrUniformBySemantic(e,"MODELVIEWPROJECTION",void 0,!0);if(!Object(s.default)(r)||-1===t.indexOf(r)){var n=Rh.getAttributeOrUniformBySemantic(e,"PROJECTION",void 0,!0),o=Rh.getAttributeOrUniformBySemantic(e,"MODELVIEW",void 0,!0);-1!==t.indexOf("czm_instanced_modelView ")?o="czm_instanced_modelView":Object(s.default)(o)||(o=Rh.getAttributeOrUniformBySemantic(e,"CESIUM_RTC_MODELVIEW",void 0,!0)),r=n+" * "+o}return r+" * vec4("+a+".xyz, 1.0)"},Rh.modifyFragmentShaderForLogDepth=function(e){return e=Uf.a.replaceMain(e,"czm_depth_main"),e+="\nvoid main() \n{ \n    czm_depth_main(); \n    czm_writeLogDepth(); \n} \n"},Rh.modifyVertexShaderForLogDepth=function(e,t){return e=Uf.a.replaceMain(e,"czm_depth_main"),e+="\nvoid main() \n{ \n    czm_depth_main(); \n    czm_vertexLogDepth("+t+"); \n} \n"},Object(l.default)(Qh.prototype,{value:{get:function(){if(!Object(s.default)(this._value)){var e=this._textures[this._textureId];if(!Object(s.default)(e))return this._defaultTexture;this._value=e}return this._value},set:function(e){this._value=e}}}),Qh.prototype.clone=function(e){return e},Qh.prototype.func=void 0;var $h={};function ep(e){return[e[20],e[21],e[22],e[23]]}$h[Sf.a.FLOAT]=qh,$h[Sf.a.FLOAT_VEC2]=Wh,$h[Sf.a.FLOAT_VEC3]=Yh,$h[Sf.a.FLOAT_VEC4]=Kh,$h[Sf.a.INT]=qh,$h[Sf.a.INT_VEC2]=Wh,$h[Sf.a.INT_VEC3]=Yh,$h[Sf.a.INT_VEC4]=Kh,$h[Sf.a.BOOL]=qh,$h[Sf.a.BOOL_VEC2]=Wh,$h[Sf.a.BOOL_VEC3]=Yh,$h[Sf.a.BOOL_VEC4]=Kh,$h[Sf.a.FLOAT_MAT2]=Xh,$h[Sf.a.FLOAT_MAT3]=Zh,$h[Sf.a.FLOAT_MAT4]=Jh,$h[Sf.a.SAMPLER_2D]=function(e,t,a){var i=new Qh(e,t,a);return i.func=function(){return i.value},i},Rh.createUniformFunction=function(e,t,a,i){return $h[e](t,a,i)},Rh.createUniformsForDracoQuantizedAttributes=function(e){var t={};for(var a in e)if(e.hasOwnProperty(a)){var i=e[a],r=i.quantization;if(!Object(s.default)(r))continue;"_"===a.charAt(0)&&(a=a.substring(1));var n="gltf_u_dec_"+a.toLowerCase();if(r.octEncoded){var o=n+"_rangeConstant",l=(1<<r.quantizationBits)-1;t[o]=qh(l).func;continue}var u=n+"_normConstant",d=r.range/(1<<r.quantizationBits);t[u]=qh(d).func;var f=n+"_min";switch(i.componentsPerAttribute){case 1:t[f]=qh(r.minValues).func;break;case 2:t[f]=Wh(r.minValues).func;break;case 3:t[f]=Yh(r.minValues).func;break;case 4:t[f]=Kh(r.minValues).func}}return t},Rh.createUniformsForQuantizedAttributes=function(e,t,a){var i,r=e.accessors,n={},o={},l=t.attributes;for(var u in l)if(l.hasOwnProperty(u)){var d=r[l[u]],f=d.extensions;if("_"===u.charAt(0)&&(u=u.substring(1)),Object(s.default)(f)){var c=f.WEB3D_quantized_attributes;if(Object(s.default)(c)){var h=c.decodeMatrix,p="gltf_u_dec_"+u.toLowerCase();switch(d.type){case nh.SCALAR:o[p]=Xh(h).func,n[p]=!0;break;case nh.VEC2:o[p]=Zh(h).func,n[p]=!0;break;case nh.VEC3:o[p]=Jh(h).func,n[p]=!0;break;case nh.VEC4:var m=p+"_scale",v=p+"_translate";o[m]=Jh((i=h,[i[0],i[1],i[2],i[3],i[5],i[6],i[7],i[8],i[10],i[11],i[12],i[13],i[15],i[16],i[17],i[18]])).func,o[v]=Kh(ep(h)).func,n[m]=!0,n[v]=!0}}}}for(var g in a)if(a.hasOwnProperty(g)&&!n[g]){var _=a[g];Object(s.default)(_.mat)&&(2===_.mat?o[g]=Xh(il.a.IDENTITY).func:3===_.mat?o[g]=Zh(at.default.IDENTITY).func:4===_.mat&&(o[g]=Jh(lt.default.IDENTITY).func)),Object(s.default)(_.vec)&&4===_.vec&&(o[g]=Kh([0,0,0,0]).func)}return o};var tp=new y.default,ap={MODEL:function(e,t){return function(){return e.model}},VIEW:function(e,t){return function(){return e.view}},PROJECTION:function(e,t){return function(){return e.projection}},MODELVIEW:function(e,t){return function(){return e.modelView}},CESIUM_RTC_MODELVIEW:function(e,t){var a=new lt.default;return function(){return Object(s.default)(t._rtcCenter)?(lt.default.getTranslation(e.model,tp),y.default.add(tp,t._rtcCenter,tp),lt.default.multiplyByPoint(e.view,tp,tp),lt.default.setTranslation(e.modelView,tp,a)):e.modelView}},MODELVIEWPROJECTION:function(e,t){return function(){return e.modelViewProjection}},MODELINVERSE:function(e,t){return function(){return e.inverseModel}},VIEWINVERSE:function(e,t){return function(){return e.inverseView}},PROJECTIONINVERSE:function(e,t){return function(){return e.inverseProjection}},MODELVIEWINVERSE:function(e,t){return function(){return e.inverseModelView}},MODELVIEWPROJECTIONINVERSE:function(e,t){return function(){return e.inverseModelViewProjection}},MODELINVERSETRANSPOSE:function(e,t){return function(){return e.inverseTransposeModel}},MODELVIEWINVERSETRANSPOSE:function(e,t){return function(){return e.normal}},VIEWPORT:function(e,t){return function(){return e.viewportCartesian4}}};Rh.getGltfSemanticUniforms=function(){return ap};var ip=Rh,rp=a(508);var np=function(e){switch(e){case Sf.a.FLOAT:return"float";case Sf.a.FLOAT_VEC2:return"vec2";case Sf.a.FLOAT_VEC3:return"vec3";case Sf.a.FLOAT_VEC4:return"vec4";case Sf.a.FLOAT_MAT2:return"mat2";case Sf.a.FLOAT_MAT3:return"mat3";case Sf.a.FLOAT_MAT4:return"mat4";case Sf.a.SAMPLER_2D:return"sampler2D";case Sf.a.BOOL:return"bool"}};function op(e,t){var a;switch(a=Object(s.default)(t.value)?t.value:Object(s.default)(t.index)?[t.index]:t,e){case"ambient":case"diffuse":case"emission":case"specular":return 1===a.length?Sf.a.SAMPLER_2D:Sf.a.FLOAT_VEC4;case"shininess":case"transparency":return Sf.a.FLOAT;case"transparent":case"doubleSided":return Sf.a.BOOL}}var sp=function(e,t){if(t=Object(o.default)(t,o.default.EMPTY_OBJECT),Object(s.default)(e)&&Wf(e,"KHR_materials_common")){Wf(e,"KHR_techniques_webgl")||(Object(s.default)(e.extensions)||(e.extensions={}),e.extensions.KHR_techniques_webgl={programs:[],shaders:[],techniques:[]},e.extensionsUsed.push("KHR_techniques_webgl"),e.extensionsRequired.push("KHR_techniques_webgl"));var a=e.extensions.KHR_techniques_webgl;!function(e){var t=e.extensions.KHR_materials_common;if(!Object(s.default)(t)||!Object(s.default)(t.lights))return;for(var a=t.lights,i=a.length,r=0;r<i;r++){var n=a[r];if("ambient"===n.type){Object(s.default)(n.ambient)||(n.ambient={});var l=n.ambient;Object(s.default)(l.color)||(l.color=[1,1,1])}else if("directional"===n.type){Object(s.default)(n.directional)||(n.directional={});var u=n.directional;Object(s.default)(u.color)||(u.color=[1,1,1])}else if("point"===n.type){Object(s.default)(n.point)||(n.point={});var d=n.point;Object(s.default)(d.color)||(d.color=[1,1,1]),d.constantAttenuation=Object(o.default)(d.constantAttenuation,1),d.linearAttenuation=Object(o.default)(d.linearAttenuation,0),d.quadraticAttenuation=Object(o.default)(d.quadraticAttenuation,0)}else if("spot"===n.type){Object(s.default)(n.spot)||(n.spot={});var f=n.spot;Object(s.default)(f.color)||(f.color=[1,1,1]),f.constantAttenuation=Object(o.default)(f.constantAttenuation,1),f.fallOffAngle=Object(o.default)(f.fallOffAngle,3.14159265),f.fallOffExponent=Object(o.default)(f.fallOffExponent,0),f.linearAttenuation=Object(o.default)(f.linearAttenuation,0),f.quadraticAttenuation=Object(o.default)(f.quadraticAttenuation,0)}}}(e);var i=function(e){var t,a={};Object(s.default)(e.extensions)&&Object(s.default)(e.extensions.KHR_materials_common)&&(t=e.extensions.KHR_materials_common.lights);if(Object(s.default)(t)){var i=e.nodes;for(var r in i)if(i.hasOwnProperty(r)){var n=i[r];if(Object(s.default)(n.extensions)&&Object(s.default)(n.extensions.KHR_materials_common)){var o=n.extensions.KHR_materials_common.light;Object(s.default)(o)&&Object(s.default)(t[o])&&(t[o].node=r),delete n.extensions.KHR_materials_common}}var l=0;for(var u in t)if(t.hasOwnProperty(u)){var d=t[u],f=d.type;if("ambient"!==f&&!Object(s.default)(d.node)){delete t[u];continue}var c="light"+l.toString();switch(d.baseName=c,f){case"ambient":var h=d.ambient;a[c+"Color"]={type:Sf.a.FLOAT_VEC3,value:h.color};break;case"directional":var p=d.directional;a[c+"Color"]={type:Sf.a.FLOAT_VEC3,value:p.color},Object(s.default)(d.node)&&(a[c+"Transform"]={node:d.node,semantic:"MODELVIEW",type:Sf.a.FLOAT_MAT4});break;case"point":var m=d.point;a[c+"Color"]={type:Sf.a.FLOAT_VEC3,value:m.color},Object(s.default)(d.node)&&(a[c+"Transform"]={node:d.node,semantic:"MODELVIEW",type:Sf.a.FLOAT_MAT4}),a[c+"Attenuation"]={type:Sf.a.FLOAT_VEC3,value:[m.constantAttenuation,m.linearAttenuation,m.quadraticAttenuation]};break;case"spot":var v=d.spot;a[c+"Color"]={type:Sf.a.FLOAT_VEC3,value:v.color},Object(s.default)(d.node)&&(a[c+"Transform"]={node:d.node,semantic:"MODELVIEW",type:Sf.a.FLOAT_MAT4},a[c+"InverseTransform"]={node:d.node,semantic:"MODELVIEWINVERSE",type:Sf.a.FLOAT_MAT4,useInFragment:!0}),a[c+"Attenuation"]={type:Sf.a.FLOAT_VEC3,value:[v.constantAttenuation,v.linearAttenuation,v.quadraticAttenuation]},a[c+"FallOff"]={type:Sf.a.FLOAT_VEC2,value:[v.fallOffAngle,v.fallOffExponent]}}++l}}return a}(e),r=ip.splitIncompatibleMaterials(e),n={},l=!1;return Kf.material(e,(function(u,d){if(Object(s.default)(u.extensions)&&Object(s.default)(u.extensions.KHR_materials_common)){var f=u.extensions.KHR_materials_common,c=r[d],h=function(e,t){var a="";a+="technique:"+e.technique+";";for(var i=e.values,r=Object.keys(i).sort(),n=r.length,l=0;l<n;++l){var u=r[l];i.hasOwnProperty(u)&&(a+=u+":"+op(u,i[u]),a+=";")}var d=Object(o.default)(e.jointCount,0);if(a+=d.toString()+";",Object(s.default)(t)){var f=t.skinning;d>0&&(a+=f.type+";"),a+=t.hasVertexColors}return a}(f,c),p=n[h];Object(s.default)(p)||(p=function(e,t,a,i,r,n){Object(s.default)(i)||(i={});n=Object(o.default)(n,!1);var l,u=t.techniques,d=t.shaders,f=t.programs,c=i.technique.toUpperCase();Object(s.default)(e.extensions)&&Object(s.default)(e.extensions.KHR_materials_common)&&(l=e.extensions.KHR_materials_common.lights);var h,p=i.values,m=Object(o.default)(i.jointCount,0),v=!1,g=!1;Object(s.default)(a)&&(h=a.skinning,v=h.skinned,g=a.hasVertexColors);var _,y="precision highp float;\n",b="precision highp float;\n",O="CONSTANT"!==c,w={u_modelViewMatrix:{semantic:Wf(e,"CESIUM_RTC")?"CESIUM_RTC_MODELVIEW":"MODELVIEW",type:Sf.a.FLOAT_MAT4},u_projectionMatrix:{semantic:"PROJECTION",type:Sf.a.FLOAT_MAT4}};O&&(w.u_normalMatrix={semantic:"MODELVIEWINVERSETRANSPOSE",type:Sf.a.FLOAT_MAT3});v&&(w.u_jointMatrix={count:m,semantic:"JOINTMATRIX",type:Sf.a.FLOAT_MAT4});var x=!1;for(var A in p)if(p.hasOwnProperty(A)&&"transparent"!==A&&"doubleSided"!==A){var j=op(A,p[A]);_="u_"+A.toLowerCase(),x||j!==Sf.a.SAMPLER_2D||(x=!0),w[_]={type:j}}Object(s.default)(w.u_diffuse)&&(w.u_diffuse.semantic="_3DTILESDIFFUSE");if(Object(s.default)(r))for(var E in r)r.hasOwnProperty(E)&&(w[_="u_"+E]=r[E]);for(_ in w)if(w.hasOwnProperty(_)){var C=w[_],P=Object(s.default)(C.count)?"["+C.count+"]":"";C.type!==Sf.a.FLOAT_MAT3&&C.type!==Sf.a.FLOAT_MAT4||C.useInFragment?(b+="uniform "+np(C.type)+" "+_+P+";\n",delete C.useInFragment):y+="uniform "+np(C.type)+" "+_+P+";\n"}var T="";if(v){var D,I,S=Xf(h.type),M=!1;if(0===h.type.indexOf("MAT")&&(M=!0,S=Math.sqrt(S)),M)for(D=0;D<S;D++)for(I=0;I<S;I++)T+=0===D&&0===I?"  mat4 skinMat = ":"  skinMat += ",T+="a_weight["+D+"]["+I+"] * u_jointMatrix[int(a_joint["+D+"]["+I+"])];\n";else for(D=0;D<S;D++)T+=0===D?"  mat4 skinMat = ":"  skinMat += ",T+="a_weight["+D+"] * u_jointMatrix[int(a_joint["+D+"])];\n"}var R,L={a_position:{semantic:"POSITION"}};y+="attribute vec3 a_position;\n",y+="varying vec3 v_positionEC;\n",T+=v?"  vec4 pos = u_modelViewMatrix * skinMat * vec4(a_position,1.0);\n":"  vec4 pos = u_modelViewMatrix * vec4(a_position,1.0);\n";T+="  v_positionEC = pos.xyz;\n",T+="  gl_Position = u_projectionMatrix * pos;\n",b+="varying vec3 v_positionEC;\n",O&&(L.a_normal={semantic:"NORMAL"},y+="attribute vec3 a_normal;\n",y+="varying vec3 v_normal;\n",T+=v?"  v_normal = u_normalMatrix * mat3(skinMat) * a_normal;\n":"  v_normal = u_normalMatrix * a_normal;\n",b+="varying vec3 v_normal;\n");x&&(L.a_texcoord_0={semantic:"TEXCOORD_0"},y+="attribute vec2 a_texcoord_0;\n",y+="varying vec2 "+(R="v_texcoord_0")+";\n",T+="  "+R+" = a_texcoord_0;\n",b+="varying vec2 "+R+";\n");if(v){var V=ip.getShaderVariable(h.type);L.a_joint={semantic:"JOINT"},L.a_weight={semantic:"WEIGHT"},y+="attribute "+V+" a_joint;\n",y+="attribute "+V+" a_weight;\n"}g&&(L.a_vertexColor={semantic:"COLOR_0"},y+="attribute vec4 a_vertexColor;\n",y+="varying vec4 v_vertexColor;\n",T+="  v_vertexColor = a_vertexColor;\n",b+="varying vec4 v_vertexColor;\n");n&&(L.a_batchId={semantic:"_BATCHID"},y+="attribute float a_batchId;\n");var N=O&&("BLINN"===c||"PHONG"===c)&&Object(s.default)(w.u_specular)&&Object(s.default)(w.u_shininess)&&w.u_shininess>0,F=!1,B=!1,U="";for(var H in l)if(l.hasOwnProperty(H)){var k=l[H],z=k.type.toLowerCase(),G=k.baseName;U+="  {\n";var q,W,Y="u_"+G+"Color";"ambient"===z?(B=!0,U+="    ambientLight += "+Y+";\n"):O&&(F=!0,q="v_"+G+"Direction",W="v_"+G+"Position","point"!==z&&(y+="varying vec3 "+q+";\n",b+="varying vec3 "+q+";\n",T+="  "+q+" = mat3(u_"+G+"Transform) * vec3(0.,0.,1.);\n","directional"===z&&(U+="    vec3 l = normalize("+q+");\n")),"directional"!==z?(y+="varying vec3 "+W+";\n",b+="varying vec3 "+W+";\n",T+="  "+W+" = u_"+G+"Transform[3].xyz;\n",U+="    vec3 VP = "+W+" - v_positionEC;\n",U+="    vec3 l = normalize(VP);\n",U+="    float range = length(VP);\n",U+="    float attenuation = 1.0 / (u_"+G+"Attenuation.x + ",U+="(u_"+G+"Attenuation.y * range) + ",U+="(u_"+G+"Attenuation.z * range * range));\n"):U+="    float attenuation = 1.0;\n","spot"===z&&(U+="    float spotDot = dot(l, normalize("+q+"));\n",U+="    if (spotDot < cos(u_"+G+"FallOff.x * 0.5))\n",U+="    {\n",U+="      attenuation = 0.0;\n",U+="    }\n",U+="    else\n",U+="    {\n",U+="        attenuation *= max(0.0, pow(spotDot, u_"+G+"FallOff.y));\n",U+="    }\n"),U+="    diffuseLight += "+Y+"* max(dot(normal,l), 0.) * attenuation;\n",N&&("BLINN"===c?(U+="    vec3 h = normalize(l + viewDir);\n",U+="    float specularIntensity = max(0., pow(max(dot(normal, h), 0.), u_shininess)) * attenuation;\n"):(U+="    vec3 reflectDir = reflect(-l, normal);\n",U+="    float specularIntensity = max(0., pow(max(dot(reflectDir, viewDir), 0.), u_shininess)) * attenuation;\n"),U+="    specularLight += "+Y+" * specularIntensity;\n")),U+="  }\n"}B||(U+="  ambientLight += vec3(0.2, 0.2, 0.2);\n");if(!F&&"CONSTANT"!==c){b+="#ifdef USE_CUSTOM_LIGHT_COLOR \n",b+="uniform vec3 gltf_lightColor; \n",b+="#endif \n",U+="#ifndef USE_CUSTOM_LIGHT_COLOR \n",U+="    vec3 lightColor = czm_lightColor;\n",U+="#else \n",U+="    vec3 lightColor = gltf_lightColor;\n",U+="#endif \n",U+="  vec3 l = normalize(czm_lightDirectionEC);\n";U+="  diffuseLight += lightColor * max(dot(normal,l), 0.2);\n",N&&("BLINN"===c?(U+="  vec3 h = normalize(l + viewDir);\n",U+="  float specularIntensity = max(0., pow(max(dot(normal, h), 0.), u_shininess));\n"):(U+="  vec3 reflectDir = reflect(-l, normal);\n",U+="  float specularIntensity = max(0., pow(max(dot(reflectDir, viewDir), 0.), u_shininess));\n"),U+="  specularLight += lightColor * specularIntensity;\n")}y+="void main(void) {\n",y+=T,y+="}\n",b+="void main(void) {\n";var K,X="  vec3 color = vec3(0.0, 0.0, 0.0);\n";O&&(b+="  vec3 normal = normalize(v_normal);\n",i.doubleSided&&(b+="  if (gl_FrontFacing == false)\n",b+="  {\n",b+="    normal = -normal;\n",b+="  }\n"));"CONSTANT"!==c?(Object(s.default)(w.u_diffuse)&&(w.u_diffuse.type===Sf.a.SAMPLER_2D?b+="  vec4 diffuse = texture2D(u_diffuse, "+R+");\n":b+="  vec4 diffuse = u_diffuse;\n",b+="  vec3 diffuseLight = vec3(0.0, 0.0, 0.0);\n",X+="  color += diffuse.rgb * diffuseLight;\n"),N&&(w.u_specular.type===Sf.a.SAMPLER_2D?b+="  vec3 specular = texture2D(u_specular, "+R+").rgb;\n":b+="  vec3 specular = u_specular.rgb;\n",b+="  vec3 specularLight = vec3(0.0, 0.0, 0.0);\n",X+="  color += specular * specularLight;\n"),K=Object(s.default)(w.u_transparency)?"  gl_FragColor = vec4(color * diffuse.a * u_transparency, diffuse.a * u_transparency);\n":"  gl_FragColor = vec4(color * diffuse.a, diffuse.a);\n"):K=Object(s.default)(w.u_transparency)?"  gl_FragColor = vec4(color * u_transparency, u_transparency);\n":"  gl_FragColor = vec4(color, 1.0);\n";g&&(X+="  color *= v_vertexColor.rgb;\n");Object(s.default)(w.u_emission)&&(w.u_emission.type===Sf.a.SAMPLER_2D?b+="  vec3 emission = texture2D(u_emission, "+R+").rgb;\n":b+="  vec3 emission = u_emission.rgb;\n",X+="  color += emission;\n");(Object(s.default)(w.u_ambient)||"CONSTANT"!==c)&&(Object(s.default)(w.u_ambient)?w.u_ambient.type===Sf.a.SAMPLER_2D?b+="  vec3 ambient = texture2D(u_ambient, "+R+").rgb;\n":b+="  vec3 ambient = u_ambient.rgb;\n":b+="  vec3 ambient = diffuse.rgb;\n",X+="  color += ambient * ambientLight;\n");b+="  vec3 viewDir = -normalize(v_positionEC);\n",b+="  vec3 ambientLight = vec3(0.0, 0.0, 0.0);\n",b+=U,b+=X,b+=K,b+="}\n";var Z=qf(d,{type:Sf.a.VERTEX_SHADER,extras:{_pipeline:{source:y,extension:".glsl"}}}),J=qf(d,{type:Sf.a.FRAGMENT_SHADER,extras:{_pipeline:{source:b,extension:".glsl"}}}),Q=qf(f,{fragmentShader:J,vertexShader:Z});return qf(u,{attributes:L,program:Q,uniforms:w})}(e,a,c,f,i,t.addBatchIdToGeneratedShaders),n[h]=p,l=!0);var m={},v=f.values;for(var g in v)v.hasOwnProperty(g)&&"transparent"!==g&&"doubleSided"!==g&&(m["u_"+g.toLowerCase()]=v[g]);u.extensions.KHR_techniques_webgl={technique:p,values:m},u.alphaMode="OPAQUE",f.transparent&&(u.alphaMode="BLEND"),f.doubleSided&&(u.doubleSided=!0)}})),l?(ip.ensureSemanticExistence(e),e):e}};function lp(e,t,a,i,r){var n;return Object(s.default)(a[t+"Offset"])?(n=t+"Coord",r.fragmentShaderMain+="    vec2 "+n+" = computeTexCoord("+i+", "+t+"Offset, "+t+"Rotation, "+t+"Scale);\n"):n=i,n}var up=[0,0],dp=[0],fp=[1,1];function cp(e,t,a){if(-1!==e.indexOf("Texture")&&Object(s.default)(t.extensions)&&Object(s.default)(t.extensions.KHR_texture_transform)){var i="u_"+e,r=t.extensions.KHR_texture_transform;a[i+"Offset"]=Object(o.default)(r.offset,up),a[i+"Rotation"]=Object(o.default)(r.rotation,dp),a[i+"Scale"]=Object(o.default)(r.scale,fp),Object(s.default)(t.texCoord)&&Object(s.default)(r.texCoord)&&(a[i].texCoord=r.texCoord)}}function hp(e){if(-1!==e.indexOf("Offset"))return Sf.a.FLOAT_VEC2;if(-1!==e.indexOf("Rotation"))return Sf.a.FLOAT;if(-1!==e.indexOf("Scale"))return Sf.a.FLOAT_VEC2;if(-1!==e.indexOf("Texture"))return Sf.a.SAMPLER_2D;switch(e){case"u_baseColorFactor":return Sf.a.FLOAT_VEC4;case"u_metallicFactor":case"u_roughnessFactor":return Sf.a.FLOAT;case"u_emissiveFactor":return Sf.a.FLOAT_VEC3;case"u_diffuseFactor":return Sf.a.FLOAT_VEC4;case"u_specularFactor":return Sf.a.FLOAT_VEC3;case"u_glossinessFactor":return Sf.a.FLOAT}}var pp=function(e,t){if(t=Object(o.default)(t,o.default.EMPTY_OBJECT),Wf(e,"KHR_techniques_webgl"))return e;if(!Object(s.default)(e.materials)||0===e.materials.length)return e;Object(s.default)(e.extensions)||(e.extensions={}),Object(s.default)(e.extensionsUsed)||(e.extensionsUsed=[]),Object(s.default)(e.extensionsRequired)||(e.extensionsRequired=[]),e.extensions.KHR_techniques_webgl={programs:[],shaders:[],techniques:[]},e.extensionsUsed.push("KHR_techniques_webgl"),e.extensionsRequired.push("KHR_techniques_webgl");var a=ip.splitIncompatibleMaterials(e);return Kf.material(e,(function(i,r){var n={},l=function(e,t,a,i,r,n){var l,u,d,f=Object(o.default)(n.addBatchIdToGeneratedShaders,!1),c=e.extensions.KHR_techniques_webgl,h=c.techniques,p=c.shaders,m=c.programs,v=function(e){return Object(s.default)(e.extensions)&&Object(s.default)(e.extensions.KHR_materials_pbrSpecularGlossiness)}(t),g=t.pbrMetallicRoughness;if(Object(s.default)(g)&&!v)for(u in g)g.hasOwnProperty(u)&&(d=g[u],i[l="u_"+u]=d,cp(u,d,i));if(v){var _=t.extensions.KHR_materials_pbrSpecularGlossiness;for(u in _)_.hasOwnProperty(u)&&(d=_[u],i[l="u_"+u]=d,cp(u,d,i))}for(var y in t)t.hasOwnProperty(y)&&(y.indexOf("Texture")>=0||y.indexOf("Factor")>=0)&&(d=t[y],i[l="u_"+y]=d,cp(y,d,i));var b,O="precision highp float;\n",w="precision highp float;\n";Object(s.default)(e.skins)&&(b=e.skins[0]);var x,A,j=Object(s.default)(b)?b.joints:[],E=j.length,C=r[a],P=!1,T=!1,D=!1,I=!1,S=!1,M=!1,R=!1;Object(s.default)(C)&&(x=C.skinning,P=x.skinned&&j.length>0,T=C.hasVertexColors,D=C.hasMorphTargets,I=C.hasNormals,S=C.hasTangents,M=C.hasTexCoords);D&&Kf.mesh(e,(function(e){Kf.meshPrimitive(e,(function(e){if(e.material===a){var t=e.targets;Object(s.default)(t)&&(A=t)}}))}));var L={u_modelViewMatrix:{semantic:Wf(e,"CESIUM_RTC")?"CESIUM_RTC_MODELVIEW":"MODELVIEW",type:Sf.a.FLOAT_MAT4},u_projectionMatrix:{semantic:"PROJECTION",type:Sf.a.FLOAT_MAT4}};Object(s.default)(t.extensions)&&Object(s.default)(t.extensions.KHR_materials_unlit)&&(R=!0,I=!1,S=!1);I&&(L.u_normalMatrix={semantic:"MODELVIEWINVERSETRANSPOSE",type:Sf.a.FLOAT_MAT3});P&&(L.u_jointMatrix={count:E,semantic:"JOINTMATRIX",type:Sf.a.FLOAT_MAT4});D&&(L.u_morphWeights={count:A.length,semantic:"MORPHWEIGHTS",type:Sf.a.FLOAT});var V=t.alphaMode;Object(s.default)(V)&&"MASK"===V&&(L.u_alphaCutoff={semantic:"ALPHACUTOFF",type:Sf.a.FLOAT});for(l in i)i.hasOwnProperty(l)&&(L[l]={type:hp(l)});var N=Object(o.default)(L.u_baseColorTexture,L.u_baseColorFactor);Object(s.default)(N)&&(N.semantic="_3DTILESDIFFUSE");for(l in L)if(L.hasOwnProperty(l)){var F=L[l],B=Object(s.default)(F.count)?"["+F.count+"]":"";F.type!==Sf.a.FLOAT_MAT3&&F.type!==Sf.a.FLOAT_MAT4&&"u_morphWeights"!==l||F.useInFragment?(w+="uniform "+np(F.type)+" "+l+B+";\n",delete F.useInFragment):O+="uniform "+np(F.type)+" "+l+B+";\n"}var U="";if(P){var H,k,z=Xf(x.type),G=!1;if(0===x.type.indexOf("MAT")&&(G=!0,z=Math.sqrt(z)),G)for(H=0;H<z;H++)for(k=0;k<z;k++)U+=0===H&&0===k?"    mat4 skinMatrix = ":"    skinMatrix += ",U+="a_weight["+H+"]["+k+"] * u_jointMatrix[int(a_joint["+H+"]["+k+"])];\n";else for(H=0;H<z;H++)U+=0===H?"    mat4 skinMatrix = ":"    skinMatrix += ",U+="a_weight["+H+"] * u_jointMatrix[int(a_joint["+H+"])];\n"}var q={a_position:{semantic:"POSITION"}};O+="attribute vec3 a_position;\n",I&&(O+="varying vec3 v_positionEC;\n");U+="    vec3 weightedPosition = a_position;\n",I&&(U+="    vec3 weightedNormal = a_normal;\n");S&&(U+="    vec4 weightedTangent = a_tangent;\n");if(D)for(var W=0;W<A.length;W++){var Y=A[W];for(var K in Y)if(Y.hasOwnProperty(K)&&"extras"!==K){var X="a_"+K+"_"+W;q[X]={semantic:K+"_"+W},O+="attribute vec3 "+X+";\n","POSITION"===K?U+="    weightedPosition += u_morphWeights["+W+"] * "+X+";\n":"NORMAL"===K?U+="    weightedNormal += u_morphWeights["+W+"] * "+X+";\n":S&&"TANGENT"===K&&(U+="    weightedTangent.xyz += u_morphWeights["+W+"] * "+X+";\n")}}U+=P?"    vec4 position = skinMatrix * vec4(weightedPosition, 1.0);\n":"    vec4 position = vec4(weightedPosition, 1.0);\n";U+="    position = u_modelViewMatrix * position;\n",I&&(U+="    v_positionEC = position.xyz;\n");U+="    gl_Position = u_projectionMatrix * position;\n",I&&(q.a_normal={semantic:"NORMAL"},O+="attribute vec3 a_normal;\n",O+="varying vec3 v_normal;\n",U+=P?"    v_normal = u_normalMatrix * mat3(skinMatrix) * weightedNormal;\n":"    v_normal = u_normalMatrix * weightedNormal;\n",w+="varying vec3 v_normal;\n",w+="varying vec3 v_positionEC;\n");S&&(q.a_tangent={semantic:"TANGENT"},O+="attribute vec4 a_tangent;\n",O+="varying vec4 v_tangent;\n",U+="    v_tangent.xyz = u_normalMatrix * weightedTangent.xyz;\n",U+="    v_tangent.w = weightedTangent.w;\n",w+="varying vec4 v_tangent;\n");var Z,J,Q,$,ee,te,ae,ie,re="";if(M){q.a_texcoord_0={semantic:"TEXCOORD_0"},O+="attribute vec2 a_texcoord_0;\n",O+="varying vec2 v_texcoord_0;\n",U+="    v_texcoord_0 = a_texcoord_0;\n",w+="varying vec2 v_texcoord_0;\n";var ne={fragmentShaderMain:re};J=lp(e,"u_normalTexture",i,Z="v_texcoord_0",ne),Q=lp(e,"u_baseColorTexture",i,Z,ne),$=lp(e,"u_specularGlossinessTexture",i,Z,ne),ee=lp(e,"u_diffuseTexture",i,Z,ne),te=lp(e,"u_metallicRoughnessTexture",i,Z,ne),ae=lp(e,"u_occlusionTexture",i,Z,ne),ie=lp(e,"u_emmissiveTexture",i,Z,ne),re=ne.fragmentShaderMain}if(P){var oe=ip.getShaderVariable(x.type);q.a_joint={semantic:"JOINTS_0"},q.a_weight={semantic:"WEIGHTS_0"},O+="attribute "+oe+" a_joint;\n",O+="attribute "+oe+" a_weight;\n"}T&&(q.a_vertexColor={semantic:"COLOR_0"},O+="attribute vec4 a_vertexColor;\n",O+="varying vec4 v_vertexColor;\n",U+="  v_vertexColor = a_vertexColor;\n",w+="varying vec4 v_vertexColor;\n");f&&(q.a_batchId={semantic:"_BATCHID"},O+="attribute float a_batchId;\n");O+="void main(void) \n{\n",O+=U,O+="}\n",I&&(w+="const float M_PI = 3.141592653589793;\n",w+="vec3 lambertianDiffuse(vec3 diffuseColor) \n{\n    return diffuseColor / M_PI;\n}\n\n",w+="vec3 fresnelSchlick2(vec3 f0, vec3 f90, float VdotH) \n{\n    return f0 + (f90 - f0) * pow(clamp(1.0 - VdotH, 0.0, 1.0), 5.0);\n}\n\n",w+="vec3 fresnelSchlick(float metalness, float VdotH) \n{\n    return metalness + (vec3(1.0) - metalness) * pow(1.0 - VdotH, 5.0);\n}\n\n",w+="float smithVisibilityG1(float NdotV, float roughness) \n{\n    float k = (roughness + 1.0) * (roughness + 1.0) / 8.0;\n    return NdotV / (NdotV * (1.0 - k) + k);\n}\n\n",w+="float smithVisibilityGGX(float roughness, float NdotL, float NdotV) \n{\n    return smithVisibilityG1(NdotL, roughness) * smithVisibilityG1(NdotV, roughness);\n}\n\n",w+="float GGX(float roughness, float NdotH) \n{\n    float roughnessSquared = roughness * roughness;\n    float f = (NdotH * roughnessSquared - NdotH) * NdotH + 1.0;\n    return roughnessSquared / (M_PI * f * f);\n}\n\n");w+="vec3 SRGBtoLINEAR3(vec3 srgbIn) \n{\n    return pow(srgbIn, vec3(2.2));\n}\n\n",w+="vec4 SRGBtoLINEAR4(vec4 srgbIn) \n{\n    vec3 linearOut = pow(srgbIn.rgb, vec3(2.2));\n    return vec4(linearOut, srgbIn.a);\n}\n\n",w+="vec3 applyTonemapping(vec3 linearIn) \n{\n#ifndef HDR \n    return czm_acesTonemapping(linearIn);\n#else \n    return linearIn;\n#endif \n}\n\n",w+="vec3 LINEARtoSRGB(vec3 linearIn) \n{\n#ifndef HDR \n    return pow(linearIn, vec3(1.0/2.2));\n#else \n    return linearIn;\n#endif \n}\n\n",w+="vec2 computeTexCoord(vec2 texCoords, vec2 offset, float rotation, vec2 scale) \n{\n    rotation = -rotation; \n    mat3 transform = mat3(\n        cos(rotation) * scale.x, sin(rotation) * scale.x, 0.0, \n       -sin(rotation) * scale.y, cos(rotation) * scale.y, 0.0, \n        offset.x, offset.y, 1.0); \n    vec2 transformedTexCoords = (transform * vec3(fract(texCoords), 1.0)).xy; \n    return transformedTexCoords; \n}\n\n",w+="#ifdef USE_IBL_LIGHTING \n",w+="uniform vec2 gltf_iblFactor; \n",w+="#endif \n",w+="#ifdef USE_CUSTOM_LIGHT_COLOR \n",w+="uniform vec3 gltf_lightColor; \n",w+="#endif \n",w+="void main(void) \n{\n",w+=re,I&&(w+="    vec3 ng = normalize(v_normal);\n",w+="    vec3 positionWC = vec3(czm_inverseView * vec4(v_positionEC, 1.0));\n",Object(s.default)(i.u_normalTexture)?S?(w+="    vec3 t = normalize(v_tangent.xyz);\n",w+="    vec3 b = normalize(cross(ng, t) * v_tangent.w);\n",w+="    mat3 tbn = mat3(t, b, ng);\n",w+="    vec3 n = texture2D(u_normalTexture, "+J+").rgb;\n",w+="    n = normalize(tbn * (2.0 * n - 1.0));\n"):(w="#ifdef GL_OES_standard_derivatives\n#extension GL_OES_standard_derivatives : enable\n#endif\n"+w,w+="#ifdef GL_OES_standard_derivatives\n",w+="    vec3 pos_dx = dFdx(v_positionEC);\n",w+="    vec3 pos_dy = dFdy(v_positionEC);\n",w+="    vec3 tex_dx = dFdx(vec3("+J+",0.0));\n",w+="    vec3 tex_dy = dFdy(vec3("+J+",0.0));\n",w+="    vec3 t = (tex_dy.t * pos_dx - tex_dx.t * pos_dy) / (tex_dx.s * tex_dy.t - tex_dy.s * tex_dx.t);\n",w+="    t = normalize(t - ng * dot(ng, t));\n",w+="    vec3 b = normalize(cross(ng, t));\n",w+="    mat3 tbn = mat3(t, b, ng);\n",w+="    vec3 n = texture2D(u_normalTexture, "+J+").rgb;\n",w+="    n = normalize(tbn * (2.0 * n - 1.0));\n",w+="#else\n",w+="    vec3 n = ng;\n",w+="#endif\n"):w+="    vec3 n = ng;\n",t.doubleSided&&(w+="    if (gl_FrontFacing == false)\n",w+="    {\n",w+="        n = -n;\n",w+="    }\n"));Object(s.default)(i.u_baseColorTexture)?(w+="    vec4 baseColorWithAlpha = SRGBtoLINEAR4(texture2D(u_baseColorTexture, "+Q+"));\n",Object(s.default)(i.u_baseColorFactor)&&(w+="    baseColorWithAlpha *= u_baseColorFactor;\n")):Object(s.default)(i.u_baseColorFactor)?w+="    vec4 baseColorWithAlpha = u_baseColorFactor;\n":w+="    vec4 baseColorWithAlpha = vec4(1.0);\n";T&&(w+="    baseColorWithAlpha *= v_vertexColor;\n");w+="    vec3 baseColor = baseColorWithAlpha.rgb;\n",I?(v?(Object(s.default)(i.u_specularGlossinessTexture)?(w+="    vec4 specularGlossiness = SRGBtoLINEAR4(texture2D(u_specularGlossinessTexture, "+$+"));\n",w+="    vec3 specular = specularGlossiness.rgb;\n",w+="    float glossiness = specularGlossiness.a;\n",Object(s.default)(i.u_specularFactor)&&(w+="    specular *= u_specularFactor;\n"),Object(s.default)(i.u_glossinessFactor)&&(w+="    glossiness *= u_glossinessFactor;\n")):(Object(s.default)(i.u_specularFactor)?w+="    vec3 specular = clamp(u_specularFactor, vec3(0.0), vec3(1.0));\n":w+="    vec3 specular = vec3(1.0);\n",Object(s.default)(i.u_glossinessFactor)?w+="    float glossiness = clamp(u_glossinessFactor, 0.0, 1.0);\n":w+="    float glossiness = 1.0;\n"),Object(s.default)(i.u_diffuseTexture)?(w+="    vec4 diffuse = SRGBtoLINEAR4(texture2D(u_diffuseTexture, "+ee+"));\n",Object(s.default)(i.u_diffuseFactor)&&(w+="    diffuse *= u_diffuseFactor;\n")):Object(s.default)(i.u_diffuseFactor)?w+="    vec4 diffuse = clamp(u_diffuseFactor, vec4(0.0), vec4(1.0));\n":w+="    vec4 diffuse = vec4(1.0);\n"):Object(s.default)(i.u_metallicRoughnessTexture)?(w+="    vec3 metallicRoughness = texture2D(u_metallicRoughnessTexture, "+te+").rgb;\n",w+="    float metalness = clamp(metallicRoughness.b, 0.0, 1.0);\n",w+="    float roughness = clamp(metallicRoughness.g, 0.04, 1.0);\n",Object(s.default)(i.u_metallicFactor)&&(w+="    metalness *= u_metallicFactor;\n"),Object(s.default)(i.u_roughnessFactor)&&(w+="    roughness *= u_roughnessFactor;\n")):(Object(s.default)(i.u_metallicFactor)?w+="    float metalness = clamp(u_metallicFactor, 0.0, 1.0);\n":w+="    float metalness = 1.0;\n",Object(s.default)(i.u_roughnessFactor)?w+="    float roughness = clamp(u_roughnessFactor, 0.04, 1.0);\n":w+="    float roughness = 1.0;\n"),w+="    vec3 v = -normalize(v_positionEC);\n",w+="#ifndef USE_CUSTOM_LIGHT_COLOR \n",w+="    vec3 lightColorHdr = czm_lightColorHdr;\n",w+="#else \n",w+="    vec3 lightColorHdr = gltf_lightColor;\n",w+="#endif \n",w+="    vec3 l = normalize(czm_lightDirectionEC);\n",w+="    vec3 h = normalize(v + l);\n",w+="    float NdotL = clamp(dot(n, l), 0.001, 1.0);\n",w+="    float NdotV = abs(dot(n, v)) + 0.001;\n",w+="    float NdotH = clamp(dot(n, h), 0.0, 1.0);\n",w+="    float LdotH = clamp(dot(l, h), 0.0, 1.0);\n",w+="    float VdotH = clamp(dot(v, h), 0.0, 1.0);\n",w+="    vec3 f0 = vec3(0.04);\n",v?(w+="    float roughness = 1.0 - glossiness;\n",w+="    vec3 diffuseColor = diffuse.rgb * (1.0 - max(max(specular.r, specular.g), specular.b));\n",w+="    vec3 specularColor = specular;\n"):(w+="    vec3 diffuseColor = baseColor * (1.0 - metalness) * (1.0 - f0);\n",w+="    vec3 specularColor = mix(f0, baseColor, metalness);\n"),w+="    float alpha = roughness * roughness;\n",w+="    float reflectance = max(max(specularColor.r, specularColor.g), specularColor.b);\n",w+="    vec3 r90 = vec3(clamp(reflectance * 25.0, 0.0, 1.0));\n",w+="    vec3 r0 = specularColor.rgb;\n",w+="    vec3 F = fresnelSchlick2(r0, r90, VdotH);\n",w+="    float G = smithVisibilityGGX(alpha, NdotL, NdotV);\n",w+="    float D = GGX(alpha, NdotH);\n",w+="    vec3 diffuseContribution = (1.0 - F) * lambertianDiffuse(diffuseColor);\n",w+="    vec3 specularContribution = F * G * D / (4.0 * NdotL * NdotV);\n",w+="    vec3 color = NdotL * lightColorHdr * (diffuseContribution + specularContribution);\n",w+="#if defined(USE_IBL_LIGHTING) && !defined(DIFFUSE_IBL) && !defined(SPECULAR_IBL) \n",w+="    vec3 r = normalize(czm_inverseViewRotation * normalize(reflect(v, n)));\n",w+="    float vertexRadius = length(positionWC);\n",w+="    float horizonDotNadir = 1.0 - min(1.0, czm_ellipsoidRadii.x / vertexRadius);\n",w+="    float reflectionDotNadir = dot(r, normalize(positionWC));\n",w+="    r.x = -r.x;\n",w+="    r = -normalize(czm_temeToPseudoFixed * r);\n",w+="    r.x = -r.x;\n",w+="    float inverseRoughness = 1.04 - roughness;\n",w+="    inverseRoughness *= inverseRoughness;\n",w+="    vec3 sceneSkyBox = textureCube(czm_environmentMap, r).rgb * inverseRoughness;\n",w+="    float atmosphereHeight = 0.05;\n",w+="    float blendRegionSize = 0.1 * ((1.0 - inverseRoughness) * 8.0 + 1.1 - horizonDotNadir);\n",w+="    float blendRegionOffset = roughness * -1.0;\n",w+="    float farAboveHorizon = clamp(horizonDotNadir - blendRegionSize * 0.5 + blendRegionOffset, 1.0e-10 - blendRegionSize, 0.99999);\n",w+="    float aroundHorizon = clamp(horizonDotNadir + blendRegionSize * 0.5, 1.0e-10 - blendRegionSize, 0.99999);\n",w+="    float farBelowHorizon = clamp(horizonDotNadir + blendRegionSize * 1.5, 1.0e-10 - blendRegionSize, 0.99999);\n",w+="    float smoothstepHeight = smoothstep(0.0, atmosphereHeight, horizonDotNadir);\n",w+="    vec3 belowHorizonColor = mix(vec3(0.1, 0.15, 0.25), vec3(0.4, 0.7, 0.9), smoothstepHeight);\n",w+="    vec3 nadirColor = belowHorizonColor * 0.5;\n",w+="    vec3 aboveHorizonColor = mix(vec3(0.9, 1.0, 1.2), belowHorizonColor, roughness * 0.5);\n",w+="    vec3 blueSkyColor = mix(vec3(0.18, 0.26, 0.48), aboveHorizonColor, reflectionDotNadir * inverseRoughness * 0.5 + 0.75);\n",w+="    vec3 zenithColor = mix(blueSkyColor, sceneSkyBox, smoothstepHeight);\n",w+="    vec3 blueSkyDiffuseColor = vec3(0.7, 0.85, 0.9);\n",w+="    float diffuseIrradianceFromEarth = (1.0 - horizonDotNadir) * (reflectionDotNadir * 0.25 + 0.75) * smoothstepHeight;\n",w+="    float diffuseIrradianceFromSky = (1.0 - smoothstepHeight) * (1.0 - (reflectionDotNadir * 0.25 + 0.25));\n",w+="    vec3 diffuseIrradiance = blueSkyDiffuseColor * clamp(diffuseIrradianceFromEarth + diffuseIrradianceFromSky, 0.0, 1.0);\n",w+="    float notDistantRough = (1.0 - horizonDotNadir * roughness * 0.8);\n",w+="    vec3 specularIrradiance = mix(zenithColor, aboveHorizonColor, smoothstep(farAboveHorizon, aroundHorizon, reflectionDotNadir) * notDistantRough);\n",w+="    specularIrradiance = mix(specularIrradiance, belowHorizonColor, smoothstep(aroundHorizon, farBelowHorizon, reflectionDotNadir) * inverseRoughness);\n",w+="    specularIrradiance = mix(specularIrradiance, nadirColor, smoothstep(farBelowHorizon, 1.0, reflectionDotNadir) * inverseRoughness);\n",w+="#ifdef USE_SUN_LUMINANCE \n",w+="    float LdotZenith = clamp(dot(normalize(czm_inverseViewRotation * l), normalize(positionWC * -1.0)), 0.001, 1.0);\n",w+="    float S = acos(LdotZenith);\n",w+="    float NdotZenith = clamp(dot(normalize(czm_inverseViewRotation * n), normalize(positionWC * -1.0)), 0.001, 1.0);\n",w+="    float gamma = acos(NdotL);\n",w+="    float numerator = ((0.91 + 10.0 * exp(-3.0 * gamma) + 0.45 * pow(NdotL, 2.0)) * (1.0 - exp(-0.32 / NdotZenith)));\n",w+="    float denominator = (0.91 + 10.0 * exp(-3.0 * S) + 0.45 * pow(LdotZenith,2.0)) * (1.0 - exp(-0.32));\n",w+="    float luminance = gltf_luminanceAtZenith * (numerator / denominator);\n",w+="#endif \n",w+="    vec2 brdfLut = texture2D(czm_brdfLut, vec2(NdotV, roughness)).rg;\n",w+="    vec3 IBLColor = (diffuseIrradiance * diffuseColor * gltf_iblFactor.x) + (specularIrradiance * SRGBtoLINEAR3(specularColor * brdfLut.x + brdfLut.y) * gltf_iblFactor.y);\n",w+="    float maximumComponent = max(max(lightColorHdr.x, lightColorHdr.y), lightColorHdr.z);\n",w+="    vec3 lightColor = lightColorHdr / max(maximumComponent, 1.0);\n",w+="    IBLColor *= lightColor;\n",w+="#ifdef USE_SUN_LUMINANCE \n",w+="    color += IBLColor * luminance;\n",w+="#else \n",w+="    color += IBLColor; \n",w+="#endif \n",w+="#elif defined(DIFFUSE_IBL) || defined(SPECULAR_IBL) \n",w+="    mat3 fixedToENU = mat3(gltf_clippingPlanesMatrix[0][0], gltf_clippingPlanesMatrix[1][0], gltf_clippingPlanesMatrix[2][0], \n",w+="                           gltf_clippingPlanesMatrix[0][1], gltf_clippingPlanesMatrix[1][1], gltf_clippingPlanesMatrix[2][1], \n",w+="                           gltf_clippingPlanesMatrix[0][2], gltf_clippingPlanesMatrix[1][2], gltf_clippingPlanesMatrix[2][2]); \n",w+="    const mat3 yUpToZUp = mat3(-1.0, 0.0, 0.0, 0.0, 0.0, -1.0, 0.0, 1.0, 0.0); \n",w+="    vec3 cubeDir = normalize(yUpToZUp * fixedToENU * normalize(reflect(-v, n))); \n",w+="#ifdef DIFFUSE_IBL \n",w+="#ifdef CUSTOM_SPHERICAL_HARMONICS \n",w+="    vec3 diffuseIrradiance = czm_sphericalHarmonics(cubeDir, gltf_sphericalHarmonicCoefficients); \n",w+="#else \n",w+="    vec3 diffuseIrradiance = czm_sphericalHarmonics(cubeDir, czm_sphericalHarmonicCoefficients); \n",w+="#endif \n",w+="#else \n",w+="    vec3 diffuseIrradiance = vec3(0.0); \n",w+="#endif \n",w+="#ifdef SPECULAR_IBL \n",w+="    vec2 brdfLut = texture2D(czm_brdfLut, vec2(NdotV, roughness)).rg;\n",w+="#ifdef CUSTOM_SPECULAR_IBL \n",w+="    vec3 specularIBL = czm_sampleOctahedralProjection(gltf_specularMap, gltf_specularMapSize, cubeDir,  roughness * gltf_maxSpecularLOD, gltf_maxSpecularLOD);\n",w+="#else \n",w+="    vec3 specularIBL = czm_sampleOctahedralProjection(czm_specularEnvironmentMaps, czm_specularEnvironmentMapSize, cubeDir,  roughness * czm_specularEnvironmentMapsMaximumLOD, czm_specularEnvironmentMapsMaximumLOD);\n",w+="#endif \n",w+="    specularIBL *= F * brdfLut.x + brdfLut.y;\n",w+="#else \n",w+="    vec3 specularIBL = vec3(0.0); \n",w+="#endif \n",w+="    color += diffuseIrradiance * diffuseColor + specularColor * specularIBL;\n",w+="#endif \n"):w+="    vec3 color = baseColor;\n";R||(Object(s.default)(i.u_occlusionTexture)&&(w+="    color *= texture2D(u_occlusionTexture, "+ae+").r;\n"),Object(s.default)(i.u_emissiveTexture)?(w+="    vec3 emissive = SRGBtoLINEAR3(texture2D(u_emissiveTexture, "+ie+").rgb);\n",Object(s.default)(i.u_emissiveFactor)&&(w+="    emissive *= u_emissiveFactor;\n"),w+="    color += emissive;\n"):Object(s.default)(i.u_emissiveFactor)&&(w+="    color += u_emissiveFactor;\n"));R||(w+="    color = applyTonemapping(color);\n");w+="    color = LINEARtoSRGB(color);\n",Object(s.default)(V)?"MASK"===V?(w+="    if (baseColorWithAlpha.a < u_alphaCutoff) {\n",w+="        discard;\n",w+="    }\n",w+="    gl_FragColor = vec4(color, 1.0);\n"):w+="BLEND"===V?"    gl_FragColor = vec4(color, baseColorWithAlpha.a);\n":"    gl_FragColor = vec4(color, 1.0);\n":w+="    gl_FragColor = vec4(color, 1.0);\n";w+="}\n";var se=qf(p,{type:Sf.a.VERTEX_SHADER,extras:{_pipeline:{source:O,extension:".glsl"}}}),le=qf(p,{type:Sf.a.FRAGMENT_SHADER,extras:{_pipeline:{source:w,extension:".glsl"}}}),ue=qf(m,{isOutline:!!Object(s.default)(t.extensions)&&Object(s.default)(t.extensions.TERRIA_solid_outlines),fragmentShader:le,vertexShader:se});return qf(h,{attributes:q,program:ue,uniforms:L})}(e,i,r,n,a,t);Object(s.default)(i.extensions)||(i.extensions={}),i.extensions.KHR_techniques_webgl={values:n,technique:l}})),ip.ensureSemanticExistence(e),e},mp=new y.default,vp=ip.ModelState,gp=Fe.default.EPSILON16;function _p(e,t){e._cachedGltf=t}function yp(e){this._gltf=e.gltf,this.ready=e.ready,this.modelsToLoad=[],this.count=0}Object(l.default)(yp.prototype,{gltf:{set:function(e){this._gltf=e},get:function(){return this._gltf}}}),yp.prototype.makeReady=function(e){this.gltf=e;for(var t=this.modelsToLoad,a=t.length,i=0;i<a;++i){var r=t[i];r.isDestroyed()||_p(r,this)}this.modelsToLoad=void 0,this.ready=!0};var bp={},Op={};function wp(e){var t,a=(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).cacheKey;if(this._cacheKey=a,this._cachedGltf=void 0,this._releaseGltfJson=Object(o.default)(e.releaseGltfJson,!1),Object(s.default)(a)&&Object(s.default)(bp[a])&&bp[a].ready)++(t=bp[a]).count;else{var i=e.gltf;if(Object(s.default)(i)){if(i instanceof ArrayBuffer&&(i=new Uint8Array(i)),i instanceof Uint8Array)t=new yp({gltf:nc(i),ready:!0});else t=new yp({gltf:e.gltf,ready:!0});t.count=1,Object(s.default)(a)&&(bp[a]=t)}}_p(this,t);var n=Object(o.default)(e.basePath,"");this._resource=_f.default.createIfNeeded(n);var l=e.credit;"string"==typeof l&&(l=new wf.default(l)),this._credit=l,this._resourceCredits=[],this.show=Object(o.default)(e.show,!0),this.silhouetteColor=Object(o.default)(e.silhouetteColor,b.default.RED),this._silhouetteColor=new b.default,this._silhouetteColorPreviousAlpha=1,this._normalAttributeName=void 0,this.silhouetteSize=Object(o.default)(e.silhouetteSize,0),this.modelMatrix=lt.default.clone(Object(o.default)(e.modelMatrix,lt.default.IDENTITY)),this._modelMatrix=lt.default.clone(this.modelMatrix),this._clampedModelMatrix=void 0,this.scale=Object(o.default)(e.scale,1),this._scale=this.scale,this.minimumPixelSize=Object(o.default)(e.minimumPixelSize,0),this._minimumPixelSize=this.minimumPixelSize,this.maximumScale=e.maximumScale,this._maximumScale=this.maximumScale,this.id=e.id,this._id=e.id,this.heightReference=Object(o.default)(e.heightReference,A.default.NONE),this._heightReference=this.heightReference,this._heightChanged=!1,this._removeUpdateHeightCallback=void 0;var u=e.scene;this._scene=u,Object(s.default)(u)&&Object(s.default)(u.terrainProviderChanged)&&(this._terrainProviderChangedCallback=u.terrainProviderChanged.addEventListener((function(){this._heightChanged=!0}),this)),this._pickObject=e.pickObject,this._allowPicking=Object(o.default)(e.allowPicking,!0),this._ready=!1,this._readyPromise=Pf.default.defer(),this.activeAnimations=new Ah(this),this.clampAnimations=Object(o.default)(e.clampAnimations,!0),this._defaultTexture=void 0,this._incrementallyLoadTextures=Object(o.default)(e.incrementallyLoadTextures,!0),this._asynchronous=Object(o.default)(e.asynchronous,!0),this.shadows=Object(o.default)(e.shadows,ne.a.ENABLED),this._shadows=this.shadows,this.color=b.default.clone(Object(o.default)(e.color,b.default.WHITE)),this._colorPreviousAlpha=1,this.colorBlendMode=Object(o.default)(e.colorBlendMode,yf.a.HIGHLIGHT),this.colorBlendAmount=Object(o.default)(e.colorBlendAmount,.5),this._colorShadingEnabled=!1,this._clippingPlanes=void 0,this.clippingPlanes=e.clippingPlanes,this._clippingPlanesState=0,this.clippingPlanesOriginMatrix=void 0,this.debugShowBoundingVolume=Object(o.default)(e.debugShowBoundingVolume,!1),this._debugShowBoundingVolume=!1,this.debugWireframe=Object(o.default)(e.debugWireframe,!1),this._debugWireframe=!1,this._distanceDisplayCondition=e.distanceDisplayCondition,this._addBatchIdToGeneratedShaders=e.addBatchIdToGeneratedShaders,this._precreatedAttributes=e.precreatedAttributes,this._vertexShaderLoaded=e.vertexShaderLoaded,this._fragmentShaderLoaded=e.fragmentShaderLoaded,this._uniformMapLoaded=e.uniformMapLoaded,this._pickIdLoaded=e.pickIdLoaded,this._ignoreCommands=Object(o.default)(e.ignoreCommands,!1),this._requestType=e.requestType,this._upAxis=Object(o.default)(e.upAxis,gf.Y),this._gltfForwardAxis=gf.Z,this._forwardAxis=e.forwardAxis,this.cull=Object(o.default)(e.cull,!0),this.opaquePass=Object(o.default)(e.opaquePass,Vf.a.OPAQUE),this._computedModelMatrix=new lt.default,this._clippingPlaneModelViewMatrix=lt.default.clone(lt.default.IDENTITY),this._initialRadius=void 0,this._boundingSphere=void 0,this._scaledBoundingSphere=new r.default,this._state=vp.NEEDS_LOAD,this._loadResources=void 0,this._mode=void 0,this._perNodeShowDirty=!1,this._cesiumAnimationsDirty=!1,this._dirty=!1,this._maxDirtyNumber=0,this._runtime={animations:void 0,articulationsByName:void 0,articulationsByStageKey:void 0,stagesByKey:void 0,rootNodes:void 0,nodes:void 0,nodesByName:void 0,skinnedNodes:void 0,meshesByName:void 0,materialsByName:void 0,materialsById:void 0},this._uniformMaps={},this._extensionsUsed=void 0,this._extensionsRequired=void 0,this._quantizedUniforms={},this._programPrimitives={},this._rendererResources={buffers:{},vertexArrays:{},programs:{},sourceShaders:{},silhouettePrograms:{},textures:{},samplers:{},renderStates:{}},this._cachedRendererResources=void 0,this._loadRendererResourcesFromCache=!1,this._dequantizeInShader=Object(o.default)(e.dequantizeInShader,!0),this._decodedData={},this._cachedGeometryByteLength=0,this._cachedTexturesByteLength=0,this._geometryByteLength=0,this._texturesByteLength=0,this._trianglesLength=0,this._sourceTechniques={},this._sourcePrograms={},this._quantizedVertexShaders={},this._nodeCommands=[],this._pickIds=[],this._rtcCenter=void 0,this._rtcCenterEye=void 0,this._rtcCenter3D=void 0,this._rtcCenter2D=void 0,this._sourceVersion=void 0,this._sourceKHRTechniquesWebGL=void 0,this._imageBasedLightingFactor=new _.default(1,1),_.default.clone(e.imageBasedLightingFactor,this._imageBasedLightingFactor),this._lightColor=y.default.clone(e.lightColor),this._luminanceAtZenith=void 0,this.luminanceAtZenith=Object(o.default)(e.luminanceAtZenith,.2),this._sphericalHarmonicCoefficients=e.sphericalHarmonicCoefficients,this._specularEnvironmentMaps=e.specularEnvironmentMaps,this._shouldUpdateSpecularMapAtlas=!0,this._specularEnvironmentMapAtlas=void 0,this._useDefaultSphericalHarmonics=!1,this._useDefaultSpecularMaps=!1,this._shouldRegenerateShaders=!1}function xp(e){return e.stencilBuffer}function Ap(e){return!b.default.equals(e.color,b.default.WHITE)||e.colorBlendMode!==yf.a.HIGHLIGHT}function jp(e){var t=e._clippingPlanes;return Object(s.default)(t)&&t.enabled&&0!==t.length}function Ep(e,t,a){return e._runtime[t][a]}Object(l.default)(wp.prototype,{gltf:{get:function(){return Object(s.default)(this._cachedGltf)?this._cachedGltf.gltf:void 0}},releaseGltfJson:{get:function(){return this._releaseGltfJson}},cacheKey:{get:function(){return this._cacheKey}},basePath:{get:function(){return this._resource.url}},boundingSphere:{get:function(){var e=this.modelMatrix;this.heightReference!==A.default.NONE&&this._clampedModelMatrix&&(e=this._clampedModelMatrix);var t=lt.default.getScale(e,mp),a=Object(s.default)(this.maximumScale)?Math.min(this.maximumScale,this.scale):this.scale;y.default.multiplyByScalar(t,a,t);var i=this._scaledBoundingSphere;return i.center=y.default.multiplyComponents(this._boundingSphere.center,t,i.center),i.radius=y.default.maximumComponent(t)*this._initialRadius,Object(s.default)(this._rtcCenter)&&y.default.add(this._rtcCenter,i.center,i.center),i}},ready:{get:function(){return this._ready}},readyPromise:{get:function(){return this._readyPromise.promise}},asynchronous:{get:function(){return this._asynchronous}},allowPicking:{get:function(){return this._allowPicking}},incrementallyLoadTextures:{get:function(){return this._incrementallyLoadTextures}},pendingTextureLoads:{get:function(){return Object(s.default)(this._loadResources)?this._loadResources.pendingTextureLoads:0}},dirty:{get:function(){return this._dirty}},distanceDisplayCondition:{get:function(){return this._distanceDisplayCondition},set:function(e){this._distanceDisplayCondition=w.a.clone(e,this._distanceDisplayCondition)}},extensionsUsed:{get:function(){return Object(s.default)(this._extensionsUsed)||(this._extensionsUsed=ip.getUsedExtensions(this.gltf)),this._extensionsUsed}},extensionsRequired:{get:function(){return Object(s.default)(this._extensionsRequired)||(this._extensionsRequired=ip.getRequiredExtensions(this.gltf)),this._extensionsRequired}},upAxis:{get:function(){return this._upAxis}},forwardAxis:{get:function(){return Object(s.default)(this._forwardAxis)?this._forwardAxis:this._gltfForwardAxis}},trianglesLength:{get:function(){return this._trianglesLength}},geometryByteLength:{get:function(){return this._geometryByteLength}},texturesByteLength:{get:function(){return this._texturesByteLength}},cachedGeometryByteLength:{get:function(){return this._cachedGeometryByteLength}},cachedTexturesByteLength:{get:function(){return this._cachedTexturesByteLength}},clippingPlanes:{get:function(){return this._clippingPlanes},set:function(e){e!==this._clippingPlanes&&Uc.a.setOwner(e,this,"_clippingPlanes")}},pickIds:{get:function(){return this._pickIds}},imageBasedLightingFactor:{get:function(){return this._imageBasedLightingFactor},set:function(e){var t=this._imageBasedLightingFactor;e===t||_.default.equals(e,t)||(this._shouldRegenerateShaders=this._shouldRegenerateShaders||this._imageBasedLightingFactor.x>0&&0===e.x||0===this._imageBasedLightingFactor.x&&e.x>0,this._shouldRegenerateShaders=this._shouldRegenerateShaders||this._imageBasedLightingFactor.y>0&&0===e.y||0===this._imageBasedLightingFactor.y&&e.y>0,_.default.clone(e,this._imageBasedLightingFactor))}},lightColor:{get:function(){return this._lightColor},set:function(e){var t=this._lightColor;e===t||y.default.equals(e,t)||(this._shouldRegenerateShaders=this._shouldRegenerateShaders||Object(s.default)(t)&&!Object(s.default)(e)||Object(s.default)(e)&&!Object(s.default)(t),this._lightColor=y.default.clone(e,t))}},luminanceAtZenith:{get:function(){return this._luminanceAtZenith},set:function(e){var t=this._luminanceAtZenith;e!==t&&(this._shouldRegenerateShaders=this._shouldRegenerateShaders||Object(s.default)(t)&&!Object(s.default)(e)||Object(s.default)(e)&&!Object(s.default)(t),this._luminanceAtZenith=e)}},sphericalHarmonicCoefficients:{get:function(){return this._sphericalHarmonicCoefficients},set:function(e){e!==this._sphericalHarmonicCoefficients&&(this._sphericalHarmonicCoefficients=e,this._shouldRegenerateShaders=!0)}},specularEnvironmentMaps:{get:function(){return this._specularEnvironmentMaps},set:function(e){this._shouldUpdateSpecularMapAtlas=this._shouldUpdateSpecularMapAtlas||e!==this._specularEnvironmentMaps,this._specularEnvironmentMaps=e}},credit:{get:function(){return this._credit}}}),wp.silhouetteSupported=function(e){return xp(e.context)},wp.fromGltf=function(e){var t=e.url;e=Object(bf.default)(e);var a=_f.default.createIfNeeded(t),i=Object(o.default)(e.basePath,a.clone()),r=_f.default.createIfNeeded(i),l=Object(o.default)(e.cacheKey,Op[Object(Af.a)(a.url)]);Object(s.default)(l)||(l=Object(n.default)(),Op[Object(Af.a)(a.url)]=l),Object(s.default)(e.basePath)&&!Object(s.default)(e.cacheKey)&&(l+=r.url),e.cacheKey=l,e.basePath=r;var u=new wp(e),d=bp[l];return Object(s.default)(d)?d.ready||(++d.count,d.modelsToLoad.push(u)):((d=new yp({ready:!1})).count=1,d.modelsToLoad.push(u),_p(u,d),bp[l]=d,Object(s.default)(a.headers.Accept)||(a.headers.Accept="model/gltf-binary,model/gltf+json;q=0.8,application/json;q=0.2,*/*;q=0.01"),a.fetchArrayBuffer().then((function(e){var t=new Uint8Array(e);if("glTF"===Ef(t)){var i=nc(t);d.makeReady(i)}else{var r=Object(jf.a)(t);d.makeReady(JSON.parse(r))}var n=u._resourceCredits,o=a.credits;if(Object(s.default)(o))for(var l=o.length,f=0;f<l;f++)n.push(o[f])})).otherwise(ip.getFailedLoadFunction(u,"model",a.url))),u},wp._gltfCache=bp,wp.prototype.getNode=function(e){var t=Ep(this,"nodesByName",e);return Object(s.default)(t)?t.publicNode:void 0},wp.prototype.getMesh=function(e){return Ep(this,"meshesByName",e)},wp.prototype.getMaterial=function(e){return Ep(this,"materialsByName",e)},wp.prototype.setArticulationStage=function(e,t){var a=Ep(this,"stagesByKey",e),i=Ep(this,"articulationsByStageKey",e);Object(s.default)(a)&&Object(s.default)(i)&&(t=Fe.default.clamp(t,a.minimumValue,a.maximumValue),Fe.default.equalsEpsilon(a.currentValue,t,gp)||(a.currentValue=t,i.isDirty=!0))};var Cp=new y.default,Pp=new at.default;function Tp(e,t){var a,i=e.currentValue,r=Cp;switch(e.type){case"xRotate":a=at.default.fromRotationX(Fe.default.toRadians(i),Pp),lt.default.multiplyByMatrix3(t,a,t);break;case"yRotate":a=at.default.fromRotationY(Fe.default.toRadians(i),Pp),lt.default.multiplyByMatrix3(t,a,t);break;case"zRotate":a=at.default.fromRotationZ(Fe.default.toRadians(i),Pp),lt.default.multiplyByMatrix3(t,a,t);break;case"xTranslate":r.x=i,r.y=0,r.z=0,lt.default.multiplyByTranslation(t,r,t);break;case"yTranslate":r.x=0,r.y=i,r.z=0,lt.default.multiplyByTranslation(t,r,t);break;case"zTranslate":r.x=0,r.y=0,r.z=i,lt.default.multiplyByTranslation(t,r,t);break;case"xScale":r.x=i,r.y=1,r.z=1,lt.default.multiplyByScale(t,r,t);break;case"yScale":r.x=1,r.y=i,r.z=1,lt.default.multiplyByScale(t,r,t);break;case"zScale":r.x=1,r.y=1,r.z=i,lt.default.multiplyByScale(t,r,t);break;case"uniformScale":lt.default.multiplyByUniformScale(t,i,t)}return t}var Dp=new lt.default;function Ip(e,t){return function(a){var i=e._loadResources,r=new Uint8Array(a);--i.pendingBufferLoads,e.gltf.buffers[t].extras._pipeline.source=r}}function Sp(e,t){return function(a){var i=e._loadResources;--i.pendingTextureLoads,i.texturesToCreate.enqueue({id:t,image:a,bufferView:a.bufferView,width:a.width,height:a.height,internalFormat:a.internalFormat})}}wp.prototype.applyArticulations=function(){var e=this._runtime.articulationsByName;for(var t in e)if(e.hasOwnProperty(t)){var a=e[t];if(a.isDirty){a.isDirty=!1;for(var i=a.nodes.length,r=0;r<i;++r){for(var n=a.nodes[r],o=lt.default.clone(n.originalMatrix,Dp),s=a.stages.length,l=0;l<s;++l){o=Tp(a.stages[l],o)}n.matrix=o}}}};var Mp=/(^data:image\/ktx)|(\.ktx$)/i,Rp=/(^data:image\/crn)|(\.crn$)/i;var Lp=new lt.default;var Vp=function(){this.id=void 0,this.model=void 0,this.context=void 0};function Np(e,t,a){var i=t._loadResources,r=t.gltf.bufferViews[e];Object(s.default)(r)||(r=i.createdBufferViews[e]);var n=Mf.a.createVertexBuffer({context:a,typedArray:i.getBuffer(r),usage:Rf.a.STATIC_DRAW});n.vertexArrayDestroyable=!1,t._rendererResources.buffers[e]=n,t._geometryByteLength+=n.sizeInBytes}Vp.prototype.set=function(e,t,a){this.id=e,this.model=t,this.context=a},Vp.prototype.execute=function(){Np(this.id,this.model,this.context)};var Fp=function(){this.id=void 0,this.componentType=void 0,this.model=void 0,this.context=void 0};function Bp(e,t,a,i){var r=a._loadResources,n=a.gltf.bufferViews[e];Object(s.default)(n)||(n=r.createdBufferViews[e]);var o=Mf.a.createIndexBuffer({context:i,typedArray:r.getBuffer(n),usage:Rf.a.STATIC_DRAW,indexDatatype:t});o.vertexArrayDestroyable=!1,a._rendererResources.buffers[e]=o,a._geometryByteLength+=o.sizeInBytes}Fp.prototype.set=function(e,t,a,i){this.id=e,this.componentType=t,this.model=a,this.context=i},Fp.prototype.execute=function(){Bp(this.id,this.componentType,this.model,this.context)};var Up=new Vp,Hp=new Fp;function kp(e,t){var a=e._runtime.materialsById[t.material];if(Object(s.default)(a))return a._program}function zp(e,t,a){var i,r,n,o=a._programPrimitives[t];if(!Object(s.default)(o))return e;for(r in o)if(o.hasOwnProperty(r)&&kp(a,i=o[r])===t)break;if(a._programPrimitives[t]=void 0,a.extensionsUsed.WEB3D_quantized_attributes)n=ip.modifyShaderForQuantizedAttributes(a.gltf,i,e),a._quantizedUniforms[t]=n.uniforms;else{var l=a._decodedData[r];if(!Object(s.default)(l))return e;n=ip.modifyShaderForDracoQuantizedAttributes(a.gltf,i,e,l.attributes)}return n.shader}function Gp(e,t,a){return Object(s.default)(a)&&(e=a(e,t)),e}var qp=function(){this.programToCreate=void 0,this.model=void 0,this.context=void 0};function Wp(e,t,a){var i=e.programId,r=e.techniqueId,n=t._sourcePrograms[i],o=t._rendererResources.sourceShaders,l=o[n.vertexShader],u=o[n.fragmentShader],d=n.isOutline,f=t._quantizedVertexShaders,c=t._toClipCoordinatesGLSL[i];if(t.extensionsUsed.WEB3D_quantized_attributes||t._dequantizeInShader){var h=f[i];Object(s.default)(h)||(h=zp(l,i,t),f[i]=h),l=h}var p=Gp(l,i,t._vertexShaderLoaded),m=Gp(u,i,t._fragmentShaderLoaded);xf.default.isInternetExplorer()||(p=ip.modifyVertexShaderForLogDepth(p,c),m=ip.modifyFragmentShaderForLogDepth(m),d&&(m=m.replace("czm_writeLogDepth();","    czm_writeLogDepth();\n#if defined(LOG_DEPTH) && !defined(DISABLE_LOG_DEPTH_FRAGMENT_WRITE)\n    gl_FragDepthEXT -= 5e-5;\n#endif"))),Object(s.default)(t._uniformMapLoaded)||(m="uniform vec4 czm_pickColor;\n"+m);var v=t._imageBasedLightingFactor.x>0||t._imageBasedLightingFactor.y>0;if(v&&(m="#define USE_IBL_LIGHTING \n\n"+m),Object(s.default)(t._lightColor)&&(m="#define USE_CUSTOM_LIGHT_COLOR \n\n"+m),("2.0"!==t._sourceVersion||t._sourceKHRTechniquesWebGL)&&(m=Uf.a.replaceMain(m,"non_gamma_corrected_main"),m+="\nvoid main() { \n    non_gamma_corrected_main(); \n    gl_FragColor = czm_gammaCorrect(gl_FragColor); \n} \n"),rp.a.isSupported(a)){var g=Object(s.default)(t._sphericalHarmonicCoefficients)||t._useDefaultSphericalHarmonics,_=Object(s.default)(t._specularEnvironmentMapAtlas)&&t._specularEnvironmentMapAtlas.ready||t._useDefaultSpecularMaps;(g||_||v)&&(m="uniform mat4 gltf_clippingPlanesMatrix; \n"+m),Object(s.default)(t._sphericalHarmonicCoefficients)?m="#define DIFFUSE_IBL \n#define CUSTOM_SPHERICAL_HARMONICS \nuniform vec3 gltf_sphericalHarmonicCoefficients[9]; \n"+m:t._useDefaultSphericalHarmonics&&(m="#define DIFFUSE_IBL \n"+m),Object(s.default)(t._specularEnvironmentMapAtlas)&&t._specularEnvironmentMapAtlas.ready?m="#define SPECULAR_IBL \n#define CUSTOM_SPECULAR_IBL \nuniform sampler2D gltf_specularMap; \nuniform vec2 gltf_specularMapSize; \nuniform float gltf_maxSpecularLOD; \n"+m:t._useDefaultSpecularMaps&&(m="#define SPECULAR_IBL \n"+m)}Object(s.default)(t._luminanceAtZenith)&&(m="#define USE_SUN_LUMINANCE \nuniform float gltf_luminanceAtZenith;\n"+m),Kp(i,r,m,p,t,a)}function Yp(e,t,a){var i=e.programId,r=e.techniqueId,n=t._sourcePrograms[i],o=t._rendererResources.sourceShaders,l=t._quantizedVertexShaders,u=t._toClipCoordinatesGLSL[i],d=t.clippingPlanes,f=jp(t),c=o[n.vertexShader],h=o[n.fragmentShader];(t.extensionsUsed.WEB3D_quantized_attributes||t._dequantizeInShader)&&(c=l[i]);var p=h;Ap(t)&&(p=wp._modifyShaderForColor(p)),f&&(p=function(e,t,a){return e=Uf.a.replaceMain(e,"gltf_clip_main"),e+=wp._getClippingFunction(t,a)+"\n",e+="uniform sampler2D gltf_clippingPlanes; \nuniform mat4 gltf_clippingPlanesMatrix; \nuniform vec4 gltf_clippingPlanesEdgeStyle; \nvoid main() \n{ \n    gltf_clip_main(); \n"+Kc("gltf_clippingPlanes","gltf_clippingPlanesMatrix","gltf_clippingPlanesEdgeStyle")+"} \n"}(p,d,a));var m=Gp(c,i,t._vertexShaderLoaded),v=Gp(p,i,t._fragmentShaderLoaded);xf.default.isInternetExplorer()||(m=ip.modifyVertexShaderForLogDepth(m,u),v=ip.modifyFragmentShaderForLogDepth(v),n.isOutline&&(v=v.replace("czm_writeLogDepth();","    czm_writeLogDepth();\n#if defined(LOG_DEPTH) && !defined(DISABLE_LOG_DEPTH_FRAGMENT_WRITE)\n    gl_FragDepthEXT -= 5e-5;\n#endif")));Object(s.default)(t._uniformMapLoaded)||(v="uniform vec4 czm_pickColor;\n"+v);var g=t._imageBasedLightingFactor.x>0||t._imageBasedLightingFactor.y>0;if(g&&(v="#define USE_IBL_LIGHTING \n\n"+v),Object(s.default)(t._lightColor)&&(v="#define USE_CUSTOM_LIGHT_COLOR \n\n"+v),("2.0"!==t._sourceVersion||t._sourceKHRTechniquesWebGL)&&(v=Uf.a.replaceMain(v,"non_gamma_corrected_main"),v+="\nvoid main() { \n    non_gamma_corrected_main(); \n    gl_FragColor = czm_gammaCorrect(gl_FragColor); \n} \n"),rp.a.isSupported(a)){var _=Object(s.default)(t._sphericalHarmonicCoefficients)||t._useDefaultSphericalHarmonics,y=Object(s.default)(t._specularEnvironmentMapAtlas)&&t._specularEnvironmentMapAtlas.ready||t._useDefaultSpecularMaps;!f&&(_||y||g)&&(v="uniform mat4 gltf_clippingPlanesMatrix; \n"+v),Object(s.default)(t._sphericalHarmonicCoefficients)?v="#define DIFFUSE_IBL \n#define CUSTOM_SPHERICAL_HARMONICS \nuniform vec3 gltf_sphericalHarmonicCoefficients[9]; \n"+v:t._useDefaultSphericalHarmonics&&(v="#define DIFFUSE_IBL \n"+v),Object(s.default)(t._specularEnvironmentMapAtlas)&&t._specularEnvironmentMapAtlas.ready?v="#define SPECULAR_IBL \n#define CUSTOM_SPECULAR_IBL \nuniform sampler2D gltf_specularMap; \nuniform vec2 gltf_specularMapSize; \nuniform float gltf_maxSpecularLOD; \n"+v:t._useDefaultSpecularMaps&&(v="#define SPECULAR_IBL \n"+v)}Object(s.default)(t._luminanceAtZenith)&&(v="#define USE_SUN_LUMINANCE \nuniform float gltf_luminanceAtZenith;\n"+v),Kp(i,r,v,m,t,a)}function Kp(e,t,a,i,r,n){var o=r._sourceTechniques[t],s=ip.createAttributeLocations(o,r._precreatedAttributes);r._rendererResources.programs[e]=Bf.a.fromCache({context:n,vertexShaderSource:i,fragmentShaderSource:a,attributeLocations:s})}qp.prototype.set=function(e,t,a){this.programToCreate=e,this.model=t,this.context=a},qp.prototype.execute=function(){Wp(this.programToCreate,this.model,this.context)};var Xp=new qp;function Zp(e,t){return function(a){e.texturesToCreate.enqueue({id:t.id,image:a,bufferView:void 0}),--e.pendingBufferViewToImage}}var Jp=function(){this.gltfTexture=void 0,this.model=void 0,this.context=void 0};function Qp(e,t,a){var i=t.gltf.textures[e.id],r=t._rendererResources.samplers[i.sampler];Object(s.default)(r)||(r=new Ff.a({wrapS:zf.a.REPEAT,wrapT:zf.a.REPEAT}));for(var n=!1,o=t.gltf.materials,l=o.length,u=0;u<l;++u){var d=o[u];if(Object(s.default)(d.extensions)&&Object(s.default)(d.extensions.KHR_techniques_webgl)){var f=d.extensions.KHR_techniques_webgl.values;for(var c in f)if(f.hasOwnProperty(c)&&-1!==c.indexOf("Texture")){var h=f[c];if(h.index===e.id&&Object(s.default)(h.extensions)&&Object(s.default)(h.extensions.KHR_texture_transform)){n=!0;break}}}if(n)break}var p=r.wrapS,m=r.wrapT,v=r.minificationFilter;n&&v!==kf.a.LINEAR&&v!==kf.a.NEAREST&&(v=v===kf.a.NEAREST_MIPMAP_NEAREST||v===kf.a.NEAREST_MIPMAP_LINEAR?kf.a.NEAREST:kf.a.LINEAR,r=new Ff.a({wrapS:r.wrapS,wrapT:r.wrapT,textureMinificationFilter:v,textureMagnificationFilter:r.magnificationFilter}));var g,_=e.internalFormat,y=!(Object(s.default)(_)&&If.a.isCompressedFormat(_)||v!==kf.a.NEAREST_MIPMAP_NEAREST&&v!==kf.a.NEAREST_MIPMAP_LINEAR&&v!==kf.a.LINEAR_MIPMAP_NEAREST&&v!==kf.a.LINEAR_MIPMAP_LINEAR),b=y||p===zf.a.REPEAT||p===zf.a.MIRRORED_REPEAT||m===zf.a.REPEAT||m===zf.a.MIRRORED_REPEAT,O=e.image;if(Object(s.default)(_))g=new Hf.a({context:a,source:{arrayBufferView:e.bufferView},width:e.width,height:e.height,pixelFormat:_,sampler:r});else if(Object(s.default)(O)){var w=!Fe.default.isPowerOfTwo(O.width)||!Fe.default.isPowerOfTwo(O.height);if(b&&w){var x=document.createElement("canvas");x.width=Fe.default.nextPowerOfTwo(O.width),x.height=Fe.default.nextPowerOfTwo(O.height),x.getContext("2d").drawImage(O,0,0,O.width,O.height,0,0,x.width,x.height),O=x}g=new Hf.a({context:a,source:O,pixelFormat:i.internalFormat,pixelDatatype:i.type,sampler:r,flipY:!1}),y&&g.generateMipmap()}Object(s.default)(g)&&(t._rendererResources.textures[e.id]=g,t._texturesByteLength+=g.sizeInBytes)}Jp.prototype.set=function(e,t,a){this.gltfTexture=e,this.model=t,this.context=a},Jp.prototype.execute=function(){Qp(this.gltfTexture,this.model,this.context)};var $p=new Jp;function em(e,t){for(var a=e.length,i={},r=0;r<a;++r)for(var n=[e[r]];n.length>0;){var o=n.pop(),l=t[o];Object(s.default)(l)&&(i[o]=o);var u=l.children;if(Object(s.default)(u))for(var d=u.length,f=0;f<d;++f)n.push(u[f])}return i}function tm(e){var t=e._loadResources;if(0===t.pendingBufferLoads&&t.createSkins){t.createSkins=!1;var a=e.gltf,i=a.accessors,r={};Kf.skin(a,(function(t,a){var n,o=i[t.inverseBindMatrices];lt.default.equals(t.bindShapeMatrix,lt.default.IDENTITY)||(n=lt.default.clone(t.bindShapeMatrix)),r[a]={inverseBindMatrices:hh.getSkinInverseBindMatrices(e,o),bindShapeMatrix:n}})),function(e,t){for(var a=e.gltf,i=a.skins,r=a.nodes,n=e._runtime.nodes,o=e._loadResources.skinnedNodesIds,l=o.length,u=0;u<l;++u){var d=o[u],f=n[d],c=r[d],h=t[c.skin];f.inverseBindMatrices=h.inverseBindMatrices,f.bindShapeMatrix=h.bindShapeMatrix;var p=[],m=i[c.skin];Object(s.default)(m.skeleton)&&p.push(m.skeleton);for(var v=em(p,r),g=i[c.skin].joints,_=g.length,y=0;y<_;++y){var b=n[v[g[y]]];f.joints.push(b)}}}(e,r)}}function am(e,t,a,i){return function(r){Object(s.default)(i)&&(r=e.clampAnimations?i.clampTime(r):i.wrapTime(r),t[a]=i.evaluate(r,t[a]),t.dirtyNumber=e._maxDirtyNumber)}}function im(e,t){var a=e._loadResources;if(a.finishedBuffersCreation()&&a.finishedProgramCreation()&&a.createVertexArrays){a.createVertexArrays=!1;var i=e._rendererResources.buffers,r=e._rendererResources.vertexArrays,n=e.gltf,o=n.accessors;Kf.mesh(n,(function(a,l){Kf.meshPrimitive(a,(function(a,u){var d,f,c,h=[],p=function(e,t){var a,i,r=e._sourceTechniques,n={},o=e._runtime.materialsById[t.material];if(!Object(s.default)(o))return n;var l=r[o._technique];if(!Object(s.default)(l))return n;var u=l.attributes,d=e._rendererResources.programs[l.program],f=d.vertexAttributes,c=d._attributeLocations;for(a in f)if(f.hasOwnProperty(a)){var h=u[a];Object(s.default)(h)&&(i=c[a],n[h.semantic]=i)}var p=e._precreatedAttributes;if(Object(s.default)(p))for(a in p)p.hasOwnProperty(a)&&(i=c[a],n[a]=i);return n}(e,a),m=e._decodedData[l+".primitive."+u];Kf.meshPrimitiveAttribute(a,(function(e,t){if(d=p[t],Object(s.default)(d)){if(Object(s.default)(m)){var a=m.attributes;if(a.hasOwnProperty(t)){var r=a[t];return void h.push({index:d,vertexBuffer:i[r.bufferView],componentsPerAttribute:r.componentsPerAttribute,componentDatatype:r.componentDatatype,normalize:r.normalized,offsetInBytes:r.byteOffset,strideInBytes:r.byteStride})}}var l=o[e],u=Object(s.default)(l.normalized)&&l.normalized;h.push({index:d,vertexBuffer:i[l.bufferView],componentsPerAttribute:Xf(l.type),componentDatatype:l.componentType,normalize:u,offsetInBytes:l.byteOffset,strideInBytes:Zf(n,l)})}}));var v,g=e._precreatedAttributes;if(Object(s.default)(g))for(c in g)g.hasOwnProperty(c)&&(d=p[c],Object(s.default)(d)&&((f=g[c]).index=d,h.push(f)));if(Object(s.default)(a.indices)){var _=o[a.indices].bufferView;Object(s.default)(m)&&(_=m.bufferView),v=i[_]}r[l+".primitive."+u]=new Gf.a({context:t,attributes:h,indexBuffer:v})}))}))}}function rm(e){var t=e._loadResources;t.createRenderStates&&(t.createRenderStates=!1,Kf.material(e.gltf,(function(t,a){!function(e,t,a){var i=e._rendererResources.renderStates,r=[Sf.a.FUNC_ADD,Sf.a.FUNC_ADD],n=[Sf.a.ONE,Sf.a.ONE_MINUS_SRC_ALPHA,Sf.a.ONE,Sf.a.ONE_MINUS_SRC_ALPHA];Object(s.default)(t.extensions)&&Object(s.default)(t.extensions.KHR_blend)&&(r=t.extensions.KHR_blend.blendEquation,n=t.extensions.KHR_blend.blendFactors);var o,l=Wf(e.gltf,"TERRIA_solid_outlines"),u=Object(s.default)(t.extensions)&&Object(s.default)(t.extensions.TERRIA_solid_outlines);l&&!u&&(o={enabled:!0,factor:.75,units:1});var d=!t.doubleSided,f="BLEND"===t.alphaMode;i[a]=Nf.a.fromCache({cull:{enabled:d},depthTest:{enabled:!0},depthMask:!f,blending:{enabled:f,equationRgb:r[0],equationAlpha:r[1],functionSourceRgb:n[0],functionDestinationRgb:n[1],functionSourceAlpha:n[2],functionDestinationAlpha:n[3]},polygonOffset:o})}(e,t,a)})))}var nm={MODEL:function(e,t,a){return function(){return a.computedMatrix}},VIEW:function(e,t,a){return function(){return e.view}},PROJECTION:function(e,t,a){return function(){return e.projection}},MODELVIEW:function(e,t,a){var i=new lt.default;return function(){return lt.default.multiplyTransformation(e.view,a.computedMatrix,i)}},CESIUM_RTC_MODELVIEW:function(e,t,a){var i=new lt.default;return function(){return lt.default.multiplyTransformation(e.view,a.computedMatrix,i),lt.default.setTranslation(i,t._rtcCenterEye,i)}},MODELVIEWPROJECTION:function(e,t,a){var i=new lt.default;return function(){return lt.default.multiplyTransformation(e.view,a.computedMatrix,i),lt.default.multiply(e._projection,i,i)}},MODELINVERSE:function(e,t,a){var i=new lt.default;return function(){return lt.default.inverse(a.computedMatrix,i)}},VIEWINVERSE:function(e,t){return function(){return e.inverseView}},PROJECTIONINVERSE:function(e,t,a){return function(){return e.inverseProjection}},MODELVIEWINVERSE:function(e,t,a){var i=new lt.default,r=new lt.default;return function(){return lt.default.multiplyTransformation(e.view,a.computedMatrix,i),lt.default.inverse(i,r)}},MODELVIEWPROJECTIONINVERSE:function(e,t,a){var i=new lt.default,r=new lt.default;return function(){return lt.default.multiplyTransformation(e.view,a.computedMatrix,i),lt.default.multiply(e._projection,i,i),lt.default.inverse(i,r)}},MODELINVERSETRANSPOSE:function(e,t,a){var i=new lt.default,r=new at.default;return function(){return lt.default.inverse(a.computedMatrix,i),lt.default.getMatrix3(i,r),at.default.transpose(r,r)}},MODELVIEWINVERSETRANSPOSE:function(e,t,a){var i=new lt.default,r=new lt.default,n=new at.default;return function(){return lt.default.multiplyTransformation(e.view,a.computedMatrix,i),lt.default.inverse(i,r),lt.default.getMatrix3(r,n),at.default.transpose(n,n)}},VIEWPORT:function(e,t,a){return function(){return e.viewportCartesian4}}};function om(e,t,a,i,r,n,l){var u,d,f={},c={};return Kf.techniqueUniform(a,(function(a,h){var p;if(Object(s.default)(i)&&Object(s.default)(i[h]))p=ip.createUniformFunction(a.type,i[h],n,l),f[h]=p.func,c[h]=p;else if(Object(s.default)(a.node))f[h]=function(e,t,a,i){var r=t._runtime.nodes[e];return nm[a](i,t,r)}(a.node,e,a.semantic,r.uniformState);else if(Object(s.default)(a.semantic))if("JOINTMATRIX"===a.semantic)u=h;else if("MORPHWEIGHTS"===a.semantic)d=h;else if("ALPHACUTOFF"===a.semantic){var m=t.alphaMode;if(Object(s.default)(m)&&"MASK"===m){var v=Object(o.default)(t.alphaCutoff,.5);p=ip.createUniformFunction(a.type,v,n,l),f[h]=p.func,c[h]=p}}else f[h]=ip.getGltfSemanticUniforms()[a.semantic](r.uniformState,e);else if(Object(s.default)(a.value)){var g=ip.createUniformFunction(a.type,a.value,n,l);f[h]=g.func,c[h]=g}})),{map:f,values:c,jointMatrixUniformName:u,morphWeightsUniformName:d}}function sm(e){return ip.createUniformsForDracoQuantizedAttributes(e.attributes)}function lm(e,t){var a=kp(e,t),i=e._quantizedUniforms[a];return ip.createUniformsForQuantizedAttributes(e.gltf,t,i)}function um(e){return function(){return e}}function dm(e){return function(){return e.computedJointMatrices}}function fm(e){return function(){return e.weights}}function cm(e){return function(){return e.silhouetteColor}}function hm(e){return function(){return e.silhouetteSize}}function pm(e){return function(){return e.color}}var mm=new lt.default;function vm(e){return function(){var t=e.clippingPlanes;if(!Object(s.default)(t)&&!Object(s.default)(e._sphericalHarmonicCoefficients)&&!Object(s.default)(e._specularEnvironmentMaps))return lt.default.IDENTITY;var a=Object(s.default)(t)?t.modelMatrix:lt.default.IDENTITY;return lt.default.multiply(e._clippingPlaneModelViewMatrix,a,mm)}}function gm(e){return function(){var t=e.clippingPlanes;return Object(s.default)(t)&&t.enabled?t.texture:e._defaultTexture}}function _m(e){return function(){var t=e.clippingPlanes;if(!Object(s.default)(t))return b.default.WHITE.withAlpha(0);var a=b.default.clone(t.edgeColor);return a.alpha=t.edgeWidth,a}}function ym(e){return function(){return yf.a.getColorBlend(e.colorBlendMode,e.colorBlendAmount)}}function bm(e){return function(){return e._imageBasedLightingFactor}}function Om(e){return function(){return e._lightColor}}function wm(e){return function(){return e.luminanceAtZenith}}function xm(e){return function(){return e._sphericalHarmonicCoefficients}}function Am(e){return function(){return e._specularEnvironmentMapAtlas.texture}}function jm(e){return function(){return e._specularEnvironmentMapAtlas.texture.dimensions}}function Em(e){return function(){return e._specularEnvironmentMapAtlas.maximumMipmapLevel}}function Cm(e,t){switch(e.mode){case Xa.a.TRIANGLES:return t/3;case Xa.a.TRIANGLE_STRIP:case Xa.a.TRIANGLE_FAN:return Math.max(t-2,0);default:return 0}}function Pm(e,t,a,i,n){for(var o=e._nodeCommands,l=e._pickIds,u=e.allowPicking,d=e._runtime.meshesByName,f=e._rendererResources,c=f.vertexArrays,h=f.programs,p=f.renderStates,m=e._uniformMaps,v=e.gltf,g=v.accessors,_=v.meshes,b=t.mesh,O=_[b],w=O.primitives,x=w.length,A=0;A<x;++A){var j,E=w[A],C=g[E.indices],P=e._runtime.materialsById[E.material]._program,T=e._decodedData[b+".primitive."+A],D=E.attributes.POSITION;if(Object(s.default)(D)){var I=ip.getAccessorMinMax(v,D);j=r.default.fromCornerPoints(y.default.fromArray(I.min),y.default.fromArray(I.max))}var S,M,R=c[b+".primitive."+A];if(Object(s.default)(T))M=T.numberOfIndices,S=0;else if(Object(s.default)(C))M=C.count,S=C.byteOffset/Ya.a.getSizeInBytes(C.componentType);else{M=g[E.attributes.POSITION].count,S=0}e._trianglesLength+=Cm(E,M);var L=m[E.material],V=L.uniformMap;if(Object(s.default)(L.jointMatrixUniformName)){var N={};N[L.jointMatrixUniformName]=dm(a),V=Object(Of.default)(V,N)}if(Object(s.default)(L.morphWeightsUniformName)){var F={};F[L.morphWeightsUniformName]=fm(a),V=Object(Of.default)(V,F)}V=Object(Of.default)(V,{gltf_color:pm(e),gltf_colorBlend:ym(e),gltf_clippingPlanes:gm(e),gltf_clippingPlanesEdgeStyle:_m(e),gltf_clippingPlanesMatrix:vm(e),gltf_iblFactor:bm(e),gltf_lightColor:Om(e),gltf_sphericalHarmonicCoefficients:xm(e),gltf_specularMap:Am(e),gltf_specularMapSize:jm(e),gltf_maxSpecularLOD:Em(e),gltf_luminanceAtZenith:wm(e)}),Object(s.default)(e._uniformMapLoaded)&&(V=e._uniformMapLoaded(V,P,a));var B={};e.extensionsUsed.WEB3D_quantized_attributes?B=lm(e,E):e._dequantizeInShader&&Object(s.default)(T)&&(B=sm(T)),V=Object(Of.default)(V,B);var U=p[E.material],H=U.blending.enabled,k=e._pickObject;Object(s.default)(k)||(k={primitive:e,id:e.id,node:a.publicNode,mesh:d[O.name]});var z,G=ne.a.castShadows(e._shadows),q=ne.a.receiveShadows(e._shadows);if(u&&!Object(s.default)(e._uniformMapLoaded)){z=i.createPickId(k),l.push(z);var W={czm_pickColor:um(z.color)};V=Object(Of.default)(V,W)}u&&(z=Object(s.default)(e._pickIdLoaded)&&Object(s.default)(e._uniformMapLoaded)?e._pickIdLoaded():"czm_pickColor");var Y,K=new Lf.a({boundingVolume:new r.default,cull:e.cull,modelMatrix:new lt.default,primitiveType:E.mode,vertexArray:R,count:M,offset:S,shaderProgram:h[P],castShadows:G,receiveShadows:q,uniformMap:V,renderState:U,owner:k,pass:H?Vf.a.TRANSLUCENT:e.opaquePass,pickId:z});n||((Y=Lf.a.shallowClone(K)).boundingVolume=new r.default,Y.modelMatrix=new lt.default);var X={show:!0,boundingSphere:j,command:K,command2D:Y,silhouetteModelCommand:void 0,silhouetteModelCommand2D:void 0,silhouetteColorCommand:void 0,silhouetteColorCommand2D:void 0,translucentCommand:void 0,translucentCommand2D:void 0,programId:P};a.commands.push(X),o.push(X)}}function Tm(e,t){var a=t.context,i=t.scene3DOnly,r=e._quantizedVertexShaders,n=e._toClipCoordinatesGLSL={},o=e._sourceTechniques,l=e._sourcePrograms,u=e._rendererResources,d=u.sourceShaders;for(var f in e._loadRendererResourcesFromCache&&(d=u.sourceShaders=e._cachedRendererResources.sourceShaders),o)if(o.hasOwnProperty(f)){var c=o[f].program,h=l[c],p=d[h.vertexShader];if(ip.checkSupportedGlExtensions(h.glExtensions,a),e.extensionsUsed.WEB3D_quantized_attributes||e._dequantizeInShader){var m=r[c];Object(s.default)(m)||(m=zp(p,c,e),r[c]=m),p=m}p=Gp(p,c,e._vertexShaderLoaded),n[c]=ip.toClipCoordinatesGLSL(e.gltf,p)}if(e._loadRendererResourcesFromCache){var v=e._cachedRendererResources;u.buffers=v.buffers,u.vertexArrays=v.vertexArrays,u.programs=v.programs,u.silhouettePrograms=v.silhouettePrograms,u.textures=v.textures,u.samplers=v.samplers,u.renderStates=v.renderStates,Object(s.default)(e._precreatedAttributes)&&im(e,a),e._cachedGeometryByteLength+=function(e){var t=0;for(var a in e)e.hasOwnProperty(a)&&(t+=e[a].sizeInBytes);return t}(v.buffers),e._cachedTexturesByteLength+=function(e){var t=0;for(var a in e)e.hasOwnProperty(a)&&(t+=e[a].sizeInBytes);return t}(v.textures)}else!function(e,t){var a=e._loadResources;if(0===a.pendingBufferLoads){var i,r=t.context,n=a.vertexBuffersToCreate,o=a.indexBuffersToCreate;if(e.asynchronous){for(;n.length>0&&(Up.set(n.peek(),e,r),t.jobScheduler.execute(Up,Zc.a.BUFFER));)n.dequeue();for(;o.length>0&&(i=o.peek(),Hp.set(i.id,i.componentType,e,r),t.jobScheduler.execute(Hp,Zc.a.BUFFER));)o.dequeue()}else{for(;n.length>0;)Np(n.dequeue(),e,r);for(;o.length>0;)Bp((i=o.dequeue()).id,i.componentType,e,r)}}}(e,t),function(e,t){var a=e._loadResources,i=a.programsToCreate;if(0===a.pendingShaderLoads&&0===a.pendingBufferLoads){var r=t.context;if(e.asynchronous)for(;i.length>0&&(Xp.set(i.peek(),e,r),t.jobScheduler.execute(Xp,Zc.a.PROGRAM));)i.dequeue();else for(;i.length>0;)Wp(i.dequeue(),e,r)}}(e,t),function(e){var t=e._loadResources;if(t.createSamplers){t.createSamplers=!1;var a=e._rendererResources.samplers;Kf.sampler(e.gltf,(function(e,t){a[t]=new Ff.a({wrapS:e.wrapS,wrapT:e.wrapT,minificationFilter:e.minFilter,magnificationFilter:e.magFilter})}))}}(e),function(e){var t=e._loadResources;if(0===t.pendingBufferLoads)for(;t.texturesToCreateFromBufferView.length>0;){var a=t.texturesToCreateFromBufferView.dequeue(),i=e.gltf,r=i.bufferViews[a.bufferView],n=(i.textures[a.id].source,ip.getFailedLoadFunction(e,"image","id: "+a.id+", bufferView: "+a.bufferView));if("image/ktx"===a.mimeType)Object(Df.a)(t.getBuffer(r)).then(Sp(e,a.id)).otherwise(n),++e._loadResources.pendingTextureLoads;else if("image/crn"===a.mimeType)Object(Cf.a)(t.getBuffer(r)).then(Sp(e,a.id)).otherwise(n),++e._loadResources.pendingTextureLoads;else{var o=Zp(t,a);Tf({uint8Array:t.getBuffer(r),format:a.mimeType,flipY:!1}).then(o).otherwise(n),++t.pendingBufferViewToImage}}}(e),function(e,t){var a=t.context,i=e._loadResources.texturesToCreate;if(e.asynchronous)for(;i.length>0&&($p.set(i.peek(),e,a),t.jobScheduler.execute($p,Zc.a.TEXTURE));)i.dequeue();else for(;i.length>0;)Qp(i.dequeue(),e,a)}(e,t);tm(e),function(e){var t=e._loadResources;if(t.finishedPendingBufferLoads()&&t.createRuntimeAnimations){t.createRuntimeAnimations=!1,e._runtime.animations=[];var a=e._runtime.nodes,i=e.gltf.accessors;Kf.animation(e.gltf,(function(t,r){for(var n=t.channels,o=t.samplers,s=Number.MAX_VALUE,l=-Number.MAX_VALUE,u=n.length,d=new Array(u),f=0;f<u;++f){var c=n[f],h=c.target,p=h.path,m=o[c.sampler],v=hh.getAnimationParameterValues(e,i[m.input]),g=hh.getAnimationParameterValues(e,i[m.output]);s=Math.min(s,v[0]),l=Math.max(l,v[v.length-1]);var _=hh.getAnimationSpline(e,r,t,c.sampler,m,v,p,g);d[f]=am(e,a[h.node],h.path,_)}e._runtime.animations[r]={name:t.name,startTime:s,stopTime:l,channelEvaluators:d}}))}}(e),e._loadRendererResourcesFromCache||(im(e,a),rm(e)),function(e,t){var a=e._loadResources;if(a.finishedProgramCreation()&&a.createUniformMaps){a.createUniformMaps=!1;var i=e.gltf,r=e._sourceTechniques,n=e._uniformMaps,o=e._rendererResources.textures,s=e._defaultTexture;Kf.material(i,(function(a,i){var l=e._runtime.materialsById[i],u=r[l._technique],d=l._values,f=om(e,a,u,d,t,o,s),c=n[i];c.uniformMap=f.map,c.values=f.values,c.jointMatrixUniformName=f.jointMatrixUniformName,c.morphWeightsUniformName=f.morphWeightsUniformName}))}}(e,a),function(e,t,a){var i=e._loadResources;if(i.finishedEverythingButTextureCreation()&&i.createRuntimeNodes){i.createRuntimeNodes=!1;for(var r=[],n=e._runtime.nodes,o=e.gltf,l=o.nodes,u=o.skins,d=o.scenes[o.scene].nodes,f=d.length,c=[],h={},p=0;p<f;++p){c.push({parentRuntimeNode:void 0,gltfNode:l[d[p]],id:d[p]});for(var m=[];c.length>0;){var v=c.pop();h[v.id]=!0;var g=v.parentRuntimeNode,_=v.gltfNode,b=n[v.id];if(0===b.parents.length)if(Object(s.default)(_.matrix))b.matrix=lt.default.fromColumnMajorArray(_.matrix);else{var O=_.rotation;b.translation=y.default.fromArray(_.translation),b.rotation=Vt.default.unpack(O),b.scale=y.default.fromArray(_.scale)}Object(s.default)(g)?(g.children.push(b),b.parents.push(g)):r.push(b),Object(s.default)(_.mesh)&&Pm(e,_,b,t,a);var w=_.children;if(Object(s.default)(w))for(var x=w.length,A=0;A<x;A++){var j=w[A];h[j]||c.push({parentRuntimeNode:b,gltfNode:l[j],id:w[A]})}var E=_.skin;if(Object(s.default)(E)&&m.push(u[E].skeleton),0===c.length)for(var C=0;C<m.length;C++){var P=m[C];h[P]||c.push({parentRuntimeNode:void 0,gltfNode:l[P],id:P})}}}e._runtime.rootNodes=r,e._runtime.nodes=n}}(e,a,i)}function Dm(e,t){var a=e.publicNode,i=a.matrix;a.useMatrix&&Object(s.default)(i)?lt.default.clone(i,t):Object(s.default)(e.matrix)?lt.default.clone(e.matrix,t):(lt.default.fromTranslationQuaternionRotationScale(e.translation,e.rotation,e.scale,t),a.setMatrix(t))}var Im=[],Sm=new Rt.a,Mm=new lt.default;var Rm=new lt.default;function Lm(e){var t,a,i=Lf.a.shallowClone(e);return i.pass=Vf.a.TRANSLUCENT,i.renderState=(t=e.renderState,(a=Object(bf.default)(t,!0)).cull.enabled=!1,a.depthTest.enabled=!0,a.depthMask=!1,a.blending=Bc.a.ALPHA_BLEND,Nf.a.fromCache(a)),i}function Vm(e,t,a){var i=t.scene3DOnly,r=e.color.alpha;if(r>0&&r<1){var n=e._nodeCommands,o=n.length;if(!Object(s.default)(n[0].translucentCommand)||a)for(var l=0;l<o;++l){var u=n[l],d=u.command;if(u.translucentCommand=Lm(d),!i){var f=u.command2D;u.translucentCommand2D=Lm(f)}}}}function Nm(e,t){var a=e._rendererResources.programs;for(var i in a)if(a.hasOwnProperty(i)&&a[i]===t)return i}function Fm(e,t,a){var i=t.vertexShaderSource.sources[0],r=t._attributeLocations,n=e._normalAttributeName;i=Uf.a.replaceMain(i,"gltf_silhouette_main"),i+="uniform float gltf_silhouetteSize; \nvoid main() \n{ \n    gltf_silhouette_main(); \n    vec3 n = normalize(czm_normal3D * "+n+"); \n    n.x *= czm_projection[0][0]; \n    n.y *= czm_projection[1][1]; \n    vec4 clip = gl_Position; \n    clip.xy += n.xy * clip.w * gltf_silhouetteSize * czm_pixelRatio / czm_viewport.z; \n    gl_Position = clip; \n}";return Bf.a.fromCache({context:a.context,vertexShaderSource:i,fragmentShaderSource:"uniform vec4 gltf_silhouetteColor; \nvoid main() \n{ \n    gl_FragColor = czm_gammaCorrect(gltf_silhouetteColor); \n}",attributeLocations:r})}function Bm(e,t){return xp(t.context)&&e.silhouetteSize>0&&e.silhouetteColor.alpha>0&&Object(s.default)(e._normalAttributeName)}function Um(e){return e.color.alpha>0&&e.color.alpha<1}function Hm(e){return 0===e.color.alpha}function km(e,t){return Math.floor(e)!==Math.floor(t)||Math.ceil(e)!==Math.ceil(t)}var zm=0;function Gm(e,t){for(var a=++zm%255,i=function(e){for(var t=e._nodeCommands,a=t.length,i=0;i<a;++i){if(t[i].command.pass===Vf.a.TRANSLUCENT)return!0}return!1}(e)||Um(e)||e.silhouetteColor.alpha<1,r=e._rendererResources.silhouettePrograms,n=t.scene3DOnly,o=e._nodeCommands,l=o.length,u=0;u<l;++u){var d=o[u],f=d.command,c=Um(e)?d.translucentCommand:f,h=Lf.a.shallowClone(c),p=Object(bf.default)(c.renderState);p.stencilTest={enabled:!0,frontFunction:Sf.a.ALWAYS,backFunction:Sf.a.ALWAYS,reference:a,mask:-1,frontOperation:{fail:Sf.a.KEEP,zFail:Sf.a.KEEP,zPass:Sf.a.REPLACE},backOperation:{fail:Sf.a.KEEP,zFail:Sf.a.KEEP,zPass:Sf.a.REPLACE}},Hm(e)&&(p.colorMask={red:!1,green:!1,blue:!1,alpha:!1},p.depthMask=!1),p=Nf.a.fromCache(p),h.renderState=p,d.silhouetteModelCommand=h;var m=Lf.a.shallowClone(f);(p=Object(bf.default)(f.renderState,!0)).depthTest.enabled=!0,p.cull.enabled=!1,i&&(m.pass=Vf.a.TRANSLUCENT,p.depthMask=!1,p.blending=Bc.a.ALPHA_BLEND),p.stencilTest={enabled:!0,frontFunction:Sf.a.NOTEQUAL,backFunction:Sf.a.NOTEQUAL,reference:a,mask:-1,frontOperation:{fail:Sf.a.KEEP,zFail:Sf.a.KEEP,zPass:Sf.a.KEEP},backOperation:{fail:Sf.a.KEEP,zFail:Sf.a.KEEP,zPass:Sf.a.KEEP}},p=Nf.a.fromCache(p);var v=f.shaderProgram,g=Nm(e,v),_=r[g];Object(s.default)(_)||(_=Fm(e,v,t),r[g]=_);var y=Object(Of.default)(f.uniformMap,{gltf_silhouetteColor:cm(e),gltf_silhouetteSize:hm(e)});if(m.renderState=p,m.shaderProgram=_,m.uniformMap=y,m.castShadows=!1,m.receiveShadows=!1,d.silhouetteColorCommand=m,!n){var b=d.command2D,O=Lf.a.shallowClone(h);O.boundingVolume=b.boundingVolume,O.modelMatrix=b.modelMatrix,d.silhouetteModelCommand2D=O;var w=Lf.a.shallowClone(m);O.boundingVolume=b.boundingVolume,O.modelMatrix=b.modelMatrix,d.silhouetteColorCommand2D=w}}}function qm(e,t,a){if(Bm(e,t)){var i=e._nodeCommands,r=km(e.color.alpha,e._colorPreviousAlpha)||km(e.silhouetteColor.alpha,e._silhouetteColorPreviousAlpha)||!Object(s.default)(i[0].silhouetteModelCommand);e._colorPreviousAlpha=e.color.alpha,e._silhouetteColorPreviousAlpha=e.silhouetteColor.alpha,(r||a)&&Gm(e,t)}}var Wm=new r.default;var Ym=new y.default,Km=new Ne.default;function Xm(e,t){var a=e.scale;if(0!==e.minimumPixelSize){var i=t.context,r=Math.max(i.drawingBufferWidth,i.drawingBufferHeight),n=Object(s.default)(e._clampedModelMatrix)?e._clampedModelMatrix:e.modelMatrix;if(Ym.x=n[12],Ym.y=n[13],Ym.z=n[14],Object(s.default)(e._rtcCenter)&&y.default.add(e._rtcCenter,Ym,Ym),e._mode!==Be.a.SCENE3D){var o=t.mapProjection,l=o.ellipsoid.cartesianToCartographic(Ym,Km);o.project(l,Ym),y.default.fromElements(Ym.z,Ym.x,Ym.y,Ym)}var u=e.boundingSphere.radius,d=function(e,t,a){return Wm.center=e,Wm.radius=t,a.camera.getPixelSize(Wm,a.context.drawingBufferWidth,a.context.drawingBufferHeight)}(Ym,u,t),f=1/d;Math.min(f*(2*u),r)<e.minimumPixelSize&&(a=e.minimumPixelSize*d/(2*e._initialRadius))}return Object(s.default)(e.maximumScale)?Math.min(e.maximumScale,a):a}function Zm(e){Object(s.default)(e._cacheKey)&&Object(s.default)(e._cachedGltf)&&0==--e._cachedGltf.count&&delete bp[e._cacheKey],e._cachedGltf=void 0}function Jm(e,t){this.buffers=void 0,this.vertexArrays=void 0,this.programs=void 0,this.sourceShaders=void 0,this.silhouettePrograms=void 0,this.textures=void 0,this.samplers=void 0,this.renderStates=void 0,this.ready=!1,this.context=e,this.cacheKey=t,this.count=0}function Qm(e){for(var t in e)e.hasOwnProperty(t)&&e[t].destroy()}function $m(e,t,a){return function(i){if(e.heightReference===A.default.RELATIVE_TO_GROUND){var r=t.cartesianToCartographic(i,Km);r.height+=a.height,t.cartographicToCartesian(r,i)}var n=e._clampedModelMatrix;lt.default.clone(e.modelMatrix,n),n[12]=i.x,n[13]=i.y,n[14]=i.z,e._heightChanged=!0}}Jm.prototype.release=function(){if(0==--this.count)return Object(s.default)(this.cacheKey)&&delete this.context.cache.modelRendererResourceCache[this.cacheKey],Qm((e=this).buffers),Qm(e.vertexArrays),Qm(e.programs),Qm(e.silhouettePrograms),Qm(e.textures),Object(u.default)(this);var e};var ev=new y.default,tv=new Ne.default;function av(e,t){e.programs!==t.programs&&Qm(e.programs),e.silhouettePrograms!==t.silhouettePrograms&&Qm(e.silhouettePrograms)}wp.prototype.update=function(e){if(e.mode!==Be.a.MORPHING)if(xf.default.supportsWebP.initialized){var t=xf.default.supportsWebP(),a=e.context;if(this._defaultTexture=a.defaultTexture,this._state===vp.NEEDS_LOAD&&Object(s.default)(this.gltf)){var i,n=this.cacheKey;if(Object(s.default)(n)){a.cache.modelRendererResourceCache=Object(o.default)(a.cache.modelRendererResourceCache,{});var l=a.cache.modelRendererResourceCache;if(i=l[this.cacheKey],Object(s.default)(i)){if(!i.ready)return;++i.count,this._loadRendererResourcesFromCache=!0}else(i=new Jm(a,n)).count=1,l[this.cacheKey]=i;this._cachedRendererResources=i}else(i=new Jm(a)).count=1,this._cachedRendererResources=i;if(this._state=vp.LOADING,this._state!==vp.FAILED){var u=this.gltf.extensions;if(Object(s.default)(u)&&Object(s.default)(u.CESIUM_RTC)){var d=y.default.fromArray(u.CESIUM_RTC.center);if(!y.default.equals(d,y.default.ZERO)){this._rtcCenter3D=d;var f=e.mapProjection,c=f.ellipsoid.cartesianToCartographic(this._rtcCenter3D),h=f.project(c);y.default.fromElements(h.z,h.x,h.y,h),this._rtcCenter2D=h,this._rtcCenterEye=new y.default,this._rtcCenter=this._rtcCenter3D}}ec(this.gltf),this._loadResources=new Ch,this._loadRendererResourcesFromCache||ip.parseBuffers(this,Ip)}}var p=this._loadResources,m=this._incrementallyLoadTextures,v=!1;if(this._state===vp.LOADING){if(0===p.pendingBufferLoads){if(!p.initialized){if(e.brdfLutGenerator.update(e),ip.checkSupportedExtensions(this.extensionsRequired,t),ip.updateForwardAxis(this),!Object(s.default)(this.gltf.extras.sourceVersion)){var g=this.gltf;g.extras.sourceVersion=ip.getAssetVersion(g),g.extras.sourceKHRTechniquesWebGL=Object(s.default)(ip.getUsedExtensions(g).KHR_techniques_webgl),this._sourceVersion=g.extras.sourceVersion,this._sourceKHRTechniquesWebGL=g.extras.sourceKHRTechniquesWebGL,Fc(g),Qf(g);var _={addBatchIdToGeneratedShaders:this._addBatchIdToGeneratedShaders};sp(g,_),pp(g,_)}this._sourceVersion=this.gltf.extras.sourceVersion,this._sourceKHRTechniquesWebGL=this.gltf.extras.sourceKHRTechniquesWebGL,this._dequantizeInShader=this._dequantizeInShader&&Yc.hasExtension(this),function(e){var t=e.gltf,a=e._loadResources;Kf.buffer(t,(function(e,t){a.buffers[t]=e.extras._pipeline.source}))}(this),function(e){var t={},a={},i={};e._runtime.articulationsByName=t,e._runtime.articulationsByStageKey=a,e._runtime.stagesByKey=i;var r=e.gltf;if(Wf(r,"AGI_articulations")&&Object(s.default)(r.extensions)&&Object(s.default)(r.extensions.AGI_articulations)){var n=r.extensions.AGI_articulations.articulations;if(Object(s.default)(n))for(var o=n.length,l=0;l<o;++l){var u=Object(bf.default)(n[l]);u.nodes=[],u.isDirty=!0,t[u.name]=u;for(var d=u.stages.length,f=0;f<d;++f){var c=u.stages[f];c.currentValue=c.initialValue;var h=u.name+" "+c.name;a[h]=u,i[h]=c}}}}(this),function(e){var t=e.gltf;if(Wf(t,"KHR_techniques_webgl")){var a=e._sourcePrograms,i=e._sourceTechniques,r=t.extensions.KHR_techniques_webgl.programs;Kf.technique(t,(function(e,t){i[t]=Object(bf.default)(e);var n=e.program;Object(s.default)(a[n])||(a[n]=Object(bf.default)(r[n]))}))}}(this),this._loadRendererResourcesFromCache||(function(e){var t=e.gltf.bufferViews,a=e._loadResources.vertexBuffersToCreate;Kf.bufferView(e.gltf,(function(e,t){e.target===Sf.a.ARRAY_BUFFER&&a.enqueue(t)}));var i=e._loadResources.indexBuffersToCreate,r={};Kf.accessor(e.gltf,(function(e){var a=e.bufferView;Object(s.default)(a)&&(t[a].target!==Sf.a.ELEMENT_ARRAY_BUFFER||Object(s.default)(r[a])||(r[a]=!0,i.enqueue({id:a,componentType:e.componentType})))}))}(this),function(e){var t=e.gltf,a=t.buffers,i=t.bufferViews,r=e._rendererResources.sourceShaders;Kf.shader(t,(function(t,n){if(Object(s.default)(t.bufferView)){var o=t.bufferView,l=i[o],u=l.buffer,d=a[u],f=Object(jf.a)(d.extras._pipeline.source,l.byteOffset,l.byteLength);r[n]=f}else if(Object(s.default)(t.extras._pipeline.source))r[n]=t.extras._pipeline.source;else{++e._loadResources.pendingShaderLoads;var c=e._resource.getDerivedResource({url:t.uri});c.fetchText().then(function(e,t,a){return function(i){var r=e._loadResources;r.shaders[a]={source:i,type:t,bufferView:void 0},--r.pendingShaderLoads,e._rendererResources.sourceShaders[a]=i}}(e,t.type,n)).otherwise(ip.getFailedLoadFunction(e,"shader",c.url))}}))}(this),function(e){var t=e._sourceTechniques;for(var a in t)if(t.hasOwnProperty(a)){var i=t[a];e._loadResources.programsToCreate.enqueue({programId:i.program,techniqueId:a})}}(this),function(e,t,a){var i,r=e.gltf,n=r.images;Kf.texture(r,(function(r,o){var l=r.source;Object(s.default)(r.extensions)&&Object(s.default)(r.extensions.EXT_texture_webp)&&a&&(l=r.extensions.EXT_texture_webp.source);var u=n[l],d=u.extras,f=u.bufferView,c=u.mimeType;if(i=u.uri,Object(s.default)(d)&&Object(s.default)(d.compressedImage3DTiles)){var h=d.compressedImage3DTiles.crunch,p=d.compressedImage3DTiles.s3tc,m=d.compressedImage3DTiles.pvrtc1,v=d.compressedImage3DTiles.etc1;t.s3tc&&Object(s.default)(h)?(c=h.mimeType,Object(s.default)(h.bufferView)?f=h.bufferView:i=h.uri):t.s3tc&&Object(s.default)(p)?(c=p.mimeType,Object(s.default)(p.bufferView)?f=p.bufferView:i=p.uri):t.pvrtc&&Object(s.default)(m)?(c=m.mimeType,Object(s.default)(m.bufferView)?f=m.bufferView:i=m.uri):t.etc1&&Object(s.default)(v)&&(c=v.mimeType,Object(s.default)(v.bufferView)?f=v.bufferView:i=v.uri)}if(Object(s.default)(f))e._loadResources.texturesToCreateFromBufferView.enqueue({id:o,image:void 0,bufferView:f,mimeType:c});else{++e._loadResources.pendingTextureLoads;var g=e._resource.getDerivedResource({url:i});(Mp.test(i)?Object(Df.a)(g):Rp.test(i)?Object(Cf.a)(g):g.fetchImage()).then(Sp(e,o)).otherwise(ip.getFailedLoadFunction(e,"image",g.url))}}))}(this,a,t)),function(e){var t=e.gltf,a=e._sourceTechniques,i={},r={},n=e._uniformMaps;Kf.material(t,(function(t,o){n[o]={uniformMap:void 0,values:void 0,jointMatrixUniformName:void 0,morphWeightsUniformName:void 0};var l=new Th(e,t,o);if(Object(s.default)(t.extensions)&&Object(s.default)(t.extensions.KHR_techniques_webgl)){var u=t.extensions.KHR_techniques_webgl.technique;l._technique=u,l._program=a[u].program,Kf.materialValue(t,(function(e,t){Object(s.default)(l._values)||(l._values={}),l._values[t]=Object(bf.default)(e)}))}i[t.name]=l,r[o]=l})),e._runtime.materialsByName=i,e._runtime.materialsById=r}(this),function(e){var t={},a=e._runtime.materialsById;Kf.mesh(e.gltf,(function(i,r){t[i.name]=new Ih(i,a,r),(Object(s.default)(e.extensionsUsed.WEB3D_quantized_attributes)||e._dequantizeInShader)&&Kf.meshPrimitive(i,(function(t,a){var i=kp(e,t),n=e._programPrimitives[i];Object(s.default)(n)||(n={},e._programPrimitives[i]=n),n[r+".primitive."+a]=t}))})),e._runtime.meshesByName=t}(this),function(e){var t={},a={},i=[],r=e._loadResources.skinnedNodesIds,n=e._runtime.articulationsByName;Kf.node(e.gltf,(function(o,l){var u={matrix:void 0,translation:void 0,rotation:void 0,scale:void 0,computedShow:!0,transformToRoot:new lt.default,computedMatrix:new lt.default,dirtyNumber:0,commands:[],inverseBindMatrices:void 0,bindShapeMatrix:void 0,joints:[],computedJointMatrices:[],jointName:o.jointName,weights:[],children:[],parents:[],publicNode:void 0};if(u.publicNode=new Mh(e,o,u,l,ip.getTransform(o)),t[l]=u,a[o.name]=u,Object(s.default)(o.skin)&&(r.push(l),i.push(u)),Object(s.default)(o.extensions)&&Object(s.default)(o.extensions.AGI_articulations)){var d=o.extensions.AGI_articulations.articulationName;if(Object(s.default)(d)){var f=lt.default.clone(u.publicNode.originalMatrix,Lp),c=n[d];c.nodes.push(u.publicNode);for(var h=c.stages.length,p=0;p<h;++p){f=Tp(c.stages[p],f)}u.publicNode.matrix=f}}})),e._runtime.nodes=t,e._runtime.nodesByName=a,e._runtime.skinnedNodes=i}(this),Yc.parse(this,a),p.initialized=!0}p.finishedDecoding()||Yc.decodeModel(this,a).otherwise(ip.getFailedLoadFunction(this,"model",this.basePath)),p.finishedDecoding()&&!p.resourcesParsed&&(this._boundingSphere=ip.computeBoundingSphere(this),this._initialRadius=this._boundingSphere.radius,Yc.cacheDataForModel(this),p.resourcesParsed=!0),p.resourcesParsed&&0===p.pendingShaderLoads&&Tm(this,e)}(p.finished()||m&&p.finishedEverythingButTextureCreation())&&(this._state=vp.LOADED,v=!0)}if(Object(s.default)(p)&&this._state===vp.LOADED&&(m&&!v&&Tm(this,e),p.finished())){this._loadResources=void 0;var b=this._rendererResources,O=this._cachedRendererResources;O.buffers=b.buffers,O.vertexArrays=b.vertexArrays,O.programs=b.programs,O.sourceShaders=b.sourceShaders,O.silhouettePrograms=b.silhouettePrograms,O.textures=b.textures,O.samplers=b.samplers,O.renderStates=b.renderStates,O.ready=!0,this._normalAttributeName=ip.getAttributeOrUniformBySemantic(this.gltf,"NORMAL"),Object(s.default)(this._precreatedAttributes)&&(O.vertexArrays={}),this.releaseGltfJson&&Zm(this)}var w=rp.a.isSupported(a);if(this._shouldUpdateSpecularMapAtlas&&w){if(this._shouldUpdateSpecularMapAtlas=!1,this._specularEnvironmentMapAtlas=this._specularEnvironmentMapAtlas&&this._specularEnvironmentMapAtlas.destroy(),this._specularEnvironmentMapAtlas=void 0,Object(s.default)(this._specularEnvironmentMaps)){this._specularEnvironmentMapAtlas=new rp.a(this._specularEnvironmentMaps);var x=this;this._specularEnvironmentMapAtlas.readyPromise.then((function(){x._shouldRegenerateShaders=!0})).otherwise((function(e){console.error("Error loading specularEnvironmentMaps: "+e)}))}this._shouldRegenerateShaders=!0}Object(s.default)(this._specularEnvironmentMapAtlas)&&this._specularEnvironmentMapAtlas.update(e);var j=!Object(s.default)(this._specularEnvironmentMapAtlas)&&Object(s.default)(e.specularEnvironmentMaps)&&!this._useDefaultSpecularMaps,E=!Object(s.default)(e.specularEnvironmentMaps)&&this._useDefaultSpecularMaps,C=!Object(s.default)(this._sphericalHarmonicCoefficients)&&Object(s.default)(e.sphericalHarmonicCoefficients)&&!this._useDefaultSphericalHarmonics,P=!Object(s.default)(e.sphericalHarmonicCoefficients)&&this._useDefaultSphericalHarmonics;this._shouldRegenerateShaders=this._shouldRegenerateShaders||j||E||C||P,this._useDefaultSpecularMaps=!Object(s.default)(this._specularEnvironmentMapAtlas)&&Object(s.default)(e.specularEnvironmentMaps),this._useDefaultSphericalHarmonics=!Object(s.default)(this._sphericalHarmonicCoefficients)&&Object(s.default)(e.sphericalHarmonicCoefficients);var T=Bm(this,e),D=Um(this),I=Hm(this),S=!Object(s.default)(this.distanceDisplayCondition)||function(e,t){var a,i=e.distanceDisplayCondition,r=i.near*i.near,n=i.far*i.far;if(t.mode===Be.a.SCENE2D){a=.5*(t.camera.frustum.right-t.camera.frustum.left),a*=a}else{var o=lt.default.getTranslation(e.modelMatrix,ev);if(t.mode===Be.a.COLUMBUS_VIEW){var s=t.mapProjection,l=s.ellipsoid.cartesianToCartographic(o,tv);o=s.project(l,o),y.default.fromElements(o.z,o.x,o.y,o)}a=y.default.distanceSquared(o,t.camera.positionWC)}return a>=r&&a<=n}(this,e),M=this.show&&S&&0!==this.scale&&(!I||T);if(M&&this._state===vp.LOADED||v){var R=this.activeAnimations.update(e)||this._cesiumAnimationsDirty;this._cesiumAnimationsDirty=!1,this._dirty=!1;var L=this.modelMatrix,V=e.mode!==this._mode;this._mode=e.mode;var N=!lt.default.equals(this._modelMatrix,L)||this._scale!==this.scale||this._minimumPixelSize!==this.minimumPixelSize||0!==this.minimumPixelSize||this._maximumScale!==this.maximumScale||this._heightReference!==this.heightReference||this._heightChanged||V;if(N||v){lt.default.clone(L,this._modelMatrix),function(e){Object(s.default)(e._removeUpdateHeightCallback)&&(e._removeUpdateHeightCallback(),e._removeUpdateHeightCallback=void 0);var t=e._scene;if(Object(s.default)(t)&&Object(s.default)(t.globe)&&e.heightReference!==A.default.NONE){var a=t.globe,i=a.ellipsoid,r=e.modelMatrix;Ym.x=r[12],Ym.y=r[13],Ym.z=r[14];var n=i.cartesianToCartographic(Ym);Object(s.default)(e._clampedModelMatrix)||(e._clampedModelMatrix=lt.default.clone(r,new lt.default));var o=a._surface;e._removeUpdateHeightCallback=o.updateHeight(n,$m(e,i,n));var l=a.getHeight(n);if(Object(s.default)(l)){var u=$m(e,i,n);Ne.default.clone(n,Km),Km.height=l,i.cartographicToCartesian(Km,Ym),u(Ym)}}else e._clampedModelMatrix=void 0}(this),Object(s.default)(this._clampedModelMatrix)&&(L=this._clampedModelMatrix),this._scale=this.scale,this._minimumPixelSize=this.minimumPixelSize,this._maximumScale=this.maximumScale,this._heightReference=this.heightReference,this._heightChanged=!1;var F=Xm(this,e),B=this._computedModelMatrix;lt.default.multiplyByUniformScale(L,F,B),this._upAxis===gf.Y?lt.default.multiplyTransformation(B,gf.Y_UP_TO_Z_UP,B):this._upAxis===gf.X&&lt.default.multiplyTransformation(B,gf.X_UP_TO_Z_UP,B),this.forwardAxis===gf.Z&&lt.default.multiplyTransformation(B,gf.Z_UP_TO_X_UP,B)}(R||N||v)&&(function(e,t,a,i){var n=e._maxDirtyNumber,o=e._runtime.rootNodes,l=o.length,u=Im,d=e._computedModelMatrix;if(e._mode!==Be.a.SCENE3D&&!e._ignoreCommands){var f=lt.default.getColumn(d,3,Sm);if(Rt.a.equals(f,Rt.a.UNIT_W)){var c=e.boundingSphere.center,h=Nt.default.wgs84To2DModelMatrix(i,c,Mm);d=lt.default.multiply(h,d,Mm),Object(s.default)(e._rtcCenter)&&(lt.default.setTranslation(d,Rt.a.UNIT_W,d),e._rtcCenter=e._rtcCenter2D)}else d=Nt.default.basisTo2D(i,d,Mm),e._rtcCenter=e._rtcCenter3D}for(var p=0;p<l;++p){var m=o[p];for(Dm(m,m.transformToRoot),u.push(m);u.length>0;){var v=(m=u.pop()).transformToRoot,g=m.commands;if(m.dirtyNumber===n||t||a){var _=lt.default.multiplyTransformation(d,v,m.computedMatrix),b=g.length;if(b>0)for(var O=0;O<b;++O){var w=g[O],x=w.command;lt.default.clone(_,x.modelMatrix),r.default.transform(w.boundingSphere,x.modelMatrix,x.boundingVolume),Object(s.default)(e._rtcCenter)&&y.default.add(e._rtcCenter,x.boundingVolume.center,x.boundingVolume.center),x=w.command2D,Object(s.default)(x)&&e._mode===Be.a.SCENE2D&&(lt.default.clone(_,x.modelMatrix),x.modelMatrix[13]-=2*Fe.default.sign(x.modelMatrix[13])*Fe.default.PI*i.ellipsoid.maximumRadius,r.default.transform(w.boundingSphere,x.modelMatrix,x.boundingVolume))}}var A=m.children;if(Object(s.default)(A))for(var j=A.length,E=0;E<j;++E){var C=A[E];C.dirtyNumber=Math.max(C.dirtyNumber,m.dirtyNumber),(C.dirtyNumber===n||a)&&(Dm(C,C.transformToRoot),lt.default.multiplyTransformation(v,C.transformToRoot,C.transformToRoot)),u.push(C)}}}++e._maxDirtyNumber}(this,N,v,e.mapProjection),this._dirty=!0,(R||v)&&function(e){for(var t=e._runtime.skinnedNodes,a=t.length,i=0;i<a;++i){var r=t[i];Rm=lt.default.inverseTransformation(r.transformToRoot,Rm);for(var n=r.computedJointMatrices,o=r.joints,l=r.bindShapeMatrix,u=r.inverseBindMatrices,d=u.length,f=0;f<d;++f)Object(s.default)(n[f])||(n[f]=new lt.default),n[f]=lt.default.multiplyTransformation(Rm,o[f].transformToRoot,n[f]),n[f]=lt.default.multiplyTransformation(n[f],u[f],n[f]),Object(s.default)(l)&&(n[f]=lt.default.multiplyTransformation(n[f],l,n[f]))}}(this)),this._perNodeShowDirty&&(this._perNodeShowDirty=!1,function(e){for(var t=e._runtime.rootNodes,a=t.length,i=Im,r=0;r<a;++r){var n=t[r];for(n.computedShow=n.publicNode.show,i.push(n);i.length>0;){for(var o=(n=i.pop()).computedShow,l=n.commands,u=l.length,d=0;d<u;++d)l[d].show=o;var f=n.children;if(Object(s.default)(f))for(var c=f.length,h=0;h<c;++h){var p=f[h];p.computedShow=o&&p.publicNode.show,i.push(p)}}}}(this)),function(e,t){var a=e.id;if(e._id!==a){e._id=a;for(var i=e._pickIds,r=i.length,n=0;n<r;++n)i[n].object.id=a}}(this),function(e){if(e._debugWireframe!==e.debugWireframe){e._debugWireframe=e.debugWireframe;for(var t=e.debugWireframe?Xa.a.LINES:Xa.a.TRIANGLES,a=e._nodeCommands,i=a.length,r=0;r<i;++r)a[r].command.primitiveType=t}}(this),function(e){if(e.debugShowBoundingVolume!==e._debugShowBoundingVolume){e._debugShowBoundingVolume=e.debugShowBoundingVolume;for(var t=e.debugShowBoundingVolume,a=e._nodeCommands,i=a.length,r=0;r<i;++r)a[r].command.debugShowBoundingVolume=t}}(this),function(e){if(e.shadows!==e._shadows){e._shadows=e.shadows;for(var t=ne.a.castShadows(e.shadows),a=ne.a.receiveShadows(e.shadows),i=e._nodeCommands,r=i.length,n=0;n<r;n++){var o=i[n];o.command.castShadows=t,o.command.receiveShadows=a}}}(this),function(e,t){var a=e._clippingPlanes;Object(s.default)(a)&&a.owner===e&&a.enabled&&a.update(t)}(this,e);var U=this._clippingPlanes,H=0,k=Object(s.default)(U)&&U.enabled&&U.length>0,z=Object(s.default)(this._sphericalHarmonicCoefficients)||this._useDefaultSphericalHarmonics,G=Object(s.default)(this._specularEnvironmentMapAtlas)&&this._specularEnvironmentMapAtlas.ready||this._useDefaultSpecularMaps;if(k||z||G){var q=Object(o.default)(this.clippingPlanesOriginMatrix,L);lt.default.multiply(a.uniformState.view3D,q,this._clippingPlaneModelViewMatrix)}k&&(H=U.clippingPlanesState);var W=this._shouldRegenerateShaders;W=W||this._clippingPlanesState!==H,this._clippingPlanesState=H;var Y=Ap(this);Y!==this._colorShadingEnabled&&(this._colorShadingEnabled=Y,W=!0),W?function(e,t){var a,i=e._rendererResources,r=e._cachedRendererResources;if(av(i,r),jp(e)||Ap(e)||e._shouldRegenerateShaders){e._shouldRegenerateShaders=!1,i.programs={},i.silhouettePrograms={};var n,o={},l=e._sourceTechniques;for(var u in l)l.hasOwnProperty(u)&&(n=l[u],a=n.program,o[a]||(o[a]=!0,Yp({programId:a,techniqueId:u},e,t.context)))}else i.programs=r.programs,i.silhouettePrograms=r.silhouettePrograms;for(var d=i.programs,f=e._nodeCommands,c=f.length,h=0;h<c;++h){var p=f[h];a=p.programId;var m=d[a];p.command.shaderProgram=m,Object(s.default)(p.command2D)&&(p.command2D.shaderProgram=m)}Vm(e,t,!0),qm(e,t,!0)}(this,e):(Vm(this,e,!1),qm(this,e,!1))}if(v){var K=this;e.afterRender.push((function(){K._ready=!0,K._readyPromise.resolve(K)}))}else{if(M&&!this._ignoreCommands){var X,Z,J,Q=e.commandList,$=e.passes,ee=this._nodeCommands,te=ee.length,ae=e.mapProjection.ellipsoid.maximumRadius*Fe.default.PI;if($.render||$.pick&&this.allowPicking){for(X=0;X<te;++X)if((Z=ee[X]).show){var ie=D?Z.translucentCommand:Z.command;if(ie=T?Z.silhouetteModelCommand:ie,Q.push(ie),J=Z.command.boundingVolume,e.mode===Be.a.SCENE2D&&(J.center.y+J.radius>ae||J.center.y-J.radius<ae)){var re=D?Z.translucentCommand2D:Z.command2D;re=T?Z.silhouetteModelCommand2D:re,Q.push(re)}}if(T&&!$.pick)for(X=0;X<te;++X)(Z=ee[X]).show&&(Q.push(Z.silhouetteColorCommand),J=Z.command.boundingVolume,e.mode===Be.a.SCENE2D&&(J.center.y+J.radius>ae||J.center.y-J.radius<ae)&&Q.push(Z.silhouetteColorCommand2D))}}var oe=this._credit;Object(s.default)(oe)&&e.creditDisplay.addCredit(oe);for(var se=this._resourceCredits,le=se.length,ue=0;ue<le;ue++)e.creditDisplay.addCredit(se[ue])}}else xf.default.supportsWebP.initialize()},wp.prototype.isDestroyed=function(){return!1},wp.prototype.destroy=function(){Object(s.default)(this._precreatedAttributes)&&Qm(this._rendererResources.vertexArrays),Object(s.default)(this._removeUpdateHeightCallback)&&(this._removeUpdateHeightCallback(),this._removeUpdateHeightCallback=void 0),Object(s.default)(this._terrainProviderChangedCallback)&&(this._terrainProviderChangedCallback(),this._terrainProviderChangedCallback=void 0),Object(s.default)(this._cachedRendererResources)&&av(this._rendererResources,this._cachedRendererResources),this._rendererResources=void 0,this._cachedRendererResources=this._cachedRendererResources&&this._cachedRendererResources.release(),Yc.destroyCachedDataForModel(this);for(var e=this._pickIds,t=e.length,a=0;a<t;++a)e[a].destroy();Zm(this),this._quantizedVertexShaders=void 0;var i=this._clippingPlanes;return Object(s.default)(i)&&!i.isDestroyed()&&i.owner===this&&i.destroy(),this._clippingPlanes=void 0,this._specularEnvironmentMapAtlas=this._specularEnvironmentMapAtlas&&this._specularEnvironmentMapAtlas.destroy(),Object(u.default)(this)},wp._getClippingFunction=Xc.a,wp._modifyShaderForColor=function(e){return e=Uf.a.replaceMain(e,"gltf_blend_main"),e+="uniform vec4 gltf_color; \nuniform float gltf_colorBlend; \nvoid main() \n{ \n    gltf_blend_main(); \n    gl_FragColor.rgb = mix(gl_FragColor.rgb, gltf_color.rgb, gltf_colorBlend); \n    float highlight = ceil(gltf_colorBlend); \n    gl_FragColor.rgb *= mix(gltf_color.rgb, vec3(1.0), highlight); \n    gl_FragColor.a *= gltf_color.a; \n} \n"};var iv=wp,rv=ne.a.ENABLED,nv=A.default.NONE,ov=b.default.RED,sv=b.default.WHITE,lv=yf.a.HIGHLIGHT,uv=new _.default(1,1),dv=gf.Y,fv=new lt.default,cv=new lt.default;function hv(e,t){t.collectionChanged.addEventListener(hv.prototype._onCollectionChanged,this),this._scene=e,this._primitives=e.primitives,this._entityCollection=t,this._modelHash={},this._entitiesToVisualize=new v.default,this._onCollectionChanged(t,t.values,[],[])}function pv(e,t,a,i){var r=a[t.id];Object(s.default)(r)&&(i.removeAndDestroy(r.modelPrimitive),delete a[t.id])}function mv(e,t){var a=t[e.id];Object(s.default)(a)&&(a.nodeTransformationsScratch={},a.articulationsScratch={})}function vv(e,t,a){e.readyPromise.otherwise((function(e){console.error(e),a[t.id].loadFail=!0}))}hv.prototype.update=function(e){for(var t=this._entitiesToVisualize.values,a=this._modelHash,i=this._primitives,r=0,n=t.length;r<n;r++){var o,l,u=t[r],d=u._model,f=a[u.id],c=u.isShowing&&u.isAvailable(e)&&P.default.getValueOrDefault(d._show,e,!0);if(c&&(l=u.computeModelMatrix(e,fv),o=_f.default.createIfNeeded(P.default.getValueOrUndefined(d._uri,e)),c=Object(s.default)(l)&&Object(s.default)(o)),c){var h=Object(s.default)(f)?f.modelPrimitive:void 0;if(Object(s.default)(h)&&o.url===f.url||(Object(s.default)(h)&&(i.removeAndDestroy(h),delete a[u.id]),(h=iv.fromGltf({url:o,incrementallyLoadTextures:P.default.getValueOrDefault(d._incrementallyLoadTextures,e,!0),scene:this._scene})).id=u,i.add(h),f={modelPrimitive:h,url:o.url,animationsRunning:!1,nodeTransformationsScratch:{},articulationsScratch:{},loadFail:!1},a[u.id]=f,vv(h,u,a)),h.show=!0,h.scale=P.default.getValueOrDefault(d._scale,e,1),h.minimumPixelSize=P.default.getValueOrDefault(d._minimumPixelSize,e,0),h.maximumScale=P.default.getValueOrUndefined(d._maximumScale,e),h.modelMatrix=lt.default.clone(l,h.modelMatrix),h.shadows=P.default.getValueOrDefault(d._shadows,e,rv),h.heightReference=P.default.getValueOrDefault(d._heightReference,e,nv),h.distanceDisplayCondition=P.default.getValueOrUndefined(d._distanceDisplayCondition,e),h.silhouetteColor=P.default.getValueOrDefault(d._silhouetteColor,e,ov,h._silhouetteColor),h.silhouetteSize=P.default.getValueOrDefault(d._silhouetteSize,e,0),h.color=P.default.getValueOrDefault(d._color,e,sv,h._color),h.colorBlendMode=P.default.getValueOrDefault(d._colorBlendMode,e,lv),h.colorBlendAmount=P.default.getValueOrDefault(d._colorBlendAmount,e,.5),h.clippingPlanes=P.default.getValueOrUndefined(d._clippingPlanes,e),h.clampAnimations=P.default.getValueOrDefault(d._clampAnimations,e,!0),h.imageBasedLightingFactor=P.default.getValueOrDefault(d._imageBasedLightingFactor,e,uv),h.lightColor=P.default.getValueOrUndefined(d._lightColor,e),h._upAxis=P.default.getValueOrDefault(d._upAxis,e,dv),h._forwardAxis=P.default.getValueOrUndefined(d._forwardAxis,e),h.ready){var p=P.default.getValueOrDefault(d._runAnimations,e,!0);f.animationsRunning!==p&&(p?h.activeAnimations.addAll({loop:mh.REPEAT}):h.activeAnimations.removeAll(),f.animationsRunning=p);var m=P.default.getValueOrUndefined(d._nodeTransformations,e,f.nodeTransformationsScratch);if(Object(s.default)(m))for(var v=Object.keys(m),g=0,_=v.length;g<_;++g){var y=v[g],b=m[y];if(Object(s.default)(b)){var O=h.getNode(y);if(Object(s.default)(O)){var w=lt.default.fromTranslationRotationScale(b,cv);O.matrix=lt.default.multiply(O.originalMatrix,w,w)}}}var x=!1,A=P.default.getValueOrUndefined(d._articulations,e,f.articulationsScratch);if(Object(s.default)(A))for(var j=Object.keys(A),E=0,C=j.length;E<C;++E){var T=j[E],D=A[T];Object(s.default)(D)&&(x=!0,h.setArticulationStage(T,D))}x&&h.applyArticulations()}}else Object(s.default)(f)&&(f.modelPrimitive.show=!1)}return!0},hv.prototype.isDestroyed=function(){return!1},hv.prototype.destroy=function(){this._entityCollection.collectionChanged.removeEventListener(hv.prototype._onCollectionChanged,this);for(var e=this._entitiesToVisualize.values,t=this._modelHash,a=this._primitives,i=e.length-1;i>-1;i--)pv(this,e[i],t,a);return Object(u.default)(this)},hv.prototype.getBoundingSphere=function(e,t){var a=this._modelHash[e.id];if(!Object(s.default)(a)||a.loadFail)return C.default.FAILED;var i=a.modelPrimitive;if(!Object(s.default)(i)||!i.show)return C.default.FAILED;if(!i.ready)return C.default.PENDING;if(i.heightReference===A.default.NONE)r.default.transform(i.boundingSphere,i.modelMatrix,t);else{if(!Object(s.default)(i._clampedModelMatrix)||i._heightChanged)return C.default.PENDING;r.default.transform(i.boundingSphere,i._clampedModelMatrix,t)}return C.default.DONE},hv.prototype._onCollectionChanged=function(e,t,a,i){var r,n,o=this._entitiesToVisualize,l=this._modelHash,u=this._primitives;for(r=t.length-1;r>-1;r--)n=t[r],Object(s.default)(n._model)&&Object(s.default)(n._position)&&o.set(n.id,n);for(r=i.length-1;r>-1;r--)n=i[r],Object(s.default)(n._model)&&Object(s.default)(n._position)?(mv(n,l),o.set(n.id,n)):(pv(this,n,l,u),o.remove(n.id));for(r=a.length-1;r>-1;r--)pv(this,n=a[r],l,u),o.remove(n.id)};var gv=hv,_v=a(169),yv=a(76),bv=a(88),Ov=a(63),wv=a(50),xv=a(386),Av=a(538),jv=a(539);function Ev(e,t){e=Object(o.default)(e,o.default.EMPTY_OBJECT),this._show=Object(o.default)(e.show,!0),this._width=Object(o.default)(e.width,1),this._loop=Object(o.default)(e.loop,!1),this._distanceDisplayCondition=e.distanceDisplayCondition,this._material=e.material,Object(s.default)(this._material)||(this._material=te.a.fromType(te.a.ColorType,{color:new b.default(1,1,1,1)}));var a,i=e.positions;Object(s.default)(i)||(i=[]),this._positions=i,this._actualPositions=Object(et.a)(i,y.default.equalsEpsilon),this._loop&&this._actualPositions.length>2&&(this._actualPositions===this._positions&&(this._actualPositions=i.slice()),this._actualPositions.push(y.default.clone(this._actualPositions[0]))),this._length=this._actualPositions.length,this._id=e.id,Object(s.default)(t)&&(a=lt.default.clone(t.modelMatrix)),this._modelMatrix=a,this._segments=Mt.wrapLongitude(this._actualPositions,a),this._actualLength=void 0,this._propertiesChanged=new Uint32Array(Mv),this._polylineCollection=t,this._dirty=!1,this._pickId=void 0,this._boundingVolume=r.default.fromPoints(this._actualPositions),this._boundingVolumeWC=r.default.transform(this._boundingVolume,this._modelMatrix),this._boundingVolume2D=new r.default}var Cv=Ev.POSITION_INDEX=0,Pv=Ev.SHOW_INDEX=1,Tv=Ev.WIDTH_INDEX=2,Dv=Ev.MATERIAL_INDEX=3,Iv=Ev.POSITION_SIZE_INDEX=4,Sv=Ev.DISTANCE_DISPLAY_CONDITION=5,Mv=Ev.NUMBER_OF_PROPERTIES=6;function Rv(e,t){++e._propertiesChanged[t];var a=e._polylineCollection;Object(s.default)(a)&&(a._updatePolyline(e,t),e._dirty=!0)}Object(l.default)(Ev.prototype,{show:{get:function(){return this._show},set:function(e){e!==this._show&&(this._show=e,Rv(this,Pv))}},positions:{get:function(){return this._positions},set:function(e){var t=Object(et.a)(e,y.default.equalsEpsilon);this._loop&&t.length>2&&(t===e&&(t=e.slice()),t.push(y.default.clone(t[0]))),this._actualPositions.length===t.length&&this._actualPositions.length===this._length||Rv(this,Iv),this._positions=e,this._actualPositions=t,this._length=t.length,this._boundingVolume=r.default.fromPoints(this._actualPositions,this._boundingVolume),this._boundingVolumeWC=r.default.transform(this._boundingVolume,this._modelMatrix,this._boundingVolumeWC),Rv(this,Cv),this.update()}},material:{get:function(){return this._material},set:function(e){this._material!==e&&(this._material=e,Rv(this,Dv))}},width:{get:function(){return this._width},set:function(e){e!==this._width&&(this._width=e,Rv(this,Tv))}},loop:{get:function(){return this._loop},set:function(e){if(e!==this._loop){var t=this._actualPositions;e?t.length>2&&!y.default.equals(t[0],t[t.length-1])&&(t.length===this._positions.length&&(this._actualPositions=t=this._positions.slice()),t.push(y.default.clone(t[0]))):t.length>2&&y.default.equals(t[0],t[t.length-1])&&(t.length-1===this._positions.length?this._actualPositions=this._positions:t.pop()),this._loop=e,Rv(this,Iv)}}},id:{get:function(){return this._id},set:function(e){this._id=e,Object(s.default)(this._pickId)&&(this._pickId.object.id=e)}},pickId:{get:function(){return this._pickId}},isDestroyed:{get:function(){return!Object(s.default)(this._polylineCollection)}},distanceDisplayCondition:{get:function(){return this._distanceDisplayCondition},set:function(e){w.a.equals(e,this._distanceDisplayCondition)||(this._distanceDisplayCondition=w.a.clone(e,this._distanceDisplayCondition),Rv(this,Sv))}}}),Ev.prototype.update=function(){var e=lt.default.IDENTITY;Object(s.default)(this._polylineCollection)&&(e=this._polylineCollection.modelMatrix);var t=this._segments.positions.length,a=this._segments.lengths,i=this._propertiesChanged[Cv]>0||this._propertiesChanged[Iv]>0;if(lt.default.equals(e,this._modelMatrix)&&!i||(this._segments=Mt.wrapLongitude(this._actualPositions,e),this._boundingVolumeWC=r.default.transform(this._boundingVolume,e,this._boundingVolumeWC)),this._modelMatrix=lt.default.clone(e,this._modelMatrix),this._segments.positions.length!==t)Rv(this,Iv);else for(var n=a.length,o=0;o<n;++o)if(a[o]!==this._segments.lengths[o]){Rv(this,Iv);break}},Ev.prototype.getPickId=function(e){return Object(s.default)(this._pickId)||(this._pickId=e.createPickId({primitive:this,collection:this._polylineCollection,id:this._id})),this._pickId},Ev.prototype._clean=function(){this._dirty=!1;for(var e=this._propertiesChanged,t=0;t<Mv-1;++t)e[t]=0},Ev.prototype._destroy=function(){this._pickId=this._pickId&&this._pickId.destroy(),this._material=this._material&&this._material.destroy(),this._polylineCollection=void 0};var Lv=Ev,Vv=Lv.SHOW_INDEX,Nv=Lv.WIDTH_INDEX,Fv=Lv.POSITION_INDEX,Bv=Lv.MATERIAL_INDEX,Uv=Lv.POSITION_SIZE_INDEX,Hv=Lv.DISTANCE_DISPLAY_CONDITION,kv=Lv.NUMBER_OF_PROPERTIES,zv={texCoordExpandAndBatchIndex:0,position3DHigh:1,position3DLow:2,position2DHigh:3,position2DLow:4,prevPosition3DHigh:5,prevPosition3DLow:6,prevPosition2DHigh:7,prevPosition2DLow:8,nextPosition3DHigh:9,nextPosition3DLow:10,nextPosition2DHigh:11,nextPosition2DLow:12};function Gv(e){e=Object(o.default)(e,o.default.EMPTY_OBJECT),this.modelMatrix=lt.default.clone(Object(o.default)(e.modelMatrix,lt.default.IDENTITY)),this._modelMatrix=lt.default.clone(lt.default.IDENTITY),this.debugShowBoundingVolume=Object(o.default)(e.debugShowBoundingVolume,!1),this._opaqueRS=void 0,this._translucentRS=void 0,this._colorCommands=[],this._polylinesUpdated=!1,this._polylinesRemoved=!1,this._createVertexArray=!1,this._propertiesChanged=new Uint32Array(kv),this._polylines=[],this._polylineBuckets={},this._positionBufferUsage={bufferUsage:Rf.a.STATIC_DRAW,frameCount:0},this._mode=void 0,this._polylinesToUpdate=[],this._vertexArrays=[],this._positionBuffer=void 0,this._texCoordExpandAndBatchIndexBuffer=void 0,this._batchTable=void 0,this._createBatchTable=!1,this._useHighlightColor=!1,this._highlightColor=b.default.clone(b.default.WHITE);var t=this;this._uniformMap={u_highlightColor:function(){return t._highlightColor}}}Object(l.default)(Gv.prototype,{length:{get:function(){return tg(this),this._polylines.length}}}),Gv.prototype.add=function(e){var t=new Lv(e,this);return t._index=this._polylines.length,this._polylines.push(t),this._createVertexArray=!0,this._createBatchTable=!0,t},Gv.prototype.remove=function(e){if(this.contains(e)){if(this._polylinesRemoved=!0,this._createVertexArray=!0,this._createBatchTable=!0,Object(s.default)(e._bucket)){var t=e._bucket;t.shaderProgram=t.shaderProgram&&t.shaderProgram.destroy()}return e._destroy(),!0}return!1},Gv.prototype.removeAll=function(){ag(this),rg(this),this._polylineBuckets={},this._polylinesRemoved=!1,this._polylines.length=0,this._polylinesToUpdate.length=0,this._createVertexArray=!0},Gv.prototype.contains=function(e){return Object(s.default)(e)&&e._polylineCollection===this},Gv.prototype.get=function(e){return tg(this),this._polylines[e]};var qv=new bv.a,Wv=new Rt.a,Yv=new _.default;Gv.prototype.update=function(e){if(tg(this),0!==this._polylines.length){!function(e,t){var a=t.mode;e._mode===a&&lt.default.equals(e._modelMatrix,e.modelMatrix)||(e._mode=a,e._modelMatrix=lt.default.clone(e.modelMatrix),e._createVertexArray=!0)}(this,e);var t,a=e.context,i=e.mapProjection,n=this._propertiesChanged;if(this._createBatchTable){if(0===wv.a.maximumVertexTextureImageUnits)throw new ic.default("Vertex texture fetch support is required to render polylines. The maximum number of vertex texture image units must be greater than zero.");!function(e,t){Object(s.default)(e._batchTable)&&e._batchTable.destroy();var a=[{functionName:"batchTable_getWidthAndShow",componentDatatype:ue.a.UNSIGNED_BYTE,componentsPerAttribute:2},{functionName:"batchTable_getPickColor",componentDatatype:ue.a.UNSIGNED_BYTE,componentsPerAttribute:4,normalize:!0},{functionName:"batchTable_getCenterHigh",componentDatatype:ue.a.FLOAT,componentsPerAttribute:3},{functionName:"batchTable_getCenterLowAndRadius",componentDatatype:ue.a.FLOAT,componentsPerAttribute:4},{functionName:"batchTable_getDistanceDisplayCondition",componentDatatype:ue.a.FLOAT,componentsPerAttribute:2}];e._batchTable=new jv.a(t,a,e._polylines.length)}(this,a),this._createBatchTable=!1}if(this._createVertexArray||function(e){var t=!1,a=e._propertiesChanged,i=e._positionBufferUsage;a[Fv]?i.bufferUsage!==Rf.a.STREAM_DRAW?(t=!0,i.bufferUsage=Rf.a.STREAM_DRAW,i.frameCount=100):i.frameCount=100:i.bufferUsage!==Rf.a.STATIC_DRAW&&(0===i.frameCount?(t=!0,i.bufferUsage=Rf.a.STATIC_DRAW):i.frameCount--);return t}(this))Jv(this,a,i);else if(this._polylinesUpdated){var o=this._polylinesToUpdate;if(this._mode!==Be.a.SCENE3D)for(var l=o.length,u=0;u<l;++u)(t=o[u]).update();if(n[Uv]||n[Bv])Jv(this,a,i);else for(var d=o.length,f=this._polylineBuckets,c=0;c<d;++c){n=(t=o[c])._propertiesChanged;var h=t._bucket,p=0;for(var m in f)if(f.hasOwnProperty(m)){if(f[m]===h){n[Fv]&&h.writeUpdate(p,t,this._positionBuffer,i);break}p+=f[m].lengthOfPositions}if((n[Vv]||n[Nv])&&this._batchTable.setBatchedAttribute(t._index,0,new _.default(t._width,t._show)),this._batchTable.attributes.length>2){if(n[Fv]||n[Uv]){var v=e.mode===Be.a.SCENE2D?t._boundingVolume2D:t._boundingVolumeWC,g=bv.a.fromCartesian(v.center,qv),y=Rt.a.fromElements(g.low.x,g.low.y,g.low.z,v.radius,Wv);this._batchTable.setBatchedAttribute(t._index,2,g.high),this._batchTable.setBatchedAttribute(t._index,3,y)}if(n[Hv]){var b=Yv;b.x=0,b.y=Number.MAX_VALUE;var O=t.distanceDisplayCondition;Object(s.default)(O)&&(b.x=O.near,b.y=O.far),this._batchTable.setBatchedAttribute(t._index,4,b)}}t._clean()}o.length=0,this._polylinesUpdated=!1}n=this._propertiesChanged;for(var w=0;w<kv;++w)n[w]=0;var x=lt.default.IDENTITY;e.mode===Be.a.SCENE3D&&(x=this.modelMatrix);var A=e.passes,j=0!==e.morphTime;if(Object(s.default)(this._opaqueRS)&&this._opaqueRS.depthTest.enabled===j||(this._opaqueRS=Nf.a.fromCache({depthMask:j,depthTest:{enabled:j}})),Object(s.default)(this._translucentRS)&&this._translucentRS.depthTest.enabled===j||(this._translucentRS=Nf.a.fromCache({blending:Bc.a.ALPHA_BLEND,depthMask:!j,depthTest:{enabled:j}})),this._batchTable.update(e),A.render||A.pick)!function(e,t,a,i){for(var n=t.context,o=t.commandList,l=a.length,u=0,d=!0,f=e._vertexArrays,c=e.debugShowBoundingVolume,h=e._batchTable.getUniformMapCallback(),p=f.length,m=0;m<p;++m)for(var v=f[m],g=v.buckets,_=g.length,y=0;y<_;++y){for(var b,O,w,x,A=g[y],j=A.offset,E=A.bucket.shaderProgram,C=A.bucket.polylines,P=C.length,T=0,D=0;D<P;++D){var I=C[D],S=eg(I._material);if(S!==b){if(Object(s.default)(b)&&T>0){var M=O.isTranslucent();u>=l?(w=new Lf.a({owner:e}),a.push(w)):w=a[u],++u,x=Object(Of.default)(h(O._uniforms),e._uniformMap),w.boundingVolume=r.default.clone(Kv,w.boundingVolume),w.modelMatrix=i,w.shaderProgram=E,w.vertexArray=v.va,w.renderState=M?e._translucentRS:e._opaqueRS,w.pass=M?Vf.a.TRANSLUCENT:Vf.a.OPAQUE,w.debugShowBoundingVolume=c,w.pickId="v_pickColor",w.uniformMap=x,w.count=T,w.offset=j,j+=T,T=0,d=!0,o.push(w)}(O=I._material).update(n),b=S}for(var R,L=I._locatorBuckets,V=L.length,N=0;N<V;++N){var F=L[N];F.locator===A&&(T+=F.count)}t.mode===Be.a.SCENE3D?R=I._boundingVolumeWC:t.mode===Be.a.COLUMBUS_VIEW?R=I._boundingVolume2D:t.mode===Be.a.SCENE2D?Object(s.default)(I._boundingVolume2D)&&((R=r.default.clone(I._boundingVolume2D,Xv)).center.x=0):Object(s.default)(I._boundingVolumeWC)&&Object(s.default)(I._boundingVolume2D)&&(R=r.default.union(I._boundingVolumeWC,I._boundingVolume2D,Xv)),d?(d=!1,r.default.clone(R,Kv)):r.default.union(R,Kv,Kv)}Object(s.default)(b)&&T>0&&(u>=l?(w=new Lf.a({owner:e}),a.push(w)):w=a[u],++u,x=Object(Of.default)(h(O._uniforms),e._uniformMap),w.boundingVolume=r.default.clone(Kv,w.boundingVolume),w.modelMatrix=i,w.shaderProgram=E,w.vertexArray=v.va,w.renderState=O.isTranslucent()?e._translucentRS:e._opaqueRS,w.pass=O.isTranslucent()?Vf.a.TRANSLUCENT:Vf.a.OPAQUE,w.debugShowBoundingVolume=c,w.pickId="v_pickColor",w.uniformMap=x,w.count=T,w.offset=j,d=!0,o.push(w)),b=void 0}a.length=u}(this,e,this._colorCommands,x)}};var Kv=new r.default,Xv=new r.default;Gv.prototype.isDestroyed=function(){return!1},Gv.prototype.destroy=function(){return ig(this),ag(this),rg(this),this._batchTable=this._batchTable&&this._batchTable.destroy(),Object(u.default)(this)};var Zv=[0,0,0];function Jv(e,t,a){e._createVertexArray=!1,ag(e),ig(e),function(e){for(var t=e._mode,a=e._modelMatrix,i=e._polylineBuckets={},r=e._polylines,n=r.length,o=0;o<n;++o){var l=r[o];if(l._actualPositions.length>1){l.update();var u=l.material,d=i[u.type];Object(s.default)(d)||(d=i[u.type]=new og(u,t,a)),d.addPolyline(l)}}}(e);var i,r,n=[[]],o=n[0],l=e._batchTable,u=e._useHighlightColor,d=[0],f=0,c=[[]],h=0,p=e._polylineBuckets;for(i in p)p.hasOwnProperty(i)&&((r=p[i]).updateShader(t,l,u),h+=r.lengthOfPositions);if(h>0){var m,v=e._mode,g=new Float32Array(6*h*3),_=new Float32Array(4*h),y=0,b=0,O=0;for(i in p)if(p.hasOwnProperty(i)){(r=p[i]).write(g,_,y,b,O,l,t,a),v===Be.a.MORPHING&&(Object(s.default)(m)||(m=new Float32Array(6*h*3)),r.writeForMorph(m,y));var w=r.lengthOfPositions;y+=6*w*3,b+=4*w,O+=4*w,f=r.updateIndices(n,d,c,f)}var x,A=e._positionBufferUsage.bufferUsage,j=Rf.a.STATIC_DRAW;e._positionBuffer=Mf.a.createVertexBuffer({context:t,typedArray:g,usage:A}),Object(s.default)(m)&&(x=Mf.a.createVertexBuffer({context:t,typedArray:m,usage:A})),e._texCoordExpandAndBatchIndexBuffer=Mf.a.createVertexBuffer({context:t,typedArray:_,usage:j});for(var E=3*Float32Array.BYTES_PER_ELEMENT,C=4*Float32Array.BYTES_PER_ELEMENT,P=0,T=n.length,D=0;D<T;++D)if((o=n[D]).length>0){var I=new Uint16Array(o),S=Mf.a.createIndexBuffer({context:t,typedArray:I,usage:Rf.a.STATIC_DRAW,indexDatatype:Ya.a.UNSIGNED_SHORT});P+=d[D];var M,R,L,V,N=6*(D*(E*Fe.default.SIXTY_FOUR_KILOBYTES)-P*E),F=E+N,B=E+F,U=E+B,H=E+U,k=E+H,z=D*(C*Fe.default.SIXTY_FOUR_KILOBYTES)-P*C,G=[{index:zv.position3DHigh,componentsPerAttribute:3,componentDatatype:ue.a.FLOAT,offsetInBytes:N,strideInBytes:6*E},{index:zv.position3DLow,componentsPerAttribute:3,componentDatatype:ue.a.FLOAT,offsetInBytes:F,strideInBytes:6*E},{index:zv.position2DHigh,componentsPerAttribute:3,componentDatatype:ue.a.FLOAT,offsetInBytes:N,strideInBytes:6*E},{index:zv.position2DLow,componentsPerAttribute:3,componentDatatype:ue.a.FLOAT,offsetInBytes:F,strideInBytes:6*E},{index:zv.prevPosition3DHigh,componentsPerAttribute:3,componentDatatype:ue.a.FLOAT,offsetInBytes:B,strideInBytes:6*E},{index:zv.prevPosition3DLow,componentsPerAttribute:3,componentDatatype:ue.a.FLOAT,offsetInBytes:U,strideInBytes:6*E},{index:zv.prevPosition2DHigh,componentsPerAttribute:3,componentDatatype:ue.a.FLOAT,offsetInBytes:B,strideInBytes:6*E},{index:zv.prevPosition2DLow,componentsPerAttribute:3,componentDatatype:ue.a.FLOAT,offsetInBytes:U,strideInBytes:6*E},{index:zv.nextPosition3DHigh,componentsPerAttribute:3,componentDatatype:ue.a.FLOAT,offsetInBytes:H,strideInBytes:6*E},{index:zv.nextPosition3DLow,componentsPerAttribute:3,componentDatatype:ue.a.FLOAT,offsetInBytes:k,strideInBytes:6*E},{index:zv.nextPosition2DHigh,componentsPerAttribute:3,componentDatatype:ue.a.FLOAT,offsetInBytes:H,strideInBytes:6*E},{index:zv.nextPosition2DLow,componentsPerAttribute:3,componentDatatype:ue.a.FLOAT,offsetInBytes:k,strideInBytes:6*E},{index:zv.texCoordExpandAndBatchIndex,componentsPerAttribute:4,componentDatatype:ue.a.FLOAT,vertexBuffer:e._texCoordExpandAndBatchIndexBuffer,offsetInBytes:z}];v===Be.a.SCENE3D?(M=e._positionBuffer,R="vertexBuffer",L=Zv,V="value"):v===Be.a.SCENE2D||v===Be.a.COLUMBUS_VIEW?(M=Zv,R="value",L=e._positionBuffer,V="vertexBuffer"):(M=x,R="vertexBuffer",L=e._positionBuffer,V="vertexBuffer"),G[0][R]=M,G[1][R]=M,G[2][V]=L,G[3][V]=L,G[4][R]=M,G[5][R]=M,G[6][V]=L,G[7][V]=L,G[8][R]=M,G[9][R]=M,G[10][V]=L,G[11][V]=L;var q=new Gf.a({context:t,attributes:G,indexBuffer:S});e._vertexArrays.push({va:q,buckets:c[D]})}}}function Qv(e,t){return t instanceof Hf.a?t.id:t}var $v=[];function eg(e){var t=te.a._uniformList[e.type],a=t.length;$v.length=2*a;for(var i=0,r=0;r<a;++r){var n=t[r];$v[i]=n,$v[i+1]=e._uniforms[n](),i+=2}return e.type+":"+JSON.stringify($v,Qv)}function tg(e){if(e._polylinesRemoved){e._polylinesRemoved=!1;for(var t,a=[],i=[],r=0,n=e._polylines.length,o=0;o<n;++o)(t=e._polylines[o]).isDestroyed||(t._index=r++,i.push(t),a.push(t));e._polylines=a,e._polylinesToUpdate=i}}function ag(e){for(var t=e._polylines,a=t.length,i=0;i<a;++i)if(!t[i].isDestroyed){var r=t[i]._bucket;Object(s.default)(r)&&(r.shaderProgram=r.shaderProgram&&r.shaderProgram.destroy())}}function ig(e){for(var t=e._vertexArrays.length,a=0;a<t;++a)e._vertexArrays[a].va.destroy();e._vertexArrays.length=0}function rg(e){for(var t=e._polylines,a=t.length,i=0;i<a;++i)t[i].isDestroyed||t[i]._destroy()}function ng(e,t,a){this.count=e,this.offset=t,this.bucket=a}function og(e,t,a){this.polylines=[],this.lengthOfPositions=0,this.material=e,this.shaderProgram=void 0,this.mode=t,this.modelMatrix=a}function sg(e){return y.default.dot(y.default.UNIT_X,e._boundingVolume.center)<0||e._boundingVolume.intersectPlane(ut.a.ORIGIN_ZX_PLANE)===Ov.default.INTERSECTING}Gv.prototype._updatePolyline=function(e,t){this._polylinesUpdated=!0,e._dirty||this._polylinesToUpdate.push(e),++this._propertiesChanged[t]},og.prototype.addPolyline=function(e){this.polylines.push(e),e._actualLength=this.getPolylinePositionsLength(e),this.lengthOfPositions+=e._actualLength,e._bucket=this},og.prototype.updateShader=function(e,t,a){if(!Object(s.default)(this.shaderProgram)){var i=["DISTANCE_DISPLAY_CONDITION"];a&&i.push("VECTOR_TILE"),-1!==this.material.shaderSource.search(/varying\s+float\s+v_polylineAngle;/g)&&i.push("POLYLINE_DASH"),xf.default.isInternetExplorer()||i.push("CLIP_POLYLINE");var r=new Uf.a({defines:i,sources:["varying vec4 v_pickColor;\n",this.material.shaderSource,Av.a]}),n=t.getVertexShaderCallback()("attribute vec3 position3DHigh;\nattribute vec3 position3DLow;\nattribute vec3 position2DHigh;\nattribute vec3 position2DLow;\nattribute vec3 prevPosition3DHigh;\nattribute vec3 prevPosition3DLow;\nattribute vec3 prevPosition2DHigh;\nattribute vec3 prevPosition2DLow;\nattribute vec3 nextPosition3DHigh;\nattribute vec3 nextPosition3DLow;\nattribute vec3 nextPosition2DHigh;\nattribute vec3 nextPosition2DLow;\nattribute vec4 texCoordExpandAndBatchIndex;\n\nvarying vec2  v_st;\nvarying float v_width;\nvarying vec4 v_pickColor;\nvarying float v_polylineAngle;\n\nvoid main()\n{\n    float texCoord = texCoordExpandAndBatchIndex.x;\n    float expandDir = texCoordExpandAndBatchIndex.y;\n    bool usePrev = texCoordExpandAndBatchIndex.z < 0.0;\n    float batchTableIndex = texCoordExpandAndBatchIndex.w;\n\n    vec2 widthAndShow = batchTable_getWidthAndShow(batchTableIndex);\n    float width = widthAndShow.x + 0.5;\n    float show = widthAndShow.y;\n\n    if (width < 1.0)\n    {\n        show = 0.0;\n    }\n\n    vec4 pickColor = batchTable_getPickColor(batchTableIndex);\n\n    vec4 p, prev, next;\n    if (czm_morphTime == 1.0)\n    {\n        p = czm_translateRelativeToEye(position3DHigh.xyz, position3DLow.xyz);\n        prev = czm_translateRelativeToEye(prevPosition3DHigh.xyz, prevPosition3DLow.xyz);\n        next = czm_translateRelativeToEye(nextPosition3DHigh.xyz, nextPosition3DLow.xyz);\n    }\n    else if (czm_morphTime == 0.0)\n    {\n        p = czm_translateRelativeToEye(position2DHigh.zxy, position2DLow.zxy);\n        prev = czm_translateRelativeToEye(prevPosition2DHigh.zxy, prevPosition2DLow.zxy);\n        next = czm_translateRelativeToEye(nextPosition2DHigh.zxy, nextPosition2DLow.zxy);\n    }\n    else\n    {\n        p = czm_columbusViewMorph(\n                czm_translateRelativeToEye(position2DHigh.zxy, position2DLow.zxy),\n                czm_translateRelativeToEye(position3DHigh.xyz, position3DLow.xyz),\n                czm_morphTime);\n        prev = czm_columbusViewMorph(\n                czm_translateRelativeToEye(prevPosition2DHigh.zxy, prevPosition2DLow.zxy),\n                czm_translateRelativeToEye(prevPosition3DHigh.xyz, prevPosition3DLow.xyz),\n                czm_morphTime);\n        next = czm_columbusViewMorph(\n                czm_translateRelativeToEye(nextPosition2DHigh.zxy, nextPosition2DLow.zxy),\n                czm_translateRelativeToEye(nextPosition3DHigh.xyz, nextPosition3DLow.xyz),\n                czm_morphTime);\n    }\n\n    #ifdef DISTANCE_DISPLAY_CONDITION\n        vec3 centerHigh = batchTable_getCenterHigh(batchTableIndex);\n        vec4 centerLowAndRadius = batchTable_getCenterLowAndRadius(batchTableIndex);\n        vec3 centerLow = centerLowAndRadius.xyz;\n        float radius = centerLowAndRadius.w;\n        vec2 distanceDisplayCondition = batchTable_getDistanceDisplayCondition(batchTableIndex);\n\n        float lengthSq;\n        if (czm_sceneMode == czm_sceneMode2D)\n        {\n            lengthSq = czm_eyeHeight2D.y;\n        }\n        else\n        {\n            vec4 center = czm_translateRelativeToEye(centerHigh.xyz, centerLow.xyz);\n            lengthSq = max(0.0, dot(center.xyz, center.xyz) - radius * radius);\n        }\n\n        float nearSq = distanceDisplayCondition.x * distanceDisplayCondition.x;\n        float farSq = distanceDisplayCondition.y * distanceDisplayCondition.y;\n        if (lengthSq < nearSq || lengthSq > farSq)\n        {\n            show = 0.0;\n        }\n    #endif\n\n    vec4 positionWC = getPolylineWindowCoordinates(p, prev, next, expandDir, width, usePrev, v_polylineAngle);\n    gl_Position = czm_viewportOrthographic * positionWC * show;\n\n    v_st = vec2(texCoord, clamp(expandDir, 0.0, 1.0));\n    v_width = width;\n    v_pickColor = pickColor;\n\n#ifdef LOG_DEPTH\n    czm_vertexLogDepth(czm_modelViewProjectionRelativeToEye * p);\n#endif\n}\n"),o=new Uf.a({defines:i,sources:[xv.a,n]});this.shaderProgram=Bf.a.fromCache({context:e,vertexShaderSource:o,fragmentShaderSource:r,attributeLocations:zv})}},og.prototype.getPolylinePositionsLength=function(e){var t;if(this.mode===Be.a.SCENE3D||!sg(e))return 4*(t=e._actualPositions.length)-4;var a=0,i=e._segments.lengths;t=i.length;for(var r=0;r<t;++r)a+=4*i[r]-4;return a};var lg=new y.default,ug=new y.default,dg=new y.default,fg=new y.default,cg=new Rt.a,hg=new _.default;og.prototype.write=function(e,t,a,i,r,n,o,l){for(var u=this.mode,d=l.ellipsoid.maximumRadius*Fe.default.PI,f=this.polylines,c=f.length,h=0;h<c;++h){for(var p,m=f[h],v=m.width,g=m.show&&v>0,_=m._index,O=this.getSegments(m,l),w=O.positions,x=O.lengths,A=w.length,j=m.getPickId(o).color,E=0,C=0,P=0;P<A;++P){0===P?m._loop?p=w[A-2]:(p=fg,y.default.subtract(w[0],w[1],p),y.default.add(w[0],p,p)):p=w[P-1],y.default.clone(p,ug),y.default.clone(w[P],lg),P===A-1?m._loop?p=w[1]:(p=fg,y.default.subtract(w[A-1],w[A-2],p),y.default.add(w[A-1],p,p)):p=w[P+1],y.default.clone(p,dg);var T=x[E];P===C+T&&(C+=T,++E);var D=P-C==0,I=P===C+x[E]-1;u===Be.a.SCENE2D&&(ug.z=0,lg.z=0,dg.z=0),u!==Be.a.SCENE2D&&u!==Be.a.MORPHING||(D||I)&&d-Math.abs(lg.x)<1&&((lg.x<0&&ug.x>0||lg.x>0&&ug.x<0)&&y.default.clone(lg,ug),(lg.x<0&&dg.x>0||lg.x>0&&dg.x<0)&&y.default.clone(lg,dg));for(var S=I?2:4,M=D?2:0;M<S;++M){bv.a.writeElements(lg,e,a),bv.a.writeElements(ug,e,a+6),bv.a.writeElements(dg,e,a+12);var R=M-2<0?-1:1;t[r]=P/(A-1),t[r+1]=M%2*2-1,t[r+2]=R,t[r+3]=_,a+=18,r+=4}}var L=cg;L.x=b.default.floatToByte(j.red),L.y=b.default.floatToByte(j.green),L.z=b.default.floatToByte(j.blue),L.w=b.default.floatToByte(j.alpha);var V=hg;V.x=v,V.y=g?1:0;var N=u===Be.a.SCENE2D?m._boundingVolume2D:m._boundingVolumeWC,F=bv.a.fromCartesian(N.center,qv),B=F.high,U=Rt.a.fromElements(F.low.x,F.low.y,F.low.z,N.radius,Wv),H=Yv;H.x=0,H.y=Number.MAX_VALUE;var k=m.distanceDisplayCondition;Object(s.default)(k)&&(H.x=k.near,H.y=k.far),n.setBatchedAttribute(_,0,V),n.setBatchedAttribute(_,1,L),n.attributes.length>2&&(n.setBatchedAttribute(_,2,B),n.setBatchedAttribute(_,3,U),n.setBatchedAttribute(_,4,H))}};var pg=new y.default,mg=new y.default,vg=new y.default,gg=new y.default;og.prototype.writeForMorph=function(e,t){for(var a=this.modelMatrix,i=this.polylines,r=i.length,n=0;n<r;++n)for(var o=i[n],s=o._segments.positions,l=o._segments.lengths,u=s.length,d=0,f=0,c=0;c<u;++c){var h;0===c?o._loop?h=s[u-2]:(h=gg,y.default.subtract(s[0],s[1],h),y.default.add(s[0],h,h)):h=s[c-1],h=lt.default.multiplyByPoint(a,h,mg);var p,m=lt.default.multiplyByPoint(a,s[c],pg);c===u-1?o._loop?p=s[1]:(p=gg,y.default.subtract(s[u-1],s[u-2],p),y.default.add(s[u-1],p,p)):p=s[c+1],p=lt.default.multiplyByPoint(a,p,vg);var v=l[d];c===f+v&&(f+=v,++d);for(var g=c-f==0,_=c===f+l[d]-1?2:4,b=g?2:0;b<_;++b)bv.a.writeElements(m,e,t),bv.a.writeElements(h,e,t+6),bv.a.writeElements(p,e,t+12),t+=18}};var _g=new Array(1);og.prototype.updateIndices=function(e,t,a,i){var r=a.length-1,n=new ng(0,i,this);a[r].push(n);var o=0,s=e[e.length-1],l=0;s.length>0&&(l=s[s.length-1]+1);for(var u=this.polylines,d=u.length,f=0;f<d;++f){var c,h=u[f];if(h._locatorBuckets=[],this.mode===Be.a.SCENE3D){c=_g;var p=h._actualPositions.length;if(!(p>0))continue;c[0]=p}else c=h._segments.lengths;var m=c.length;if(m>0){for(var v=0,g=0;g<m;++g)for(var _=c[g]-1,y=0;y<_;++y)l+4>Fe.default.SIXTY_FOUR_KILOBYTES&&(h._locatorBuckets.push({locator:n,count:v}),v=0,t.push(4),s=[],e.push(s),l=0,n.count=o,o=0,i=0,n=new ng(0,0,this),a[++r]=[n]),s.push(l,l+2,l+1),s.push(l+1,l+2,l+3),v+=6,o+=6,i+=6,l+=4;h._locatorBuckets.push({locator:n,count:v}),l+4>Fe.default.SIXTY_FOUR_KILOBYTES&&(t.push(0),s=[],e.push(s),l=0,n.count=o,i=0,o=0,n=new ng(0,0,this),a[++r]=[n])}h._clean()}return n.count=o,i},og.prototype.getPolylineStartIndex=function(e){for(var t=this.polylines,a=0,i=t.length,r=0;r<i;++r){var n=t[r];if(n===e)break;a+=n._actualLength}return a};var yg,bg={positions:void 0,lengths:void 0},Og=new Array(1),wg=new y.default,xg=new Ne.default;og.prototype.getSegments=function(e,t){var a=e._actualPositions;if(this.mode===Be.a.SCENE3D)return Og[0]=a.length,bg.positions=a,bg.lengths=Og,bg;sg(e)&&(a=e._segments.positions);for(var i,n=t.ellipsoid,o=[],s=this.modelMatrix,l=a.length,u=wg,d=0;d<l;++d)i=a[d],u=lt.default.multiplyByPoint(s,i,u),o.push(t.project(n.cartesianToCartographic(u,xg)));if(o.length>0){e._boundingVolume2D=r.default.fromPoints(o,e._boundingVolume2D);var f=e._boundingVolume2D.center;e._boundingVolume2D.center=new y.default(f.z,f.x,f.y)}return bg.positions=o,bg.lengths=e._segments.lengths,bg},og.prototype.writeUpdate=function(e,t,a,i){var r=this.mode,n=i.ellipsoid.maximumRadius*Fe.default.PI,o=t._actualLength;if(o){e+=this.getPolylineStartIndex(t);var l=yg,u=6*o*3;!Object(s.default)(l)||l.length<u?l=yg=new Float32Array(u):l.length>u&&(l=new Float32Array(l.buffer,0,u));var d,f=this.getSegments(t,i),c=f.positions,h=f.lengths,p=0,m=0,v=0;o=c.length;for(var g=0;g<o;++g){0===g?t._loop?d=c[o-2]:(d=fg,y.default.subtract(c[0],c[1],d),y.default.add(c[0],d,d)):d=c[g-1],y.default.clone(d,ug),y.default.clone(c[g],lg),g===o-1?t._loop?d=c[1]:(d=fg,y.default.subtract(c[o-1],c[o-2],d),y.default.add(c[o-1],d,d)):d=c[g+1],y.default.clone(d,dg);var _=h[m];g===v+_&&(v+=_,++m);var b=g-v==0,O=g===v+h[m]-1;r===Be.a.SCENE2D&&(ug.z=0,lg.z=0,dg.z=0),r!==Be.a.SCENE2D&&r!==Be.a.MORPHING||(b||O)&&n-Math.abs(lg.x)<1&&((lg.x<0&&ug.x>0||lg.x>0&&ug.x<0)&&y.default.clone(lg,ug),(lg.x<0&&dg.x>0||lg.x>0&&dg.x<0)&&y.default.clone(lg,dg));for(var w=O?2:4,x=b?2:0;x<w;++x)bv.a.writeElements(lg,l,p),bv.a.writeElements(ug,l,p+6),bv.a.writeElements(dg,l,p+12),p+=18}a.copyFromArrayView(l,18*Float32Array.BYTES_PER_ELEMENT*e)}};var Ag=Gv,jg=a(1624),Eg=a(310),Cg=a(1625),Pg=a(716),Tg=a(1626),Dg=a(717),Ig=new yv.default,Sg=new yv.default,Mg=new yv.default;function Rg(e){this.entity=e,this.polyline=void 0,this.index=void 0,this.updater=void 0}function Lg(e,t,a,i,r,n,o,l){for(;e instanceof Cg.a;)e=e.resolvedProperty;e instanceof Pg.default?o=function(e,t,a,i,r,n,o,l,u){var d,f=l;d=e.getValueInReferenceFrame(t,n,u[f]),Object(s.default)(d)&&(u[f++]=d);for(var c,h,p,m=!Object(s.default)(r)||ph.default.lessThanOrEquals(r,t)||ph.default.greaterThanOrEquals(r,a),v=0,g=i.length,_=i[v],y=a,b=!1;v<g;){if(!m&&ph.default.greaterThanOrEquals(_,r)&&(d=e.getValueInReferenceFrame(r,n,u[f]),Object(s.default)(d)&&(u[f++]=d),m=!0),ph.default.greaterThan(_,t)&&ph.default.lessThan(_,y)&&!_.equals(r)&&(d=e.getValueInReferenceFrame(_,n,u[f]),Object(s.default)(d)&&(u[f++]=d)),v<g-1){if(o>0&&!b){var O=i[v+1],w=ph.default.secondsDifference(O,_);(b=w>o)&&(c=Math.ceil(w/o),h=0,p=w/Math.max(c,2),c=Math.max(c-1,1))}if(b&&h<c){_=ph.default.addSeconds(_,p,new ph.default),h++;continue}}b=!1,_=i[++v]}return d=e.getValueInReferenceFrame(a,n,u[f]),Object(s.default)(d)&&(u[f++]=d),f}(e,t,a,e._property._times,i,r,n,o,l):o=e instanceof jg.a?function(e,t,a,i,r,n,o,s){Sg.start=t,Sg.stop=a;for(var l=o,u=e.intervals,d=0;d<u.length;d++){var f=u.get(d);if(!yv.default.intersect(f,Sg,Ig).isEmpty){var c=f.start,h=f.stop,p=t;ph.default.greaterThan(c,p)&&(p=c);var m=a;ph.default.lessThan(h,m)&&(m=h),l=Lg(f.data,p,m,i,r,n,l,s)}}return l}(e,t,a,i,r,n,o,l):e instanceof Dg.default?function(e,t,a,i,r,n,o,l){Mg.start=t,Mg.stop=a;for(var u=o,d=e.intervals,f=0;f<d.length;f++){var c=d.get(f);if(!yv.default.intersect(c,Mg,Ig).isEmpty){var h=c.start;c.isStartIncluded||(h=c.isStopIncluded?c.stop:ph.default.addSeconds(c.start,ph.default.secondsDifference(c.stop,c.start)/2,new ph.default));var p=e.getValueInReferenceFrame(h,r,l[u]);Object(s.default)(p)&&(l[u]=p,u++)}}return u}(e,t,a,0,r,0,o,l):e instanceof Eg.default||e instanceof Tg.a&&P.default.isConstant(e)?function(e,t,a,i,r,n,o,l){var u=e.getValueInReferenceFrame(t,r,l[o]);return Object(s.default)(u)&&(l[o++]=u),o}(e,t,0,0,r,0,o,l):function(e,t,a,i,r,n,o,l){for(var u,d=0,f=o,c=t,h=Math.max(n,60),p=!Object(s.default)(i)||ph.default.lessThanOrEquals(i,t)||ph.default.greaterThanOrEquals(i,a);ph.default.lessThan(c,a);)!p&&ph.default.greaterThanOrEquals(c,i)&&(p=!0,u=e.getValueInReferenceFrame(i,r,l[f]),Object(s.default)(u)&&(l[f]=u,f++)),u=e.getValueInReferenceFrame(c,r,l[f]),Object(s.default)(u)&&(l[f]=u,f++),d++,c=ph.default.addSeconds(t,h*d,new ph.default);return u=e.getValueInReferenceFrame(a,r,l[f]),Object(s.default)(u)&&(l[f]=u,f++),f}(e,t,a,i,r,n,o,l);return o}function Vg(e,t,a,i,r,n,o){Object(s.default)(o)||(o=[]);var l=Lg(e,t,a,i,r,n,0,o);return o.length=l,o}var Ng=new at.default;function Fg(e,t){this._unusedIndexes=[],this._polylineCollection=new Ag,this._scene=e,this._referenceFrame=t,e.primitives.add(this._polylineCollection)}function Bg(e,t){t.collectionChanged.addEventListener(Bg.prototype._onCollectionChanged,this),this._scene=e,this._updaters={},this._entityCollection=t,this._items=new v.default,this._onCollectionChanged(t,t.values,[],[])}Fg.prototype.update=function(e){if(this._referenceFrame===_v.a.INERTIAL){var t=Nt.default.computeIcrfToFixedMatrix(e,Ng);Object(s.default)(t)||(t=Nt.default.computeTemeToPseudoFixedMatrix(e,Ng)),lt.default.fromRotationTranslation(t,y.default.ZERO,this._polylineCollection.modelMatrix)}},Fg.prototype.updateObject=function(e,t){var a,i,r=t.entity,n=r._path,o=r._position,l=n._show,u=t.polyline,d=r.isShowing&&(!Object(s.default)(l)||l.getValue(e));if(d){var f=P.default.getValueOrUndefined(n._leadTime,e),c=P.default.getValueOrUndefined(n._trailTime,e),h=r._availability,p=Object(s.default)(h),m=Object(s.default)(f),v=Object(s.default)(c);if(d=p||m&&v){if(v&&(a=ph.default.addSeconds(e,-c,new ph.default)),m&&(i=ph.default.addSeconds(e,f,new ph.default)),p){var g=h.start,_=h.stop;v&&!ph.default.greaterThan(g,a)||(a=g),m&&!ph.default.lessThan(_,i)||(i=_)}d=ph.default.lessThan(a,i)}}if(d){if(!Object(s.default)(u)){var y=this._unusedIndexes;if(y.length>0){var b=y.pop();u=this._polylineCollection.get(b),t.index=b}else t.index=this._polylineCollection.length,u=this._polylineCollection.add();u.id=r,t.polyline=u}var O=P.default.getValueOrDefault(n._resolution,e,60);u.show=!0,u.positions=Vg(o,a,i,e,this._referenceFrame,O,u.positions.slice()),u.material=be.getValue(e,n._material,u.material),u.width=P.default.getValueOrDefault(n._width,e,1),u.distanceDisplayCondition=P.default.getValueOrUndefined(n._distanceDisplayCondition,e,u.distanceDisplayCondition)}else Object(s.default)(u)&&(this._unusedIndexes.push(t.index),t.polyline=void 0,u.show=!1,t.index=void 0)},Fg.prototype.removeObject=function(e){var t=e.polyline;Object(s.default)(t)&&(this._unusedIndexes.push(e.index),e.polyline=void 0,t.show=!1,t.id=void 0,e.index=void 0)},Fg.prototype.destroy=function(){return this._scene.primitives.remove(this._polylineCollection),Object(u.default)(this)},Bg.prototype.update=function(e){var t=this._updaters;for(var a in t)t.hasOwnProperty(a)&&t[a].update(e);var i=this._items.values;if(0===i.length&&Object(s.default)(this._updaters)&&Object.keys(this._updaters).length>0){for(var r in t)t.hasOwnProperty(r)&&t[r].destroy();this._updaters={}}for(var n=0,o=i.length;n<o;n++){var l=i[n],u=l.entity._position,d=l.updater,f=_v.a.FIXED;this._scene.mode===Be.a.SCENE3D&&(f=u.referenceFrame);var c=this._updaters[f];d===c&&Object(s.default)(c)?c.updateObject(e,l):(Object(s.default)(d)&&d.removeObject(l),Object(s.default)(c)||((c=new Fg(this._scene,f)).update(e),this._updaters[f]=c),l.updater=c,Object(s.default)(c)&&c.updateObject(e,l))}return!0},Bg.prototype.isDestroyed=function(){return!1},Bg.prototype.destroy=function(){this._entityCollection.collectionChanged.removeEventListener(Bg.prototype._onCollectionChanged,this);var e=this._updaters;for(var t in e)e.hasOwnProperty(t)&&e[t].destroy();return Object(u.default)(this)},Bg.prototype._onCollectionChanged=function(e,t,a,i){var r,n,o,l=this._items;for(r=t.length-1;r>-1;r--)n=t[r],Object(s.default)(n._path)&&Object(s.default)(n._position)&&l.set(n.id,new Rg(n));for(r=i.length-1;r>-1;r--)n=i[r],Object(s.default)(n._path)&&Object(s.default)(n._position)?l.contains(n.id)||l.set(n.id,new Rg(n)):(o=l.get(n.id),Object(s.default)(o)&&(Object(s.default)(o.updater)&&o.updater.removeObject(o),l.remove(n.id)));for(r=a.length-1;r>-1;r--)n=a[r],o=l.get(n.id),Object(s.default)(o)&&(Object(s.default)(o.updater)&&o.updater.removeObject(o),l.remove(n.id))},Bg._subSample=Vg;var Ug=Bg;var Hg=function(e,t,a,i,r){return function(){var n=document.createElement("canvas"),o=r+2*i;n.height=n.width=o;var s=n.getContext("2d");return s.clearRect(0,0,o,o),0!==i&&(s.beginPath(),s.arc(o/2,o/2,o/2,0,2*Math.PI,!0),s.closePath(),s.fillStyle=a,s.fill(),e<1&&(s.save(),s.globalCompositeOperation="destination-out",s.beginPath(),s.arc(o/2,o/2,r/2,0,2*Math.PI,!0),s.closePath(),s.fillStyle="black",s.fill(),s.restore())),s.beginPath(),s.arc(o/2,o/2,r/2,0,2*Math.PI,!0),s.closePath(),s.fillStyle=t,s.fill(),n}},kg=b.default.WHITE,zg=b.default.BLACK,Gg=new b.default,qg=new y.default,Wg=new b.default,Yg=new x.a,Kg=new x.a,Xg=new w.a;function Zg(e){this.entity=e,this.pointPrimitive=void 0,this.billboard=void 0,this.color=void 0,this.outlineColor=void 0,this.pixelSize=void 0,this.outlineWidth=void 0}function Jg(e,t){t.collectionChanged.addEventListener(Jg.prototype._onCollectionChanged,this),this._cluster=e,this._entityCollection=t,this._items=new v.default,this._onCollectionChanged(t,t.values,[],[])}function Qg(e,t,a){if(Object(s.default)(e)){var i=e.pointPrimitive;if(Object(s.default)(i))return e.pointPrimitive=void 0,void a.removePoint(t);var r=e.billboard;Object(s.default)(r)&&(e.billboard=void 0,a.removeBillboard(t))}}Jg.prototype.update=function(e){for(var t=this._items.values,a=this._cluster,i=0,r=t.length;i<r;i++){var n,o=t[i],l=o.entity,u=l._point,d=o.pointPrimitive,f=o.billboard,c=P.default.getValueOrDefault(u._heightReference,e,A.default.NONE),h=l.isShowing&&l.isAvailable(e)&&P.default.getValueOrDefault(u._show,e,!0);if(h&&(n=P.default.getValueOrUndefined(l._position,e,qg),h=Object(s.default)(n)),h){P.default.isConstant(l._position)||(a._clusterDirty=!0);var p=!1,m=!1;if(c===A.default.NONE||Object(s.default)(f)?c!==A.default.NONE||Object(s.default)(d)||(Object(s.default)(f)&&(Qg(o,l,a),f=void 0),(d=a.getPoint(l)).id=l,o.pointPrimitive=d):(Object(s.default)(d)&&(Qg(o,l,a),d=void 0),(f=a.getBillboard(l)).id=l,f.image=void 0,o.billboard=f,p=!0,m=y.default.equals(f.position,n)&&f.heightReference===c),Object(s.default)(d))d.show=!0,d.position=n,d.scaleByDistance=P.default.getValueOrUndefined(u._scaleByDistance,e,Yg),d.translucencyByDistance=P.default.getValueOrUndefined(u._translucencyByDistance,e,Kg),d.color=P.default.getValueOrDefault(u._color,e,kg,Gg),d.outlineColor=P.default.getValueOrDefault(u._outlineColor,e,zg,Wg),d.outlineWidth=P.default.getValueOrDefault(u._outlineWidth,e,0),d.pixelSize=P.default.getValueOrDefault(u._pixelSize,e,1),d.distanceDisplayCondition=P.default.getValueOrUndefined(u._distanceDisplayCondition,e,Xg),d.disableDepthTestDistance=P.default.getValueOrDefault(u._disableDepthTestDistance,e,0);else if(Object(s.default)(f)){f.show=!0,f.position=n,f.scaleByDistance=P.default.getValueOrUndefined(u._scaleByDistance,e,Yg),f.translucencyByDistance=P.default.getValueOrUndefined(u._translucencyByDistance,e,Kg),f.distanceDisplayCondition=P.default.getValueOrUndefined(u._distanceDisplayCondition,e,Xg),f.disableDepthTestDistance=P.default.getValueOrDefault(u._disableDepthTestDistance,e,0),f.heightReference=c;var v=P.default.getValueOrDefault(u._color,e,kg,Gg),g=P.default.getValueOrDefault(u._outlineColor,e,zg,Wg),_=Math.round(P.default.getValueOrDefault(u._outlineWidth,e,0)),O=Math.max(1,Math.round(P.default.getValueOrDefault(u._pixelSize,e,1)));if(_>0?(f.scale=1,p=p||_!==o.outlineWidth||O!==o.pixelSize||!b.default.equals(v,o.color)||!b.default.equals(g,o.outlineColor)):(f.scale=O/50,O=50,p=p||_!==o.outlineWidth||!b.default.equals(v,o.color)||!b.default.equals(g,o.outlineColor)),p){o.color=b.default.clone(v,o.color),o.outlineColor=b.default.clone(g,o.outlineColor),o.pixelSize=O,o.outlineWidth=_;var w=v.alpha,x=v.toCssColorString(),j=g.toCssColorString(),E=JSON.stringify([x,O,j,_]);f.setImage(E,Hg(w,x,j,_,O))}m&&f._updateClamping()}}else Qg(o,l,a)}return!0},Jg.prototype.getBoundingSphere=function(e,t){var a=this._items.get(e.id);if(!Object(s.default)(a)||!Object(s.default)(a.pointPrimitive)&&!Object(s.default)(a.billboard))return C.default.FAILED;if(Object(s.default)(a.pointPrimitive))t.center=y.default.clone(a.pointPrimitive.position,t.center);else{var i=a.billboard;if(!Object(s.default)(i._clampedPosition))return C.default.PENDING;t.center=y.default.clone(i._clampedPosition,t.center)}return t.radius=0,C.default.DONE},Jg.prototype.isDestroyed=function(){return!1},Jg.prototype.destroy=function(){this._entityCollection.collectionChanged.removeEventListener(Jg.prototype._onCollectionChanged,this);for(var e=this._entityCollection.values,t=0;t<e.length;t++)this._cluster.removePoint(e[t]);return Object(u.default)(this)},Jg.prototype._onCollectionChanged=function(e,t,a,i){var r,n,o=this._items,l=this._cluster;for(r=t.length-1;r>-1;r--)n=t[r],Object(s.default)(n._point)&&Object(s.default)(n._position)&&o.set(n.id,new Zg(n));for(r=i.length-1;r>-1;r--)n=i[r],Object(s.default)(n._point)&&Object(s.default)(n._position)?o.contains(n.id)||o.set(n.id,new Zg(n)):(Qg(o.get(n.id),n,l),o.remove(n.id));for(r=a.length-1;r>-1;r--)n=a[r],Qg(o.get(n.id),n,l),o.remove(n.id)};var $g=Jg,e_=a(414),t_=a(519),a_=a(537),i_=a(258),r_=[];function n_(e,t,a,i,r){var n,o=r_;o.length=r;var s=a.red,l=a.green,u=a.blue,d=a.alpha,f=i.red,c=i.green,h=i.blue,p=i.alpha;if(b.default.equals(a,i)){for(n=0;n<r;n++)o[n]=b.default.clone(a);return o}var m=(f-s)/r,v=(c-l)/r,g=(h-u)/r,_=(p-d)/r;for(n=0;n<r;n++)o[n]=new b.default(s+n*m,l+n*v,u+n*g,d+n*_);return o}function o_(e){var t=(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).positions,a=e.colors,i=Object(o.default)(e.width,1),r=Object(o.default)(e.colorsPerVertex,!1);this._positions=t,this._colors=a,this._width=i,this._colorsPerVertex=r,this._vertexFormat=$.default.clone(Object(o.default)(e.vertexFormat,$.default.DEFAULT)),this._arcType=Object(o.default)(e.arcType,oo.a.GEODESIC),this._granularity=Object(o.default)(e.granularity,Fe.default.RADIANS_PER_DEGREE),this._ellipsoid=it.default.clone(Object(o.default)(e.ellipsoid,it.default.WGS84)),this._workerName="createPolylineGeometry";var n=1+t.length*y.default.packedLength;n+=Object(s.default)(a)?1+a.length*b.default.packedLength:1,this.packedLength=n+it.default.packedLength+$.default.packedLength+4}o_.pack=function(e,t,a){var i;a=Object(o.default)(a,0);var r=e._positions,n=r.length;for(t[a++]=n,i=0;i<n;++i,a+=y.default.packedLength)y.default.pack(r[i],t,a);var l=e._colors;for(n=Object(s.default)(l)?l.length:0,t[a++]=n,i=0;i<n;++i,a+=b.default.packedLength)b.default.pack(l[i],t,a);return it.default.pack(e._ellipsoid,t,a),a+=it.default.packedLength,$.default.pack(e._vertexFormat,t,a),a+=$.default.packedLength,t[a++]=e._width,t[a++]=e._colorsPerVertex?1:0,t[a++]=e._arcType,t[a]=e._granularity,t};var s_=it.default.clone(it.default.UNIT_SPHERE),l_=new $.default,u_={positions:void 0,colors:void 0,ellipsoid:s_,vertexFormat:l_,width:void 0,colorsPerVertex:void 0,arcType:void 0,granularity:void 0};o_.unpack=function(e,t,a){var i;t=Object(o.default)(t,0);var r=e[t++],n=new Array(r);for(i=0;i<r;++i,t+=y.default.packedLength)n[i]=y.default.unpack(e,t);var l=(r=e[t++])>0?new Array(r):void 0;for(i=0;i<r;++i,t+=b.default.packedLength)l[i]=b.default.unpack(e,t);var u=it.default.unpack(e,t,s_);t+=it.default.packedLength;var d=$.default.unpack(e,t,l_);t+=$.default.packedLength;var f=e[t++],c=1===e[t++],h=e[t++],p=e[t];return Object(s.default)(a)?(a._positions=n,a._colors=l,a._ellipsoid=it.default.clone(u,a._ellipsoid),a._vertexFormat=$.default.clone(d,a._vertexFormat),a._width=f,a._colorsPerVertex=c,a._arcType=h,a._granularity=p,a):(u_.positions=n,u_.colors=l,u_.width=f,u_.colorsPerVertex=c,u_.arcType=h,u_.granularity=p,new o_(u_))};var d_=new y.default,f_=new y.default,c_=new y.default,h_=new y.default;o_.createGeometry=function(e){var t,a,i,n=e._width,o=e._vertexFormat,l=e._colors,u=e._colorsPerVertex,d=e._arcType,f=e._granularity,c=e._ellipsoid,h=Object(et.a)(e._positions,y.default.equalsEpsilon),p=h.length;if(!(p<2||n<=0)){if(d===oo.a.GEODESIC||d===oo.a.RHUMB){var m,v;d===oo.a.GEODESIC?(m=Fe.default.chordLength(f,c.maximumRadius),v=Mt.numberOfPoints):(m=f,v=Mt.numberOfPointsRhumbLine);var g=Mt.extractHeights(h,c);if(Object(s.default)(l)){var _=1;for(t=0;t<p-1;++t)_+=v(h[t],h[t+1],m);var O=new Array(_),w=0;for(t=0;t<p-1;++t){var x=h[t],A=h[t+1],j=l[t],E=v(x,A,m);if(u&&t<_){var C=n_(0,0,j,l[t+1],E),P=C.length;for(a=0;a<P;++a)O[w++]=C[a]}else for(a=0;a<E;++a)O[w++]=b.default.clone(j)}O[w]=b.default.clone(l[l.length-1]),l=O,r_.length=0}h=d===oo.a.GEODESIC?Mt.generateCartesianArc({positions:h,minDistance:m,ellipsoid:c,height:g}):Mt.generateCartesianRhumbArc({positions:h,granularity:m,ellipsoid:c,height:g})}var T,D=4*(p=h.length)-4,I=new Float64Array(3*D),S=new Float64Array(3*D),M=new Float64Array(3*D),R=new Float32Array(2*D),L=o.st?new Float32Array(2*D):void 0,V=Object(s.default)(l)?new Uint8Array(4*D):void 0,N=0,F=0,B=0,U=0;for(a=0;a<p;++a){var H,k;0===a?(T=d_,y.default.subtract(h[0],h[1],T),y.default.add(h[0],T,T)):T=h[a-1],y.default.clone(T,c_),y.default.clone(h[a],f_),a===p-1?(T=d_,y.default.subtract(h[p-1],h[p-2],T),y.default.add(h[p-1],T,T)):T=h[a+1],y.default.clone(T,h_),Object(s.default)(V)&&(H=0===a||u?l[a]:l[a-1],a!==p-1&&(k=l[a]));var z=a===p-1?2:4;for(i=0===a?2:0;i<z;++i){y.default.pack(f_,I,N),y.default.pack(c_,S,N),y.default.pack(h_,M,N),N+=3;var G=i-2<0?-1:1;if(R[F++]=i%2*2-1,R[F++]=G*n,o.st&&(L[B++]=a/(p-1),L[B++]=Math.max(R[F-2],0)),Object(s.default)(V)){var q=i<2?H:k;V[U++]=b.default.floatToByte(q.red),V[U++]=b.default.floatToByte(q.green),V[U++]=b.default.floatToByte(q.blue),V[U++]=b.default.floatToByte(q.alpha)}}}var W=new Wa.a;W.position=new qa.a({componentDatatype:ue.a.DOUBLE,componentsPerAttribute:3,values:I}),W.prevPosition=new qa.a({componentDatatype:ue.a.DOUBLE,componentsPerAttribute:3,values:S}),W.nextPosition=new qa.a({componentDatatype:ue.a.DOUBLE,componentsPerAttribute:3,values:M}),W.expandAndWidth=new qa.a({componentDatatype:ue.a.FLOAT,componentsPerAttribute:2,values:R}),o.st&&(W.st=new qa.a({componentDatatype:ue.a.FLOAT,componentsPerAttribute:2,values:L})),Object(s.default)(V)&&(W.color=new qa.a({componentDatatype:ue.a.UNSIGNED_BYTE,componentsPerAttribute:4,values:V,normalize:!0}));var Y=Ya.a.createTypedArray(D,6*p-6),K=0,X=0,Z=p-1;for(a=0;a<Z;++a)Y[X++]=K,Y[X++]=K+2,Y[X++]=K+1,Y[X++]=K+1,Y[X++]=K+2,Y[X++]=K+3,K+=4;return new Ga.a({attributes:W,indices:Y,primitiveType:Xa.a.TRIANGLES,boundingSphere:r.default.fromPoints(h),geometryType:i_.a.POLYLINES})}};var p_=o_,m_=new Ae.a(0),v_={},g_=new b.default,__=new ge.default(b.default.WHITE),y_=new Ae.a(!0),b_=new Ae.a(ne.a.DISABLED),O_=new Ae.a(new w.a),w_=new Ae.a(J.a.BOTH);function x_(){this.vertexFormat=void 0,this.positions=void 0,this.width=void 0,this.arcType=void 0,this.granularity=void 0}function A_(){this.positions=void 0,this.width=void 0,this.arcType=void 0,this.granularity=void 0}function j_(e,t){this._entity=e,this._scene=t,this._entitySubscription=e.definitionChanged.addEventListener(j_.prototype._onEntityPropertyChanged,this),this._fillEnabled=!1,this._dynamic=!1,this._geometryChanged=new Z.default,this._showProperty=void 0,this._materialProperty=void 0,this._shadowsProperty=void 0,this._distanceDisplayConditionProperty=void 0,this._classificationTypeProperty=void 0,this._depthFailMaterialProperty=void 0,this._geometryOptions=new x_,this._groundGeometryOptions=new A_,this._id="polyline-"+e.id,this._clampToGround=!1,this._supportsPolylinesOnTerrain=je.default.supportsPolylinesOnTerrain(t),this._zIndex=0,this._onEntityPropertyChanged(e,"polyline",e.polyline,void 0)}Object(l.default)(j_.prototype,{id:{get:function(){return this._id}},entity:{get:function(){return this._entity}},fillEnabled:{get:function(){return this._fillEnabled}},hasConstantFill:{get:function(){return!this._fillEnabled||!Object(s.default)(this._entity.availability)&&P.default.isConstant(this._showProperty)}},fillMaterialProperty:{get:function(){return this._materialProperty}},depthFailMaterialProperty:{get:function(){return this._depthFailMaterialProperty}},outlineEnabled:{value:!1},hasConstantOutline:{value:!0},outlineColorProperty:{value:void 0},shadowsProperty:{get:function(){return this._shadowsProperty}},distanceDisplayConditionProperty:{get:function(){return this._distanceDisplayConditionProperty}},classificationTypeProperty:{get:function(){return this._classificationTypeProperty}},isDynamic:{get:function(){return this._dynamic}},isClosed:{value:!1},geometryChanged:{get:function(){return this._geometryChanged}},arcType:{get:function(){return this._arcType}},clampToGround:{get:function(){return this._clampToGround&&this._supportsPolylinesOnTerrain}},zIndex:{get:function(){return this._zIndex}}}),j_.prototype.isOutlineVisible=function(e){return!1},j_.prototype.isFilled=function(e){var t=this._entity,a=this._fillEnabled&&t.isAvailable(e)&&this._showProperty.getValue(e);return Object(o.default)(a,!1)},j_.prototype.createFillGeometryInstance=function(e){var t,a=this._entity,i=a.isAvailable(e),r=new ve.a(i&&a.isShowing&&this._showProperty.getValue(e)),n=this._distanceDisplayConditionProperty.getValue(e),o={show:r,distanceDisplayCondition:fe.fromDistanceDisplayCondition(n)};return this._materialProperty instanceof ge.default&&(Object(s.default)(this._materialProperty.color)&&(this._materialProperty.color.isConstant||i)&&(t=this._materialProperty.color.getValue(e,g_)),Object(s.default)(t)||(t=b.default.WHITE),o.color=le.a.fromColor(t)),this.clampToGround?new ce.a({id:a,geometry:new a_.a(this._groundGeometryOptions),attributes:o}):(Object(s.default)(this._depthFailMaterialProperty)&&this._depthFailMaterialProperty instanceof ge.default&&(Object(s.default)(this._depthFailMaterialProperty.color)&&(this._depthFailMaterialProperty.color.isConstant||i)&&(t=this._depthFailMaterialProperty.color.getValue(e,g_)),Object(s.default)(t)||(t=b.default.WHITE),o.depthFailColor=le.a.fromColor(t)),new ce.a({id:a,geometry:new p_(this._geometryOptions),attributes:o}))},j_.prototype.createOutlineGeometryInstance=function(e){},j_.prototype.isDestroyed=function(){return!1},j_.prototype.destroy=function(){this._entitySubscription(),Object(u.default)(this)},j_.prototype._onEntityPropertyChanged=function(e,t,a,i){if("availability"===t||"polyline"===t){var r=this._entity.polyline;if(Object(s.default)(r)){var n=r.positions,l=r.show;if(Object(s.default)(l)&&l.isConstant&&!l.getValue(pe.default.MINIMUM_VALUE)||!Object(s.default)(n))this._fillEnabled&&(this._fillEnabled=!1,this._geometryChanged.raiseEvent(this));else{var u=r.zIndex,d=Object(o.default)(r.material,__),f=d instanceof ge.default;this._materialProperty=d,this._depthFailMaterialProperty=r.depthFailMaterial,this._showProperty=Object(o.default)(l,y_),this._shadowsProperty=Object(o.default)(r.shadows,b_),this._distanceDisplayConditionProperty=Object(o.default)(r.distanceDisplayCondition,O_),this._classificationTypeProperty=Object(o.default)(r.classificationType,w_),this._fillEnabled=!0,this._zIndex=Object(o.default)(u,m_);var c=r.width,h=r.arcType,p=r.clampToGround,m=r.granularity;if(n.isConstant&&P.default.isConstant(c)&&P.default.isConstant(h)&&P.default.isConstant(m)&&P.default.isConstant(p)&&P.default.isConstant(u)){var v,g=this._geometryOptions,_=n.getValue(pe.default.MINIMUM_VALUE,g.positions);if(!Object(s.default)(_)||_.length<2)return void(this._fillEnabled&&(this._fillEnabled=!1,this._geometryChanged.raiseEvent(this)));v=f&&(!Object(s.default)(this._depthFailMaterialProperty)||this._depthFailMaterialProperty instanceof ge.default)?e_.a.VERTEX_FORMAT:t_.a.VERTEX_FORMAT,g.vertexFormat=v,g.positions=_,g.width=Object(s.default)(c)?c.getValue(pe.default.MINIMUM_VALUE):void 0,g.arcType=Object(s.default)(h)?h.getValue(pe.default.MINIMUM_VALUE):void 0,g.granularity=Object(s.default)(m)?m.getValue(pe.default.MINIMUM_VALUE):void 0;var y=this._groundGeometryOptions;y.positions=_,y.width=g.width,y.arcType=g.arcType,y.granularity=g.granularity,this._clampToGround=!!Object(s.default)(p)&&p.getValue(pe.default.MINIMUM_VALUE),!this._clampToGround&&Object(s.default)(u)&&Object(xe.a)("Entity polylines must have clampToGround: true when using zIndex.  zIndex will be ignored."),this._dynamic=!1,this._geometryChanged.raiseEvent(this)}else this._dynamic||(this._dynamic=!0,this._geometryChanged.raiseEvent(this))}}else this._fillEnabled&&(this._fillEnabled=!1,this._geometryChanged.raiseEvent(this))}},j_.prototype.createDynamicUpdater=function(e,t){return new C_(e,t,this)};var E_={positions:void 0,granularity:void 0,height:void 0,ellipsoid:void 0};function C_(e,t,a){this._line=void 0,this._primitives=e,this._groundPrimitives=t,this._groundPolylinePrimitive=void 0,this._material=void 0,this._geometryUpdater=a,this._positions=[]}function P_(e){if(Object(s.default)(e._line))return e._line;var t=e._geometryUpdater._scene.id,a=v_[t],i=e._primitives;!Object(s.default)(a)||a.isDestroyed()?(a=new Ag,v_[t]=a,i.add(a)):i.contains(a)||i.add(a);var r=a.add();return r.id=e._geometryUpdater._entity,e._line=r,r}C_.prototype.update=function(e){var t=this._geometryUpdater,a=t._entity,i=a.polyline,r=i.positions,n=P.default.getValueOrUndefined(r,e,this._positions);t._clampToGround=P.default.getValueOrDefault(i._clampToGround,e,!1),t._groundGeometryOptions.positions=n,t._groundGeometryOptions.width=P.default.getValueOrDefault(i._width,e,1),t._groundGeometryOptions.arcType=P.default.getValueOrDefault(i._arcType,e,oo.a.GEODESIC),t._groundGeometryOptions.granularity=P.default.getValueOrDefault(i._granularity,e,9999);var o=this._groundPrimitives;if(Object(s.default)(this._groundPolylinePrimitive)&&(o.remove(this._groundPolylinePrimitive),this._groundPolylinePrimitive=void 0),t.clampToGround){if(!a.isShowing||!a.isAvailable(e)||!P.default.getValueOrDefault(i._show,e,!0))return;if(!Object(s.default)(n)||n.length<2)return;var l,u=t.fillMaterialProperty;if(u instanceof ge.default)l=new e_.a;else{var d=be.getValue(e,u,this._material);l=new t_.a({material:d,translucent:d.isTranslucent()}),this._material=d}return this._groundPolylinePrimitive=o.add(new f.a({geometryInstances:t.createFillGeometryInstance(e),appearance:l,classificationType:t.classificationTypeProperty.getValue(e),asynchronous:!1}),P.default.getValueOrUndefined(t.zIndex,e)),void(Object(s.default)(this._line)&&(this._line.show=!1))}var c=P_(this);if(a.isShowing&&a.isAvailable(e)&&P.default.getValueOrDefault(i._show,e,!0))if(!Object(s.default)(n)||n.length<2)c.show=!1;else{var h=oo.a.GEODESIC;h=P.default.getValueOrDefault(i._arcType,e,h);var p=t._scene.globe;h!==oo.a.NONE&&Object(s.default)(p)&&(E_.ellipsoid=p.ellipsoid,E_.positions=n,E_.granularity=P.default.getValueOrUndefined(i._granularity,e),E_.height=Mt.extractHeights(n,p.ellipsoid),n=h===oo.a.GEODESIC?Mt.generateCartesianArc(E_):Mt.generateCartesianRhumbArc(E_)),c.show=!0,c.positions=n.slice(),c.material=be.getValue(e,t.fillMaterialProperty,c.material),c.width=P.default.getValueOrDefault(i._width,e,1),c.distanceDisplayCondition=P.default.getValueOrUndefined(i._distanceDisplayCondition,e,c.distanceDisplayCondition)}else c.show=!1},C_.prototype.getBoundingSphere=function(e){if(this._geometryUpdater.clampToGround){var t=this._groundPolylinePrimitive;if(Object(s.default)(t)&&t.show&&t.ready){var a=t.getGeometryInstanceAttributes(this._geometryUpdater._entity);if(Object(s.default)(a)&&Object(s.default)(a.boundingSphere))return r.default.clone(a.boundingSphere,e),C.default.DONE}return Object(s.default)(t)&&!t.ready?C.default.PENDING:C.default.DONE}var i=P_(this);return i.show&&i.positions.length>0?(r.default.fromPoints(i.positions,e),C.default.DONE):C.default.FAILED},C_.prototype.isDestroyed=function(){return!1},C_.prototype.destroy=function(){var e=this._geometryUpdater._scene.id,t=v_[e];Object(s.default)(t)&&(t.remove(this._line),0===t.length&&(this._primitives.removeAndDestroy(t),delete v_[e])),Object(s.default)(this._groundPolylinePrimitive)&&this._groundPrimitives.remove(this._groundPolylinePrimitive),Object(u.default)(this)};var T_=j_,D_=new b.default,I_=new w.a,S_=new w.a;function M_(e,t,a,i,r){var n;n=a instanceof ge.default?e_.a:t_.a,this.orderedGroundPrimitives=e,this.classificationType=t,this.appearanceType=n,this.materialProperty=a,this.updaters=new v.default,this.createPrimitive=!0,this.primitive=void 0,this.oldPrimitive=void 0,this.geometry=new v.default,this.material=void 0,this.updatersWithAttributes=new v.default,this.attributes=new v.default,this.invalidated=!1,this.removeMaterialSubscription=a.definitionChanged.addEventListener(M_.prototype.onMaterialChanged,this),this.subscriptions=new v.default,this.showsUpdated=new v.default,this.zIndex=i,this._asynchronous=r}function R_(e,t,a){this._items=[],this._orderedGroundPrimitives=e,this._classificationType=t,this._asynchronous=Object(o.default)(a,!0)}M_.prototype.onMaterialChanged=function(){this.invalidated=!0},M_.prototype.isMaterial=function(e){var t=this.materialProperty,a=e.fillMaterialProperty;return a===t||a instanceof ge.default&&t instanceof ge.default||Object(s.default)(t)&&t.equals(a)},M_.prototype.add=function(e,t,a){var i=t.id;if(this.updaters.set(i,t),this.geometry.set(i,a),t.hasConstantFill&&t.fillMaterialProperty.isConstant&&P.default.isConstant(t.distanceDisplayConditionProperty)){var r=this;this.subscriptions.set(i,t.entity.definitionChanged.addEventListener((function(e,a,i,n){"isShowing"===a&&r.showsUpdated.set(t.id,t)})))}else this.updatersWithAttributes.set(i,t);this.createPrimitive=!0},M_.prototype.remove=function(e){var t=e.id;if(this.createPrimitive=this.geometry.remove(t)||this.createPrimitive,this.updaters.remove(t)){this.updatersWithAttributes.remove(t);var a=this.subscriptions.get(t);return Object(s.default)(a)&&(a(),this.subscriptions.remove(t)),!0}return!1},M_.prototype.update=function(e){var t,a=!0,i=this.primitive,r=this.orderedGroundPrimitives,n=this.geometry.values;if(this.createPrimitive){if(n.length>0)Object(s.default)(i)&&(Object(s.default)(this.oldPrimitive)?r.remove(i):this.oldPrimitive=i),i=new f.a({show:!1,asynchronous:this._asynchronous,geometryInstances:n.slice(),appearance:new this.appearanceType,classificationType:this.classificationType}),this.appearanceType===t_.a&&(this.material=be.getValue(e,this.materialProperty,this.material),i.appearance.material=this.material),r.add(i,this.zIndex),a=!1;else{Object(s.default)(i)&&(r.remove(i),i=void 0);var o=this.oldPrimitive;Object(s.default)(o)&&(r.remove(o),this.oldPrimitive=void 0)}this.attributes.removeAll(),this.primitive=i,this.createPrimitive=!1}else if(Object(s.default)(i)&&i.ready){i.show=!0,Object(s.default)(this.oldPrimitive)&&(r.remove(this.oldPrimitive),this.oldPrimitive=void 0),this.appearanceType===t_.a&&(this.material=be.getValue(e,this.materialProperty,this.material),this.primitive.appearance.material=this.material);var l=this.updatersWithAttributes.values,u=l.length;for(t=0;t<u;t++){var d=l[t],c=d.entity,h=this.geometry.get(d.id),p=this.attributes.get(h.id.id);if(Object(s.default)(p)||(p=i.getGeometryInstanceAttributes(h.id),this.attributes.set(h.id.id,p)),!d.fillMaterialProperty.isConstant){var m=d.fillMaterialProperty.color,v=P.default.getValueOrDefault(m,e,b.default.WHITE,D_);b.default.equals(p._lastColor,v)||(p._lastColor=b.default.clone(v,p._lastColor),p.color=le.a.toValue(v,p.color))}var g=c.isShowing&&(d.hasConstantFill||d.isFilled(e));g!==(1===p.show[0])&&(p.show=ve.a.toValue(g,p.show));var _=d.distanceDisplayConditionProperty;if(!P.default.isConstant(_)){var y=P.default.getValueOrDefault(_,e,S_,I_);w.a.equals(y,p._lastDistanceDisplayCondition)||(p._lastDistanceDisplayCondition=w.a.clone(y,p._lastDistanceDisplayCondition),p.distanceDisplayCondition=fe.toValue(y,p.distanceDisplayCondition))}}this.updateShows(i)}else Object(s.default)(i)&&!i.ready&&(a=!1);return a},M_.prototype.updateShows=function(e){for(var t=this.showsUpdated.values,a=t.length,i=0;i<a;i++){var r=t[i],n=r.entity,o=this.geometry.get(r.id),l=this.attributes.get(o.id.id);Object(s.default)(l)||(l=e.getGeometryInstanceAttributes(o.id),this.attributes.set(o.id.id,l));var u=n.isShowing;u!==(1===l.show[0])&&(l.show=ve.a.toValue(u,l.show),o.attributes.show.value[0]=l.show[0])}this.showsUpdated.removeAll()},M_.prototype.contains=function(e){return this.updaters.contains(e.id)},M_.prototype.getBoundingSphere=function(e,t){var a=this.primitive;if(!a.ready)return C.default.PENDING;var i=a.getGeometryInstanceAttributes(e.entity);return!Object(s.default)(i)||!Object(s.default)(i.boundingSphere)||Object(s.default)(i.show)&&0===i.show[0]?C.default.FAILED:(i.boundingSphere.clone(t),C.default.DONE)},M_.prototype.destroy=function(){var e=this.primitive,t=this.orderedGroundPrimitives;Object(s.default)(e)&&t.remove(e);var a=this.oldPrimitive;Object(s.default)(a)&&t.remove(a),this.removeMaterialSubscription()},R_.prototype.add=function(e,t){for(var a=this._items,i=a.length,r=t.createFillGeometryInstance(e),n=P.default.getValueOrDefault(t.zIndex,0),o=0;o<i;++o){var s=a[o];if(s.isMaterial(t)&&s.zIndex===n)return void s.add(e,t,r)}var l=new M_(this._orderedGroundPrimitives,this._classificationType,t.fillMaterialProperty,n,this._asynchronous);l.add(e,t,r),a.push(l)},R_.prototype.remove=function(e){for(var t=this._items,a=t.length-1;a>=0;a--){var i=t[a];if(i.remove(e)){0===i.updaters.length&&(t.splice(a,1),i.destroy());break}}},R_.prototype.update=function(e){var t,a=this._items;for(t=a.length-1;t>=0;t--){var i=a[t];if(i.invalidated){a.splice(t,1);for(var r=i.updaters.values,n=r.length,o=0;o<n;o++)this.add(e,r[o]);i.destroy()}}var s=!0;for(t=0;t<a.length;t++)s=a[t].update(e)&&s;return s},R_.prototype.getBoundingSphere=function(e,t){for(var a=this._items,i=a.length,r=0;r<i;r++){var n=a[r];if(n.contains(e))return n.getBoundingSphere(e,t)}return C.default.FAILED},R_.prototype.removeAllPrimitives=function(){for(var e=this._items,t=e.length,a=0;a<t;a++)e[a].destroy();this._items.length=0};var L_=R_,V_=[];function N_(e,t){for(var a=e._batches,i=a.length,r=0;r<i;r++)a[r].remove(t)}function F_(e,t,a){if(a.isDynamic)e._dynamicBatch.add(t,a);else if(a.clampToGround&&a.fillEnabled){var i=a.classificationTypeProperty.getValue(t);e._groundBatches[i].add(t,a)}else{var r;a.fillEnabled&&(r=a.shadowsProperty.getValue(t));var n,o=0;Object(s.default)(a.depthFailMaterialProperty)&&(o=a.depthFailMaterialProperty instanceof ge.default?1:2),Object(s.default)(r)&&(n=r+o*ne.a.NUMBER_OF_SHADOW_MODES),a.fillEnabled&&(a.fillMaterialProperty instanceof ge.default?e._colorBatches[n].add(t,a):e._materialBatches[n].add(t,a))}}function B_(e,t,a,i){var r;i=Object(o.default)(i,e.groundPrimitives),a=Object(o.default)(a,e.primitives),this._scene=e,this._primitives=a,this._entityCollection=void 0,this._addedObjects=new v.default,this._removedObjects=new v.default,this._changedObjects=new v.default;var n=ne.a.NUMBER_OF_SHADOW_MODES;for(this._colorBatches=new Array(3*n),this._materialBatches=new Array(3*n),r=0;r<n;++r)this._colorBatches[r]=new ou(a,e_.a,void 0,!1,r),this._materialBatches[r]=new pu(a,t_.a,void 0,!1,r),this._colorBatches[r+n]=new ou(a,e_.a,e_.a,!1,r),this._materialBatches[r+n]=new pu(a,t_.a,e_.a,!1,r),this._colorBatches[r+2*n]=new ou(a,e_.a,t_.a,!1,r),this._materialBatches[r+2*n]=new pu(a,t_.a,t_.a,!1,r);this._dynamicBatch=new pr(a,i);var s=J.a.NUMBER_OF_CLASSIFICATION_TYPES;for(this._groundBatches=new Array(s),r=0;r<s;++r)this._groundBatches[r]=new L_(i,r);this._batches=this._colorBatches.concat(this._materialBatches,this._dynamicBatch,this._groundBatches),this._subscriptions=new v.default,this._updaters=new v.default,this._entityCollection=t,t.collectionChanged.addEventListener(B_.prototype._onCollectionChanged,this),this._onCollectionChanged(t,t.values,V_)}B_.prototype.update=function(e){var t,a,i,r,n=this._addedObjects,o=n.values,s=this._removedObjects,l=s.values,u=this._changedObjects,d=u.values;for(t=d.length-1;t>-1;t--)i=(a=d[t]).id,(r=this._updaters.get(i)).entity===a?(N_(this,r),F_(this,e,r)):(l.push(a),o.push(a));for(t=l.length-1;t>-1;t--)i=(a=l[t]).id,N_(this,r=this._updaters.get(i)),r.destroy(),this._updaters.remove(i),this._subscriptions.get(i)(),this._subscriptions.remove(i);for(t=o.length-1;t>-1;t--)i=(a=o[t]).id,r=new T_(a,this._scene),this._updaters.set(i,r),F_(this,e,r),this._subscriptions.set(i,r.geometryChanged.addEventListener(B_._onGeometryChanged,this));n.removeAll(),s.removeAll(),u.removeAll();var f=!0,c=this._batches,h=c.length;for(t=0;t<h;t++)f=c[t].update(e)&&f;return f};var U_=[],H_=new r.default;B_.prototype.getBoundingSphere=function(e,t){for(var a=U_,i=H_,n=0,o=C.default.DONE,s=this._batches,l=s.length,u=this._updaters.get(e.id),d=0;d<l;d++){if((o=s[d].getBoundingSphere(u,i))===C.default.PENDING)return C.default.PENDING;o===C.default.DONE&&(a[n]=r.default.clone(i,a[n]),n++)}return 0===n?C.default.FAILED:(a.length=n,r.default.fromBoundingSpheres(a,t),C.default.DONE)},B_.prototype.isDestroyed=function(){return!1},B_.prototype.destroy=function(){var e;this._entityCollection.collectionChanged.removeEventListener(B_.prototype._onCollectionChanged,this),this._addedObjects.removeAll(),this._removedObjects.removeAll();var t=this._batches,a=t.length;for(e=0;e<a;e++)t[e].removeAllPrimitives();var i=this._subscriptions.values;for(a=i.length,e=0;e<a;e++)i[e]();return this._subscriptions.removeAll(),Object(u.default)(this)},B_._onGeometryChanged=function(e){var t=this._removedObjects,a=this._changedObjects,i=e.entity,r=i.id;Object(s.default)(t.get(r))||Object(s.default)(a.get(r))||a.set(r,i)},B_.prototype._onCollectionChanged=function(e,t,a){var i,r,n,o=this._addedObjects,s=this._removedObjects,l=this._changedObjects;for(i=a.length-1;i>-1;i--)r=(n=a[i]).id,o.remove(r)||(s.set(r,n),l.remove(r));for(i=t.length-1;i>-1;i--)r=(n=t[i]).id,s.remove(r)?l.set(r,n):o.set(r,n)};var k_=B_;function z_(e){this._displayID=Object(n.default)(),c.a.initializeTerrainHeights(),f.a.initializeTerrainHeights();var t=e.scene,a=e.dataSourceCollection;this._eventHelper=new d.default,this._eventHelper.add(a.dataSourceAdded,this._onDataSourceAdded,this),this._eventHelper.add(a.dataSourceRemoved,this._onDataSourceRemoved,this),this._eventHelper.add(a.dataSourceMoved,this._onDataSourceMoved,this),this._eventHelper.add(t.postRender,this._postRender,this),this._dataSourceCollection=a,this._scene=t,this._visualizersCallback=Object(o.default)(e.visualizersCallback,z_.defaultVisualizersCallback);var i=!1,r=new h.a,s=new h.a;a.length>0&&(t.primitives.add(r),t.groundPrimitives.add(s),i=!0),this._primitives=r,this._groundPrimitives=s;for(var l=0,u=a.length;l<u;l++)this._onDataSourceAdded(a,a.get(l));var p,m,v=new X.default;if(this._onDataSourceAdded(void 0,v),this._defaultDataSource=v,!i){var g=this,_=function(){t.primitives.add(r),t.groundPrimitives.add(s),p(),m(),g._removeDefaultDataSourceListener=void 0,g._removeDataSourceCollectionListener=void 0};p=v.entities.collectionChanged.addEventListener(_),m=a.dataSourceAdded.addEventListener(_)}this._removeDefaultDataSourceListener=p,this._removeDataSourceCollectionListener=m,this._ready=!1}z_.defaultVisualizersCallback=function(e,t,a){var i=a.entities;return[new K(t,i),new kd(e,i,a._primitives,a._groundPrimitives),new mf(t,i),new gv(e,i),new $g(t,i),new Ug(e,i),new k_(e,i,a._primitives,a._groundPrimitives)]},Object(l.default)(z_.prototype,{scene:{get:function(){return this._scene}},dataSources:{get:function(){return this._dataSourceCollection}},defaultDataSource:{get:function(){return this._defaultDataSource}},ready:{get:function(){return this._ready}}}),z_.prototype.isDestroyed=function(){return!1},z_.prototype.destroy=function(){this._eventHelper.removeAll();for(var e=this._dataSourceCollection,t=0,a=e.length;t<a;++t)this._onDataSourceRemoved(this._dataSourceCollection,e.get(t));return this._onDataSourceRemoved(void 0,this._defaultDataSource),Object(s.default)(this._removeDefaultDataSourceListener)?(this._removeDefaultDataSourceListener(),this._removeDataSourceCollectionListener()):(this._scene.primitives.remove(this._primitives),this._scene.groundPrimitives.remove(this._groundPrimitives)),Object(u.default)(this)},z_.prototype.update=function(e){if(!i.a.initialized)return this._ready=!1,!1;var t,a,r,n,o=!0,l=this._dataSourceCollection,u=l.length;for(t=0;t<u;t++){var d=l.get(t);for(Object(s.default)(d.update)&&(o=d.update(e)&&o),n=(r=d._visualizersByDisplayID[this._displayID]).length,a=0;a<n;a++)o=r[a].update(e)&&o}for(n=(r=this._defaultDataSource._visualizersByDisplayID[this._displayID]).length,a=0;a<n;a++)o=r[a].update(e)&&o;return this._ready=o,o},z_.prototype._postRender=function(){for(var e=this._scene.frameState,t=this._dataSourceCollection,a=t.length,i=0;i<a;i++){var r=t.get(i),n=r.credit;Object(s.default)(n)&&e.creditDisplay.addCredit(n);var o=r._resourceCredits;if(Object(s.default)(o))for(var l=o.length,u=0;u<l;u++)e.creditDisplay.addCredit(o[u])}};var G_=[],q_=new r.default;z_.prototype.getBoundingSphere=function(e,t,a){if(!this._ready)return C.default.PENDING;var i,n,o=this._defaultDataSource;if(!o.entities.contains(e)){o=void 0;var l=this._dataSourceCollection;for(n=l.length,i=0;i<n;i++){var u=l.get(i);if(u.entities.contains(e)){o=u;break}}}if(!Object(s.default)(o))return C.default.FAILED;var d=G_,f=q_,c=0,h=C.default.DONE,p=o._visualizers,m=p.length;for(i=0;i<m;i++){var v=p[i];if(Object(s.default)(v.getBoundingSphere)){if(h=p[i].getBoundingSphere(e,f),!t&&h===C.default.PENDING)return C.default.PENDING;h===C.default.DONE&&(d[c]=r.default.clone(f,d[c]),c++)}}return 0===c?C.default.FAILED:(d.length=c,r.default.fromBoundingSpheres(d,a),C.default.DONE)},z_.prototype._onDataSourceAdded=function(e,t){var a=this._scene,i=this._primitives,r=this._groundPrimitives,n=i.add(new h.a),o=r.add(new m);t._primitives=n,t._groundPrimitives=o;var s=t.clustering;s._initialize(a),n.add(s);var l=this._visualizersCallback(a,s,t);t._visualizersByDisplayID=t._visualizersByDisplayID||{},t._visualizersByDisplayID[this._displayID]=l,t._visualizers=t._visualizers||[],t._visualizers=t._visualizers.concat(l)},z_.prototype._onDataSourceRemoved=function(e,t){var a=this._primitives,i=this._groundPrimitives,r=t._primitives,n=t._groundPrimitives,o=t.clustering;r.remove(o);var l=t._visualizersByDisplayID[this._displayID];if(Object(s.default)(l)){for(var u=l.length,d=0;d<u;d++){var f=l[d];f.destroy();var c=t._visualizers.indexOf(f);t._visualizers.splice(c,1)}delete t._visualizersByDisplayID[this._displayID],a.remove(r),i.remove(n)}},z_.prototype._onDataSourceMoved=function(e,t,a){var i=this._primitives,r=this._groundPrimitives,n=e._primitives,o=e._groundPrimitives;t===a+1?(i.raise(n),r.raise(o)):t===a-1?(i.lower(n),r.lower(o)):0===t?(i.lowerToBottom(n),r.lowerToBottom(o),i.raise(n),r.raise(o)):(i.raiseToTop(n),r.raiseToTop(o))};t.default=z_}}]);
//# sourceMappingURL=1.TerriaJS-specs.js.map